<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>String Manipulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea, input[type="submit"], button {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 22px);
            font-size: 16px;
        }
        textarea {
            height: 150px; /* Adjust this value to make the textbox taller */
            resize: vertical; /* Allows users to resize the textarea vertically */
        }
    </style>
</head>
<body>
    <h1>Kargo markup converter</h1>
    <label for="inputString">Enter your Kargo markup:</label>
    <textarea id="inputString" placeholder="Place Kargo markup here"></textarea>
    <label>Insert Epsilon DoubleVerify Tag?:</label>
    <label for="toggleYes">
        <input type="radio" id="toggleYes" name="yesNoToggle" value="yes" required> Yes
    </label>
    <label for="toggleNo">
        <input type="radio" id="toggleNo" name="yesNoToggle" value="no" checked> No
    </label>
    
    
    <input type="submit" id="submitButton" value="Submit">
    
    <label for="output">Output:</label>
    <textarea id="output" readonly></textarea>
    
    <button id="copyButton">Copy to Clipboard</button>

    <script>
        document.getElementById('submitButton').addEventListener('click', function() {
            const inputString = document.getElementById('inputString').value;
            const selectedToggle = document.querySelector('input[name="yesNoToggle"]:checked');
            const toggleValue = selectedToggle.value;
            const manipulatedString = inputString.replace(/<\/script>/gi, '</SCR+IPT>');
            const pre_string = `<script type="text/kargo_creative" data-ad-kargo-payload="cnvr_kargo_{{{TRANSACTION_ID}}}">`;
            const dv_string = `<script src="https://cdn.doubleverify.com/dvtp_src.js?ctx=2198896&cmp=DV184445&sid=conversant&plc=DV-CNVR-IQM_Brand_View&adsrv=8&advid=3819603&dvtagver=6.1.src&btreg=[CV_UNIQUE_ID]&ppid=230&autt=1&aubndl={{{BUNDLE_ID}}}&c1={{{ADVERTISER_ID}}}&aucmp={{{CAMPAIGN_ID}}}&pltfrm={{{PUBLISHER_ID}}}&ausite={{{SITE_ID}}}&audvc={{{DEVICE_TYPE}}}&auxch=[EXCHANGE_ID]&c2={{{DIVISION_FORMAT}}}&c3=[AD-HOC_TEST_VALUE]&c4={{{BUNDLE_ID}}}&auevent={{{TRANSACTION_ID}}}&auip=[BID_IP_ADDRESS]&DVPX_PP_AUCTION_UA=[URL-ENCODED_BID_USER-AGENT]&turl={{{DOMAIN_NAME}}}"type="text/javascript"></SCR+IPT>`;
            const post_string = `<\/script> <script> (function() { 'use strict'; var style = document.createElement('style'); style.type = 'text/css'; style.innerHTML = '#adInfo, #adInfo-over { display: none !important; }'; document.head.appendChild(style); function handleAdInjection() { try { var targetElement = parent.document.querySelector('div.cnvr-ubr-adm.cnvr-ubr-adm-{{{TRANSACTION_ID}}}'); if (targetElement) { var adScript = document.querySelector('script[data-ad-kargo-payload="cnvr_kargo_{{{TRANSACTION_ID}}}"]'); if (adScript) { var adContent = adScript.textContent.replace(/\\/scr\\+ipt>/gi, '/script>'); var tempDiv = parent.document.createElement('div'); tempDiv.innerHTML = adContent; var oldScripts = tempDiv.querySelectorAll('script[src]'); for (var i = 0; i < oldScripts.length; i++) { var oldScript = oldScripts[i]; var newScript = parent.document.createElement('script'); for (var j = 0; j < oldScript.attributes.length; j++) { var attr = oldScript.attributes[j]; newScript.setAttribute(attr.name, attr.value); } oldScript.parentNode.replaceChild(newScript, oldScript); } while (tempDiv.firstChild) { targetElement.appendChild(tempDiv.firstChild); } } } } catch (error) { } } function handleAdChoicesCreation() { function createAdChoicesIcons() { var adChoicesSpan = document.getElementById('{{{TRANSACTION_ID}}}'); if (!adChoicesSpan || adChoicesSpan.tagName.toLowerCase() !== 'span') { return; } var scripts = adChoicesSpan.getElementsByTagName('script'); var scriptTag = scripts.length > 0 ? scripts[0] : null; if (!scriptTag || !scriptTag.src) { return; } var plc = 'tr'; if (scriptTag.src.indexOf('&plc=br&') > -1) { plc = 'br'; } else if (scriptTag.src.indexOf('&plc=tl&') > -1) { plc = 'tl'; } else if (scriptTag.src.indexOf('&plc=bl&') > -1) { plc = 'bl'; } var scriptParams = {}; try { var urlParams = scriptTag.src.split('?')[1]; if (urlParams) { var pairs = urlParams.split('&'); for (var i = 0; i < pairs.length; i++) { var pair = pairs[i].split('='); if (pair.length === 2) { scriptParams[pair[0]] = decodeURIComponent(pair[1]); } } } } catch (e) { } var adInfoUrl = scriptParams.path || 'https://legal.epsilon.com/adchoices/'; var queryParams = []; queryParams.push('type=general'); queryParams.push('cid=' + encodeURIComponent(scriptParams.cid || '')); queryParams.push('cname=' + encodeURIComponent(scriptParams.cname || '')); queryParams.push('clogo=' + encodeURIComponent(scriptParams.clogo || '')); queryParams.push('purl=' + encodeURIComponent(scriptParams.purl || '')); queryParams.push('lang=' + encodeURIComponent(scriptParams.lang || 'en-us')); queryParams.push('loc=' + encodeURIComponent(scriptParams.loc || 'us')); queryParams.push('optout_options='); queryParams.push('fpc_token=' + encodeURIComponent(scriptParams.fpctok || '')); queryParams.push('dtm_token='); queryParams.push('loader_ver=' + encodeURIComponent(scriptParams.loader_ver || '')); queryParams.push('politicalAd=' + encodeURIComponent(scriptParams.politicalAd || 'false')); queryParams.push('dvcid=' + encodeURIComponent(scriptParams.dvcid || '')); queryParams.push('dtm_host=' + encodeURIComponent(scriptParams.dtm_host || '')); queryParams.push('optout_info='); adInfoUrl += (adInfoUrl.indexOf('?') === -1 ? '?' : '&') + queryParams.join('&'); var targetElement = null; var targetDoc = null; var selectors = ['div.celtra-ad-inline-host', 'div.kargo-ad-content']; var frames = [window.parent.parent, window.parent]; var i, j; for (i = 0; i < frames.length; i++) { if (targetElement) break; for (j = 0; j < selectors.length; j++) { try { var doc = frames[i].document; var el = doc.querySelector(selectors[j]); if (el) { targetElement = el; targetDoc = doc; break; } } catch (e) {} } } if (!targetElement || !targetDoc) { return; } var rect = targetElement.getBoundingClientRect(); var targetWidth = rect.width; var targetHeight = rect.height; var adLeftPos = '0px'; var adTopPos = '0px'; var adOverLeftPos = '0px'; var finalPlacement = plc; var kargoBranding = targetDoc.querySelector('a.kargo-hover-link.unfilled.kargo-sidekick-branding.kargo-breakaway-branding'); if (!kargoBranding) { kargoBranding = targetDoc.querySelector('a.kargo-banner-optout.kargo-branding-kargo[href="https://www.kargo.com/privacy"]'); } if (kargoBranding) { var brandingRect = kargoBranding.getBoundingClientRect(); var containerRect = targetElement.getBoundingClientRect(); var containerWidth = containerRect.width; var brandingTop = brandingRect.top - containerRect.top; var brandingRightRelative = brandingRect.right - containerRect.left; if (brandingRightRelative > containerWidth * 0.7) { var brandingLeft = brandingRect.left - containerRect.left; adLeftPos = (brandingLeft - 21) + 'px'; adTopPos = brandingTop + 'px'; var spaceLeft = brandingLeft - 21; var spaceRight = containerWidth - brandingLeft + 21; if (spaceLeft > spaceRight) { adOverLeftPos = (brandingLeft - 81) + 'px'; } else { adOverLeftPos = (brandingLeft - 1) + 'px'; } } else { var brandingRight = brandingRect.right - containerRect.left; adLeftPos = (brandingRight + 1) + 'px'; adTopPos = brandingTop + 'px'; var spaceLeft = brandingRight + 1; var spaceRight = containerWidth - (brandingRight + 1); if (spaceRight > spaceLeft) { adOverLeftPos = (brandingRight + 1) + 'px'; } else { adOverLeftPos = (brandingRight - 59) + 'px'; } } } else { switch (plc) { case 'tr': adLeftPos = (targetWidth - 20) + 'px'; adOverLeftPos = (targetWidth - 80) + 'px'; break; case 'br': adLeftPos = (targetWidth - 20) + 'px'; adTopPos = (targetHeight - 16) + 'px'; adOverLeftPos = (targetWidth - 80) + 'px'; break; case 'bl': adTopPos = (targetHeight - 16) + 'px'; break; case 'tl': break; } } try { var targetStyle = targetDoc.defaultView.getComputedStyle(targetElement); if (targetStyle.position === 'static') { targetElement.style.position = 'relative'; } } catch (e) { targetElement.style.position = 'relative'; } var adInfo = targetDoc.createElement('img'); adInfo.id = 'adInfo'; adInfo.style.position = 'absolute'; adInfo.style.zIndex = '9999998'; adInfo.style.left = adLeftPos; adInfo.style.top = adTopPos; adInfo.style.margin = '0px'; adInfo.style.padding = '0px'; adInfo.style.visibility = 'visible'; adInfo.style.cursor = 'pointer'; var adInfoOver = targetDoc.createElement('img'); adInfoOver.id = 'adInfo-over'; adInfoOver.style.position = 'absolute'; adInfoOver.style.zIndex = '999999999'; adInfoOver.style.left = adOverLeftPos; adInfoOver.style.top = adTopPos; adInfoOver.style.margin = '0px'; adInfoOver.style.padding = '0px'; adInfoOver.style.visibility = 'hidden'; adInfoOver.style.cursor = 'pointer'; if (kargoBranding) { var brandingRect = kargoBranding.getBoundingClientRect(); var containerRect = targetElement.getBoundingClientRect(); var brandingRightRelative = brandingRect.right - containerRect.left; var containerWidth = containerRect.width; if (brandingRightRelative > containerWidth * 0.7) { var brandingLeft = brandingRect.left - containerRect.left; var spaceLeft = brandingLeft - 21; var spaceRight = containerWidth - brandingLeft + 21; if (spaceLeft > spaceRight) { adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-br.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-br-full.png'; } else { adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-bl.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-bl-full.png'; } } else { var brandingRight = brandingRect.right - containerRect.left; var spaceLeft = brandingRight + 1; var spaceRight = containerWidth - (brandingRight + 1); if (spaceRight > spaceLeft) { adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-bl.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-bl-full.png'; } else { adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-br.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-br-full.png'; } } } else { switch (plc) { case 'tr': adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-br.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-br-full.png'; break; case 'br': adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-br.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-br-full.png'; break; case 'bl': adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-bl.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-bl-full.png'; break; case 'tl': adInfo.src = 'https://s-usweb.dotomi.com/assets/img/icon-bl.png'; adInfoOver.src = 'https://s-usweb.dotomi.com/assets/img/en-us/icon-bl-full.png'; break; } } var isExpanded = false; var hideTimeout; var showAdInfoOver = function() { adInfo.style.visibility = 'hidden'; adInfoOver.style.visibility = 'visible'; isExpanded = true; if (hideTimeout) { clearTimeout(hideTimeout); } }; var hideAdInfoOver = function() { adInfo.style.visibility = 'visible'; adInfoOver.style.visibility = 'hidden'; isExpanded = false; }; var delayedHide = function() { hideTimeout = setTimeout(hideAdInfoOver, 1000); }; var handleAdInfoClick = function() { window.open(adInfoUrl, '_blank', 'width=640,height=790,scrollbars=1'); }; var handleAdInfoTap = function(e) { e.preventDefault(); if (!isExpanded) { showAdInfoOver(); delayedHide(); } else { handleAdInfoClick(); } }; var handleAdInfoOverTap = function(e) { e.preventDefault(); handleAdInfoClick(); }; function attachEvent(element, eventType, handler) { if (element.addEventListener) { element.addEventListener(eventType, handler, false); } else if (element.attachEvent) { element.attachEvent('on' + eventType, handler); } } attachEvent(adInfo, 'mouseover', showAdInfoOver); attachEvent(adInfo, 'mouseout', hideAdInfoOver); attachEvent(adInfo, 'mouseup', handleAdInfoClick); attachEvent(adInfo, 'touchend', handleAdInfoTap); attachEvent(adInfoOver, 'mouseover', showAdInfoOver); attachEvent(adInfoOver, 'mouseout', hideAdInfoOver); attachEvent(adInfoOver, 'mouseup', handleAdInfoClick); attachEvent(adInfoOver, 'touchend', handleAdInfoOverTap); targetElement.appendChild(adInfo); targetElement.appendChild(adInfoOver); } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', createAdChoicesIcons); } else if (document.readyState === 'interactive') { window.addEventListener('load', createAdChoicesIcons); } else { createAdChoicesIcons(); } } handleAdInjection(); handleAdChoicesCreation(); })(); <\/script>`;
            
            if (toggleValue === 'yes') {
                document.getElementById('output').value = pre_string + manipulatedString + dv_string + post_string;
            }
            else {
                document.getElementById('output').value = pre_string + manipulatedString + post_string;
            }
            
            
                
        });

        document.getElementById('copyButton').addEventListener('click', function() {
            const outputField = document.getElementById('output');
            outputField.select();
            document.execCommand('copy');
            alert('Output copied to clipboard!');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>String Manipulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea, input[type="submit"], button {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 22px);
            font-size: 16px;
        }
        textarea {
            height: 150px; /* Adjust this value to make the textbox taller */
            resize: vertical; /* Allows users to resize the textarea vertically */
        }
    </style>
</head>
<body>
    <h1>Kargo markup converter</h1>
    <label for="inputString">Enter your Kargo markup:</label>
    <textarea id="inputString" placeholder="Place Kargo markup here"></textarea>
    <label>Insert Epsilon DoubleVerify Tag?:</label>
    <label for="toggleYes">
        <input type="radio" id="toggleYes" name="yesNoToggle" value="yes" required> Yes
    </label>
    <label for="toggleNo">
        <input type="radio" id="toggleNo" name="yesNoToggle" value="no" checked> No
    </label>
    
    
    <input type="submit" id="submitButton" value="Submit">
    
    <label for="output">Output:</label>
    <textarea id="output" readonly></textarea>
    
    <button id="copyButton">Copy to Clipboard</button>

    <script>
        document.getElementById('submitButton').addEventListener('click', function() {
            const inputString = document.getElementById('inputString').value;
            const selectedToggle = document.querySelector('input[name="yesNoToggle"]:checked');
            const toggleValue = selectedToggle.value;
            const manipulatedString = inputString.replace(/<\/script>/gi, '</SCR+IPT>');
            const pre_string = `<script type="text/kargo_creative" data-ad-kargo-payload="cnvr_kargo_{{{TRANSACTION_ID}}}" adchoice-location="script"> `;
            const dv_string = `<script src="https://cdn.doubleverify.com/dvtp_src.js?ctx=2198896&cmp=DV184445&sid=conversant&plc=DV-CNVR-IQM_Brand_View&adsrv=8&advid=3819603&dvtagver=6.1.src&btreg=[CV_UNIQUE_ID]&ppid=230&autt=1&aubndl={{{BUNDLE_ID}}}&c1={{{ADVERTISER_ID}}}&aucmp={{{CAMPAIGN_ID}}}&pltfrm={{{PUBLISHER_ID}}}&ausite={{{SITE_ID}}}&audvc={{{DEVICE_TYPE}}}&auxch=[EXCHANGE_ID]&c2={{{DIVISION_FORMAT}}}&c3=[AD-HOC_TEST_VALUE]&c4={{{BUNDLE_ID}}}&auevent={{{TRANSACTION_ID}}}&auip=[BID_IP_ADDRESS]&DVPX_PP_AUCTION_UA=[URL-ENCODED_BID_USER-AGENT]&turl={{{DOMAIN_NAME}}}"type="text/javascript"></SCR+IPT>`;
            const post_string = `<\/script> <script> (function() { 'use strict'; var style = document.createElement('style'); style.innerHTML = '#adInfo, #adInfo-over { display: none !important; }'; document.head.appendChild(style); function handleIframeResizing() { var pd = parent.document, d = document, lastW = {{{WIDTH}}}, lastH = {{{HEIGHT}}}; var sels = ['iframe.cnvr-ad-ubr-iframe', 'div.cnvr-ad.cnvr-ad-{{{TRANSACTION_ID}}}', 'div.cnvr-ubr-adm.cnvr-ubr-adm-{{{TRANSACTION_ID}}}']; function trackError(fn) { var img = new Image(); img.src = 'https://usadmm.dotomi.com/event/ad/lifecycle/current?trid={{{TRANSACTION_ID}}}&site_id={{{SITE_ID}}}&dtmid={{{USER_ID}}}&comId={{{COMPANY_ID}}}&tid={{{CREATIVE_ID}}}&msgCampId={{{CAMPAIGN_ID}}}&supplyType=-1&etype=3100001&failedFn=' + fn; } function init() { try { d.head.querySelector('style').remove(); var css = 'margin:0;padding:0;min-width:{{{WIDTH}}}px;min-height:{{{HEIGHT}}}px'; d.documentElement.style.cssText = css; d.body.style.cssText = css; sels.forEach(function(sel, i) { var el = pd.querySelector(sel); if (el) { el.style.cssText = i === 0 ? 'border:none; width: 100%; min-width:{{{WIDTH}}}px;min-height:{{{HEIGHT}}}px' : 'min-width:{{{WIDTH}}}px;min-height:{{{HEIGHT}}}px'; } }); } catch (e) { trackError('init'); } } function update() { try { var excluded = ['adInfo', 'adInfo-over', 'menu'].map(function(id) { var el = d.getElementById(id); if (el) { var display = el.style.display; el.style.display = 'none'; return { el: el, display: display }; } }).filter(Boolean); var b = d.body; var w = Math.max(b.scrollWidth, b.offsetWidth, b.clientWidth, lastW); var h = Math.max(b.scrollHeight, b.offsetHeight, b.clientHeight, lastH); excluded.forEach(function(item) { item.el.style.display = item.display || ''; }); if (w !== lastW || h !== lastH) { lastW = w; lastH = h; var minW = w + 'px', minH = h + 'px'; d.documentElement.style.minWidth = minW; d.documentElement.style.minHeight = minH; d.body.style.minWidth = minW; d.body.style.minHeight = minH; sels.forEach(function(sel, i) { var el = pd.querySelector(sel); if (el) { el.style.minWidth = minW; el.style.minHeight = minH; } }); } } catch (e) { trackError('update'); } } init(); setTimeout(function() { update(); setInterval(update, 250); }, 100); } function handleAdInjection() { try { var targetElement = parent.document.querySelector('div.cnvr-ubr-adm.cnvr-ubr-adm-{{{TRANSACTION_ID}}}'); if (targetElement) { var adScript = document.querySelector('script[data-ad-kargo-payload="cnvr_kargo_{{{TRANSACTION_ID}}}"]'); if (adScript) { var adContent = adScript.textContent.replace(\/\\/scr\\+ipt>/gi, '/script>'); var tempDiv = parent.document.createElement('div'); tempDiv.innerHTML = adContent; var oldScripts = tempDiv.querySelectorAll('script[src]'); for (var i = 0; i < oldScripts.length; i++) { var oldScript = oldScripts[i]; var newScript = parent.document.createElement('script'); for (var j = 0; j < oldScript.attributes.length; j++) { var attr = oldScript.attributes[j]; newScript.setAttribute(attr.name, attr.value); } oldScript.parentNode.replaceChild(newScript, oldScript); } while (tempDiv.firstChild) { targetElement.parentNode.insertBefore(tempDiv.firstChild, targetElement); } } } } catch (error) {} } function handleAdChoicesCreation() { function createAdChoicesIcons() { var adChoicesSpan = document.getElementById('{{{TRANSACTION_ID}}}'); if (!adChoicesSpan || adChoicesSpan.tagName.toLowerCase() !== 'span') return; var scripts = adChoicesSpan.getElementsByTagName('script'); var scriptTag = scripts.length > 0 ? scripts[0] : null; if (!scriptTag || !scriptTag.src) return; var kargoScript = document.querySelector('script[type="text/kargo_creative"]'); var adchoiceLocation = kargoScript && kargoScript.getAttribute('adchoice-location') ? kargoScript.getAttribute('adchoice-location').toLowerCase() : 'script'; if (adchoiceLocation === 'ui') return; var plc = 'tr'; var src = scriptTag.src; if (src.indexOf('&plc=br&') > -1) plc = 'br'; else if (src.indexOf('&plc=tl&') > -1) plc = 'tl'; else if (src.indexOf('&plc=bl&') > -1) plc = 'bl'; var scriptParams = {}; try { var urlParams = src.split('?')[1]; if (urlParams) { var pairs = urlParams.split('&'); for (var i = 0; i < pairs.length; i++) { var pair = pairs[i].split('='); if (pair.length === 2) { scriptParams[pair[0]] = decodeURIComponent(pair[1]); } } } } catch (e) {} var params = ['type=general']; var keys = ['cid','cname','clogo','purl','lang','loc','fpctok','loader_ver','politicalAd','dvcid','dtm_host']; var defaults = ['','','','','en-us','us','','','false','','']; for (var i = 0; i < keys.length; i++) { var key = keys[i] === 'fpctok' ? 'fpc_token' : keys[i]; params.push(key + '=' + encodeURIComponent(scriptParams[keys[i]] || defaults[i])); } params.push('optout_options=', 'dtm_token=', 'optout_info='); var adInfoUrl = (scriptParams.path || 'https://legal.epsilon.com/adchoices/') + '?' + params.join('&'); var targetElement, targetDoc; var selectors = ['div.celtra-ad-inline-host', 'div.kargo-ad-content']; var frames = [window, window.parent, window.parent.parent]; for (var i = 0; i < frames.length && !targetElement; i++) { for (var j = 0; j < selectors.length; j++) { try { var el = frames[i].document.querySelector(selectors[j]); if (el) { targetElement = el; targetDoc = frames[i].document; break; } } catch (e) {} } if (targetElement && targetElement.className.indexOf('kargo-ad-content') > -1) break; } if (!targetElement) return; var selectedAnchor, anchorType = 'none'; var searchFrames = [document, window.parent.document, window.parent.parent.document]; function isVisible(anchor, doc) { var style = doc.defaultView.getComputedStyle(anchor); var rect = anchor.getBoundingClientRect(); return style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0' && rect.width > 0 && rect.height > 0; } function checkAnchor(anchor, doc) { if (isVisible(anchor, doc)) { var classList = anchor.classList; if (classList.contains('unfilled') || classList.contains('kargo-banner-optout')) { return 'unfilled'; } else if (classList.contains('filled')) { return 'filled'; } } return null; } for (var frameIndex = 0; frameIndex < searchFrames.length && !selectedAnchor; frameIndex++) { try { var doc = searchFrames[frameIndex]; var allElements = Array.prototype.slice.call(doc.querySelectorAll('#Layer_2')) .concat(Array.prototype.slice.call(doc.querySelectorAll('.kargo-svg-bolt'))); for (var elemIndex = 0; elemIndex < allElements.length; elemIndex++) { var element = allElements[elemIndex]; if (element.tagName.toLowerCase() === 'svg') { var currentElement = element; while (currentElement && currentElement.parentElement) { currentElement = currentElement.parentElement; if (currentElement.tagName.toLowerCase() === 'a') { var type = checkAnchor(currentElement, doc); if (type) { selectedAnchor = currentElement; anchorType = type; targetElement = doc.querySelector('div.celtra-ad-inline-host') || doc.querySelector('div.kargo-ad-content') || targetElement; targetDoc = doc; break; } } } if (selectedAnchor) break; } } } catch (e) {} } if (!selectedAnchor) { var selectors = [ 'a.kargo-hover-link.unfilled.kargo-sidekick-branding.kargo-breakaway-branding', 'a.kargo-hover-link.unfilled.kargo-sidekick-branding', 'a.kargo-hover-link.unfilled.kargo-breakaway-branding', 'a.kargo-hover-link.unfilled', 'a.kargo-hover-link.filled[href="https://www.kargo.com/privacy"]', 'a.kargo-banner-optout.kargo-branding-kargo[href="https://www.kargo.com/privacy"]' ]; for (var k = 0; k < selectors.length && !selectedAnchor; k++) { var anchors = targetDoc.querySelectorAll(selectors[k]); for (var m = 0; m < anchors.length; m++) { var type = checkAnchor(anchors[m], targetDoc); if (type) { selectedAnchor = anchors[m]; anchorType = type; break; } } } } var rect = targetElement.getBoundingClientRect(); var w = rect.width, h = rect.height; var pos = ['0px', '0px', '0px']; function setCornerPos(corner) { switch (corner) { case 'tr': pos = [(w-20)+'px', '2px', (w-80)+'px']; break; case 'br': pos = [(w-20)+'px', (h-16)+'px', (w-80)+'px']; break; case 'bl': pos = ['2px', (h-16)+'px', '2px']; break; case 'tl': pos = ['2px', '2px', '2px']; break; } } if (adchoiceLocation === 'default') { setCornerPos(plc); } else if (adchoiceLocation === 'script' && selectedAnchor && anchorType !== 'none') { var br = selectedAnchor.getBoundingClientRect(); var cr = targetElement.getBoundingClientRect(); var top = br.top - cr.top; var left = br.left - cr.left; if (anchorType === 'filled') { var l = Math.max(0, Math.min(w-20, left)); pos = [l+'px', Math.max(0, top + br.height + 5)+'px', l+'px']; } else { if (left < 0 || top < 0 || br.width === 0) { var fl = Math.max(0, Math.min(w-20, left)); var ft = Math.max(0, top + br.height + 5); if (fl >= 0 && fl <= w-20 && ft >= 0 && ft <= h-16) { pos = [fl+'px', ft+'px', fl+'px']; } else { setCornerPos(plc); } } else { var rr = br.right - cr.left; if (rr > w * 0.7) { pos = [Math.max(0, left-21)+'px', Math.max(0, top)+'px', Math.max(0, left-81)+'px']; } else { var r = br.right - cr.left; pos = [Math.min(w-20, Math.max(0, r+1))+'px', Math.max(0, top)+'px', Math.min(w-80, Math.max(0, r+1))+'px']; } } } } else { setCornerPos(plc); } try { if (targetDoc.defaultView.getComputedStyle(targetElement).position === 'static') { targetElement.style.position = 'relative'; } } catch (e) { targetElement.style.position = 'relative'; } var baseStyle = 'position: absolute; z-index: 2147483646; margin: 0; padding: 0; cursor: pointer; left: '; var adInfo = targetDoc.createElement('img'); adInfo.id = 'adInfo'; adInfo.style.cssText = baseStyle + pos[0] + '; top: ' + pos[1] + '; width: 18px; height: 14px; visibility: visible;'; var adInfoOver = targetDoc.createElement('img'); adInfoOver.id = 'adInfo-over'; adInfoOver.style.cssText = baseStyle.replace('2147483646', '2147483647') + pos[2] + '; top: ' + pos[1] + '; width: 78px; height: 14px; visibility: hidden;'; var useLeft = (anchorType === 'filled') ? (selectedAnchor && selectedAnchor.getBoundingClientRect().left > w/2) : pos[2].indexOf('-') === -1 && parseInt(pos[2]) < parseInt(pos[0]); var iconBase = 'https://s-usweb.dotomi.com/assets/img/'; if (useLeft) { adInfo.src = iconBase + 'icon-br.png'; adInfoOver.src = iconBase + 'en-us/icon-br-full.png'; } else { adInfo.src = iconBase + 'icon-bl.png'; adInfoOver.src = iconBase + 'en-us/icon-bl-full.png'; } var expanded = false, timeout; function show() { adInfo.style.visibility = 'hidden'; adInfoOver.style.visibility = 'visible'; expanded = true; if (timeout) clearTimeout(timeout); } function hide() { adInfo.style.visibility = 'visible'; adInfoOver.style.visibility = 'hidden'; expanded = false; } function click() { window.open(adInfoUrl, '_blank', 'width=640,height=790,scrollbars=1'); } function tap(e) { e.preventDefault(); if (!expanded) { show(); timeout = setTimeout(hide, 1000); } else { click(); } } function attach(el, event, handler) { if (el.addEventListener) { el.addEventListener(event, handler, false); } else if (el.attachEvent) { el.attachEvent('on' + event, handler); } } attach(adInfo, 'mouseover', show); attach(adInfo, 'mouseout', hide); attach(adInfo, 'mouseup', click); attach(adInfo, 'touchend', tap); attach(adInfoOver, 'mouseover', show); attach(adInfoOver, 'mouseout', hide); attach(adInfoOver, 'mouseup', click); attach(adInfoOver, 'touchend', tap); targetElement.appendChild(adInfo); targetElement.appendChild(adInfoOver); } if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', createAdChoicesIcons); } else if (document.readyState === 'interactive') { window.addEventListener('load', createAdChoicesIcons); } else { createAdChoicesIcons(); } } handleIframeResizing(); handleAdInjection(); handleAdChoicesCreation(); })(); <\/script>`;
            
            if (toggleValue === 'yes') {
                document.getElementById('output').value = pre_string + manipulatedString + dv_string + post_string;
            }
            else {
                document.getElementById('output').value = pre_string + manipulatedString + post_string;
            }
            
            
                
        });

        document.getElementById('copyButton').addEventListener('click', function() {
            const outputField = document.getElementById('output');
            outputField.select();
            document.execCommand('copy');
            alert('Output copied to clipboard!');
        });
    </script>
</body>
</html>
{"version":3,"sources":["../prebid-header.js","webpack://prebid.js/node_modules/dlv/index.js","webpack://prebid.js/node_modules/fun-hooks/no-eval/index.js","webpack://prebid.js/node_modules/dset/dist/index.mjs","webpack://prebid.js/node_modules/klona/json/index.mjs","webpack://prebid.js/webpack/bootstrap","webpack://prebid.js/webpack/runtime/chunk loaded","webpack://prebid.js/webpack/runtime/compat get default export","webpack://prebid.js/webpack/runtime/define property getters","webpack://prebid.js/webpack/runtime/hasOwnProperty shorthand","webpack://prebid.js/webpack/runtime/jsonp chunk loading","webpack://prebid.js/webpack/startup","webpack://prebid.js/src/Renderer.js","webpack://prebid.js/src/activities/activities.js","webpack://prebid.js/src/activities/activityParams.js","webpack://prebid.js/src/activities/modules.ts","webpack://prebid.js/src/activities/params.js","webpack://prebid.js/src/activities/redactor.ts","webpack://prebid.js/src/activities/rules.js","webpack://prebid.js/src/adRendering.ts","webpack://prebid.js/src/adServerManager.js","webpack://prebid.js/src/adUnits.ts","webpack://prebid.js/src/adapter.js","webpack://prebid.js/src/adapterManager.ts","webpack://prebid.js/src/adapters/bidderFactory.ts","webpack://prebid.js/src/adloader.js","webpack://prebid.js/src/adserver.js","webpack://prebid.js/src/ajax.ts","webpack://prebid.js/src/auction.ts","webpack://prebid.js/src/auctionIndex.js","webpack://prebid.js/src/auctionManager.js","webpack://prebid.js/src/banner.ts","webpack://prebid.js/src/bidTTL.ts","webpack://prebid.js/src/bidderSettings.ts","webpack://prebid.js/src/bidfactory.ts","webpack://prebid.js/src/config.ts","webpack://prebid.js/src/consentHandler.ts","webpack://prebid.js/src/constants.ts","webpack://prebid.js/src/cpmBucketManager.ts","webpack://prebid.js/src/creativeRenderers.js","webpack://prebid.js/src/debugging.js","webpack://prebid.js/src/eventTrackers.js","webpack://prebid.js/src/events.ts","webpack://prebid.js/src/fpd/enrichment.ts","webpack://prebid.js/src/fpd/normalize.js","webpack://prebid.js/src/fpd/oneClient.js","webpack://prebid.js/src/fpd/rootDomain.js","webpack://prebid.js/src/fpd/sua.js","webpack://prebid.js/src/hook.ts","webpack://prebid.js/src/mediaTypes.ts","webpack://prebid.js/src/native.ts","webpack://prebid.js/src/pbjsORTB.ts","webpack://prebid.js/src/prebid.ts","webpack://prebid.js/src/prebidGlobal.ts","webpack://prebid.js/src/refererDetection.ts","webpack://prebid.js/src/secureCreatives.js","webpack://prebid.js/src/storageManager.ts","webpack://prebid.js/src/targeting.ts","webpack://prebid.js/src/userSync.ts","webpack://prebid.js/src/utils.js","webpack://prebid.js/src/utils/cpm.js","webpack://prebid.js/src/utils/focusTimeout.js","webpack://prebid.js/src/utils/gdpr.js","webpack://prebid.js/src/utils/ipUtils.js","webpack://prebid.js/src/utils/objects.ts","webpack://prebid.js/src/utils/perfMetrics.ts","webpack://prebid.js/src/utils/prerendering.ts","webpack://prebid.js/src/utils/promise.ts","webpack://prebid.js/src/utils/reducers.js","webpack://prebid.js/src/utils/ttlCollection.ts","webpack://prebid.js/src/utils/yield.ts","webpack://prebid.js/src/video.ts","webpack://prebid.js/src/videoCache.ts","webpack://prebid.js/libraries/viewport/viewport.js","webpack://prebid.js/libraries/creative-renderer-display/renderer.js","webpack://prebid.js/libraries/appnexusUtils/anKeywords.js","webpack://prebid.js/libraries/appnexusUtils/anUtils.js","webpack://prebid.js/libraries/transformParamsUtils/convertTypes.js","webpack://prebid.js/libraries/keywords/keywords.js","webpack://prebid.js/libraries/chunk/chunk.js","webpack://prebid.js/libraries/categoryTranslationMapping/index.js","webpack://prebid.js/libraries/cmp/cmpClient.js","webpack://prebid.js/libraries/consentManagement/cmUtils.ts","webpack://prebid.js/libraries/ortbConverter/converter.ts","webpack://prebid.js/libraries/ortbConverter/lib/composer.js","webpack://prebid.js/libraries/ortbConverter/lib/mergeProcessors.js","webpack://prebid.js/libraries/ortbConverter/processors/banner.js","webpack://prebid.js/libraries/ortbConverter/processors/default.js","webpack://prebid.js/libraries/ortbConverter/processors/mediaType.js","webpack://prebid.js/libraries/ortbConverter/processors/native.js","webpack://prebid.js/libraries/ortbConverter/processors/video.js","webpack://prebid.js/libraries/gptUtils/gptUtils.js","webpack://prebid.js/libraries/xmlUtils/xmlUtils.js","webpack://prebid.js/libraries/dfpUtils/dfpUtils.js","webpack://prebid.js/libraries/mspa/activityControls.js","webpack://prebid.js/libraries/currencyUtils/currency.js","webpack://prebid.js/libraries/weakStore/weakStore.js","webpack://prebid.js/libraries/pbsExtensions/pbsExtensions.js","webpack://prebid.js/libraries/pbsExtensions/processors/adUnitCode.js","webpack://prebid.js/libraries/pbsExtensions/processors/aliases.js","webpack://prebid.js/libraries/pbsExtensions/processors/eventTrackers.js","webpack://prebid.js/libraries/pbsExtensions/processors/mediaType.js","webpack://prebid.js/libraries/pbsExtensions/processors/params.js","webpack://prebid.js/libraries/pbsExtensions/processors/pbs.js","webpack://prebid.js/libraries/pbsExtensions/processors/requestExtPrebid.js","webpack://prebid.js/libraries/pbsExtensions/processors/video.js","webpack://prebid.js/libraries/domainOverrideToRootDomain/index.js","webpack://prebid.js/modules/adpod.js","webpack://prebid.js/modules/appnexusBidAdapter.js","webpack://prebid.js/modules/consentManagementGpp.ts","webpack://prebid.js/modules/consentManagementTcf.ts","webpack://prebid.js/modules/consentManagementUsp.ts","webpack://prebid.js/modules/conversantBidAdapter.js","webpack://prebid.js/modules/debugging/bidInterceptor.js","webpack://prebid.js/modules/debugging/debugging.js","webpack://prebid.js/modules/debugging/index.js","webpack://prebid.js/modules/debugging/legacy.js","webpack://prebid.js/modules/debugging/pbsInterceptor.js","webpack://prebid.js/modules/debugging/responses.js","webpack://prebid.js/modules/dfpAdServerVideo.js","webpack://prebid.js/modules/gamAdServerVideo.js","webpack://prebid.js/modules/gppControl_usnat.js","webpack://prebid.js/modules/gppControl_usstates.ts","webpack://prebid.js/modules/gptPreAuction.ts","webpack://prebid.js/modules/identityLinkIdSystem.js","webpack://prebid.js/modules/openxBidAdapter.js","webpack://prebid.js/modules/paapi.js","webpack://prebid.js/modules/paapiForGpt.js","webpack://prebid.js/modules/prebidServerBidAdapter/bidderConfig.js","webpack://prebid.js/modules/prebidServerBidAdapter/index.ts","webpack://prebid.js/modules/prebidServerBidAdapter/ortbConverter.js","webpack://prebid.js/modules/publinkIdSystem.js","webpack://prebid.js/modules/sharedIdSystem.ts","webpack://prebid.js/modules/tcfControl.ts","webpack://prebid.js/modules/topLevelPaapi.js","webpack://prebid.js/modules/userId/eids.js","webpack://prebid.js/modules/userId/index.ts","../prebid-footer.js"],"names":["pbjsInstance","getGlobal","moduleCode","Renderer","options","url","config","id","callback","loaded","adUnitCode","renderNow","handlers","cmd","push","func","logError","call","process","render","renderArgs","arguments","runRender","_render","apply","logWarn","isRendererPreferredFromAdUnit","unshift","loadExternalScript","MODULE_TYPE_PREBID","documentContext","bind","install","_ref","prototype","getConfig","setRender","fn","setEventHandlers","handleVideoEvent","_ref2","eventName","logMessage","length","shift","error","isRendererRequired","renderer","executeRenderer","bid","doc","docContext","documentResolver","document","adUnits","adUnit","find","code","adUnitRenderer","hasValidAdUnitRenderer","mediaTypeRenderer","mediaTypes","video","hasValidMediaTypeRenderer","backupOnly","ACTIVITY_ACCESS_DEVICE","ACTIVITY_SYNC_USER","ACTIVITY_ENRICH_UFPD","ACTIVITY_ENRICH_EIDS","ACTIVITY_FETCH_BIDS","ACTIVITY_REPORT_ANALYTICS","ACTIVITY_TRANSMIT_EIDS","ACTIVITY_TRANSMIT_UFPD","ACTIVITY_TRANSMIT_PRECISE_GEO","ACTIVITY_TRANSMIT_TID","LOAD_EXTERNAL_SCRIPT","ACTIVITY_ACCESS_REQUEST_CREDENTIALS","activityParams","activityParamsBuilder","alias","adapterManager","resolveAlias","MODULE_TYPE_BIDDER","MODULE_TYPE_UID","MODULE_TYPE_RTD","MODULE_TYPE_ANALYTICS","ACTIVITY_PARAM_COMPONENT","ACTIVITY_PARAM_COMPONENT_TYPE","ACTIVITY_PARAM_COMPONENT_NAME","ACTIVITY_PARAM_ADAPTER_CODE","ACTIVITY_PARAM_STORAGE_TYPE","ACTIVITY_PARAM_STORAGE_KEY","ACTIVITY_PARAM_STORAGE_WRITE","ACTIVITY_PARAM_S2S_NAME","ACTIVITY_PARAM_SYNC_TYPE","ACTIVITY_PARAM_SYNC_URL","ACTIVITY_PARAM_ANL_CONFIG","moduleType","moduleName","params","defaults","buildActivityParams","Object","assign","hook","ORTB_UFPD_PATHS","map","f","concat","ORTB_EIDS_PATHS","ORTB_GEO_PATHS","ORTB_IPV4_PATHS","ORTB_IPV6_PATHS","redactRule","ruleDef","get","run","root","path","object","property","applies","val","isData","repl","undefined","objectTransformer","rules","forEach","rule","paths","parts","split","tail","pop","join","applyTransform","session","obj","result","_len","args","Array","_key","sessionedApplies","name","head","parent","deepAccess","filter","el","_len2","_key2","hasOwnProperty","keys","appliesWhenActivityDenied","activity","isAllowed","isActivityAllowed","bidRequestTransmitRules","ortb2TransmitRules","Math","round","Number","EPSILON","scrubIPv4","scrubIPv6","redactorFactory","redactOrtb2","redactBidRequest","redactor","ortb2","bidRequest","registerActivityControl","allow","reason","ruleRegistry","logger","prefixLog","registry","getRules","runRule","res","e","component","dupes","DEDUPE_INTERVAL","logResult","msg","deduping","clearTimeout","setTimeout","logInfo","ruleName","priority","pos","findIndex","itemPriority","entry","splice","idx","indexOf","lastPriority","foundAllow","ruleResult","AD_RENDER_FAILED","AD_RENDER_SUCCEEDED","STALE_RENDER","BID_WON","EXPIRED_RENDER","EVENTS","EXCEPTION","AD_RENDER_FAILED_REASON","getBidToRender","adId","forRender","override","PbPromise","resolve","then","auctionManager","findBidByAdId","catch","markWinningBid","parseEventTrackers","eventtrackers","EVENT_TYPE_WIN","TRACKER_METHOD_IMG","triggerPixel","events","addWinningBid","emitAdRenderFail","message","data","emitAdRenderSucceeded","callAdRenderSucceededBidder","adapterCode","bidder","handleCreativeEvent","bidResponse","event","info","handleNativeMessage","_ref3","resizeFn","fireTrackers","fireNativeTrackers","action","width","height","HANDLERS","MESSAGES","EVENT","NATIVE","creativeMessageHandler","deps","type","getRenderingData","ad","adUrl","cpm","originalCpm","instl","AUCTION_PRICE","CLICKTHROUGH","clickUrl","replaceMacros","doRender","_ref4","renderFn","isMainDocument","inIframe","videoBid","mediaType","VIDEO","PREVENT_WRITING_ON_MAIN_DOCUMENT","before","next","bail","handleRender","_ref5","deferRendering","CANNOT_FIND_AD","status","BID_STATUS","RENDERED","suppressStaleRender","filters","isBidNotExpired","suppressExpiredRender","markBidAsRendered","metrics","useMetrics","checkpoint","timeBetween","DEFERRED_RENDER","WeakMap","WINNERS","WeakSet","set","renderIfDeferred","markWinner","has","add","delete","renderAdDirect","fail","frame","defaultView","frameElement","style","messageHandler","adData","write","close","getCreativeRenderer","sendMessage","mkFrame","createIframe","stack","creativeComment","createComment","creativeId","insertElement","MISSING_DOC_OR_ADID","clickThrough","insertLocatorFrame","window","frames","PB_LOCATOR","body","requestAnimationFrame","createInvisibleIframe","appendChild","prebid","registerVideoSupport","videoSupport","adServers","key","REQUESTS","WINS","AUCTIONS","reset","ensureAdUnit","adunit","bidderCode","bidders","incrementer","counter","byBidder","counters","getter","incrementRequestsCounter","incrementBidderRequestsCounter","incrementBidderWinsCounter","incrementAuctionsCounter","getRequestsCounter","getBidderRequestsCounter","getBidderWinsCounter","getAuctionsCounter","Adapter","setBidderCode","getBidderCode","callBids","PBS_ADAPTER_NAME","PARTITIONS","CLIENT","SERVER","dep","redact","_bidderRegistry","_aliasRegistry","_analyticsRegistry","_s2sConfigs","s2sConfig","isArray","getConfigName","configName","s2sActivityParams","ADUNIT_BID_PROPERTIES","getBids","auctionId","bidderRequestId","src","reduce","bids","s2sBid","ortb2Imp","mergeDeep","getDefinedParams","isValidMediaTypes","transactionId","adUnitId","sizes","banner","playerSize","bidId","bid_id","getUniqueIdentifierStr","auctionsCount","bidRequestsCount","bidderRequestsCount","bidderWinsCount","deferBilling","flatten","filterBidsForAdUnit","getS2SBidders","getS2SBidderSet","serverBidders","s2sConfigName","allowedS2SConfigs","includes","getAdUnitCopyForPrebidServer","adUnitsCopy","deepClone","hasModuleBids","s2sBids","b","module","filterBidderlessCalls","getAdUnitCopyForClientAdapters","adUnitsClientCopy","setupAdUnitMediaTypes","labels","s2sConfigs","Set","s2s","enabled","flatMap","_partitionBidders","getBidderCodes","memo","partition","partitionBidders","bidderRegistry","analyticsRegistry","aliasRegistry","makeBidRequests","auctionStart","cbTimeout","ortb2Fragments","auctionMetrics","BEFORE_REQUEST_BIDS","decorateAdUnitsWithNativeParams","uniques","au","isPlainObject","clientBidders","RANDOM","shuffle","refererInfo","getRefererInfo","bidRequests","global","bidderOrtb2","addOrtb2","bidderRequest","fpd","freeze","source","tid","s2sParams","adUnitsS2SCopy","uniquePbsTid","generateUUID","fork","S2S","SRC","timeout","adUnitCopy","validBids","adUnitBid","request","reqBid","adapter","gdprDataHandler","getConsentData","uspDataHandler","gppDataHandler","addBidResponse","doneCb","requestCallbacks","requestBidsTimeout","onTimelyResponse","clientBidderRequests","serverBidderRequests","partitions","uniqueServerBidRequests","serverBidRequest","index","i","s2sAjax","ajaxBuilder","done","adaptersServerSide","s2sAdapter","uniqueServerRequests","s2sBidRequest","ad_units","doneCbs","start","timestamp","timedOut","BID_REQUESTED","runWithBidder","ajax","adapterDone","callbackWithBidder","videoAdapters","registerBidAdapter","bidAdapter","supportedMediaTypes","GDPR_GVLIDS","register","getSpec","gvlid","nativeAdapters","aliasBidAdapter","existingAlias","nonS2SAlias","s2sBidders","newAdapter","getSupportedMediaTypes","constructor","useBaseGvlid","spec","skipPbsAliasing","newBidder","visited","registerAnalyticsAdapter","enableAnalytics","adapterConfig","provider","getBidAdapter","getAnalyticsAdapter","callTimedOutBidders","timedOutBidders","timedOutBidder","getUserConfiguredParams","groupBy","tryCallBidderMethod","callBidWonBidder","triggerBilling","BILLED","EVENT_TYPE_IMPRESSION","internal","callSetTargetingBidder","callBidViewableBidder","callBidderError","param","callDataDeletionRequest","method","target","getBidderMethod","bidderRequests","getBidsRequested","br","invokeBidderMethod","entries","_len3","_key3","seen","COMMON_BID_RESPONSE_KEYS","TIDS","registerBidder","putBidder","aliases","aliasCode","guardTids","memoize","prop","receiver","Reflect","privateAccessProxy","handler","proxy","Proxy","_","v","arg","registerSyncs","configEnabledCallback","tidGuard","adUnitCodesHandled","addBidWithCode","measureTime","isValid","reject","REJECTION_REASON","INVALID","responses","afterAllResponses","BIDDER_DONE","gdprConsent","uspConsent","gppConsent","validBidRequests","adapterMetrics","filterAndWarn","bidRequestMap","processBidderRequests","onRequest","requestObject","BEFORE_BIDDER_HTTP","onResponse","resp","onPaapi","paapiConfig","addPaapiConfig","onError","errorMessage","BIDDER_ERROR","onBid","requestId","isInvalidAlternateBidder","BIDDER_DISALLOWED","originalCurrency","currency","meta","onBidBillable","prebidBid","createBid","pick","INVALID_REQUEST_ID","onCompletion","responseBidder","requestBidder","allowAlternateBidderCodes","bidderSettings","alternateBiddersList","trim","toLowerCase","registerSyncInner","isBidRequestValid","JSON","stringify","RESPONSE_PROPS","wrapCallback","startTiming","stopBefore","requests","buildRequests","requestDone","delayExecution","requestMetrics","addBid","renameWith","onSuccess","response","responseObj","networkDone","parse","headers","headerParser","interpretResponse","err","paapiConfigs","some","paapi","xmlHttpResponse","getResponseHeader","onFailure","debugMode","getParameterByName","DEBUG_MODE","toUpperCase","debugTurnedOn","getOptions","ro","browsingTopics","suppressTopicsEnrollmentWarning","formatGetParameters","success","withCredentials","enableGZipCompression","endpointCompression","callAjax","payload","contentType","isGzipCompressionSupported","compressDataWithGZip","compressedPayload","URL","location","origin","searchParams","href","parseQueryStringParameters","aliasSyncEnabled","getUserSyncs","syncs","iframeEnabled","userSync","canBidderRegisterSync","pixelEnabled","sync","registerSync","bidderDone","validBidSize","parseInt","wratio","hratio","getBidRequest","getMediaTypes","parsedSizes","parseSizesInput","hasValidKeys","bidKeys","every","nativeBidIsValid","isValidVideoBid","n","_requestCache","_approvedLoadExternalJSList","attributes","storedCachedObject","getCacheObject","callbacks","tag","cachedDocObj","cacheObject","requestResource","tagSrc","jptScript","createElement","async","readyState","onreadystatechange","onload","setScriptAttributes","getPPID","fetch","makeRequest","r","o","Request","resource","ctl","AbortController","cancelTimer","abort","signal","GET","POST","CTYPE","processRequestOptions","hasDeviceAccess","toFetchRequest","urlInfo","parseUrl","search","buildUrl","Headers","customHeaders","rqOpts","credentials","isSecureContext","opt","keepalive","fetcherFactory","fetcher","to","pm","finally","req","toXHR","responseText","statusText","xml","getXML","DOMParser","parseFromString","XMLHttpRequest","DONE","responseType","responseURL","responseXML","header","toJSON","attachCallbacks","fetchPm","x","text","xhr","ok","sendBeacon","navigator","syncUsers","AUCTION_STARTED","AUCTION_IN_PROGRESS","AUCTION_COMPLETED","BID_ADJUSTMENT","adjustBids","MAX_REQUESTS_PER_ORIGIN","outstandingRequests","sourceInfo","queuedCalls","resetAuctionState","ob","k","newAuction","adUnitCodes","_adUnits","_labels","_adUnitCodes","_auctionId","_timeout","_timelyRequests","defer","requestsDone","_bidsRejected","_callback","_bidderRequests","_bidsReceived","ttlCollection","startTime","responseTimestamp","ttl","getMinBidCacheTTL","max","_noBids","_winningBids","_auctionStart","_auctionEnd","_timeoutTimer","_auctionStatus","_nonBids","onMinBidCacheTTLChange","refresh","addBidRequests","addBidReceived","addBidRejected","bidsRejected","addNoBid","noBid","addNonBids","seatnonbids","getProperties","auctionEnd","auctionStatus","noBids","bidsReceived","toArray","winningBids","seatNonBids","startAuctionTimer","executeCallback","AUCTION_TIMEOUT","timedOutRequests","rq","BID_TIMEOUT","Date","now","AUCTION_END","bidsBackCallback","groupByPlacement","userSyncConfig","enableOverride","syncDelay","auctionDone","resetBidder","addBidderRequests","dispatch","addBidderRequestsCallback","context","AUCTION_INIT","auctionCallbacks","increment","SRA","runIfOriginHasCapacity","hasCapacity","maxRequests","min","winningBid","setBidTargeting","SEAT_NON_BID","seatnonbid","getWinningBids","getAuctionStart","getAuctionEnd","getTimeout","getAuctionId","getAuctionStatus","getAdUnits","getAdUnitCodes","getBidRequests","getBidsReceived","getNoBids","getNonBids","getFPD","getMetrics","end","promise","ignoreCallbackArg","isValidPrice","PRICE_TOO_HIGH","responsesReady","ready","auctionInstance","outstandingBidsAdded","allAdapterCalledDone","bidderRequestsDone","bidResponseMap","afterBidAdded","handleBidResponse","addCommonResponseProperties","acceptBidResponse","getPreparedBidForAuction","BID_ACCEPTED","tryAddVideoBid","isNativeResponse","setNativeResponseProperties","getAdUnit","addBidToAuction","rejectBidResponse","rejectionReason","BID_REJECTED","auctionOptionsConfig","isEmpty","secondaryBidders","NO_BID","rejected","setupBidTargeting","timeSince","BID_RESPONSE","videoMediaType","originalRequestId","useCacheKey","useLocal","cacheUrl","ignoreBidderCacheKey","storeLocally","OUTSTREAM","videoCacheKey","callPrebidCache","vastUrl","batchAndStore","getBidderRequest","requestTimestamp","parseFloat","ttlBuffer","timeToRespond","bidRenderer","bidObjectMediaType","bidMediaType","mediaTypeGranularity","getMediaTypeGranularity","priceStringsObj","getPriceBucketString","pbLg","low","pbMg","med","pbHg","high","pbAg","auto","pbDg","dense","pbCg","custom","bidObject","keyValues","cpmCheck","dealId","getKeyValueTargetingPairs","adserverTargeting","mediaTypePriceGranularity","getPriceGranularity","granularity","getPriceByGranularity","bidGranularity","GRANULARITY_OPTIONS","AUTO","DENSE","LOW","MEDIUM","HIGH","CUSTOM","getCreativeId","getAdvertiserDomain","advertiserDomains","flat","getDSP","networkId","networkName","getPrimaryCatId","catId","primaryCatId","createKeyVal","value","bidReq","defaultAdserverTargeting","TARGETING_KEYS","BIDDER","AD_ID","PRICE_BUCKET","SIZE","DEAL","SOURCE","FORMAT","ADOMAIN","ACAT","DSP","CRID","getStandardBidderSettings","standardSettings","settingsFor","JSON_MAPPING","ADSERVER_TARGETING","slice","UUID","CACHE_ID","targetingKeyVal","kvPair","CACHE_HOST","hostname","custBidObj","setKeys","getOwn","ownSettingsFor","sendStandardTargeting","targeting","size","getSize","isFn","suppressEmptyKeys","isEmptyStr","bidPriceAdjusted","adjustCpm","bidsByPlacement","maxBidValue","AuctionIndex","getAuctions","getAuction","auction","a","bers","ber","getOrtb2","newAuctionManager","_auctions","onExpiry","getAllWinningBids","pre","post","mgrMethod","mapper","items","allBidsReceived","getAllBidsForAdUnitCode","createAuction","opts","_addAuction","getStandardBidderAdServerTargeting","setStatusForBids","BID_TARGETING_SET","getLastAuctionId","auctions","clearAllAuctions","clear","ORTB_PARAMS","isInteger","isArrayOfNums","isStr","ORTB_BANNER_PARAMS","Map","validateOrtbBannerFields","onInvalidParam","bannerParams","CACHE_TTL_SETTING","TTL_BUFFER","minCacheTTL","listeners","cfg","getBufferedTTL","prev","l","listener","ScopedSettings","getSettings","defaultScope","scope","resolveScope","getScopes","#resolveScope","BD_SETTING_STANDARD","Bid","_bidSrc","identifiers","DEFAULT_DEBUG","DEFAULT_BIDDER_TIMEOUT","DEFAULT_ENABLE_SEND_ALL_BIDS","DEFAULT_DISABLE_AJAX_TIMEOUT","DEFAULT_BID_CACHE","DEFAULT_DEVICE_ACCESS","DEFAULT_MAX_NESTED_IFRAMES","DEFAULT_MAXBID_VALUE","DEFAULT_IFRAMES_CONFIG","FIXED","VALID_ORDERS","DEFAULT_BIDDER_SEQUENCE","ALL_TOPICS","attachProperties","useDefaultValues","values","priceGranularity","customPriceBucket","bidderSequence","auctionOptions","getProp","setProp","defineProperty","enumerable","props","publisherDomain","validatePriceGranularity","hasGranularity","aggregate","item","validateauctionOptions","defineProperties","fromEntries","def","configurable","option","isValidPriceConfig","isBoolean","newConfig","bidderConfig","currBidder","resetConfig","debug","bidderTimeout","enableSendAllBids","useBidCache","deviceAccess","disableAjaxTimeout","maxNestedIframes","maxBid","topics","callSubscribers","topic","_getConfig","curr","merged","base","_getRestrictedConfig","conf","Error","getAnyConfig","accessor","subscribe","readConfig","readAnyConfig","wrapee","getBidderConfig","setConfig","topicalConfig","setDefaults","nl","init","unsubscribe","TOPICS","setBidderConfig","mergeFlag","check","currentConfig","mergeConfig","mergedConfig","mergeBidderConfig","cb","getCurrentBidder","VENDORLESS_GVLID","CONSENT_GDPR","CONSENT_GPP","CONSENT_USP","CONSENT_COPPA","ConsentHandler","dirty","hash","#resolve","generatedTime","enable","setConsentData","time","cyrb53Hash","hashFields","UspConsentHandler","getConsentMeta","consentData","generatedAt","GdprConsentHandler","vendorData","gdprApplies","consentStringSize","tcString","apiVersion","GppConsentHandler","gvlidRegistry","none","modules","coppaDataHandler","getCoppa","ALL_HANDLERS","multiHandler","collector","all","allConsent","PL_CODE","PL_SIZE","PL_BIDS","BD_BIDDER","BD_ID","BD_PL_ID","STATUS","GOOD","SET_TARGETING","REQUEST_BIDS","ADD_AD_UNITS","TCF2_ENFORCEMENT","AUCTION_DEBUG","BID_VIEWABLE","BILLABLE_EVENT","RUN_PAAPI_AUCTION","PBS_ANALYTICS","PAAPI_BID","PAAPI_NO_BID","PAAPI_ERROR","BEFORE_PBS_HTTP","BROWSI_INIT","BROWSI_DATA","NO_AD","EVENT_ID_PATHS","bidWon","DEFAULT_TARGETING_KEYS","NATIVE_KEYS","title","body2","privacyLink","privacyIcon","sponsoredBy","image","icon","displayUrl","cta","rating","address","downloads","likes","phone","price","salePrice","rendererUrl","adTemplate","DEFAULT_ENDPOINT","SYNCED_BIDDERS_KEY","FLOOR_NOT_MET","CANNOT_CONVERT_CURRENCY","DSA_REQUIRED","DSA_MISMATCH","PREBID_NATIVE_DATA_KEYS_TO_ORTB","NATIVE_ASSET_TYPES","sponsored","desc","saleprice","desc2","displayurl","ctatext","NATIVE_IMAGE_TYPES","ICON","MAIN","NATIVE_KEYS_THAT_ARE_NOT_ASSETS","REQUEST","RESPONSE","_defaultPrecision","_lgPriceConfig","_mgPriceConfig","_hgPriceConfig","_densePriceConfig","_autoPriceConfig","customConfig","granularityMultiplier","cpmFloat","isNaN","getCpmStringValue","cpmStr","cap","buckets","bucketFloor","bucket","precision","toFixed","getCpmTarget","bucketMin","roundingFunction","floor","customRoundingFunction","pow","cpmToRound","cpmTarget","invalidRounding","PUC_MIN_VERSION","getCreativeRendererSource","RENDERER","renderers","iframe","srcdoc","contentWindow","DEBUG_KEY","isDebuggingInstalled","installedModules","loadScript","debuggingModuleLoader","alreadyInstalled","script","loading","_installDebugging","debuggingControls","load","getHook","waitForDebugging","disable","getHooks","remove","loadSession","storage","sessionStorage","debugging","getItem","TRACKER_METHOD_JS","eventTrackers","tally","trackersForType","trackersForMethod","TTL_CONFIG","eventTTL","eventsFired","monotonic","previous","allEvents","idPaths","_public","_handlers","_dispatch","utils","eventPayload","idPath","que","eventKeys","eventType","elapsedTime","_checkAvailableEvent","on","emit","off","_handler","addEvents","getEvents","clearEvents","findRootDomain","getWindowTop","getWindowSelf","getHighEntropySUA","getLowEntropySUA","getDocument","oneClient","clientSectionChecker","enrichFPD","promArr","getSUA","tryToGetCdepLabel","sua","cdep","ri","ENRICHMENTS","section","getEnrichments","deepSetValue","device","ext","documentLang","documentElement","lang","langCode","CLIENT_SECTIONS","hasSection","clientEnrichment","winFallback","hints","removeUndef","cookieDeprecationLabel","getValue","site","p","page","ref","win","w","getWinDimensions","screen","h","vpw","vph","getViewportSize","dnt","getDNT","ua","userAgent","language","webdriver","regs","globalPrivacyControl","coppa","domain","parseDomain","noLeadingWww","keywords","querySelector","content","replace","publisher","normalizeFPD","normalizeEIDs","normalizeSchain","normalizer","applyNormalizer","eids","user","eid","candidateSource","candidateEid","deepEqual","schain","extSchain","logPrefix","onlyOneClientSection","found","coreStorage","getCoreStorageManager","fullDomain","host","cookiesAreEnabled","domainParts","rootDomain","continueSearching","startIndex","TEST_COOKIE_NAME","TEST_COOKIE_VALUE","expirationDate","toUTCString","setCookie","getCookie","abs","SUA_SOURCE_UNKNOWN","SUA_SOURCE_LOW_ENTROPY","SUA_SOURCE_HIGH_ENTROPY","SUA_SOURCE_UA_HEADER","HIGH_ENTROPY_HINTS","LOW_ENTROPY_HINTS","lowEntropySUAAccessor","highEntropySUAAccessor","uaData","userAgentData","uaDataToSUA","cache","sorted","from","sort","getHighEntropyValues","toBrandVersion","brand","version","bv","platform","platformVersion","fullVersionList","brands","browsers","mobile","funHooks","QUEUE","readyCtl","setupBeforeHookFnOnce","baseFn","hookFn","submoduleInstallMap","postInstallAllowed","submodules","submodule","wrapHook","wrapper","m","BANNER","ADPOD","ALL_MEDIATYPES","IMAGE","ortb","ver","assets","required","img","wmin","hmin","len","SUPPORTED_TYPES","PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE","inverse","NATIVE_ASSET_TYPES_INVERSE","native","processNativeAdUnitParams","typeIsSupported","isOpenRTBBidRequestValid","nativeParams","nativeOrtbRequest","toOrtbNativeRequest","ids","asset","isOpenRTBAssetValid","isNumber","mimes","protocols","minduration","maxduration","nativeAdUnit","nativeBidder","hasNonNativeBidder","ortbRequest","ortbResponse","toOrtbNativeResponse","isNativeOpenRTBBidValid","bidORTB","bidRequestORTB","link","requiredAssetIds","returnedAssetIds","match","assetId","nativeResponse","legacyPropertiesToOrtbNative","fireClickTrackers","fireImpressionTrackers","runMarkup","mkup","insertHtmlIntoIframe","fetchURL","js","imptrackers","jstracker","clicktrackers","assetIdLinkMap","masterClickTrackers","assetLink","clickTrackers","nativeOrtbResponse","legacyResponse","toLegacyResponse","getAssetValue","getNativeAssets","nativeProps","getNativeRenderingData","nativeKeys","assetsMessage","adObject","renderData","rendererVersion","NATIVE_KEYS_INVERTED","getAssetMessage","getAllAssetsMessage","legacyNativeAssets","privacy","ortbAsset","aspect_ratios","min_width","minWidth","min_height","minHeight","aspectRatios","ar","ratio_width","ratio_height","ratio","aspectratios","gcd","fromOrtbNativeRequest","openRTBRequest","oldNativeObject","Boolean","scale","assetType","prebidAssetName","convertOrtbRequestToProprietaryNative","bidRequestsCopy","legacyNative","useRequestAsset","predicate","titleAsset","imageType","imageAsset","dataAsset","requestAssets","requestAsset","reqAsset","impressionTrackers","jsTrackers","eventTracker","javascriptTrackers","retobj","PROCESSOR_TYPES","PROCESSOR_DIALECTS","IMP","DEFAULT","PBS","types","processorRegistry","processors","registerOrtbProcessor","dialects","dialect","getProcessors","triggerUserSyncs","libLoaded","validateSizes","targLength","cleanSizes","sz","syncOrtb2","fields","ORTB_VIDEO_PARAMS","validator","mediaTypesFieldValue","ortbFieldValue","validateBannerMediaType","validatedAdUnit","bannerSizes","format","formatSizes","expdir","validateVideoMediaType","tarPlayerSizeLen","videoSizes","validateOrtbVideoFields","validateNativeMediaType","checkDeprecated","onDeprecated","legacyNativeKeys","intersection","nativeKey","legacyKey","validateAdUnitPos","isFinite","warning","validateAdUnit","adUnitDef","adUnitSetupChecks","checkAdUnitSetup","validatedAdUnits","validatedBanner","validatedVideo","validatedNative","fillAdUnitDefaults","fillVideoDefaults","logInvocation","addApiMethod","log","getAdserverTargetingForAdUnitCodeStr","getAdserverTargetingForAdUnitCode","transformAdServerTargetingObj","getHighestUnusedBidResponseForAdUnitCode","isBidUsable","getHighestCpm","getAdserverTargeting","getAllTargeting","getConsentMetadata","wrapInBids","arr","currentAuctionId","getNoBidsForAdUnitCode","getBidResponses","getBidResponsesForAdUnitCode","setTargetingForGPTAsync","customSlotMatching","isGptPubadsDefined","setTargetingForGPT","setTargetingForAst","isApntagDefined","renderAd","pbYield","removeAdUnit","requestBids","delegate","reqBidOptions","bidsBackHandler","unit","startAuction","delayIfPrerendering","newMetrics","promiseFactory","Promise","adUnitDefs","tids","adUnitMediaTypes","allBidders","bidderMediaTypes","bidderEligible","unsupportedBidderMessage","adUnitsLen","setLatestAuctionForAdUnit","executeCallbacks","reqBidsConfigObj","runAll","storageCallbacks","enableAnalyticsCallbacks","queue","queued","addAdUnits","eventIdValidators","bidSet","validateEventId","onEvent","offEvent","bidderAdaptor","enableAnalyticsCb","aliasBidder","getAllPrebidWinningBids","getHighestCpmBids","markWinningBidAsUsed","_ref6","analytics","listenMessagesFromCreative","quePush","command","_processQueue","called","processQueue","delayPrerendering","_ref7","pbjs","_pbjsGlobals","registerModule","ensureProtocol","exec","windowProto","protocol","top","noPort","startsWith","substring","getCanonicalUrl","element","detectReferer","getAncestorOrigins","ancestorOrigins","ancestors","currentWindow","bestLocation","bestCanonicalUrl","reachedTop","level","valuesFromAmp","inAmpFrame","hasTopLocation","previousWindow","wasInAmpFrame","currentLocation","crossOrigin","foundLocation","sourceUrl","canonicalUrl","referrer","reverse","isAmp","numIframes","topmostLocation","legacy","referer","cacheWithLocation","canonical","newCanonical","newHref","HANDLER_MAP","handleRenderRequest","handleEventRequest","handleNativeRequest","addEventListener","ev","receiveMessage","getReplier","ports","postMessage","ensureAdId","reply","getResizer","resizeRemoteCreative","getDimension","elmType","getElementByAdUnit","elementStyle","getElementIdBasedOnAdServer","parentDivEle","getElementById","getDfpElementId","isApnGetTagDefined","getAstElementId","slot","googletag","pubads","getSlots","getTargetingKeys","getTargeting","getSlotElementId","astTag","apntag","getTag","targetId","STORAGE_TYPE_LOCALSTORAGE","STORAGE_TYPE_COOKIES","newStorageManager","advertiseKeys","storageType","storageKey","isWrite","mod","curBidder","valid","schedule","operation","expires","sameSite","domainPortion","encodeURIComponent","expiresPortion","isNone","secure","cookie","decodeURIComponent","checkCookieSupport","storageMethods","capName","charAt","backend","hasStorage","setItem","removeItem","findSimilarCookies","keyLike","cookies","separatorIndex","cookieName","getStorageManager","deviceAccessRule","storageAllowedRule","bs","resetData","discloseStorageUse","disclosure","pbTargetingKeys","MAX_DFP_KEYLENGTH","CFG_ALLOW_TARGETING_KEYS","CFG_ADD_TARGETING_KEYS","TARGETING_KEY_CONFIGURATION_ERROR_MSG","TARGETING_KEYS_ARR","isUnusedBid","getHighestCpmBidsFromBidPool","winReducer","adUnitBidLimit","hasModified","winSorter","sortByHighestCpm","dealPrioritization","bucketKey","bucketBids","bidsByBidder","sortByDealAndPriceBucketOrCpm","useCpm","hb_deal","hb_pb","getGPTSlotsForAdUnits","auToSlots","customMatch","isAdUnitCodeMatchingSlot","newTargeting","latestAuctionForAdUnit","resetPresetTargetingAST","currentKeywords","newKeywords","modifyTag","bidLimit","sendAllBids","bidLimitConfigValue","customKeysByUnit","filteredBids","getfilteredBidsAndCustomKeys","bidsSorted","getTargetingLevels","defaultKeys","allowedKeys","addedKeys","getAllowedTargetingKeyValues","flatTargeting","flattenTargeting","auctionKeysThreshold","filterTargetingKeys","targetingSet","resetMap","slots","updateTargetingFromMap","targetingKey","targetingDone","astTargeting","keywordsObj","regex","setKeywords","overrideKeyValue","addBidToTargeting","deals","standardKeys","allowSendAllBidsTargetingKeys","allowedSendAllBidTargeting","targetingValue","getTargetingMap","getBidderTargeting","alwaysIncludeDeals","defaultKeyring","keyDispositions","keyring","isCustom","defaultKey","allowedKey","allowedKeyName","removedKeys","d","filteredTargeting","updatePBTargetingKeys","targetKey","targetKeys","useAllBidsCustomTargeting","getWinningBidTargeting","getAdUnitTargeting","getCustomBidTargeting","adUnitIsEligible","cpmAllowed","isPreferredDeal","getCustomKeys","truncKey","convertKeysToQueryForm","keyMap","queryString","encodedKeyPair","targetingCopy","targetingMap","accMap","currMap","adUnitQueryString","querySize","c","accumulator","getOldestHighestCpmBid","bidCacheEnabled","filterFunction","isBidFromLastAuction","filterFunctionResult","cacheFilter","bidFilter","latestTargetedAuctionId","winners","getStandardKeys","winner","acc","bidderCodeTargetingKey","bidderCodeTargeting","newBid","customKeysForUnit","getTargetingObj","getTargetingValues","aut","s","targetingValues","USERSYNC_DEFAULT_CONFIG","syncEnabled","filterSettings","syncsPerBidder","auctionDelay","newUserSync","publicApi","getDefaultQueue","hasFiredBidder","numAdapterBids","permittedPixels","usConfig","fs","regRule","syncType","fireSyncs","browserSupportsCookies","loadIframes","fireImagePixels","forEachFire","bidderName","trackingPixelUrl","iframeUrl","insertUserSyncIframe","removeImagePixelsForBidder","iframeSyncBidderName","imageSync","imageSyncBidderName","incrementAdapterBids","shouldBidderBeBlocked","filterConfig","isFilterConfigValid","activeConfig","biddersToFilter","filterType","checkForFiltering","include","exclude","activeConfigName","filterField","biddersField","bidderInList","isSafariBrowser","consoleExists","console","consoleLogExists","consoleInfoExists","consoleWarnExists","warn","consoleErrorExists","eventEmitter","windowDimensions","_setEventEmitter","emitFn","emitEvent","lastCheckTimestamp","CHECK_INTERVAL_MS","resetWinDimensions","canAccessWindowTop","availWidth","availHeight","colorDepth","innerHeight","innerWidth","outerWidth","outerHeight","visualViewport","clientWidth","clientHeight","scrollTop","scrollLeft","createTrackPixelIframeHtml","getWindowLocation","parseQS","formatQS","prebidInternal","getPrebidInternal","getIncrementalInteger","count","random","toString","substr","placeholder","_getRandomData","crypto","getRandomValues","Uint8Array","getBidIdParameter","paramsObj","queryObj","getOwnPropertyNames","sizesToSizeTuples","isValidGPTSingleSize","sizeObj","sizeTupleToSizeString","parseGPTSingleSizeArray","singleSize","sizeTupleToRtbSize","parseGPTSingleSizeArrayToRtbSize","self","decorateLog","prefix","decorate","label","color","hasConsoleLogger","DEFAULTS","border","hspace","vspace","marginWidth","marginHeight","scrolling","frameBorder","allowtransparency","attrs","display","str","_each","contains","_map","elm","asLastChildChild","parentEl","getElementsByTagName","insertBeforeEl","firstChild","insertBefore","waitForElementToLoad","timer","onLoad","removeEventListener","Image","htmlCode","open","iframeHtml","div","innerHTML","createTrackPixelHtml","encode","encodeURI","escapedUrl","encodeMacroURI","macros","matchAll","macro","encodeUri","sandbox","arry","array","temp","isSafeFrameWindow","ws","$sf","getSafeframeGeometry","geom","test","subs","RegExp","replaceAuctionPrice","replaceClickThrough","clicktag","getTime","getPerformanceNow","performance","getDomLoadingDuration","domLoadingDuration","timing","navigationStart","domLoading","cookieEnabled","numRequiredCalls","numCalls","xs","rv","SUPPORTED_MEDIA_TYPES","SUPPORTED_STREAM_TYPES","bidderData","doNotTrack","msDoNotTrack","compareCodeAndSlot","getAdUnitPath","cleanObj","properties","newObj","newProp","query","criteria","parsed","noDecodeWholeURL","qsAsString","decodeSearchAsString","port","pathname","obj1","obj2","checkTypes","isArr1","isArr2","keys1","keys2","mergeDeepHelper","seed","imul","opA","opB","h1","h2","ch","charCodeAt","safeJSONParse","safeJSONEncode","memoized","cacheKey","getUnixTimestampFromNow","timeValue","timeUnit","acceptableUnits","multiplication","convertObjectToArray","setAttribute","binarySearch","left","right","middle","hasNonSerializableProperty","checkedObjects","setOnAny","collection","extractDomainFromHost","pageHost","domains","triggerNurlWithCpm","nurl","cachedResult","CompressionStream","encoder","TextEncoder","encodedData","compressedStream","Blob","stream","pipeThrough","compressedBlob","Response","blob","compressedArrayBuffer","arrayBuffer","adjustAlternateBids","bidCpmAdjustment","outOfFocusStart","timeOutOfFocus","suspendedTimeouts","trackTimeOutOfFocus","hidden","setTimerId","setFocusTimeout","milliseconds","timerId","newId","hasPurpose1Consent","purpose","consents","ip","ones","ipParts","mask","maskedIP","part","klona","tStr","tFn","tNumb","tObject","tBoolean","isA","_t","CONFIG_TOGGLE","NODES","wrapFn","after","metricsFactory","mkNode","makeNode","mkTimer","makeTimer","mkRenamer","rename","nodes","makeMetrics","dfWalk","visit","edge","node","getTimestamp","setMetric","names","follow","inEdge","outEdge","propagate","stopPropagation","groups","timestamps","metric","ts","elapsed","startCheckpoint","endCheckpoint","stopAfter","measureHookTime","stopTiming","orig","untimed","includeGroups","otherMetrics","other","addParent","renameFn","newSibling","parents","nullMetrics","nop","empty","nullTimer","nullNode","hookTimer","_this","timedAuctionHook","timedBidResponseHook","isDelayEnabled","prerendering","once","pbSetTimeout","greedySetTimeout","GreedyPromise","delay","delayMs","resolver","invoker","resolveFn","rejectFn","simpleCompare","keyCompare","reverseCompare","compare","tiebreakCompare","compares","cmp","minimum","maximum","cpmCompare","timestampCompare","getLatestHighestCpmBid","slack","pendingPurge","markForPurge","expiry","nextPurge","task","reschedulePurge","cnt","mkEntry","thisCohort","currentCohort","update","delta","field","currentCall","thisCall","Symbol","iterator","scheduler","yield","INSTREAM","plcmt","placement","playbackmethod","conflict","videoParams","checkVideoBidSetup","vastXml","ttlBufferInSeconds","vastLocalCache","wrapURI","uri","impTrackerURLs","impressions","trk","toStorageRequest","vastValue","getVastXml","ttlWithBuffer","ttlseconds","bidid","aid","customCacheKey","shimStorageCallback","responseBody","vastImpUrl","store","getAjax","requestData","puts","getCacheUrl","bidVastUrl","createObjectURL","assignVastUrlAndCacheId","_internal","storeBatch","batch","cacheIds","cacheId","uuid","batchSize","batchTimeout","cleanupHandler","revokeObjectURL","batchingCache","batches","debouncing","noTimeout","batchFunc","getViewportCoordinates","scrollY","scrollX","bottom","ORTB_SEGTAX_KEY_MAP","ORTB_SEG_PATHS","getValueString","defaultValue","transformBidderParamKeywords","paramName","arrs","kw","convertKeywordStringToANMap","keyStr","convertKeywordsToANMap","kwarray","kwPair","getANMapFromOrtbKeywords","getAllOrtbKeywords","getANKewyordParamFromMaps","anKeywordMaps","kwMap","getANMapFromOrtbIASKeywords","iasBrandSafety","iasArray","getANKeywordParam","anKeywordsMaps","getANMapFromOrtbSegments","ortbSegData","ortbSegsArrObj","segObj","segtax","segment","seg","convertCamelToUnderscore","y","appnexusAliases","fill","newArray","valueToPush","tryConvertType","typeToConvert","convertTypes","ORTB_KEYWORDS_PATHS","suffix","mergeKeywords","commaSeparatedKeywords","kwds","extraCommaSeparatedKeywords","chunk","ceil","APPNEXUS_CATEGORY_MAPPING","MODE_MIXED","MODE_RETURN","MODE_CALLBACK","cmpClient","apiName","apiArgs","callbackArgs","mode","cmpCallbacks","callName","cmpDataPkgName","handleMessage","json","callId","findCMP","cmpFrame","isDirect","resolveParams","preamble","haveCb","client","invokeCMPDirect","ret","invokeCMPFrame","consentManagementHook","loadConsentData","SEEN","requestBidsHook","lookupConsentData","consentDataHandler","setupCmp","cmpTimeout","actionTimeout","getNullConsent","timeoutHandle","provisionalConsent","cmpLoaded","setProvisionalConsent","resetTimeout","configParser","namespace","displayName","parseConsentData","cmpHandlers","DEFAULT_CMP","DEFAULT_CONSENT_TIMEOUT","cdLoader","staticConsentData","attachActivityParams","activate","getConsentConfig","cmConfig","cmpHandler","cmpApi","lookup","cd","ortbConverter","defaultContext","defaultProcessors","overrides","imp","REQ_CTX","builder","wrapperFn","builderFn","errorHandler","build","compose","buildImp","buildRequest","imps","buildBidResponse","buildResponse","bidResponses","toORTB","ctx","impContext","reqContext","fromORTB","augmentContext","extraParams","impsById","seatbid","impid","mergeProcessors","DEFAULT_PROCESSORS","SORTED","components","fns","fillBannerImp","topframe","bannerResponseProcessor","createPixel","fillBannerResponse","adm","onlyOneClient","tmax","setResponseMediaType","seatBidId","cur","dealid","creative_id","crid","burl","exp","netRevenue","adomain","dsa","cat","secondaryCatIds","attr","fillNativeImp","fillNativeResponse","fillVideoImp","fillVideoResponse","ORTB_MTYPES","mtype","nativeReq","nativeRequest","playerWidth","playerHeight","slotInfoCache","clearSlotInfoCache","isSlotMatchingAdUnitCode","setKeyValue","setTargeting","getGptSlotForAdUnitCode","matchingSlot","getGptSlotInfoForAdUnitCode","gptSlot","divId","taxonomies","getSignals","signals","getSegments","taxonomy","sections","datum","subscribeToGamEvent","subscribeToGamSlotRenderEndedEvent","XML_MIME_TYPE","XMLUtil","parser","serializer","getParser","getSerializer","XMLSerializer","xmlString","serialize","xmlDoc","serializeToString","DEFAULT_DFP_PARAMS","env","gdfp_req","output","unviewed_position_start","DFP_ENDPOINT","gdprParams","gdpr","consentString","gdpr_consent","addtlConsent","addtl_consent","SENSITIVE_DATA_GEO","isApplicable","isBasicConsentDenied","PersonalDataConsents","KnownChildSensitiveDataConsents","MspaCoveredTransaction","sensitiveNoticeIs","isConsentDenied","oo","notice","SharingNotice","SharingOptOut","isTransmitUfpdConsentDenied","sensitiveFlags","cannotBeInScope","allExceptGeo","mustHaveConsent","cardinality","isInVersion","Version","SensitiveDataProcessing","isTransmitGeoConsentDenied","geoConsent","CONSENT_RULES","mspaRule","sids","getConsent","denies","applicableSids","applicableSections","sid","consent","flatSection","subsections","reduceRight","subsection","setupRules","api","normalizeConsent","registerRule","unreg","parsedSections","ur","convertCurrency","amount","fromCur","toCur","bestEffort","currencyNormalizer","toCurrency","convert","currencyCompare","normalize","weakStore","auctionStore","pbsExtensions","PBS_PROCESSORS","setImpAdUnitCode","setRequestExtPrebidAliases","am","gvlId","addEventTrackers","winUrl","extPrebidMediaType","setImpBidParams","extPrebid","setRequestExtPrebid","extPrebidChannel","setRequestExtPrebidChannel","extPrebidAliases","videoCache","setBidResponseVideoCache","seat","adaptercode","pbsBidId","extPrebidMeta","pbsWinTrackers","serverSideStats","errors","responsetimemillis","serverName","clientName","auctiontimestamp","includewinners","includebidderkeys","channel","hb_uuid","hb_cache_host","cacheHost","hb_cache_path","cachePath","domainOverrideToRootDomain","domainElements","topDomain","testCookie","nextDomain","TARGETING_KEY_PB_CAT_DUR","TARGETING_KEY_CACHE_ID","queueTimeDelay","queueSizeLimit","bidCacheRegistry","createBidCacheRegistry","setupRegistrySlot","bidStorage","queueDispatcher","createDispatcher","initialCacheKey","removeBid","getQueueDispatcher","setupInitialCacheKey","getInitialCacheKey","timeoutDuration","bidListArr","killQueue","callbackFn","firePrebidCacheCall","getPricePartForAdpodKey","pricePart","prioritizeDeals","adpodDealPrefix","attachPriceIndustryDurationKeyToBid","brandCategoryExclusion","duration","pcd","category","updateBidQueue","bidListIter","callDispatcher","removeBidsFromStorage","bidList","callPrebidCacheHook","videoConfig","adServerCatId","checkAdUnitSetupHook","goodAdUnits","errMsg","sizeConfig","adPodDurationSec","durationRangeSec","range","checkBidDuration","buffer","bidDuration","adUnitRanges","requireExactDuration","nextHighestRange","durationBucket","checkVideoBidSetupHook","durationSeconds","isBidGood","adpodSetConfig","bidQueueTimeDelay","bidQueueSizeLimit","adpod","initAdpodHooks","callPrebidCacheAfterAuction","successfulCachedBids","sortByPricePerSecond","codes","adPodAdUnits","getAdPodAdUnits","competiveExclusionEnabled","deferCachingSetting","deferCachingEnabled","getBidsForAdpod","getExclusiveBids","otherBids","highPriorityDealBids","bidDealTier","minDealTier","adPodTargeting","adPodDurationSeconds","bidsToCache","bidsSuccessfullyCached","groupedBids","compareOn","sharedMethods","shareAdpodUtilities","addMethods","__r0","BIDDER_CODE","URL_SIMPLE","VIDEO_TARGETING","VIDEO_RTB_TARGETING","USER_PARAMS","APP_DEVICE_PARAMS","DEBUG_PARAMS","DEBUG_QUERY_PARAM_MAP","VIDEO_MAPPING","playback_method","NATIVE_MAPPING","requiredParams","MAX_IMPS_PER_REQUEST","SCRIPT_TAG_START","VIEWABILITY_URL_START","VIEWABILITY_FILE_NAME","GVLID","ORTB2_DEVICE_TYPE","MOBILE_TABLET","PERSONAL_COMPUTER","CONNECTED_TV","PHONE","TABLET","CONNECTED_DEVICE","SET_TOP_BOX","OOH_DEVICE","ORTB2_DEVICE_TYPE_MAP","placementId","placement_id","member","invCode","inv_code","tags","bidToTag","userObjBid","hasUserInfo","userObj","uparam","segs","appDeviceObjBid","hasAppDeviceInfo","appDeviceObj","app","appIdObjBid","hasAppId","appIdObj","appid","debugObj","debugObjParams","debugCookieName","debugCookie","qparam","qval","debugBidRequest","hasDebug","memberIdBid","hasMemberId","omidSupport","hasOmidSupport","sdk","omidpn","omidpv","member_id","convertORTB2DeviceDataToAppNexusDeviceObject","anAuctionKeywords","auctionKeywords","brand_category_uniqueness","consent_string","consent_required","ac","acStr","us_privacy","gpp","gppString","gpp_sid","refererinfo","rd_ref","rd_top","rd_ifs","rd_stk","pubPageUrl","rd_can","referrer_detection","hasAdPodBid","hasAdPod","adPodBid","adPodTags","createAdPodRequest","nonPodTags","userIdAsEids","uids","uid","tmp","rti_partner","pubDsaObj","dsaObj","dsaKey","transparency","tpData","tpObj","dsaparams","publisher_id","formatRequest","serverResponse","serverBid","rtbBid","getRtbBid","ad_type","parseMediaType","debug_info","debugHeader","debugText","syncOptions","imgList","strIsAppnexusViewabilityScript","regexMatchUrlStart","viewUrlStartInStr","regexMatchFileName","fileNameInStr","endpointUrl","clonedPayload","payloadString","newRenderer","rendererOptions","renderer_id","renderer_url","outstreamRender","impression","ended","deal_id","appnexus","buyerMemberId","buyer_member_id","dealPriority","deal_priority","dealCode","deal_code","advertiser_id","advertiserId","setupDChain","dchain","complete","bsid","brand_id","brandId","rtb","player_width","player_height","notify_url","videoContext","brand_category_id","dealTier","duration_ms","asset_url","adResponse","ads","nativeAd","viewScript","viewability","prebidParams","javascript_trackers","privacy_link","click_trackers","impression_trackers","main_img","customImage1","image1","customImage2","image2","customImage3","image3","customImage4","image4","customImage5","image5","customIcon1","icon1","customIcon2","icon2","customIcon3","icon3","customIcon4","icon4","customIcon5","icon5","customSocialIcon1","socialicon1","customSocialIcon2","socialicon2","customSocialIcon3","socialicon3","customSocialIcon4","socialicon4","customSocialIcon5","socialicon5","customTitle1","title1","customTitle2","title2","customTitle3","title3","customTitle4","title4","customTitle5","title5","customBody1","body1","customBody2","customBody3","body3","customBody4","body4","customBody5","body5","customCta1","ctatext1","customCta2","ctatext2","customCta3","ctatext3","customCta4","ctatext4","customCta5","ctatext5","customDisplayUrl1","displayurl1","customDisplayUrl2","displayurl2","customDisplayUrl3","displayurl3","customDisplayUrl4","displayurl4","customDisplayUrl5","displayurl5","customSocialUrl1","socialurl1","customSocialUrl2","socialurl2","customSocialUrl3","socialurl3","customSocialUrl4","socialurl4","customSocialUrl5","socialurl5","trackers","impression_urls","tracker","paramKey","convertedKey","transformSizes","primary_size","ad_types","adUnitOverride","pair","forceCreativeId","force_creative_id","allow_smaller_sizes","use_pmt_rule","use_payment_rule","disable_psa","bidFloor","getBidFloor","reserve","position","mediaTypePos","traffic_source_code","private_sizes","supply_type","pub_click","pubclick","ext_inv_code","external_imp_id","auKeywords","gpid","buildNativeRequest","layouts","hb_source","require_asset_url","frameworks","apiTmp","startdelay","contextVal","getContextFromPlcmt","getContextFromPlacement","getContextFromStartDelay","custom_renderer_present","requestSizes","ortbPlacement","ortbStartDelay","ortbPlcmt","hasOmid","bidderParams","numberOfPlacements","getAdPodPlacementNumber","maxDuration","tagToDuplicate","divider","chunked","setVideoProperty","minAllowedDuration","requestKey","isImageAsset","privacy_supported","hidedfpContainer","elementId","querySelectorAll","setProperty","hideSASIframe","nextSibling","localName","ANOutstreamVideo","tagId","tag_id","handleOutstreamRendererEvents","adType","getFloor","ortb2DeviceData","_device","useragent","devicetype","make","model","os","os_version","osv","ppi","pxratio","consentConfig","GPPError","GPPClient","mkCmp","INST","pending","initialized","pingData","updateWhenReady","gppVersion","cmpStatus","isCMPReady","updateConsent","nextUpdate","signalStatus","lookupIabConsent","cmpCallMap","cmpData","toConsentData","gppData","resetConsentData","parseConfig","setConsentConfig","consentManagement","enrichFPDHook","gdprScope","dsaPlatform","CMP_VERSION","cmpResponseCallback","tcfData","eventStatus","consentObject","checkData","cmpConsentObject","tcfConfig","usp","getTCData","defaultGdprScope","setOrtbAdditionalConsent","addtl","DEFAULT_CONSENT_API","USPAPI_VERSION","consentAPI","consentTimeout","uspCallMap","lookupUspConsent","lookupStaticConsentData","processUspData","handleUspApiResponseCallbacks","uspResponse","afterEach","usPrivacy","consentDataCallback","consentResponse","uspString","callbackHandler","isDone","extraArgs","enableConsentManagement","storeUspConsentData","getUSPData","configFromUser","setSiteId","site_id","converter","at","bidfloor","displaymanager","displaymanagerver","copyOptProperty","videoData","isVideoRequest","makeBidUrl","ortbBids","pixels","urls","fsyncs","psyncs","endpoint","dst","dstName","floorObj","bidurl","white_label_url","BidInterceptor","DEFAULT_RULE_OPTIONS","serializeConfig","ruleDefs","isSerializable","serializable","updateConfig","intercept","ruleNo","no","matcher","when","replacer","paapiReplacer","matchDef","matches","candidate","cVal","replDef","replFn","responseDefaults","responseResolvers","isDebug","paapiDef","wrap","configs","remainder","callDone","mockResponse","mockPaapi","interceptorHooks","bidInterceptor","enableDebugging","debugConfig","fromSession","resetHooks","removeHooks","addHooks","disableDebugging","saveDebuggingConfig","getStorage","sessionLoader","getHookFn","interceptor","registerBidInterceptor","interceptBids","bidderBidInterceptor","cbs","pbsBidInterceptor","makePbsInterceptor","addBidResponseBound","addBidderRequestsBound","addBidResponseHook","addBidderRequestsHook","bidExcluded","overrideObj","bidderExcluded","applyBidOverrides","bidObj","bidType","overrideBid","includedBidderRequests","onFledge","responseArgs","signalResponse","bidIds","ORTB_NATIVE_ASSET_TYPES","repeat","parentId","player","jwplayer","setup","advertising","outstream","endstate","loadAdTag","loadAdXml","mapDefaultNativeOrtbAsset","vasttag","buildDfpVideoUrl","buildGamVideoUrl","buildVideoUrl","VAST_TAG_URI_TAGNAME","urlComponents","buildUrlFromAdserverUrlComponents","derivedParams","correlator","urlSearchComponent","urlSzParam","encodedCustomParams","getCustParams","cust_params","queryParams","DEFAULT_GAM_PARAMS","descriptionUrl","getDescriptionUrl","description_url","ppid","min_ad_duration","max_ad_duration","vpos","vconp","vpa","click","vpmute","muted","talkie","ppsj","btoa","PublisherProvidedTaxonomySignals","GAM_ENDPOINT","notifyTranslationModule","urlCustParams","allTargetingData","allTargeting","prebidTargetingSet","hb_cache_id","publisherTargetingSet","encodedParams","getVastForLocallyCachedBids","gamVastWrapper","localCacheMap","xmlUtil","vastAdTagUriElement","textContent","uuidExp","matchResult","uuidCandidates","blobUrl","base64BlobContent","getBase64BlobContent","cdata","createCDATASection","blobContent","dataUrl","setupDone","FIELDS","Gpc","SaleOptOutNotice","SharingOptOutNotice","TargetedAdvertisingOptOutNotice","SensitiveDataProcessingOptOutNotice","SensitiveDataLimitUseNotice","SaleOptOut","TargetedAdvertisingOptOut","MspaOptOutOptionMode","MspaServiceProviderMode","nullify","move","norm","remap","dest","moved","scalarMinorsAreChildren","original","normalized","NORMALIZATIONS","cc","DEFAULT_SID_MAPPING","getSections","allSIDs","ov","normalizeAs","handles","gppConf","mspa","MODULE_NAME","_currentConfig","hooksAdded","getSegmentsFn","getSignalsFn","getSignalsArrayByAuctionsIds","auctionIds","getSignalsIntersection","allValues","commonElements","subArray","getAuctionsIdsFromTargeting","appendGptSlots","customGptSlotMatching","adUnitMap","adUnitPaths","matchingAdUnitCode","adserver","adslot","sanitizeSlotPath","gptConfig","mcmEnabled","defaultPreAuction","adServerAdSlot","adUnitPath","gptSlots","makeBidRequestsHook","useDefaultPreAuction","customPreAuction","adserverSlot","setPpsConfigFromTargetingSet","auctionsIds","pps","handleSetGptConfig","moduleConfig","gptPreAuction","liverampEnvelopeName","identityLinkSubmodule","decode","getId","configParams","pid","hasGdpr","gdprConsentString","gppSectionId","hasGpp","ats","retrieveEnvelope","envelope","setEnvelopeSource","getEnvelope","getEnvelopeFromStorage","atype","notUse3P","setRetryCookie","setTime","rawEnvelope","getDataFromLocalStorage","atob","e2","bidderVersion","REQUEST_URL","SYNC_URL","DEFAULT_PH","methods","tagid","divid","customParams","customFloor","bc","pv","delDomain","response_template_name","dsp_id","buyer_id","fledgeAuctionConfigs","auctionSignals","setBidFloor","bidfloorcur","hasDelDomainOrPlatform","videoRequests","isVideoBidRequest","bannerAndNativeRequests","isBannerBidRequest","isNativeBidRequest","createRequest","isNotVideoOrNativeBid","nbr","pixelType","queryParamStrings","syncUrl","MODULE","USED","registerSubmodule","submod","getPAAPIConfig","expandFilters","configsForAuction","pendingConfigsForAuction","pendingBuyersForAuction","deferredConfigsForAuction","attachHandlers","isFledgeSupported","detachHandlers","addPaapiConfigHook","addPaapiData","markForFledge","parallelPaapiProcessing","buildPAAPIParams","adAuctionHeadersHook","onAuctionInit","onAuctionEnd","adAuctionHeaders","getStaticSignals","requestedSize","getRequestedSize","getSlotSignals","bestBid","floors","minFloor","buyersToAuctionConfigs","igbRequests","merge","mergeBuyers","componentSeller","partitioners","compact","partitionBuyers","expand","partitionBuyersByBidder","auctionConfig","separateAuctions","igbs","setFPD","adUnitsByCode","allReqs","pendingConfigs","pendingBuyers","append","getComponentSellerConfigId","deferredConfigs","adUnitsWithConfigs","forThisAdUnit","configsById","auctionConfigs","resolveSignals","deferrals","default","_ref8","_ref9","configId","matchingConfigs","newConfigs","hasDeferredConfigs","parallel","_ref0","componentAuctions","onAuctionConfig","_ref1","getConfigId","seller","getFledgeConfig","storePendingData","igb","pbs","perBuyerSignals","interestGroupBuyers","buyer","checkOrigin","IGB_TO_CONFIG","ps","maxbid","buyers","_ref10","igbField","configField","_ref11","_ref12","includeBlanks","_ref13","ae","defaultForSlots","getPAAPISize","_ref14","_ref15","igsAe","igs","extAe","biddable","NAVIGATOR_APIS","bidderReq","AsyncPAAPIParam","ASYNC_SIGNALS","validatePartialConfig","REQUIRED_SYNC_SIGNALS","validate","invalid","_ref16","callAdapterApi","makeDeferrals","promises","buildPAAPIConfigs","partialConfigs","requestsById","_ref17","getDeferredConfig","deferredConfig","partialConfig","immediate","_ref18","_len4","_key4","_len5","_key5","paapiParameters","_ref19","resolved","_ref20","setImpExtAe","parseExtIgi","paapiResponseParser","igi","impCtx","parseExtPrebidFledge","fledge","auctionconfigs","setResponsePaapiConfigs","setTargetingHook","setTargetingHookFactory","setPaapiConfig","setPAAPIConfigForGPT","slotConfigurator","PREVIOUSLY_SET","setComponentAuction","configsBySeller","sellers","componentAuction","configKey","getPAAPISizeHook","SUPPORTED_SIZES","sizeStrings","preferredSize","sizeStr","setPAAPIConfigFactory","setGptConfig","getPBSBidderConfig","replaceArrays","mergedValue","extractEids","bySource","conflicts","getEntry","consolidateEids","globalEntries","bidderEntries","permissions","replaceEids","requestedBidders","consolidated","removeEids","permission","bidderEids","premergeFpd","TYPE","_syncCount","s2sDefaultConfig","syncTimeout","allowUnknownBidderCodes","adapterOptions","syncUrlModifier","ortbNative","maxTimeout","updateConfigDefaults","validateConfigRequiredProps","formatUrlParams","p1Consent","noP1Consent","conUrl","validateConfig","activeBidders","setS2sConfig","resetSyncedStatus","queueSync","bidderCodes","userSyncFilterSettings","ifrm","account","accountId","userSyncLimit","coopSync","jsonPayload","getMatchingConsentUrl","syncEndpoint","responseJson","doAllSyncs","bidder_status","thisSync","no_cookie","doPreBidderSync","usersync","doBidderSync","doClientSideSyncs","clientAdapter","urlProp","hasPurpose","PrebidServer","baseAdapter","defaultVendor","s2sAliases","syncBidders","processPBSRequest","seatNonBidData","atagData","getAnalyticsFlags","atag","buildPBSRequest","requestJson","interpretPBSResponse","getAtagData","getNonBidData","returnallbidstatus","DEFAULT_S2S_TTL","DEFAULT_S2S_CURRENCY","DEFAULT_S2S_NETREVENUE","BIDDER_SPECIFIC_REQUEST_PROPS","getMinimumFloor","getMin","candidates","PBS_CONVERTER","proxyBidRequest","pbsData","proxyBidderRequest","tmaxmax","dooh","transmitTids","actualBidRequests","actualBidderRequests","bid_Id","impId","extBidfloor","setExtFloor","requestImp","getRedactor","fpdConfigs","chains","schains","chainBidders","impIds","proxyBidRequests","defaultTtl","PUBLINK_COOKIE","PUBLINK_S2S_COOKIE","PUBLINK_REQUEST_PATH","PUBLINK_REFRESH_PATH","isHex","publinkIdUrl","storedId","mpn","mpv","deh","api_key","apikey","publink","usPrivacyString","makeCallback","prebidCallback","handleResponse","getlocalValue","getData","hasLocalStorage","publinkIdSubmodule","publinkId","localValue","COOKIE","LOCAL_STORAGE","OPTOUT_NAME","PUB_COMMON_ID","readValue","expValue","getIdCallback","pubcid","pixelUrl","getStoredId","queuePixelCallback","targetUrl","hasOptedOut","sharedIdSystemSubmodule","aliasName","disclosureURL","idObj","create","extendId","extend","domainOverride","inserter","STRICT_STORAGE_ENFORCEMENT","ACTIVE_RULES","feature","CONSENT_PATHS","CONFIGURABLE_RULES","enforcePurpose","enforceVendor","vendorExceptions","basicAds","personalizedAds","eidsRequireP4Consent","measurement","transmitPreciseGeo","storageBlocked","biddersBlocked","analyticsBlocked","ufpdBlocked","eidsBlocked","geoBlocked","strictStorageEnforcement","GVLID_LOOKUP_PRIORITY","RULE_NAME","RULE_HANDLES","LI_PURPOSES","PUBLISHER_LI_PURPOSES","getGvlid","fallbackFn","gvlMapping","getGvlidFromAnalyticsAdapter","shouldEnforce","getConsentOrLI","acceptLI","legitimateInterests","purposeNo","liPurposes","vendor","validateRules","currentModule","ruleOptions","vendorConsentRequred","softVendorExceptions","gdprRule","checkConsent","blocked","gvlidFallback","modName","singlePurposeGdprRule","exceptPrebidModules","ruleFn","accessDeviceRule","syncUserRule","enrichEidsRule","fetchBidsRule","reportAnalyticsRule","ufpdRule","transmitEidsRule","check2to10Consent","pno","defaultBehavior","p4Behavior","transmitPreciseGeoRule","emitTCF2FinalResults","formatSet","st","tcf2FinalResults","setEnforcementConfig","checkIfCredentialsAllowed","uninstall","paapiBids","topLevelSeller","renderPaapiHook","renderOverrideHook","getRenderingDataHook","markWinningBidHook","isPaapiBid","bidIfRenderable","urn","forRenderStack","parsePaapiAdId","bidPm","overrideWinner","getPAAPIBids","paapiBid","overriddenAdId","getBaseAuctionConfig","resolveToConfig","autorun","parsePaapiSize","px","getPaapiAdId","raa","runAdAuction","topLevelPAAPI","EID_CONFIG","createEidObject","userIdData","subModuleKey","eidConf","uidExt","mm","eidExt","createEidsArray","bidRequestUserId","eidConfigs","allEids","collect","getEids","priorityMap","idValues","getActiveModule","PBJS_USER_ID_OPTOUT_NAME","initializedSubmodules","configRegistry","idPriority","submoduleRegistry","timeoutID","ppidSource","configListener","uidMetrics","submoduleMetrics","setSubmoduleRegistry","updateEIDConfig","cookieSetter","storageMgr","expiration","setValueInCookie","valueStr","expiresStr","getConsentHash","refreshInSeconds","setValueInLocalStorage","mgr","setDataInLocalStorage","setStoredValue","enabledStorageTypes","COOKIE_SUFFIXES","deleteValueFromCookie","HTML5_SUFFIXES","deleteValueFromLocalStorage","removeDataFromLocalStorage","deleteStoredValue","populateEnabledStorageTypes","getValueFromCookie","storedKey","getValueFromLocalStorage","storedValueExp","getStoredValue","storedValue","processSubmoduleCallbacks","priorityMaps","moduleDone","callbackCompleted","updatePPID","getIds","getPrimaryIds","primaryIds","orderByPriority","getKeys","getIdMod","keyItems","keyPriority","mkPriorityMaps","combined","addtlModules","refreshing","modulesById","activeModuleGetter","useGlobals","allowed","listModules","allNonGlobal","bidderFilters","combo","enrichEids","globalFpd","bidderFpd","globalMods","bidderMods","globalEids","moduleMap","addIdData","INIT_CANCELED","idSystemInitializer","mkDelay","startInit","startCallbacks","cancel","initMetrics","cancelAndTry","race","initModules","allModules","checkRefs","timeConsent","hooksReady","initSubmodules","modWithCb","submoduleNames","auctionEndHandler","cbModules","sm","initIdSystem","getUserIdsAsEids","matchingUserId","userID","ppidValue","startAuctionHook","getUserIdsAsync","aliasEidsHook","addedStartAuctionHook","getUserIds","getUserIdsAsEidBySource","sourceName","getEncryptedEidsForSource","encrypt","customFunction","retryOnCancel","eidsSignals","customSignals","encryptSignals","encryptedSig","registerSignalSources","providers","secureSignalProviders","existingIds","networkCode","encryptedSignalSources","registerDelay","customFunc","collectorFunction","initParams","refreshUserIds","userIds","bytes","String","fromCharCode","consentChanged","storedConsent","populateSubmoduleId","forceRefresh","refreshNeeded","storedDate","extendedConfig","setPublisherProvidedId","canUseStorage","carry","getConfiguredStorageTypes","hasValidStorageTypes","storageTypes","ALL_STORAGE_TYPES","getValidSubmoduleConfigs","canUseLocalStorage","localStorageIsEnabled","canUseCookies","STORAGE_PURPOSES","identifier","purposes","maxAgeSeconds","cookieRefresh","generateSubmoduleContainers","prevSubmodules","autoRefresh","retainConfig","matchesName","submoduleConfig","configItem","previousSubmodule","newSubmoduleContainer","refreshIds","updateSubmodules","updatedContainers","requestDataDeletion","coreGetPPID","updateIdPriority","idPriorityConfig","aliasToName","onDataDeletionRequest","attachIdSystem","normalizePromise","enforceStorageTypeRule","userIdsConfig","enforceStorageType","unregisterEnforceStorageTypeRule","submodulesToRefresh","resetUserIds"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACLe;AACf;AACA,aAAa,gBAAgB;AAC7B;AACA;AACA;AACA;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,2BAA2B;;AAE3B;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA,aAAa,0BAA0B;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,6BAA6B;AAC7B,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA,WAAW;AACX,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;AC7TO;AACP;AACA;AACA;AACA;AACA;AACA,4HAA4H;AAC5H;AACA;;;;;;;;;;;;;;;ACRO;AACP;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;UC3BA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;;;;WCzBA;WACA;WACA;WACA;WACA,+BAA+B,wCAAwC;WACvE;WACA;WACA;WACA;WACA,iBAAiB,qBAAqB;WACtC;WACA;WACA,kBAAkB,qBAAqB;WACvC;WACA;WACA,KAAK;WACL;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;;;;WC3BA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;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EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,UAAU;EAChB,IAAI,EAAE,QAAQ;EACd,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,IAAI,EAAE,SAAS;EACf,KAAK,EAAE,SAAS;EAChB,KAAK,EAAE,SAAS;EAChB,KAAK,EAAE,SAAS;EAChB,KAAK,EAAE,SAAS;EAChB,KAAK,EAAE,QAAQ;EACf,KAAK,EAAE,QAAQ;EACf,KAAK,EAAE,QAAQ;EAC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","file":"prebid.js","sourcesContent":["/* prebid.js v10.5.0-pre\r\nUpdated: 2025-07-24\r\nModules: adpod, userId, conversantBidAdapter, appnexusBidAdapter, openxBidAdapter, publinkIdSystem, sharedIdSystem, identityLinkIdSystem, dfpAdServerVideo, consentManagementTcf, consentManagementGpp, gppControl_usnat, gppControl_usstates, consentManagementUsp, tcfControl, gptPreAuction, prebidServerBidAdapter, debugging, paapi, topLevelPaapi, paapiForGpt */\r\n\r\nif (!window.pbjs || !window.pbjs.libLoaded) {\r\n (function(){","export default function dlv(obj, key, def, p, undef) {\n\tkey = key.split ? key.split('.') : key;\n\tfor (p = 0; p < key.length; p++) {\n\t\tobj = obj ? obj[key[p]] : undef;\n\t}\n\treturn obj === undef ? def : obj;\n}\n","/*\n* @license MIT\n* Fun Hooks v1.1.0\n* (c) @snapwich\n*/\ncreate.SYNC = 1;\ncreate.ASYNC = 2;\ncreate.QUEUE = 4;\n\nvar packageName = \"fun-hooks\";\n\nvar defaults = Object.freeze({\n  ready: 0\n});\n\nvar hookableMap = new WeakMap();\n\nfunction rest(args, skip) {\n  return Array.prototype.slice.call(args, skip);\n}\n\nfunction runAll(queue) {\n  var queued;\n  // eslint-disable-next-line no-cond-assign\n  while ((queued = queue.shift())) {\n    queued();\n  }\n}\n\nfunction create(config) {\n  var hooks = {};\n  var postReady = [];\n\n  config = Object.assign({}, defaults, config);\n\n  function dispatch(arg1, arg2) {\n    if (typeof arg1 === \"function\") {\n      return hookFn.call(null, \"sync\", arg1, arg2);\n    } else if (typeof arg1 === \"string\" && typeof arg2 === \"function\") {\n      return hookFn.apply(null, arguments);\n    } else if (typeof arg1 === \"object\") {\n      return hookObj.apply(null, arguments);\n    }\n  }\n\n  var ready;\n  if (config.ready) {\n    dispatch.ready = function() {\n      ready = true;\n      runAll(postReady);\n    };\n  } else {\n    ready = true;\n  }\n\n  function hookObj(obj, props, objName) {\n    var walk = true;\n    if (typeof props === \"undefined\") {\n      props = Object.getOwnPropertyNames(obj).filter(prop => !prop.match(/^_/));\n      walk = false;\n    }\n    var objHooks = {};\n    var doNotHook = [\"constructor\"];\n    do {\n      props.forEach(function(prop) {\n        var parts = prop.match(/(?:(sync|async):)?(.+)/);\n        var type = parts[1] || \"sync\";\n        var name = parts[2];\n        if (\n          !objHooks[name] &&\n          typeof obj[name] === \"function\" &&\n          !(doNotHook.indexOf(name) !== -1)\n        ) {\n          var fn = obj[name];\n          objHooks[name] = obj[name] = hookFn(\n            type,\n            fn,\n            objName ? [objName, name] : undefined\n          );\n        }\n      });\n      obj = Object.getPrototypeOf(obj);\n    } while (walk && obj);\n    return objHooks;\n  }\n\n  /**\n   * Navigates a string path to return a hookable function.  If not found, creates a placeholder for hooks.\n   * @param {(Array<string> | string)} path\n   */\n  function get(path) {\n    var parts = Array.isArray(path) ? path : path.split(\".\");\n    return parts.reduce(function(memo, part, i) {\n      var item = memo[part];\n      var installed = false;\n      if (item) {\n        return item;\n      } else if (i === parts.length - 1) {\n        if (!ready) {\n          postReady.push(function() {\n            if (!installed) {\n              // eslint-disable-next-line no-console\n              console.warn(\n                packageName +\n                  \": referenced '\" +\n                  path +\n                  \"' but it was never created\"\n              );\n            }\n          });\n        }\n        return (memo[part] = newHookable(function(fn) {\n          memo[part] = fn;\n          installed = true;\n        }));\n      }\n      return (memo[part] = {});\n    }, hooks);\n  }\n\n  function newHookable(onInstall) {\n    var before = [];\n    var after = [];\n    var generateTrap = function() {};\n\n    var api = {\n      before: function(hook, priority) {\n        return add.call(this, before, \"before\", hook, priority);\n      },\n      after: function(hook, priority) {\n        return add.call(this, after, \"after\", hook, priority);\n      },\n      getHooks: function(match) {\n        var hooks = before.concat(after);\n        if (typeof match === \"object\") {\n          hooks = hooks.filter(function(entry) {\n            return Object.keys(match).every(function(prop) {\n              return entry[prop] === match[prop];\n            });\n          });\n        }\n        try {\n          Object.assign(hooks, {\n            remove: function() {\n              hooks.forEach(function(entry) {\n                entry.remove();\n              });\n              return this;\n            }\n          });\n        } catch (e) {\n          console.error(\n            \"error adding `remove` to array, did you modify Array.prototype?\"\n          );\n        }\n        return hooks;\n      },\n      removeAll: function() {\n        return this.getHooks().remove();\n      }\n    };\n\n    var meta = {\n      install: function(type, fn, generate) {\n        this.type = type;\n        generateTrap = generate;\n        generate(before, after);\n        onInstall && onInstall(fn);\n      }\n    };\n\n    // store meta data related to hookable. use `api.after` since `api` reference is not available on our proxy.\n    hookableMap.set(api.after, meta);\n\n    return api;\n\n    function add(store, type, hook, priority) {\n      var entry = {\n        hook: hook,\n        type: type,\n        priority: priority || 10,\n        remove: function() {\n          var index = store.indexOf(entry);\n          if (index !== -1) {\n            store.splice(index, 1);\n            generateTrap(before, after);\n          }\n        }\n      };\n      store.push(entry);\n      store.sort(function(a, b) {\n        return b.priority - a.priority;\n      });\n      generateTrap(before, after);\n      return this;\n    }\n  }\n\n  function hookFn(type, fn, name) {\n    // check if function has already been wrapped\n    var meta = fn.after && hookableMap.get(fn.after);\n    if (meta) {\n      if (meta.type !== type) {\n        throw packageName + \": recreated hookable with different type\";\n      } else {\n        return fn;\n      }\n    }\n\n    var hookable = name ? get(name) : newHookable();\n\n    var trap;\n\n    var handlers = {\n      get: function(target, prop) {\n        return hookable[prop] || Reflect.get.apply(Reflect, arguments);\n      }\n    };\n\n    if (!ready) {\n      postReady.push(setTrap);\n    }\n\n    var hookedFn = new Proxy(fn, handlers);\n\n    hookableMap.get(hookedFn.after).install(type, hookedFn, generateTrap);\n\n    return hookedFn;\n\n    // eslint-disable-next-line no-redeclare\n    function generateTrap(before, after) {\n      var order = [];\n      var targetIndex;\n      if (before.length || after.length) {\n        before.forEach(addToOrder);\n        // placeholder for target function wrapper\n        targetIndex = order.push(undefined) - 1;\n        after.forEach(addToOrder);\n        trap = function(target, thisArg, args) {\n          var localOrder = order.slice();\n          var curr = 0;\n          var result;\n          var callback =\n            type === \"async\" &&\n            typeof args[args.length - 1] === \"function\" &&\n            args.pop();\n          function bail(value) {\n            if (type === \"sync\") {\n              result = value;\n            } else if (callback) {\n              callback.apply(null, arguments);\n            }\n          }\n          function next(value) {\n            if (localOrder[curr]) {\n              var args = rest(arguments);\n              next.bail = bail;\n              args.unshift(next);\n              return localOrder[curr++].apply(thisArg, args);\n            }\n            if (type === \"sync\") {\n              result = value;\n            } else if (callback) {\n              callback.apply(null, arguments);\n            }\n          }\n          localOrder[targetIndex] = function() {\n            var args = rest(arguments, 1);\n            if (type === \"async\" && callback) {\n              delete next.bail;\n              args.push(next);\n            }\n            var result = target.apply(thisArg, args);\n            if (type === \"sync\") {\n              next(result);\n            }\n          };\n          next.apply(null, args);\n          return result;\n        };\n      } else {\n        trap = undefined;\n      }\n      setTrap();\n\n      function addToOrder(entry) {\n        order.push(entry.hook);\n      }\n    }\n\n    function setTrap() {\n      if (\n        ready ||\n        (type === \"sync\" && !(config.ready & create.SYNC)) ||\n        (type === \"async\" && !(config.ready & create.ASYNC))\n      ) {\n        handlers.apply = trap;\n      } else if (type === \"sync\" || !(config.ready & create.QUEUE)) {\n        handlers.apply = function() {\n          throw packageName + \": hooked function not ready\";\n        };\n      } else {\n        handlers.apply = function() {\n          var args = arguments;\n          postReady.push(function() {\n            hookedFn.apply(args[1], args[2]);\n          });\n        };\n      }\n    }\n  }\n\n  dispatch.get = get;\n  return dispatch;\n}\n\n/* global module */\nmodule.exports = create;\n","export function dset(obj, keys, val) {\n\tkeys.split && (keys=keys.split('.'));\n\tvar i=0, l=keys.length, t=obj, x, k;\n\twhile (i < l) {\n\t\tk = ''+keys[i++];\n\t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n\t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n\t}\n}\n","export function klona(val) {\n\tvar k, out, tmp;\n\n\tif (Array.isArray(val)) {\n\t\tout = Array(k=val.length);\n\t\twhile (k--) out[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\treturn out;\n\t}\n\n\tif (Object.prototype.toString.call(val) === '[object Object]') {\n\t\tout = {}; // null\n\t\tfor (k in val) {\n\t\t\tif (k === '__proto__') {\n\t\t\t\tObject.defineProperty(out, k, {\n\t\t\t\t\tvalue: klona(val[k]),\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true,\n\t\t\t\t\twritable: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tout[k] = (tmp=val[k]) && typeof tmp === 'object' ? klona(tmp) : tmp;\n\t\t\t}\n\t\t}\n\t\treturn out;\n\t}\n\n\treturn val;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"prebid-core\": 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"pbjsChunk\"] = self[\"pbjsChunk\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [\"chunk-core\",\"viewport\",\"creative-renderer-display\"], () => (__webpack_require__(\"./src/prebid.js\")))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n","import { loadExternalScript } from './adloader.js';\r\nimport {\r\n  logError, logWarn, logMessage\r\n} from './utils.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport { MODULE_TYPE_PREBID } from './activities/modules.js';\r\n\r\nconst pbjsInstance = getGlobal();\r\nconst moduleCode = 'outstream';\r\n\r\n/**\r\n * @typedef {object} Renderer\r\n *\r\n * A Renderer stores some functions which are used to render a particular Bid.\r\n * These are used in Outstream Video Bids, returned on the Bid by the adapter, and will\r\n * be used to render that bid unless the Publisher overrides them.\r\n */\r\n\r\nexport function Renderer(options) {\r\n  const { url, config, id, callback, loaded, adUnitCode, renderNow } = options;\r\n  this.url = url;\r\n  this.config = config;\r\n  this.handlers = {};\r\n  this.id = id;\r\n  this.renderNow = renderNow;\r\n  this.adUnitCode = adUnitCode;\r\n\r\n  // a renderer may push to the command queue to delay rendering until the\r\n  // render function is loaded by loadExternalScript, at which point the the command\r\n  // queue will be processed\r\n  this.loaded = loaded;\r\n  this.cmd = [];\r\n  this.push = func => {\r\n    if (typeof func !== 'function') {\r\n      logError('Commands given to Renderer.push must be wrapped in a function');\r\n      return;\r\n    }\r\n    this.loaded ? func.call() : this.cmd.push(func);\r\n  };\r\n\r\n  // bidders may override this with the `callback` property given to `install`\r\n  this.callback = callback || (() => {\r\n    this.loaded = true;\r\n    this.process();\r\n  });\r\n\r\n  // use a function, not an arrow, in order to be able to pass \"arguments\" through\r\n  this.render = function () {\r\n    const renderArgs = arguments\r\n    const runRender = () => {\r\n      if (this._render) {\r\n        this._render.apply(this, renderArgs)\r\n      } else {\r\n        logWarn(`No render function was provided, please use .setRender on the renderer`);\r\n      }\r\n    }\r\n\r\n    if (isRendererPreferredFromAdUnit(adUnitCode)) {\r\n      logWarn(`External Js not loaded by Renderer since renderer url and callback is already defined on adUnit ${adUnitCode}`);\r\n      runRender();\r\n    } else if (renderNow) {\r\n      runRender();\r\n    } else {\r\n      // we expect to load a renderer url once only so cache the request to load script\r\n      this.cmd.unshift(runRender) // should render run first ?\r\n      loadExternalScript(url, MODULE_TYPE_PREBID, moduleCode, this.callback, this.documentContext);\r\n    }\r\n  }.bind(this); // bind the function to this object to avoid 'this' errors\r\n}\r\n\r\n/**\r\n * @param {{}} options\r\n * @return {Renderer}\r\n */\r\nRenderer.install = function({ url, config, id, callback, loaded, adUnitCode, renderNow }) {\r\n  return new Renderer({ url, config, id, callback, loaded, adUnitCode, renderNow });\r\n};\r\n\r\nRenderer.prototype.getConfig = function() {\r\n  return this.config;\r\n};\r\n\r\nRenderer.prototype.setRender = function(fn) {\r\n  this._render = fn;\r\n};\r\n\r\nRenderer.prototype.setEventHandlers = function(handlers) {\r\n  this.handlers = handlers;\r\n};\r\n\r\nRenderer.prototype.handleVideoEvent = function({ id, eventName }) {\r\n  if (typeof this.handlers[eventName] === 'function') {\r\n    this.handlers[eventName]();\r\n  }\r\n\r\n  logMessage(`Prebid Renderer event for id ${id} type ${eventName}`);\r\n};\r\n\r\n/*\r\n * Calls functions that were pushed to the command queue before the\r\n * renderer was loaded by `loadExternalScript`\r\n */\r\nRenderer.prototype.process = function() {\r\n  while (this.cmd.length > 0) {\r\n    try {\r\n      this.cmd.shift().call();\r\n    } catch (error) {\r\n      logError(`Error processing Renderer command on ad unit '${this.adUnitCode}':`, error);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Checks whether creative rendering should be done by Renderer or not.\r\n * @param {Object} renderer Renderer object installed by adapter\r\n * @returns {Boolean}\r\n */\r\nexport function isRendererRequired(renderer) {\r\n  return !!(renderer && (renderer.url || renderer.renderNow));\r\n}\r\n\r\n/**\r\n * Render the bid returned by the adapter\r\n * @param {Object} renderer Renderer object installed by adapter\r\n * @param {Object} bid Bid response\r\n * @param {Document} doc context document of bid\r\n */\r\nexport function executeRenderer(renderer, bid, doc) {\r\n  let docContext = null;\r\n  if (renderer.config && renderer.config.documentResolver) {\r\n    docContext = renderer.config.documentResolver(bid, document, doc);// a user provided callback, which should return a Document, and expect the parameters; bid, sourceDocument, renderDocument\r\n  }\r\n  if (!docContext) {\r\n    docContext = document;\r\n  }\r\n  renderer.documentContext = docContext;\r\n  renderer.render(bid, renderer.documentContext);\r\n}\r\n\r\nfunction isRendererPreferredFromAdUnit(adUnitCode) {\r\n  const adUnits = pbjsInstance.adUnits;\r\n  const adUnit = adUnits.find(adUnit => {\r\n    return adUnit.code === adUnitCode;\r\n  });\r\n\r\n  if (!adUnit) {\r\n    return false\r\n  }\r\n\r\n  // renderer defined at adUnit level\r\n  const adUnitRenderer = adUnit?.renderer;\r\n  const hasValidAdUnitRenderer = !!(adUnitRenderer && adUnitRenderer.url && adUnitRenderer.render);\r\n\r\n  // renderer defined at adUnit.mediaTypes level\r\n  const mediaTypeRenderer = adUnit?.mediaTypes?.video?.renderer;\r\n  const hasValidMediaTypeRenderer = !!(mediaTypeRenderer && mediaTypeRenderer.url && mediaTypeRenderer.render)\r\n\r\n  return !!(\r\n    (hasValidAdUnitRenderer && !(adUnitRenderer.backupOnly === true)) ||\r\n    (hasValidMediaTypeRenderer && !(mediaTypeRenderer.backupOnly === true))\r\n  );\r\n}\r\n","/**\r\n * Activity (that are relevant for privacy) definitions\r\n *\r\n * ref. https://docs.google.com/document/d/1dRxFUFmhh2jGanzGZvfkK_6jtHPpHXWD7Qsi6KEugeE\r\n * & https://github.com/prebid/Prebid.js/issues/9546\r\n */\r\n\r\n/**\r\n * accessDevice: some component wants to read or write to localStorage or cookies.\r\n */\r\nexport const ACTIVITY_ACCESS_DEVICE = 'accessDevice';\r\n/**\r\n * syncUser: A bid adapter wants to run a user sync.\r\n */\r\nexport const ACTIVITY_SYNC_USER = 'syncUser';\r\n/**\r\n * enrichUfpd: some component wants to add user first-party data to bid requests.\r\n */\r\nexport const ACTIVITY_ENRICH_UFPD = 'enrichUfpd';\r\n/**\r\n * enrichEids: some component wants to add user IDs to bid requests.\r\n */\r\nexport const ACTIVITY_ENRICH_EIDS = 'enrichEids';\r\n/**\r\n * fetchBid: a bidder wants to bid.\r\n */\r\nexport const ACTIVITY_FETCH_BIDS = 'fetchBids';\r\n\r\n/**\r\n * reportAnalytics: some component wants to phone home with analytics data.\r\n */\r\nexport const ACTIVITY_REPORT_ANALYTICS = 'reportAnalytics';\r\n\r\n/**\r\n * some component wants access to (and send along) user IDs\r\n */\r\nexport const ACTIVITY_TRANSMIT_EIDS = 'transmitEids'\r\n\r\n/**\r\n * transmitUfpd: some component wants access to (and send along) user FPD\r\n */\r\nexport const ACTIVITY_TRANSMIT_UFPD = 'transmitUfpd';\r\n\r\n/**\r\n * transmitPreciseGeo: some component wants access to (and send along) geolocation info\r\n */\r\nexport const ACTIVITY_TRANSMIT_PRECISE_GEO = 'transmitPreciseGeo';\r\n\r\n/**\r\n * transmit TID: some component wants access ot (and send along) transaction IDs\r\n */\r\nexport const ACTIVITY_TRANSMIT_TID = 'transmitTid';\r\n\r\n/**\r\n * loadExternalScript: adLoader.js is allowed to load external script\r\n */\r\nexport const LOAD_EXTERNAL_SCRIPT = 'loadExternalScript';\r\n\r\n/**\r\n * accessRequestCredentials: setting withCredentials flag in ajax request config\r\n */\r\nexport const ACTIVITY_ACCESS_REQUEST_CREDENTIALS = 'accessRequestCredentials';\r\n","import adapterManager from '../adapterManager.js';\r\nimport {activityParamsBuilder} from './params.js';\r\n\r\n/**\r\n * Utility function for building common activity parameters - broken out to its own\r\n * file to avoid circular imports.\r\n */\r\nexport const activityParams = activityParamsBuilder((alias) => adapterManager.resolveAlias(alias));\r\n","export const MODULE_TYPE_PREBID = 'prebid';\r\nexport const MODULE_TYPE_BIDDER = 'bidder';\r\nexport const MODULE_TYPE_UID = 'userId';\r\nexport const MODULE_TYPE_RTD = 'rtd';\r\nexport const MODULE_TYPE_ANALYTICS = 'analytics';\r\nexport type ModuleType = typeof MODULE_TYPE_PREBID\r\n    | typeof MODULE_TYPE_BIDDER\r\n    | typeof MODULE_TYPE_UID\r\n    | typeof MODULE_TYPE_RTD\r\n    | typeof MODULE_TYPE_ANALYTICS;\r\n","import {MODULE_TYPE_BIDDER} from './modules.js';\r\nimport {hook} from '../hook.js';\r\n\r\n/**\r\n * Component ID - who is trying to perform the activity?\r\n * Relevant for all activities.\r\n */\r\nexport const ACTIVITY_PARAM_COMPONENT = 'component';\r\nexport const ACTIVITY_PARAM_COMPONENT_TYPE = ACTIVITY_PARAM_COMPONENT + 'Type';\r\nexport const ACTIVITY_PARAM_COMPONENT_NAME = ACTIVITY_PARAM_COMPONENT + 'Name';\r\n\r\n/**\r\n * Code of the bid adapter that `componentName` is an alias of.\r\n * May be the same as the component name.\r\n *\r\n * relevant for all activities, but only when componentType is 'bidder'.\r\n */\r\nexport const ACTIVITY_PARAM_ADAPTER_CODE = 'adapterCode';\r\n\r\n/**\r\n * Storage type - either 'html5' or 'cookie'.\r\n * Relevant for: accessDevice\r\n */\r\nexport const ACTIVITY_PARAM_STORAGE_TYPE = 'storageType';\r\n\r\n/**\r\n * Storage key - cookie name or localStorage key.\r\n * Relevant for: accessDevice\r\n */\r\nexport const ACTIVITY_PARAM_STORAGE_KEY = 'storageKey'\r\n\r\n/**\r\n * True if attempting to write to device storage; false otherwise (e.g. when reading from or checking availability of storage).\r\n * Relevant for: accessDevice\r\n */\r\nexport const ACTIVITY_PARAM_STORAGE_WRITE = 'write';\r\n\r\n/**\r\n * s2sConfig[].configName, used to identify a particular s2s instance\r\n * relevant for: fetchBids, but only when component is 'prebid.pbsBidAdapter'\r\n */\r\nexport const ACTIVITY_PARAM_S2S_NAME = 'configName';\r\n/**\r\n * user sync type - 'iframe' or 'pixel'\r\n * relevant for: syncUser\r\n */\r\nexport const ACTIVITY_PARAM_SYNC_TYPE = 'syncType'\r\n/**\r\n * user sync URL\r\n * relevant for: syncUser\r\n */\r\nexport const ACTIVITY_PARAM_SYNC_URL = 'syncUrl';\r\n/**\r\n * Configuration options for analytics adapter - the argument passed to `enableAnalytics`.\r\n * Relevant for: reportAnalytics\r\n * @private\r\n * @constant\r\n * @type {string}\r\n */\r\nexport const ACTIVITY_PARAM_ANL_CONFIG = '_config';\r\n\r\nexport function activityParamsBuilder(resolveAlias) {\r\n  return function activityParams(moduleType, moduleName, params) {\r\n    const defaults = {\r\n      [ACTIVITY_PARAM_COMPONENT_TYPE]: moduleType,\r\n      [ACTIVITY_PARAM_COMPONENT_NAME]: moduleName,\r\n      [ACTIVITY_PARAM_COMPONENT]: `${moduleType}.${moduleName}`\r\n    };\r\n    if (moduleType === MODULE_TYPE_BIDDER) {\r\n      defaults[ACTIVITY_PARAM_ADAPTER_CODE] = resolveAlias(moduleName);\r\n    }\r\n    return buildActivityParams(Object.assign(defaults, params));\r\n  }\r\n}\r\n\r\nexport const buildActivityParams = hook('sync', params => params);\r\n","import {deepAccess} from '../utils.js';\r\nimport {config} from '../config.js';\r\nimport {isActivityAllowed, registerActivityControl} from './rules.js';\r\nimport {\r\n  ACTIVITY_TRANSMIT_EIDS,\r\n  ACTIVITY_TRANSMIT_PRECISE_GEO,\r\n  ACTIVITY_TRANSMIT_TID,\r\n  ACTIVITY_TRANSMIT_UFPD\r\n} from './activities.js';\r\nimport { scrubIPv4, scrubIPv6 } from '../utils/ipUtils.js';\r\n\r\nexport const ORTB_UFPD_PATHS = [\r\n  'data',\r\n  'ext.data',\r\n  'yob',\r\n  'gender',\r\n  'keywords',\r\n  'kwarray',\r\n  'id',\r\n  'buyeruid',\r\n  'customdata'\r\n].map(f => `user.${f}`).concat('device.ext.cdep');\r\nexport const ORTB_EIDS_PATHS = ['user.eids', 'user.ext.eids'];\r\nexport const ORTB_GEO_PATHS = ['user.geo.lat', 'user.geo.lon', 'device.geo.lat', 'device.geo.lon'];\r\nexport const ORTB_IPV4_PATHS = ['device.ip']\r\nexport const ORTB_IPV6_PATHS = ['device.ipv6']\r\n\r\n/**\r\n * @typedef TransformationRuleDef\r\n * @property {name}\r\n * @property {Array[string]} paths dot-separated list of paths that this rule applies to.\r\n * @property {function(*): boolean} applies a predicate that should return true if this rule applies\r\n * (and the transformation defined herein should be applied). The arguments are those passed to the transformation function.\r\n * @property {name} a name for the rule; used to debounce calls to `applies` (and avoid excessive logging):\r\n * if a rule with the same name was already found to apply (or not), this one will (or won't) as well.\r\n */\r\n\r\n/**\r\n * @typedef RedactRuleDef A rule that removes, or replaces, values from an object (modifications are done in-place).\r\n * @augments TransformationRuleDef\r\n * @property {function(*): *} get? substitution functions for values that should be redacted;\r\n *  takes in the original (unredacted) value as an input, and returns a substitute to use in the redacted\r\n *  version. If it returns undefined, or this option is omitted, protected paths will be removed\r\n *  from the redacted object.\r\n */\r\n\r\n/**\r\n * @param {RedactRuleDef} ruleDef\r\n * @return {TransformationRule}\r\n */\r\nexport function redactRule(ruleDef) {\r\n  return Object.assign({\r\n    get() {},\r\n    run(root, path, object, property, applies) {\r\n      const val = object && object[property];\r\n      if (isData(val) && applies()) {\r\n        const repl = this.get(val);\r\n        if (repl === undefined) {\r\n          delete object[property];\r\n        } else {\r\n          object[property] = repl;\r\n        }\r\n      }\r\n    }\r\n  }, ruleDef)\r\n}\r\n\r\n/**\r\n * @typedef TransformationRule\r\n * @augments TransformationRuleDef\r\n * @property {function} run rule logic - see `redactRule` for an example.\r\n */\r\n\r\n/**\r\n * @typedef {Function} TransformationFunction\r\n * @param object object to transform\r\n * @param ...args arguments to pass down to rule's `apply` methods.\r\n */\r\n\r\n/**\r\n * Return a transformation function that will apply the given rules to an object.\r\n *\r\n * @param {Array[TransformationRule]} rules\r\n * @return {TransformationFunction}\r\n */\r\nexport function objectTransformer(rules) {\r\n  rules.forEach(rule => {\r\n    rule.paths = rule.paths.map((path) => {\r\n      const parts = path.split('.');\r\n      const tail = parts.pop();\r\n      return [parts.length > 0 ? parts.join('.') : null, tail]\r\n    })\r\n  })\r\n  return function applyTransform(session, obj, ...args) {\r\n    const result = [];\r\n    const applies = sessionedApplies(session, ...args);\r\n    rules.forEach(rule => {\r\n      if (session[rule.name] === false) return;\r\n      for (const [head, tail] of rule.paths) {\r\n        const parent = head == null ? obj : deepAccess(obj, head);\r\n        result.push(rule.run(obj, head, parent, tail, applies.bind(null, rule)));\r\n        if (session[rule.name] === false) return;\r\n      }\r\n    })\r\n    return result.filter(el => el != null);\r\n  }\r\n}\r\n\r\nexport function sessionedApplies(session, ...args) {\r\n  return function applies(rule) {\r\n    if (!session.hasOwnProperty(rule.name)) {\r\n      session[rule.name] = !!rule.applies(...args);\r\n    }\r\n    return session[rule.name];\r\n  }\r\n}\r\n\r\nexport function isData(val) {\r\n  return val != null && (typeof val !== 'object' || Object.keys(val).length > 0)\r\n}\r\n\r\nexport function appliesWhenActivityDenied(activity, isAllowed = isActivityAllowed) {\r\n  return function applies(params) {\r\n    return !isAllowed(activity, params);\r\n  };\r\n}\r\n\r\nfunction bidRequestTransmitRules(isAllowed = isActivityAllowed) {\r\n  return [\r\n    {\r\n      name: ACTIVITY_TRANSMIT_EIDS,\r\n      paths: ['userId', 'userIdAsEids'],\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_EIDS, isAllowed),\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_TID,\r\n      paths: ['ortb2Imp.ext.tid'],\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_TID, isAllowed)\r\n    }\r\n  ].map(redactRule)\r\n}\r\n\r\nexport function ortb2TransmitRules(isAllowed = isActivityAllowed) {\r\n  return [\r\n    {\r\n      name: ACTIVITY_TRANSMIT_UFPD,\r\n      paths: ORTB_UFPD_PATHS,\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_UFPD, isAllowed),\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_EIDS,\r\n      paths: ORTB_EIDS_PATHS,\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_EIDS, isAllowed),\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_PRECISE_GEO,\r\n      paths: ORTB_GEO_PATHS,\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_PRECISE_GEO, isAllowed),\r\n      get(val) {\r\n        return Math.round((val + Number.EPSILON) * 100) / 100;\r\n      }\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_PRECISE_GEO,\r\n      paths: ORTB_IPV4_PATHS,\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_PRECISE_GEO, isAllowed),\r\n      get(val) {\r\n        return scrubIPv4(val);\r\n      }\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_PRECISE_GEO,\r\n      paths: ORTB_IPV6_PATHS,\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_PRECISE_GEO, isAllowed),\r\n      get(val) {\r\n        return scrubIPv6(val);\r\n      }\r\n    },\r\n    {\r\n      name: ACTIVITY_TRANSMIT_TID,\r\n      paths: ['source.tid'],\r\n      applies: appliesWhenActivityDenied(ACTIVITY_TRANSMIT_TID, isAllowed),\r\n    }\r\n  ].map(redactRule);\r\n}\r\n\r\nexport function redactorFactory(isAllowed = isActivityAllowed) {\r\n  const redactOrtb2 = objectTransformer(ortb2TransmitRules(isAllowed));\r\n  const redactBidRequest = objectTransformer(bidRequestTransmitRules(isAllowed));\r\n  return function redactor(params) {\r\n    const session = {};\r\n    return {\r\n      ortb2(obj) { redactOrtb2(session, obj, params); return obj },\r\n      bidRequest(obj) { redactBidRequest(session, obj, params); return obj }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Returns an object that can redact other privacy-sensitive objects according\r\n * to activity rules.\r\n *\r\n * @param {{}} params activity parameters to use for activity checks\r\n * @return {{ortb2: function({}): {}, bidRequest: function({}): {}}} methods\r\n *  that can redact disallowed data from ORTB2 and/or bid request objects.\r\n */\r\nexport const redactor = redactorFactory();\r\n\r\ndeclare module '../config' {\r\n  interface Config {\r\n    /**\r\n     * Prebid generates unique IDs for both auctions and ad units within auctions; these can be used by DSPs\r\n     * to correlate requests from different sources, which is useful for many applications but also a potential\r\n     * privacy concern. Since version 8 they are disabled by default, and can be re-enabled with this flag.\r\n     */\r\n    enableTIDs?: boolean;\r\n  }\r\n}\r\n// by default, TIDs are off since version 8\r\nregisterActivityControl(ACTIVITY_TRANSMIT_TID, 'enableTIDs config', () => {\r\n  if (!config.getConfig('enableTIDs')) {\r\n    return {allow: false, reason: 'TIDs are disabled'}\r\n  }\r\n});\r\n","import {prefixLog} from '../utils.js';\r\nimport {ACTIVITY_PARAM_COMPONENT} from './params.js';\r\n\r\n/**\r\n * @param logger\r\n * @return {((function(string, string, function(Object): {allow: boolean, reason?: string}, number=): function(): void)|(function(string, {}): boolean)|*)[]}\r\n */\r\nexport function ruleRegistry(logger = prefixLog('Activity control:')) {\r\n  const registry = {};\r\n\r\n  function getRules(activity) {\r\n    registry[activity] = registry[activity] || [];\r\n    return registry[activity];\r\n  }\r\n\r\n  function runRule(activity, name, rule, params) {\r\n    let res;\r\n    try {\r\n      res = rule(params);\r\n    } catch (e) {\r\n      logger.logError(`Exception in rule ${name} for '${activity}'`, e);\r\n      res = {allow: false, reason: e};\r\n    }\r\n    return res && Object.assign({activity, name, component: params[ACTIVITY_PARAM_COMPONENT]}, res);\r\n  }\r\n\r\n  const dupes = {};\r\n  const DEDUPE_INTERVAL = 1000;\r\n\r\n  // eslint-disable-next-line no-restricted-syntax\r\n  function logResult({activity, name, allow, reason, component}) {\r\n    const msg = `${name} ${allow ? 'allowed' : 'denied'} '${activity}' for '${component}'${reason ? ':' : ''}`;\r\n    const deduping = dupes.hasOwnProperty(msg);\r\n    if (deduping) {\r\n      clearTimeout(dupes[msg]);\r\n    }\r\n    dupes[msg] = setTimeout(() => delete dupes[msg], DEDUPE_INTERVAL);\r\n    if (!deduping) {\r\n      const parts = [msg];\r\n      reason && parts.push(reason);\r\n      (allow ? logger.logInfo : logger.logWarn).apply(logger, parts);\r\n    }\r\n  }\r\n\r\n  return [\r\n    /**\r\n     * Register an activity control rule.\r\n     *\r\n     * @param {string} activity - Activity name, as defined in `activities.js`.\r\n     * @param {string} ruleName - A name for this rule, used for logging.\r\n     * @param {function(Object): {allow: boolean, reason?: string}} rule - Rule definition function. Takes in activity\r\n     *        parameters as a single map; MAY return an object {allow, reason}, where allow is true/false,\r\n     *        and reason is an optional message used for logging.\r\n     *\r\n     *        {allow: true} will allow this activity AS LONG AS no other rules with the same or higher priority return {allow: false};\r\n     *        {allow: false} will deny this activity AS LONG AS no other rules with higher priority return {allow: true};\r\n     *        Returning null/undefined has no effect - the decision is left to other rules.\r\n     *        If no rule returns an allow value, the default is to allow the activity.\r\n     *\r\n     * @param {number} [priority=10] - Rule priority; lower number means higher priority.\r\n     * @returns {function(): void} - A function that unregisters the rule when called.\r\n     */\r\n    function registerActivityControl(activity, ruleName, rule, priority = 10) {\r\n      const rules = getRules(activity);\r\n      const pos = rules.findIndex(([itemPriority]) => priority < itemPriority);\r\n      const entry = [priority, ruleName, rule];\r\n      rules.splice(pos < 0 ? rules.length : pos, 0, entry);\r\n      return function () {\r\n        const idx = rules.indexOf(entry);\r\n        if (idx >= 0) rules.splice(idx, 1);\r\n      }\r\n    },\r\n    /**\r\n     * Test whether an activity is allowed.\r\n     *\r\n     * @param {string} activity activity name\r\n     * @param {{}} params activity parameters; should be generated through the `activityParams` utility.\r\n     * @return {boolean} true for allow, false for deny.\r\n     */\r\n    function isActivityAllowed(activity, params) {\r\n      let lastPriority, foundAllow;\r\n      for (const [priority, name, rule] of getRules(activity)) {\r\n        if (lastPriority !== priority && foundAllow) break;\r\n        lastPriority = priority;\r\n        const ruleResult = runRule(activity, name, rule, params);\r\n        if (ruleResult) {\r\n          if (!ruleResult.allow) {\r\n            logResult(ruleResult);\r\n            return false;\r\n          } else {\r\n            foundAllow = ruleResult;\r\n          }\r\n        }\r\n      }\r\n      foundAllow && logResult(foundAllow);\r\n      return true;\r\n    }\r\n  ];\r\n}\r\n\r\nexport const [registerActivityControl, isActivityAllowed] = ruleRegistry();\r\n","import {\r\n  createIframe,\r\n  createInvisibleIframe,\r\n  inIframe,\r\n  insertElement,\r\n  logError,\r\n  logWarn,\r\n  replaceMacros,\r\n  triggerPixel\r\n} from './utils.js';\r\nimport * as events from './events.js';\r\nimport {AD_RENDER_FAILED_REASON, BID_STATUS, EVENTS, MESSAGES, PB_LOCATOR} from './constants.js';\r\nimport {config} from './config.js';\r\nimport {executeRenderer, isRendererRequired} from './Renderer.js';\r\nimport {VIDEO} from './mediaTypes.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {getCreativeRenderer} from './creativeRenderers.js';\r\nimport {hook} from './hook.js';\r\nimport {fireNativeTrackers} from './native.js';\r\nimport {PbPromise} from './utils/promise.js';\r\nimport adapterManager from './adapterManager.js';\r\nimport {useMetrics} from './utils/perfMetrics.js';\r\nimport {filters} from './targeting.js';\r\nimport {EVENT_TYPE_WIN, parseEventTrackers, TRACKER_METHOD_IMG} from './eventTrackers.js';\r\nimport type {Bid} from \"./bidfactory.ts\";\r\n\r\nconst { AD_RENDER_FAILED, AD_RENDER_SUCCEEDED, STALE_RENDER, BID_WON, EXPIRED_RENDER } = EVENTS;\r\nconst { EXCEPTION } = AD_RENDER_FAILED_REASON;\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    /**\r\n     * Fired when a bid is rendered (successfully or not).\r\n     */\r\n    [EVENTS.BID_WON]: [Bid];\r\n    /**\r\n     * Fired when a bid failed to render.\r\n     */\r\n    [EVENTS.AD_RENDER_FAILED]: [AdRenderFailedData];\r\n    /**\r\n     * Fired when a bid was rendered successfully.\r\n     */\r\n    [EVENTS.AD_RENDER_SUCCEEDED]: [AdRenderSucceededData];\r\n    /**\r\n     * Fired when a bid that was previously rendered is rendered again.\r\n     */\r\n    [EVENTS.STALE_RENDER]: [Bid];\r\n    /**\r\n     * Fired when an expired bid is rendered. A bid expires after `.ttl` seconds from\r\n     * the time it was received.\r\n     */\r\n    [EVENTS.EXPIRED_RENDER]: [Bid];\r\n  }\r\n}\r\n\r\nexport const getBidToRender = hook('sync', function (adId, forRender = true, override = PbPromise.resolve()) {\r\n  return override\r\n    .then(bid => bid ?? auctionManager.findBidByAdId(adId))\r\n    .catch(() => {})\r\n})\r\n\r\nexport const markWinningBid = hook('sync', function (bid) {\r\n  (parseEventTrackers(bid.eventtrackers)[EVENT_TYPE_WIN]?.[TRACKER_METHOD_IMG] || [])\r\n    .forEach(url => triggerPixel(url));\r\n  events.emit(BID_WON, bid);\r\n  auctionManager.addWinningBid(bid);\r\n})\r\n\r\ntype AdRenderFailedData = {\r\n  /**\r\n   * Failure reason.\r\n   */\r\n  reason: (typeof AD_RENDER_FAILED_REASON)[keyof typeof AD_RENDER_FAILED_REASON];\r\n  /**\r\n   * failure description\r\n   */\r\n  message: string;\r\n  /**\r\n   * The bid that failed to render.\r\n   */\r\n  bid?: Bid;\r\n  /**\r\n   * Ad ID of the bid that failed to render.\r\n   */\r\n  adId?: string;\r\n}\r\n\r\n/**\r\n * Emit the AD_RENDER_FAILED event.\r\n */\r\nexport function emitAdRenderFail({ reason, message, bid, id }: Omit<AdRenderFailedData, 'adId'> & { id?: string }) {\r\n  const data: AdRenderFailedData = { reason, message };\r\n  if (bid) {\r\n    data.bid = bid;\r\n    data.adId = bid.adId;\r\n  }\r\n  if (id) data.adId = id;\r\n\r\n  logError(`Error rendering ad (id: ${id}): ${message}`);\r\n  events.emit(AD_RENDER_FAILED, data);\r\n}\r\n\r\ntype AdRenderSucceededData = {\r\n  /**\r\n   * document object that was used to `.write` the ad. Should be `null` if unavailable (e.g. for documents in\r\n   * a cross-origin frame).\r\n   */\r\n  doc: Document | null;\r\n  /**\r\n   * The bid that was rendered.\r\n   */\r\n  bid: Bid;\r\n  /**\r\n   * Ad ID of the bid that was rendered.\r\n   */\r\n  adId: string;\r\n}\r\n/**\r\n * Emit the AD_RENDER_SUCCEEDED event.\r\n * (Note: Invocation of this function indicates that the render function did not generate an error, it does not guarantee that tracking for this event has occurred yet.)\r\n */\r\nexport function emitAdRenderSucceeded({ doc, bid, id }) {\r\n  const data: AdRenderSucceededData = { doc, bid, adId: id};\r\n\r\n  adapterManager.callAdRenderSucceededBidder(bid.adapterCode || bid.bidder, bid);\r\n\r\n  events.emit(AD_RENDER_SUCCEEDED, data);\r\n}\r\n\r\nexport function handleCreativeEvent(data, bidResponse) {\r\n  switch (data.event) {\r\n    case EVENTS.AD_RENDER_FAILED:\r\n      emitAdRenderFail({\r\n        bid: bidResponse,\r\n        id: bidResponse.adId,\r\n        reason: data.info.reason,\r\n        message: data.info.message\r\n      });\r\n      break;\r\n    case EVENTS.AD_RENDER_SUCCEEDED:\r\n      emitAdRenderSucceeded({\r\n        doc: null,\r\n        bid: bidResponse,\r\n        id: bidResponse.adId\r\n      });\r\n      break;\r\n    default:\r\n      logError(`Received event request for unsupported event: '${data.event}' (adId: '${bidResponse.adId}')`);\r\n  }\r\n}\r\n\r\nexport function handleNativeMessage(data, bidResponse, {resizeFn, fireTrackers = fireNativeTrackers}) {\r\n  switch (data.action) {\r\n    case 'resizeNativeHeight':\r\n      resizeFn(data.width, data.height);\r\n      break;\r\n    default:\r\n      fireTrackers(data, bidResponse);\r\n  }\r\n}\r\n\r\nconst HANDLERS: any = {\r\n  [MESSAGES.EVENT]: handleCreativeEvent\r\n}\r\n\r\nif (FEATURES.NATIVE) {\r\n  HANDLERS[MESSAGES.NATIVE] = handleNativeMessage;\r\n}\r\n\r\nfunction creativeMessageHandler(deps) {\r\n  return function (type, data, bidResponse) {\r\n    if (HANDLERS.hasOwnProperty(type)) {\r\n      HANDLERS[type](data, bidResponse, deps);\r\n    }\r\n  }\r\n}\r\n\r\ntype RenderOptions = {\r\n  clickUrl?: string;\r\n}\r\n\r\nexport const getRenderingData = hook('sync', function (bidResponse: Bid, options?: RenderOptions): Record<string, any> {\r\n  const {ad, adUrl, cpm, originalCpm, width, height, instl} = bidResponse\r\n  const repl = {\r\n    AUCTION_PRICE: originalCpm || cpm,\r\n    CLICKTHROUGH: options?.clickUrl || ''\r\n  }\r\n  return {\r\n    ad: replaceMacros(ad, repl),\r\n    adUrl: replaceMacros(adUrl, repl),\r\n    width,\r\n    height,\r\n    instl\r\n  };\r\n})\r\n\r\nexport const doRender = hook('sync', function({renderFn, resizeFn, bidResponse, options, doc, isMainDocument = doc === document && !inIframe()}) {\r\n  const videoBid = (FEATURES.VIDEO && bidResponse.mediaType === VIDEO)\r\n  if (isMainDocument || videoBid) {\r\n    emitAdRenderFail({\r\n      reason: AD_RENDER_FAILED_REASON.PREVENT_WRITING_ON_MAIN_DOCUMENT,\r\n      message: videoBid ? 'Cannot render video ad without a renderer' : `renderAd was prevented from writing to the main document.`,\r\n      bid: bidResponse,\r\n      id: bidResponse.adId\r\n    });\r\n    return;\r\n  }\r\n  const data = getRenderingData(bidResponse, options);\r\n  renderFn(Object.assign({adId: bidResponse.adId}, data));\r\n  const {width, height} = data;\r\n  if ((width ?? height) != null) {\r\n    resizeFn(width, height);\r\n  }\r\n});\r\n\r\ndoRender.before(function (next, args) {\r\n  // run renderers from a high priority hook to allow the video module to insert itself between this and \"normal\" rendering.\r\n  const {bidResponse, doc} = args;\r\n  if (isRendererRequired(bidResponse.renderer)) {\r\n    executeRenderer(bidResponse.renderer, bidResponse, doc);\r\n    emitAdRenderSucceeded({doc, bid: bidResponse, id: bidResponse.adId})\r\n    next.bail();\r\n  } else {\r\n    next(args);\r\n  }\r\n}, 100)\r\n\r\nexport function handleRender({renderFn, resizeFn, adId, options, bidResponse, doc}) {\r\n  deferRendering(bidResponse, () => {\r\n    if (bidResponse == null) {\r\n      emitAdRenderFail({\r\n        reason: AD_RENDER_FAILED_REASON.CANNOT_FIND_AD,\r\n        message: `Cannot find ad '${adId}'`,\r\n        id: adId\r\n      });\r\n      return;\r\n    }\r\n    if (bidResponse.status === BID_STATUS.RENDERED) {\r\n      logWarn(`Ad id ${adId} has been rendered before`);\r\n      events.emit(STALE_RENDER, bidResponse);\r\n      if (config.getConfig('auctionOptions')?.suppressStaleRender) {\r\n        return;\r\n      }\r\n    }\r\n    if (!filters.isBidNotExpired(bidResponse)) {\r\n      logWarn(`Ad id ${adId} has been expired`);\r\n      events.emit(EXPIRED_RENDER, bidResponse);\r\n      if (config.getConfig('auctionOptions')?.suppressExpiredRender) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    try {\r\n      doRender({renderFn, resizeFn, bidResponse, options, doc});\r\n    } catch (e) {\r\n      emitAdRenderFail({\r\n        reason: AD_RENDER_FAILED_REASON.EXCEPTION,\r\n        message: e.message,\r\n        id: adId,\r\n        bid: bidResponse\r\n      });\r\n    }\r\n  })\r\n}\r\n\r\nexport function markBidAsRendered(bidResponse) {\r\n  const metrics = useMetrics(bidResponse.metrics);\r\n  metrics.checkpoint('bidRender');\r\n  metrics.timeBetween('bidWon', 'bidRender', 'render.deferred');\r\n  metrics.timeBetween('auctionEnd', 'bidRender', 'render.pending');\r\n  metrics.timeBetween('requestBids', 'bidRender', 'render.e2e');\r\n  bidResponse.status = BID_STATUS.RENDERED;\r\n}\r\n\r\nconst DEFERRED_RENDER = new WeakMap();\r\nconst WINNERS = new WeakSet();\r\n\r\nexport function deferRendering(bidResponse, renderFn) {\r\n  if (bidResponse == null) {\r\n    // if the bid is missing, let renderFn deal with it now\r\n    renderFn();\r\n    return;\r\n  }\r\n  DEFERRED_RENDER.set(bidResponse, renderFn);\r\n  if (!bidResponse.deferRendering) {\r\n    renderIfDeferred(bidResponse);\r\n  }\r\n  markWinner(bidResponse);\r\n}\r\n\r\nexport function markWinner(bidResponse) {\r\n  if (!WINNERS.has(bidResponse)) {\r\n    WINNERS.add(bidResponse);\r\n    markWinningBid(bidResponse);\r\n  }\r\n}\r\n\r\nexport function renderIfDeferred(bidResponse) {\r\n  const renderFn = DEFERRED_RENDER.get(bidResponse);\r\n  if (renderFn) {\r\n    renderFn();\r\n    markBidAsRendered(bidResponse);\r\n    DEFERRED_RENDER.delete(bidResponse);\r\n  }\r\n}\r\n\r\nexport function renderAdDirect(doc, adId, options) {\r\n  let bid;\r\n  function fail(reason, message) {\r\n    emitAdRenderFail(Object.assign({id: adId, bid}, {reason, message}));\r\n  }\r\n  function resizeFn(width, height) {\r\n    const frame = doc.defaultView?.frameElement;\r\n    if (frame) {\r\n      if (width) {\r\n        frame.width = width;\r\n        frame.style.width && (frame.style.width = `${width}px`);\r\n      }\r\n      if (height) {\r\n        frame.height = height;\r\n        frame.style.height && (frame.style.height = `${height}px`);\r\n      }\r\n    }\r\n  }\r\n  const messageHandler = creativeMessageHandler({resizeFn});\r\n  function renderFn(adData) {\r\n    if (adData.ad) {\r\n      doc.write(adData.ad);\r\n      doc.close();\r\n      emitAdRenderSucceeded({doc, bid, id: bid.adId});\r\n    } else {\r\n      getCreativeRenderer(bid)\r\n        .then(render => render(adData, {\r\n          sendMessage: (type, data) => messageHandler(type, data, bid),\r\n          mkFrame: createIframe,\r\n        }, doc.defaultView))\r\n        .then(\r\n          () => emitAdRenderSucceeded({doc, bid, id: bid.adId}),\r\n          (e) => {\r\n            fail(e?.reason || AD_RENDER_FAILED_REASON.EXCEPTION, e?.message)\r\n            e?.stack && logError(e);\r\n          }\r\n        );\r\n    }\r\n    // TODO: this is almost certainly the wrong way to do this\r\n    const creativeComment = document.createComment(`Creative ${bid.creativeId} served by ${bid.bidder} Prebid.js Header Bidding`);\r\n    insertElement(creativeComment, doc, 'html');\r\n  }\r\n  try {\r\n    if (!adId || !doc) {\r\n      fail(AD_RENDER_FAILED_REASON.MISSING_DOC_OR_ADID, `missing ${adId ? 'doc' : 'adId'}`);\r\n    } else {\r\n      getBidToRender(adId).then(bidResponse => {\r\n        bid = bidResponse;\r\n        handleRender({renderFn, resizeFn, adId, options: {clickUrl: options?.clickThrough}, bidResponse, doc});\r\n      });\r\n    }\r\n  } catch (e) {\r\n    fail(EXCEPTION, e.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Insert an invisible, named iframe that can be used by creatives to locate the window Prebid is running in\r\n * (by looking for one that has `.frames[PB_LOCATOR]` defined).\r\n * This is necessary because in some situations creatives may be rendered inside nested iframes - Prebid is not necessarily\r\n * in the immediate parent window.\r\n */\r\nexport function insertLocatorFrame() {\r\n  if (!window.frames[PB_LOCATOR]) {\r\n    if (!document.body) {\r\n      window.requestAnimationFrame(insertLocatorFrame);\r\n    } else {\r\n      const frame = createInvisibleIframe();\r\n      frame.name = PB_LOCATOR;\r\n      document.body.appendChild(frame);\r\n    }\r\n  }\r\n}\r\n","import { getGlobal } from './prebidGlobal.js';\r\nimport { logWarn } from './utils.js';\r\n\r\nconst prebid = getGlobal();\r\n\r\n/**\r\n * This file defines the plugin points in prebid-core for AdServer-specific functionality.\r\n *\r\n * Its main job is to expose functions for AdServer modules to append functionality to the Prebid public API.\r\n * For a given Ad Server with name \"adServerName\", these functions will only change the API in the\r\n * $$PREBID_GLOBAL$$.adServers[adServerName] namespace.\r\n */\r\n\r\n/**\r\n * @typedef {Object} CachedVideoBid\r\n *\r\n * @property {string} videoCacheId The ID which can be used to retrieve this video from prebid-server.\r\n *   This is the same ID given to the callback in the videoCache's store function.\r\n */\r\n\r\n/**\r\n * @function VideoAdUrlBuilder\r\n *\r\n * @param {CachedVideoBid} bid The winning Bid which the ad server should show, assuming it beats out\r\n *   the competition.\r\n *\r\n * @param {Object} options Options required by the Ad Server to make a valid AdServer URL.\r\n *   This object will have different properties depending on the specific ad server supported.\r\n *   For more information, see the docs inside the ad server module you're supporting.\r\n *\r\n * @return {string} A URL which can be passed into the Video player to play an ad.\r\n */\r\n\r\n/**\r\n * @typedef {Object} VideoSupport\r\n *\r\n * @property {VideoAdUrlBuilder} buildVideoAdUrl\r\n */\r\n\r\n/**\r\n * Enable video support for the Ad Server.\r\n *\r\n * @property {string} name The identifying name for this adserver.\r\n * @property {VideoSupport} videoSupport An object with the functions needed to support video in Prebid.\r\n */\r\nexport function registerVideoSupport(name, videoSupport) {\r\n  prebid.adServers = prebid.adServers || { };\r\n  prebid.adServers[name] = prebid.adServers[name] || { };\r\n  Object.keys(videoSupport).forEach((key) => {\r\n    if (prebid.adServers[name][key]) {\r\n      logWarn(`Attempting to add an already registered function property ${key} for AdServer ${name}.`);\r\n      return;\r\n    }\r\n    prebid.adServers[name][key] = videoSupport[key];\r\n  });\r\n}\r\n","import type {AdUnitCode, BidderCode, ContextIdentifiers, Size} from \"./types/common.d.ts\";\r\nimport type {ORTBImp} from \"./types/ortb/request.d.ts\";\r\nimport type {Bid} from \"./bidfactory.ts\";\r\nimport type {MediaTypes} from \"./mediaTypes.ts\";\r\nimport type {DeepPartial} from \"./types/objects.d.ts\";\r\n\r\nexport interface RendererConfig {\r\n  /**\r\n   * URL to the renderer script that will be loaded before invoking `render`.\r\n   */\r\n  url?: string\r\n\r\n  /**\r\n   * Function that tells Prebid.js how to invoke the renderer script to render a bid.\r\n   */\r\n  render(bid: Bid): void;\r\n\r\n  /**\r\n   * if set to true, this renderer config will be used only when the bid adapter doesn't provide its own renderer.\r\n   */\r\n  backupOnly?: boolean;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface BidderParams {\r\n  /**\r\n   * Adapter-specific parameters - to be extended in the adapters\r\n   */\r\n}\r\n\r\nexport interface BaseAdUnitBidDefinition {\r\n  /**\r\n   * Used for conditional ads (sizeMapping or sizeMappingV2 modules).\r\n   */\r\n  labelAny?: string[];\r\n  /**\r\n   * Used for conditional ads (sizeMapping or sizeMappingV2 modules).\r\n   */\r\n  labelAll?: string[];\r\n  /**\r\n   * Custom renderer. Takes precedence over adUnit.renderer, but applies only to this bidder or module.\r\n   */\r\n  renderer?: RendererConfig;\r\n  /**\r\n   * OpenRTB first-party data specific to this bidder or module. This is merged with, and takes precedence over, adUnit.ortb2Imp.\r\n   */\r\n  ortb2Imp?: DeepPartial<ORTBImp>;\r\n}\r\n\r\nexport interface AdUnitBidderBid<BIDDER extends BidderCode> extends BaseAdUnitBidDefinition {\r\n  /**\r\n   * Unique code identifying the bidder.\r\n   */\r\n  bidder: BIDDER;\r\n  module?: undefined | null;\r\n  /**\r\n   * Bid request parameters for a given bidder.\r\n   */\r\n  params: BIDDER extends keyof BidderParams ? BidderParams[BIDDER] : Record<string, unknown>;\r\n  /**\r\n   * One or more s2sConfig.name. If provided, this bid will be requested only from the given S2S instance(s).\r\n   */\r\n  s2sConfigName?: string | string[]\r\n}\r\n\r\nexport type AdUnitModuleBidder = 'pbsBidAdapter';\r\n\r\nexport interface AdUnitModuleBid extends BaseAdUnitBidDefinition {\r\n  /**\r\n   * Module code - for requesting bids from modules that are not bid adapters\r\n   */\r\n  module: AdUnitModuleBidder;\r\n  bidder?: never;\r\n  params?: {\r\n    /**\r\n     * Name given to a PBS configuration. Used to identify specific PBS instances when multiple are in use.\r\n     */\r\n    configName?: string;\r\n  }\r\n}\r\n\r\nexport type AdUnitBidDefinition = AdUnitModuleBid | AdUnitBidderBid<keyof BidderParams> | AdUnitBidderBid<BidderCode>;\r\n\r\nexport interface AdUnitDefinition {\r\n  /**\r\n   * An identifier you create and assign to this ad unit.\r\n   * Generally this is set to the ad slot name or the div element ID.\r\n   * Used by setTargetingForGPTAsync() to match which auction is for which ad slot.\r\n   */\r\n  code: AdUnitCode;\r\n  /**\r\n   * Bid requests representing demand partners and associated parameters.\r\n   */\r\n  bids?: AdUnitBidDefinition[];\r\n  mediaTypes?: MediaTypes;\r\n  /**\r\n   * TTL buffer override for this adUnit.\r\n   */\r\n  ttlBuffer?: number;\r\n  /**\r\n   * Used to signal OpenRTB Imp objects at the adUnit grain.\r\n   * Similar to the global ortb2 field used for global first party data configuration, but specific to this adunit.\r\n   */\r\n  ortb2Imp?: DeepPartial<ORTBImp>;\r\n  /**\r\n   * Custom renderer, typically used for outstream video\r\n   */\r\n  renderer?: RendererConfig;\r\n\r\n  /**\r\n   * Used to flag adUnits as being separately billable. This allows for a publisher to trigger billing manually for winning bids. See pbjs.triggerBilling and onBidBillable for more info.\r\n   */\r\n  deferBilling?: boolean;\r\n  /**\r\n   * @deprecated - use mediaType specific size parameters instead.\r\n   */\r\n  sizes?: Size | Size[];\r\n}\r\n\r\n/**\r\n * Ad unit objects generated by Prebid (as opposed to the definitions provided by the publisher)\r\n * can have a placeholder \"null\" bidder to represent s2s-only stored requests.\r\n */\r\ninterface NullBid extends BaseAdUnitBidDefinition {\r\n  bidder: null\r\n  module?: undefined | null;\r\n  params?: undefined | null;\r\n}\r\n\r\nexport type AdUnitBid = AdUnitBidDefinition | NullBid;\r\n\r\nexport interface AdUnit extends ContextIdentifiers, Omit<AdUnitDefinition, 'bids'> {\r\n  bids: AdUnitBid[]\r\n}\r\n\r\nconst REQUESTS = 'requests';\r\nconst WINS = 'wins';\r\nconst AUCTIONS = 'auctions';\r\n\r\nlet adUnits = {};\r\nexport function reset() {\r\n  adUnits = {}\r\n}\r\n\r\nfunction ensureAdUnit(adunit, bidderCode?) {\r\n  const adUnit = adUnits[adunit] = adUnits[adunit] || { bidders: {} };\r\n  if (bidderCode) {\r\n    adUnit.bidders[bidderCode] = adUnit.bidders[bidderCode] || {}\r\n    return adUnit.bidders[bidderCode]\r\n  }\r\n  return adUnit;\r\n}\r\n\r\ntype AdUnitCounter = (adUnit: AdUnitCode) => number;\r\ntype BidderCounter = (adUnit: AdUnitCode, bidderCode: BidderCode) => number;\r\ntype Counter<BY_BIDDER extends boolean> = BY_BIDDER extends true ? BidderCounter : AdUnitCounter;\r\n\r\nfunction incrementer<BY_BIDDER extends boolean>(counter, byBidder: BY_BIDDER): Counter<BY_BIDDER> {\r\n  return function (adUnit, bidder?) {\r\n    const counters = ensureAdUnit(adUnit, byBidder && bidder);\r\n    counters[counter] = (counters[counter] ?? 0) + 1;\r\n    return counters[counter];\r\n  }\r\n}\r\n\r\nfunction getter<BY_BIDDER extends boolean>(counter, byBidder: BY_BIDDER): Counter<BY_BIDDER> {\r\n  return function (adUnit, bidder?) {\r\n    return ensureAdUnit(adUnit, byBidder && bidder)[counter] ?? 0;\r\n  }\r\n}\r\n\r\n/**\r\n * Increments and returns current Adunit counter\r\n */\r\nexport const incrementRequestsCounter = incrementer(REQUESTS, false);\r\n\r\n/**\r\n * Increments and returns current Adunit requests counter for a bidder\r\n */\r\nexport const incrementBidderRequestsCounter = incrementer(REQUESTS, true);\r\n\r\n/**\r\n * Increments and returns current Adunit wins counter for a bidder\r\n */\r\nexport const incrementBidderWinsCounter = incrementer(WINS, true);\r\n\r\n/**\r\n * Increments and returns current Adunit auctions counter\r\n */\r\nexport const incrementAuctionsCounter = incrementer(AUCTIONS, false);\r\n\r\n/**\r\n * Returns current Adunit counter\r\n */\r\nexport const getRequestsCounter = getter(REQUESTS, false);\r\n\r\n/**\r\n * Returns current Adunit requests counter for a specific bidder code\r\n */\r\nexport const getBidderRequestsCounter = getter(REQUESTS, true)\r\n\r\n/**\r\n * Returns current Adunit requests counter for a specific bidder code\r\n */\r\nexport const getBidderWinsCounter = getter(WINS, true);\r\n\r\n/**\r\n * Returns current Adunit auctions counter\r\n */\r\nexport const getAuctionsCounter = getter(AUCTIONS, false);\r\n","export default function Adapter(code) {\r\n  var bidderCode = code;\r\n\r\n  function setBidderCode(code) {\r\n    bidderCode = code;\r\n  }\r\n\r\n  function getBidderCode() {\r\n    return bidderCode;\r\n  }\r\n\r\n  function callBids() {\r\n  }\r\n\r\n  return {\r\n    callBids: callBids,\r\n    setBidderCode: setBidderCode,\r\n    getBidderCode: getBidderCode\r\n  };\r\n}\r\n","/** @module adaptermanger */\r\n\r\nimport {\r\n  deepClone,\r\n  flatten,\r\n  generateUUID,\r\n  getBidderCodes,\r\n  getDefinedParams,\r\n  getUniqueIdentifierStr,\r\n  getUserConfiguredParams,\r\n  groupBy,\r\n  internal,\r\n  isArray,\r\n  isPlainObject,\r\n  isValidMediaTypes,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep,\r\n  shuffle,\r\n  timestamp,\r\n  uniques,\r\n} from './utils.js';\r\nimport {decorateAdUnitsWithNativeParams, nativeAdapters} from './native.js';\r\nimport {newBidder} from './adapters/bidderFactory.js';\r\nimport {ajaxBuilder} from './ajax.js';\r\nimport {config, RANDOM} from './config.js';\r\nimport {hook} from './hook.js';\r\nimport {\r\n  type AdUnit,\r\n  type AdUnitBid,\r\n  type AdUnitBidderBid, type AdUnitModuleBid,\r\n  getAuctionsCounter,\r\n  getBidderRequestsCounter,\r\n  getBidderWinsCounter,\r\n  getRequestsCounter,\r\n  incrementAuctionsCounter,\r\n  incrementBidderRequestsCounter,\r\n  incrementBidderWinsCounter,\r\n  incrementRequestsCounter\r\n} from './adUnits.js';\r\nimport {getRefererInfo, type RefererInfo} from './refererDetection.js';\r\nimport {GDPR_GVLIDS, gdprDataHandler, gppDataHandler, uspDataHandler,} from './consentHandler.js';\r\nimport * as events from './events.js';\r\nimport {EVENTS, S2S} from './constants.js';\r\nimport {type Metrics, useMetrics} from './utils/perfMetrics.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {MODULE_TYPE_ANALYTICS, MODULE_TYPE_BIDDER, MODULE_TYPE_PREBID} from './activities/modules.js';\r\nimport {isActivityAllowed} from './activities/rules.js';\r\nimport {ACTIVITY_FETCH_BIDS, ACTIVITY_REPORT_ANALYTICS} from './activities/activities.js';\r\nimport {ACTIVITY_PARAM_ANL_CONFIG, ACTIVITY_PARAM_S2S_NAME, activityParamsBuilder} from './activities/params.js';\r\nimport {redactor} from './activities/redactor.js';\r\nimport {EVENT_TYPE_IMPRESSION, parseEventTrackers, TRACKER_METHOD_IMG} from './eventTrackers.js';\r\nimport type {\r\n  AdUnitCode,\r\n  BidderCode,\r\n  BidSource,\r\n  ContextIdentifiers,\r\n  Identifier,\r\n  ORTBFragments,\r\n  Size, StorageDisclosure\r\n} from \"./types/common.d.ts\";\r\nimport type {DeepPartial} from \"./types/objects.d.ts\";\r\nimport type {ORTBRequest} from \"./types/ortb/request.d.ts\";\r\nimport type {\r\n  AnalyticsConfig,\r\n  AnalyticsProvider, AnalyticsProviderConfig,\r\n} from \"../libraries/analyticsAdapter/AnalyticsAdapter.ts\";\r\n\r\nexport {gdprDataHandler, gppDataHandler, uspDataHandler, coppaDataHandler} from './consentHandler.js';\r\n\r\nexport const PBS_ADAPTER_NAME = 'pbsBidAdapter';\r\nexport const PARTITIONS = {\r\n  CLIENT: 'client',\r\n  SERVER: 'server'\r\n}\r\n\r\nexport const dep = {\r\n  isAllowed: isActivityAllowed,\r\n  redact: redactor\r\n}\r\n\r\nconst _bidderRegistry = {};\r\nconst _aliasRegistry: { [aliasCode: BidderCode]: BidderCode } = {};\r\nconst _analyticsRegistry: { [P in AnalyticsProvider]?: { adapter: AnalyticsAdapter<P>, gvlid?: number }} = {};\r\n\r\nlet _s2sConfigs = [];\r\nconfig.getConfig('s2sConfig', config => {\r\n  if (config && config.s2sConfig) {\r\n    _s2sConfigs = isArray(config.s2sConfig) ? config.s2sConfig : [config.s2sConfig];\r\n  }\r\n});\r\n\r\nconst activityParams = activityParamsBuilder((alias) => adapterManager.resolveAlias(alias));\r\n\r\nfunction getConfigName(s2sConfig) {\r\n  // According to our docs, \"module\" bid (stored impressions)\r\n  // have params.configName referring to s2sConfig.name,\r\n  // but for a long while this was checking against s2sConfig.configName.\r\n  // Keep allowing s2sConfig.configName to avoid the breaking change\r\n  return s2sConfig.configName ?? s2sConfig.name;\r\n}\r\n\r\nexport function s2sActivityParams(s2sConfig) {\r\n  return activityParams(MODULE_TYPE_PREBID, PBS_ADAPTER_NAME, {\r\n    [ACTIVITY_PARAM_S2S_NAME]: getConfigName(s2sConfig)\r\n  });\r\n}\r\n\r\nexport interface BaseBidRequest extends ContextIdentifiers, Pick<AdUnit, typeof ADUNIT_BID_PROPERTIES[number] | 'mediaTypes' | 'ortb2Imp'> {\r\n  /**\r\n   * Unique ID for this request.\r\n   */\r\n  bidId: Identifier;\r\n  /**\r\n   * ID of the BidderRequest containing this request.\r\n   */\r\n  bidderRequestId: Identifier;\r\n  metrics: Metrics;\r\n  src: BidSource;\r\n  /**\r\n   * The code of the ad unit associated with this request.\r\n   */\r\n  adUnitCode: AdUnitCode;\r\n  /**\r\n   * @deprecated - use mediaType specific size parameters instead.\r\n   */\r\n  sizes: Size | Size[];\r\n  /**\r\n   * The number of auctions that took place involving the ad unit associated with this request.\r\n   */\r\n  auctionsCount: number;\r\n  /**\r\n   * How many times the ad unit code associated with this request took part in an auction. This differs\r\n   * from `auctionsCount` when twin ad units are used.\r\n   */\r\n  bidRequestsCount: number;\r\n  /**\r\n   * The number of client (but not s2s) requests that were generated for the combination of ad unit and bidder\r\n   * associated with this request.\r\n   */\r\n  bidderRequestsCount: number;\r\n  /**\r\n   * The number of times a bid from the same bidder and for the same ad unit as this request has won.\r\n   */\r\n  bidderWinsCount: number;\r\n  deferBilling: AdUnit['deferBilling'];\r\n  /**\r\n   * \"Global\" (not adUnit-specific) first party data for this request. This\r\n   * is an alias for the enclosing BidderRequest's `.ortb2`; adUnit-specific\r\n   * FPD is in `ortb2Imp`.\r\n   */\r\n  ortb2: DeepPartial<ORTBRequest>;\r\n}\r\n\r\nexport interface StoredBidRequest extends BaseBidRequest, Omit<{[K in keyof AdUnitBidderBid<BidderCode>]?: undefined}, keyof BaseBidRequest> {\r\n  bidder: null;\r\n  src: typeof S2S.SRC;\r\n}\r\ntype BidderBidRequest<BIDDER extends BidderCode> = BaseBidRequest & AdUnitBidderBid<BIDDER>;\r\n\r\nexport type BidRequest<BIDDER extends (BidderCode | null)> = BIDDER extends null ? StoredBidRequest : BidderBidRequest<BIDDER>;\r\n\r\nexport interface BaseBidderRequest<BIDDER extends BidderCode | null> {\r\n  /**\r\n   * Unique ID for this request.\r\n   */\r\n  bidderRequestId: Identifier;\r\n  auctionId: Identifier;\r\n  /**\r\n   * The bidder associated with this request, or null in the case of stored impressions.\r\n   */\r\n  bidderCode: BIDDER;\r\n  /**\r\n   * Bid requests (one per ad unit) included in this request.\r\n   */\r\n  bids: BidRequest<BIDDER>[];\r\n  /**\r\n   * First party data for this request.\r\n   */\r\n  ortb2: DeepPartial<ORTBRequest>;\r\n  /**\r\n   * Auction start timestamp.\r\n   */\r\n  auctionStart: number;\r\n  /**\r\n   * Request timeout in milliseconds.\r\n   */\r\n  timeout: number;\r\n  refererInfo: RefererInfo;\r\n  metrics: Metrics;\r\n  gdprConsent?: ReturnType<typeof gdprDataHandler['getConsentData']>;\r\n  uspConsent?: ReturnType<typeof uspDataHandler['getConsentData']>;\r\n  gppConsent?: ReturnType<typeof gppDataHandler['getConsentData']>;\r\n}\r\n\r\nexport interface S2SBidderRequest<BIDDER extends BidderCode | null> extends BaseBidderRequest<BIDDER> {\r\n  src: typeof S2S.SRC;\r\n  uniquePbsTid: Identifier;\r\n  adUnitsS2SCopy: PBSAdUnit[];\r\n}\r\n\r\nexport interface ClientBidderRequest<BIDDER extends BidderCode> extends BaseBidderRequest<BIDDER> {\r\n  src: 'client';\r\n}\r\n\r\nexport type BidderRequest<BIDDER extends BidderCode | null> = ClientBidderRequest<BIDDER> | S2SBidderRequest<BIDDER>;\r\n\r\nconst ADUNIT_BID_PROPERTIES = [\r\n  'nativeParams',\r\n  'nativeOrtbRequest',\r\n  'renderer',\r\n] as const;\r\n\r\ntype GetBidsOptions<SRC extends BidSource, BIDDER extends BidderCode | null> = {\r\n  bidderCode: BIDDER;\r\n  auctionId: Identifier;\r\n  bidderRequestId: Identifier;\r\n  adUnits: (SRC extends typeof S2S.SRC ? PBSAdUnit : AdUnit)[]\r\n  src: SRC;\r\n  metrics: Metrics\r\n}\r\n\r\nexport type AliasBidderOptions = {\r\n  /**\r\n   * IAB Global Vendor List ID for this alias for use with the TCF control module.\r\n   */\r\n  gvlid?: number;\r\n  /**\r\n   * Flag determining if the GVL ID of the original adapter should be re-used.\r\n   */\r\n  useBaseGvlid?: boolean;\r\n  /**\r\n   * If true, the alias will not be communicated to Prebid Server.\r\n   */\r\n  skipPbsAliasing?: boolean\r\n}\r\n\r\nexport type AnalyticsAdapter<P extends AnalyticsProvider> = StorageDisclosure & {\r\n  code?: P;\r\n  enableAnalytics(config: AnalyticsConfig<P>): void;\r\n  gvlid?: number | ((config: AnalyticsConfig<P>) => number);\r\n}\r\n\r\nfunction getBids<SRC extends BidSource, BIDDER extends BidderCode | null>({bidderCode, auctionId, bidderRequestId, adUnits, src, metrics}: GetBidsOptions<SRC, BIDDER>): BidRequest<BIDDER>[] {\r\n  return adUnits.reduce((result, adUnit) => {\r\n    const bids = adUnit.bids.filter(bid => bid.bidder === bidderCode);\r\n    if (bidderCode == null && bids.length === 0 && (adUnit as PBSAdUnit).s2sBid != null) {\r\n      bids.push({bidder: null});\r\n    }\r\n    result.push(\r\n      bids.reduce((bids: BidRequest<BIDDER>[], bid: BidRequest<BIDDER>) => {\r\n        bid = Object.assign({}, bid,\r\n          {ortb2Imp: mergeDeep({}, adUnit.ortb2Imp, bid.ortb2Imp)},\r\n          getDefinedParams(adUnit, ADUNIT_BID_PROPERTIES)\r\n        );\r\n\r\n        const mediaTypes = bid.mediaTypes == null ? adUnit.mediaTypes : bid.mediaTypes\r\n\r\n        if (isValidMediaTypes(mediaTypes)) {\r\n          bid = Object.assign({}, bid, {\r\n            mediaTypes\r\n          });\r\n        } else {\r\n          logError(\r\n            `mediaTypes is not correctly configured for adunit ${adUnit.code}`\r\n          );\r\n        }\r\n\r\n        if (src === 'client') {\r\n          incrementBidderRequestsCounter(adUnit.code, bidderCode);\r\n        }\r\n\r\n        bids.push(Object.assign({}, bid, {\r\n          adUnitCode: adUnit.code,\r\n          transactionId: adUnit.transactionId,\r\n          adUnitId: adUnit.adUnitId,\r\n          sizes: mediaTypes?.banner?.sizes || mediaTypes?.video?.playerSize || [],\r\n          bidId: (bid as any).bid_id || getUniqueIdentifierStr(),\r\n          bidderRequestId,\r\n          auctionId,\r\n          src,\r\n          metrics,\r\n          auctionsCount: getAuctionsCounter(adUnit.code),\r\n          bidRequestsCount: getRequestsCounter(adUnit.code),\r\n          bidderRequestsCount: getBidderRequestsCounter(adUnit.code, bid.bidder),\r\n          bidderWinsCount: getBidderWinsCounter(adUnit.code, bid.bidder),\r\n          deferBilling: !!adUnit.deferBilling\r\n        }));\r\n        return bids;\r\n      }, [])\r\n    );\r\n    return result;\r\n  }, []).reduce(flatten, []).filter(val => val !== '');\r\n}\r\n\r\n/**\r\n * Filter an adUnit's  bids for building client and/or server requests\r\n *\r\n * @param bids an array of bids as defined in an adUnit\r\n * @param s2sConfig null if the adUnit is being routed to a client adapter; otherwise the s2s adapter's config\r\n * @returns the subset of `bids` that are pertinent for the given `s2sConfig`\r\n */\r\nexport const filterBidsForAdUnit = hook('sync', function(bids, s2sConfig, {getS2SBidders = getS2SBidderSet} = {}) {\r\n  if (s2sConfig == null) {\r\n    return bids;\r\n  } else {\r\n    const serverBidders = getS2SBidders(s2sConfig);\r\n    return bids.filter((bid: BidRequest<any>) => {\r\n      if (!serverBidders.has(bid.bidder)) return false;\r\n      if (bid.s2sConfigName == null) return true;\r\n      const configName = getConfigName(s2sConfig);\r\n      const allowedS2SConfigs = Array.isArray(bid.s2sConfigName) ? bid.s2sConfigName : [bid.s2sConfigName];\r\n      return allowedS2SConfigs.includes(configName);\r\n    })\r\n  }\r\n}, 'filterBidsForAdUnit');\r\n\r\ntype PBSAdUnitBid = AdUnitBid & {\r\n  bid_id?: Identifier;\r\n};\r\n\r\ntype PBSAdUnit = Omit<AdUnit, 'bids'> & {\r\n  s2sBid?: PBSAdUnitBid;\r\n  bids: PBSAdUnitBid[];\r\n};\r\n\r\nfunction getAdUnitCopyForPrebidServer(adUnits: AdUnit[], s2sConfig) {\r\n  let adUnitsCopy = deepClone(adUnits) as PBSAdUnit[];\r\n  let hasModuleBids = false;\r\n\r\n  adUnitsCopy.forEach((adUnit) => {\r\n    // filter out client side bids\r\n    const s2sBids = adUnit.bids.filter((b) => b.module === PBS_ADAPTER_NAME && (\r\n      (b as AdUnitModuleBid).params?.configName === getConfigName(s2sConfig)\r\n    ));\r\n    if (s2sBids.length === 1) {\r\n      adUnit.s2sBid = s2sBids[0];\r\n      hasModuleBids = true;\r\n      adUnit.ortb2Imp = mergeDeep({}, adUnit.s2sBid.ortb2Imp, adUnit.ortb2Imp);\r\n    } else if (s2sBids.length > 1) {\r\n      logWarn('Multiple \"module\" bids for the same s2s configuration; all will be ignored', s2sBids);\r\n    }\r\n    adUnit.bids = filterBidsForAdUnit(adUnit.bids, s2sConfig)\r\n      .map((bid) => {\r\n        bid.bid_id = getUniqueIdentifierStr();\r\n        return bid;\r\n      });\r\n  });\r\n  adUnitsCopy = adUnitsCopy.filter(adUnit => {\r\n    if (s2sConfig.filterBidderlessCalls) {\r\n      if (adUnit.bids.length === 1 && adUnit.bids[0].bidder == null) return false;\r\n    }\r\n    return adUnit.bids.length !== 0 || adUnit.s2sBid != null;\r\n  });\r\n\r\n  // don't send empty requests\r\n  return {adUnits: adUnitsCopy, hasModuleBids};\r\n}\r\n\r\nfunction getAdUnitCopyForClientAdapters(adUnits: AdUnit[]) {\r\n  let adUnitsClientCopy = deepClone(adUnits);\r\n  adUnitsClientCopy.forEach((adUnit) => {\r\n    adUnit.bids = filterBidsForAdUnit(adUnit.bids, null);\r\n  });\r\n\r\n  // don't send empty requests\r\n  adUnitsClientCopy = adUnitsClientCopy.filter(adUnit => {\r\n    return adUnit.bids.length !== 0;\r\n  });\r\n\r\n  return adUnitsClientCopy;\r\n}\r\n\r\n/**\r\n * Filter and/or modify media types for ad units based on the given labels.\r\n *\r\n * This should return adUnits that are active for the given labels, modified to have their `mediaTypes`\r\n * conform to size mapping configuration. If different bids for the same adUnit should use different `mediaTypes`,\r\n * they should be exposed under `adUnit.bids[].mediaTypes`.\r\n */\r\nexport const setupAdUnitMediaTypes = hook('sync', (adUnits, labels) => {\r\n  return adUnits;\r\n}, 'setupAdUnitMediaTypes')\r\n\r\n/**\r\n * @param {{}|Array<{}>} s2sConfigs\r\n * @returns {Set<String>} a set of all the bidder codes that should be routed through the S2S adapter(s)\r\n *                        as defined in `s2sConfigs`\r\n */\r\nexport function getS2SBidderSet(s2sConfigs) {\r\n  if (!isArray(s2sConfigs)) s2sConfigs = [s2sConfigs];\r\n  // `null` represents the \"no bid bidder\" - when an ad unit is meant only for S2S adapters, like stored impressions\r\n  const serverBidders = new Set([null]);\r\n  s2sConfigs.filter((s2s) => s2s && s2s.enabled)\r\n    .flatMap((s2s) => s2s.bidders)\r\n    .forEach((bidder) => serverBidders.add(bidder));\r\n  return serverBidders;\r\n}\r\n\r\n/**\r\n * @param {Array} adUnits - The ad units to be processed.\r\n * @param {Object} s2sConfigs - The server-to-server configurations.\r\n * @returns {Object} - An object containing arrays of bidder codes for client and server.\r\n * @returns {Object} return.client - Array of bidder codes that should be routed to client adapters.\r\n * @returns {Object} return.server - Array of bidder codes that should be routed to server adapters.\r\n */\r\nexport function _partitionBidders (adUnits, s2sConfigs, {getS2SBidders = getS2SBidderSet} = {}) {\r\n  const serverBidders = getS2SBidders(s2sConfigs);\r\n  return getBidderCodes(adUnits).reduce((memo, bidder) => {\r\n    const partition = serverBidders.has(bidder) ? PARTITIONS.SERVER : PARTITIONS.CLIENT;\r\n    memo[partition].push(bidder);\r\n    return memo;\r\n  }, {[PARTITIONS.CLIENT]: [], [PARTITIONS.SERVER]: []})\r\n}\r\n\r\nexport const partitionBidders = hook('sync', _partitionBidders, 'partitionBidders');\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    /**\r\n     * Fired once per auction, just before bid requests are generated.\r\n     */\r\n    [EVENTS.BEFORE_REQUEST_BIDS]: [AdUnit[]];\r\n    /**\r\n     * Fired once for each bidder in each auction (or twice for bidders that are configured for both client and s2s).\r\n     */\r\n    [EVENTS.BID_REQUESTED]: [BidderRequest<BidderCode>];\r\n  }\r\n}\r\n\r\ndeclare module './hook' {\r\n  interface NamedHooks {\r\n    makeBidRequests: typeof adapterManager.makeBidRequests;\r\n  }\r\n}\r\n\r\nconst adapterManager = {\r\n  bidderRegistry: _bidderRegistry,\r\n  analyticsRegistry: _analyticsRegistry,\r\n  /**\r\n   * Map from alias codes to the bidder code they alias.\r\n   */\r\n  aliasRegistry: _aliasRegistry,\r\n  makeBidRequests: hook('sync', function (\r\n    adUnits: AdUnit[],\r\n    auctionStart: number,\r\n    auctionId: Identifier,\r\n    cbTimeout: number,\r\n    labels: string[],\r\n    ortb2Fragments: ORTBFragments = {},\r\n    auctionMetrics: Metrics\r\n  ): BidderRequest<BidderCode>[] {\r\n    auctionMetrics = useMetrics(auctionMetrics);\r\n    /**\r\n     * emit and pass adunits for external modification\r\n     * @see {@link https://github.com/prebid/Prebid.js/issues/4149|Issue}\r\n     */\r\n    events.emit(EVENTS.BEFORE_REQUEST_BIDS, adUnits);\r\n    if (FEATURES.NATIVE) {\r\n      decorateAdUnitsWithNativeParams(adUnits);\r\n    }\r\n    adUnits\r\n      .map(adUnit => adUnit.code)\r\n      .filter(uniques)\r\n      .forEach(incrementAuctionsCounter);\r\n\r\n    adUnits.forEach(au => {\r\n      if (!isPlainObject(au.mediaTypes)) {\r\n        au.mediaTypes = {};\r\n      }\r\n      // filter out bidders that cannot participate in the auction\r\n      au.bids = au.bids.filter((bid) => !bid.bidder || dep.isAllowed(ACTIVITY_FETCH_BIDS, activityParams(MODULE_TYPE_BIDDER, bid.bidder)))\r\n      incrementRequestsCounter(au.code);\r\n    });\r\n\r\n    adUnits = setupAdUnitMediaTypes(adUnits, labels);\r\n\r\n    let {[PARTITIONS.CLIENT]: clientBidders, [PARTITIONS.SERVER]: serverBidders} = partitionBidders(adUnits, _s2sConfigs);\r\n\r\n    if (config.getConfig('bidderSequence') === RANDOM) {\r\n      clientBidders = shuffle(clientBidders);\r\n    }\r\n    const refererInfo = getRefererInfo();\r\n\r\n    const bidRequests: BidderRequest<any>[] = [];\r\n\r\n    const ortb2 = ortb2Fragments.global || {};\r\n    const bidderOrtb2 = ortb2Fragments.bidder || {};\r\n\r\n    function addOrtb2<T extends BidderRequest<any>>(bidderRequest: Partial<T>, s2sActivityParams?): T {\r\n      const redact = dep.redact(\r\n        s2sActivityParams != null\r\n          ? s2sActivityParams\r\n          : activityParams(MODULE_TYPE_BIDDER, bidderRequest.bidderCode)\r\n      );\r\n      const fpd = Object.freeze(redact.ortb2(mergeDeep({source: {tid: auctionId}}, ortb2, bidderOrtb2[bidderRequest.bidderCode])));\r\n      bidderRequest.ortb2 = fpd;\r\n      bidderRequest.bids = bidderRequest.bids.map((bid) => {\r\n        bid.ortb2 = fpd;\r\n        return redact.bidRequest(bid);\r\n      })\r\n      return bidderRequest as T;\r\n    }\r\n\r\n    _s2sConfigs.forEach(s2sConfig => {\r\n      const s2sParams = s2sActivityParams(s2sConfig);\r\n      if (s2sConfig && s2sConfig.enabled && dep.isAllowed(ACTIVITY_FETCH_BIDS, s2sParams)) {\r\n        const {adUnits: adUnitsS2SCopy, hasModuleBids} = getAdUnitCopyForPrebidServer(adUnits, s2sConfig);\r\n\r\n        // uniquePbsTid is so we know which server to send which bids to during the callBids function\r\n        const uniquePbsTid = generateUUID();\r\n\r\n        (serverBidders.length === 0 && hasModuleBids ? [null] : serverBidders).forEach(bidderCode => {\r\n          const bidderRequestId = getUniqueIdentifierStr();\r\n          const metrics = auctionMetrics.fork();\r\n          const bidderRequest = addOrtb2({\r\n            bidderCode,\r\n            auctionId,\r\n            bidderRequestId,\r\n            uniquePbsTid,\r\n            bids: getBids({ bidderCode, auctionId, bidderRequestId, 'adUnits': deepClone(adUnitsS2SCopy), src: S2S.SRC, metrics }),\r\n            auctionStart: auctionStart,\r\n            timeout: s2sConfig.timeout,\r\n            src: S2S.SRC,\r\n            refererInfo,\r\n            metrics,\r\n          }, s2sParams);\r\n          if (bidderRequest.bids.length !== 0) {\r\n            bidRequests.push(bidderRequest);\r\n          }\r\n        });\r\n\r\n        // update the s2sAdUnits object and remove all bids that didn't pass sizeConfig/label checks from getBids()\r\n        // this is to keep consistency and only allow bids/adunits that passed the checks to go to pbs\r\n        adUnitsS2SCopy.forEach((adUnitCopy) => {\r\n          const validBids = adUnitCopy.bids.filter((adUnitBid) =>\r\n            bidRequests.find(request =>\r\n              request.bids.find((reqBid) => reqBid.bidId === adUnitBid.bid_id)));\r\n          adUnitCopy.bids = validBids;\r\n        });\r\n\r\n        bidRequests.forEach((request: S2SBidderRequest<any>) => {\r\n          if (request.adUnitsS2SCopy === undefined) {\r\n            request.adUnitsS2SCopy = adUnitsS2SCopy.filter(au => au.bids.length > 0 || au.s2sBid != null);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    // client adapters\r\n    const adUnitsClientCopy = getAdUnitCopyForClientAdapters(adUnits);\r\n    clientBidders.forEach(bidderCode => {\r\n      const bidderRequestId = getUniqueIdentifierStr();\r\n      const metrics = auctionMetrics.fork();\r\n      const bidderRequest = addOrtb2({\r\n        bidderCode,\r\n        auctionId,\r\n        bidderRequestId,\r\n        bids: getBids({bidderCode, auctionId, bidderRequestId, 'adUnits': deepClone(adUnitsClientCopy), src: 'client', metrics}),\r\n        auctionStart: auctionStart,\r\n        timeout: cbTimeout,\r\n        refererInfo,\r\n        metrics,\r\n      });\r\n      const adapter = _bidderRegistry[bidderCode];\r\n      if (!adapter) {\r\n        logError(`Trying to make a request for bidder that does not exist: ${bidderCode}`);\r\n      }\r\n\r\n      if (adapter && bidderRequest.bids && bidderRequest.bids.length !== 0) {\r\n        bidRequests.push(bidderRequest);\r\n      }\r\n    });\r\n\r\n    bidRequests.forEach(bidRequest => {\r\n      if (gdprDataHandler.getConsentData()) {\r\n        bidRequest['gdprConsent'] = gdprDataHandler.getConsentData();\r\n      }\r\n      if (uspDataHandler.getConsentData()) {\r\n        bidRequest['uspConsent'] = uspDataHandler.getConsentData();\r\n      }\r\n      if (gppDataHandler.getConsentData()) {\r\n        bidRequest['gppConsent'] = gppDataHandler.getConsentData();\r\n      }\r\n    });\r\n    return bidRequests;\r\n  }, 'makeBidRequests'),\r\n  callBids(adUnits, bidRequests, addBidResponse, doneCb, requestCallbacks, requestBidsTimeout, onTimelyResponse, ortb2Fragments = {}) {\r\n    if (!bidRequests.length) {\r\n      logWarn('callBids executed with no bidRequests.  Were they filtered by labels or sizing?');\r\n      return;\r\n    }\r\n\r\n    const [clientBidderRequests, serverBidderRequests] = bidRequests.reduce((partitions, bidRequest) => {\r\n      partitions[Number(typeof bidRequest.src !== 'undefined' && bidRequest.src === S2S.SRC)].push(bidRequest);\r\n      return partitions;\r\n    }, [[], []]);\r\n\r\n    var uniqueServerBidRequests = [];\r\n    serverBidderRequests.forEach(serverBidRequest => {\r\n      var index = -1;\r\n      for (var i = 0; i < uniqueServerBidRequests.length; ++i) {\r\n        if (serverBidRequest.uniquePbsTid === uniqueServerBidRequests[i].uniquePbsTid) {\r\n          index = i;\r\n          break;\r\n        }\r\n      }\r\n      if (index <= -1) {\r\n        uniqueServerBidRequests.push(serverBidRequest);\r\n      }\r\n    });\r\n\r\n    let counter = 0;\r\n\r\n    _s2sConfigs.forEach((s2sConfig) => {\r\n      if (s2sConfig && uniqueServerBidRequests[counter] && getS2SBidderSet(s2sConfig).has(uniqueServerBidRequests[counter].bidderCode)) {\r\n        // s2s should get the same client side timeout as other client side requests.\r\n        const s2sAjax = ajaxBuilder(requestBidsTimeout, requestCallbacks ? {\r\n          request: requestCallbacks.request.bind(null, 's2s'),\r\n          done: requestCallbacks.done\r\n        } : undefined);\r\n        const adaptersServerSide = s2sConfig.bidders;\r\n        const s2sAdapter = _bidderRegistry[s2sConfig.adapter];\r\n        const uniquePbsTid = uniqueServerBidRequests[counter].uniquePbsTid;\r\n        const adUnitsS2SCopy = uniqueServerBidRequests[counter].adUnitsS2SCopy;\r\n\r\n        const uniqueServerRequests = serverBidderRequests.filter(serverBidRequest => serverBidRequest.uniquePbsTid === uniquePbsTid);\r\n\r\n        if (s2sAdapter) {\r\n          const s2sBidRequest = {'ad_units': adUnitsS2SCopy, s2sConfig, ortb2Fragments, requestBidsTimeout};\r\n          if (s2sBidRequest.ad_units.length) {\r\n            const doneCbs = uniqueServerRequests.map(bidRequest => {\r\n              bidRequest.start = timestamp();\r\n              return function (timedOut, ...args) {\r\n                if (!timedOut) {\r\n                  onTimelyResponse(bidRequest.bidderRequestId);\r\n                }\r\n                doneCb.apply(bidRequest, [timedOut, ...args]);\r\n              }\r\n            });\r\n\r\n            const bidders = getBidderCodes(s2sBidRequest.ad_units).filter((bidder) => adaptersServerSide.includes(bidder));\r\n            logMessage(`CALLING S2S HEADER BIDDERS ==== ${bidders.length > 0 ? bidders.join(', ') : 'No bidder specified, using \"ortb2Imp\" definition(s) only'}`);\r\n\r\n            // fire BID_REQUESTED event for each s2s bidRequest\r\n            uniqueServerRequests.forEach(bidRequest => {\r\n              // add the new sourceTid\r\n              events.emit(EVENTS.BID_REQUESTED, { ...bidRequest, tid: bidRequest.auctionId });\r\n            });\r\n\r\n            // make bid requests\r\n            s2sAdapter.callBids(\r\n              s2sBidRequest,\r\n              serverBidderRequests,\r\n              addBidResponse,\r\n              (timedOut) => doneCbs.forEach(done => done(timedOut)),\r\n              s2sAjax\r\n            );\r\n          }\r\n        } else {\r\n          logError('missing ' + s2sConfig.adapter);\r\n        }\r\n        counter++;\r\n      }\r\n    });\r\n\r\n    // handle client adapter requests\r\n    clientBidderRequests.forEach(bidderRequest => {\r\n      bidderRequest.start = timestamp();\r\n      const adapter = _bidderRegistry[bidderRequest.bidderCode];\r\n      config.runWithBidder(bidderRequest.bidderCode, () => {\r\n        logMessage(`CALLING BIDDER`);\r\n        events.emit(EVENTS.BID_REQUESTED, bidderRequest);\r\n      });\r\n      const ajax = ajaxBuilder(requestBidsTimeout, requestCallbacks ? {\r\n        request: requestCallbacks.request.bind(null, bidderRequest.bidderCode),\r\n        done: requestCallbacks.done\r\n      } : undefined);\r\n      const adapterDone = doneCb.bind(bidderRequest);\r\n      try {\r\n        config.runWithBidder(\r\n          bidderRequest.bidderCode,\r\n          adapter.callBids.bind(\r\n            adapter,\r\n            bidderRequest,\r\n            addBidResponse,\r\n            adapterDone,\r\n            ajax,\r\n            () => onTimelyResponse(bidderRequest.bidderRequestId),\r\n            config.callbackWithBidder(bidderRequest.bidderCode)\r\n          )\r\n        );\r\n      } catch (e) {\r\n        logError(`${bidderRequest.bidderCode} Bid Adapter emitted an uncaught error when parsing their bidRequest`, {e, bidRequest: bidderRequest});\r\n        adapterDone();\r\n      }\r\n    })\r\n  },\r\n  videoAdapters: [],\r\n  registerBidAdapter(bidAdapter, bidderCode, {supportedMediaTypes = []} = {}) {\r\n    if (bidAdapter && bidderCode) {\r\n      if (typeof bidAdapter.callBids === 'function') {\r\n        _bidderRegistry[bidderCode] = bidAdapter;\r\n        GDPR_GVLIDS.register(MODULE_TYPE_BIDDER, bidderCode, bidAdapter.getSpec?.().gvlid);\r\n\r\n        if (FEATURES.VIDEO && supportedMediaTypes.includes('video')) {\r\n          adapterManager.videoAdapters.push(bidderCode);\r\n        }\r\n        if (FEATURES.NATIVE && supportedMediaTypes.includes('native')) {\r\n          nativeAdapters.push(bidderCode);\r\n        }\r\n      } else {\r\n        logError('Bidder adaptor error for bidder code: ' + bidderCode + 'bidder must implement a callBids() function');\r\n      }\r\n    } else {\r\n      logError('bidAdapter or bidderCode not specified');\r\n    }\r\n  },\r\n  aliasBidAdapter(bidderCode: BidderCode, alias: BidderCode, options?: AliasBidderOptions) {\r\n    const existingAlias = _bidderRegistry[alias];\r\n\r\n    if (typeof existingAlias === 'undefined') {\r\n      const bidAdapter = _bidderRegistry[bidderCode];\r\n      if (typeof bidAdapter === 'undefined') {\r\n        // check if alias is part of s2sConfig and allow them to register if so (as base bidder may be s2s-only)\r\n        const nonS2SAlias = [];\r\n        _s2sConfigs.forEach(s2sConfig => {\r\n          if (s2sConfig.bidders && s2sConfig.bidders.length) {\r\n            const s2sBidders = s2sConfig && s2sConfig.bidders;\r\n            if (!(s2sConfig && s2sBidders.includes(alias))) {\r\n              nonS2SAlias.push(bidderCode);\r\n            } else {\r\n              _aliasRegistry[alias] = bidderCode;\r\n            }\r\n          }\r\n        });\r\n        nonS2SAlias.forEach(bidderCode => {\r\n          logError('bidderCode \"' + bidderCode + '\" is not an existing bidder.', 'adapterManager.aliasBidAdapter');\r\n        });\r\n      } else {\r\n        try {\r\n          let newAdapter;\r\n          const supportedMediaTypes = getSupportedMediaTypes(bidderCode);\r\n          // Have kept old code to support backward compatibilitiy.\r\n          // Remove this if loop when all adapters are supporting bidderFactory. i.e When Prebid.js is 1.0\r\n          if (bidAdapter.constructor.prototype != Object.prototype) {\r\n            newAdapter = new bidAdapter.constructor();\r\n            newAdapter.setBidderCode(alias);\r\n          } else {\r\n            const { useBaseGvlid = false } = options || {};\r\n            const spec = bidAdapter.getSpec();\r\n            const gvlid = useBaseGvlid ? spec.gvlid : options?.gvlid;\r\n            if (gvlid == null && spec.gvlid != null) {\r\n              logWarn(`Alias '${alias}' will NOT re-use the GVL ID of the original adapter ('${spec.code}', gvlid: ${spec.gvlid}). Functionality that requires TCF consent may not work as expected.`)\r\n            }\r\n\r\n            const skipPbsAliasing = options && options.skipPbsAliasing;\r\n            newAdapter = newBidder(Object.assign({}, spec, { code: alias, gvlid, skipPbsAliasing }));\r\n            _aliasRegistry[alias] = bidderCode;\r\n          }\r\n          adapterManager.registerBidAdapter(newAdapter, alias, {\r\n            supportedMediaTypes\r\n          });\r\n        } catch (e) {\r\n          logError(bidderCode + ' bidder does not currently support aliasing.', 'adapterManager.aliasBidAdapter');\r\n        }\r\n      }\r\n    } else {\r\n      logMessage('alias name \"' + alias + '\" has been already specified.');\r\n    }\r\n  },\r\n  resolveAlias(alias) {\r\n    let code = alias;\r\n    let visited;\r\n    while (_aliasRegistry[code] && (!visited || !visited.has(code))) {\r\n      code = _aliasRegistry[code];\r\n      (visited = visited || new Set()).add(code);\r\n    }\r\n    return code;\r\n  },\r\n  registerAnalyticsAdapter<P extends AnalyticsProvider>({adapter, code, gvlid}: {\r\n    adapter: AnalyticsAdapter<P>,\r\n    code: P,\r\n    gvlid?: number\r\n  }) {\r\n    if (adapter && code) {\r\n      if (typeof adapter.enableAnalytics === 'function') {\r\n        adapter.code = code;\r\n        _analyticsRegistry[code] = { adapter, gvlid };\r\n        GDPR_GVLIDS.register(MODULE_TYPE_ANALYTICS, code, gvlid);\r\n      } else {\r\n        logError(`Prebid Error: Analytics adaptor error for analytics \"${code}\"\r\n        analytics adapter must implement an enableAnalytics() function`);\r\n      }\r\n    } else {\r\n      logError('Prebid Error: analyticsAdapter or analyticsCode not specified');\r\n    }\r\n  },\r\n  enableAnalytics(\r\n    config: AnalyticsConfig<keyof AnalyticsProviderConfig>\r\n            | AnalyticsConfig<AnalyticsProvider>\r\n            | AnalyticsConfig<AnalyticsProvider>[]\r\n  ) {\r\n    if (!isArray(config)) {\r\n      config = [config];\r\n    }\r\n\r\n    config.forEach(adapterConfig => {\r\n      const entry = _analyticsRegistry[adapterConfig.provider];\r\n      if (entry && entry.adapter) {\r\n        if (dep.isAllowed(ACTIVITY_REPORT_ANALYTICS, activityParams(MODULE_TYPE_ANALYTICS, adapterConfig.provider, {[ACTIVITY_PARAM_ANL_CONFIG]: adapterConfig}))) {\r\n          entry.adapter.enableAnalytics(adapterConfig);\r\n        }\r\n      } else {\r\n        logError(`Prebid Error: no analytics adapter found in registry for '${adapterConfig.provider}'.`);\r\n      }\r\n    });\r\n  },\r\n  getBidAdapter(bidder) {\r\n    return _bidderRegistry[bidder];\r\n  },\r\n  getAnalyticsAdapter(code) {\r\n    return _analyticsRegistry[code];\r\n  },\r\n  callTimedOutBidders(adUnits, timedOutBidders, cbTimeout) {\r\n    timedOutBidders = timedOutBidders.map((timedOutBidder) => {\r\n      // Adding user configured params & timeout to timeout event data\r\n      timedOutBidder.params = getUserConfiguredParams(adUnits, timedOutBidder.adUnitCode, timedOutBidder.bidder);\r\n      timedOutBidder.timeout = cbTimeout;\r\n      return timedOutBidder;\r\n    });\r\n    timedOutBidders = groupBy(timedOutBidders, 'bidder');\r\n\r\n    Object.keys(timedOutBidders).forEach((bidder) => {\r\n      tryCallBidderMethod(bidder, 'onTimeout', timedOutBidders[bidder]);\r\n    });\r\n  },\r\n  callBidWonBidder(bidder, bid, adUnits) {\r\n    // Adding user configured params to bidWon event data\r\n    bid.params = getUserConfiguredParams(adUnits, bid.adUnitCode, bid.bidder);\r\n    incrementBidderWinsCounter(bid.adUnitCode, bid.bidder);\r\n    tryCallBidderMethod(bidder, 'onBidWon', bid);\r\n  },\r\n  triggerBilling: (() => {\r\n    const BILLED = new WeakSet();\r\n    return (bid) => {\r\n      if (!BILLED.has(bid)) {\r\n        BILLED.add(bid);\r\n        (parseEventTrackers(bid.eventtrackers)[EVENT_TYPE_IMPRESSION]?.[TRACKER_METHOD_IMG] || [])\r\n          .forEach((url) => internal.triggerPixel(url));\r\n        tryCallBidderMethod(bid.bidder, 'onBidBillable', bid);\r\n      }\r\n    }\r\n  })(),\r\n  callSetTargetingBidder(bidder, bid) {\r\n    tryCallBidderMethod(bidder, 'onSetTargeting', bid);\r\n  },\r\n  callBidViewableBidder(bidder, bid) {\r\n    tryCallBidderMethod(bidder, 'onBidViewable', bid);\r\n  },\r\n  callBidderError(bidder, error, bidderRequest) {\r\n    const param = { error, bidderRequest };\r\n    tryCallBidderMethod(bidder, 'onBidderError', param);\r\n  },\r\n  callAdRenderSucceededBidder(bidder, bid) {\r\n    tryCallBidderMethod(bidder, 'onAdRenderSucceeded', bid);\r\n  },\r\n  /**\r\n   * Ask every adapter to delete PII.\r\n   * See https://github.com/prebid/Prebid.js/issues/9081\r\n   */\r\n  callDataDeletionRequest: hook('sync', function (...args) {\r\n    const method = 'onDataDeletionRequest';\r\n    Object.keys(_bidderRegistry)\r\n      .filter((bidder) => !_aliasRegistry.hasOwnProperty(bidder))\r\n      .forEach(bidder => {\r\n        const target = getBidderMethod(bidder, method);\r\n        if (target != null) {\r\n          const bidderRequests = auctionManager.getBidsRequested().filter((br) =>\r\n            resolveAlias(br.bidderCode) === bidder\r\n          );\r\n          invokeBidderMethod(bidder, method, ...target, bidderRequests, ...args);\r\n        }\r\n      });\r\n    Object.entries(_analyticsRegistry).forEach(([name, entry]: any) => {\r\n      const fn = entry?.adapter?.[method];\r\n      if (typeof fn === 'function') {\r\n        try {\r\n          fn.apply(entry.adapter, args);\r\n        } catch (e) {\r\n          logError(`error calling ${method} of ${name}`, e);\r\n        }\r\n      }\r\n    });\r\n  })\r\n\r\n}\r\n\r\nfunction getSupportedMediaTypes(bidderCode) {\r\n  const supportedMediaTypes = [];\r\n  if (FEATURES.VIDEO && adapterManager.videoAdapters.includes(bidderCode)) supportedMediaTypes.push('video');\r\n  if (FEATURES.NATIVE && nativeAdapters.includes(bidderCode)) supportedMediaTypes.push('native');\r\n  return supportedMediaTypes;\r\n}\r\n\r\nfunction getBidderMethod(bidder, method): [string, string] {\r\n  const adapter = _bidderRegistry[bidder];\r\n  const spec = adapter?.getSpec && adapter.getSpec();\r\n  if (spec && spec[method] && typeof spec[method] === 'function') {\r\n    return [spec, spec[method]]\r\n  }\r\n}\r\n\r\nfunction invokeBidderMethod(bidder, method, spec, fn, ...params) {\r\n  try {\r\n    logInfo(`Invoking ${bidder}.${method}`);\r\n    config.runWithBidder(bidder, fn.bind(spec, ...params));\r\n  } catch (e) {\r\n    logWarn(`Error calling ${method} of ${bidder}`);\r\n  }\r\n}\r\n\r\nfunction tryCallBidderMethod(bidder, method, param) {\r\n  if (param?.source !== S2S.SRC) {\r\n    const target = getBidderMethod(bidder, method);\r\n    if (target != null) {\r\n      invokeBidderMethod(bidder, method, ...target, param);\r\n    }\r\n  }\r\n}\r\n\r\nfunction resolveAlias(alias) {\r\n  const seen = new Set();\r\n  while (_aliasRegistry.hasOwnProperty(alias) && !seen.has(alias)) {\r\n    seen.add(alias);\r\n    alias = _aliasRegistry[alias];\r\n  }\r\n  return alias;\r\n}\r\n\r\nexport default adapterManager;\r\n","import Adapter from '../adapter.js';\r\nimport adapterManager, {\r\n  type BidderRequest,\r\n  type BidRequest,\r\n  type ClientBidderRequest\r\n} from '../adapterManager.js';\r\nimport {config} from '../config.js';\r\nimport {BannerBid, Bid, BidResponse, createBid} from '../bidfactory.js';\r\nimport {type SyncType, userSync} from '../userSync.js';\r\nimport {nativeBidIsValid} from '../native.js';\r\nimport {isValidVideoBid} from '../video.js';\r\nimport {EVENTS, REJECTION_REASON, DEBUG_MODE} from '../constants.js';\r\nimport * as events from '../events.js';\r\n\r\nimport {\r\n  delayExecution,\r\n  isArray,\r\n  isPlainObject,\r\n  logError,\r\n  logWarn,\r\n  memoize,\r\n  parseQueryStringParameters,\r\n  parseSizesInput,\r\n  pick,\r\n  uniques,\r\n  isGzipCompressionSupported,\r\n  compressDataWithGZip,\r\n  getParameterByName,\r\n  debugTurnedOn\r\n} from '../utils.js';\r\nimport {hook} from '../hook.js';\r\nimport {auctionManager} from '../auctionManager.js';\r\nimport {bidderSettings} from '../bidderSettings.js';\r\nimport {useMetrics} from '../utils/perfMetrics.js';\r\nimport {isActivityAllowed} from '../activities/rules.js';\r\nimport {activityParams} from '../activities/activityParams.js';\r\nimport {MODULE_TYPE_BIDDER} from '../activities/modules.js';\r\nimport {ACTIVITY_TRANSMIT_TID, ACTIVITY_TRANSMIT_UFPD} from '../activities/activities.js';\r\nimport type {AnyFunction, Wraps} from \"../types/functions.d.ts\";\r\nimport type {BidderCode, StorageDisclosure} from \"../types/common.d.ts\";\r\nimport type {Ajax, AjaxOptions, XHR} from \"../ajax.ts\";\r\nimport type {AddBidResponse} from \"../auction.ts\";\r\nimport type {MediaType} from \"../mediaTypes.ts\";\r\nimport {CONSENT_GDPR, CONSENT_GPP, CONSENT_USP, type ConsentData} from \"../consentHandler.ts\";\r\n\r\n/**\r\n * This file aims to support Adapters during the Prebid 0.x -> 1.x transition.\r\n *\r\n * Prebid 1.x and Prebid 0.x will be in separate branches--perhaps for a long time.\r\n * This function defines an API for adapter construction which is compatible with both versions.\r\n * Adapters which use it can maintain their code in master, and only this file will need to change\r\n * in the 1.x branch.\r\n *\r\n * Typical usage looks something like:\r\n *\r\n * const adapter = registerBidder({\r\n *   code: 'myBidderCode',\r\n *   aliases: ['alias1', 'alias2'],\r\n *   supportedMediaTypes: ['video', 'native'],\r\n *   isBidRequestValid: function(paramsObject) { return true/false },\r\n *   buildRequests: function(bidRequests, bidderRequest) { return some ServerRequest(s) },\r\n *   interpretResponse: function(oneServerResponse) { return some Bids, or throw an error. }\r\n * });\r\n *\r\n * @see BidderSpec for the full API and more thorough descriptions.\r\n *\r\n */\r\n\r\n/**\r\n * @typedef {object} ServerResponse\r\n *\r\n * @property {*} body The response body. If this is legal JSON, then it will be parsed. Otherwise it'll be a\r\n *   string with the body's content.\r\n * @property {{get: function(string): string}} headers The response headers.\r\n *   Call this like `ServerResponse.headers.get(\"Content-Type\")`\r\n */\r\n\r\n/**\r\n * @typedef {Object} SyncOptions\r\n *\r\n * An object containing information about usersyncs which the adapter should obey.\r\n *\r\n * @property {boolean} iframeEnabled True if iframe usersyncs are allowed, and false otherwise\r\n * @property {boolean} pixelEnabled True if image usersyncs are allowed, and false otherwise\r\n */\r\n\r\n/**\r\n * TODO: Move this to the UserSync module after that PR is merged.\r\n *\r\n * @typedef {object} UserSync\r\n *\r\n * @property {('image'|'iframe')} type The type of user sync to be done.\r\n * @property {string} url The URL which makes the sync happen.\r\n */\r\n\r\n// common params for all mediaTypes\r\nconst COMMON_BID_RESPONSE_KEYS = ['cpm', 'ttl', 'creativeId', 'netRevenue', 'currency'];\r\nconst TIDS = ['auctionId', 'transactionId'];\r\n\r\nexport interface AdapterRequest {\r\n  url: string;\r\n  data: any;\r\n  method?: 'GET' | 'POST';\r\n  options?: Omit<AjaxOptions, 'method'> & { endpointCompression?: boolean };\r\n}\r\n\r\nexport interface ServerResponse {\r\n  body: any;\r\n  headers: {\r\n    get(header: string): string;\r\n  }\r\n}\r\n\r\nexport interface ExtendedResponse {\r\n  bids?: BidResponse[]\r\n}\r\n\r\nexport type AdapterResponse = BidResponse | BidResponse[] | ExtendedResponse;\r\n\r\nexport type BidderError<B extends BidderCode> = {\r\n  error: XHR;\r\n  bidderRequest: BidderRequest<B>;\r\n}\r\n\r\nexport interface BidderSpec<BIDDER extends BidderCode> extends StorageDisclosure {\r\n  code: BIDDER;\r\n  supportedMediaTypes?: readonly MediaType[];\r\n  aliases?: readonly (BidderCode | { code: BidderCode, gvlid?: number, skipPbsAliasing?: boolean })[];\r\n  isBidRequestValid(request: BidRequest<BIDDER>): boolean;\r\n  buildRequests(validBidRequests: BidRequest<BIDDER>[], bidderRequest: ClientBidderRequest<BIDDER>): AdapterRequest | AdapterRequest[];\r\n  interpretResponse(response: ServerResponse, request: AdapterRequest): AdapterResponse;\r\n  onBidWon?: (bid: Bid) => void;\r\n  onBidBillable?: (bid: Bid) => void;\r\n  onBidderError?: (error: BidderError<BIDDER>) => void;\r\n  onBidViewable?: (bid: Bid) => void;\r\n  onSetTargeting?: (bid: Bid) => void;\r\n  onAdRenderSucceeded?: (bid: Bid) => void;\r\n  onDataDeletionRequest?: (bidderRequests: BidderRequest<BIDDER>[], cmpRegisterDeletionResponse: any) => void;\r\n  onTimeout?: (bidRequests: (BidRequest<BIDDER> & { timeout: number })[]) => void;\r\n  getUserSyncs?: (\r\n    syncOptions: {\r\n      iframeEnabled: boolean;\r\n      pixelEnabled: boolean;\r\n    },\r\n    responses: ServerResponse[],\r\n    gdprConsent: null | ConsentData[typeof CONSENT_GDPR],\r\n    uspConsent: null | ConsentData[typeof CONSENT_USP],\r\n    gppConsent: null | ConsentData[typeof CONSENT_GPP]\r\n  ) => ({ type: SyncType, url: string })[];\r\n}\r\n\r\nexport type BidAdapter = {\r\n  callBids: ReturnType<typeof newBidder>['callBids']\r\n}\r\n\r\n/**\r\n * Register a bidder with prebid, using the given spec.\r\n *\r\n * If possible, Adapter modules should use this function instead of adapterManager.registerBidAdapter().\r\n *\r\n * @param {BidderSpec} spec An object containing the bare-bones functions we need to make a Bidder.\r\n */\r\nexport function registerBidder<B extends BidderCode>(spec: BidderSpec<B>) {\r\n  const mediaTypes = Array.isArray(spec.supportedMediaTypes)\r\n    ? { supportedMediaTypes: spec.supportedMediaTypes }\r\n    : undefined;\r\n  function putBidder(spec) {\r\n    const bidder = newBidder(spec);\r\n    adapterManager.registerBidAdapter(bidder, spec.code, mediaTypes);\r\n  }\r\n\r\n  putBidder(spec);\r\n  if (Array.isArray(spec.aliases)) {\r\n    spec.aliases.forEach(alias => {\r\n      let aliasCode: string = alias as any;\r\n      let gvlid;\r\n      let skipPbsAliasing;\r\n      if (isPlainObject(alias)) {\r\n        aliasCode = alias.code as string;\r\n        gvlid = alias.gvlid;\r\n        skipPbsAliasing = alias.skipPbsAliasing\r\n      }\r\n      adapterManager.aliasRegistry[aliasCode] = spec.code;\r\n      putBidder(Object.assign({}, spec, { code: aliasCode, gvlid, skipPbsAliasing }));\r\n    });\r\n  }\r\n}\r\n\r\nexport const guardTids: any = memoize(({bidderCode}) => {\r\n  if (isActivityAllowed(ACTIVITY_TRANSMIT_TID, activityParams(MODULE_TYPE_BIDDER, bidderCode))) {\r\n    return {\r\n      bidRequest: (br) => br,\r\n      bidderRequest: (br) => br\r\n    };\r\n  }\r\n  function get(target, prop, receiver) {\r\n    if (TIDS.includes(prop)) {\r\n      return null;\r\n    }\r\n    return Reflect.get(target, prop, receiver);\r\n  }\r\n  function privateAccessProxy(target, handler) {\r\n    const proxy = new Proxy(target, handler);\r\n    // always allow methods (such as getFloor) private access to TIDs\r\n    Object.entries(target)\r\n      .filter(([_, v]) => typeof v === 'function')\r\n      .forEach(([prop, fn]: [string, AnyFunction]) => {\r\n        proxy[prop] = fn.bind(target);\r\n      });\r\n    return proxy;\r\n  }\r\n  const bidRequest = memoize((br) => privateAccessProxy(br, {get}), (arg) => arg.bidId);\r\n  /**\r\n   * Return a view on bidd(er) requests where auctionId/transactionId are nulled if the bidder is not allowed `transmitTid`.\r\n   *\r\n   * Because both auctionId and transactionId are used for Prebid's own internal bookkeeping, we cannot simply erase them\r\n   * from request objects; and because request objects are quite complex and not easily cloneable, we hide the IDs\r\n   * with a proxy instead. This should be used only around the adapter logic.\r\n   */\r\n  return {\r\n    bidRequest,\r\n    bidderRequest: (br) => privateAccessProxy(br, {\r\n      get(target, prop, receiver) {\r\n        if (prop === 'bids') return br.bids.map(bidRequest);\r\n        return get(target, prop, receiver);\r\n      }\r\n    })\r\n  }\r\n});\r\n\r\ndeclare module '../events' {\r\n  interface Events {\r\n    /**\r\n     * Fired once for each bidder in each auction (or twice if the bidder is configured for both client and s2s),\r\n     * after processing for that bidder (for that auction) is complete.\r\n     */\r\n    [EVENTS.BIDDER_DONE]: [BidderRequest<BidderCode>];\r\n    /**\r\n     * Fired just before a client bid adapter makes an HTTP request to its exchange.\r\n     */\r\n    [EVENTS.BEFORE_BIDDER_HTTP]: [BidderRequest<BidderCode>, AdapterRequest]\r\n    /**\r\n     * Fired when a bid adapter's HTTP request results in something other than HTTP 2xx or 304.\r\n     * In the case of Prebid Server, this is repeated for each s2s bidder.\r\n     */\r\n    [EVENTS.BIDDER_ERROR]: [BidderError<BidderCode>];\r\n  }\r\n}\r\n\r\n/**\r\n * Make a new bidder from the given spec. This is exported mainly for testing.\r\n * Adapters will probably find it more convenient to use registerBidder instead.\r\n *\r\n * @param {BidderSpec} spec\r\n */\r\nexport function newBidder<B extends BidderCode>(spec: BidderSpec<B>) {\r\n  return Object.assign(Adapter(spec.code), {\r\n    getSpec: function(): BidderSpec<B> {\r\n      return Object.freeze(Object.assign({}, spec));\r\n    },\r\n    registerSyncs,\r\n    callBids: function(\r\n      bidderRequest: ClientBidderRequest<B>,\r\n      addBidResponse: AddBidResponse,\r\n      done: () => void,\r\n      ajax: Ajax,\r\n      onTimelyResponse: (bidder: BidderCode) => void,\r\n      configEnabledCallback: <T extends AnyFunction>(fn: T) => Wraps<T>\r\n    ) {\r\n      if (!Array.isArray(bidderRequest.bids)) {\r\n        return;\r\n      }\r\n      const tidGuard = guardTids(bidderRequest);\r\n\r\n      const adUnitCodesHandled = {};\r\n      function addBidWithCode(adUnitCode: string, bid: Bid) {\r\n        const metrics = useMetrics(bid.metrics);\r\n        metrics.checkpoint('addBidResponse');\r\n        adUnitCodesHandled[adUnitCode] = true;\r\n        if (metrics.measureTime('addBidResponse.validate', () => isValid(adUnitCode, bid))) {\r\n          addBidResponse(adUnitCode, bid);\r\n        } else {\r\n          addBidResponse.reject(adUnitCode, bid, REJECTION_REASON.INVALID)\r\n        }\r\n      }\r\n\r\n      // After all the responses have come back, call done() and\r\n      // register any required usersync pixels.\r\n      const responses = [];\r\n      function afterAllResponses() {\r\n        done();\r\n        config.runWithBidder(spec.code, () => {\r\n          events.emit(EVENTS.BIDDER_DONE, bidderRequest);\r\n          registerSyncs(responses, bidderRequest.gdprConsent, bidderRequest.uspConsent, bidderRequest.gppConsent);\r\n        });\r\n      }\r\n\r\n      const validBidRequests = adapterMetrics(bidderRequest)\r\n        .measureTime('validate', () => bidderRequest.bids.filter((br) => filterAndWarn(tidGuard.bidRequest(br))));\r\n\r\n      if (validBidRequests.length === 0) {\r\n        afterAllResponses();\r\n        return;\r\n      }\r\n      const bidRequestMap = {};\r\n      validBidRequests.forEach(bid => {\r\n        bidRequestMap[bid.bidId] = bid;\r\n      });\r\n\r\n      processBidderRequests(spec, validBidRequests as any, bidderRequest, ajax, configEnabledCallback, {\r\n        onRequest: requestObject => events.emit(EVENTS.BEFORE_BIDDER_HTTP, bidderRequest, requestObject),\r\n        onResponse: (resp) => {\r\n          onTimelyResponse(spec.code);\r\n          responses.push(resp)\r\n        },\r\n        onPaapi: (paapiConfig: any) => {\r\n          const bidRequest = bidRequestMap[paapiConfig.bidId];\r\n          if (bidRequest) {\r\n            addPaapiConfig(bidRequest, paapiConfig);\r\n          } else {\r\n            logWarn('Received fledge auction configuration for an unknown bidId', paapiConfig);\r\n          }\r\n        },\r\n        // If the server responds with an error, there's not much we can do beside logging.\r\n        onError: (errorMessage, error) => {\r\n          if (!error.timedOut) {\r\n            onTimelyResponse(spec.code);\r\n          }\r\n          adapterManager.callBidderError(spec.code, error, bidderRequest)\r\n          events.emit(EVENTS.BIDDER_ERROR, { error, bidderRequest });\r\n          logError(`Server call for ${spec.code} failed: ${errorMessage} ${error.status}. Continuing without bids.`, {bidRequests: validBidRequests});\r\n        },\r\n        onBid: (bidResponse) => {\r\n          const bidRequest = bidRequestMap[bidResponse.requestId];\r\n          const bid = bidResponse as Bid;\r\n          if (bidRequest) {\r\n            bid.adapterCode = bidRequest.bidder;\r\n            if (isInvalidAlternateBidder(bidResponse.bidderCode, bidRequest.bidder)) {\r\n              logWarn(`${bidResponse.bidderCode} is not a registered partner or known bidder of ${bidRequest.bidder}, hence continuing without bid. If you wish to support this bidder, please mark allowAlternateBidderCodes as true in bidderSettings.`);\r\n              addBidResponse.reject(bidRequest.adUnitCode, bidResponse, REJECTION_REASON.BIDDER_DISALLOWED)\r\n              return;\r\n            }\r\n            // creating a copy of original values as cpm and currency are modified later\r\n            bid.originalCpm = bidResponse.cpm;\r\n            bid.originalCurrency = bidResponse.currency;\r\n            bid.meta = bidResponse.meta || Object.assign({}, bidResponse[bidRequest.bidder]);\r\n            bid.deferBilling = bidRequest.deferBilling;\r\n            bid.deferRendering = bid.deferBilling && (bidResponse.deferRendering ?? typeof spec.onBidBillable !== 'function');\r\n            const prebidBid: Bid = Object.assign(createBid(bidRequest), bid, pick(bidRequest, TIDS));\r\n            addBidWithCode(bidRequest.adUnitCode, prebidBid);\r\n          } else {\r\n            logWarn(`Bidder ${spec.code} made bid for unknown request ID: ${bidResponse.requestId}. Ignoring.`);\r\n            addBidResponse.reject(null, bidResponse, REJECTION_REASON.INVALID_REQUEST_ID);\r\n          }\r\n        },\r\n        onCompletion: afterAllResponses,\r\n      });\r\n    }\r\n  });\r\n\r\n  function isInvalidAlternateBidder(responseBidder, requestBidder) {\r\n    const allowAlternateBidderCodes = bidderSettings.get(requestBidder, 'allowAlternateBidderCodes') || false;\r\n    let alternateBiddersList = bidderSettings.get(requestBidder, 'allowedAlternateBidderCodes');\r\n    if (!!responseBidder && !!requestBidder && requestBidder !== responseBidder) {\r\n      alternateBiddersList = isArray(alternateBiddersList) ? alternateBiddersList.map(val => val.trim().toLowerCase()).filter(val => !!val).filter(uniques) : alternateBiddersList;\r\n      if (!allowAlternateBidderCodes || (isArray(alternateBiddersList) && (alternateBiddersList[0] !== '*' && !alternateBiddersList.includes(responseBidder)))) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  function registerSyncs(responses, gdprConsent, uspConsent, gppConsent) {\r\n    registerSyncInner(spec, responses, gdprConsent, uspConsent, gppConsent);\r\n  }\r\n\r\n  function filterAndWarn(bid) {\r\n    if (!spec.isBidRequestValid(bid)) {\r\n      logWarn(`Invalid bid sent to bidder ${spec.code}: ${JSON.stringify(bid)}`);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\nconst RESPONSE_PROPS = ['bids', 'paapi']\r\n/**\r\n * Run a set of bid requests - that entails converting them to HTTP requests, sending\r\n * them over the network, and parsing the responses.\r\n *\r\n * @param spec bid adapter spec\r\n * @param bids bid requests to run\r\n * @param bidderRequest the bid request object that `bids` is connected to\r\n * @param ajax ajax method to use\r\n * @param wrapCallback a function used to wrap every callback (for the purpose of `config.currentBidder`)\r\n */\r\nexport const processBidderRequests = hook('async', function<B extends BidderCode>(\r\n  spec: BidderSpec<B>,\r\n  bids: BidRequest<B>[],\r\n  bidderRequest: ClientBidderRequest<B>,\r\n  ajax: Ajax,\r\n  wrapCallback: <T extends AnyFunction>(fn: T) => Wraps<T>,\r\n  {onRequest, onResponse, onPaapi, onError, onBid, onCompletion}: {\r\n    /**\r\n     * invoked once for each HTTP request built by the adapter - with the raw request\r\n     */\r\n    onRequest: (request: AdapterRequest) => void;\r\n    /**\r\n     * invoked once on each successful HTTP response - with the raw response\r\n     */\r\n    onResponse: (response: ServerResponse) => void;\r\n    /**\r\n     * invoked once for each HTTP error - with status description and response\r\n     */\r\n    onError: (errorMessage: string, xhr: XHR) => void;\r\n    /**\r\n     *  invoked once for each bid in the response - with the bid as returned by interpretResponse\r\n     */\r\n    onBid: (bid: BidResponse) => void;\r\n    /**\r\n     * invoked once with each member of the adapter response's 'paapi' array.\r\n     */\r\n    onPaapi: (paapi: unknown) => void;\r\n    /**\r\n     * invoked once when all bid requests have been processed\r\n     */\r\n    onCompletion: () => void;\r\n  }) {\r\n  const metrics = adapterMetrics(bidderRequest);\r\n  onCompletion = metrics.startTiming('total').stopBefore(onCompletion);\r\n  const tidGuard = guardTids(bidderRequest);\r\n  let requests = metrics.measureTime('buildRequests', () => spec.buildRequests(bids.map(tidGuard.bidRequest), tidGuard.bidderRequest(bidderRequest))) as AdapterRequest[];\r\n  if (!Array.isArray(requests)) {\r\n    requests = [requests];\r\n  }\r\n\r\n  if (!requests || requests.length === 0) {\r\n    onCompletion();\r\n    return;\r\n  }\r\n\r\n  const requestDone = delayExecution(onCompletion, requests.length);\r\n\r\n  requests.forEach((request) => {\r\n    const requestMetrics = metrics.fork();\r\n    function addBid(bid) {\r\n      if (bid != null) bid.metrics = requestMetrics.fork().renameWith();\r\n      onBid(bid);\r\n    }\r\n    // If the server responds successfully, use the adapter code to unpack the Bids from it.\r\n    // If the adapter code fails, no bids should be added. After all the bids have been added,\r\n    // make sure to call the `requestDone` function so that we're one step closer to calling onCompletion().\r\n    const onSuccess = wrapCallback(function(response, responseObj) {\r\n      networkDone();\r\n      try {\r\n        response = JSON.parse(response);\r\n      } catch (e) { /* response might not be JSON... that's ok. */ }\r\n\r\n      // Make response headers available for #1742. These are lazy-loaded because most adapters won't need them.\r\n      response = {\r\n        body: response,\r\n        headers: headerParser(responseObj)\r\n      };\r\n      onResponse(response);\r\n\r\n      try {\r\n        response = requestMetrics.measureTime('interpretResponse', () => spec.interpretResponse(response, request));\r\n      } catch (err) {\r\n        logError(`Bidder ${spec.code} failed to interpret the server's response. Continuing without bids`, null, err);\r\n        requestDone();\r\n        return;\r\n      }\r\n\r\n      // adapters can reply with:\r\n      // a single bid\r\n      // an array of bids\r\n      // a BidderAuctionResponse object\r\n\r\n      let bids, paapiConfigs;\r\n      if (response && !Object.keys(response).some(key => !RESPONSE_PROPS.includes(key))) {\r\n        bids = response.bids;\r\n        paapiConfigs = response.paapi;\r\n      } else {\r\n        bids = response;\r\n      }\r\n      if (isArray(paapiConfigs)) {\r\n        paapiConfigs.forEach(onPaapi);\r\n      }\r\n      if (bids) {\r\n        if (isArray(bids)) {\r\n          bids.forEach(addBid);\r\n        } else {\r\n          addBid(bids);\r\n        }\r\n      }\r\n      requestDone();\r\n\r\n      function headerParser(xmlHttpResponse) {\r\n        return {\r\n          get: responseObj.getResponseHeader.bind(responseObj)\r\n        };\r\n      }\r\n    });\r\n\r\n    const onFailure = wrapCallback(function (errorMessage, error) {\r\n      networkDone();\r\n      onError(errorMessage, error);\r\n      requestDone();\r\n    });\r\n\r\n    onRequest(request);\r\n\r\n    const networkDone = requestMetrics.startTiming('net');\r\n\r\n    const debugMode = getParameterByName(DEBUG_MODE).toUpperCase() === 'TRUE' || debugTurnedOn();\r\n\r\n    function getOptions(defaults) {\r\n      const ro = request.options;\r\n      return Object.assign(defaults, ro, {\r\n        browsingTopics: ro?.hasOwnProperty('browsingTopics') && !ro.browsingTopics\r\n          ? false\r\n          : (bidderSettings.get(spec.code, 'topicsHeader') ?? true) && isActivityAllowed(ACTIVITY_TRANSMIT_UFPD, activityParams(MODULE_TYPE_BIDDER, spec.code)),\r\n        suppressTopicsEnrollmentWarning: ro?.hasOwnProperty('suppressTopicsEnrollmentWarning')\r\n          ? ro.suppressTopicsEnrollmentWarning\r\n          : !debugMode\r\n      })\r\n    }\r\n\r\n    switch (request.method) {\r\n      case 'GET':\r\n        ajax(\r\n          `${request.url}${formatGetParameters(request.data)}`,\r\n          {\r\n            success: onSuccess,\r\n            error: onFailure\r\n          },\r\n          undefined,\r\n          getOptions({\r\n            method: 'GET',\r\n            withCredentials: true\r\n          })\r\n        );\r\n        break;\r\n      case 'POST':\r\n        const enableGZipCompression = request.options?.endpointCompression;\r\n        const callAjax = ({ url, payload }) => {\r\n          ajax(\r\n            url,\r\n            {\r\n              success: onSuccess,\r\n              error: onFailure\r\n            },\r\n            payload,\r\n            getOptions({\r\n              method: 'POST',\r\n              contentType: 'text/plain',\r\n              withCredentials: true\r\n            })\r\n          );\r\n        };\r\n\r\n        if (enableGZipCompression && debugMode) {\r\n          logWarn(`Skipping GZIP compression for ${spec.code} as debug mode is enabled`);\r\n        }\r\n\r\n        if (enableGZipCompression && !debugMode && isGzipCompressionSupported()) {\r\n          compressDataWithGZip(request.data).then(compressedPayload => {\r\n            const url = new URL(request.url, window.location.origin);\r\n            if (!url.searchParams.has('gzip')) {\r\n              url.searchParams.set('gzip', '1');\r\n            }\r\n            callAjax({ url: url.href, payload: compressedPayload });\r\n          });\r\n        } else {\r\n          callAjax({ url: request.url, payload: typeof request.data === 'string' ? request.data : JSON.stringify(request.data) });\r\n        }\r\n        break;\r\n      default:\r\n        logWarn(`Skipping invalid request from ${spec.code}. Request type ${request.method} must be GET or POST`);\r\n        requestDone();\r\n    }\r\n\r\n    function formatGetParameters(data) {\r\n      if (data) {\r\n        return `?${typeof data === 'object' ? parseQueryStringParameters(data) : data}`;\r\n      }\r\n\r\n      return '';\r\n    }\r\n  })\r\n}, 'processBidderRequests')\r\n\r\nexport const registerSyncInner = hook('async', function(spec: BidderSpec<BidderCode>, responses, gdprConsent, uspConsent, gppConsent) {\r\n  const aliasSyncEnabled = config.getConfig('userSync.aliasSyncEnabled');\r\n  if (spec.getUserSyncs && (aliasSyncEnabled || !adapterManager.aliasRegistry[spec.code])) {\r\n    let syncs = spec.getUserSyncs({\r\n      iframeEnabled: userSync.canBidderRegisterSync('iframe', spec.code),\r\n      pixelEnabled: userSync.canBidderRegisterSync('image', spec.code),\r\n    }, responses, gdprConsent, uspConsent, gppConsent);\r\n    if (syncs) {\r\n      if (!Array.isArray(syncs)) {\r\n        syncs = [syncs];\r\n      }\r\n      syncs.forEach((sync) => {\r\n        userSync.registerSync(sync.type, spec.code, sync.url)\r\n      });\r\n      userSync.bidderDone(spec.code);\r\n    }\r\n  }\r\n}, 'registerSyncs')\r\n\r\nexport const addPaapiConfig = hook('sync', (request, paapiConfig) => {\r\n}, 'addPaapiConfig');\r\n\r\ndeclare module '../bidfactory' {\r\n  interface BannerBidProperties {\r\n    width?: number;\r\n    height?: number;\r\n    wratio?: number;\r\n    hratio?: number;\r\n  }\r\n}\r\n\r\n// check that the bid has a width and height set\r\nfunction validBidSize(adUnitCode, bid: BannerBid, {index = auctionManager.index} = {}) {\r\n  if ((bid.width || parseInt(bid.width, 10) === 0) && (bid.height || parseInt(bid.height, 10) === 0)) {\r\n    bid.width = parseInt(bid.width, 10);\r\n    bid.height = parseInt(bid.height, 10);\r\n    return true;\r\n  }\r\n\r\n  if (bid.wratio != null && bid.hratio != null) {\r\n    bid.wratio = parseInt(bid.wratio, 10);\r\n    bid.hratio = parseInt(bid.hratio, 10);\r\n    return true;\r\n  }\r\n\r\n  const bidRequest = index.getBidRequest(bid);\r\n  const mediaTypes = index.getMediaTypes(bid);\r\n\r\n  const sizes = (bidRequest && bidRequest.sizes) || (mediaTypes && mediaTypes.banner && mediaTypes.banner.sizes);\r\n  const parsedSizes = parseSizesInput(sizes);\r\n\r\n  // if a banner impression has one valid size, we assign that size to any bid\r\n  // response that does not explicitly set width or height\r\n  if (parsedSizes.length === 1) {\r\n    const [ width, height ] = parsedSizes[0].split('x');\r\n    bid.width = parseInt(width, 10);\r\n    bid.height = parseInt(height, 10);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// Validate the arguments sent to us by the adapter. If this returns false, the bid should be totally ignored.\r\nexport function isValid(adUnitCode: string, bid: Bid, {index = auctionManager.index} = {}) {\r\n  function hasValidKeys() {\r\n    const bidKeys = Object.keys(bid);\r\n    return COMMON_BID_RESPONSE_KEYS.every(key => bidKeys.includes(key) && ![undefined, null].includes(bid[key]));\r\n  }\r\n\r\n  function errorMessage(msg) {\r\n    return `Invalid bid from ${bid.bidderCode}. Ignoring bid: ${msg}`;\r\n  }\r\n\r\n  if (!adUnitCode) {\r\n    logWarn('No adUnitCode was supplied to addBidResponse.');\r\n    return false;\r\n  }\r\n\r\n  if (!bid) {\r\n    logWarn(`Some adapter tried to add an undefined bid for ${adUnitCode}.`);\r\n    return false;\r\n  }\r\n\r\n  if (!hasValidKeys()) {\r\n    logError(errorMessage(`Bidder ${bid.bidderCode} is missing required params. Check http://prebid.org/dev-docs/bidder-adapter-1.html for list of params.`));\r\n    return false;\r\n  }\r\n\r\n  if (FEATURES.NATIVE && bid.mediaType === 'native' && !nativeBidIsValid(bid, {index})) {\r\n    logError(errorMessage('Native bid missing some required properties.'));\r\n    return false;\r\n  }\r\n  if (FEATURES.VIDEO && bid.mediaType === 'video' && !isValidVideoBid(bid, {index})) {\r\n    logError(errorMessage(`Video bid does not have required vastUrl or renderer property`));\r\n    return false;\r\n  }\r\n  if (bid.mediaType === 'banner' && !validBidSize(adUnitCode, bid, {index})) {\r\n    logError(errorMessage(`Banner bids require a width and height`));\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function adapterMetrics(bidderRequest) {\r\n  return useMetrics(bidderRequest.metrics).renameWith(n => [`adapter.client.${n}`, `adapters.client.${bidderRequest.bidderCode}.${n}`])\r\n}\r\n","import { LOAD_EXTERNAL_SCRIPT } from './activities/activities.js';\r\nimport { activityParams } from './activities/activityParams.js';\r\nimport { isActivityAllowed } from './activities/rules.js';\r\n\r\nimport { insertElement, logError, logWarn, setScriptAttributes } from './utils.js';\r\n\r\nconst _requestCache = new WeakMap();\r\n// The below list contains modules or vendors whom Prebid allows to load external JS.\r\nconst _approvedLoadExternalJSList = [\r\n  // Prebid maintained modules:\r\n  'debugging',\r\n  'outstream',\r\n  // RTD modules:\r\n  'aaxBlockmeter',\r\n  'adagio',\r\n  'adloox',\r\n  'arcspan',\r\n  'airgrid',\r\n  'browsi',\r\n  'brandmetrics',\r\n  'clean.io',\r\n  'humansecurityMalvDefense',\r\n  'humansecurity',\r\n  'confiant',\r\n  'contxtful',\r\n  'hadron',\r\n  'mediafilter',\r\n  'medianet',\r\n  'azerionedge',\r\n  'a1Media',\r\n  'geoedge',\r\n  'qortex',\r\n  'dynamicAdBoost',\r\n  '51Degrees',\r\n  'symitridap',\r\n  'wurfl',\r\n  'nodalsAi',\r\n  'anonymised',\r\n  'optable',\r\n  // UserId Submodules\r\n  'justtag',\r\n  'tncId',\r\n  'ftrackId',\r\n  'id5',\r\n];\r\n\r\n/**\r\n * Loads external javascript. Can only be used if external JS is approved by Prebid. See https://github.com/prebid/prebid-js-external-js-template#policy\r\n * Each unique URL will be loaded at most 1 time.\r\n * @param {string} url the url to load\r\n * @param {string} moduleType moduleType of the module requesting this resource\r\n * @param {string} moduleCode bidderCode or module code of the module requesting this resource\r\n * @param {function} [callback] callback function to be called after the script is loaded\r\n * @param {Document} [doc] the context document, in which the script will be loaded, defaults to loaded document\r\n * @param {object} attributes an object of attributes to be added to the script with setAttribute by [key] and [value]; Only the attributes passed in the first request of a url will be added.\r\n */\r\nexport function loadExternalScript(url, moduleType, moduleCode, callback, doc, attributes) {\r\n  if (!isActivityAllowed(LOAD_EXTERNAL_SCRIPT, activityParams(moduleType, moduleCode))) {\r\n    return;\r\n  }\r\n\r\n  if (!moduleCode || !url) {\r\n    logError('cannot load external script without url and moduleCode');\r\n    return;\r\n  }\r\n  if (!_approvedLoadExternalJSList.includes(moduleCode)) {\r\n    logError(`${moduleCode} not whitelisted for loading external JavaScript`);\r\n    return;\r\n  }\r\n  if (!doc) {\r\n    doc = document; // provide a \"valid\" key for the WeakMap\r\n  }\r\n  // only load each asset once\r\n  const storedCachedObject = getCacheObject(doc, url);\r\n  if (storedCachedObject) {\r\n    if (callback && typeof callback === 'function') {\r\n      if (storedCachedObject.loaded) {\r\n        // invokeCallbacks immediately\r\n        callback();\r\n      } else {\r\n        // queue the callback\r\n        storedCachedObject.callbacks.push(callback);\r\n      }\r\n    }\r\n    return storedCachedObject.tag;\r\n  }\r\n  const cachedDocObj = _requestCache.get(doc) || {};\r\n  const cacheObject = {\r\n    loaded: false,\r\n    tag: null,\r\n    callbacks: []\r\n  };\r\n  cachedDocObj[url] = cacheObject;\r\n  _requestCache.set(doc, cachedDocObj);\r\n\r\n  if (callback && typeof callback === 'function') {\r\n    cacheObject.callbacks.push(callback);\r\n  }\r\n\r\n  logWarn(`module ${moduleCode} is loading external JavaScript`);\r\n  return requestResource(url, function () {\r\n    cacheObject.loaded = true;\r\n    try {\r\n      for (let i = 0; i < cacheObject.callbacks.length; i++) {\r\n        cacheObject.callbacks[i]();\r\n      }\r\n    } catch (e) {\r\n      logError('Error executing callback', 'adloader.js:loadExternalScript', e);\r\n    }\r\n  }, doc, attributes);\r\n\r\n  function requestResource(tagSrc, callback, doc, attributes) {\r\n    if (!doc) {\r\n      doc = document;\r\n    }\r\n    var jptScript = doc.createElement('script');\r\n    jptScript.type = 'text/javascript';\r\n    jptScript.async = true;\r\n\r\n    const cacheObject = getCacheObject(doc, url);\r\n    if (cacheObject) {\r\n      cacheObject.tag = jptScript;\r\n    }\r\n\r\n    if (jptScript.readyState) {\r\n      jptScript.onreadystatechange = function () {\r\n        if (jptScript.readyState === 'loaded' || jptScript.readyState === 'complete') {\r\n          jptScript.onreadystatechange = null;\r\n          callback();\r\n        }\r\n      };\r\n    } else {\r\n      jptScript.onload = function () {\r\n        callback();\r\n      };\r\n    }\r\n\r\n    jptScript.src = tagSrc;\r\n\r\n    if (attributes) {\r\n      setScriptAttributes(jptScript, attributes);\r\n    }\r\n\r\n    // add the new script tag to the page\r\n    insertElement(jptScript, doc);\r\n\r\n    return jptScript;\r\n  }\r\n  function getCacheObject(doc, url) {\r\n    const cachedDocObj = _requestCache.get(doc);\r\n    if (cachedDocObj && cachedDocObj[url]) {\r\n      return cachedDocObj[url];\r\n    }\r\n    return null; // return new cache object?\r\n  }\r\n};\r\n","import {hook} from './hook.js';\r\n\r\n/**\r\n * return the GAM PPID, if available (eid for the userID configured with `userSync.ppidSource`)\r\n */\r\nexport const getPPID = hook('sync', () => undefined);\r\n","import { ACTIVITY_ACCESS_REQUEST_CREDENTIALS } from './activities/activities.js';\r\nimport { activityParams } from './activities/activityParams.js';\r\nimport { isActivityAllowed } from './activities/rules.js';\r\nimport {config} from './config.js';\r\nimport { hook } from './hook.js';\r\nimport {buildUrl, hasDeviceAccess, logError, parseUrl} from './utils.js';\r\n\r\nexport const dep = {\r\n  fetch: window.fetch.bind(window),\r\n  makeRequest: (r, o) => new Request(r, o),\r\n  timeout(timeout, resource) {\r\n    const ctl = new AbortController();\r\n    let cancelTimer = setTimeout(() => {\r\n      ctl.abort();\r\n      logError(`Request timeout after ${timeout}ms`, resource);\r\n      cancelTimer = null;\r\n    }, timeout);\r\n    return {\r\n      signal: ctl.signal,\r\n      done() {\r\n        cancelTimer && clearTimeout(cancelTimer)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst GET = 'GET';\r\nconst POST = 'POST';\r\nconst CTYPE = 'Content-Type';\r\nexport interface AjaxOptions {\r\n  /**\r\n   * HTTP method.\r\n   */\r\n  method?: string;\r\n  /**\r\n   * Custom HTTP headers.\r\n   */\r\n  customHeaders?: Record<string, string>;\r\n  /**\r\n   * Content type.\r\n   */\r\n  contentType?: string;\r\n  /**\r\n   * Whether 3rd party cookies (and some other less relevant features, like HTTP auth)_\r\n   * should be enabled.\r\n   */\r\n  withCredentials?: boolean;\r\n  /**\r\n   * Fetch keepalive flag.\r\n   */\r\n  keepalive?: boolean\r\n  /**\r\n   * Whether chrome's `Sec-Browing-Topics` header should be sent\r\n   */\r\n  browsingTopics?: boolean\r\n  /**\r\n   * Whether chrome's PAAPI headers should be sent.\r\n   */\r\n  adAuctionHeaders?: boolean;\r\n  /**\r\n   * If true, suppress warnings\r\n   */\r\n  suppressTopicsEnrollmentWarning?: boolean;\r\n}\r\n\r\nexport const processRequestOptions = hook('async', function(options = {}, moduleType, moduleName) {\r\n  if (options.withCredentials) {\r\n    options.withCredentials = (moduleType && moduleName) ? isActivityAllowed(ACTIVITY_ACCESS_REQUEST_CREDENTIALS, activityParams(moduleType, moduleName)) : hasDeviceAccess();\r\n  }\r\n  return options;\r\n}, 'processRequestOptions');\r\n\r\n/**\r\n * transform legacy `ajax` parameters into a fetch request.\r\n * @returns {Request}\r\n */\r\nexport function toFetchRequest(url, data, options: AjaxOptions = {}) {\r\n  const method = options.method || (data ? POST : GET);\r\n  if (method === GET && data) {\r\n    const urlInfo = parseUrl(url, options);\r\n    Object.assign(urlInfo.search, data);\r\n    url = buildUrl(urlInfo);\r\n  }\r\n  const headers = new Headers(options.customHeaders);\r\n  headers.set(CTYPE, options.contentType || 'text/plain');\r\n  const rqOpts: any = {\r\n    method,\r\n    headers\r\n  }\r\n  if (method !== GET && data) {\r\n    rqOpts.body = data;\r\n  }\r\n  if (options.withCredentials) {\r\n    rqOpts.credentials = 'include';\r\n  }\r\n  if (isSecureContext) {\r\n    ['browsingTopics', 'adAuctionHeaders'].forEach(opt => {\r\n      // the Request constructor will throw an exception if the browser supports topics/fledge\r\n      // but we're not in a secure context\r\n      if (options[opt]) {\r\n        rqOpts[opt] = true;\r\n      }\r\n    })\r\n    if (options.suppressTopicsEnrollmentWarning != null) {\r\n      rqOpts.suppressTopicsEnrollmentWarning = options.suppressTopicsEnrollmentWarning;\r\n    }\r\n  }\r\n  if (options.keepalive) {\r\n    rqOpts.keepalive = true;\r\n  }\r\n  return dep.makeRequest(url, rqOpts);\r\n}\r\n\r\n/**\r\n * Return a version of `fetch` that automatically cancels requests after `timeout` milliseconds.\r\n *\r\n * If provided, `request` and `done` should be functions accepting a single argument.\r\n * `request` is invoked at the beginning of each request, and `done` at the end; both are passed its origin.\r\n *\r\n */\r\nexport function fetcherFactory(timeout = 3000, {request, done}: any = {}, moduleType?: string, moduleName?: string): typeof window['fetch'] {\r\n  let fetcher = (resource, options) => {\r\n    let to;\r\n    if (timeout != null && options?.signal == null && !config.getConfig('disableAjaxTimeout')) {\r\n      to = dep.timeout(timeout, resource);\r\n      options = Object.assign({signal: to.signal}, options);\r\n    }\r\n\r\n    processRequestOptions(options, moduleType, moduleName);\r\n\r\n    let pm = dep.fetch(resource, options);\r\n    if (to?.done != null) pm = pm.finally(to.done);\r\n    return pm;\r\n  };\r\n\r\n  if (request != null || done != null) {\r\n    fetcher = ((fetch) => function (resource, options) {\r\n      const origin = new URL(resource?.url == null ? resource : resource.url, document.location as unknown as string).origin;\r\n      let req = fetch(resource, options);\r\n      request && request(origin);\r\n      if (done) req = req.finally(() => done(origin));\r\n      return req;\r\n    })(fetcher);\r\n  }\r\n  return fetcher;\r\n}\r\n\r\nexport type XHR = ReturnType<typeof toXHR>;\r\n\r\nfunction toXHR({status, statusText = '', headers, url}: {\r\n  status: number;\r\n  statusText?: string;\r\n  headers?: Response['headers'];\r\n  url?: string;\r\n}, responseText: string) {\r\n  let xml: Document;\r\n  function getXML(onError?) {\r\n    if (xml === undefined) {\r\n      try {\r\n        xml = new DOMParser().parseFromString(responseText, headers?.get(CTYPE)?.split(';')?.[0] as any)\r\n      } catch (e) {\r\n        xml = null;\r\n        onError && onError(e)\r\n      }\r\n    }\r\n    return xml;\r\n  }\r\n  return {\r\n    // eslint-disable-next-line no-restricted-globals\r\n    readyState: XMLHttpRequest.DONE,\r\n    status,\r\n    statusText,\r\n    responseText,\r\n    response: responseText,\r\n    responseType: '',\r\n    responseURL: url,\r\n    get responseXML() {\r\n      return getXML(logError);\r\n    },\r\n    getResponseHeader: (header) => headers?.has(header) ? headers.get(header) : null,\r\n    toJSON() {\r\n      return Object.assign({responseXML: getXML()}, this)\r\n    },\r\n    timedOut: false\r\n  }\r\n}\r\n\r\n/**\r\n * attach legacy `ajax` callbacks to a fetch promise.\r\n */\r\nexport function attachCallbacks(fetchPm: Promise<Response>, callback: AjaxCallback) {\r\n  const {success, error} = typeof callback === 'object' && callback != null ? callback : {\r\n    success: typeof callback === 'function' ? callback : () => null,\r\n    error: (e, x) => logError('Network error', e, x)\r\n  };\r\n  return fetchPm.then(response => response\r\n    .text()\r\n    .then((responseText) => [response, responseText] as [Response, string]))\r\n    .then(([response, responseText]) => {\r\n      const xhr = toXHR(response, responseText);\r\n      response.ok || response.status === 304 ? success(responseText, xhr) : error(response.statusText, xhr);\r\n    }, (reason) => error('', Object.assign(\r\n      toXHR({status: 0}, ''),\r\n      {reason, timedOut: reason?.name === 'AbortError'}))\r\n    );\r\n}\r\n\r\nexport type AjaxSuccessCallback = (responseText: string, xhr: XHR) => void;\r\nexport type AjaxErrorCallback = (statusText: string, xhr: XHR) => void;\r\nexport type AjaxCallback = AjaxSuccessCallback | { success?: AjaxErrorCallback; error?: AjaxSuccessCallback };\r\n\r\nexport function ajaxBuilder(timeout = 3000, {request, done} = {} as any, moduleType?: string, moduleName?: string) {\r\n  const fetcher = fetcherFactory(timeout, {request, done}, moduleType, moduleName);\r\n  return function (url: string, callback?: AjaxCallback, data?: unknown, options: AjaxOptions = {}) {\r\n    attachCallbacks(fetcher(toFetchRequest(url, data, options)), callback);\r\n  };\r\n}\r\n\r\n/**\r\n * simple wrapper around sendBeacon such that invocations of navigator.sendBeacon can be centrally maintained.\r\n * verifies that the navigator and sendBeacon are defined for maximum compatibility\r\n * @param {string} url The URL that will receive the data. Can be relative or absolute.\r\n * @param {*} data An ArrayBuffer, a TypedArray, a DataView, a Blob, a string literal or object, a FormData or a URLSearchParams object containing the data to send.\r\n * @returns {boolean} true if the user agent successfully queued the data for transfer. Otherwise, it returns false.\r\n */\r\nexport function sendBeacon(url, data) {\r\n  if (!window.navigator || !window.navigator.sendBeacon) {\r\n    return false;\r\n  }\r\n  return window.navigator.sendBeacon(url, data);\r\n}\r\n\r\nexport const ajax = ajaxBuilder();\r\nexport const fetch = fetcherFactory();\r\n\r\nexport type Ajax = typeof ajax;\r\n","import {\r\n  generateUUID,\r\n  isEmpty,\r\n  isEmptyStr,\r\n  isFn,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  parseUrl,\r\n  timestamp\r\n} from './utils.js';\r\nimport {getPriceBucketString} from './cpmBucketManager.js';\r\nimport {isNativeResponse, setNativeResponseProperties} from './native.js';\r\nimport {batchAndStore, storeLocally} from './videoCache.js';\r\nimport {Renderer} from './Renderer.js';\r\nimport {config} from './config.js';\r\nimport {userSync} from './userSync.js';\r\nimport {hook, ignoreCallbackArg} from './hook.js';\r\nimport {OUTSTREAM} from './video.js';\r\nimport {VIDEO} from './mediaTypes.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {bidderSettings} from './bidderSettings.js';\r\nimport * as events from './events.js';\r\nimport adapterManager, {type BidderRequest, type BidRequest} from './adapterManager.js';\r\nimport {EVENTS, GRANULARITY_OPTIONS, JSON_MAPPING, REJECTION_REASON, S2S, TARGETING_KEYS} from './constants.js';\r\nimport {defer, PbPromise} from './utils/promise.js';\r\nimport {type Metrics, useMetrics} from './utils/perfMetrics.js';\r\nimport {adjustCpm} from './utils/cpm.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport {ttlCollection} from './utils/ttlCollection.js';\r\nimport {getMinBidCacheTTL, onMinBidCacheTTLChange} from './bidTTL.js';\r\nimport type {Bid, BidResponse} from \"./bidfactory.ts\";\r\nimport type {AdUnitCode, BidderCode, Identifier, ORTBFragments} from './types/common.d.ts';\r\nimport type {TargetingMap} from \"./targeting.ts\";\r\nimport type {AdUnit} from \"./adUnits.ts\";\r\nimport type {MediaType} from \"./mediaTypes.ts\";\r\nimport type {VideoContext} from \"./video.ts\";\r\n\r\nconst { syncUsers } = userSync;\r\n\r\nexport const AUCTION_STARTED = 'started';\r\nexport const AUCTION_IN_PROGRESS = 'inProgress';\r\nexport const AUCTION_COMPLETED = 'completed';\r\n\r\ntype AuctionStatus = typeof AUCTION_STARTED | typeof AUCTION_COMPLETED | typeof AUCTION_IN_PROGRESS;\r\n\r\n// register event for bid adjustment\r\nevents.on(EVENTS.BID_ADJUSTMENT, function (bid) {\r\n  adjustBids(bid);\r\n});\r\n\r\nconst MAX_REQUESTS_PER_ORIGIN = 4;\r\nconst outstandingRequests = {};\r\nconst sourceInfo = {};\r\nconst queuedCalls = [];\r\n\r\nconst pbjsInstance = getGlobal();\r\n\r\n/**\r\n * Clear global state for tests\r\n */\r\nexport function resetAuctionState() {\r\n  queuedCalls.length = 0;\r\n  [outstandingRequests, sourceInfo].forEach((ob) => Object.keys(ob).forEach((k) => { delete ob[k] }));\r\n}\r\n\r\ntype AuctionOptions = {\r\n  adUnits: AdUnit[],\r\n  adUnitCodes: AdUnitCode[],\r\n  callback: () => void;\r\n  cbTimeout: number;\r\n  labels: string[];\r\n  auctionId: Identifier;\r\n  ortb2Fragments: ORTBFragments;\r\n  metrics: Metrics;\r\n}\r\n\r\nexport type AuctionProperties = ReturnType<ReturnType<typeof newAuction>['getProperties']>;\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    /**\r\n     * Fired when an auction starts.\r\n     */\r\n    [EVENTS.AUCTION_INIT]: [AuctionProperties];\r\n    /**\r\n     * Fired when an auction ends.\r\n     */\r\n    [EVENTS.AUCTION_END]: [AuctionProperties];\r\n    /**\r\n     * Fired when an auction times out (at least some of the bid adapters\r\n     * did not reply before the timeout.\r\n     */\r\n    [EVENTS.AUCTION_TIMEOUT]: [AuctionProperties];\r\n    /**\r\n     * Fired when an auction times out.\r\n     */\r\n    [EVENTS.BID_TIMEOUT]: [BidRequest<BidderCode>[]];\r\n    /**\r\n     * Fired when a bid is received.\r\n     */\r\n    [EVENTS.BID_ACCEPTED]: [Partial<Bid>];\r\n    /**\r\n     * Fired when a bid is rejected.\r\n     */\r\n    [EVENTS.BID_REJECTED]: [Partial<Bid>];\r\n    /**\r\n     * Fired once for each bid request (unique combination of auction, ad unit and bidder)\r\n     * that produced no bid.\r\n     */\r\n    [EVENTS.NO_BID]: [BidRequest<BidderCode>];\r\n    /**\r\n     * Fired when a bid is received.\r\n     */\r\n    [EVENTS.BID_RESPONSE]: [Bid];\r\n    /**\r\n     * Fired once for each bid, immediately after its adjustment (see bidCpmAdjustment).\r\n     */\r\n    [EVENTS.BID_ADJUSTMENT]: [Partial<Bid>];\r\n  }\r\n}\r\n\r\nexport interface AuctionOptionsConfig {\r\n  /**\r\n   * Specifies bidders that the Prebid auction will no longer wait for before determining the auction has completed.\r\n   * This may be helpful if you find there are a number of low performing and/or high timeout bidders in your page’s rotation.\r\n   */\r\n  secondaryBidders?: BidderCode[]\r\n  /**\r\n   * When true, prevents banner bids from being rendered more than once. It should only be enabled after auto-refreshing is implemented correctly. Default is false.\r\n   */\r\n  suppressStaleRender?: boolean;\r\n  /**\r\n   * When true, prevent bids from being rendered if TTL is reached. Default is false.\r\n   */\r\n  suppressExpiredRender?: boolean;\r\n}\r\n\r\nexport interface PriceBucketConfig {\r\n  buckets: {\r\n    precision?: number;\r\n    max: number;\r\n    increment: number;\r\n  }[];\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * Since browsers have a limit of how many requests they will allow to a specific domain before they block,\r\n     * Prebid.js will queue auctions that would cause requests to a specific origin to exceed that limit.\r\n     * The limit is different for each browser. Prebid.js defaults to a max of 4 requests per origin.\r\n     */\r\n    maxRequestsPerOrigin?: number;\r\n    auctionOptions?: AuctionOptionsConfig;\r\n    priceGranularity?: (typeof GRANULARITY_OPTIONS)[keyof typeof GRANULARITY_OPTIONS];\r\n    customPriceBucket?: PriceBucketConfig;\r\n    mediaTypePriceGranularity?: {[K in MediaType]?: PriceBucketConfig} & {[K in VideoContext as `${typeof VIDEO}-${K}`]?: PriceBucketConfig};\r\n  }\r\n}\r\n\r\nexport function newAuction({adUnits, adUnitCodes, callback, cbTimeout, labels, auctionId, ortb2Fragments, metrics}: AuctionOptions) {\r\n  metrics = useMetrics(metrics);\r\n  const _adUnits = adUnits;\r\n  const _labels = labels;\r\n  const _adUnitCodes = adUnitCodes;\r\n  const _auctionId: Identifier = auctionId || generateUUID();\r\n  const _timeout = cbTimeout;\r\n  const _timelyRequests = new Set();\r\n  const done = defer<void>();\r\n  const requestsDone = defer<void>();\r\n  let _bidsRejected: Partial<Bid>[] = [];\r\n  let _callback = callback;\r\n  let _bidderRequests: BidderRequest<BidderCode>[] = [];\r\n  const _bidsReceived = ttlCollection<Bid>({\r\n    startTime: (bid) => bid.responseTimestamp,\r\n    ttl: (bid) => getMinBidCacheTTL() == null ? null : Math.max(getMinBidCacheTTL(), bid.ttl) * 1000\r\n  });\r\n  let _noBids: BidRequest<BidderCode>[] = [];\r\n  let _winningBids: Bid[] = [];\r\n  let _auctionStart: number;\r\n  let _auctionEnd: number;\r\n  let _timeoutTimer;\r\n  let _auctionStatus: AuctionStatus;\r\n  let _nonBids = [];\r\n\r\n  onMinBidCacheTTLChange(() => _bidsReceived.refresh());\r\n\r\n  function addBidRequests(bidderRequests) { _bidderRequests = _bidderRequests.concat(bidderRequests); }\r\n  function addBidReceived(bid) { _bidsReceived.add(bid); }\r\n  function addBidRejected(bidsRejected) { _bidsRejected = _bidsRejected.concat(bidsRejected); }\r\n  function addNoBid(noBid) { _noBids = _noBids.concat(noBid); }\r\n  function addNonBids(seatnonbids) { _nonBids = _nonBids.concat(seatnonbids); }\r\n\r\n  function getProperties() {\r\n    return {\r\n      auctionId: _auctionId,\r\n      timestamp: _auctionStart,\r\n      auctionEnd: _auctionEnd,\r\n      auctionStatus: _auctionStatus,\r\n      adUnits: _adUnits,\r\n      adUnitCodes: _adUnitCodes,\r\n      labels: _labels,\r\n      bidderRequests: _bidderRequests,\r\n      noBids: _noBids,\r\n      bidsReceived: _bidsReceived.toArray(),\r\n      bidsRejected: _bidsRejected,\r\n      winningBids: _winningBids,\r\n      timeout: _timeout,\r\n      metrics: metrics,\r\n      seatNonBids: _nonBids\r\n    };\r\n  }\r\n\r\n  function startAuctionTimer() {\r\n    _timeoutTimer = setTimeout(() => executeCallback(true), _timeout);\r\n  }\r\n\r\n  function executeCallback(timedOut) {\r\n    if (!timedOut) {\r\n      clearTimeout(_timeoutTimer);\r\n    } else {\r\n      events.emit(EVENTS.AUCTION_TIMEOUT, getProperties());\r\n    }\r\n    if (_auctionEnd === undefined) {\r\n      let timedOutRequests = [];\r\n      if (timedOut) {\r\n        logMessage(`Auction ${_auctionId} timedOut`);\r\n        timedOutRequests = _bidderRequests.filter(rq => !_timelyRequests.has(rq.bidderRequestId)).flatMap(br => br.bids)\r\n        if (timedOutRequests.length) {\r\n          events.emit(EVENTS.BID_TIMEOUT, timedOutRequests);\r\n        }\r\n      }\r\n\r\n      _auctionStatus = AUCTION_COMPLETED;\r\n      _auctionEnd = Date.now();\r\n      metrics.checkpoint('auctionEnd');\r\n      metrics.timeBetween('requestBids', 'auctionEnd', 'requestBids.total');\r\n      metrics.timeBetween('callBids', 'auctionEnd', 'requestBids.callBids');\r\n      done.resolve();\r\n\r\n      events.emit(EVENTS.AUCTION_END, getProperties());\r\n      bidsBackCallback(_adUnits, function () {\r\n        try {\r\n          if (_callback != null) {\r\n            const bids = _bidsReceived.toArray()\r\n              .filter(bid => _adUnitCodes.includes(bid.adUnitCode))\r\n              .reduce(groupByPlacement, {});\r\n            _callback.apply(pbjsInstance, [bids, timedOut, _auctionId]);\r\n            _callback = null;\r\n          }\r\n        } catch (e) {\r\n          logError('Error executing bidsBackHandler', null, e);\r\n        } finally {\r\n          // Calling timed out bidders\r\n          if (timedOutRequests.length) {\r\n            adapterManager.callTimedOutBidders(adUnits, timedOutRequests, _timeout);\r\n          }\r\n          // Only automatically sync if the publisher has not chosen to \"enableOverride\"\r\n          const userSyncConfig = config.getConfig('userSync') ?? {} as any;\r\n          if (!userSyncConfig.enableOverride) {\r\n            // Delay the auto sync by the config delay\r\n            syncUsers(userSyncConfig.syncDelay);\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  function auctionDone() {\r\n    config.resetBidder();\r\n    // when all bidders have called done callback atleast once it means auction is complete\r\n    logInfo(`Bids Received for Auction with id: ${_auctionId}`, _bidsReceived.toArray());\r\n    _auctionStatus = AUCTION_COMPLETED;\r\n    executeCallback(false);\r\n  }\r\n\r\n  function onTimelyResponse(bidderRequestId) {\r\n    _timelyRequests.add(bidderRequestId);\r\n  }\r\n\r\n  function callBids() {\r\n    _auctionStatus = AUCTION_STARTED;\r\n    _auctionStart = Date.now();\r\n\r\n    const bidRequests = metrics.measureTime('requestBids.makeRequests',\r\n      () => adapterManager.makeBidRequests(_adUnits, _auctionStart, _auctionId, _timeout, _labels, ortb2Fragments, metrics));\r\n    logInfo(`Bids Requested for Auction with id: ${_auctionId}`, bidRequests);\r\n\r\n    metrics.checkpoint('callBids')\r\n\r\n    if (bidRequests.length < 1) {\r\n      logWarn('No valid bid requests returned for auction');\r\n      auctionDone();\r\n    } else {\r\n      addBidderRequests.call({\r\n        dispatch: addBidderRequestsCallback,\r\n        context: this\r\n      }, bidRequests);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * callback executed after addBidderRequests completes\r\n   * @param {BidRequest[]} bidRequests\r\n   */\r\n  function addBidderRequestsCallback(bidRequests) {\r\n    bidRequests.forEach(bidRequest => {\r\n      addBidRequests(bidRequest);\r\n    });\r\n\r\n    const requests = {};\r\n    const call = {\r\n      bidRequests,\r\n      run: () => {\r\n        startAuctionTimer();\r\n\r\n        _auctionStatus = AUCTION_IN_PROGRESS;\r\n\r\n        events.emit(EVENTS.AUCTION_INIT, getProperties());\r\n\r\n        const callbacks = auctionCallbacks(auctionDone, this);\r\n        adapterManager.callBids(_adUnits, bidRequests, callbacks.addBidResponse, callbacks.adapterDone, {\r\n          request(source, origin) {\r\n            increment(outstandingRequests, origin);\r\n            increment(requests, source);\r\n\r\n            if (!sourceInfo[source]) {\r\n              sourceInfo[source] = {\r\n                SRA: true,\r\n                origin\r\n              };\r\n            }\r\n            if (requests[source] > 1) {\r\n              sourceInfo[source].SRA = false;\r\n            }\r\n          },\r\n          done(origin) {\r\n            outstandingRequests[origin]--;\r\n            if (queuedCalls[0]) {\r\n              if (runIfOriginHasCapacity(queuedCalls[0])) {\r\n                queuedCalls.shift();\r\n              }\r\n            }\r\n          }\r\n        }, _timeout, onTimelyResponse, ortb2Fragments);\r\n        requestsDone.resolve();\r\n      }\r\n    };\r\n\r\n    if (!runIfOriginHasCapacity(call)) {\r\n      logWarn('queueing auction due to limited endpoint capacity');\r\n      queuedCalls.push(call);\r\n    }\r\n\r\n    function runIfOriginHasCapacity(call) {\r\n      let hasCapacity = true;\r\n\r\n      const maxRequests = config.getConfig('maxRequestsPerOrigin') || MAX_REQUESTS_PER_ORIGIN;\r\n\r\n      call.bidRequests.some(bidRequest => {\r\n        let requests = 1;\r\n        const source = (typeof bidRequest.src !== 'undefined' && bidRequest.src === S2S.SRC) ? 's2s'\r\n          : bidRequest.bidderCode;\r\n        // if we have no previous info on this source just let them through\r\n        if (sourceInfo[source]) {\r\n          if (sourceInfo[source].SRA === false) {\r\n            // some bidders might use more than the MAX_REQUESTS_PER_ORIGIN in a single auction.  In those cases\r\n            // set their request count to MAX_REQUESTS_PER_ORIGIN so the auction isn't permanently queued waiting\r\n            // for capacity for that bidder\r\n            requests = Math.min(bidRequest.bids.length, maxRequests);\r\n          }\r\n          if (outstandingRequests[sourceInfo[source].origin] + requests > maxRequests) {\r\n            hasCapacity = false;\r\n          }\r\n        }\r\n        // return only used for terminating this .some() iteration early if it is determined we don't have capacity\r\n        return !hasCapacity;\r\n      });\r\n\r\n      if (hasCapacity) {\r\n        call.run();\r\n      }\r\n\r\n      return hasCapacity;\r\n    }\r\n\r\n    function increment(obj, prop) {\r\n      if (typeof obj[prop] === 'undefined') {\r\n        obj[prop] = 1\r\n      } else {\r\n        obj[prop]++;\r\n      }\r\n    }\r\n  }\r\n\r\n  function addWinningBid(winningBid) {\r\n    _winningBids = _winningBids.concat(winningBid);\r\n    adapterManager.callBidWonBidder(winningBid.adapterCode || winningBid.bidder, winningBid, adUnits);\r\n    if (!winningBid.deferBilling) {\r\n      adapterManager.triggerBilling(winningBid)\r\n    }\r\n  }\r\n\r\n  function setBidTargeting(bid) {\r\n    adapterManager.callSetTargetingBidder(bid.adapterCode || bid.bidder, bid);\r\n  }\r\n\r\n  events.on(EVENTS.SEAT_NON_BID, (event) => {\r\n    if (event.auctionId === _auctionId) {\r\n      addNonBids(event.seatnonbid)\r\n    }\r\n  });\r\n\r\n  return {\r\n    addBidReceived,\r\n    addBidRejected,\r\n    addNoBid,\r\n    callBids,\r\n    addWinningBid,\r\n    setBidTargeting,\r\n    getWinningBids: () => _winningBids,\r\n    getAuctionStart: () => _auctionStart,\r\n    getAuctionEnd: () => _auctionEnd,\r\n    getTimeout: () => _timeout,\r\n    getAuctionId: () => _auctionId,\r\n    getAuctionStatus: () => _auctionStatus,\r\n    getAdUnits: () => _adUnits,\r\n    getAdUnitCodes: () => _adUnitCodes,\r\n    getBidRequests: () => _bidderRequests,\r\n    getBidsReceived: () => _bidsReceived.toArray(),\r\n    getNoBids: () => _noBids,\r\n    getNonBids: () => _nonBids,\r\n    getFPD: () => ortb2Fragments,\r\n    getMetrics: () => metrics,\r\n    end: done.promise,\r\n    requestsDone: requestsDone.promise,\r\n    getProperties\r\n  };\r\n}\r\n\r\ndeclare module './hook' {\r\n  interface NamedHooks {\r\n    addBidResponse: typeof addBidResponse\r\n  }\r\n}\r\n\r\n/**\r\n * Hook into this to intercept bids before they are added to an auction.\r\n */\r\nexport const addBidResponse = ignoreCallbackArg(hook('async', function(adUnitCode: string, bid: Partial<Bid>, reject: (reason: (typeof REJECTION_REASON)[keyof typeof REJECTION_REASON]) => void): void {\r\n  if (!isValidPrice(bid)) {\r\n    reject(REJECTION_REASON.PRICE_TOO_HIGH)\r\n  } else {\r\n    this.dispatch.call(null, adUnitCode, bid);\r\n  }\r\n}, 'addBidResponse'));\r\n\r\n/**\r\n * Delay hook for adapter responses.\r\n *\r\n * `ready` is a promise; auctions wait for it to resolve before closing. Modules can hook into this\r\n * to delay the end of auctions while they perform initialization that does not need to delay their start.\r\n */\r\nexport const responsesReady = hook('sync', (ready) => ready, 'responsesReady');\r\n\r\nexport const addBidderRequests = hook('sync', function(bidderRequests) {\r\n  this.dispatch.call(this.context, bidderRequests);\r\n}, 'addBidderRequests');\r\n\r\nexport const bidsBackCallback = hook('async', function (adUnits, callback) {\r\n  if (callback) {\r\n    callback();\r\n  }\r\n}, 'bidsBackCallback');\r\n\r\nexport type AddBidResponse = {\r\n  (adUnitCode: AdUnitCode, bid: BidResponse): void;\r\n  reject(adUnitCode: AdUnitCode, bid: BidResponse, reason: typeof REJECTION_REASON[keyof typeof REJECTION_REASON]) : void;\r\n}\r\n\r\nexport function auctionCallbacks(auctionDone, auctionInstance, {index = auctionManager.index} = {}) {\r\n  let outstandingBidsAdded = 0;\r\n  let allAdapterCalledDone = false;\r\n  const bidderRequestsDone = new Set();\r\n  const bidResponseMap = {};\r\n\r\n  function afterBidAdded() {\r\n    outstandingBidsAdded--;\r\n    if (allAdapterCalledDone && outstandingBidsAdded === 0) {\r\n      auctionDone()\r\n    }\r\n  }\r\n\r\n  function handleBidResponse(adUnitCode: string, bid: Partial<Bid>, handler) {\r\n    bidResponseMap[bid.requestId] = true;\r\n    addCommonResponseProperties(bid, adUnitCode)\r\n    outstandingBidsAdded++;\r\n    return handler(afterBidAdded);\r\n  }\r\n\r\n  function acceptBidResponse(adUnitCode: string, bid: Partial<Bid>) {\r\n    handleBidResponse(adUnitCode, bid, (done) => {\r\n      const bidResponse = getPreparedBidForAuction(bid);\r\n      events.emit(EVENTS.BID_ACCEPTED, bidResponse);\r\n      if (FEATURES.VIDEO && bidResponse.mediaType === VIDEO) {\r\n        tryAddVideoBid(auctionInstance, bidResponse, done);\r\n      } else {\r\n        if (FEATURES.NATIVE && isNativeResponse(bidResponse)) {\r\n          setNativeResponseProperties(bidResponse, index.getAdUnit(bidResponse));\r\n        }\r\n        addBidToAuction(auctionInstance, bidResponse);\r\n        done();\r\n      }\r\n    });\r\n  }\r\n\r\n  function rejectBidResponse(adUnitCode, bid, reason) {\r\n    return handleBidResponse(adUnitCode, bid, (done) => {\r\n      bid.rejectionReason = reason;\r\n      logWarn(`Bid from ${bid.bidder || 'unknown bidder'} was rejected: ${reason}`, bid)\r\n      events.emit(EVENTS.BID_REJECTED, bid);\r\n      auctionInstance.addBidRejected(bid);\r\n      done();\r\n    })\r\n  }\r\n\r\n  function adapterDone() {\r\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n    const bidderRequest = this;\r\n    let bidderRequests = auctionInstance.getBidRequests();\r\n    const auctionOptionsConfig = config.getConfig('auctionOptions');\r\n\r\n    bidderRequestsDone.add(bidderRequest);\r\n\r\n    if (auctionOptionsConfig && !isEmpty(auctionOptionsConfig)) {\r\n      const secondaryBidders = auctionOptionsConfig.secondaryBidders;\r\n      if (secondaryBidders && !bidderRequests.every(bidder => secondaryBidders.includes(bidder.bidderCode))) {\r\n        bidderRequests = bidderRequests.filter(request => !secondaryBidders.includes(request.bidderCode));\r\n      }\r\n    }\r\n\r\n    allAdapterCalledDone = bidderRequests.every(bidderRequest => bidderRequestsDone.has(bidderRequest));\r\n\r\n    bidderRequest.bids.forEach(bid => {\r\n      if (!bidResponseMap[bid.bidId]) {\r\n        auctionInstance.addNoBid(bid);\r\n        events.emit(EVENTS.NO_BID, bid);\r\n      }\r\n    });\r\n\r\n    if (allAdapterCalledDone && outstandingBidsAdded === 0) {\r\n      auctionDone();\r\n    }\r\n  }\r\n\r\n  return {\r\n    addBidResponse: (function () {\r\n      function addBid(adUnitCode, bid) {\r\n        addBidResponse.call({\r\n          dispatch: acceptBidResponse,\r\n        }, adUnitCode, bid, (() => {\r\n          let rejected = false;\r\n          return (reason) => {\r\n            if (!rejected) {\r\n              rejectBidResponse(adUnitCode, bid, reason);\r\n              rejected = true;\r\n            }\r\n          }\r\n        })())\r\n      }\r\n      addBid.reject = rejectBidResponse;\r\n      return addBid;\r\n    })(),\r\n    adapterDone: function () {\r\n      responsesReady(PbPromise.resolve()).finally(() => adapterDone.call(this));\r\n    }\r\n  }\r\n}\r\n\r\n// Add a bid to the auction.\r\nexport function addBidToAuction(auctionInstance, bidResponse: Bid) {\r\n  setupBidTargeting(bidResponse);\r\n\r\n  useMetrics(bidResponse.metrics).timeSince('addBidResponse', 'addBidResponse.total');\r\n  auctionInstance.addBidReceived(bidResponse);\r\n  events.emit(EVENTS.BID_RESPONSE, bidResponse);\r\n}\r\n\r\n// Video bids may fail if the cache is down, or there's trouble on the network.\r\nfunction tryAddVideoBid(auctionInstance, bidResponse, afterBidAdded, {index = auctionManager.index} = {}) {\r\n  let addBid = true;\r\n\r\n  const videoMediaType = index.getMediaTypes({\r\n    requestId: bidResponse.originalRequestId || bidResponse.requestId,\r\n    adUnitId: bidResponse.adUnitId\r\n  })?.video;\r\n  const context = videoMediaType && videoMediaType?.context;\r\n  const useCacheKey = videoMediaType && videoMediaType?.useCacheKey;\r\n  const {\r\n    useLocal,\r\n    url: cacheUrl,\r\n    ignoreBidderCacheKey\r\n  } = config.getConfig('cache') || {};\r\n\r\n  if (useLocal) {\r\n    // stores video bid vast as local blob in the browser\r\n    storeLocally(bidResponse);\r\n  } else if (cacheUrl && (useCacheKey || context !== OUTSTREAM)) {\r\n    if (!bidResponse.videoCacheKey || ignoreBidderCacheKey) {\r\n      addBid = false;\r\n      callPrebidCache(auctionInstance, bidResponse, afterBidAdded, videoMediaType);\r\n    } else if (!bidResponse.vastUrl) {\r\n      logError('videoCacheKey specified but not required vastUrl for video bid');\r\n      addBid = false;\r\n    }\r\n  }\r\n\r\n  if (addBid) {\r\n    addBidToAuction(auctionInstance, bidResponse);\r\n    afterBidAdded();\r\n  }\r\n}\r\n\r\nexport const callPrebidCache = hook('async', function(auctionInstance, bidResponse, afterBidAdded, videoMediaType) {\r\n  if (FEATURES.VIDEO) {\r\n    batchAndStore(auctionInstance, bidResponse, afterBidAdded);\r\n  }\r\n}, 'callPrebidCache');\r\n\r\ndeclare module './bidfactory' {\r\n  interface BaseBidResponse {\r\n    /**\r\n     * Targeting custom key-value pairs for this bid.\r\n     */\r\n    adserverTargeting?: TargetingMap<unknown>;\r\n  }\r\n\r\n  interface BaseBid {\r\n    /**\r\n     * true if this bid is for an interstitial slot.\r\n     */\r\n    instl: boolean;\r\n    /**\r\n     * Timestamp of when the request for this bid was generated.\r\n     */\r\n    requestTimestamp: number;\r\n    /**\r\n     * Timestamp of when the response for this bid was received.\r\n     */\r\n    responseTimestamp: number;\r\n    /**\r\n     * responseTimestamp - requestTimestamp\r\n     */\r\n    timeToRespond: number;\r\n    /**\r\n     * alias of `bidderCode`.\r\n     */\r\n    bidder: BidderCode;\r\n    /**\r\n     * Code of the ad unit this bid is for.\r\n     */\r\n    adUnitCode: string;\r\n    /**\r\n     * TTL buffer for this bid; it will expire after `.ttl` - `.ttlBuffer` seconds have elapsed.\r\n     */\r\n    ttlBuffer?: number;\r\n    /**\r\n     * Low granularity price bucket for this bid.\r\n     */\r\n    pbLg: string;\r\n    /**\r\n     * Medium granularity price bucket for this bid.\r\n     */\r\n    pbMg: string;\r\n    /**\r\n     * High granularity price bucket for this bid.\r\n     */\r\n    pbHg: string;\r\n    /**\r\n     * Auto granularity price bucket for this bid.\r\n     */\r\n    pbAg: string;\r\n    /**\r\n     * Dense granularity price bucket for this bid.\r\n     */\r\n    pbDg: string;\r\n    /**\r\n     * Custom granularity price bucket for this bid.\r\n     */\r\n    pbCg: string;\r\n    /**\r\n     * This bid's creative size, expressed as width x height.\r\n     */\r\n    size: ReturnType<BaseBid['getSize']>\r\n    /**\r\n     * If custom targeting was defined, whether standard targeting should also be used for this bid.\r\n     */\r\n    sendStandardTargeting?: boolean;\r\n    adserverTargeting: BaseBidResponse['adserverTargeting'];\r\n  }\r\n}\r\n/**\r\n * Augment `bidResponse` with properties that are common across all bids - including rejected bids.\r\n */\r\nfunction addCommonResponseProperties(bidResponse: Partial<Bid>, adUnitCode: string, {index = auctionManager.index} = {}) {\r\n  const bidderRequest = index.getBidderRequest(bidResponse);\r\n  const adUnit = index.getAdUnit(bidResponse);\r\n  const start = (bidderRequest && bidderRequest.start) || bidResponse.requestTimestamp;\r\n\r\n  Object.assign(bidResponse, {\r\n    responseTimestamp: bidResponse.responseTimestamp || timestamp(),\r\n    requestTimestamp: bidResponse.requestTimestamp || start,\r\n    cpm: parseFloat(bidResponse.cpm) || 0,\r\n    bidder: bidResponse.bidder || bidResponse.bidderCode,\r\n    adUnitCode\r\n  });\r\n\r\n  if (adUnit?.ttlBuffer != null) {\r\n    bidResponse.ttlBuffer = adUnit.ttlBuffer;\r\n  }\r\n\r\n  bidResponse.timeToRespond = bidResponse.responseTimestamp - bidResponse.requestTimestamp;\r\n}\r\n\r\n/**\r\n * Add additional bid response properties that are universal for all _accepted_ bids.\r\n */\r\nfunction getPreparedBidForAuction(bid: Partial<Bid>, {index = auctionManager.index} = {}): Bid {\r\n  // Let listeners know that now is the time to adjust the bid, if they want to.\r\n  //\r\n  // CAREFUL: Publishers rely on certain bid properties to be available (like cpm),\r\n  // but others to not be set yet (like priceStrings). See #1372 and #1389.\r\n  events.emit(EVENTS.BID_ADJUSTMENT, bid);\r\n\r\n  const adUnit = index.getAdUnit(bid);\r\n  bid.instl = adUnit?.ortb2Imp?.instl === 1;\r\n\r\n  // a publisher-defined renderer can be used to render bids\r\n  const bidRenderer = index.getBidRequest(bid)?.renderer || adUnit.renderer;\r\n\r\n  // a publisher can also define a renderer for a mediaType\r\n  const bidObjectMediaType = bid.mediaType;\r\n  const mediaTypes = index.getMediaTypes(bid);\r\n  const bidMediaType = mediaTypes && mediaTypes[bidObjectMediaType];\r\n\r\n  var mediaTypeRenderer = bidMediaType && bidMediaType.renderer;\r\n\r\n  var renderer = null;\r\n\r\n  // the renderer for the mediaType takes precendence\r\n  if (mediaTypeRenderer && mediaTypeRenderer.render && !(mediaTypeRenderer.backupOnly === true && bid.renderer)) {\r\n    renderer = mediaTypeRenderer;\r\n  } else if (bidRenderer && bidRenderer.render && !(bidRenderer.backupOnly === true && bid.renderer)) {\r\n    renderer = bidRenderer;\r\n  }\r\n\r\n  if (renderer) {\r\n    // be aware, an adapter could already have installed the bidder, in which case this overwrite's the existing adapter\r\n    bid.renderer = Renderer.install({ url: renderer.url, config: renderer.options, renderNow: renderer.url == null });// rename options to config, to make it consistent?\r\n    bid.renderer.setRender(renderer.render);\r\n  }\r\n\r\n  // Use the config value 'mediaTypeGranularity' if it has been defined for mediaType, else use 'customPriceBucket'\r\n  const mediaTypeGranularity = getMediaTypeGranularity(bid.mediaType, mediaTypes, config.getConfig('mediaTypePriceGranularity'));\r\n  const priceStringsObj = getPriceBucketString(\r\n    bid.cpm,\r\n    (typeof mediaTypeGranularity === 'object') ? mediaTypeGranularity : config.getConfig('customPriceBucket'),\r\n    config.getConfig('currency.granularityMultiplier')\r\n  );\r\n  bid.pbLg = priceStringsObj.low;\r\n  bid.pbMg = priceStringsObj.med;\r\n  bid.pbHg = priceStringsObj.high;\r\n  bid.pbAg = priceStringsObj.auto;\r\n  bid.pbDg = priceStringsObj.dense;\r\n  bid.pbCg = priceStringsObj.custom;\r\n\r\n  return bid as Bid;\r\n}\r\n\r\nfunction setupBidTargeting(bidObject: Bid) {\r\n  let keyValues;\r\n  const cpmCheck = (bidderSettings.get(bidObject.bidderCode, 'allowZeroCpmBids') === true) ? bidObject.cpm >= 0 : bidObject.cpm > 0;\r\n  if (bidObject.bidderCode && (cpmCheck || bidObject.dealId)) {\r\n    keyValues = getKeyValueTargetingPairs(bidObject.bidderCode, bidObject);\r\n  }\r\n\r\n  // use any targeting provided as defaults, otherwise just set from getKeyValueTargetingPairs\r\n  bidObject.adserverTargeting = Object.assign(bidObject.adserverTargeting || {}, keyValues);\r\n}\r\n\r\nexport function getMediaTypeGranularity(mediaType, mediaTypes, mediaTypePriceGranularity) {\r\n  if (mediaType && mediaTypePriceGranularity) {\r\n    if (FEATURES.VIDEO && mediaType === VIDEO) {\r\n      const context = mediaTypes?.[VIDEO]?.context ?? 'instream';\r\n      if (mediaTypePriceGranularity[`${VIDEO}-${context}`]) {\r\n        return mediaTypePriceGranularity[`${VIDEO}-${context}`];\r\n      }\r\n    }\r\n    return mediaTypePriceGranularity[mediaType];\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns the price granularity defined. It can be either publisher defined or default value\r\n * @param {Bid} bid bid response object\r\n * @param {object} obj\r\n * @param {object} obj.index\r\n * @returns {string} granularity\r\n */\r\nexport const getPriceGranularity = (bid, {index = auctionManager.index} = {}) => {\r\n  // Use the config value 'mediaTypeGranularity' if it has been set for mediaType, else use 'priceGranularity'\r\n  const mediaTypeGranularity = getMediaTypeGranularity(bid.mediaType, index.getMediaTypes(bid), config.getConfig('mediaTypePriceGranularity'));\r\n  const granularity = (typeof bid.mediaType === 'string' && mediaTypeGranularity) ? ((typeof mediaTypeGranularity === 'string') ? mediaTypeGranularity : 'custom') : config.getConfig('priceGranularity');\r\n  return granularity;\r\n}\r\n\r\n/**\r\n * This function returns a function to get bid price by price granularity\r\n * @param {string} granularity\r\n * @returns {function}\r\n */\r\nexport const getPriceByGranularity = (granularity?) => {\r\n  return (bid) => {\r\n    const bidGranularity = granularity || getPriceGranularity(bid);\r\n    if (bidGranularity === GRANULARITY_OPTIONS.AUTO) {\r\n      return bid.pbAg;\r\n    } else if (bidGranularity === GRANULARITY_OPTIONS.DENSE) {\r\n      return bid.pbDg;\r\n    } else if (bidGranularity === GRANULARITY_OPTIONS.LOW) {\r\n      return bid.pbLg;\r\n    } else if (bidGranularity === GRANULARITY_OPTIONS.MEDIUM) {\r\n      return bid.pbMg;\r\n    } else if (bidGranularity === GRANULARITY_OPTIONS.HIGH) {\r\n      return bid.pbHg;\r\n    } else if (bidGranularity === GRANULARITY_OPTIONS.CUSTOM) {\r\n      return bid.pbCg;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns a function to get crid from bid response\r\n * @returns {function}\r\n */\r\nexport const getCreativeId = () => {\r\n  return (bid) => {\r\n    return (bid.creativeId) ? bid.creativeId : '';\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns a function to get first advertiser domain from bid response meta\r\n * @returns {function}\r\n */\r\nexport const getAdvertiserDomain = () => {\r\n  return (bid) => {\r\n    return (bid.meta && bid.meta.advertiserDomains && bid.meta.advertiserDomains.length > 0) ? [bid.meta.advertiserDomains].flat()[0] : '';\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns a function to get dsp name or id from bid response meta\r\n * @returns {function}\r\n */\r\nexport const getDSP = () => {\r\n  return (bid) => {\r\n    return (bid.meta && (bid.meta.networkId || bid.meta.networkName)) ? bid?.meta?.networkName || bid?.meta?.networkId : '';\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns a function to get the primary category id from bid response meta\r\n * @returns {function}\r\n */\r\nexport const getPrimaryCatId = () => {\r\n  return (bid) => {\r\n    const catId = bid?.meta?.primaryCatId;\r\n    if (Array.isArray(catId)) {\r\n      return catId[0] || '';\r\n    }\r\n    return catId || '';\r\n  };\r\n}\r\n\r\nexport interface DefaultTargeting {\r\n  /**\r\n   * Bidder code.\r\n   */\r\n  [TARGETING_KEYS.BIDDER]: Bid['bidderCode'];\r\n  /**\r\n   * Ad ID.\r\n   */\r\n  [TARGETING_KEYS.AD_ID]: Bid['adId'];\r\n  /**\r\n   * Price bucket.\r\n   */\r\n  [TARGETING_KEYS.PRICE_BUCKET]: string;\r\n  /**\r\n   * Size, expressed as ${width}x${height}.\r\n   */\r\n  [TARGETING_KEYS.SIZE]: Bid['size'];\r\n  /**\r\n   * Deal ID.\r\n   */\r\n  [TARGETING_KEYS.DEAL]: Bid['dealId'];\r\n  /**\r\n   * Bid source - either client or s2s.\r\n   */\r\n  [TARGETING_KEYS.SOURCE]: Bid['source'];\r\n  /**\r\n   * Media type.\r\n   */\r\n  [TARGETING_KEYS.FORMAT]: Bid['mediaType'];\r\n  /**\r\n   * Advertiser domain.\r\n   */\r\n  [TARGETING_KEYS.ADOMAIN]: Bid['meta']['advertiserDomains'][0];\r\n  /**\r\n   * Primary category ID.\r\n   */\r\n  [TARGETING_KEYS.ACAT]: Bid['meta']['primaryCatId'];\r\n  /**\r\n   * DSP network name.\r\n   */\r\n  [TARGETING_KEYS.DSP]: Bid['meta']['networkName'];\r\n  /**\r\n   * Creative ID.\r\n   */\r\n  [TARGETING_KEYS.CRID]: Bid['creativeId'];\r\n  /**\r\n   * Video cache key.\r\n   */\r\n  [TARGETING_KEYS.UUID]: Bid['videoCacheKey'];\r\n  /**\r\n   * Video cache key.\r\n   */\r\n  [TARGETING_KEYS.CACHE_ID]: Bid['videoCacheKey'];\r\n  /**\r\n   * Video cache host.\r\n   */\r\n  [TARGETING_KEYS.CACHE_HOST]: string;\r\n}\r\n\r\ntype KeyValFn<K extends keyof DefaultTargeting> = (bidResponse: Bid, bidRequest: BidRequest<BidderCode>) => DefaultTargeting[K];\r\ntype KeyValProp<K extends keyof DefaultTargeting> = {\r\n  [P in keyof Bid]: Bid[P] extends DefaultTargeting[K] ? P : never\r\n}[keyof Bid];\r\n\r\nfunction createKeyVal<K extends keyof DefaultTargeting>(key: K, value: KeyValFn<K> | KeyValProp<K>) {\r\n  return {\r\n    key,\r\n    val: (typeof value === 'function')\r\n      ? function (bidResponse, bidReq) {\r\n        return value(bidResponse, bidReq);\r\n      }\r\n      : function (bidResponse) {\r\n        return bidResponse[value];\r\n      }\r\n  };\r\n}\r\n\r\nfunction defaultAdserverTargeting() {\r\n  return [\r\n    createKeyVal(TARGETING_KEYS.BIDDER, 'bidderCode'),\r\n    createKeyVal(TARGETING_KEYS.AD_ID, 'adId'),\r\n    createKeyVal(TARGETING_KEYS.PRICE_BUCKET, getPriceByGranularity()),\r\n    createKeyVal(TARGETING_KEYS.SIZE, 'size'),\r\n    createKeyVal(TARGETING_KEYS.DEAL, 'dealId'),\r\n    createKeyVal(TARGETING_KEYS.SOURCE, 'source'),\r\n    createKeyVal(TARGETING_KEYS.FORMAT, 'mediaType'),\r\n    createKeyVal(TARGETING_KEYS.ADOMAIN, getAdvertiserDomain()),\r\n    createKeyVal(TARGETING_KEYS.ACAT, getPrimaryCatId()),\r\n    createKeyVal(TARGETING_KEYS.DSP, getDSP()),\r\n    createKeyVal(TARGETING_KEYS.CRID, getCreativeId()),\r\n  ]\r\n}\r\n\r\n/**\r\n * @param {string} mediaType\r\n * @param {string} bidderCode\r\n * @returns {*}\r\n */\r\nexport function getStandardBidderSettings(mediaType, bidderCode) {\r\n  const standardSettings = Object.assign({}, bidderSettings.settingsFor(null));\r\n  if (!standardSettings[JSON_MAPPING.ADSERVER_TARGETING]) {\r\n    standardSettings[JSON_MAPPING.ADSERVER_TARGETING] = defaultAdserverTargeting();\r\n  }\r\n\r\n  if (FEATURES.VIDEO && mediaType === 'video') {\r\n    const adserverTargeting = standardSettings[JSON_MAPPING.ADSERVER_TARGETING].slice();\r\n    standardSettings[JSON_MAPPING.ADSERVER_TARGETING] = adserverTargeting;\r\n\r\n    // Adding hb_uuid + hb_cache_id\r\n    [TARGETING_KEYS.UUID, TARGETING_KEYS.CACHE_ID].forEach(targetingKeyVal => {\r\n      if (typeof adserverTargeting.find(kvPair => kvPair.key === targetingKeyVal) === 'undefined') {\r\n        adserverTargeting.push(createKeyVal(targetingKeyVal, 'videoCacheKey'));\r\n      }\r\n    });\r\n\r\n    // Adding hb_cache_host\r\n    if (config.getConfig('cache.url') && (!bidderCode || bidderSettings.get(bidderCode, 'sendStandardTargeting') !== false)) {\r\n      const urlInfo = parseUrl(config.getConfig('cache.url'));\r\n\r\n      if (typeof adserverTargeting.find(targetingKeyVal => targetingKeyVal.key === TARGETING_KEYS.CACHE_HOST) === 'undefined') {\r\n        adserverTargeting.push(createKeyVal(TARGETING_KEYS.CACHE_HOST, function(bidResponse) {\r\n          return (bidResponse?.adserverTargeting?.[TARGETING_KEYS.CACHE_HOST] || urlInfo.hostname) as string;\r\n        }));\r\n      }\r\n    }\r\n  }\r\n\r\n  return standardSettings;\r\n}\r\n\r\nexport function getKeyValueTargetingPairs(bidderCode, custBidObj: Bid, {index = auctionManager.index} = {}) {\r\n  if (!custBidObj) {\r\n    return {};\r\n  }\r\n  const bidRequest = index.getBidRequest(custBidObj);\r\n  var keyValues = {};\r\n\r\n  // 1) set the keys from \"standard\" setting or from prebid defaults\r\n  // initialize default if not set\r\n  const standardSettings = getStandardBidderSettings(custBidObj.mediaType, bidderCode);\r\n  setKeys(keyValues, standardSettings, custBidObj, bidRequest);\r\n\r\n  // 2) set keys from specific bidder setting override if they exist\r\n  if (bidderCode && bidderSettings.getOwn(bidderCode, JSON_MAPPING.ADSERVER_TARGETING)) {\r\n    setKeys(keyValues, bidderSettings.ownSettingsFor(bidderCode), custBidObj, bidRequest);\r\n    custBidObj.sendStandardTargeting = bidderSettings.get(bidderCode, 'sendStandardTargeting');\r\n  }\r\n\r\n  return keyValues;\r\n}\r\n\r\nfunction setKeys(keyValues, bidderSettings, custBidObj, bidReq) {\r\n  var targeting = bidderSettings[JSON_MAPPING.ADSERVER_TARGETING];\r\n  custBidObj.size = custBidObj.getSize();\r\n\r\n  (targeting || []).forEach(function (kvPair) {\r\n    var key = kvPair.key;\r\n    var value = kvPair.val;\r\n\r\n    if (keyValues[key]) {\r\n      logWarn('The key: ' + key + ' is being overwritten');\r\n    }\r\n\r\n    if (isFn(value)) {\r\n      try {\r\n        value = value(custBidObj, bidReq);\r\n      } catch (e) {\r\n        logError('bidmanager', 'ERROR', e);\r\n      }\r\n    }\r\n\r\n    if (\r\n      ((typeof bidderSettings.suppressEmptyKeys !== 'undefined' && bidderSettings.suppressEmptyKeys === true) ||\r\n        key === TARGETING_KEYS.DEAL || key === TARGETING_KEYS.ACAT || key === TARGETING_KEYS.DSP || key === TARGETING_KEYS.CRID) && // hb_deal & hb_acat are suppressed automatically if not set\r\n      (\r\n        isEmptyStr(value) ||\r\n        value === null ||\r\n        value === undefined\r\n      )\r\n    ) {\r\n      logInfo(\"suppressing empty key '\" + key + \"' from adserver targeting\");\r\n    } else {\r\n      keyValues[key] = value;\r\n    }\r\n  });\r\n\r\n  return keyValues;\r\n}\r\n\r\nexport function adjustBids(bid) {\r\n  const bidPriceAdjusted = adjustCpm(bid.cpm, bid);\r\n\r\n  if (bidPriceAdjusted >= 0) {\r\n    bid.cpm = bidPriceAdjusted;\r\n  }\r\n}\r\n\r\n/**\r\n * groupByPlacement is a reduce function that converts an array of Bid objects\r\n * to an object with placement codes as keys, with each key representing an object\r\n * with an array of `Bid` objects for that placement\r\n * @returns {*} as { [adUnitCode]: { bids: [Bid, Bid, Bid] } }\r\n */\r\nfunction groupByPlacement(bidsByPlacement, bid) {\r\n  if (!bidsByPlacement[bid.adUnitCode]) { bidsByPlacement[bid.adUnitCode] = { bids: [] }; }\r\n  bidsByPlacement[bid.adUnitCode].bids.push(bid);\r\n  return bidsByPlacement;\r\n}\r\n\r\n/**\r\n * isValidPrice is price validation function\r\n * which checks if price from bid response\r\n * is not higher than top limit set in config\r\n * @type {Function}\r\n * @param bid\r\n * @returns {boolean}\r\n */\r\nfunction isValidPrice(bid) {\r\n  const maxBidValue = config.getConfig('maxBid');\r\n  if (!maxBidValue || !bid.cpm) return true;\r\n  return maxBidValue >= Number(bid.cpm);\r\n}\r\n","/**\r\n * @typedef {Object} AuctionIndex\r\n *\r\n * @property {function({ auctionId?: * }): *} getAuction Returns auction instance for `auctionId`\r\n * @property {function({ adUnitId?: * }): *} getAdUnit Returns `adUnit` object for `transactionId`.\r\n * You should prefer `getMediaTypes` for looking up bid media types.\r\n * @property {function({ adUnitId?: *, requestId?: * }): *} getMediaTypes Returns mediaTypes object from bidRequest (through `requestId`) falling back to the adUnit (through `transactionId`).\r\n * The bidRequest is given precedence because its mediaTypes can differ from the adUnit's (if bidder-specific labels are in use).\r\n * Bids that have no associated request do not have labels either, and use the adUnit's mediaTypes.\r\n * @property {function({ requestId?: *, bidderRequestId?: * }): *} getBidderRequest Returns bidderRequest that matches both requestId and bidderRequestId (if either or both are provided).\r\n * Bid responses are not guaranteed to have a corresponding request.\r\n * @property {function({ requestId?: string }): *} getBidRequest Returns bidRequest object for requestId.\r\n * Bid responses are not guaranteed to have a corresponding request.\r\n */\r\n\r\n/**\r\n * Retrieves request-related bid data.\r\n * All methods are designed to work with Bid (response) objects returned by bid adapters.\r\n */\r\nexport function AuctionIndex(getAuctions) {\r\n  Object.assign(this, {\r\n    getAuction({auctionId}) {\r\n      if (auctionId != null) {\r\n        return getAuctions()\r\n          .find(auction => auction.getAuctionId() === auctionId);\r\n      }\r\n    },\r\n    getAdUnit({adUnitId}) {\r\n      if (adUnitId != null) {\r\n        return getAuctions()\r\n          .flatMap(a => a.getAdUnits())\r\n          .find(au => au.adUnitId === adUnitId);\r\n      }\r\n    },\r\n    getMediaTypes({adUnitId, requestId}) {\r\n      if (requestId != null) {\r\n        const req = this.getBidRequest({requestId});\r\n        if (req != null && (adUnitId == null || req.adUnitId === adUnitId)) {\r\n          return req.mediaTypes;\r\n        }\r\n      } else if (adUnitId != null) {\r\n        const au = this.getAdUnit({adUnitId});\r\n        if (au != null) {\r\n          return au.mediaTypes;\r\n        }\r\n      }\r\n    },\r\n    getBidderRequest({requestId, bidderRequestId}) {\r\n      if (requestId != null || bidderRequestId != null) {\r\n        let bers = getAuctions().flatMap(a => a.getBidRequests());\r\n        if (bidderRequestId != null) {\r\n          bers = bers.filter(ber => ber.bidderRequestId === bidderRequestId);\r\n        }\r\n        if (requestId == null) {\r\n          return bers[0];\r\n        } else {\r\n          return bers.find(ber => ber.bids && ber.bids.find(br => br.bidId === requestId) != null)\r\n        }\r\n      }\r\n    },\r\n    getBidRequest({requestId}) {\r\n      if (requestId != null) {\r\n        return getAuctions()\r\n          .flatMap(a => a.getBidRequests())\r\n          .flatMap(ber => ber.bids)\r\n          .find(br => br && br.bidId === requestId);\r\n      }\r\n    },\r\n    getOrtb2(bid) {\r\n      return this.getBidderRequest(bid)?.ortb2 || this.getAuction(bid)?.getFPD()?.global?.ortb2\r\n    }\r\n  });\r\n}\r\n","/**\r\n * AuctionManager modules is responsible for creating auction instances.\r\n * This module is the gateway for Prebid core to access auctions.\r\n * It stores all created instances of auction and can be used to get consolidated values from auction.\r\n */\r\n\r\n/**\r\n * @typedef {Object} AuctionManager\r\n *\r\n * @property {function(): Array} getBidsRequested - returns consolidated bid requests\r\n * @property {function(): Array} getBidsReceived - returns consolidated bid received\r\n * @property {function(string): Array} getAllBidsForAdUnitCode - returns consolidated bid received for a given adUnit\r\n * @property {function(): Array} getAllWinningBids - returns all winning bids\r\n * @property {function(): Array} getAdUnits - returns consolidated adUnits\r\n * @property {function(): Array} getAdUnitCodes - returns consolidated adUnitCodes\r\n * @property {function(): Array} getNoBids - returns consolidated adUnitCodes\r\n * @property {function(string, string): void} setStatusForBids - set status for bids\r\n * @property {function(): string} getLastAuctionId - returns last auctionId\r\n * @property {function(Object): Object} createAuction - creates auction instance and stores it for future reference\r\n * @property {function(string): Object} findBidByAdId - find bid received by adId. This function will be called by $$PREBID_GLOBAL$$.renderAd\r\n * @property {function(): Object} getStandardBidderAdServerTargeting - returns standard bidder targeting for all the adapters. Refer http://prebid.org/dev-docs/publisher-api-reference.html#module_pbjs.bidderSettings for more details\r\n * @property {function(Object): void} addWinningBid - add a winning bid to an auction based on auctionId\r\n * @property {function(): void} clearAllAuctions - clear all auctions for testing\r\n * @property {function(*): *} onExpiry\r\n * @property {AuctionIndex} index\r\n */\r\n\r\nimport { uniques, logWarn } from './utils.js';\r\nimport { newAuction, getStandardBidderSettings, AUCTION_COMPLETED } from './auction.js';\r\nimport {AuctionIndex} from './auctionIndex.js';\r\nimport { BID_STATUS, JSON_MAPPING } from './constants.js';\r\nimport {useMetrics} from './utils/perfMetrics.js';\r\nimport {ttlCollection} from './utils/ttlCollection.js';\r\nimport {getMinBidCacheTTL, onMinBidCacheTTLChange} from './bidTTL.js';\r\n\r\n/**\r\n * Creates new instance of auctionManager. There will only be one instance of auctionManager but\r\n * a factory is created to assist in testing.\r\n *\r\n * @returns {AuctionManager} auctionManagerInstance\r\n */\r\nexport function newAuctionManager() {\r\n  const _auctions = ttlCollection({\r\n    startTime: (au) => au.end.then(() => au.getAuctionEnd()),\r\n    ttl: (au) => getMinBidCacheTTL() == null ? null : au.end.then(() => {\r\n      return Math.max(getMinBidCacheTTL(), ...au.getBidsReceived().map(bid => bid.ttl)) * 1000\r\n    }),\r\n  });\r\n\r\n  onMinBidCacheTTLChange(() => _auctions.refresh());\r\n\r\n  const auctionManager = {\r\n    onExpiry: _auctions.onExpiry\r\n  };\r\n\r\n  function getAuction(auctionId) {\r\n    for (const auction of _auctions) {\r\n      if (auction.getAuctionId() === auctionId) return auction;\r\n    }\r\n  }\r\n\r\n  auctionManager.addWinningBid = function(bid) {\r\n    const metrics = useMetrics(bid.metrics);\r\n    metrics.checkpoint('bidWon');\r\n    metrics.timeBetween('auctionEnd', 'bidWon', 'adserver.pending');\r\n    metrics.timeBetween('requestBids', 'bidWon', 'adserver.e2e');\r\n    const auction = getAuction(bid.auctionId);\r\n    if (auction) {\r\n      auction.addWinningBid(bid);\r\n    } else {\r\n      logWarn(`Auction not found when adding winning bid`);\r\n    }\r\n  };\r\n\r\n  Object.entries({\r\n    getAllWinningBids: {\r\n      name: 'getWinningBids',\r\n    },\r\n    getBidsRequested: {\r\n      name: 'getBidRequests'\r\n    },\r\n    getNoBids: {},\r\n    getAdUnits: {},\r\n    getBidsReceived: {\r\n      pre(auction) {\r\n        return auction.getAuctionStatus() === AUCTION_COMPLETED;\r\n      }\r\n    },\r\n    getAdUnitCodes: {\r\n      post: uniques,\r\n    }\r\n  }).forEach(([mgrMethod, {name = mgrMethod, pre, post}]) => {\r\n    const mapper = pre == null\r\n      ? (auction) => auction[name]()\r\n      : (auction) => pre(auction) ? auction[name]() : [];\r\n    const filter = post == null\r\n      ? (items) => items\r\n      : (items) => items.filter(post)\r\n    auctionManager[mgrMethod] = () => {\r\n      return filter(_auctions.toArray().flatMap(mapper));\r\n    }\r\n  })\r\n\r\n  function allBidsReceived() {\r\n    return _auctions.toArray().flatMap(au => au.getBidsReceived())\r\n  }\r\n\r\n  auctionManager.getAllBidsForAdUnitCode = function(adUnitCode) {\r\n    return allBidsReceived()\r\n      .filter(bid => bid && bid.adUnitCode === adUnitCode)\r\n  };\r\n\r\n  auctionManager.createAuction = function(opts) {\r\n    const auction = newAuction(opts);\r\n    _addAuction(auction);\r\n    return auction;\r\n  };\r\n\r\n  auctionManager.findBidByAdId = function(adId) {\r\n    return allBidsReceived()\r\n      .find(bid => bid.adId === adId);\r\n  };\r\n\r\n  auctionManager.getStandardBidderAdServerTargeting = function() {\r\n    return getStandardBidderSettings()[JSON_MAPPING.ADSERVER_TARGETING];\r\n  };\r\n\r\n  auctionManager.setStatusForBids = function(adId, status) {\r\n    const bid = auctionManager.findBidByAdId(adId);\r\n    if (bid) bid.status = status;\r\n\r\n    if (bid && status === BID_STATUS.BID_TARGETING_SET) {\r\n      const auction = getAuction(bid.auctionId);\r\n      if (auction) auction.setBidTargeting(bid);\r\n    }\r\n  }\r\n\r\n  auctionManager.getLastAuctionId = function() {\r\n    const auctions = _auctions.toArray();\r\n    return auctions.length && auctions[auctions.length - 1].getAuctionId()\r\n  };\r\n\r\n  auctionManager.clearAllAuctions = function() {\r\n    _auctions.clear();\r\n  }\r\n\r\n  function _addAuction(auction) {\r\n    _auctions.add(auction);\r\n  }\r\n\r\n  auctionManager.index = new AuctionIndex(() => _auctions.toArray());\r\n\r\n  return auctionManager;\r\n}\r\n\r\nexport const auctionManager = newAuctionManager();\r\n","import { isArrayOfNums, isInteger, isStr, isPlainObject, logWarn } from './utils.js';\r\nimport type {Size} from \"./types/common.d.ts\";\r\nimport type {ORTBImp} from \"./types/ortb/request.d.ts\";\r\nimport type {BaseMediaType} from \"./mediaTypes.ts\";\r\n\r\nconst ORTB_PARAMS = [\r\n  [ 'format', value => Array.isArray(value) && value.length > 0 && value.every(v => typeof v === 'object') ],\r\n  [ 'w', isInteger ],\r\n  [ 'h', isInteger ],\r\n  [ 'btype', isArrayOfNums ],\r\n  [ 'battr', isArrayOfNums ],\r\n  [ 'pos', isInteger ],\r\n  [ 'mimes', value => Array.isArray(value) && value.length > 0 && value.every(v => typeof v === 'string') ],\r\n  [ 'topframe', value => [1, 0].includes(value) ],\r\n  [ 'expdir', isArrayOfNums ],\r\n  [ 'api', isArrayOfNums ],\r\n  [ 'id', isStr ],\r\n  [ 'vcm', value => [1, 0].includes(value) ]\r\n] as const;\r\n\r\n/**\r\n * List of OpenRTB 2.x banner object properties with simple validators.\r\n * Not included: `ext`\r\n * reference: https://github.com/InteractiveAdvertisingBureau/openrtb2.x/blob/main/2.6.md\r\n */\r\nexport const ORTB_BANNER_PARAMS = new Map(ORTB_PARAMS);\r\n\r\n/**\r\n * validateOrtbBannerFields mutates the `adUnit.mediaTypes.banner` object by removing invalid ortb properties (default).\r\n * The onInvalidParam callback can be used to handle invalid properties differently.\r\n * Other properties are ignored and kept as is.\r\n *\r\n * @param {Object} adUnit - The adUnit object.\r\n * @param {Function=} onInvalidParam - The callback function to be called with key, value, and adUnit.\r\n * @returns {void}\r\n */\r\nexport function validateOrtbBannerFields(adUnit, onInvalidParam?) {\r\n  const bannerParams = adUnit?.mediaTypes?.banner;\r\n\r\n  if (!isPlainObject(bannerParams)) {\r\n    logWarn(`validateOrtbBannerFields: bannerParams must be an object.`);\r\n    return;\r\n  }\r\n\r\n  if (bannerParams != null) {\r\n    Object.entries(bannerParams)\r\n      .forEach(([key, value]: any) => {\r\n        if (!ORTB_BANNER_PARAMS.has(key)) {\r\n          return\r\n        }\r\n        const isValid = ORTB_BANNER_PARAMS.get(key)(value);\r\n        if (!isValid) {\r\n          if (typeof onInvalidParam === 'function') {\r\n            onInvalidParam(key, value, adUnit);\r\n          } else {\r\n            logWarn(`Invalid prop in adUnit \"${adUnit.code}\": Invalid value for mediaTypes.banner.${key} ORTB property. The property has been removed.`, adUnit);\r\n            delete bannerParams[key];\r\n          }\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\nexport interface BannerMediaType extends BaseMediaType, Partial<Pick<ORTBImp['banner'], (typeof ORTB_PARAMS)[number][0]>> {\r\n  /**\r\n   * All sizes this ad unit can accept.\r\n   * Examples: [400, 600], [[300, 250], [300, 600]].\r\n   * Prebid recommends that the sizes auctioned by Prebid should be the same auctioned by AdX and GAM OpenBidding, which means AdUnit sizes should match the GPT sizes.\r\n   */\r\n  sizes?: Size | Size[]\r\n}\r\n\r\ndeclare module './bidfactory' {\r\n  interface BannerBidResponseProperties {\r\n    /**\r\n     * Ad markup. Required unless adUrl is provided.\r\n     */\r\n    ad?: string;\r\n    /**\r\n     * Ad URL. Required unless ad is provided.\r\n     */\r\n    adUrl?: string;\r\n  }\r\n}\r\n","import {config} from './config.js';\r\nimport {logError} from './utils.js';\r\nconst CACHE_TTL_SETTING = 'minBidCacheTTL';\r\nlet TTL_BUFFER = 1;\r\nlet minCacheTTL = null;\r\nconst listeners = [];\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * TTL buffer in seconds.\r\n     *\r\n     * When an adapter bids, it provides a TTL (time-to-live); the bid is considered expired and unusuable after that time has elapsed.\r\n     * Core subtracts from it a buffer (default 1 second) that is, a bid with TTL of 30 seconds is considered expired after 29 seconds.\r\n     */\r\n    ttlBuffer?: number;\r\n    /**\r\n     * When set, bids are only kept in memory for the duration of their actual TTL lifetime or the value of minBidCacheTTL, whichever is greater.\r\n     * Setting minBidCacheTTL: 0 causes bids to be dropped as soon as they expire.\r\n     *\r\n     * If unset (the default), bids are kept for the lifetime of the page.\r\n     */\r\n    [CACHE_TTL_SETTING]?: number;\r\n  }\r\n}\r\n\r\nconfig.getConfig('ttlBuffer', (cfg) => {\r\n  if (typeof cfg.ttlBuffer === 'number') {\r\n    TTL_BUFFER = cfg.ttlBuffer;\r\n  } else {\r\n    logError('Invalid value for ttlBuffer', cfg.ttlBuffer);\r\n  }\r\n})\r\n\r\nexport function getBufferedTTL(bid) {\r\n  return bid.ttl - (bid.hasOwnProperty('ttlBuffer') ? bid.ttlBuffer : TTL_BUFFER);\r\n}\r\n\r\nexport function getMinBidCacheTTL() {\r\n  return minCacheTTL;\r\n}\r\n\r\nconfig.getConfig(CACHE_TTL_SETTING, (cfg) => {\r\n  const prev = minCacheTTL;\r\n  minCacheTTL = cfg?.[CACHE_TTL_SETTING];\r\n  minCacheTTL = typeof minCacheTTL === 'number' ? minCacheTTL : null;\r\n  if (prev !== minCacheTTL) {\r\n    listeners.forEach(l => l(minCacheTTL))\r\n  }\r\n})\r\n\r\nexport function onMinBidCacheTTLChange(listener) {\r\n  listeners.push(listener);\r\n}\r\n","import {deepAccess, mergeDeep} from './utils.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport { JSON_MAPPING } from './constants.js';\r\nimport type {BidderCode} from \"./types/common\";\r\nimport type {BidRequest} from \"./adapterManager.ts\";\r\nimport type {Bid} from \"./bidfactory.ts\";\r\nimport type {StorageType} from \"./storageManager.ts\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport interface BidderSettings<B extends BidderCode> {\r\n  /**\r\n   * If true, allow bids with CPM 0to be accepted by Prebid.js and sent to the ad server.\r\n   */\r\n  allowZeroCpmBids?: boolean;\r\n  /**\r\n   * Optionally allow alternate bidder codes to use an adapter’s bidCpmAdjustment function by default instead of\r\n   * the standard bidCpmAdjustment function if present (note: if a bidCpmAdjustment function exists for the alternate\r\n   * bidder code within bidderSettings, then this will be used instead of falling back to the adapter’s bidCpmAdjustment function).\r\n   */\r\n  adjustAlternateBids?: boolean;\r\n  /**\r\n   * If adapter-specific targeting is specified, can be used to suppress the standard targeting for that adapter.\r\n   */\r\n  sendStandardTargeting?: boolean;\r\n  /**\r\n   * If custom adserverTargeting functions are specified that may generate empty keys, this can be used to suppress them.\r\n   */\r\n  suppressEmptyKeys?: boolean;\r\n  /**\r\n   * Allow use of cookies and/or local storage.\r\n   */\r\n  storageAllowed?: boolean | StorageType[];\r\n  /**\r\n   * Allow adapters to bid with alternate bidder codes.\r\n   */\r\n  allowAlternateBidderCodes?: boolean;\r\n  /**\r\n   * Array of bidder codes for which an adapter can bid.\r\n   * undefined or ['*'] will allow adapter to bid with any bidder code.\r\n   */\r\n  allowedAlternateBidderCodes?: ['*'] | BidderCode[];\r\n  /**\r\n   * If true (the default), allow the `Sec-Browsing-Topics` header in requests to their exchange.\r\n   */\r\n  topicsHeader?: boolean;\r\n}\r\n\r\nexport interface BidderScopedSettings<B extends BidderCode> extends BidderSettings<B> {\r\n  /**\r\n   * Custom CPM adjustment function. Could, for example, adjust a bidder’s gross-price bid to net price.\r\n   */\r\n  bidCpmAdjustment?: (cpm: number, bid: Bid, bidRequest: BidRequest<B>) => number;\r\n  /**\r\n   * Define which key/value pairs are sent to the ad server.\r\n   */\r\n  adserverTargeting?: ({\r\n    key: string;\r\n    val(bid: Bid, bidRequest: BidRequest<B>): string;\r\n  })[];\r\n}\r\n\r\nexport class ScopedSettings<SETTINGS extends Record<string, any>, SCOPED extends SETTINGS> {\r\n  getSettings;\r\n  defaultScope;\r\n  constructor(getSettings, defaultScope) {\r\n    this.getSettings = getSettings;\r\n    this.defaultScope = defaultScope;\r\n  }\r\n\r\n  /**\r\n   * Get setting value at `path` under the given scope, falling back to the default scope if needed.\r\n   * If `scope` is `null`, get the setting's default value.\r\n   */\r\n  get<P extends keyof SETTINGS>(scope, path: P): SETTINGS[P] {\r\n    let value = this.getOwn(scope, path);\r\n    if (typeof value === 'undefined') {\r\n      value = this.getOwn(null, path);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Get the setting value at `path` *without* falling back to the default value.\r\n   */\r\n  getOwn<P extends keyof SCOPED>(scope, path: P): SCOPED[P] {\r\n    scope = this.#resolveScope(scope);\r\n    return deepAccess(this.getSettings(), `${scope}.${path as any}`)\r\n  }\r\n\r\n  /**\r\n   * @returns all existing scopes except the default one.\r\n   */\r\n  getScopes(): string[] {\r\n    return Object.keys(this.getSettings()).filter((scope) => scope !== this.defaultScope);\r\n  }\r\n\r\n  /**\r\n   * @returns all settings in the given scope, merged with the settings for the default scope.\r\n   */\r\n  settingsFor(scope): SETTINGS {\r\n    return mergeDeep({}, this.ownSettingsFor(null), this.ownSettingsFor(scope));\r\n  }\r\n\r\n  /**\r\n   * @returns all settings in the given scope, *without* any of the default settings.\r\n   */\r\n  ownSettingsFor(scope): SCOPED {\r\n    scope = this.#resolveScope(scope);\r\n    return this.getSettings()[scope] || {};\r\n  }\r\n\r\n  #resolveScope(scope) {\r\n    if (scope == null) {\r\n      return this.defaultScope;\r\n    } else {\r\n      return scope;\r\n    }\r\n  }\r\n}\r\n\r\nexport const bidderSettings = new ScopedSettings<BidderSettings<BidderCode>, BidderScopedSettings<BidderCode>>(() => getGlobal().bidderSettings || {}, JSON_MAPPING.BD_SETTING_STANDARD);\r\n","import {getUniqueIdentifierStr} from './utils.js';\r\nimport type {BidderCode, BidSource, ContextIdentifiers, Currency, Identifier} from \"./types/common.d.ts\";\r\nimport {MediaType} from \"./mediaTypes.ts\";\r\nimport type {DSAResponse} from \"./types/ortb/ext/dsa.d.ts\";\r\nimport type {EventTrackerResponse} from \"./types/ortb/native.d.ts\";\r\nimport {Metrics} from \"./utils/perfMetrics.ts\";\r\nimport {Renderer} from './Renderer.js';\r\nimport {type BID_STATUS} from \"./constants.ts\";\r\nimport type {DemandChain} from \"./types/ortb/ext/dchain.d.ts\";\r\n\r\ntype BidIdentifiers = ContextIdentifiers & {\r\n  src: BidSource;\r\n  bidder: BidderCode;\r\n  bidId: Identifier;\r\n};\r\n\r\n/**\r\n * Bid metadata.\r\n */\r\nexport interface BidMeta {\r\n  [key: string]: unknown;\r\n  /**\r\n   * Advertiser domains (corresponds to ORTB `bid.adomain`).\r\n   */\r\n  advertiserDomains?: string[];\r\n  /**\r\n   * Primary category ID (corresponds to ORTB `bid.cat[0]`).\r\n   */\r\n  primaryCatId?: string;\r\n  /**\r\n   * IDs of all other categories (corresponds to ORTB `bid.cat.slice(1)`).\r\n   */\r\n  secondaryCatIds?: string[];\r\n  /**\r\n   * Creative attributes (corresponds to ORTB `bid.attr`).\r\n   */\r\n  attr?: number[];\r\n  /**\r\n   * DSA transparency information.\r\n   */\r\n  dsa?: DSAResponse;\r\n  /**\r\n   * Demand chain object.\r\n   */\r\n  dchain?: DemandChain\r\n  /**\r\n   * DSP network name.\r\n   */\r\n  networkName?: string;\r\n  /**\r\n   * DSP network ID.\r\n   */\r\n  networkId?: string | number;\r\n}\r\n\r\n/**\r\n * Bid responses as provided by adapters; core then transforms these into `Bid`s\r\n */\r\nexport interface BaseBidResponse {\r\n  bidderCode?: BidderCode;\r\n  /**\r\n   * This bid's BidRequest's `.bidId`.\r\n   */\r\n  requestId: Identifier;\r\n  mediaType: MediaType;\r\n  cpm: number;\r\n  currency: Currency;\r\n  /**\r\n   * The time to live for this bid response in seconds\r\n   */\r\n  ttl: number;\r\n  creativeId: string;\r\n  /**\r\n   * True if the CPM is the one this bidder will pay\r\n   */\r\n  netRevenue: boolean;\r\n  /**\r\n   * If the bid is associated with a Deal, this field contains the deal ID.\r\n   * @see https://docs.prebid.org/adops/deals.html\r\n   */\r\n  dealId?: string;\r\n  meta?: BidMeta;\r\n  /**\r\n   * If true, and deferred billing was requested for this bid, its creative will not be rendered\r\n   * until billing is explicitly triggered with `pbjs.triggerBilling()`.\r\n   * Useful to avoid premature firing of trackers embedded in the creative.\r\n   */\r\n  deferRendering?: boolean;\r\n  /**\r\n   * Event trackers for this bid.\r\n   */\r\n  eventtrackers?: EventTrackerResponse[];\r\n  renderer?: Renderer;\r\n  /**\r\n   * Billing tracker URL.\r\n   */\r\n  burl?: string;\r\n}\r\n\r\n// <format>BidResponesProperties - adapter interpretResponse properties specific to the format.\r\n// they are included in both BidResponse and Bid types.\r\n// Here we have only \"naked\" declarations, extended in banner/video/native.ts as well as modules.\r\n\r\nexport interface BannerBidResponseProperties {\r\n  mediaType: 'banner';\r\n}\r\n\r\nexport interface VideoBidResponseProperties {\r\n  mediaType: 'video';\r\n}\r\n\r\nexport interface NativeBidResponseProperties {\r\n  mediaType: 'native';\r\n}\r\n\r\nexport type BannerBidResponse = BaseBidResponse & BannerBidResponseProperties;\r\nexport type VideoBidResponse = BaseBidResponse & VideoBidResponseProperties;\r\nexport type NativeBidResponse = BaseBidResponse & NativeBidResponseProperties;\r\n\r\nexport type BidResponse = BannerBidResponse | VideoBidResponse | NativeBidResponse;\r\n\r\nexport interface BaseBid extends ContextIdentifiers, Required<Pick<BaseBidResponse, 'meta' | 'deferRendering'>> {\r\n  /**\r\n   * This bid's BidRequest's `.bidId`. Can be null in some `allowUnknownBidderCodes` scenarios.\r\n   */\r\n  requestId: Identifier | null;\r\n  metrics: Metrics;\r\n  source: BidSource;\r\n  width: number;\r\n  height: number;\r\n  adId: Identifier;\r\n  getSize(): string;\r\n  getStatusCode(): number;\r\n  status?: (typeof BID_STATUS)[keyof typeof BID_STATUS]\r\n  bidderCode: BidderCode;\r\n  adapterCode?: BidderCode;\r\n  /**\r\n   * CPM of this bid before currency conversions or adjustments.\r\n   */\r\n  originalCpm?: number;\r\n  /**\r\n   * Currency for `originalCpm`.\r\n   */\r\n  originalCurrency?: Currency;\r\n  /**\r\n   * If true, this bid will not fire billing trackers until they are explicitly\r\n   * triggered with `pbjs.triggerBilling()`.\r\n   */\r\n  deferBilling: boolean;\r\n}\r\n\r\n// <format>BidProperties - format specific properties of Bid objects generated by Prebid, but not in\r\n// (or different from) adapter responses. Again,these are just naked declarations, extended in their place of\r\n// use.\r\n\r\nexport interface BannerBidProperties {\r\n  mediaType: 'banner';\r\n}\r\n\r\nexport interface NativeBidProperties {\r\n  mediaType: 'native';\r\n}\r\n\r\nexport interface VideoBidProperties {\r\n  mediaType: 'video';\r\n}\r\n\r\ntype BidFrom<RESP, PROPS> = BaseBid & Omit<RESP, keyof BaseBid | keyof PROPS> & PROPS;\r\n\r\ntype _BannerBid = BidFrom<BannerBidResponse, BannerBidProperties>;\r\ntype _VideoBid = BidFrom<VideoBidResponse, VideoBidProperties>;\r\ntype _NativeBid = BidFrom<NativeBidResponse, NativeBidProperties>;\r\n\r\ntype AnyBid = _BannerBid | _VideoBid | _NativeBid;\r\n\r\n// the following adds `property?: undefined` declarations for each property\r\n// that is in some other format, to avoid requiring type casts\r\n// every time that property is used\r\ntype NullProps<T> = {[K in keyof T]?: undefined};\r\ntype NullBid = NullProps<_BannerBid> & NullProps<_VideoBid> & NullProps<_NativeBid>;\r\ntype ExtendBid<B extends AnyBid> = B & Omit<NullBid, keyof B>;\r\n\r\nexport type BannerBid = ExtendBid<_BannerBid>;\r\nexport type VideoBid = ExtendBid<_VideoBid>;\r\nexport type NativeBid = ExtendBid<_NativeBid>;\r\n\r\nexport type Bid = BannerBid | VideoBid | NativeBid;\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-redeclare\r\nfunction Bid({src = 'client', bidder = '', bidId, transactionId, adUnitId, auctionId}: Partial<BidIdentifiers> = {}) {\r\n  var _bidSrc = src;\r\n\r\n  Object.assign(this, {\r\n    bidderCode: bidder,\r\n    width: 0,\r\n    height: 0,\r\n    adId: getUniqueIdentifierStr(),\r\n    requestId: bidId,\r\n    transactionId,\r\n    adUnitId,\r\n    auctionId,\r\n    mediaType: 'banner',\r\n    source: _bidSrc\r\n  })\r\n\r\n  // returns the size of the bid creative. Concatenation of width and height by ‘x’.\r\n  this.getSize = function () {\r\n    return this.width + 'x' + this.height;\r\n  };\r\n}\r\n\r\nexport function createBid(identifiers?: Partial<BidIdentifiers>): Partial<Bid> {\r\n  return new Bid(identifiers);\r\n}\r\n","/*\r\n * Module for getting and setting Prebid configuration.\r\n*/\r\n\r\nimport {isValidPriceConfig} from './cpmBucketManager.js';\r\nimport {\r\n  deepAccess,\r\n  deepClone,\r\n  getParameterByName,\r\n  isArray,\r\n  isBoolean,\r\n  isPlainObject,\r\n  isStr,\r\n  logError,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep\r\n} from './utils.js';\r\nimport {DEBUG_MODE} from './constants.js';\r\nimport type {UserSyncConfig} from \"./userSync.ts\";\r\nimport type {DeepPartial, DeepProperty, DeepPropertyName, TypeOfDeepProperty} from \"./types/objects.d.ts\";\r\nimport type {BidderCode} from \"./types/common.d.ts\";\r\nimport type {ORTBRequest} from \"./types/ortb/request.d.ts\";\r\n\r\nconst DEFAULT_DEBUG = getParameterByName(DEBUG_MODE).toUpperCase() === 'TRUE';\r\nconst DEFAULT_BIDDER_TIMEOUT = 3000;\r\nconst DEFAULT_ENABLE_SEND_ALL_BIDS = true;\r\nconst DEFAULT_DISABLE_AJAX_TIMEOUT = false;\r\nconst DEFAULT_BID_CACHE = false;\r\nconst DEFAULT_DEVICE_ACCESS = true;\r\nconst DEFAULT_MAX_NESTED_IFRAMES = 10;\r\nconst DEFAULT_MAXBID_VALUE = 5000\r\n\r\nconst DEFAULT_IFRAMES_CONFIG = {};\r\n\r\nexport const RANDOM = 'random';\r\nconst FIXED = 'fixed';\r\n\r\nconst VALID_ORDERS = {};\r\nVALID_ORDERS[RANDOM] = true;\r\nVALID_ORDERS[FIXED] = true;\r\n\r\nconst DEFAULT_BIDDER_SEQUENCE = RANDOM;\r\n\r\nconst GRANULARITY_OPTIONS = {\r\n  LOW: 'low',\r\n  MEDIUM: 'medium',\r\n  HIGH: 'high',\r\n  AUTO: 'auto',\r\n  DENSE: 'dense',\r\n  CUSTOM: 'custom'\r\n};\r\n\r\nconst ALL_TOPICS = '*';\r\n\r\nfunction attachProperties(config, useDefaultValues = true) {\r\n  const values = useDefaultValues ? {\r\n    priceGranularity: GRANULARITY_OPTIONS.MEDIUM,\r\n    customPriceBucket: {},\r\n    mediaTypePriceGranularity: {},\r\n    bidderSequence: DEFAULT_BIDDER_SEQUENCE,\r\n    auctionOptions: {}\r\n  } : {}\r\n\r\n  function getProp(name) {\r\n    return values[name];\r\n  }\r\n\r\n  function setProp(name, val) {\r\n    if (!values.hasOwnProperty(name)) {\r\n      Object.defineProperty(config, name, {enumerable: true});\r\n    }\r\n    values[name] = val;\r\n  }\r\n\r\n  const props = {\r\n    publisherDomain: {\r\n      set(val) {\r\n        if (val != null) {\r\n          logWarn('publisherDomain is deprecated and has no effect since v7 - use pageUrl instead')\r\n        }\r\n        setProp('publisherDomain', val);\r\n      }\r\n    },\r\n    priceGranularity: {\r\n      set(val) {\r\n        if (validatePriceGranularity(val)) {\r\n          if (typeof val === 'string') {\r\n            setProp('priceGranularity', (hasGranularity(val)) ? val : GRANULARITY_OPTIONS.MEDIUM);\r\n          } else if (isPlainObject(val)) {\r\n            setProp('customPriceBucket', val);\r\n            setProp('priceGranularity', GRANULARITY_OPTIONS.CUSTOM)\r\n            logMessage('Using custom price granularity');\r\n          }\r\n        }\r\n      }\r\n    },\r\n    customPriceBucket: {},\r\n    mediaTypePriceGranularity: {\r\n      set(val) {\r\n        val != null && setProp('mediaTypePriceGranularity', Object.keys(val).reduce((aggregate, item) => {\r\n          if (validatePriceGranularity(val[item])) {\r\n            if (typeof val === 'string') {\r\n              aggregate[item] = (hasGranularity(val[item])) ? val[item] : getProp('priceGranularity');\r\n            } else if (isPlainObject(val)) {\r\n              aggregate[item] = val[item];\r\n              logMessage(`Using custom price granularity for ${item}`);\r\n            }\r\n          } else {\r\n            logWarn(`Invalid price granularity for media type: ${item}`);\r\n          }\r\n          return aggregate;\r\n        }, {}));\r\n      }\r\n    },\r\n    bidderSequence: {\r\n      set(val) {\r\n        if (VALID_ORDERS[val]) {\r\n          setProp('bidderSequence', val);\r\n        } else {\r\n          logWarn(`Invalid order: ${val}. Bidder Sequence was not set.`);\r\n        }\r\n      }\r\n    },\r\n    auctionOptions: {\r\n      set(val) {\r\n        if (validateauctionOptions(val)) {\r\n          setProp('auctionOptions', val);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  Object.defineProperties(config, Object.fromEntries(\r\n    Object.entries(props)\r\n      .map(([k, def]) => [k, Object.assign({\r\n        get: getProp.bind(null, k),\r\n        set: setProp.bind(null, k),\r\n        enumerable: values.hasOwnProperty(k),\r\n        configurable: !values.hasOwnProperty(k)\r\n      }, def)])\r\n  ));\r\n\r\n  return config;\r\n\r\n  function hasGranularity(val) {\r\n    return Object.keys(GRANULARITY_OPTIONS).find(option => val === GRANULARITY_OPTIONS[option]);\r\n  }\r\n\r\n  function validatePriceGranularity(val) {\r\n    if (!val) {\r\n      logError('Prebid Error: no value passed to `setPriceGranularity()`');\r\n      return false;\r\n    }\r\n    if (typeof val === 'string') {\r\n      if (!hasGranularity(val)) {\r\n        logWarn('Prebid Warning: setPriceGranularity was called with invalid setting, using `medium` as default.');\r\n      }\r\n    } else if (isPlainObject(val)) {\r\n      if (!isValidPriceConfig(val)) {\r\n        logError('Invalid custom price value passed to `setPriceGranularity()`');\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  function validateauctionOptions(val) {\r\n    if (!isPlainObject(val)) {\r\n      logWarn('Auction Options must be an object')\r\n      return false\r\n    }\r\n\r\n    for (const k of Object.keys(val)) {\r\n      if (k !== 'secondaryBidders' && k !== 'suppressStaleRender' && k !== 'suppressExpiredRender') {\r\n        logWarn(`Auction Options given an incorrect param: ${k}`)\r\n        return false\r\n      }\r\n      if (k === 'secondaryBidders') {\r\n        if (!isArray(val[k])) {\r\n          logWarn(`Auction Options ${k} must be of type Array`);\r\n          return false\r\n        } else if (!val[k].every(isStr)) {\r\n          logWarn(`Auction Options ${k} must be only string`);\r\n          return false\r\n        }\r\n      } else if (k === 'suppressStaleRender' || k === 'suppressExpiredRender') {\r\n        if (!isBoolean(val[k])) {\r\n          logWarn(`Auction Options ${k} must be of type boolean`);\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\nexport interface Config {\r\n  /**\r\n   * Enable debug mode. In debug mode, Prebid.js will post additional messages to the browser console and cause\r\n   * Prebid Server to return additional information in its response.\r\n   */\r\n  debug?: boolean;\r\n  /**\r\n   * Global bidder timeout.\r\n   */\r\n  bidderTimeout?: number;\r\n  /**\r\n   * When true, the page will send keywords for all bidders to your ad server.\r\n   */\r\n  enableSendAllBids?: boolean;\r\n  /**\r\n   * Prebid.js currently allows for caching and reusing bids in a very narrowly defined scope.\r\n   * However, if you’d like, you can disable this feature and prevent Prebid.js from using anything but the latest bids for a given auction.\r\n   */\r\n  useBidCache?: boolean;\r\n  /**\r\n   * You can prevent Prebid.js from reading or writing cookies or HTML localstorage by setting this to false.\r\n   */\r\n  deviceAccess?: boolean;\r\n  /**\r\n   * Prebid core adds a timeout on XMLHttpRequest request to terminate the request once auction is timed out.\r\n   * Since Prebid is ignoring all the bids after timeout it does not make sense to continue the request after timeout.\r\n   * However, you have the option to disable this by using disableAjaxTimeout.\r\n   */\r\n  disableAjaxTimeout?: boolean;\r\n  /**\r\n   * Prebid ensures that the bid response price doesn’t exceed the maximum bid.\r\n   * If the CPM (after currency conversion) is higher than the maxBid, the bid is rejected.\r\n   * The default maxBid value is 5000.\r\n   */\r\n  maxBid?: number;\r\n  userSync?: UserSyncConfig;\r\n  /**\r\n   * Set the order in which bidders are called.\r\n   */\r\n  bidderSequence?: typeof RANDOM | typeof FIXED;\r\n  /**\r\n   * When a page is prerendered, by default Prebid will delay auctions until it is activated.\r\n   * Set this to `true` to allow auctions to run during prerendering.\r\n   */\r\n  allowPrerendering?: boolean;\r\n  /**\r\n   * If set to `private`, remove public access to Prebid's alias registry\r\n   */\r\n  aliasRegistry?: 'private'\r\n  /**\r\n   * ORTB-formatted first party data.\r\n   * https://docs.prebid.org/features/firstPartyData.html\r\n   */\r\n  ortb2?: DeepPartial<ORTBRequest>;\r\n}\r\n\r\ntype PartialConfig = Partial<Config> & { [setting: string]: unknown };\r\ntype BidderConfig = {\r\n  bidders: BidderCode[];\r\n  config: PartialConfig;\r\n}\r\n\r\ntype TopicalConfig<S extends string> = {[K in DeepPropertyName<S>]: S extends DeepProperty<Config> ? TypeOfDeepProperty<Config, S> : unknown};\r\ntype UnregistrationFn = () => void;\r\n\r\ntype GetConfigOptions = {\r\n  /**\r\n   * If true, the listener will be called immediately (instead of only on the next configuration change).\r\n   */\r\n  init?: boolean;\r\n}\r\n\r\ninterface GetConfig {\r\n  (): Config;\r\n    <S extends DeepProperty<Config> | string>(setting: S): S extends DeepProperty<Config> ? TypeOfDeepProperty<Config, S> : unknown;\r\n    (topic: typeof ALL_TOPICS, listener: (config: Config) => void, options?: GetConfigOptions): UnregistrationFn;\r\n    <S extends DeepProperty<Config> | string>(topic: S, listener: (config: TopicalConfig<S>) => void, options?: GetConfigOptions): UnregistrationFn;\r\n    (listener: (config: Config) => void, options?: GetConfigOptions): UnregistrationFn;\r\n}\r\n\r\nexport function newConfig() {\r\n  const listeners = [];\r\n  let defaults;\r\n  let config;\r\n  let bidderConfig;\r\n  let currBidder = null;\r\n\r\n  function resetConfig() {\r\n    defaults = {};\r\n\r\n    const newConfig = attachProperties({\r\n      // `debug` is equivalent to legacy `pbjs.logging` property\r\n      debug: DEFAULT_DEBUG,\r\n      bidderTimeout: DEFAULT_BIDDER_TIMEOUT,\r\n      enableSendAllBids: DEFAULT_ENABLE_SEND_ALL_BIDS,\r\n      useBidCache: DEFAULT_BID_CACHE,\r\n\r\n      /**\r\n       * deviceAccess set to false will disable setCookie, getCookie, hasLocalStorage\r\n       * @type {boolean}\r\n       */\r\n      deviceAccess: DEFAULT_DEVICE_ACCESS,\r\n\r\n      disableAjaxTimeout: DEFAULT_DISABLE_AJAX_TIMEOUT,\r\n\r\n      // default max nested iframes for referer detection\r\n      maxNestedIframes: DEFAULT_MAX_NESTED_IFRAMES,\r\n\r\n      // default max bid\r\n      maxBid: DEFAULT_MAXBID_VALUE,\r\n      userSync: {\r\n        topics: DEFAULT_IFRAMES_CONFIG\r\n      }\r\n    });\r\n\r\n    if (config) {\r\n      callSubscribers(\r\n        Object.keys(config).reduce((memo, topic) => {\r\n          if (config[topic] !== newConfig[topic]) {\r\n            memo[topic] = newConfig[topic] || {};\r\n          }\r\n          return memo;\r\n        },\r\n        {})\r\n      );\r\n    }\r\n\r\n    config = newConfig;\r\n    bidderConfig = {};\r\n  }\r\n\r\n  /**\r\n   * Returns base config with bidder overrides (if there is currently a bidder)\r\n   * @private\r\n   */\r\n  function _getConfig() {\r\n    if (currBidder && bidderConfig && isPlainObject(bidderConfig[currBidder])) {\r\n      const curr = bidderConfig[currBidder];\r\n      const topics = new Set([...Object.keys(config), ...Object.keys(curr)]);\r\n      const merged = {};\r\n      for (const topic of topics) {\r\n        const base = config[topic];\r\n        const override = curr[topic];\r\n        merged[topic] = override === undefined ? base\r\n          : base === undefined ? override\r\n            : isPlainObject(override) ? mergeDeep({}, base, override)\r\n              : override;\r\n      }\r\n      return merged;\r\n    }\r\n    return { ...config };\r\n  }\r\n\r\n  function _getRestrictedConfig() {\r\n    // This causes reading 'ortb2' to throw an error; with prebid 7, that will almost\r\n    // always be the incorrect way to access FPD configuration (https://github.com/prebid/Prebid.js/issues/7651)\r\n    // code that needs the ortb2 config should explicitly use `getAnyConfig`\r\n    // TODO: this is meant as a temporary tripwire to catch inadvertent use of `getConfig('ortb')` as we transition.\r\n    // It should be removed once the risk of that happening is low enough.\r\n    const conf = _getConfig();\r\n    Object.defineProperty(conf, 'ortb2', {\r\n      get: function () {\r\n        throw new Error('invalid access to \\'orbt2\\' config - use request parameters instead');\r\n      }\r\n    });\r\n    return conf;\r\n  }\r\n\r\n  const [getAnyConfig, getConfig]: [GetConfig, GetConfig] = [_getConfig, _getRestrictedConfig].map(accessor => {\r\n    /*\r\n     * Returns configuration object if called without parameters,\r\n     * or single configuration property if given a string matching a configuration\r\n     * property name.  Allows deep access e.g. getConfig('currency.adServerCurrency')\r\n     *\r\n     * If called with callback parameter, or a string and a callback parameter,\r\n     * subscribes to configuration updates. See `subscribe` function for usage.\r\n     */\r\n    return function getConfig(...args) {\r\n      if (args.length <= 1 && typeof args[0] !== 'function') {\r\n        const option = args[0];\r\n        return option ? deepAccess(accessor(), option) : _getConfig();\r\n      }\r\n\r\n      return subscribe(...args);\r\n    }\r\n  }) as any;\r\n\r\n  const [readConfig, readAnyConfig]: [GetConfig, GetConfig] = [getConfig, getAnyConfig].map(wrapee => {\r\n    /*\r\n     * Like getConfig, except that it returns a deepClone of the result.\r\n     */\r\n    return function readConfig(...args) {\r\n      let res = (wrapee as any)(...args);\r\n      if (res && typeof res === 'object') {\r\n        res = deepClone(res);\r\n      }\r\n      return res;\r\n    }\r\n  }) as any;\r\n\r\n  /**\r\n   * Internal API for modules (such as prebid-server) that might need access to all bidder config\r\n   */\r\n  function getBidderConfig(): { [bidderCode: BidderCode]: PartialConfig } {\r\n    return bidderConfig;\r\n  }\r\n\r\n  /*\r\n   * Set configuration.\r\n   */\r\n  function setConfig(options: PartialConfig) {\r\n    if (!isPlainObject(options)) {\r\n      logError('setConfig options must be an object');\r\n      return;\r\n    }\r\n\r\n    const topics = Object.keys(options);\r\n    const topicalConfig = {};\r\n\r\n    topics.forEach(topic => {\r\n      let option = options[topic];\r\n\r\n      if (isPlainObject(defaults[topic]) && isPlainObject(option)) {\r\n        option = Object.assign({}, defaults[topic], option);\r\n      }\r\n\r\n      try {\r\n        topicalConfig[topic] = config[topic] = option;\r\n      } catch (e) {\r\n        logWarn(`Cannot set config for property ${topic} : `, e)\r\n      }\r\n    });\r\n\r\n    callSubscribers(topicalConfig);\r\n  }\r\n\r\n  /**\r\n   * Sets configuration defaults which setConfig values can be applied on top of\r\n   * @param {object} options\r\n   */\r\n  function setDefaults(options) {\r\n    if (!isPlainObject(defaults)) {\r\n      logError('defaults must be an object');\r\n      return;\r\n    }\r\n\r\n    Object.assign(defaults, options);\r\n    // Add default values to config as well\r\n    Object.assign(config, options);\r\n  }\r\n\r\n  /*\r\n   * Adds a function to a set of listeners that are invoked whenever `setConfig`\r\n   * is called. The subscribed function will be passed the options object that\r\n   * was used in the `setConfig` call. Topics can be subscribed to to only get\r\n   * updates when specific properties are updated by passing a topic string as\r\n   * the first parameter.\r\n   *\r\n   * If `options.init` is true, the listener will be immediately called with the current options.\r\n   *\r\n   * Returns an `unsubscribe` function for removing the subscriber from the\r\n   * set of listeners\r\n   *\r\n   * Example use:\r\n   * // subscribe to all configuration changes\r\n   * subscribe((config) => console.log('config set:', config));\r\n   *\r\n   * // subscribe to only 'logging' changes\r\n   * subscribe('logging', (config) => console.log('logging set:', config));\r\n   *\r\n   * // unsubscribe\r\n   * const unsubscribe = subscribe(...);\r\n   * unsubscribe(); // no longer listening\r\n   *\r\n   */\r\n  function subscribe(...args: any[]);\r\n  function subscribe(topic, listener, options: GetConfigOptions = {}) {\r\n    let callback = listener;\r\n\r\n    if (typeof topic !== 'string') {\r\n      // first param should be callback function in this case,\r\n      // meaning it gets called for any config change\r\n      callback = topic;\r\n      topic = ALL_TOPICS;\r\n      options = listener || {};\r\n    }\r\n\r\n    if (typeof callback !== 'function') {\r\n      logError('listener must be a function');\r\n      return;\r\n    }\r\n\r\n    const nl = { topic, callback };\r\n    listeners.push(nl);\r\n\r\n    if (options.init) {\r\n      if (topic === ALL_TOPICS) {\r\n        callback(getConfig());\r\n      } else {\r\n        callback({[topic]: getConfig(topic)});\r\n      }\r\n    }\r\n\r\n    // save and call this function to remove the listener\r\n    return function unsubscribe() {\r\n      listeners.splice(listeners.indexOf(nl), 1);\r\n    };\r\n  }\r\n\r\n  /*\r\n   * Calls listeners that were added by the `subscribe` function\r\n   */\r\n  function callSubscribers(options) {\r\n    const TOPICS = Object.keys(options);\r\n\r\n    // call subscribers of a specific topic, passing only that configuration\r\n    listeners\r\n      .filter(listener => TOPICS.includes(listener.topic))\r\n      .forEach(listener => {\r\n        listener.callback({ [listener.topic]: options[listener.topic] });\r\n      });\r\n\r\n    // call subscribers that didn't give a topic, passing everything that was set\r\n    listeners\r\n      .filter(listener => listener.topic === ALL_TOPICS)\r\n      .forEach(listener => listener.callback(options));\r\n  }\r\n\r\n  function setBidderConfig(config: BidderConfig, mergeFlag = false) {\r\n    try {\r\n      check(config);\r\n      config.bidders.forEach(bidder => {\r\n        if (!bidderConfig[bidder]) {\r\n          bidderConfig[bidder] = attachProperties({}, false);\r\n        }\r\n        Object.keys(config.config).forEach(topic => {\r\n          const option = config.config[topic];\r\n          const currentConfig = bidderConfig[bidder][topic];\r\n          if (isPlainObject(option) && (currentConfig == null || isPlainObject(currentConfig))) {\r\n            const func = mergeFlag ? mergeDeep : Object.assign;\r\n            bidderConfig[bidder][topic] = func({}, currentConfig || {}, option);\r\n          } else {\r\n            bidderConfig[bidder][topic] = option;\r\n          }\r\n        });\r\n      });\r\n    } catch (e) {\r\n      logError(e);\r\n    }\r\n\r\n    function check(obj) {\r\n      if (!isPlainObject(obj)) {\r\n        throw new Error('setBidderConfig bidder options must be an object');\r\n      }\r\n      if (!(Array.isArray(obj.bidders) && obj.bidders.length)) {\r\n        throw new Error('setBidderConfig bidder options must contain a bidders list with at least 1 bidder');\r\n      }\r\n      if (!isPlainObject(obj.config)) {\r\n        throw new Error('setBidderConfig bidder options must contain a config object');\r\n      }\r\n    }\r\n  }\r\n\r\n  function mergeConfig(config: PartialConfig) {\r\n    if (!isPlainObject(config)) {\r\n      logError('mergeConfig input must be an object');\r\n      return;\r\n    }\r\n\r\n    const mergedConfig = mergeDeep(_getConfig(), config);\r\n\r\n    setConfig({ ...mergedConfig });\r\n    return mergedConfig;\r\n  }\r\n\r\n  function mergeBidderConfig(config: BidderConfig) {\r\n    return setBidderConfig(config, true);\r\n  }\r\n\r\n  /**\r\n   * Internal functions for core to execute some synchronous code while having an active bidder set.\r\n   */\r\n  function runWithBidder(bidder, fn) {\r\n    currBidder = bidder;\r\n    try {\r\n      return fn();\r\n    } finally {\r\n      resetBidder();\r\n    }\r\n  }\r\n  function callbackWithBidder(bidder) {\r\n    return function(cb) {\r\n      return function(...args) {\r\n        if (typeof cb === 'function') {\r\n          return runWithBidder(bidder, cb.bind(this, ...args))\r\n        } else {\r\n          logWarn('config.callbackWithBidder callback is not a function');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function getCurrentBidder() {\r\n    return currBidder;\r\n  }\r\n\r\n  function resetBidder() {\r\n    currBidder = null;\r\n  }\r\n\r\n  resetConfig();\r\n\r\n  return {\r\n    getCurrentBidder,\r\n    resetBidder,\r\n    getConfig,\r\n    getAnyConfig,\r\n    readConfig,\r\n    readAnyConfig,\r\n    setConfig,\r\n    mergeConfig,\r\n    setDefaults,\r\n    resetConfig,\r\n    runWithBidder,\r\n    callbackWithBidder,\r\n    setBidderConfig,\r\n    getBidderConfig,\r\n    mergeBidderConfig,\r\n  };\r\n}\r\n\r\n/**\r\n * Set a `cache.url` if we should use prebid-cache to store video bids before adding bids to the auction.\r\n * This must be set if you want to use the gamAdServerVideo module.\r\n */\r\nexport const config = newConfig();\r\n","import {cyrb53Hash, isStr, timestamp} from './utils.js';\r\nimport {defer, PbPromise} from './utils/promise.js';\r\nimport {config} from './config.js';\r\nimport type {ModuleType} from \"./activities/modules.ts\";\r\n\r\n/**\r\n * Placeholder gvlid for when vendor consent is not required. When this value is used as gvlid, the gdpr\r\n * enforcement module will take it to mean \"vendor consent was given\".\r\n *\r\n * see https://github.com/prebid/Prebid.js/issues/8161\r\n */\r\nexport const VENDORLESS_GVLID = Object.freeze({});\r\nexport const CONSENT_GDPR = 'gdpr';\r\nexport const CONSENT_GPP = 'gpp';\r\nexport const CONSENT_USP = 'usp';\r\nexport const CONSENT_COPPA = 'coppa';\r\nexport type ConsentType = typeof CONSENT_GDPR | typeof CONSENT_GPP | typeof CONSENT_USP | typeof CONSENT_COPPA;\r\n\r\nexport interface ConsentData {\r\n  // with just core, only coppa is defined - everything else will be null.\r\n  // importing consent modules also imports the type definitions.\r\n  [CONSENT_COPPA]: boolean;\r\n}\r\n\r\ntype ConsentDataFor<T extends ConsentType> = T extends keyof ConsentData ? ConsentData[T] : null;\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface ConsentManagementConfig {\r\n  // consentManagement config - extended in consent management modules\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    consentManagement?: ConsentManagementConfig;\r\n  }\r\n}\r\n\r\nexport class ConsentHandler<T> {\r\n  #enabled;\r\n  #data;\r\n  #defer;\r\n  #ready;\r\n  #dirty = true;\r\n  #hash;\r\n  generatedTime: number;\r\n  hashFields;\r\n\r\n  constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  #resolve(data) {\r\n    this.#ready = true;\r\n    this.#data = data;\r\n    this.#defer.resolve(data);\r\n  }\r\n\r\n  /**\r\n   * reset this handler (mainly for tests)\r\n   */\r\n  reset() {\r\n    this.#defer = defer();\r\n    this.#enabled = false;\r\n    this.#data = null;\r\n    this.#ready = false;\r\n    this.generatedTime = null;\r\n  }\r\n\r\n  /**\r\n   * Enable this consent handler. This should be called by the relevant consent management module\r\n   * on initialization.\r\n   */\r\n  enable() {\r\n    this.#enabled = true;\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean} true if the related consent management module is enabled.\r\n   */\r\n  get enabled() {\r\n    return this.#enabled;\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean} true if consent data has been resolved (it may be `null` if the resolution failed).\r\n   */\r\n  get ready() {\r\n    return this.#ready;\r\n  }\r\n\r\n  /**\r\n   * @returns a promise than resolves to the consent data, or null if no consent data is available\r\n   */\r\n  get promise(): Promise<T> {\r\n    if (this.#ready) {\r\n      return PbPromise.resolve(this.#data);\r\n    }\r\n    if (!this.#enabled) {\r\n      this.#resolve(null);\r\n    }\r\n    return this.#defer.promise;\r\n  }\r\n\r\n  setConsentData(data: T, time = timestamp()) {\r\n    this.generatedTime = time;\r\n    this.#dirty = true;\r\n    this.#resolve(data);\r\n  }\r\n\r\n  getConsentData(): T {\r\n    return this.#data;\r\n  }\r\n\r\n  get hash() {\r\n    if (this.#dirty) {\r\n      this.#hash = cyrb53Hash(JSON.stringify(this.#data && this.hashFields ? this.hashFields.map(f => this.#data[f]) : this.#data))\r\n      this.#dirty = false;\r\n    }\r\n    return this.#hash;\r\n  }\r\n}\r\n\r\nclass UspConsentHandler extends ConsentHandler<ConsentDataFor<typeof CONSENT_USP>> {\r\n  getConsentMeta() {\r\n    const consentData = this.getConsentData();\r\n    if (consentData && this.generatedTime) {\r\n      return {\r\n        generatedAt: this.generatedTime\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nclass GdprConsentHandler extends ConsentHandler<ConsentDataFor<typeof CONSENT_GDPR>> {\r\n  hashFields = ['gdprApplies', 'consentString']\r\n  getConsentMeta() {\r\n    const consentData = this.getConsentData();\r\n    if (consentData && consentData.vendorData && this.generatedTime) {\r\n      return {\r\n        gdprApplies: consentData.gdprApplies as boolean,\r\n        consentStringSize: (isStr(consentData.vendorData.tcString)) ? consentData.vendorData.tcString.length : 0,\r\n        generatedAt: this.generatedTime,\r\n        apiVersion: consentData.apiVersion\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nclass GppConsentHandler extends ConsentHandler<ConsentDataFor<typeof CONSENT_GPP>> {\r\n  hashFields = ['applicableSections', 'gppString'];\r\n  getConsentMeta() {\r\n    const consentData = this.getConsentData();\r\n    if (consentData && this.generatedTime) {\r\n      return {\r\n        generatedAt: this.generatedTime,\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport type GVLID = number | typeof VENDORLESS_GVLID;\r\ntype GVLIDResult = {\r\n  /**\r\n   * A map from module type to that module's GVL ID.\r\n   */\r\n  modules: {\r\n    [moduleType: string]: GVLID;\r\n  };\r\n  /**\r\n   * The single GVL ID for this family of modules (only defined if all modules with this name declared the same ID).\r\n   */\r\n  gvlid?: GVLID;\r\n}\r\n\r\nexport function gvlidRegistry() {\r\n  const registry = {};\r\n  const flat = {};\r\n  const none = {};\r\n  return {\r\n    /**\r\n     * Register a module's GVL ID.\r\n     * @param moduleType defined in `activities/modules.js`\r\n     * @param moduleName\r\n     * @param gvlid\r\n     */\r\n    register(moduleType: ModuleType, moduleName: string, gvlid: GVLID) {\r\n      if (gvlid) {\r\n        (registry[moduleName] = registry[moduleName] || {})[moduleType] = gvlid;\r\n        if (flat.hasOwnProperty(moduleName)) {\r\n          if (flat[moduleName] !== gvlid) flat[moduleName] = none;\r\n        } else {\r\n          flat[moduleName] = gvlid;\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Get a module's GVL ID(s).\r\n     *\r\n     * @param moduleName - The name of the module.\r\n     * @return An object where:\r\n     *   `modules` is a map from module type to that module's GVL ID;\r\n     *   `gvlid` is the single GVL ID for this family of modules (only defined if all modules with this name declare the same ID).\r\n     */\r\n    get(moduleName: string) {\r\n      const result: GVLIDResult = {modules: registry[moduleName] || {}};\r\n      if (flat.hasOwnProperty(moduleName) && flat[moduleName] !== none) {\r\n        result.gvlid = flat[moduleName];\r\n      }\r\n      return result;\r\n    }\r\n  }\r\n}\r\n\r\nexport const gdprDataHandler = new GdprConsentHandler();\r\nexport const uspDataHandler = new UspConsentHandler();\r\nexport const gppDataHandler = new GppConsentHandler();\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * Child Online Privacy Protection Act (COPPA) flag.\r\n     */\r\n    coppa?: boolean;\r\n  }\r\n}\r\n\r\nexport const coppaDataHandler = (() => {\r\n  function getCoppa() {\r\n    return !!(config.getConfig('coppa'))\r\n  }\r\n  return {\r\n    getCoppa,\r\n    getConsentData: getCoppa,\r\n    getConsentMeta: getCoppa,\r\n    reset() {},\r\n    get promise() {\r\n      return PbPromise.resolve(getCoppa())\r\n    },\r\n    get hash() {\r\n      return getCoppa() ? '1' : '0'\r\n    }\r\n  }\r\n})();\r\n\r\nexport const GDPR_GVLIDS = gvlidRegistry();\r\n\r\nconst ALL_HANDLERS = {\r\n  [CONSENT_GDPR]: gdprDataHandler,\r\n  [CONSENT_USP]: uspDataHandler,\r\n  [CONSENT_GPP]: gppDataHandler,\r\n  [CONSENT_COPPA]: coppaDataHandler,\r\n} as const;\r\n\r\nexport type AllConsentData = {\r\n  [K in keyof typeof ALL_HANDLERS]: ReturnType<(typeof ALL_HANDLERS)[K]['getConsentData']>\r\n}\r\n\r\ninterface MultiHandler extends Pick<ConsentHandler<AllConsentData>, 'promise' | 'hash' | 'getConsentData' | 'reset'> {\r\n  getConsentMeta(): {[K in keyof typeof ALL_HANDLERS]: ReturnType<(typeof ALL_HANDLERS)[K]['getConsentMeta']>}\r\n}\r\n\r\nexport function multiHandler(handlers = ALL_HANDLERS): MultiHandler {\r\n  const entries = Object.entries(handlers);\r\n  function collector(method) {\r\n    return function () {\r\n      return Object.fromEntries(entries.map(([name, handler]) => [name, handler[method]()]))\r\n    }\r\n  }\r\n  return Object.assign(\r\n    {\r\n      get promise() {\r\n        return PbPromise.all(entries.map(([name, handler]) => handler.promise.then(val => [name, val])))\r\n          .then(entries => Object.fromEntries(entries));\r\n      },\r\n      get hash() {\r\n        return cyrb53Hash(entries.map(([_, handler]) => handler.hash).join(':'));\r\n      }\r\n    },\r\n    Object.fromEntries(['getConsentData', 'getConsentMeta', 'reset'].map(n => [n, collector(n)])),\r\n  ) as any;\r\n}\r\n\r\nexport const allConsent = multiHandler();\r\n","export const JSON_MAPPING = {\r\n  PL_CODE: 'code',\r\n  PL_SIZE: 'sizes',\r\n  PL_BIDS: 'bids',\r\n  BD_BIDDER: 'bidder',\r\n  BD_ID: 'paramsd',\r\n  BD_PL_ID: 'placementId',\r\n  ADSERVER_TARGETING: 'adserverTargeting',\r\n  BD_SETTING_STANDARD: 'standard'\r\n} as const;\r\n\r\nexport const DEBUG_MODE = 'pbjs_debug';\r\n\r\nexport const STATUS = {\r\n  GOOD: 1\r\n};\r\n\r\nexport const EVENTS = {\r\n  AUCTION_INIT: 'auctionInit',\r\n  AUCTION_TIMEOUT: 'auctionTimeout',\r\n  AUCTION_END: 'auctionEnd',\r\n  BID_ADJUSTMENT: 'bidAdjustment',\r\n  BID_TIMEOUT: 'bidTimeout',\r\n  BID_REQUESTED: 'bidRequested',\r\n  BID_RESPONSE: 'bidResponse',\r\n  BID_REJECTED: 'bidRejected',\r\n  NO_BID: 'noBid',\r\n  SEAT_NON_BID: 'seatNonBid',\r\n  BID_WON: 'bidWon',\r\n  BIDDER_DONE: 'bidderDone',\r\n  BIDDER_ERROR: 'bidderError',\r\n  SET_TARGETING: 'setTargeting',\r\n  BEFORE_REQUEST_BIDS: 'beforeRequestBids',\r\n  BEFORE_BIDDER_HTTP: 'beforeBidderHttp',\r\n  REQUEST_BIDS: 'requestBids',\r\n  ADD_AD_UNITS: 'addAdUnits',\r\n  AD_RENDER_FAILED: 'adRenderFailed',\r\n  AD_RENDER_SUCCEEDED: 'adRenderSucceeded',\r\n  TCF2_ENFORCEMENT: 'tcf2Enforcement',\r\n  AUCTION_DEBUG: 'auctionDebug',\r\n  BID_VIEWABLE: 'bidViewable',\r\n  STALE_RENDER: 'staleRender',\r\n  EXPIRED_RENDER: 'expiredRender',\r\n  BILLABLE_EVENT: 'billableEvent',\r\n  BID_ACCEPTED: 'bidAccepted',\r\n  RUN_PAAPI_AUCTION: 'paapiRunAuction',\r\n  PBS_ANALYTICS: 'pbsAnalytics',\r\n  PAAPI_BID: 'paapiBid',\r\n  PAAPI_NO_BID: 'paapiNoBid',\r\n  PAAPI_ERROR: 'paapiError',\r\n  BEFORE_PBS_HTTP: 'beforePBSHttp',\r\n  BROWSI_INIT: 'browsiInit',\r\n  BROWSI_DATA: 'browsiData',\r\n} as const;\r\n\r\nexport const AD_RENDER_FAILED_REASON = {\r\n  PREVENT_WRITING_ON_MAIN_DOCUMENT: 'preventWritingOnMainDocument',\r\n  NO_AD: 'noAd',\r\n  EXCEPTION: 'exception',\r\n  CANNOT_FIND_AD: 'cannotFindAd',\r\n  MISSING_DOC_OR_ADID: 'missingDocOrAdid'\r\n} as const;\r\n\r\nexport const EVENT_ID_PATHS = {\r\n  bidWon: 'adUnitCode'\r\n} as const;\r\n\r\nexport const GRANULARITY_OPTIONS = {\r\n  LOW: 'low',\r\n  MEDIUM: 'medium',\r\n  HIGH: 'high',\r\n  AUTO: 'auto',\r\n  DENSE: 'dense',\r\n  CUSTOM: 'custom'\r\n} as const;\r\n\r\nexport const TARGETING_KEYS = {\r\n  BIDDER: 'hb_bidder',\r\n  AD_ID: 'hb_adid',\r\n  PRICE_BUCKET: 'hb_pb',\r\n  SIZE: 'hb_size',\r\n  DEAL: 'hb_deal',\r\n  SOURCE: 'hb_source',\r\n  FORMAT: 'hb_format',\r\n  UUID: 'hb_uuid',\r\n  CACHE_ID: 'hb_cache_id',\r\n  CACHE_HOST: 'hb_cache_host',\r\n  ADOMAIN: 'hb_adomain',\r\n  ACAT: 'hb_acat',\r\n  CRID: 'hb_crid',\r\n  DSP: 'hb_dsp'\r\n} as const;\r\n\r\nexport const DEFAULT_TARGETING_KEYS = {\r\n  BIDDER: 'hb_bidder',\r\n  AD_ID: 'hb_adid',\r\n  PRICE_BUCKET: 'hb_pb',\r\n  SIZE: 'hb_size',\r\n  DEAL: 'hb_deal',\r\n  FORMAT: 'hb_format',\r\n  UUID: 'hb_uuid',\r\n  CACHE_HOST: 'hb_cache_host'\r\n};\r\n\r\nexport const NATIVE_KEYS = {\r\n  title: 'hb_native_title',\r\n  body: 'hb_native_body',\r\n  body2: 'hb_native_body2',\r\n  privacyLink: 'hb_native_privacy',\r\n  privacyIcon: 'hb_native_privicon',\r\n  sponsoredBy: 'hb_native_brand',\r\n  image: 'hb_native_image',\r\n  icon: 'hb_native_icon',\r\n  clickUrl: 'hb_native_linkurl',\r\n  displayUrl: 'hb_native_displayurl',\r\n  cta: 'hb_native_cta',\r\n  rating: 'hb_native_rating',\r\n  address: 'hb_native_address',\r\n  downloads: 'hb_native_downloads',\r\n  likes: 'hb_native_likes',\r\n  phone: 'hb_native_phone',\r\n  price: 'hb_native_price',\r\n  salePrice: 'hb_native_saleprice',\r\n  rendererUrl: 'hb_renderer_url',\r\n  adTemplate: 'hb_adTemplate'\r\n};\r\n\r\nexport const S2S = {\r\n  SRC: 's2s',\r\n  DEFAULT_ENDPOINT: 'https://prebid.adnxs.com/pbs/v1/openrtb2/auction',\r\n  SYNCED_BIDDERS_KEY: 'pbjsSyncs'\r\n} as const;\r\n\r\nexport const BID_STATUS = {\r\n  BID_TARGETING_SET: 'targetingSet',\r\n  RENDERED: 'rendered',\r\n  BID_REJECTED: 'bidRejected'\r\n} as const;\r\n\r\nexport const REJECTION_REASON = {\r\n  INVALID: 'Bid has missing or invalid properties',\r\n  INVALID_REQUEST_ID: 'Invalid request ID',\r\n  BIDDER_DISALLOWED: 'Bidder code is not allowed by allowedAlternateBidderCodes / allowUnknownBidderCodes',\r\n  FLOOR_NOT_MET: 'Bid does not meet price floor',\r\n  CANNOT_CONVERT_CURRENCY: 'Unable to convert currency',\r\n  DSA_REQUIRED: 'Bid does not provide required DSA transparency info',\r\n  DSA_MISMATCH: 'Bid indicates inappropriate DSA rendering method',\r\n  PRICE_TOO_HIGH: 'Bid price exceeds maximum value'\r\n};\r\n\r\nexport const PREBID_NATIVE_DATA_KEYS_TO_ORTB = {\r\n  body: 'desc',\r\n  body2: 'desc2',\r\n  sponsoredBy: 'sponsored',\r\n  cta: 'ctatext',\r\n  rating: 'rating',\r\n  address: 'address',\r\n  downloads: 'downloads',\r\n  likes: 'likes',\r\n  phone: 'phone',\r\n  price: 'price',\r\n  salePrice: 'saleprice',\r\n  displayUrl: 'displayurl'\r\n} as const;\r\n\r\nexport const NATIVE_ASSET_TYPES = {\r\n  sponsored: 1,\r\n  desc: 2,\r\n  rating: 3,\r\n  likes: 4,\r\n  downloads: 5,\r\n  price: 6,\r\n  saleprice: 7,\r\n  phone: 8,\r\n  address: 9,\r\n  desc2: 10,\r\n  displayurl: 11,\r\n  ctatext: 12\r\n};\r\n\r\nexport const NATIVE_IMAGE_TYPES = {\r\n  ICON: 1,\r\n  MAIN: 3\r\n};\r\n\r\nexport const NATIVE_KEYS_THAT_ARE_NOT_ASSETS = [\r\n  'privacyIcon',\r\n  'clickUrl',\r\n  'adTemplate',\r\n  'rendererUrl',\r\n  'type'\r\n] as const;\r\n\r\nexport const MESSAGES = {\r\n  REQUEST: 'Prebid Request',\r\n  RESPONSE: 'Prebid Response',\r\n  NATIVE: 'Prebid Native',\r\n  EVENT: 'Prebid Event'\r\n};\r\n\r\nexport const PB_LOCATOR = '__pb_locator__';\r\n","import { isEmpty, logWarn } from './utils.js';\r\nimport { config } from './config.js';\r\n\r\nconst _defaultPrecision = 2;\r\nconst _lgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 5,\r\n    'increment': 0.5\r\n  }]\r\n};\r\nconst _mgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 20,\r\n    'increment': 0.1\r\n  }]\r\n};\r\nconst _hgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 20,\r\n    'increment': 0.01\r\n  }]\r\n};\r\nconst _densePriceConfig = {\r\n  'buckets': [{\r\n    'max': 3,\r\n    'increment': 0.01\r\n  },\r\n  {\r\n    'max': 8,\r\n    'increment': 0.05\r\n  },\r\n  {\r\n    'max': 20,\r\n    'increment': 0.5\r\n  }]\r\n};\r\nconst _autoPriceConfig = {\r\n  'buckets': [{\r\n    'max': 5,\r\n    'increment': 0.05\r\n  },\r\n  {\r\n    'max': 10,\r\n    'increment': 0.1\r\n  },\r\n  {\r\n    'max': 20,\r\n    'increment': 0.5\r\n  }]\r\n};\r\n\r\nfunction getPriceBucketString(cpm, customConfig, granularityMultiplier = 1) {\r\n  let cpmFloat: any = parseFloat(cpm);\r\n  if (isNaN(cpmFloat)) {\r\n    cpmFloat = '';\r\n  }\r\n\r\n  return {\r\n    low: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _lgPriceConfig, granularityMultiplier),\r\n    med: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _mgPriceConfig, granularityMultiplier),\r\n    high: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _hgPriceConfig, granularityMultiplier),\r\n    auto: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _autoPriceConfig, granularityMultiplier),\r\n    dense: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _densePriceConfig, granularityMultiplier),\r\n    custom: (cpmFloat === '') ? '' : getCpmStringValue(cpm, customConfig, granularityMultiplier)\r\n  };\r\n}\r\n\r\nfunction getCpmStringValue(cpm, config, granularityMultiplier) {\r\n  let cpmStr = '';\r\n  if (!isValidPriceConfig(config)) {\r\n    return cpmStr;\r\n  }\r\n  const cap = config.buckets.reduce((prev, curr) => {\r\n    if (prev.max > curr.max) {\r\n      return prev;\r\n    }\r\n    return curr;\r\n  }, {\r\n    'max': 0,\r\n  });\r\n\r\n  let bucketFloor = 0;\r\n  const bucket = config.buckets.find(bucket => {\r\n    if (cpm > cap.max * granularityMultiplier) {\r\n      // cpm exceeds cap, just return the cap.\r\n      let precision = bucket.precision;\r\n      if (typeof precision === 'undefined') {\r\n        precision = _defaultPrecision;\r\n      }\r\n      cpmStr = (bucket.max * granularityMultiplier).toFixed(precision);\r\n    } else if (cpm <= bucket.max * granularityMultiplier && cpm >= bucketFloor * granularityMultiplier) {\r\n      bucket.min = bucketFloor;\r\n      return bucket;\r\n    } else {\r\n      bucketFloor = bucket.max;\r\n    }\r\n  });\r\n  if (bucket) {\r\n    cpmStr = getCpmTarget(cpm, bucket, granularityMultiplier);\r\n  }\r\n  return cpmStr;\r\n}\r\n\r\nfunction isValidPriceConfig(config) {\r\n  if (isEmpty(config) || !config.buckets || !Array.isArray(config.buckets)) {\r\n    return false;\r\n  }\r\n  let isValid = true;\r\n  config.buckets.forEach(bucket => {\r\n    if (!bucket.max || !bucket.increment) {\r\n      isValid = false;\r\n    }\r\n  });\r\n  return isValid;\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * CPM rounding function. Default is Math.floor.\r\n     * @param cpm\r\n     */\r\n    cpmRoundingFunction?: (cpm: number) => number;\r\n  }\r\n}\r\n\r\nfunction getCpmTarget(cpm, bucket, granularityMultiplier) {\r\n  const precision = typeof bucket.precision !== 'undefined' ? bucket.precision : _defaultPrecision;\r\n  const increment = bucket.increment * granularityMultiplier;\r\n  const bucketMin = bucket.min * granularityMultiplier;\r\n  let roundingFunction = Math.floor;\r\n  const customRoundingFunction = config.getConfig('cpmRoundingFunction');\r\n  if (typeof customRoundingFunction === 'function') {\r\n    roundingFunction = customRoundingFunction;\r\n  }\r\n\r\n  // start increments at the bucket min and then add bucket min back to arrive at the correct rounding\r\n  // note - we're padding the values to avoid using decimals in the math prior to flooring\r\n  // this is done as JS can return values slightly below the expected mark which would skew the price bucket target\r\n  //   (eg 4.01 / 0.01 = 400.99999999999994)\r\n  // min precison should be 2 to move decimal place over.\r\n  const pow = Math.pow(10, precision + 2);\r\n  const cpmToRound = ((cpm * pow) - (bucketMin * pow)) / (increment * pow);\r\n  let cpmTarget;\r\n  let invalidRounding;\r\n  // It is likely that we will be passed {cpmRoundingFunction: roundingFunction()}\r\n  // rather than the expected {cpmRoundingFunction: roundingFunction}. Default back to floor in that case\r\n  try {\r\n    cpmTarget = (roundingFunction(cpmToRound) * increment) + bucketMin;\r\n  } catch (err) {\r\n    invalidRounding = true;\r\n  }\r\n  if (invalidRounding || typeof cpmTarget !== 'number') {\r\n    logWarn('Invalid rounding function passed in config');\r\n    cpmTarget = (Math.floor(cpmToRound) * increment) + bucketMin;\r\n  }\r\n  // force to 10 decimal places to deal with imprecise decimal/binary conversions\r\n  //    (for example 0.1 * 3 = 0.30000000000000004)\r\n\r\n  cpmTarget = Number(cpmTarget.toFixed(10));\r\n  return cpmTarget.toFixed(precision);\r\n}\r\n\r\nexport { getPriceBucketString, isValidPriceConfig };\r\n","import {PbPromise} from './utils/promise.js';\r\nimport {createInvisibleIframe} from './utils.js';\r\nimport {RENDERER} from '../libraries/creative-renderer-display/renderer.js';\r\nimport {hook} from './hook.js';\r\n\r\n// the minimum rendererVersion that will be used by PUC\r\nexport const PUC_MIN_VERSION = 3;\r\n\r\nexport const getCreativeRendererSource = hook('sync', function (bidResponse) {\r\n  return RENDERER;\r\n})\r\n\r\nexport const getCreativeRenderer = (function() {\r\n  const renderers = {};\r\n  return function (bidResponse) {\r\n    const src = getCreativeRendererSource(bidResponse);\r\n    if (!renderers.hasOwnProperty(src)) {\r\n      renderers[src] = new PbPromise((resolve) => {\r\n        const iframe = createInvisibleIframe();\r\n        iframe.srcdoc = `<script>${src}</script>`;\r\n        iframe.onload = () => resolve(iframe.contentWindow.render);\r\n        document.body.appendChild(iframe);\r\n      })\r\n    }\r\n    return renderers[src];\r\n  }\r\n})();\r\n","import {config} from './config.js';\r\nimport {getHook, hook} from './hook.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport {logMessage, prefixLog} from './utils.js';\r\nimport {createBid} from './bidfactory.js';\r\nimport {loadExternalScript} from './adloader.js';\r\nimport {PbPromise} from './utils/promise.js';\r\nimport { MODULE_TYPE_PREBID } from './activities/modules.js';\r\n\r\nexport const DEBUG_KEY = '__$$PREBID_GLOBAL$$_debugging__';\r\n\r\nfunction isDebuggingInstalled() {\r\n  return getGlobal().installedModules.includes('debugging');\r\n}\r\n\r\nfunction loadScript(url) {\r\n  return new PbPromise((resolve) => {\r\n    loadExternalScript(url, MODULE_TYPE_PREBID, 'debugging', resolve);\r\n  });\r\n}\r\n\r\nexport function debuggingModuleLoader({alreadyInstalled = isDebuggingInstalled, script = loadScript} = {}) {\r\n  let loading = null;\r\n  return function () {\r\n    if (loading == null) {\r\n      loading = new PbPromise((resolve, reject) => {\r\n        // run this in a 0-delay timeout to give installedModules time to be populated\r\n        setTimeout(() => {\r\n          if (alreadyInstalled()) {\r\n            resolve();\r\n          } else {\r\n            const url = '$$PREBID_DIST_URL_BASE$$debugging-standalone.js';\r\n            logMessage(`Debugging module not installed, loading it from \"${url}\"...`);\r\n            getGlobal()._installDebugging = true;\r\n            script(url).then(() => {\r\n              getGlobal()._installDebugging({DEBUG_KEY, hook, config, createBid, logger: prefixLog('DEBUG:')});\r\n            }).then(resolve, reject);\r\n          }\r\n        });\r\n      })\r\n    }\r\n    return loading;\r\n  }\r\n}\r\n\r\nexport function debuggingControls({load = debuggingModuleLoader(), hook = getHook('requestBids')} = {}) {\r\n  let promise = null;\r\n  let enabled = false;\r\n  function waitForDebugging(next, ...args) {\r\n    return (promise || PbPromise.resolve()).then(() => next.apply(this, args))\r\n  }\r\n  function enable() {\r\n    if (!enabled) {\r\n      promise = load();\r\n      // set debugging to high priority so that it has the opportunity to mess with most things\r\n      hook.before(waitForDebugging, 99);\r\n      enabled = true;\r\n    }\r\n  }\r\n  function disable() {\r\n    hook.getHooks({hook: waitForDebugging}).remove();\r\n    enabled = false;\r\n  }\r\n  function reset() {\r\n    promise = null;\r\n    disable();\r\n  }\r\n  return {enable, disable, reset};\r\n}\r\n\r\nconst ctl = debuggingControls();\r\nexport const reset = ctl.reset;\r\n\r\nexport function loadSession() {\r\n  let storage = null;\r\n  try {\r\n    // eslint-disable-next-line no-restricted-properties\r\n    storage = window.sessionStorage;\r\n  } catch (e) {}\r\n\r\n  if (storage !== null) {\r\n    const debugging = ctl;\r\n    let config = null;\r\n    try {\r\n      config = storage.getItem(DEBUG_KEY);\r\n    } catch (e) {}\r\n    if (config !== null) {\r\n      // just make sure the module runs; it will take care of parsing the config (and disabling itself if necessary)\r\n      debugging.enable();\r\n    }\r\n  }\r\n}\r\n\r\nconfig.getConfig('debugging', function ({debugging}) {\r\n  debugging?.enabled ? ctl.enable() : ctl.disable();\r\n});\r\n","export const TRACKER_METHOD_IMG = 1;\r\nexport const TRACKER_METHOD_JS = 2;\r\nexport const EVENT_TYPE_IMPRESSION = 1;\r\nexport const EVENT_TYPE_WIN = 500;\r\n\r\n/**\r\n * Returns a map from event type (EVENT_TYPE_*)\r\n * to a map from tracker method (TRACKER_METHOD_*)\r\n * to an array of tracking URLs\r\n *\r\n * @param {{}[]} eventTrackers an array of \"Event Tracker Response Object\" as defined\r\n *  in the ORTB native 1.2 spec (https://www.iab.com/wp-content/uploads/2018/03/OpenRTB-Native-Ads-Specification-Final-1.2.pdf, section 5.8)\r\n * @returns {{[type: string]: {[method: string]: string[]}}}\r\n */\r\nexport function parseEventTrackers(eventTrackers) {\r\n  return (eventTrackers ?? []).reduce((tally, {event, method, url}) => {\r\n    const trackersForType = tally[event] = tally[event] ?? {};\r\n    const trackersForMethod = trackersForType[method] = trackersForType[method] ?? [];\r\n    trackersForMethod.push(url);\r\n    return tally;\r\n  }, {})\r\n}\r\n","/**\r\n * events.js\r\n */\r\nimport * as utils from './utils.js'\r\nimport { EVENTS, EVENT_ID_PATHS } from './constants.js';\r\nimport {ttlCollection} from './utils/ttlCollection.js';\r\nimport {config} from './config.js';\r\n\r\ntype CoreEvent = {[K in keyof typeof EVENTS]: typeof EVENTS[K]}[keyof typeof EVENTS];\r\n\r\n// hide video events (unless the video module is included) with this one weird trick\r\n\r\nexport interface EventNames {\r\n  core: CoreEvent;\r\n}\r\ntype AllEvents = {\r\n  [K in EventNames[keyof EventNames]]: unknown[];\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface Events extends AllEvents {\r\n  // map from event name to the type of their arguments\r\n  // this is extended (defining event types) close to where they are emitted\r\n}\r\n\r\nexport type EventIDs = {\r\n  [K in Event]: K extends keyof typeof EVENT_ID_PATHS ? Events[K][0][(typeof EVENT_ID_PATHS)[K]] : undefined;\r\n};\r\n\r\nexport type Event = keyof Events;\r\nexport type EventPayload<E extends Event> = Events[E][0];\r\nexport type EventHandler<E extends Event> = (...args: Events[E]) => void;\r\n\r\nexport type EventRecord<E extends Event> = {\r\n  eventType: E;\r\n  args: EventPayload<E>;\r\n  id: EventIDs[E];\r\n  elapsedTime: number;\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * Maximum time (in seconds) that events should be kept in memory.\r\n     * By default, Prebid keeps in memory a log of every event since the initial page load, and makes it available to analytics adapters and getEvents().\r\n     */\r\n    [TTL_CONFIG]?: number;\r\n  }\r\n}\r\n\r\nconst TTL_CONFIG = 'eventHistoryTTL';\r\n\r\nlet eventTTL = null;\r\n\r\n// keep a record of all events fired\r\nconst eventsFired = ttlCollection<EventRecord<Event>>({\r\n  monotonic: true,\r\n  ttl: () => eventTTL,\r\n})\r\n\r\nconfig.getConfig(TTL_CONFIG, (cfg) => {\r\n  const previous = eventTTL;\r\n  const val = cfg?.[TTL_CONFIG];\r\n  eventTTL = typeof val === 'number' ? val * 1000 : null;\r\n  if (previous !== eventTTL) {\r\n    eventsFired.refresh();\r\n  }\r\n});\r\n\r\n// define entire events\r\nlet allEvents: (Event)[] = Object.values(EVENTS);\r\n\r\nconst idPaths = EVENT_ID_PATHS;\r\n\r\nconst _public = (function () {\r\n  const _handlers: any = {};\r\n\r\n  function _dispatch(eventName, args) {\r\n    utils.logMessage('Emitting event for: ' + eventName);\r\n\r\n    const eventPayload = args[0] || {};\r\n    const idPath = idPaths[eventName];\r\n    const key = eventPayload[idPath];\r\n    const event = _handlers[eventName] || { que: [] };\r\n    var eventKeys = Object.keys(event);\r\n\r\n    const callbacks = [];\r\n\r\n    // record the event:\r\n    eventsFired.add({\r\n      eventType: eventName,\r\n      args: eventPayload,\r\n      id: key,\r\n      elapsedTime: utils.getPerformanceNow(),\r\n    });\r\n\r\n    /**\r\n     * Push each specific callback to the `callbacks` array.\r\n     * If the `event` map has a key that matches the value of the\r\n     * event payload id path, e.g. `eventPayload[idPath]`, then apply\r\n     * each function in the `que` array as an argument to push to the\r\n     * `callbacks` array\r\n     */\r\n    if (key && eventKeys.includes(key)) {\r\n      callbacks.push(...event[key].que);\r\n    }\r\n\r\n    /** Push each general callback to the `callbacks` array. */\r\n    callbacks.push(...event.que);\r\n\r\n    /** call each of the callbacks */\r\n    (callbacks || []).forEach(function (fn) {\r\n      if (!fn) return;\r\n      try {\r\n        fn(...args);\r\n      } catch (e) {\r\n        utils.logError('Error executing handler:', 'events.js', e, eventName);\r\n      }\r\n    });\r\n  }\r\n\r\n  function _checkAvailableEvent(event: string): event is Event {\r\n    return allEvents.includes(event as any);\r\n  }\r\n\r\n  return {\r\n    has: _checkAvailableEvent,\r\n    on: function <E extends Event>(eventName: E, handler: EventHandler<E>, id?: EventIDs[E]) {\r\n      // check whether available event or not\r\n      if (_checkAvailableEvent(eventName)) {\r\n        const event = _handlers[eventName] || { que: [] };\r\n\r\n        if (id) {\r\n          event[id] = event[id] || { que: [] };\r\n          event[id].que.push(handler);\r\n        } else {\r\n          event.que.push(handler);\r\n        }\r\n\r\n        _handlers[eventName] = event;\r\n      } else {\r\n        utils.logError('Wrong event name : ' + eventName + ' Valid event names :' + allEvents);\r\n      }\r\n    },\r\n    emit: function <E extends Event>(eventName: E, ...args: Events[E]) {\r\n      _dispatch(eventName, args);\r\n    },\r\n    off: function<E extends Event>(eventName: E, handler: EventHandler<E>, id?: EventIDs[E]) {\r\n      const event = _handlers[eventName];\r\n\r\n      if (utils.isEmpty(event) || (utils.isEmpty(event.que) && utils.isEmpty(event[id]))) {\r\n        return;\r\n      }\r\n\r\n      if (id && (utils.isEmpty(event[id]) || utils.isEmpty(event[id].que))) {\r\n        return;\r\n      }\r\n\r\n      if (id) {\r\n        (event[id].que || []).forEach(function (_handler) {\r\n          const que = event[id].que;\r\n          if (_handler === handler) {\r\n            que.splice(que.indexOf(_handler), 1);\r\n          }\r\n        });\r\n      } else {\r\n        (event.que || []).forEach(function (_handler) {\r\n          const que = event.que;\r\n          if (_handler === handler) {\r\n            que.splice(que.indexOf(_handler), 1);\r\n          }\r\n        });\r\n      }\r\n\r\n      _handlers[eventName] = event;\r\n    },\r\n    get: function () {\r\n      return _handlers;\r\n    },\r\n    addEvents: function (events: (Event)[]) {\r\n      allEvents = allEvents.concat(events);\r\n    },\r\n    /**\r\n     * Return a copy of all events fired\r\n     */\r\n    getEvents: function (): EventRecord<Event>[] {\r\n      return eventsFired.toArray().map(val => Object.assign({}, val))\r\n    }\r\n  }\r\n}());\r\n\r\nutils._setEventEmitter(_public.emit.bind(_public));\r\n\r\nexport const {on, off, get, getEvents, emit, addEvents, has} = _public;\r\n\r\nexport function clearEvents() {\r\n  eventsFired.clear();\r\n}\r\n","import {hook} from '../hook.js';\r\nimport {getRefererInfo, parseDomain} from '../refererDetection.js';\r\nimport {findRootDomain} from './rootDomain.js';\r\nimport {deepSetValue, deepAccess, getDefinedParams, getDNT, getWinDimensions, getDocument, getWindowSelf, getWindowTop, mergeDeep} from '../utils.js';\r\nimport {config} from '../config.js';\r\nimport {getHighEntropySUA, getLowEntropySUA} from './sua.js';\r\nimport {PbPromise} from '../utils/promise.js';\r\nimport {CLIENT_SECTIONS, clientSectionChecker, hasSection} from './oneClient.js';\r\nimport {isActivityAllowed} from '../activities/rules.js';\r\nimport {activityParams} from '../activities/activityParams.js';\r\nimport {ACTIVITY_ACCESS_DEVICE} from '../activities/activities.js';\r\nimport {MODULE_TYPE_PREBID} from '../activities/modules.js';\r\nimport { getViewportSize } from '../../libraries/viewport/viewport.js';\r\n\r\nexport const dep = {\r\n  getRefererInfo,\r\n  findRootDomain,\r\n  getWindowTop,\r\n  getWindowSelf,\r\n  getHighEntropySUA,\r\n  getLowEntropySUA,\r\n  getDocument\r\n};\r\n\r\nconst oneClient = clientSectionChecker('FPD')\r\n\r\nexport interface FirstPartyDataConfig {\r\n  /**\r\n   * High entropy UA client hints to request.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData#returning_high_entropy_values\r\n   */\r\n  uaHints?: string[]\r\n}\r\n\r\ndeclare module '../config' {\r\n  interface Config {\r\n    firstPartyData?: FirstPartyDataConfig;\r\n  }\r\n}\r\n\r\n/**\r\n * Enrich an ortb2 object with first-party data.\r\n * @param {Promise<Object>} fpd - A promise that resolves to an ortb2 object.\r\n * @returns {Promise<Object>} - A promise that resolves to an enriched ortb2 object.\r\n */\r\nexport const enrichFPD = hook('sync', (fpd) => {\r\n  const promArr = [fpd, getSUA().catch(() => null), tryToGetCdepLabel().catch(() => null)];\r\n\r\n  return PbPromise.all(promArr)\r\n    .then(([ortb2, sua, cdep]) => {\r\n      const ri = dep.getRefererInfo();\r\n      Object.entries(ENRICHMENTS).forEach(([section, getEnrichments]) => {\r\n        const data = getEnrichments(ortb2, ri);\r\n        if (data && Object.keys(data).length > 0) {\r\n          ortb2[section] = mergeDeep({}, data, ortb2[section]);\r\n        }\r\n      });\r\n\r\n      if (sua) {\r\n        deepSetValue(ortb2, 'device.sua', Object.assign({}, sua, ortb2.device.sua));\r\n      }\r\n\r\n      if (cdep) {\r\n        const ext = {\r\n          cdep\r\n        }\r\n        deepSetValue(ortb2, 'device.ext', Object.assign({}, ext, ortb2.device.ext));\r\n      }\r\n\r\n      const documentLang = dep.getDocument().documentElement.lang;\r\n      if (documentLang) {\r\n        deepSetValue(ortb2, 'site.ext.data.documentLang', documentLang);\r\n        if (!deepAccess(ortb2, 'site.content.language')) {\r\n          const langCode = documentLang.split('-')[0];\r\n          deepSetValue(ortb2, 'site.content.language', langCode);\r\n        }\r\n      }\r\n\r\n      ortb2 = oneClient(ortb2);\r\n      for (const section of CLIENT_SECTIONS) {\r\n        if (hasSection(ortb2, section)) {\r\n          ortb2[section] = mergeDeep({}, clientEnrichment(ortb2, ri), ortb2[section]);\r\n          break;\r\n        }\r\n      }\r\n\r\n      return ortb2;\r\n    });\r\n});\r\n\r\nfunction winFallback(fn) {\r\n  try {\r\n    return fn(dep.getWindowTop());\r\n  } catch (e) {\r\n    return fn(dep.getWindowSelf());\r\n  }\r\n}\r\n\r\nfunction getSUA() {\r\n  const hints = config.getConfig('firstPartyData.uaHints');\r\n  return !Array.isArray(hints) || hints.length === 0\r\n    ? PbPromise.resolve(dep.getLowEntropySUA())\r\n    : dep.getHighEntropySUA(hints);\r\n}\r\n\r\nfunction removeUndef(obj) {\r\n  return getDefinedParams(obj, Object.keys(obj))\r\n}\r\n\r\nfunction tryToGetCdepLabel() {\r\n  return PbPromise.resolve('cookieDeprecationLabel' in navigator && isActivityAllowed(ACTIVITY_ACCESS_DEVICE, activityParams(MODULE_TYPE_PREBID, 'cdep')) && (navigator.cookieDeprecationLabel as any).getValue());\r\n}\r\n\r\nconst ENRICHMENTS = {\r\n  site(ortb2, ri) {\r\n    if (CLIENT_SECTIONS.filter(p => p !== 'site').some(hasSection.bind(null, ortb2))) {\r\n      // do not enrich site if dooh or app are set\r\n      return;\r\n    }\r\n    return removeUndef({\r\n      page: ri.page,\r\n      ref: ri.ref,\r\n    });\r\n  },\r\n  device() {\r\n    return winFallback((win) => {\r\n      // screen.width and screen.height are the physical dimensions of the screen\r\n      const w = getWinDimensions().screen.width;\r\n      const h = getWinDimensions().screen.height;\r\n\r\n      // vpw and vph are the viewport dimensions of the browser window\r\n      const {width: vpw, height: vph} = getViewportSize();\r\n\r\n      const device = {\r\n        w,\r\n        h,\r\n        dnt: getDNT() ? 1 : 0,\r\n        ua: win.navigator.userAgent,\r\n        language: win.navigator.language.split('-').shift(),\r\n        ext: {\r\n          vpw,\r\n          vph,\r\n        },\r\n      };\r\n\r\n      if (win.navigator?.webdriver) {\r\n        deepSetValue(device, 'ext.webdriver', true);\r\n      }\r\n\r\n      return device;\r\n    })\r\n  },\r\n  regs() {\r\n    const regs = {} as any;\r\n    if (winFallback((win) => win.navigator.globalPrivacyControl)) {\r\n      deepSetValue(regs, 'ext.gpc', '1');\r\n    }\r\n    const coppa = config.getConfig('coppa');\r\n    if (typeof coppa === 'boolean') {\r\n      regs.coppa = coppa ? 1 : 0;\r\n    }\r\n    return regs;\r\n  }\r\n};\r\n\r\n// Enrichment of properties common across dooh, app and site - will be dropped into whatever\r\n// section is appropriate\r\nfunction clientEnrichment(ortb2, ri) {\r\n  const domain = parseDomain(ri.page, {noLeadingWww: true});\r\n  const keywords = winFallback((win) => win.document.querySelector('meta[name=\\'keywords\\']'))\r\n    ?.content?.replace?.(/\\s/g, '');\r\n  return removeUndef({\r\n    domain,\r\n    keywords,\r\n    publisher: removeUndef({\r\n      domain: dep.findRootDomain(domain)\r\n    })\r\n  })\r\n}\r\n","import {deepEqual, deepSetValue, logWarn} from '../utils.js';\r\nimport {hook} from '../hook.js';\r\n\r\nexport const normalizeFPD = hook('sync', function(ortb2Fragments) {\r\n  [\r\n    normalizeEIDs,\r\n    normalizeSchain\r\n  ].forEach(normalizer => applyNormalizer(normalizer, ortb2Fragments));\r\n  return ortb2Fragments;\r\n})\r\n\r\nfunction applyNormalizer(normalizer, ortb2Fragments) {\r\n  ortb2Fragments.global = normalizer(ortb2Fragments.global, 'global FPD');\r\n  Object.entries(ortb2Fragments.bidder).forEach(([bidder, ortb2]) => {\r\n    ortb2Fragments.bidder[bidder] = normalizer(ortb2, `bidder '${bidder}' FPD`);\r\n  })\r\n}\r\n\r\nexport function normalizeEIDs(target, context) {\r\n  if (!target) return target;\r\n  const seen = [];\r\n  const eids = [\r\n    ...(target?.user?.eids ?? []).map(eid => [0, eid]),\r\n    ...(target?.user?.ext?.eids ?? []).map(eid => [1, eid])\r\n  ].filter(([source, eid]) => {\r\n    if (seen.findIndex(([candidateSource, candidateEid]) =>\r\n      source !== candidateSource && deepEqual(candidateEid, eid)\r\n    ) > -1) {\r\n      logWarn(`Found duplicate EID in user.eids and user.ext.eids (${context})`, eid)\r\n      return false;\r\n    } else {\r\n      seen.push([source, eid]);\r\n      return true;\r\n    }\r\n  });\r\n  if (eids.length > 0) {\r\n    deepSetValue(target, 'user.ext.eids', eids.map(([_, eid]) => eid));\r\n  }\r\n  delete target?.user?.eids;\r\n  return target;\r\n}\r\n\r\nexport function normalizeSchain(target, context) {\r\n  if (!target) return target;\r\n  const schain = target.source?.schain;\r\n  const extSchain = target.source?.ext?.schain;\r\n  if (schain != null && extSchain != null && !deepEqual(schain, extSchain)) {\r\n    logWarn(`Conflicting source.schain and source.ext.schain (${context}), preferring source.schain`, {\r\n      'source.schain': schain,\r\n      'source.ext.schain': extSchain\r\n    })\r\n  }\r\n  if ((schain ?? extSchain) != null) {\r\n    deepSetValue(target, 'source.ext.schain', schain ?? extSchain);\r\n  }\r\n  delete target.source?.schain;\r\n  return target;\r\n}\r\n","import {logWarn} from '../utils.js';\r\n\r\n// mutually exclusive ORTB sections in order of priority - 'dooh' beats 'app' & 'site' and 'app' beats 'site';\r\n// if one is set, the others will be removed\r\nexport const CLIENT_SECTIONS = ['dooh', 'app', 'site']\r\n\r\nexport function clientSectionChecker(logPrefix) {\r\n  return function onlyOneClientSection(ortb2) {\r\n    CLIENT_SECTIONS.reduce((found, section) => {\r\n      if (hasSection(ortb2, section)) {\r\n        if (found != null) {\r\n          logWarn(`${logPrefix} specifies both '${found}' and '${section}'; dropping the latter.`)\r\n          delete ortb2[section];\r\n        } else {\r\n          found = section;\r\n        }\r\n      }\r\n      return found;\r\n    }, null);\r\n    return ortb2;\r\n  }\r\n}\r\n\r\nexport function hasSection(ortb2, section) {\r\n  return ortb2[section] != null && Object.keys(ortb2[section]).length > 0\r\n}\r\n","import {memoize, timestamp} from '../utils.js';\r\nimport {getCoreStorageManager} from '../storageManager.js';\r\n\r\nexport const coreStorage = getCoreStorageManager('fpdEnrichment');\r\n\r\n/**\r\n * Find the root domain by testing for the topmost domain that will allow setting cookies.\r\n */\r\n\r\nexport const findRootDomain = memoize(function findRootDomain(fullDomain = window.location.host) {\r\n  if (!coreStorage.cookiesAreEnabled()) {\r\n    return fullDomain;\r\n  }\r\n\r\n  const domainParts = fullDomain.split('.');\r\n  if (domainParts.length === 2) {\r\n    return fullDomain;\r\n  }\r\n  let rootDomain;\r\n  let continueSearching;\r\n  let startIndex = -2;\r\n  const TEST_COOKIE_NAME = `_rdc${Date.now()}`;\r\n  const TEST_COOKIE_VALUE = 'writeable';\r\n  do {\r\n    rootDomain = domainParts.slice(startIndex).join('.');\r\n    const expirationDate = new Date(timestamp() + 10 * 1000).toUTCString();\r\n\r\n    // Write a test cookie\r\n    coreStorage.setCookie(\r\n      TEST_COOKIE_NAME,\r\n      TEST_COOKIE_VALUE,\r\n      expirationDate,\r\n      'Lax',\r\n      rootDomain,\r\n      undefined\r\n    );\r\n\r\n    // See if the write was successful\r\n    const value = coreStorage.getCookie(TEST_COOKIE_NAME, undefined);\r\n    if (value === TEST_COOKIE_VALUE) {\r\n      continueSearching = false;\r\n      // Delete our test cookie\r\n      coreStorage.setCookie(\r\n        TEST_COOKIE_NAME,\r\n        '',\r\n        'Thu, 01 Jan 1970 00:00:01 GMT',\r\n        undefined,\r\n        rootDomain,\r\n        undefined\r\n      );\r\n    } else {\r\n      startIndex += -1;\r\n      continueSearching = Math.abs(startIndex) <= domainParts.length;\r\n    }\r\n  } while (continueSearching);\r\n  return rootDomain;\r\n});\r\n","import {isEmptyStr, isStr, isEmpty} from '../utils.js';\r\nimport {PbPromise} from '../utils/promise.js';\r\n\r\nexport const SUA_SOURCE_UNKNOWN = 0;\r\nexport const SUA_SOURCE_LOW_ENTROPY = 1;\r\nexport const SUA_SOURCE_HIGH_ENTROPY = 2;\r\nexport const SUA_SOURCE_UA_HEADER = 3;\r\n\r\n// \"high entropy\" (i.e. privacy-sensitive) fields that can be requested from the navigator.\r\nexport const HIGH_ENTROPY_HINTS = [\r\n  'architecture',\r\n  'bitness',\r\n  'model',\r\n  'platformVersion',\r\n  'fullVersionList'\r\n]\r\n\r\nexport const LOW_ENTROPY_HINTS = [\r\n  'brands',\r\n  'mobile',\r\n  'platform'\r\n]\r\n\r\n/**\r\n * Returns low entropy UA client hints encoded as an ortb2.6 device.sua object; or null if no UA client hints are available.\r\n */\r\nexport const getLowEntropySUA = lowEntropySUAAccessor();\r\n\r\n/**\r\n * Returns a promise to high entropy UA client hints encoded as an ortb2.6 device.sua object, or null if no UA client hints are available.\r\n *\r\n * Note that the return value is a promise because the underlying browser API returns a promise; this\r\n * seems to plan for additional controls (such as alerts / permission request prompts to the user); it's unclear\r\n * at the moment if this means that asking for more hints would result in slower / more expensive calls.\r\n *\r\n * @param {Array[String]} hints hints to request, defaults to all (HIGH_ENTROPY_HINTS).\r\n */\r\nexport const getHighEntropySUA = highEntropySUAAccessor();\r\n\r\nexport function lowEntropySUAAccessor(uaData = window.navigator?.userAgentData) {\r\n  const sua = (uaData && LOW_ENTROPY_HINTS.some(h => typeof uaData[h] !== 'undefined')) ? Object.freeze(uaDataToSUA(SUA_SOURCE_LOW_ENTROPY, uaData)) : null;\r\n  return function () {\r\n    return sua;\r\n  }\r\n}\r\n\r\nexport function highEntropySUAAccessor(uaData = window.navigator?.userAgentData) {\r\n  const cache = {};\r\n  const keys = new WeakMap();\r\n  return function (hints = HIGH_ENTROPY_HINTS) {\r\n    if (!keys.has(hints)) {\r\n      const sorted = Array.from(hints);\r\n      sorted.sort();\r\n      keys.set(hints, sorted.join('|'));\r\n    }\r\n    const key = keys.get(hints);\r\n    if (!cache.hasOwnProperty(key)) {\r\n      try {\r\n        cache[key] = uaData.getHighEntropyValues(hints).then(result => {\r\n          return isEmpty(result) ? null : Object.freeze(uaDataToSUA(SUA_SOURCE_HIGH_ENTROPY, result))\r\n        }).catch(() => null);\r\n      } catch (e) {\r\n        cache[key] = PbPromise.resolve(null);\r\n      }\r\n    }\r\n    return cache[key];\r\n  }\r\n}\r\n\r\n/**\r\n * Convert a User Agent client hints object to an ORTB 2.6 device.sua fragment\r\n * https://iabtechlab.com/wp-content/uploads/2022/04/OpenRTB-2-6_FINAL.pdf\r\n *\r\n * @param source source of the UAData object (0 to 3)\r\n * @param uaData https://developer.mozilla.org/en-US/docs/Web/API/NavigatorUAData/\r\n * @return {{}}\r\n */\r\nexport function uaDataToSUA(source, uaData) {\r\n  function toBrandVersion(brand, version) {\r\n    const bv = {brand};\r\n    if (isStr(version) && !isEmptyStr(version)) {\r\n      bv.version = version.split('.');\r\n    }\r\n    return bv;\r\n  }\r\n\r\n  const sua = {source};\r\n  if (uaData.platform) {\r\n    sua.platform = toBrandVersion(uaData.platform, uaData.platformVersion);\r\n  }\r\n  if (uaData.fullVersionList || uaData.brands) {\r\n    sua.browsers = (uaData.fullVersionList || uaData.brands).map(({brand, version}) => toBrandVersion(brand, version));\r\n  }\r\n  if (typeof uaData['mobile'] !== 'undefined') {\r\n    sua.mobile = uaData.mobile ? 1 : 0;\r\n  }\r\n  ['model', 'bitness', 'architecture'].forEach(prop => {\r\n    const value = uaData[prop];\r\n    if (isStr(value)) {\r\n      sua[prop] = value;\r\n    }\r\n  })\r\n  return sua;\r\n}\r\n","import funHooks from 'fun-hooks/no-eval/index.js';\r\nimport {defer} from './utils/promise.js';\r\nimport type {AnyFunction, Wraps} from \"./types/functions.d.ts\";\r\nimport type {AllExceptLast, Last} from \"./types/tuples.d.ts\";\r\n\r\nexport type Next<W extends AnyFunction> = {\r\n  (...args: Parameters<W>): unknown;\r\n  bail(result: ReturnType<W>): void;\r\n}\r\n\r\nexport type HookFunction<W extends AnyFunction> = (next: Next<W>, ...args: Parameters<W>) => unknown;\r\nexport type BeforeHookParams<TYP extends HookType, FN extends AnyFunction> =\r\n    TYP extends 'async'\r\n      ? Last<Parameters<FN>> extends AnyFunction ? AllExceptLast<Parameters<FN>> : Parameters<FN>\r\n      : Parameters<FN>;\r\n\r\nexport type HookType = 'sync' | 'async';\r\n\r\nexport type BeforeHook<TYP extends HookType, FN extends AnyFunction> = HookFunction<(...args: BeforeHookParams<TYP, FN>) => ReturnType<FN>>\r\nexport type AfterHook<FN extends AnyFunction> = HookFunction<(result: ReturnType<FN>) => ReturnType<FN>>;\r\n\r\nexport type Hookable<TYP extends HookType, FN extends AnyFunction> = Wraps<FN> & {\r\n  before(beforeHook: BeforeHook<TYP, FN>, priority?: number): void;\r\n  after(afterHook: AfterHook<FN>, priority?: number): void;\r\n  getHooks(options?: { hook?: BeforeHook<TYP, FN> | AfterHook<FN> }): { length: number, remove(): void }\r\n  removeAll(): void;\r\n}\r\n\r\nexport interface NamedHooks {\r\n  [name: string]: Hookable<HookType, AnyFunction>;\r\n}\r\n\r\ninterface FunHooks {\r\n    <TYP extends HookType, FN extends AnyFunction>(type: TYP, fn: FN, name?: string): Hookable<TYP, FN>;\r\n    ready(): void;\r\n    get<T extends keyof NamedHooks>(name: T): NamedHooks[T]\r\n}\r\n\r\n/**\r\n * NOTE: you must not call `next` asynchronously from 'sync' hooks\r\n * see https://github.com/snapwich/fun-hooks/issues/42\r\n */\r\n\r\nexport const hook: FunHooks = funHooks({\r\n  ready: funHooks.SYNC | funHooks.ASYNC | funHooks.QUEUE\r\n});\r\n\r\nconst readyCtl = defer<void>();\r\nhook.ready = (() => {\r\n  const ready = hook.ready;\r\n  return function () {\r\n    try {\r\n      return ready.apply(hook);\r\n    } finally {\r\n      readyCtl.resolve();\r\n    }\r\n  }\r\n})();\r\n\r\n/**\r\n * A promise that resolves when hooks are ready.\r\n * @type {Promise}\r\n */\r\nexport const ready: Promise<void> = readyCtl.promise;\r\n\r\nexport const getHook = hook.get;\r\n\r\nexport function setupBeforeHookFnOnce<TYP extends HookType, FN extends AnyFunction>(baseFn: Hookable<TYP, FN>, hookFn: BeforeHook<TYP, FN>, priority = 15) {\r\n  const result = baseFn.getHooks({hook: hookFn});\r\n  if (result.length === 0) {\r\n    baseFn.before(hookFn, priority);\r\n  }\r\n}\r\nconst submoduleInstallMap = {};\r\n\r\nexport function module(name, install, {postInstallAllowed = false} = {}) {\r\n  hook('async', function (submodules) {\r\n    submodules.forEach(args => install(...args));\r\n    if (postInstallAllowed) submoduleInstallMap[name] = install;\r\n  }, name)([]); // will be queued until hook.ready() called in pbjs.processQueue();\r\n}\r\n\r\nexport interface Submodules {\r\n  [name: string]: unknown[]\r\n}\r\n\r\nexport function submodule<N extends keyof Submodules>(name: N, ...args: Submodules[N]) {\r\n  const install = submoduleInstallMap[name as any];\r\n  if (install) return install(...args);\r\n  getHook(name).before((next, modules) => {\r\n    modules.push(args);\r\n    next(modules);\r\n  });\r\n}\r\n\r\n/**\r\n * Copy hook methods (.before, .after, etc) from a given hook to a given wrapper object.\r\n */\r\nexport function wrapHook<TYP extends HookType, FN extends AnyFunction>(hook: Hookable<TYP, FN>, wrapper: FN): Hookable<TYP, FN> {\r\n  Object.defineProperties(\r\n    wrapper,\r\n    Object.fromEntries(['before', 'after', 'getHooks', 'removeAll'].map((m) => [m, {get: () => hook[m]}]))\r\n  );\r\n  return (wrapper as unknown) as Hookable<TYP, FN>;\r\n}\r\n\r\n/**\r\n * 'async' hooks expect the last argument to be a callback, and have special treatment for it if it's a function;\r\n * which prevents it from being used as a normal argument in 'before' hooks - and presents a modified version of it\r\n * to the hooked function.\r\n *\r\n * This returns a wrapper around a given 'async' hook that works around this, for when the last argument\r\n * should be treated as a normal argument.\r\n */\r\nexport function ignoreCallbackArg<FN extends AnyFunction>(hook: Hookable<'async', FN>): Hookable<'async', (...args: [...Parameters<FN>, () => void]) => ReturnType<FN>> {\r\n  return wrapHook(hook, function (...args) {\r\n    args.push(function () {})\r\n    return hook.apply(this, args);\r\n  } as any) as any;\r\n}\r\n","/**\r\n * This file contains the valid Media Types in Prebid.\r\n *\r\n * All adapters are assumed to support banner ads. Other media types are specified by Adapters when they\r\n * register themselves with prebid-core.\r\n */\r\nimport type {BannerMediaType} from \"./banner.ts\";\r\nimport type {RendererConfig} from \"./adUnits.ts\";\r\nimport type {VideoMediaType} from \"./video.ts\";\r\nimport type {NativeMediaType} from \"./native.ts\";\r\n\r\nexport type MediaType = typeof NATIVE | typeof VIDEO | typeof BANNER;\r\n\r\nexport interface BaseMediaType {\r\n  /**\r\n   * Custom renderer. Takes precedence over adUnit.renderer, but applies only to this media type.\r\n   */\r\n  renderer?: RendererConfig;\r\n}\r\n\r\nexport interface MediaTypes {\r\n  /**\r\n   * Defines properties of a banner ad.\r\n   */\r\n  banner?: BannerMediaType;\r\n  /**\r\n   * Defines properties of a video ad.\r\n   */\r\n  video?: VideoMediaType;\r\n  /**\r\n   * Defines properties of a native ad.\r\n   */\r\n  native?: NativeMediaType;\r\n}\r\n\r\nexport const NATIVE = 'native';\r\nexport const VIDEO = 'video';\r\nexport const BANNER = 'banner';\r\nexport const ADPOD = 'adpod';\r\n\r\nexport const ALL_MEDIATYPES: MediaType[] = [NATIVE, VIDEO, BANNER];\r\n","import {\r\n  deepClone,\r\n  getDefinedParams,\r\n  insertHtmlIntoIframe,\r\n  isArray,\r\n  isBoolean,\r\n  isInteger,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  pick,\r\n  triggerPixel\r\n} from './utils.js';\r\n\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {\r\n  NATIVE_ASSET_TYPES,\r\n  NATIVE_IMAGE_TYPES,\r\n  NATIVE_KEYS,\r\n  NATIVE_KEYS_THAT_ARE_NOT_ASSETS,\r\n  PREBID_NATIVE_DATA_KEYS_TO_ORTB\r\n} from './constants.js';\r\nimport {NATIVE} from './mediaTypes.js';\r\nimport {getRenderingData} from './adRendering.js';\r\nimport {getCreativeRendererSource, PUC_MIN_VERSION} from './creativeRenderers.js';\r\nimport {EVENT_TYPE_IMPRESSION, parseEventTrackers, TRACKER_METHOD_IMG, TRACKER_METHOD_JS} from './eventTrackers.js';\r\nimport type {Link, NativeRequest, NativeResponse} from \"./types/ortb/native.d.ts\";\r\nimport type {Size} from \"./types/common.d.ts\";\r\nimport type {Ext} from \"./types/ortb/common.d.ts\";\r\nimport type {BidResponse, NativeBidResponse} from \"./bidfactory.ts\";\r\nimport type {AdUnit} from \"./adUnits.ts\";\r\n\r\ntype LegacyAssets = Omit<{[K in keyof (typeof NATIVE_KEYS)]: unknown}, (typeof NATIVE_KEYS_THAT_ARE_NOT_ASSETS)[number]>;\r\ntype LegacyImageAssets = { icon: unknown, image: unknown };\r\n\r\ntype LegacyImageAssetResponse = {\r\n  url: string;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport type LegacyNativeAssetsResponse = {\r\n  [K in keyof Omit<LegacyAssets, keyof LegacyImageAssets>]?: string;\r\n} & {\r\n  [K in keyof LegacyImageAssets]?: LegacyImageAssetResponse\r\n};\r\n\r\nexport type LegacyNativeResponse = LegacyNativeAssetsResponse & {\r\n  clickUrl?: string;\r\n  privacyLink?: string;\r\n  clickTrackers?: string | string[];\r\n  impressionTrackers?: string | string[];\r\n  javascriptTrackers?: string | string[];\r\n};\r\n\r\ndeclare module './bidfactory' {\r\n  interface NativeBidResponseProperties {\r\n    native: LegacyNativeResponse & { ortb?: NativeResponse };\r\n  }\r\n\r\n  // core will always provide ortb for native responses\r\n\r\n  interface NativeBidProperties {\r\n    native: LegacyNativeResponse & { ortb: NativeResponse };\r\n  }\r\n}\r\n\r\ntype LegacyAssetRequest = {\r\n  required?: boolean;\r\n}\r\n\r\nexport type LegacyNativeRequest = {\r\n  privacyLink?: LegacyAssetRequest;\r\n  clickUrl?: LegacyAssetRequest;\r\n  title?: LegacyAssetRequest & {\r\n    len?: number;\r\n  };\r\n  ext?: Ext;\r\n} & {\r\n  [K in keyof typeof PREBID_NATIVE_DATA_KEYS_TO_ORTB]?: LegacyAssetRequest & {\r\n    len?: number;\r\n  }\r\n} & {\r\n  [K in keyof LegacyImageAssets]?: LegacyAssetRequest & {\r\n    sizes?: Size | Size[];\r\n    aspect_ratios?: {\r\n      min_width: number;\r\n      min_height: number;\r\n      ratio_width: number;\r\n      ratio_height: number;\r\n    }[];\r\n  }\r\n}\r\n\r\nexport interface NativeMediaType extends LegacyNativeRequest {\r\n  /**\r\n   * `type: 'image'` acts as a shortcut for a native request for five assets:\r\n   * image, title, \"sponsored by\" data, description (optional), and icon (optional).\r\n   */\r\n  type?: keyof typeof SUPPORTED_TYPES\r\n  ortb?: NativeRequest;\r\n}\r\n\r\nexport const nativeAdapters = [];\r\n\r\nexport const IMAGE: NativeMediaType = {\r\n  ortb: {\r\n    ver: '1.2',\r\n    assets: [\r\n      {\r\n        required: 1,\r\n        id: 1,\r\n        img: {\r\n          type: 3,\r\n          wmin: 100,\r\n          hmin: 100,\r\n        }\r\n      },\r\n      {\r\n        required: 1,\r\n        id: 2,\r\n        title: {\r\n          len: 140,\r\n        }\r\n      },\r\n      {\r\n        required: 1,\r\n        id: 3,\r\n        data: {\r\n          type: 1,\r\n        }\r\n      },\r\n      {\r\n        required: 0,\r\n        id: 4,\r\n        data: {\r\n          type: 2,\r\n        }\r\n      },\r\n      {\r\n        required: 0,\r\n        id: 5,\r\n        img: {\r\n          type: 1,\r\n          wmin: 20,\r\n          hmin: 20,\r\n        }\r\n      },\r\n    ],\r\n  },\r\n  image: { required: true },\r\n  title: { required: true },\r\n  sponsoredBy: { required: true },\r\n  clickUrl: { required: true },\r\n  body: { required: false },\r\n  icon: { required: false },\r\n};\r\n\r\nconst SUPPORTED_TYPES = {\r\n  image: IMAGE\r\n} as const;\r\n\r\n// inverse native maps useful for converting to legacy\r\nconst PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE = inverse(PREBID_NATIVE_DATA_KEYS_TO_ORTB);\r\nconst NATIVE_ASSET_TYPES_INVERSE = inverse(NATIVE_ASSET_TYPES);\r\n\r\nexport function isNativeResponse(bidResponse: BidResponse): bidResponse is NativeBidResponse {\r\n  // check for native data and not mediaType; it's possible\r\n  // to treat banner responses as native\r\n  return (bidResponse as NativeBidResponse).native != null && typeof (bidResponse as NativeBidResponse).native === 'object';\r\n}\r\n\r\n/**\r\n * Recieves nativeParams from an adUnit. If the params were not of type 'type',\r\n * passes them on directly. If they were of type 'type', translate\r\n * them into the predefined specific asset requests for that type of native ad.\r\n */\r\nexport function processNativeAdUnitParams(params: NativeMediaType): NativeMediaType {\r\n  if (params && params.type && typeIsSupported(params.type)) {\r\n    params = SUPPORTED_TYPES[params.type];\r\n  }\r\n\r\n  if (params && params.ortb && !isOpenRTBBidRequestValid(params.ortb)) {\r\n    return;\r\n  }\r\n  return params;\r\n}\r\n\r\ndeclare module './adUnits' {\r\n  interface AdUnit {\r\n    nativeParams?: NativeMediaType;\r\n    nativeOrtbRequest?: NativeRequest;\r\n  }\r\n}\r\n\r\nexport function decorateAdUnitsWithNativeParams(adUnits: AdUnit[]) {\r\n  adUnits.forEach(adUnit => {\r\n    const nativeParams =\r\n      adUnit.nativeParams || adUnit?.mediaTypes?.native;\r\n    if (nativeParams) {\r\n      adUnit.nativeParams = processNativeAdUnitParams(nativeParams);\r\n    }\r\n    if (adUnit.nativeParams) {\r\n      adUnit.nativeOrtbRequest = adUnit.nativeParams.ortb || toOrtbNativeRequest(adUnit.nativeParams);\r\n    }\r\n  });\r\n}\r\nexport function isOpenRTBBidRequestValid(ortb: NativeRequest) {\r\n  const assets = ortb.assets;\r\n  if (!Array.isArray(assets) || assets.length === 0) {\r\n    logError(`assets in mediaTypes.native.ortb is not an array, or it's empty. Assets: `, assets);\r\n    return false;\r\n  }\r\n\r\n  // validate that ids exist, that they are unique and that they are numbers\r\n  const ids = assets.map(asset => asset.id);\r\n  if (assets.length !== new Set(ids).size || ids.some(id => id !== parseInt(id, 10))) {\r\n    logError(`each asset object must have 'id' property, it must be unique and it must be an integer`);\r\n    return false;\r\n  }\r\n\r\n  if (ortb.hasOwnProperty('eventtrackers') && !Array.isArray(ortb.eventtrackers)) {\r\n    logError('ortb.eventtrackers is not an array. Eventtrackers: ', ortb.eventtrackers);\r\n    return false;\r\n  }\r\n\r\n  return assets.every(asset => isOpenRTBAssetValid(asset))\r\n}\r\n\r\nfunction isOpenRTBAssetValid(asset: NativeRequest['assets'][0]) {\r\n  if (!isPlainObject(asset)) {\r\n    logError(`asset must be an object. Provided asset: `, asset);\r\n    return false;\r\n  }\r\n  if (asset.img) {\r\n    if (!isNumber(asset.img.w) && !isNumber(asset.img.wmin)) {\r\n      logError(`for img asset there must be 'w' or 'wmin' property`);\r\n      return false;\r\n    }\r\n    if (!isNumber(asset.img.h) && !isNumber(asset.img.hmin)) {\r\n      logError(`for img asset there must be 'h' or 'hmin' property`);\r\n      return false;\r\n    }\r\n  } else if (asset.title) {\r\n    if (!isNumber(asset.title.len)) {\r\n      logError(`for title asset there must be 'len' property defined`);\r\n      return false;\r\n    }\r\n  } else if (asset.data) {\r\n    if (!isNumber(asset.data.type)) {\r\n      logError(`for data asset 'type' property must be a number`);\r\n      return false;\r\n    }\r\n  } else if (asset.video) {\r\n    if (!Array.isArray(asset.video.mimes) || !Array.isArray(asset.video.protocols) ||\r\n      !isNumber(asset.video.minduration) || !isNumber(asset.video.maxduration)) {\r\n      logError('video asset is not properly configured');\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Check if the native type specified in the adUnit is supported by Prebid.\r\n */\r\nfunction typeIsSupported(type) {\r\n  if (!(type && Object.keys(SUPPORTED_TYPES).includes(type))) {\r\n    logError(`${type} nativeParam is not supported`);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Helper functions for working with native-enabled adUnits\r\n * TODO: abstract this and the video helper functions into general\r\n * adunit validation helper functions\r\n */\r\nexport const nativeAdUnit = adUnit => {\r\n  const mediaType = adUnit.mediaType === 'native';\r\n  const mediaTypes = adUnit?.mediaTypes?.native;\r\n  return mediaType || mediaTypes;\r\n}\r\nexport const nativeBidder = bid => nativeAdapters.includes(bid.bidder);\r\nexport const hasNonNativeBidder = adUnit =>\r\n  adUnit.bids.filter(bid => !nativeBidder(bid)).length;\r\n\r\n/**\r\n * Validate that the native assets on this bid contain all assets that were\r\n * marked as required in the adUnit configuration.\r\n * bid Native bid to validate\r\n * @return {Boolean} If object is valid\r\n */\r\nexport function nativeBidIsValid(bid, {index = auctionManager.index} = {}) {\r\n  const adUnit = index.getAdUnit(bid);\r\n  if (!adUnit) { return false; }\r\n  const ortbRequest = adUnit.nativeOrtbRequest\r\n  const ortbResponse = bid.native?.ortb || toOrtbNativeResponse(bid.native, ortbRequest);\r\n  return isNativeOpenRTBBidValid(ortbResponse, ortbRequest);\r\n}\r\n\r\nexport function isNativeOpenRTBBidValid(bidORTB, bidRequestORTB) {\r\n  if (!bidORTB?.link?.url) {\r\n    logError(`native response doesn't have 'link' property. Ortb response: `, bidORTB);\r\n    return false;\r\n  }\r\n\r\n  const requiredAssetIds = bidRequestORTB.assets.filter(asset => asset.required === 1).map(a => a.id);\r\n  const returnedAssetIds = bidORTB.assets.map(asset => asset.id);\r\n\r\n  const match = requiredAssetIds.every(assetId => returnedAssetIds.includes(assetId));\r\n  if (!match) {\r\n    logError(`didn't receive a bid with all required assets. Required ids: ${requiredAssetIds}, but received ids in response: ${returnedAssetIds}`);\r\n  }\r\n\r\n  return match;\r\n}\r\n\r\n/*\r\n * Native responses may have associated impression or click trackers.\r\n * This retrieves the appropriate tracker urls for the given ad object and\r\n * fires them. As a native creatives may be in a cross-origin frame, it may be\r\n * necessary to invoke this function via postMessage. secureCreatives is\r\n * configured to fire this function when it receives a `message` of 'Prebid Native'\r\n * and an `adId` with the value of the `bid.adId`. When a message is posted with\r\n * these parameters, impression trackers are fired. To fire click trackers, the\r\n * message should contain an `action` set to 'click'.\r\n *\r\n * // Native creative template example usage\r\n * <a href=\"%%CLICK_URL_UNESC%%%%PATTERN:hb_native_linkurl%%\"\r\n *    target=\"_blank\"\r\n *    onclick=\"fireTrackers('click')\">\r\n *    %%PATTERN:hb_native_title%%\r\n * </a>\r\n *\r\n * <script>\r\n *   function fireTrackers(action) {\r\n *     var message = {message: 'Prebid Native', adId: '%%PATTERN:hb_adid%%'};\r\n *     if (action === 'click') {message.action = 'click';} // fires click trackers\r\n *     window.parent.postMessage(JSON.stringify(message), '*');\r\n *   }\r\n *   fireTrackers(); // fires impressions when creative is loaded\r\n * </script>\r\n */\r\nexport function fireNativeTrackers(message, bidResponse) {\r\n  const nativeResponse = bidResponse.native.ortb || legacyPropertiesToOrtbNative(bidResponse.native);\r\n\r\n  if (message.action === 'click') {\r\n    fireClickTrackers(nativeResponse, message?.assetId);\r\n  } else {\r\n    fireImpressionTrackers(nativeResponse);\r\n  }\r\n  return message.action;\r\n}\r\n\r\nexport function fireImpressionTrackers(nativeResponse, {runMarkup = (mkup) => insertHtmlIntoIframe(mkup), fetchURL = triggerPixel} = {}) {\r\n  let {[TRACKER_METHOD_IMG]: img = [], [TRACKER_METHOD_JS]: js = []} = parseEventTrackers(\r\n    nativeResponse.eventtrackers || []\r\n  )[EVENT_TYPE_IMPRESSION] || {};\r\n\r\n  if (nativeResponse.imptrackers) {\r\n    img = img.concat(nativeResponse.imptrackers);\r\n  }\r\n  img.forEach(url => fetchURL(url));\r\n\r\n  js = js.map(url => `<script async src=\"${url}\"></script>`);\r\n  if (nativeResponse.jstracker) {\r\n    // jstracker is already HTML markup\r\n    js = js.concat([nativeResponse.jstracker]);\r\n  }\r\n  if (js.length) {\r\n    runMarkup(js.join('\\n'));\r\n  }\r\n}\r\n\r\nexport function fireClickTrackers(nativeResponse, assetId = null, {fetchURL = triggerPixel} = {}) {\r\n  // legacy click tracker\r\n  if (!assetId) {\r\n    (nativeResponse.link?.clicktrackers || []).forEach(url => fetchURL(url));\r\n  } else {\r\n    // ortb click tracker. This will try to call the clicktracker associated with the asset;\r\n    // will fallback to the link if none is found.\r\n    const assetIdLinkMap = (nativeResponse.assets || [])\r\n      .filter(a => a.link)\r\n      .reduce((map, asset) => {\r\n        map[asset.id] = asset.link;\r\n        return map\r\n      }, {});\r\n    const masterClickTrackers = nativeResponse.link?.clicktrackers || [];\r\n    const assetLink = assetIdLinkMap[assetId];\r\n    let clickTrackers = masterClickTrackers;\r\n    if (assetLink) {\r\n      clickTrackers = assetLink.clicktrackers || [];\r\n    }\r\n    clickTrackers.forEach(url => fetchURL(url));\r\n  }\r\n}\r\n\r\nexport function setNativeResponseProperties(bid, adUnit) {\r\n  const nativeOrtbRequest = adUnit?.nativeOrtbRequest;\r\n  const nativeOrtbResponse = bid.native?.ortb;\r\n\r\n  if (nativeOrtbRequest && nativeOrtbResponse) {\r\n    const legacyResponse = toLegacyResponse(nativeOrtbResponse, nativeOrtbRequest);\r\n    Object.assign(bid.native, legacyResponse);\r\n  }\r\n\r\n  ['rendererUrl', 'adTemplate'].forEach(prop => {\r\n    const val = adUnit?.nativeParams?.[prop];\r\n    if (val) {\r\n      bid.native[prop] = getAssetValue(val);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getNativeAssets(nativeProps, keys, ext = false) {\r\n  const assets = [];\r\n  Object.entries(nativeProps)\r\n    .filter(([k, v]) => v && ((ext === false && k === 'ext') || keys == null || keys.includes(k)))\r\n    .forEach(([key, value]) => {\r\n      if (ext === false && key === 'ext') {\r\n        assets.push(...getNativeAssets(value, keys, true));\r\n      } else if (ext || NATIVE_KEYS.hasOwnProperty(key)) {\r\n        assets.push({key, value: getAssetValue(value)});\r\n      }\r\n    });\r\n  return assets;\r\n}\r\n\r\nexport function getNativeRenderingData(bid, adUnit, keys) {\r\n  const data: any = {\r\n    ...getDefinedParams(bid.native, ['rendererUrl', 'adTemplate']),\r\n    assets: getNativeAssets(bid.native, keys),\r\n    nativeKeys: NATIVE_KEYS\r\n  };\r\n  if (bid.native.ortb) {\r\n    data.ortb = bid.native.ortb;\r\n  } else if (adUnit.mediaTypes?.native?.ortb) {\r\n    data.ortb = toOrtbNativeResponse(bid.native, adUnit.nativeOrtbRequest);\r\n  }\r\n  return data;\r\n}\r\n\r\nfunction assetsMessage(data, adObject, keys, {index = auctionManager.index} = {}) {\r\n  const msg: any = {\r\n    message: 'assetResponse',\r\n    adId: data.adId,\r\n  };\r\n  let renderData = getRenderingData(adObject).native;\r\n  if (renderData) {\r\n    // if we have native rendering data (set up by the nativeRendering module)\r\n    // include it in full (\"all assets\") together with the renderer.\r\n    // this is to allow PUC to use dynamic renderers without requiring changes in creative setup\r\n    msg.native = Object.assign({}, renderData);\r\n    msg.renderer = getCreativeRendererSource(adObject);\r\n    msg.rendererVersion = PUC_MIN_VERSION;\r\n    if (keys != null) {\r\n      renderData.assets = renderData.assets.filter(({key}) => keys.includes(key))\r\n    }\r\n  } else {\r\n    renderData = getNativeRenderingData(adObject, index.getAdUnit(adObject), keys);\r\n  }\r\n  return Object.assign(msg, renderData);\r\n}\r\n\r\nconst NATIVE_KEYS_INVERTED = Object.fromEntries(Object.entries(NATIVE_KEYS).map(([k, v]) => [v, k]));\r\n\r\n/**\r\n * Constructs a message object containing asset values for each of the\r\n * requested data keys.\r\n */\r\nexport function getAssetMessage(data, adObject) {\r\n  const keys = data.assets.map((k) => NATIVE_KEYS_INVERTED[k]);\r\n  return assetsMessage(data, adObject, keys);\r\n}\r\n\r\nexport function getAllAssetsMessage(data, adObject) {\r\n  return assetsMessage(data, adObject, null);\r\n}\r\n\r\n/**\r\n * Native assets can be a string or an object with a url prop. Returns the value\r\n * appropriate for sending in adserver targeting or placeholder replacement.\r\n */\r\nfunction getAssetValue(value) {\r\n  return value?.url || value;\r\n}\r\n/**\r\n * converts Prebid legacy native assets request to OpenRTB format\r\n * @param {object} legacyNativeAssets an object that describes a native bid request in Prebid proprietary format\r\n * @returns an OpenRTB format of the same bid request\r\n */\r\nexport function toOrtbNativeRequest(legacyNativeAssets: LegacyNativeRequest): NativeRequest {\r\n  if (!legacyNativeAssets && !isPlainObject(legacyNativeAssets)) {\r\n    logError('Native assets object is empty or not an object: ', legacyNativeAssets);\r\n    return;\r\n  }\r\n  const ortb: NativeRequest = {\r\n    ver: '1.2',\r\n    assets: []\r\n  };\r\n  for (const key in legacyNativeAssets) {\r\n    // skip conversion for non-asset keys\r\n    if (NATIVE_KEYS_THAT_ARE_NOT_ASSETS.includes(key as any)) continue;\r\n    if (!NATIVE_KEYS.hasOwnProperty(key)) {\r\n      logError(`Unrecognized native asset code: ${key}. Asset will be ignored.`);\r\n      continue;\r\n    }\r\n\r\n    if (key === 'privacyLink') {\r\n      ortb.privacy = 1;\r\n      continue;\r\n    }\r\n\r\n    const asset = legacyNativeAssets[key];\r\n    let required = 0;\r\n    if (asset.required && isBoolean(asset.required)) {\r\n      required = Number(asset.required);\r\n    }\r\n    const ortbAsset: any = {\r\n      id: ortb.assets.length,\r\n      required\r\n    };\r\n    // data cases\r\n    if (key in PREBID_NATIVE_DATA_KEYS_TO_ORTB) {\r\n      ortbAsset.data = {\r\n        type: NATIVE_ASSET_TYPES[PREBID_NATIVE_DATA_KEYS_TO_ORTB[key]]\r\n      }\r\n      if (asset.len) {\r\n        ortbAsset.data.len = asset.len;\r\n      }\r\n    // icon or image case\r\n    } else if (key === 'icon' || key === 'image') {\r\n      ortbAsset.img = {\r\n        type: key === 'icon' ? NATIVE_IMAGE_TYPES.ICON : NATIVE_IMAGE_TYPES.MAIN,\r\n      }\r\n      // if min_width and min_height are defined in aspect_ratio, they are preferred\r\n      if (asset.aspect_ratios) {\r\n        if (!isArray(asset.aspect_ratios)) {\r\n          logError(\"image.aspect_ratios was passed, but it's not a an array:\", asset.aspect_ratios);\r\n        } else if (!asset.aspect_ratios.length) {\r\n          logError(\"image.aspect_ratios was passed, but it's empty:\", asset.aspect_ratios);\r\n        } else {\r\n          const { min_width: minWidth, min_height: minHeight } = asset.aspect_ratios[0];\r\n          if (!isInteger(minWidth) || !isInteger(minHeight)) {\r\n            logError('image.aspect_ratios min_width or min_height are invalid: ', minWidth, minHeight);\r\n          } else {\r\n            ortbAsset.img.wmin = minWidth;\r\n            ortbAsset.img.hmin = minHeight;\r\n          }\r\n          const aspectRatios = asset.aspect_ratios\r\n            .filter((ar) => ar.ratio_width && ar.ratio_height)\r\n            .map(ratio => `${ratio.ratio_width}:${ratio.ratio_height}`);\r\n          if (aspectRatios.length > 0) {\r\n            ortbAsset.img.ext = {\r\n              aspectratios: aspectRatios\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // if asset.sizes exist, by OpenRTB spec we should remove wmin and hmin\r\n      if (asset.sizes) {\r\n        if (asset.sizes.length !== 2 || !isInteger(asset.sizes[0]) || !isInteger(asset.sizes[1])) {\r\n          logError('image.sizes was passed, but its value is not an array of integers:', asset.sizes);\r\n        } else {\r\n          ortbAsset.img.w = asset.sizes[0];\r\n          ortbAsset.img.h = asset.sizes[1];\r\n          delete ortbAsset.img.hmin;\r\n          delete ortbAsset.img.wmin;\r\n        }\r\n      }\r\n    // title case\r\n    } else if (key === 'title') {\r\n      ortbAsset.title = {\r\n        // in openRTB, len is required for titles, while in legacy prebid was not.\r\n        // for this reason, if len is missing in legacy prebid, we're adding a default value of 140.\r\n        len: asset.len || 140\r\n      }\r\n    // all extensions to the native bid request are passed as is\r\n    } else if (key === 'ext') {\r\n      ortbAsset.ext = asset;\r\n      // in `ext` case, required field is not needed\r\n      delete ortbAsset.required;\r\n    }\r\n    ortb.assets.push(ortbAsset);\r\n  }\r\n  return ortb;\r\n}\r\n\r\n/**\r\n * Greatest common divisor between two positive integers\r\n * https://en.wikipedia.org/wiki/Euclidean_algorithm\r\n */\r\nfunction gcd(a, b) {\r\n  while (a && b && a !== b) {\r\n    if (a > b) {\r\n      a = a - b;\r\n    } else {\r\n      b = b - a;\r\n    }\r\n  }\r\n  return a || b;\r\n}\r\n\r\n/**\r\n * This function converts an OpenRTB native request object to Prebid proprietary\r\n * format. The purpose of this function is to help adapters to handle the\r\n * transition phase where publishers may be using OpenRTB objects but the\r\n *  bidder does not yet support it.\r\n * @param {object} openRTBRequest an OpenRTB v1.2 request object\r\n * @returns a Prebid legacy native format request\r\n */\r\nexport function fromOrtbNativeRequest(openRTBRequest: NativeRequest) {\r\n  if (!isOpenRTBBidRequestValid(openRTBRequest)) {\r\n    return;\r\n  }\r\n\r\n  const oldNativeObject: any = {};\r\n  for (const asset of openRTBRequest.assets) {\r\n    if (asset.title) {\r\n      const title = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n        len: asset.title.len\r\n      }\r\n      oldNativeObject.title = title;\r\n    } else if (asset.img) {\r\n      const image: any = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n      }\r\n      if (asset.img.w && asset.img.h) {\r\n        image.sizes = [asset.img.w, asset.img.h];\r\n      } else if (asset.img.wmin && asset.img.hmin) {\r\n        const scale = gcd(asset.img.wmin, asset.img.hmin)\r\n        image.aspect_ratios = [{\r\n          min_width: asset.img.wmin,\r\n          min_height: asset.img.hmin,\r\n          ratio_width: asset.img.wmin / scale,\r\n          ratio_height: asset.img.hmin / scale\r\n        }]\r\n      }\r\n\r\n      if (asset.img.type === NATIVE_IMAGE_TYPES.MAIN) {\r\n        oldNativeObject.image = image;\r\n      } else {\r\n        oldNativeObject.icon = image;\r\n      }\r\n    } else if (asset.data) {\r\n      const assetType = Object.keys(NATIVE_ASSET_TYPES).find(k => NATIVE_ASSET_TYPES[k] === asset.data.type);\r\n      const prebidAssetName = Object.keys(PREBID_NATIVE_DATA_KEYS_TO_ORTB).find(k => PREBID_NATIVE_DATA_KEYS_TO_ORTB[k] === assetType);\r\n      oldNativeObject[prebidAssetName] = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n      }\r\n      if (asset.data.len) {\r\n        oldNativeObject[prebidAssetName].len = asset.data.len;\r\n      }\r\n    }\r\n    if (openRTBRequest.privacy) {\r\n      oldNativeObject.privacyLink = { required: false };\r\n    }\r\n    // video was not supported by old prebid assets\r\n  }\r\n  return oldNativeObject;\r\n}\r\n\r\n/**\r\n * Converts an OpenRTB request to a proprietary Prebid.js format.\r\n * The proprietary Prebid format has many limitations and will be dropped in\r\n * the future; adapters are encouraged to stop using it in favour of OpenRTB format.\r\n * IMPLEMENTATION DETAILS: This function returns the same exact object if no\r\n * conversion is needed. If a conversion is needed (meaning, at least one\r\n * bidRequest contains a native.ortb definition), it will return a copy.\r\n *\r\n * @param bidRequests an array of valid bid requests\r\n * @returns an array of valid bid requests where the openRTB bids are converted to proprietary format.\r\n */\r\nexport function convertOrtbRequestToProprietaryNative(bidRequests) {\r\n  if (FEATURES.NATIVE) {\r\n    if (!bidRequests || !isArray(bidRequests)) return bidRequests;\r\n    // check if a conversion is needed\r\n    if (!bidRequests.some(bidRequest => (bidRequest?.mediaTypes || {})[NATIVE]?.ortb)) {\r\n      return bidRequests;\r\n    }\r\n    const bidRequestsCopy = deepClone(bidRequests);\r\n    // convert Native ORTB definition to old-style prebid native definition\r\n    for (const bidRequest of bidRequestsCopy) {\r\n      if (bidRequest.mediaTypes && bidRequest.mediaTypes[NATIVE] && bidRequest.mediaTypes[NATIVE].ortb) {\r\n        bidRequest.mediaTypes[NATIVE] = Object.assign(\r\n          pick(bidRequest.mediaTypes[NATIVE], NATIVE_KEYS_THAT_ARE_NOT_ASSETS),\r\n          fromOrtbNativeRequest(bidRequest.mediaTypes[NATIVE].ortb)\r\n        );\r\n        bidRequest.nativeParams = processNativeAdUnitParams(bidRequest.mediaTypes[NATIVE]);\r\n      }\r\n    }\r\n    return bidRequestsCopy;\r\n  }\r\n  return bidRequests;\r\n}\r\n\r\n/**\r\n * convert PBJS proprietary native properties that are *not* assets to the ORTB native format.\r\n *\r\n * @param legacyNative `bidResponse.native` object as returned by adapters\r\n */\r\nexport function legacyPropertiesToOrtbNative(legacyNative: LegacyNativeResponse): Partial<NativeResponse> {\r\n  const response: NativeResponse = {\r\n    link: {} as Link,\r\n    eventtrackers: []\r\n  }\r\n  Object.entries(legacyNative).forEach(([key, value]) => {\r\n    switch (key) {\r\n      case 'clickUrl':\r\n        response.link.url = value as string;\r\n        break;\r\n      case 'clickTrackers':\r\n        response.link.clicktrackers = (Array.isArray(value) ? value : [value]) as string[];\r\n        break;\r\n      case 'impressionTrackers':\r\n        (Array.isArray(value) ? value : [value]).forEach((url: string) => {\r\n          response.eventtrackers.push({\r\n            event: EVENT_TYPE_IMPRESSION,\r\n            method: TRACKER_METHOD_IMG,\r\n            url\r\n          });\r\n        });\r\n        break;\r\n      case 'javascriptTrackers':\r\n        // jstracker is deprecated, but we need to use it here since 'javascriptTrackers' is markup, not an url\r\n        // TODO: at the time of writing this, core expected javascriptTrackers to be a string (despite the name),\r\n        // but many adapters are passing an array. It's possible that some of them are, in fact, passing URLs and not markup\r\n        // in general, native trackers seem to be neglected and/or broken\r\n        response.jstracker = Array.isArray(value) ? value.join('') : value as string;\r\n        break;\r\n      case 'privacyLink':\r\n        response.privacy = value as string;\r\n        break;\r\n    }\r\n  });\r\n  return response;\r\n}\r\n\r\nexport function toOrtbNativeResponse(legacyResponse: LegacyNativeResponse, ortbRequest): NativeResponse {\r\n  const ortbResponse = {\r\n    ...legacyPropertiesToOrtbNative(legacyResponse),\r\n    assets: []\r\n  } as NativeResponse;\r\n\r\n  function useRequestAsset(predicate, fn) {\r\n    let asset = ortbRequest.assets.find(predicate);\r\n    if (asset != null) {\r\n      asset = deepClone(asset);\r\n      fn(asset);\r\n      ortbResponse.assets.push(asset);\r\n    }\r\n  }\r\n\r\n  Object.keys(legacyResponse).filter(key => !!legacyResponse[key]).forEach(key => {\r\n    const value = getAssetValue(legacyResponse[key]);\r\n    switch (key) {\r\n      // process titles\r\n      case 'title':\r\n        useRequestAsset(asset => asset.title != null, titleAsset => {\r\n          titleAsset.title = {\r\n            text: value\r\n          };\r\n        })\r\n        break;\r\n      case 'image':\r\n      case 'icon':\r\n        const imageType = key === 'image' ? NATIVE_IMAGE_TYPES.MAIN : NATIVE_IMAGE_TYPES.ICON;\r\n        useRequestAsset(asset => asset.img != null && asset.img.type === imageType, imageAsset => {\r\n          imageAsset.img = {\r\n            url: value\r\n          };\r\n        })\r\n        break;\r\n      default:\r\n        if (key in PREBID_NATIVE_DATA_KEYS_TO_ORTB) {\r\n          useRequestAsset(asset => asset.data != null && asset.data.type === NATIVE_ASSET_TYPES[PREBID_NATIVE_DATA_KEYS_TO_ORTB[key]], dataAsset => {\r\n            dataAsset.data = {\r\n              value\r\n            };\r\n          })\r\n        }\r\n        break;\r\n    }\r\n  });\r\n  return ortbResponse;\r\n}\r\n\r\n/**\r\n * Generates a legacy response from an ortb response. Useful during the transition period.\r\n * @param {*} ortbResponse a standard ortb response object\r\n * @param {*} ortbRequest the ortb request, useful to match ids.\r\n * @returns an object containing the response in legacy native format: { title: \"this is a title\", image: ... }\r\n */\r\nexport function toLegacyResponse(ortbResponse: NativeResponse, ortbRequest: NativeRequest) {\r\n  const legacyResponse = {} as LegacyNativeResponse;\r\n  const requestAssets = ortbRequest?.assets || [];\r\n  legacyResponse.clickUrl = ortbResponse.link?.url;\r\n  legacyResponse.privacyLink = ortbResponse.privacy;\r\n  for (const asset of ortbResponse?.assets || []) {\r\n    const requestAsset = requestAssets.find(reqAsset => asset.id === reqAsset.id);\r\n    if (asset.title) {\r\n      legacyResponse.title = asset.title.text;\r\n    } else if (asset.img) {\r\n      legacyResponse[requestAsset?.img?.type === NATIVE_IMAGE_TYPES.MAIN ? 'image' : 'icon'] = {\r\n        url: asset.img.url,\r\n        width: asset.img.w,\r\n        height: asset.img.h\r\n      };\r\n    } else if (asset.data) {\r\n      legacyResponse[PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE[NATIVE_ASSET_TYPES_INVERSE[requestAsset?.data?.type]]] = asset.data.value;\r\n    }\r\n  }\r\n\r\n  // Handle trackers\r\n  legacyResponse.impressionTrackers = [];\r\n  let jsTrackers = [];\r\n\r\n  if (ortbResponse.imptrackers) {\r\n    legacyResponse.impressionTrackers.push(...ortbResponse.imptrackers);\r\n  }\r\n  for (const eventTracker of ortbResponse?.eventtrackers || []) {\r\n    if (eventTracker.event === EVENT_TYPE_IMPRESSION && eventTracker.method === TRACKER_METHOD_IMG) {\r\n      legacyResponse.impressionTrackers.push(eventTracker.url);\r\n    }\r\n    if (eventTracker.event === EVENT_TYPE_IMPRESSION && eventTracker.method === TRACKER_METHOD_JS) {\r\n      jsTrackers.push(eventTracker.url);\r\n    }\r\n  }\r\n\r\n  jsTrackers = jsTrackers.map(url => `<script async src=\"${url}\"></script>`);\r\n  if (ortbResponse?.jstracker) { jsTrackers.push(ortbResponse.jstracker); }\r\n  if (jsTrackers.length) {\r\n    legacyResponse.javascriptTrackers = jsTrackers.join('\\n');\r\n  }\r\n\r\n  return legacyResponse;\r\n}\r\n\r\n/**\r\n * Inverts key-values of an object.\r\n */\r\nfunction inverse(obj) {\r\n  var retobj = {};\r\n  for (var key in obj) {\r\n    retobj[obj[key]] = key;\r\n  }\r\n  return retobj;\r\n}\r\n","export const PROCESSOR_TYPES = ['request', 'imp', 'bidResponse', 'response'] as const;\r\nexport const PROCESSOR_DIALECTS = ['default', 'pbs'];\r\nexport const [REQUEST, IMP, BID_RESPONSE, RESPONSE] = PROCESSOR_TYPES;\r\nexport const [DEFAULT, PBS] = PROCESSOR_DIALECTS;\r\n\r\nconst types = new Set(PROCESSOR_TYPES);\r\n\r\nexport function processorRegistry() {\r\n  const processors = {};\r\n\r\n  return {\r\n    registerOrtbProcessor({type, name, fn, priority = 0, dialects = [DEFAULT]}) {\r\n      if (!types.has(type)) {\r\n        throw new Error(`ORTB processor type must be one of: ${PROCESSOR_TYPES.join(', ')}`)\r\n      }\r\n      dialects.forEach(dialect => {\r\n        if (!processors.hasOwnProperty(dialect)) {\r\n          processors[dialect] = {};\r\n        }\r\n        if (!processors[dialect].hasOwnProperty(type)) {\r\n          processors[dialect][type] = {};\r\n        }\r\n        processors[dialect][type][name] = {\r\n          priority,\r\n          fn\r\n        }\r\n      })\r\n    },\r\n    getProcessors(dialect) {\r\n      return processors[dialect] || {};\r\n    }\r\n  }\r\n}\r\n\r\nexport const {registerOrtbProcessor, getProcessors} = processorRegistry();\r\n","/** @module pbjs */\r\n\r\nimport {getGlobal, type PrebidJS} from './prebidGlobal.js';\r\nimport {\r\n  deepAccess,\r\n  deepClone,\r\n  deepEqual,\r\n  deepSetValue,\r\n  flatten,\r\n  generateUUID,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isEmpty,\r\n  isFn,\r\n  isGptPubadsDefined,\r\n  isNumber,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep,\r\n  transformAdServerTargetingObj,\r\n  uniques,\r\n  unsupportedBidderMessage\r\n} from './utils.js';\r\nimport {listenMessagesFromCreative} from './secureCreatives.js';\r\nimport {userSync} from './userSync.js';\r\nimport {config} from './config.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {isBidUsable, type SlotMatchingFn, targeting} from './targeting.js';\r\nimport {hook, wrapHook} from './hook.js';\r\nimport {loadSession} from './debugging.js';\r\nimport {storageCallbacks} from './storageManager.js';\r\nimport adapterManager, {\r\n  type AliasBidderOptions,\r\n  type BidRequest,\r\n  getS2SBidderSet\r\n} from './adapterManager.js';\r\nimport {BID_STATUS, EVENTS, NATIVE_KEYS} from './constants.js';\r\nimport type {EventHandler, EventIDs, Event} from \"./events.js\";\r\nimport * as events from './events.js';\r\nimport {type Metrics, newMetrics, useMetrics} from './utils/perfMetrics.js';\r\nimport {type Defer, defer, PbPromise} from './utils/promise.js';\r\nimport {pbYield} from './utils/yield.js';\r\nimport {enrichFPD} from './fpd/enrichment.js';\r\nimport {allConsent} from './consentHandler.js';\r\nimport {\r\n  insertLocatorFrame,\r\n  markBidAsRendered,\r\n  markWinningBid,\r\n  renderAdDirect,\r\n  renderIfDeferred\r\n} from './adRendering.js';\r\nimport {getHighestCpm} from './utils/reducers.js';\r\nimport {fillVideoDefaults, ORTB_VIDEO_PARAMS, validateOrtbVideoFields} from './video.js';\r\nimport {ORTB_BANNER_PARAMS, validateOrtbBannerFields} from './banner.js';\r\nimport {BANNER, VIDEO} from './mediaTypes.js';\r\nimport {delayIfPrerendering} from './utils/prerendering.js';\r\nimport {type BidAdapter, type BidderSpec, newBidder} from './adapters/bidderFactory.js';\r\nimport {normalizeFPD} from './fpd/normalize.js';\r\nimport type {Bid} from \"./bidfactory.ts\";\r\nimport type {AdUnit, AdUnitDefinition, BidderParams} from \"./adUnits.ts\";\r\nimport type {AdUnitCode, BidderCode, ByAdUnit, Identifier, ORTBFragments} from \"./types/common.d.ts\";\r\nimport type {ORTBRequest} from \"./types/ortb/request.d.ts\";\r\nimport type {DeepPartial} from \"./types/objects.d.ts\";\r\nimport type {AnyFunction, Wraps} from \"./types/functions.d.ts\";\r\nimport type {BidderScopedSettings, BidderSettings} from \"./bidderSettings.ts\";\r\n\r\nconst pbjsInstance = getGlobal();\r\nconst { triggerUserSyncs } = userSync;\r\n\r\n/* private variables */\r\nconst { ADD_AD_UNITS, REQUEST_BIDS, SET_TARGETING } = EVENTS;\r\n\r\n// initialize existing debugging sessions if present\r\nloadSession();\r\n\r\ndeclare module './prebidGlobal' {\r\n  interface PrebidJS {\r\n    bidderSettings: {\r\n      standard?: BidderSettings<BidderCode>\r\n    } & {\r\n      [B in BidderCode]?: BidderScopedSettings<B>\r\n    } & {\r\n      [B in keyof BidderParams]?: BidderScopedSettings<B>\r\n    };\r\n    /**\r\n     * True once Prebid is loaded.\r\n     */\r\n    libLoaded?: true;\r\n    /**\r\n     * Prebid version.\r\n     */\r\n    version: string;\r\n    /**\r\n     * Set this to true to delay processing of `que` / `cmd` until prerendering is complete\r\n     * (applies only when the page is prerendering).\r\n     */\r\n    delayPrerendering?: boolean\r\n    adUnits: AdUnitDefinition[];\r\n  }\r\n}\r\n\r\npbjsInstance.bidderSettings = pbjsInstance.bidderSettings || {};\r\npbjsInstance.libLoaded = true;\r\n// version auto generated from build\r\npbjsInstance.version = 'v$prebid.version$';\r\nlogInfo('Prebid.js v$prebid.version$ loaded');\r\n\r\n// create adUnit array\r\npbjsInstance.adUnits = pbjsInstance.adUnits || [];\r\n\r\nfunction validateSizes(sizes, targLength?: number) {\r\n  let cleanSizes = [];\r\n  if (isArray(sizes) && ((targLength) ? sizes.length === targLength : sizes.length > 0)) {\r\n    // check if an array of arrays or array of numbers\r\n    if (sizes.every(sz => isArrayOfNums(sz, 2))) {\r\n      cleanSizes = sizes;\r\n    } else if (isArrayOfNums(sizes, 2)) {\r\n      cleanSizes.push(sizes);\r\n    }\r\n  }\r\n  return cleanSizes;\r\n}\r\n\r\n// synchronize fields between mediaTypes[mediaType] and ortb2Imp[mediaType]\r\nexport function syncOrtb2(adUnit, mediaType) {\r\n  const ortb2Imp = deepAccess(adUnit, `ortb2Imp.${mediaType}`);\r\n  const mediaTypes = deepAccess(adUnit, `mediaTypes.${mediaType}`);\r\n\r\n  if (!ortb2Imp && !mediaTypes) {\r\n    // omitting sync due to not present mediaType\r\n    return;\r\n  }\r\n\r\n  const fields = {\r\n    [VIDEO]: FEATURES.VIDEO && ORTB_VIDEO_PARAMS,\r\n    [BANNER]: ORTB_BANNER_PARAMS\r\n  }[mediaType];\r\n\r\n  if (!fields) {\r\n    return;\r\n  }\r\n\r\n  [...fields].forEach(([key, validator]) => {\r\n    const mediaTypesFieldValue = deepAccess(adUnit, `mediaTypes.${mediaType}.${key}`);\r\n    const ortbFieldValue = deepAccess(adUnit, `ortb2Imp.${mediaType}.${key}`);\r\n\r\n    if (mediaTypesFieldValue == undefined && ortbFieldValue == undefined) {\r\n      // omitting the params if it's not defined on either of sides\r\n    } else if (mediaTypesFieldValue == undefined) {\r\n      deepSetValue(adUnit, `mediaTypes.${mediaType}.${key}`, ortbFieldValue);\r\n    } else if (ortbFieldValue == undefined) {\r\n      deepSetValue(adUnit, `ortb2Imp.${mediaType}.${key}`, mediaTypesFieldValue);\r\n    } else {\r\n      logWarn(`adUnit ${adUnit.code}: specifies conflicting ortb2Imp.${mediaType}.${key} and mediaTypes.${mediaType}.${key}, the latter will be ignored`, adUnit);\r\n      deepSetValue(adUnit, `mediaTypes.${mediaType}.${key}`, ortbFieldValue);\r\n    }\r\n  });\r\n}\r\n\r\nfunction validateBannerMediaType(adUnit: AdUnit) {\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const banner = validatedAdUnit.mediaTypes.banner;\r\n  const bannerSizes = banner.sizes == null ? null : validateSizes(banner.sizes);\r\n  const format = adUnit.ortb2Imp?.banner?.format ?? banner?.format;\r\n  let formatSizes;\r\n  if (format != null) {\r\n    deepSetValue(validatedAdUnit, 'ortb2Imp.banner.format', format);\r\n    banner.format = format;\r\n    try {\r\n      formatSizes = format\r\n        .filter(({w, h, wratio, hratio}) => {\r\n          if ((w ?? h) != null && (wratio ?? hratio) != null) {\r\n            logWarn(`Ad unit banner.format specifies both w/h and wratio/hratio`, adUnit);\r\n            return false;\r\n          }\r\n          return (w != null && h != null) || (wratio != null && hratio != null);\r\n        })\r\n        .map(({w, h, wratio, hratio}) => [w ?? wratio, h ?? hratio]);\r\n    } catch (e) {\r\n      logError(`Invalid format definition on ad unit ${adUnit.code}`, format);\r\n    }\r\n    if (formatSizes != null && bannerSizes != null && !deepEqual(bannerSizes, formatSizes)) {\r\n      logWarn(`Ad unit ${adUnit.code} has conflicting sizes and format definitions`, adUnit);\r\n    }\r\n  }\r\n  const sizes = formatSizes ?? bannerSizes ?? [];\r\n  const expdir = adUnit.ortb2Imp?.banner?.expdir ?? banner.expdir;\r\n  if (expdir != null) {\r\n    banner.expdir = expdir;\r\n    deepSetValue(validatedAdUnit, 'ortb2Imp.banner.expdir', expdir);\r\n  }\r\n  if (sizes.length > 0) {\r\n    banner.sizes = sizes;\r\n    // Deprecation Warning: This property will be deprecated in next release in favor of adUnit.mediaTypes.banner.sizes\r\n    validatedAdUnit.sizes = sizes;\r\n  } else {\r\n    logError('Detected a mediaTypes.banner object without a proper sizes field.  Please ensure the sizes are listed like: [[300, 250], ...].  Removing invalid mediaTypes.banner object from request.');\r\n    delete validatedAdUnit.mediaTypes.banner\r\n  }\r\n  validateOrtbBannerFields(validatedAdUnit);\r\n  syncOrtb2(validatedAdUnit, 'banner')\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateVideoMediaType(adUnit: AdUnit) {\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const video = validatedAdUnit.mediaTypes.video;\r\n  if (video.playerSize) {\r\n    const tarPlayerSizeLen = (typeof video.playerSize[0] === 'number') ? 2 : 1;\r\n\r\n    const videoSizes = validateSizes(video.playerSize, tarPlayerSizeLen);\r\n    if (videoSizes.length > 0) {\r\n      if (tarPlayerSizeLen === 2) {\r\n        logInfo('Transforming video.playerSize from [640,480] to [[640,480]] so it\\'s in the proper format.');\r\n      }\r\n      video.playerSize = videoSizes;\r\n      // Deprecation Warning: This property will be deprecated in next release in favor of adUnit.mediaTypes.video.playerSize\r\n      validatedAdUnit.sizes = videoSizes;\r\n    } else {\r\n      logError('Detected incorrect configuration of mediaTypes.video.playerSize.  Please specify only one set of dimensions in a format like: [[640, 480]]. Removing invalid mediaTypes.video.playerSize property from request.');\r\n      delete validatedAdUnit.mediaTypes.video.playerSize;\r\n    }\r\n  }\r\n  validateOrtbVideoFields(validatedAdUnit);\r\n  syncOrtb2(validatedAdUnit, 'video');\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateNativeMediaType(adUnit: AdUnit) {\r\n  function err(msg) {\r\n    logError(`Error in adUnit \"${adUnit.code}\": ${msg}. Removing native request from ad unit`, adUnit);\r\n    delete validatedAdUnit.mediaTypes.native;\r\n    return validatedAdUnit;\r\n  }\r\n  function checkDeprecated(onDeprecated) {\r\n    for (const key of ['types']) {\r\n      if (native.hasOwnProperty(key)) {\r\n        const res = onDeprecated(key);\r\n        if (res) return res;\r\n      }\r\n    }\r\n  }\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const native = validatedAdUnit.mediaTypes.native;\r\n  // if native assets are specified in OpenRTB format, remove legacy assets and print a warn.\r\n  if (native.ortb) {\r\n    if (native.ortb.assets?.some(asset => !isNumber(asset.id) || asset.id < 0 || asset.id % 1 !== 0)) {\r\n      return err('native asset ID must be a nonnegative integer');\r\n    }\r\n    if (checkDeprecated(key => err(`ORTB native requests cannot specify \"${key}\"`))) {\r\n      return validatedAdUnit;\r\n    }\r\n    const legacyNativeKeys = Object.keys(NATIVE_KEYS).filter(key => NATIVE_KEYS[key].includes('hb_native_'));\r\n    const nativeKeys = Object.keys(native);\r\n    const intersection = nativeKeys.filter(nativeKey => legacyNativeKeys.includes(nativeKey));\r\n    if (intersection.length > 0) {\r\n      logError(`when using native OpenRTB format, you cannot use legacy native properties. Deleting ${intersection} keys from request.`);\r\n      intersection.forEach(legacyKey => delete validatedAdUnit.mediaTypes.native[legacyKey]);\r\n    }\r\n  } else {\r\n    checkDeprecated(key => logWarn(`mediaTypes.native.${key} is deprecated, consider using native ORTB instead`, adUnit));\r\n  }\r\n  if (native.image && native.image.sizes && !Array.isArray(native.image.sizes)) {\r\n    logError('Please use an array of sizes for native.image.sizes field.  Removing invalid mediaTypes.native.image.sizes property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.image.sizes;\r\n  }\r\n  if (native.image && native.image.aspect_ratios && !Array.isArray(native.image.aspect_ratios)) {\r\n    logError('Please use an array of sizes for native.image.aspect_ratios field.  Removing invalid mediaTypes.native.image.aspect_ratios property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.image.aspect_ratios;\r\n  }\r\n  if (native.icon && native.icon.sizes && !Array.isArray(native.icon.sizes)) {\r\n    logError('Please use an array of sizes for native.icon.sizes field.  Removing invalid mediaTypes.native.icon.sizes property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.icon.sizes;\r\n  }\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateAdUnitPos(adUnit, mediaType) {\r\n  const pos = adUnit?.mediaTypes?.[mediaType]?.pos;\r\n\r\n  if (!isNumber(pos) || isNaN(pos) || !isFinite(pos)) {\r\n    const warning = `Value of property 'pos' on ad unit ${adUnit.code} should be of type: Number`;\r\n\r\n    logWarn(warning);\r\n    delete adUnit.mediaTypes[mediaType].pos;\r\n  }\r\n\r\n  return adUnit\r\n}\r\n\r\nfunction validateAdUnit(adUnitDef: AdUnitDefinition): AdUnit {\r\n  const msg = (msg) => `adUnit.code '${adUnit.code}' ${msg}`;\r\n  const adUnit = adUnitDef as AdUnit;\r\n  const mediaTypes = adUnit.mediaTypes;\r\n  const bids = adUnit.bids;\r\n\r\n  if (bids != null && !isArray(bids)) {\r\n    logError(msg(`defines 'adUnit.bids' that is not an array. Removing adUnit from auction`));\r\n    return null;\r\n  }\r\n  if (bids == null && adUnit.ortb2Imp == null) {\r\n    logError(msg(`has no 'adUnit.bids' and no 'adUnit.ortb2Imp'. Removing adUnit from auction`));\r\n    return null;\r\n  }\r\n  if (!mediaTypes || Object.keys(mediaTypes).length === 0) {\r\n    logError(msg(`does not define a 'mediaTypes' object.  This is a required field for the auction, so this adUnit has been removed.`));\r\n    return null;\r\n  }\r\n  if (adUnit.ortb2Imp != null && (bids == null || bids.length === 0)) {\r\n    adUnit.bids = [{bidder: null}]; // the 'null' bidder is treated as an s2s-only placeholder by adapterManager\r\n    logMessage(msg(`defines 'adUnit.ortb2Imp' with no 'adUnit.bids'; it will be seen only by S2S adapters`));\r\n  }\r\n\r\n  return adUnit;\r\n}\r\n\r\nexport const adUnitSetupChecks = {\r\n  validateAdUnit,\r\n  validateBannerMediaType,\r\n  validateSizes\r\n};\r\n\r\nif (FEATURES.NATIVE) {\r\n  Object.assign(adUnitSetupChecks, { validateNativeMediaType });\r\n}\r\n\r\nif (FEATURES.VIDEO) {\r\n  Object.assign(adUnitSetupChecks, { validateVideoMediaType });\r\n}\r\n\r\nexport const checkAdUnitSetup = hook('sync', function (adUnits: AdUnitDefinition[]) {\r\n  const validatedAdUnits = [];\r\n\r\n  adUnits.forEach(adUnitDef => {\r\n    const adUnit = validateAdUnit(adUnitDef);\r\n    if (adUnit == null) return;\r\n\r\n    const mediaTypes = adUnit.mediaTypes;\r\n    let validatedBanner, validatedVideo, validatedNative;\r\n\r\n    if (mediaTypes.banner) {\r\n      validatedBanner = validateBannerMediaType(adUnit);\r\n      if (mediaTypes.banner.hasOwnProperty('pos')) validatedBanner = validateAdUnitPos(validatedBanner, 'banner');\r\n    }\r\n\r\n    if (FEATURES.VIDEO && mediaTypes.video) {\r\n      validatedVideo = validatedBanner ? validateVideoMediaType(validatedBanner) : validateVideoMediaType(adUnit);\r\n      if (mediaTypes.video.hasOwnProperty('pos')) validatedVideo = validateAdUnitPos(validatedVideo, 'video');\r\n    }\r\n\r\n    if (FEATURES.NATIVE && mediaTypes.native) {\r\n      validatedNative = validatedVideo ? validateNativeMediaType(validatedVideo) : validatedBanner ? validateNativeMediaType(validatedBanner) : validateNativeMediaType(adUnit);\r\n    }\r\n\r\n    const validatedAdUnit = Object.assign({}, validatedBanner, validatedVideo, validatedNative);\r\n\r\n    validatedAdUnits.push(validatedAdUnit);\r\n  });\r\n\r\n  return validatedAdUnits;\r\n}, 'checkAdUnitSetup');\r\n\r\nfunction fillAdUnitDefaults(adUnits: AdUnitDefinition[]) {\r\n  if (FEATURES.VIDEO) {\r\n    adUnits.forEach(au => fillVideoDefaults(au))\r\n  }\r\n}\r\n\r\nfunction logInvocation<T extends AnyFunction>(name: string, fn: T): Wraps<T> {\r\n  return function (...args) {\r\n    logInfo(`Invoking $$PREBID_GLOBAL$$.${name}`, args);\r\n    return fn.apply(this, args);\r\n  }\r\n}\r\n\r\nexport function addApiMethod<N extends keyof PrebidJS>(name: N, method: PrebidJS[N], log = true) {\r\n  getGlobal()[name] = log ? logInvocation(name, method) as PrebidJS[N] : method;\r\n}\r\n\r\n/// ///////////////////////////////\r\n//                              //\r\n//    Start Public APIs         //\r\n//                              //\r\n/// ///////////////////////////////\r\n\r\ndeclare module './prebidGlobal' {\r\n  interface PrebidJS {\r\n    /**\r\n     * Re-trigger user syncs. Requires the `userSync.enableOverride` config to be set.\r\n     */\r\n    triggerUserSyncs: typeof triggerUserSyncs;\r\n    getAdserverTargetingForAdUnitCodeStr: typeof getAdserverTargetingForAdUnitCodeStr;\r\n    getHighestUnusedBidResponseForAdUnitCode: typeof getHighestUnusedBidResponseForAdUnitCode;\r\n    getAdserverTargetingForAdUnitCode: typeof getAdserverTargetingForAdUnitCode;\r\n    getAdserverTargeting: typeof getAdserverTargeting;\r\n    getConsentMetadata: typeof getConsentMetadata;\r\n    getNoBids: typeof getNoBids;\r\n    getNoBidsForAdUnitCode: typeof getNoBidsForAdUnitCode;\r\n    getBidResponses: typeof getBidResponses;\r\n    getBidResponsesForAdUnitCode: typeof getBidResponsesForAdUnitCode;\r\n    setTargetingForGPTAsync: typeof setTargetingForGPTAsync;\r\n    setTargetingForAst: typeof setTargetingForAst;\r\n    renderAd: typeof renderAd;\r\n    removeAdUnit: typeof removeAdUnit;\r\n    requestBids: RequestBids;\r\n    addAdUnits: typeof addAdUnits;\r\n    onEvent: typeof onEvent;\r\n    offEvent: typeof offEvent;\r\n    getEvents: typeof getEvents;\r\n    registerBidAdapter: typeof registerBidAdapter;\r\n    registerAnalyticsAdapter: typeof adapterManager.registerAnalyticsAdapter;\r\n    enableAnalytics: typeof adapterManager.enableAnalytics;\r\n    aliasBidder: typeof aliasBidder;\r\n    aliasRegistry: typeof adapterManager.aliasRegistry;\r\n    getAllWinningBids: typeof getAllWinningBids;\r\n    getAllPrebidWinningBids: typeof getAllPrebidWinningBids;\r\n    getHighestCpmBids: typeof getHighestCpmBids;\r\n    clearAllAuctions: typeof clearAllAuctions;\r\n    markWinningBidAsUsed: typeof markWinningBidAsUsed;\r\n    getConfig: typeof config.getConfig;\r\n    readConfig: typeof config.readConfig;\r\n    mergeConfig: typeof config.mergeConfig;\r\n    mergeBidderConfig: typeof config.mergeBidderConfig;\r\n    setConfig: typeof config.setConfig;\r\n    setBidderConfig: typeof config.setBidderConfig;\r\n    processQueue: typeof processQueue;\r\n    triggerBilling: typeof triggerBilling;\r\n  }\r\n}\r\n\r\n// Allow publishers who enable user sync override to trigger their sync\r\naddApiMethod('triggerUserSyncs', triggerUserSyncs);\r\n\r\n/**\r\n * Return a query string with all available targeting parameters for the given ad unit.\r\n *\r\n * @param adUnitCode ad unit code to target\r\n */\r\nfunction getAdserverTargetingForAdUnitCodeStr(adUnitCode: AdUnitCode): string {\r\n  if (adUnitCode) {\r\n    const res = getAdserverTargetingForAdUnitCode(adUnitCode);\r\n    return transformAdServerTargetingObj(res);\r\n  } else {\r\n    logMessage('Need to call getAdserverTargetingForAdUnitCodeStr with adunitCode');\r\n  }\r\n}\r\naddApiMethod('getAdserverTargetingForAdUnitCodeStr', getAdserverTargetingForAdUnitCodeStr);\r\n\r\n/**\r\n * Return the highest cpm, unused bid for the given ad unit.\r\n * @param adUnitCode\r\n */\r\nfunction getHighestUnusedBidResponseForAdUnitCode(adUnitCode: AdUnitCode): Bid {\r\n  if (adUnitCode) {\r\n    const bid = auctionManager.getAllBidsForAdUnitCode(adUnitCode)\r\n      .filter(isBidUsable)\r\n\r\n    return bid.length ? bid.reduce(getHighestCpm) : null\r\n  } else {\r\n    logMessage('Need to call getHighestUnusedBidResponseForAdUnitCode with adunitCode');\r\n  }\r\n}\r\naddApiMethod('getHighestUnusedBidResponseForAdUnitCode', getHighestUnusedBidResponseForAdUnitCode);\r\n\r\n/**\r\n * Returns targeting key-value pairs available at this moment for a given ad unit.\r\n * @param adUnitCode adUnitCode to get the bid responses for\r\n */\r\nfunction getAdserverTargetingForAdUnitCode(adUnitCode) {\r\n  return getAdserverTargeting(adUnitCode)[adUnitCode];\r\n}\r\naddApiMethod('getAdserverTargetingForAdUnitCode', getAdserverTargetingForAdUnitCode);\r\n\r\n/**\r\n * returns all ad server targeting, optionally scoped to the given ad unit(s).\r\n * @return Map of adUnitCodes to targeting key-value pairs\r\n */\r\nfunction getAdserverTargeting(adUnitCode?: AdUnitCode | AdUnitCode[]) {\r\n  return targeting.getAllTargeting(adUnitCode);\r\n}\r\naddApiMethod('getAdserverTargeting', getAdserverTargeting);\r\n\r\nfunction getConsentMetadata() {\r\n  return allConsent.getConsentMeta()\r\n}\r\naddApiMethod('getConsentMetadata', getConsentMetadata);\r\n\r\ntype WrapsInBids<T> = T[] & {\r\n  bids: T[]\r\n}\r\n\r\nfunction wrapInBids(arr) {\r\n  arr = arr.slice();\r\n  arr.bids = arr;\r\n  return arr;\r\n}\r\n\r\nfunction getBids<T>(type): ByAdUnit<WrapsInBids<T>> {\r\n  const responses = auctionManager[type]()\r\n    .filter(bid => auctionManager.getAdUnitCodes().includes(bid.adUnitCode))\r\n\r\n  // find the last auction id to get responses for most recent auction only\r\n  const currentAuctionId = auctionManager.getLastAuctionId();\r\n\r\n  return responses\r\n    .map(bid => bid.adUnitCode)\r\n    .filter(uniques).map(adUnitCode => responses\r\n      .filter(bid => bid.auctionId === currentAuctionId && bid.adUnitCode === adUnitCode))\r\n    .filter(bids => bids && bids[0] && bids[0].adUnitCode)\r\n    .map(bids => {\r\n      return {\r\n        [bids[0].adUnitCode]: wrapInBids(bids)\r\n      };\r\n    })\r\n    .reduce((a, b) => Object.assign(a, b), {});\r\n}\r\n\r\n/**\r\n * @returns the bids requests involved in an auction but not bid on\r\n */\r\nfunction getNoBids() {\r\n  return getBids<BidRequest<BidderCode>>('getNoBids');\r\n}\r\naddApiMethod('getNoBids', getNoBids);\r\n\r\n/**\r\n * @returns the bids requests involved in an auction but not bid on or the specified adUnitCode\r\n */\r\nfunction getNoBidsForAdUnitCode(adUnitCode: AdUnitCode): WrapsInBids<BidRequest<BidderCode>> {\r\n  const bids = auctionManager.getNoBids().filter(bid => bid.adUnitCode === adUnitCode);\r\n  return wrapInBids(bids);\r\n}\r\naddApiMethod('getNoBidsForAdUnitCode', getNoBidsForAdUnitCode);\r\n\r\n/**\r\n * @return a map from ad unit code to all bids received for that ad unit code.\r\n */\r\nfunction getBidResponses() {\r\n  return getBids<Bid>('getBidsReceived');\r\n}\r\naddApiMethod('getBidResponses', getBidResponses);\r\n\r\n/**\r\n * Returns bids received for the specified ad unit.\r\n * @param adUnitCode ad unit code\r\n */\r\nfunction getBidResponsesForAdUnitCode(adUnitCode: AdUnitCode): WrapsInBids<Bid> {\r\n  const bids = auctionManager.getBidsReceived().filter(bid => bid.adUnitCode === adUnitCode);\r\n  return wrapInBids(bids);\r\n}\r\naddApiMethod('getBidResponsesForAdUnitCode', getBidResponsesForAdUnitCode);\r\n\r\n/**\r\n * Set query string targeting on one or more GPT ad units.\r\n * @param adUnit a single `adUnit.code` or multiple.\r\n * @param customSlotMatching gets a GoogleTag slot and returns a filter function for adUnitCode, so you can decide to match on either eg. return slot => { return adUnitCode => { return slot.getSlotElementId() === 'myFavoriteDivId'; } };\r\n */\r\nfunction setTargetingForGPTAsync(adUnit?: AdUnitCode | AdUnitCode[], customSlotMatching?: SlotMatchingFn) {\r\n  if (!isGptPubadsDefined()) {\r\n    logError('window.googletag is not defined on the page');\r\n    return;\r\n  }\r\n  targeting.setTargetingForGPT(adUnit, customSlotMatching);\r\n}\r\naddApiMethod('setTargetingForGPTAsync', setTargetingForGPTAsync);\r\n\r\n/**\r\n * Set query string targeting on all AST (AppNexus Seller Tag) ad units. Note that this function has to be called after all ad units on page are defined. For working example code, see [Using Prebid.js with AppNexus Publisher Ad Server](http://prebid.org/dev-docs/examples/use-prebid-with-appnexus-ad-server.html).\r\n * @param adUnitCodes adUnitCode or array of adUnitCodes\r\n */\r\nfunction setTargetingForAst(adUnitCodes?: AdUnitCode | AdUnitCode[]) {\r\n  if (!targeting.isApntagDefined()) {\r\n    logError('window.apntag is not defined on the page');\r\n    return;\r\n  }\r\n\r\n  targeting.setTargetingForAst(adUnitCodes);\r\n  events.emit(SET_TARGETING, targeting.getAllTargeting());\r\n}\r\n\r\naddApiMethod('setTargetingForAst', setTargetingForAst);\r\n\r\ntype RenderAdOptions = {\r\n  /**\r\n   * Click through URL. Used to replace ${CLICKTHROUGH} macro in ad markup.\r\n   */\r\n  clickThrough?: string;\r\n}\r\n/**\r\n * This function will render the ad (based on params) in the given iframe document passed through.\r\n * Note that doc SHOULD NOT be the parent document page as we can't doc.write() asynchronously\r\n * @param  doc document\r\n * @param  id adId of the bid to render\r\n * @param options\r\n */\r\nasync function renderAd(doc: Document, id: Bid['adId'], options?: RenderAdOptions) {\r\n  await pbYield();\r\n  renderAdDirect(doc, id, options);\r\n}\r\naddApiMethod('renderAd', renderAd);\r\n\r\n/**\r\n * Remove adUnit from the $$PREBID_GLOBAL$$ configuration, if there are no addUnitCode(s) it will remove all\r\n * @param adUnitCode the adUnitCode(s) to remove\r\n * @alias module:pbjs.removeAdUnit\r\n */\r\nfunction removeAdUnit(adUnitCode?: AdUnitCode) {\r\n  if (!adUnitCode) {\r\n    pbjsInstance.adUnits = [];\r\n    return;\r\n  }\r\n\r\n  let adUnitCodes;\r\n\r\n  if (isArray(adUnitCode)) {\r\n    adUnitCodes = adUnitCode;\r\n  } else {\r\n    adUnitCodes = [adUnitCode];\r\n  }\r\n\r\n  adUnitCodes.forEach((adUnitCode) => {\r\n    for (let i = pbjsInstance.adUnits.length - 1; i >= 0; i--) {\r\n      if (pbjsInstance.adUnits[i].code === adUnitCode) {\r\n        pbjsInstance.adUnits.splice(i, 1);\r\n      }\r\n    }\r\n  });\r\n}\r\naddApiMethod('removeAdUnit', removeAdUnit);\r\n\r\nexport type RequestBidsOptions = {\r\n  /**\r\n   * Callback to execute when all the bid responses are back or the timeout hits. Parameters may be undefined\r\n   * in situations where the auction is canceled prematurely (e.g. CMP errors)\r\n   */\r\n  bidsBackHandler?: (bids?: RequestBidsResult['bids'], timedOut?: RequestBidsResult['timedOut'], auctionId?: RequestBidsResult['auctionId']) => void;\r\n  /**\r\n   * TTL buffer override for this auction.\r\n   */\r\n  ttlBuffer?: number;\r\n  /**\r\n   * Timeout for requesting the bids specified in milliseconds\r\n   */\r\n  timeout?: number;\r\n  /**\r\n   * AdUnit definitions to request. Use this or adUnitCodes. Default to all adUnits if empty.\r\n   */\r\n  adUnits?: AdUnitDefinition[];\r\n  /**\r\n   * adUnit codes to request. Use this or adUnits. Default to all adUnits if empty.\r\n   */\r\n  adUnitCodes?: AdUnitCode[];\r\n  /**\r\n   * Defines labels that may be matched on ad unit targeting conditions.\r\n   */\r\n  labels?: string[];\r\n  /**\r\n   * Defines an auction ID to be used rather than having Prebid generate one.\r\n   * This can be useful if there are multiple wrappers on a page and a single auction ID\r\n   * is desired to tie them together in analytics.\r\n   */\r\n  auctionId?: string;\r\n  /**\r\n   * Additional first-party data to use for this auction only\r\n   */\r\n  ortb2?: DeepPartial<ORTBRequest>;\r\n}\r\n\r\ntype RequestBidsResult = {\r\n  /**\r\n   * Bids received, grouped by ad unit.\r\n   */\r\n  bids?: ByAdUnit<WrapsInBids<Bid>>;\r\n  /**\r\n   * True if any bidder timed out.\r\n   */\r\n  timedOut?: boolean;\r\n  /**\r\n   * The auction's ID\r\n   */\r\n  auctionId?: Identifier;\r\n}\r\n\r\nexport type PrivRequestBidsOptions = RequestBidsOptions & {\r\n  defer: Defer<RequestBidsResult>;\r\n  metrics: Metrics;\r\n  /**\r\n   * Ad units are always defined and fixed here (as opposed to the public API where we may fall back to\r\n   * the global array).\r\n   */\r\n  adUnits: AdUnitDefinition[];\r\n}\r\n\r\nexport type StartAuctionOptions = Omit<PrivRequestBidsOptions, 'ortb2'> & {\r\n  ortb2Fragments: ORTBFragments\r\n}\r\n\r\ndeclare module './hook' {\r\n  interface NamedHooks {\r\n    requestBids: typeof requestBids;\r\n    startAuction: typeof startAuction;\r\n  }\r\n}\r\n\r\ninterface RequestBids {\r\n  (options?: RequestBidsOptions): Promise<RequestBidsResult>;\r\n}\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    /**\r\n     * Fired when `requestBids` is called.\r\n     */\r\n    [REQUEST_BIDS]: [];\r\n  }\r\n}\r\n\r\nexport const requestBids = (function() {\r\n  const delegate = hook('async', function (reqBidOptions: PrivRequestBidsOptions): void {\r\n    let { bidsBackHandler, timeout, adUnits, adUnitCodes, labels, auctionId, ttlBuffer, ortb2, metrics, defer } = reqBidOptions ?? {};\r\n    events.emit(REQUEST_BIDS);\r\n    const cbTimeout = timeout || config.getConfig('bidderTimeout');\r\n    if (adUnitCodes != null && !Array.isArray(adUnitCodes)) {\r\n      adUnitCodes = [adUnitCodes];\r\n    }\r\n    if (adUnitCodes && adUnitCodes.length) {\r\n      // if specific adUnitCodes supplied filter adUnits for those codes\r\n      adUnits = adUnits.filter(unit => adUnitCodes.includes(unit.code));\r\n    } else {\r\n      // otherwise derive adUnitCodes from adUnits\r\n      adUnitCodes = adUnits && adUnits.map(unit => unit.code);\r\n    }\r\n    adUnitCodes = adUnitCodes.filter(uniques);\r\n    let ortb2Fragments = {\r\n      global: mergeDeep({}, config.getAnyConfig('ortb2') || {}, ortb2 || {}),\r\n      bidder: Object.fromEntries(Object.entries<any>(config.getBidderConfig()).map(([bidder, cfg]) => [bidder, deepClone(cfg.ortb2)]).filter(([_, ortb2]) => ortb2 != null))\r\n    }\r\n    ortb2Fragments = normalizeFPD(ortb2Fragments);\r\n\r\n    enrichFPD(PbPromise.resolve(ortb2Fragments.global)).then(global => {\r\n      ortb2Fragments.global = global;\r\n      return startAuction({bidsBackHandler, timeout: cbTimeout, adUnits, adUnitCodes, labels, auctionId, ttlBuffer, ortb2Fragments, metrics, defer});\r\n    })\r\n  }, 'requestBids');\r\n\r\n  return wrapHook(delegate, delayIfPrerendering(() => !config.getConfig('allowPrerendering'), function requestBids(options: RequestBidsOptions = {}) {\r\n    // unlike the main body of `delegate`, this runs before any other hook has a chance to;\r\n    // it's also not restricted in its return value in the way `async` hooks are.\r\n\r\n    // if the request does not specify adUnits, clone the global adUnit array;\r\n    // otherwise, if the caller goes on to use addAdUnits/removeAdUnits, any asynchronous logic\r\n    // in any hook might see their effects.\r\n    const req = options as PrivRequestBidsOptions;\r\n    const adUnits = req.adUnits || pbjsInstance.adUnits;\r\n    req.adUnits = (Array.isArray(adUnits) ? adUnits.slice() : [adUnits]);\r\n\r\n    req.metrics = newMetrics();\r\n    req.metrics.checkpoint('requestBids');\r\n    req.defer = defer({ promiseFactory: (r) => new Promise(r)})\r\n    delegate.call(this, req);\r\n    return req.defer.promise;\r\n  }));\r\n})();\r\n\r\naddApiMethod('requestBids', requestBids as unknown as RequestBids);\r\n\r\nexport const startAuction = hook('async', function ({ bidsBackHandler, timeout: cbTimeout, adUnits: adUnitDefs, ttlBuffer, adUnitCodes, labels, auctionId, ortb2Fragments, metrics, defer }: StartAuctionOptions = {} as any) {\r\n  const s2sBidders = getS2SBidderSet(config.getConfig('s2sConfig') || []);\r\n  fillAdUnitDefaults(adUnitDefs);\r\n  const adUnits: AdUnit[] = useMetrics(metrics).measureTime('requestBids.validate', () => checkAdUnitSetup(adUnitDefs));\r\n\r\n  function auctionDone(bids?, timedOut?: boolean, auctionId?: string) {\r\n    if (typeof bidsBackHandler === 'function') {\r\n      try {\r\n        bidsBackHandler(bids, timedOut, auctionId);\r\n      } catch (e) {\r\n        logError('Error executing bidsBackHandler', null, e);\r\n      }\r\n    }\r\n    defer.resolve({ bids, timedOut, auctionId })\r\n  }\r\n\r\n  const tids = {};\r\n  /*\r\n   * for a given adunit which supports a set of mediaTypes\r\n   * and a given bidder which supports a set of mediaTypes\r\n   * a bidder is eligible to participate on the adunit\r\n   * if it supports at least one of the mediaTypes on the adunit\r\n   */\r\n  adUnits.forEach(adUnit => {\r\n    // get the adunit's mediaTypes, defaulting to banner if mediaTypes isn't present\r\n    const adUnitMediaTypes = Object.keys(adUnit.mediaTypes || { 'banner': 'banner' });\r\n\r\n    // get the bidder's mediaTypes\r\n    const allBidders = adUnit.bids.map(bid => bid.bidder);\r\n    const bidderRegistry = adapterManager.bidderRegistry;\r\n\r\n    const bidders = allBidders.filter(bidder => !s2sBidders.has(bidder));\r\n    adUnit.adUnitId = generateUUID();\r\n    const tid = adUnit.ortb2Imp?.ext?.tid;\r\n    if (tid) {\r\n      if (tids.hasOwnProperty(adUnit.code)) {\r\n        logWarn(`Multiple distinct ortb2Imp.ext.tid were provided for twin ad units '${adUnit.code}'`)\r\n      } else {\r\n        tids[adUnit.code] = tid;\r\n      }\r\n    }\r\n    if (ttlBuffer != null && !adUnit.hasOwnProperty('ttlBuffer')) {\r\n      adUnit.ttlBuffer = ttlBuffer;\r\n    }\r\n    bidders.forEach(bidder => {\r\n      const adapter = bidderRegistry[bidder];\r\n      const spec = adapter && adapter.getSpec && adapter.getSpec();\r\n      // banner is default if not specified in spec\r\n      const bidderMediaTypes = (spec && spec.supportedMediaTypes) || ['banner'];\r\n\r\n      // check if the bidder's mediaTypes are not in the adUnit's mediaTypes\r\n      const bidderEligible = adUnitMediaTypes.some(type => bidderMediaTypes.includes(type));\r\n      if (!bidderEligible) {\r\n        // drop the bidder from the ad unit if it's not compatible\r\n        logWarn(unsupportedBidderMessage(adUnit, bidder));\r\n        adUnit.bids = adUnit.bids.filter(bid => bid.bidder !== bidder);\r\n      }\r\n    });\r\n  });\r\n  if (!adUnits || adUnits.length === 0) {\r\n    logMessage('No adUnits configured. No bids requested.');\r\n    auctionDone();\r\n  } else {\r\n    adUnits.forEach(au => {\r\n      const tid = au.ortb2Imp?.ext?.tid || tids[au.code] || generateUUID();\r\n      if (!tids.hasOwnProperty(au.code)) {\r\n        tids[au.code] = tid;\r\n      }\r\n      au.transactionId = tid;\r\n      deepSetValue(au, 'ortb2Imp.ext.tid', tid);\r\n    });\r\n    const auction = auctionManager.createAuction({\r\n      adUnits,\r\n      adUnitCodes,\r\n      callback: auctionDone,\r\n      cbTimeout,\r\n      labels,\r\n      auctionId,\r\n      ortb2Fragments,\r\n      metrics,\r\n    });\r\n\r\n    const adUnitsLen = adUnits.length;\r\n    if (adUnitsLen > 15) {\r\n      logInfo(`Current auction ${auction.getAuctionId()} contains ${adUnitsLen} adUnits.`, adUnits);\r\n    }\r\n\r\n    adUnitCodes.forEach(code => targeting.setLatestAuctionForAdUnit(code, auction.getAuctionId()));\r\n    auction.callBids();\r\n  }\r\n}, 'startAuction');\r\n\r\nexport function executeCallbacks(fn, reqBidsConfigObj) {\r\n  runAll(storageCallbacks);\r\n  runAll(enableAnalyticsCallbacks);\r\n  fn.call(this, reqBidsConfigObj);\r\n\r\n  function runAll(queue) {\r\n    let queued;\r\n    while ((queued = queue.shift())) {\r\n      queued();\r\n    }\r\n  }\r\n}\r\n\r\n// This hook will execute all storage callbacks which were registered before gdpr enforcement hook was added. Some bidders, user id modules use storage functions when module is parsed but gdpr enforcement hook is not added at that stage as setConfig callbacks are yet to be called. Hence for such calls we execute all the stored callbacks just before requestBids. At this hook point we will know for sure that tcfControl module is added or not\r\nrequestBids.before(executeCallbacks, 49);\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    /**\r\n     * Fired when `.addAdUniuts` is called.\r\n     */\r\n    [ADD_AD_UNITS]: [];\r\n  }\r\n}\r\n/**\r\n * Add ad unit(s)\r\n * @param adUnits\r\n */\r\nfunction addAdUnits(adUnits: AdUnitDefinition | AdUnitDefinition[]) {\r\n  pbjsInstance.adUnits.push(...(Array.isArray(adUnits) ? adUnits : [adUnits]))\r\n  events.emit(ADD_AD_UNITS);\r\n}\r\n\r\naddApiMethod('addAdUnits', addAdUnits);\r\n\r\nconst eventIdValidators = {\r\n  bidWon(id) {\r\n    const adUnitCodes = auctionManager.getBidsRequested().map(bidSet => bidSet.bids.map(bid => bid.adUnitCode))\r\n      .reduce(flatten)\r\n      .filter(uniques);\r\n\r\n    if (!adUnitCodes.includes(id)) {\r\n      logError('The \"' + id + '\" placement is not defined.');\r\n      return;\r\n    }\r\n\r\n    return true;\r\n  }\r\n};\r\n\r\nfunction validateEventId(event, id) {\r\n  return eventIdValidators.hasOwnProperty(event) && eventIdValidators[event](id);\r\n}\r\n\r\n/**\r\n * @param event the name of the event\r\n * @param handler a callback to set on event\r\n * @param id an identifier in the context of the event\r\n *\r\n * This API call allows you to register a callback to handle a Prebid.js event.\r\n * An optional `id` parameter provides more finely-grained event callback registration.\r\n * This makes it possible to register callback events for a specific item in the\r\n * event context. For example, `bidWon` events will accept an `id` for ad unit code.\r\n * `bidWon` callbacks registered with an ad unit code id will be called when a bid\r\n * for that ad unit code wins the auction. Without an `id` this method registers the\r\n * callback for every `bidWon` event.\r\n *\r\n * Currently `bidWon` is the only event that accepts an `id` parameter.\r\n */\r\nfunction onEvent<E extends Event>(event: E, handler: EventHandler<E>, id?: EventIDs[E]) {\r\n  if (!isFn(handler)) {\r\n    logError('The event handler provided is not a function and was not set on event \"' + event + '\".');\r\n    return;\r\n  }\r\n\r\n  if (id && !validateEventId(event, id)) {\r\n    logError('The id provided is not valid for event \"' + event + '\" and no handler was set.');\r\n    return;\r\n  }\r\n\r\n  events.on(event, handler, id);\r\n}\r\naddApiMethod('onEvent', onEvent);\r\n\r\n/**\r\n * @param event the name of the event\r\n * @param handler a callback to remove from the event\r\n * @param id an identifier in the context of the event (see `$$PREBID_GLOBAL$$.onEvent`)\r\n */\r\nfunction offEvent<E extends Event>(event: E, handler: EventHandler<E>, id?: EventIDs[E]) {\r\n  if (id && !validateEventId(event, id)) {\r\n    return;\r\n  }\r\n  events.off(event, handler, id);\r\n}\r\naddApiMethod('offEvent', offEvent);\r\n\r\n/**\r\n * Return a copy of all events emitted\r\n */\r\nfunction getEvents() {\r\n  return events.getEvents();\r\n}\r\naddApiMethod('getEvents', getEvents);\r\n\r\nfunction registerBidAdapter(adapter: BidAdapter, bidderCode: BidderCode): void;\r\nfunction registerBidAdapter<B extends BidderCode>(adapter: void, bidderCode: B, spec: BidderSpec<B>): void;\r\nfunction registerBidAdapter(bidderAdaptor, bidderCode, spec?) {\r\n  try {\r\n    const bidder = spec ? newBidder(spec) : bidderAdaptor();\r\n    adapterManager.registerBidAdapter(bidder, bidderCode);\r\n  } catch (e) {\r\n    logError('Error registering bidder adapter : ' + e.message);\r\n  }\r\n}\r\naddApiMethod('registerBidAdapter', registerBidAdapter);\r\n\r\nfunction registerAnalyticsAdapter(options) {\r\n  try {\r\n    adapterManager.registerAnalyticsAdapter(options);\r\n  } catch (e) {\r\n    logError('Error registering analytics adapter : ' + e.message);\r\n  }\r\n}\r\naddApiMethod('registerAnalyticsAdapter', registerAnalyticsAdapter);\r\n\r\nconst enableAnalyticsCallbacks = [];\r\n\r\nconst enableAnalyticsCb = hook('async', function (config) {\r\n  if (config && !isEmpty(config)) {\r\n    adapterManager.enableAnalytics(config);\r\n  } else {\r\n    logError('$$PREBID_GLOBAL$$.enableAnalytics should be called with option {}');\r\n  }\r\n}, 'enableAnalyticsCb');\r\n\r\nfunction enableAnalytics(config) {\r\n  enableAnalyticsCallbacks.push(enableAnalyticsCb.bind(this, config));\r\n}\r\naddApiMethod('enableAnalytics', enableAnalytics);\r\n\r\n/**\r\n * Define an alias for a bid adapter.\r\n */\r\nfunction aliasBidder(bidderCode: BidderCode, alias: BidderCode, options?: AliasBidderOptions) {\r\n  if (bidderCode && alias) {\r\n    adapterManager.aliasBidAdapter(bidderCode, alias, options);\r\n  } else {\r\n    logError('bidderCode and alias must be passed as arguments', '$$PREBID_GLOBAL$$.aliasBidder');\r\n  }\r\n}\r\naddApiMethod('aliasBidder', aliasBidder);\r\n\r\npbjsInstance.aliasRegistry = adapterManager.aliasRegistry;\r\nconfig.getConfig('aliasRegistry', config => {\r\n  if (config.aliasRegistry === 'private') delete pbjsInstance.aliasRegistry;\r\n});\r\n\r\n/**\r\n * @return All bids that have been rendered. Useful for [troubleshooting your integration](http://prebid.org/dev-docs/prebid-troubleshooting-guide.html).\r\n */\r\nfunction getAllWinningBids(): Bid[] {\r\n  return auctionManager.getAllWinningBids();\r\n}\r\n\r\naddApiMethod('getAllWinningBids', getAllWinningBids)\r\n\r\n/**\r\n * @return Bids that have won their respective auctions but have not been rendered yet.\r\n */\r\nfunction getAllPrebidWinningBids(): Bid[] {\r\n  logWarn('getAllPrebidWinningBids may be removed or renamed in a future version. This function returns bids that have won in prebid and have had targeting set but have not (yet?) won in the ad server. It excludes bids that have been rendered.');\r\n  return auctionManager.getBidsReceived()\r\n    .filter(bid => bid.status === BID_STATUS.BID_TARGETING_SET);\r\n}\r\n\r\naddApiMethod('getAllPrebidWinningBids', getAllPrebidWinningBids);\r\n\r\n/**\r\n * Get highest cpm bids for all adUnits, or highest cpm bid object for the given adUnit\r\n * @param adUnitCode - ad unit code\r\n */\r\nfunction getHighestCpmBids(adUnitCode?: string): Bid[] {\r\n  return targeting.getWinningBids(adUnitCode);\r\n}\r\n\r\naddApiMethod('getHighestCpmBids', getHighestCpmBids);\r\n\r\n/**\r\n * Clear all auctions (and their bids) from the bid cache.\r\n */\r\nfunction clearAllAuctions() {\r\n  auctionManager.clearAllAuctions();\r\n}\r\naddApiMethod('clearAllAuctions', clearAllAuctions);\r\n\r\ntype MarkWinningBidAsUsedOptions = ({\r\n  /**\r\n   * The id representing the ad we want to mark\r\n   */\r\n  adId: string;\r\n  adUnitCode?: undefined | null\r\n} | {\r\n  /**\r\n   * The ad unit code\r\n   */\r\n  adUnitCode: AdUnitCode;\r\n  adId?: undefined | null;\r\n\r\n}) & {\r\n  /**\r\n   * If true, fires tracking pixels and BID_WON handlers\r\n   */\r\n  events?: boolean;\r\n  /**\r\n   * @deprecated - alias of `events`\r\n   */\r\n  analytics?: boolean\r\n}\r\n\r\n/**\r\n * Mark the winning bid as used, should only be used in conjunction with video\r\n */\r\nfunction markWinningBidAsUsed({adId, adUnitCode, analytics = false, events = false}: MarkWinningBidAsUsedOptions) {\r\n  let bids;\r\n  if (adUnitCode && adId == null) {\r\n    bids = targeting.getWinningBids(adUnitCode);\r\n  } else if (adId) {\r\n    bids = auctionManager.getBidsReceived().filter(bid => bid.adId === adId)\r\n  } else {\r\n    logWarn('Improper use of markWinningBidAsUsed. It needs an adUnitCode or an adId to function.');\r\n  }\r\n  if (bids.length > 0) {\r\n    if (analytics || events) {\r\n      markWinningBid(bids[0]);\r\n    } else {\r\n      auctionManager.addWinningBid(bids[0]);\r\n    }\r\n    markBidAsRendered(bids[0])\r\n  }\r\n}\r\n\r\nif (FEATURES.VIDEO) {\r\n  addApiMethod('markWinningBidAsUsed', markWinningBidAsUsed);\r\n}\r\n\r\naddApiMethod('getConfig', config.getAnyConfig);\r\naddApiMethod('readConfig', config.readAnyConfig);\r\naddApiMethod('mergeConfig', config.mergeConfig);\r\naddApiMethod('mergeBidderConfig', config.mergeBidderConfig);\r\naddApiMethod('setConfig', config.setConfig);\r\naddApiMethod('setBidderConfig', config.setBidderConfig);\r\n\r\npbjsInstance.que.push(() => listenMessagesFromCreative());\r\n\r\n/**\r\n * This queue lets users load Prebid asynchronously, but run functions the same way regardless of whether it gets loaded\r\n * before or after their script executes. For example, given the code:\r\n *\r\n * <script src=\"url/to/Prebid.js\" async></script>\r\n * <script>\r\n *   var pbjs = pbjs || {};\r\n *   pbjs.cmd = pbjs.cmd || [];\r\n *   pbjs.cmd.push(functionToExecuteOncePrebidLoads);\r\n * </script>\r\n *\r\n * If the page's script runs before prebid loads, then their function gets added to the queue, and executed\r\n * by prebid once it's done loading. If it runs after prebid loads, then this monkey-patch causes their\r\n * function to execute immediately.\r\n *\r\n * @param  {function} command A function which takes no arguments. This is guaranteed to run exactly once, and only after\r\n *                            the Prebid script has been fully loaded.\r\n * @alias module:pbjs.cmd.push\r\n * @alias module:pbjs.que.push\r\n */\r\nfunction quePush(command) {\r\n  if (typeof command === 'function') {\r\n    try {\r\n      command.call();\r\n    } catch (e) {\r\n      logError('Error processing command :', e.message, e.stack);\r\n    }\r\n  } else {\r\n    logError('Commands written into $$PREBID_GLOBAL$$.cmd.push must be wrapped in a function');\r\n  }\r\n}\r\n\r\nasync function _processQueue(queue) {\r\n  for (const cmd of queue) {\r\n    if (typeof cmd.called === 'undefined') {\r\n      try {\r\n        cmd.call();\r\n        cmd.called = true;\r\n      } catch (e) {\r\n        logError('Error processing command :', 'prebid.js', e);\r\n      }\r\n    }\r\n    await pbYield();\r\n  }\r\n}\r\n\r\n/**\r\n * Process the command queue, effectively booting up Prebid.\r\n * Bundles generated by the build automatically include a call to this; NPM consumers\r\n * should call this after loading all modules and before using other APIs.\r\n */\r\nconst processQueue = delayIfPrerendering(() => pbjsInstance.delayPrerendering, async function () {\r\n  pbjsInstance.que.push = pbjsInstance.cmd.push = quePush;\r\n  insertLocatorFrame();\r\n  hook.ready();\r\n  await _processQueue(pbjsInstance.que);\r\n  await _processQueue(pbjsInstance.cmd);\r\n})\r\naddApiMethod('processQueue', processQueue, false);\r\n\r\n/**\r\n * Manually trigger billing for a winning bid, idendified either by ad ID or ad unit code.\r\n * Used in conjunction with `adUnit.deferBilling`.\r\n */\r\nfunction triggerBilling({adId, adUnitCode}: {\r\n  adId?: string;\r\n  adUnitCode?: AdUnitCode\r\n}) {\r\n  auctionManager.getAllWinningBids()\r\n    .filter((bid) => bid.adId === adId || (adId == null && bid.adUnitCode === adUnitCode))\r\n    .forEach((bid) => {\r\n      adapterManager.triggerBilling(bid);\r\n      renderIfDeferred(bid);\r\n    });\r\n}\r\naddApiMethod('triggerBilling', triggerBilling);\r\n\r\nexport default pbjsInstance;\r\n","interface Command {\r\n  (): any;\r\n}\r\n\r\ninterface CommandQueue extends Omit<Command[], 'push'> {\r\n  push(cmd: Command): void;\r\n}\r\n\r\nexport interface PrebidJS {\r\n  /**\r\n   * Command queue. Use cmd.push(function F() { ... }) to queue F until Prebid has loaded.\r\n   */\r\n  cmd: CommandQueue,\r\n  /**\r\n   * Alias of `cmd`\r\n   */\r\n  que: CommandQueue\r\n  /**\r\n   * Names of all installed modules.\r\n   */\r\n  installedModules: string[]\r\n  /**\r\n   * Optional scheduler used by pbYield().\r\n   */\r\n  scheduler?: { yield: () => Promise<void> }\r\n}\r\n\r\n// if $$PREBID_GLOBAL$$ already exists in global document scope, use it, if not, create the object\r\ndeclare const $$DEFINE_PREBID_GLOBAL$$: boolean;\r\nconst scope: any = !$$DEFINE_PREBID_GLOBAL$$ ? {} : window;\r\nconst global: PrebidJS = scope.$$PREBID_GLOBAL$$ = scope.$$PREBID_GLOBAL$$ || {};\r\nglobal.cmd = global.cmd || [];\r\nglobal.que = global.que || [];\r\nglobal.installedModules = global.installedModules || []\r\n\r\n// create a pbjs global pointer\r\nif (scope === window) {\r\n  scope._pbjsGlobals = scope._pbjsGlobals || [];\r\n  scope._pbjsGlobals.push('$$PREBID_GLOBAL$$');\r\n}\r\n\r\nexport function getGlobal() {\r\n  return global;\r\n}\r\n\r\nexport function registerModule(name: string) {\r\n  global.installedModules.push(name);\r\n}\r\n","/**\r\n * The referer detection module attempts to gather referer information from the current page that prebid.js resides in.\r\n * The information that it tries to collect includes:\r\n * The detected top url in the nav bar,\r\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\r\n * The number of iframes it was embedded in if applicable (by default max ten iframes),\r\n * A list of the domains of each embedded window if applicable.\r\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\r\n */\r\n\r\nimport { config } from './config.js';\r\nimport {logWarn} from './utils.js';\r\n\r\n/**\r\n * Prepend a URL with the page's protocol (http/https), if necessary.\r\n */\r\nexport function ensureProtocol(url, win = window) {\r\n  if (!url) return url;\r\n  if (/\\w+:\\/\\//.exec(url)) {\r\n    // url already has protocol\r\n    return url;\r\n  }\r\n  let windowProto = win.location.protocol;\r\n  try {\r\n    windowProto = win.top.location.protocol;\r\n  } catch (e) {}\r\n  if (/^\\/\\//.exec(url)) {\r\n    // url uses relative protocol (\"//example.com\")\r\n    return windowProto + url;\r\n  } else {\r\n    return `${windowProto}//${url}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Extract the domain portion from a URL.\r\n * @param url - The URL to extract the domain from.\r\n * @param options - Options for parsing the domain.\r\n * @param options.noLeadingWww - If true, remove 'www.' appearing at the beginning of the domain.\r\n * @param options.noPort - If true, do not include the ':[port]' portion.\r\n * @return The extracted domain or undefined if the URL is invalid.\r\n */\r\nexport function parseDomain(url: string, {noLeadingWww = false, noPort = false} = {}): string | null {\r\n  let target;\r\n  try {\r\n    target = new URL(ensureProtocol(url));\r\n  } catch (e) {\r\n    return;\r\n  }\r\n  target = noPort ? target.hostname : target.host;\r\n  if (noLeadingWww && target.startsWith('www.')) {\r\n    target = target.substring(4);\r\n  }\r\n  return target;\r\n}\r\n\r\n/**\r\n * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\r\n *\r\n * @param {Object} doc document\r\n * @returns {string|null}\r\n */\r\nfunction getCanonicalUrl(doc) {\r\n  try {\r\n    const element = doc.querySelector(\"link[rel='canonical']\");\r\n\r\n    if (element !== null) {\r\n      return element.href;\r\n    }\r\n  } catch (e) {\r\n    // Ignore error\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    /**\r\n     * Prebid.js will loop upward through nested iframes to find the top-most referrer. T\r\n     * his setting limits how many iterations it will attempt before giving up and not setting referrer.\r\n     */\r\n    maxNestedIframes?: number;\r\n    /**\r\n     * Override the Prebid.js page referrer.\r\n     */\r\n    pageUrl?: string;\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Window} win Window\r\n * @returns {Function}\r\n */\r\nexport function detectReferer(win) {\r\n  /**\r\n   * This function would return a read-only array of hostnames for all the parent frames.\r\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\r\n   *\r\n   * @param {Window} win Window object\r\n   * @returns {(undefined|Array)} Ancestor origins or undefined\r\n   */\r\n  function getAncestorOrigins(win) {\r\n    try {\r\n      if (!win.location.ancestorOrigins) {\r\n        return;\r\n      }\r\n\r\n      return win.location.ancestorOrigins;\r\n    } catch (e) {\r\n      // Ignore error\r\n    }\r\n  }\r\n\r\n  // TODO: the meaning of \"reachedTop\" seems to be intentionally ambiguous - best to leave them out of\r\n  // the typedef for now. (for example, unit tests enforce that \"reachedTop\" should be false in some situations where we\r\n  // happily provide a location for the top).\r\n\r\n  /**\r\n   * Walk up the windows to get the origin stack and best available referrer, canonical URL, etc.\r\n   *\r\n   * @returns An object containing referer information.\r\n   */\r\n  function refererInfo() {\r\n    const stack: string[] = [];\r\n    const ancestors = getAncestorOrigins(win);\r\n    const maxNestedIframes = config.getConfig('maxNestedIframes');\r\n\r\n    let currentWindow;\r\n    let bestLocation: string;\r\n    let bestCanonicalUrl;\r\n    let reachedTop = false;\r\n    let level = 0;\r\n    let valuesFromAmp = false;\r\n    let inAmpFrame = false;\r\n    let hasTopLocation = false;\r\n\r\n    do {\r\n      const previousWindow = currentWindow;\r\n      const wasInAmpFrame = inAmpFrame;\r\n      let currentLocation;\r\n      let crossOrigin = false;\r\n      let foundLocation = null;\r\n\r\n      inAmpFrame = false;\r\n      currentWindow = currentWindow ? currentWindow.parent : win;\r\n\r\n      try {\r\n        currentLocation = currentWindow.location.href || null;\r\n      } catch (e) {\r\n        crossOrigin = true;\r\n      }\r\n\r\n      if (crossOrigin) {\r\n        if (wasInAmpFrame) {\r\n          const context = previousWindow.context;\r\n\r\n          try {\r\n            foundLocation = context.sourceUrl;\r\n            bestLocation = foundLocation;\r\n            hasTopLocation = true;\r\n\r\n            valuesFromAmp = true;\r\n\r\n            if (currentWindow === win.top) {\r\n              reachedTop = true;\r\n            }\r\n\r\n            if (context.canonicalUrl) {\r\n              bestCanonicalUrl = context.canonicalUrl;\r\n            }\r\n          } catch (e) { /* Do nothing */ }\r\n        } else {\r\n          logWarn('Trying to access cross domain iframe. Continuing without referrer and location');\r\n\r\n          try {\r\n            // the referrer to an iframe is the parent window\r\n            const referrer = previousWindow.document.referrer;\r\n\r\n            if (referrer) {\r\n              foundLocation = referrer;\r\n\r\n              if (currentWindow === win.top) {\r\n                reachedTop = true;\r\n              }\r\n            }\r\n          } catch (e) { /* Do nothing */ }\r\n\r\n          if (!foundLocation && ancestors && ancestors[level - 1]) {\r\n            foundLocation = ancestors[level - 1];\r\n            if (currentWindow === win.top) {\r\n              hasTopLocation = true;\r\n            }\r\n          }\r\n\r\n          if (foundLocation && !valuesFromAmp) {\r\n            bestLocation = foundLocation;\r\n          }\r\n        }\r\n      } else {\r\n        if (currentLocation) {\r\n          foundLocation = currentLocation;\r\n          bestLocation = foundLocation;\r\n          valuesFromAmp = false;\r\n\r\n          if (currentWindow === win.top) {\r\n            reachedTop = true;\r\n\r\n            const canonicalUrl = getCanonicalUrl(currentWindow.document);\r\n\r\n            if (canonicalUrl) {\r\n              bestCanonicalUrl = canonicalUrl;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (currentWindow.context && currentWindow.context.sourceUrl) {\r\n          inAmpFrame = true;\r\n        }\r\n      }\r\n\r\n      stack.push(foundLocation);\r\n      level++;\r\n    } while (currentWindow !== win.top && level < maxNestedIframes);\r\n\r\n    stack.reverse();\r\n\r\n    let ref: string;\r\n    try {\r\n      ref = win.top.document.referrer;\r\n    } catch (e) {}\r\n\r\n    const location: string = reachedTop || hasTopLocation ? bestLocation : null;\r\n    const canonicalUrl: string | null = config.getConfig('pageUrl') || bestCanonicalUrl || null;\r\n    let page: string = config.getConfig('pageUrl') || location || ensureProtocol(canonicalUrl, win);\r\n\r\n    if (location && location.indexOf('?') > -1 && page.indexOf('?') === -1) {\r\n      page = `${page}${location.substring(location.indexOf('?'))}`;\r\n    }\r\n\r\n    return {\r\n      /**\r\n       * True if the top window is accessible.\r\n       */\r\n      reachedTop,\r\n      isAmp: valuesFromAmp,\r\n      /**\r\n       * number of steps between window.self and window.top\r\n       */\r\n      numIframes: level - 1,\r\n      /**\r\n       * our best guess at the location for each frame, in the direction top -> self.\r\n       */\r\n      stack,\r\n      /**\r\n       * of the top-most frame for which we could guess the location. Outside of cross-origin scenarios, this is equivalent to `location`.\r\n       */\r\n      topmostLocation: bestLocation || null,\r\n      /**\r\n       * the browser's location, or null if not available (due to cross-origin restrictions)\r\n       */\r\n      location,\r\n      /**\r\n       * the site's canonical URL as set by the publisher, through setConfig({pageUrl}) or <link rel=\"canonical\" />\r\n       */\r\n      canonicalUrl,\r\n      /**\r\n       * the best candidate for the current page URL: `canonicalUrl`, falling back to `location`\r\n       */\r\n      page,\r\n      /**\r\n       * the domain portion of `page`\r\n       */\r\n      domain: parseDomain(page) || null,\r\n      /**\r\n       * the referrer (document.referrer) to the current page, or null if not available (due to cross-origin restrictions)\r\n       */\r\n      ref: ref || null,\r\n      // TODO: the \"legacy\" refererInfo object is provided here, for now, to accommodate\r\n      // adapters that decided to just send it verbatim to their backend.\r\n      legacy: {\r\n        reachedTop,\r\n        isAmp: valuesFromAmp,\r\n        numIframes: level - 1,\r\n        stack,\r\n        referer: bestLocation || null,\r\n        canonicalUrl\r\n      }\r\n    };\r\n  }\r\n\r\n  return refererInfo;\r\n}\r\n\r\n// cache result of fn (= referer info) as long as:\r\n// - we are the top window\r\n// - canonical URL tag and window location have not changed\r\nexport function cacheWithLocation(fn, win = window) {\r\n  if (win.top !== win) return fn;\r\n  let canonical, href, value;\r\n  return function () {\r\n    const newCanonical = getCanonicalUrl(win.document);\r\n    const newHref = win.location.href;\r\n    if (canonical !== newCanonical || newHref !== href) {\r\n      canonical = newCanonical;\r\n      href = newHref;\r\n      value = fn();\r\n    }\r\n    return value;\r\n  }\r\n}\r\n\r\nexport type RefererInfo = ReturnType<ReturnType<typeof detectReferer>>;\r\nexport const getRefererInfo: () => RefererInfo = cacheWithLocation(detectReferer(window));\r\n","/* Secure Creatives\r\n  Provides support for rendering creatives into cross domain iframes such as SafeFrame to prevent\r\n   access to a publisher page from creative payloads.\r\n */\r\n\r\nimport {getAllAssetsMessage, getAssetMessage} from './native.js';\r\nimport {BID_STATUS, MESSAGES} from './constants.js';\r\nimport {isApnGetTagDefined, isGptPubadsDefined, logError, logWarn} from './utils.js';\r\nimport {\r\n  deferRendering,\r\n  getBidToRender,\r\n  handleCreativeEvent,\r\n  handleNativeMessage,\r\n  handleRender,\r\n  markWinner\r\n} from './adRendering.js';\r\nimport {getCreativeRendererSource, PUC_MIN_VERSION} from './creativeRenderers.js';\r\n\r\nconst { REQUEST, RESPONSE, NATIVE, EVENT } = MESSAGES;\r\n\r\nconst HANDLER_MAP = {\r\n  [REQUEST]: handleRenderRequest,\r\n  [EVENT]: handleEventRequest,\r\n};\r\n\r\nif (FEATURES.NATIVE) {\r\n  Object.assign(HANDLER_MAP, {\r\n    [NATIVE]: handleNativeRequest,\r\n  });\r\n}\r\n\r\nexport function listenMessagesFromCreative() {\r\n  window.addEventListener('message', function (ev) {\r\n    receiveMessage(ev);\r\n  }, false);\r\n}\r\n\r\nexport function getReplier(ev) {\r\n  if (ev.origin == null && ev.ports.length === 0) {\r\n    return function () {\r\n      const msg = 'Cannot post message to a frame with null origin. Please update creatives to use MessageChannel, see https://github.com/prebid/Prebid.js/issues/7870';\r\n      logError(msg);\r\n      throw new Error(msg);\r\n    };\r\n  } else if (ev.ports.length > 0) {\r\n    return function (message) {\r\n      ev.ports[0].postMessage(JSON.stringify(message));\r\n    };\r\n  } else {\r\n    return function (message) {\r\n      ev.source.postMessage(JSON.stringify(message), ev.origin);\r\n    };\r\n  }\r\n}\r\n\r\nfunction ensureAdId(adId, reply) {\r\n  return function (data, ...args) {\r\n    return reply(Object.assign({}, data, {adId}), ...args);\r\n  }\r\n}\r\n\r\nexport function receiveMessage(ev) {\r\n  var key = ev.message ? 'message' : 'data';\r\n  var data = {};\r\n  try {\r\n    data = JSON.parse(ev[key]);\r\n  } catch (e) {\r\n    return;\r\n  }\r\n\r\n  if (data && data.adId && data.message && HANDLER_MAP.hasOwnProperty(data.message)) {\r\n    return getBidToRender(data.adId, data.message === MESSAGES.REQUEST).then(adObject => {\r\n      HANDLER_MAP[data.message](ensureAdId(data.adId, getReplier(ev)), data, adObject);\r\n    })\r\n  }\r\n}\r\n\r\nfunction getResizer(adId, bidResponse) {\r\n  // in some situations adId !== bidResponse.adId\r\n  // the first is the one that was requested and is tied to the element\r\n  // the second is the one that is being rendered (sometimes different, e.g. in some paapi setups)\r\n  return function (width, height) {\r\n    resizeRemoteCreative({...bidResponse, width, height, adId});\r\n  }\r\n}\r\nfunction handleRenderRequest(reply, message, bidResponse) {\r\n  handleRender({\r\n    renderFn(adData) {\r\n      reply(Object.assign({\r\n        message: RESPONSE,\r\n        renderer: getCreativeRendererSource(bidResponse),\r\n        rendererVersion: PUC_MIN_VERSION\r\n      }, adData));\r\n    },\r\n    resizeFn: getResizer(message.adId, bidResponse),\r\n    options: message.options,\r\n    adId: message.adId,\r\n    bidResponse\r\n  });\r\n}\r\n\r\nfunction handleNativeRequest(reply, data, adObject) {\r\n  // handle this script from native template in an ad server\r\n  // window.parent.postMessage(JSON.stringify({\r\n  //   message: 'Prebid Native',\r\n  //   adId: '%%PATTERN:hb_adid%%'\r\n  // }), '*');\r\n  if (adObject == null) {\r\n    logError(`Cannot find ad for x-origin event request: '${data.adId}'`);\r\n    return;\r\n  }\r\n  switch (data.action) {\r\n    case 'assetRequest':\r\n      deferRendering(adObject, () => reply(getAssetMessage(data, adObject)));\r\n      break;\r\n    case 'allAssetRequest':\r\n      deferRendering(adObject, () => reply(getAllAssetsMessage(data, adObject)));\r\n      break;\r\n    default:\r\n      handleNativeMessage(data, adObject, {resizeFn: getResizer(data.adId, adObject)});\r\n      markWinner(adObject);\r\n  }\r\n}\r\n\r\nfunction handleEventRequest(reply, data, adObject) {\r\n  if (adObject == null) {\r\n    logError(`Cannot find ad '${data.adId}' for x-origin event request`);\r\n    return;\r\n  }\r\n  if (adObject.status !== BID_STATUS.RENDERED) {\r\n    logWarn(`Received x-origin event request without corresponding render request for ad '${adObject.adId}'`);\r\n    return;\r\n  }\r\n  return handleCreativeEvent(data, adObject);\r\n}\r\n\r\nexport function resizeRemoteCreative({instl, adId, adUnitCode, width, height}) {\r\n  // do not resize interstitials - the creative frame takes the full screen and sizing of the ad should\r\n  // be handled within it.\r\n  if (instl) return;\r\n  function getDimension(value) {\r\n    return value ? value + 'px' : '100%';\r\n  }\r\n  // resize both container div + iframe\r\n  ['div', 'iframe'].forEach(elmType => {\r\n    // not select element that gets removed after dfp render\r\n    const element = getElementByAdUnit(elmType + ':not([style*=\"display: none\"])');\r\n    if (element) {\r\n      const elementStyle = element.style;\r\n      elementStyle.width = getDimension(width)\r\n      elementStyle.height = getDimension(height);\r\n    } else {\r\n      logError(`Unable to locate matching page element for adUnitCode ${adUnitCode}.  Can't resize it to ad's dimensions.  Please review setup.`);\r\n    }\r\n  });\r\n\r\n  function getElementByAdUnit(elmType) {\r\n    const id = getElementIdBasedOnAdServer(adId, adUnitCode);\r\n    const parentDivEle = document.getElementById(id);\r\n    return parentDivEle && parentDivEle.querySelector(elmType);\r\n  }\r\n\r\n  function getElementIdBasedOnAdServer(adId, adUnitCode) {\r\n    if (isGptPubadsDefined()) {\r\n      return getDfpElementId(adId);\r\n    } else if (isApnGetTagDefined()) {\r\n      return getAstElementId(adUnitCode);\r\n    } else {\r\n      return adUnitCode;\r\n    }\r\n  }\r\n\r\n  function getDfpElementId(adId) {\r\n    const slot = window.googletag.pubads().getSlots().find(slot => {\r\n      return slot.getTargetingKeys().find(key => {\r\n        return slot.getTargeting(key).includes(adId);\r\n      });\r\n    });\r\n    return slot ? slot.getSlotElementId() : null;\r\n  }\r\n\r\n  function getAstElementId(adUnitCode) {\r\n    const astTag = window.apntag.getTag(adUnitCode);\r\n    return astTag && astTag.targetId;\r\n  }\r\n}\r\n","import {checkCookieSupport, hasDeviceAccess, logError} from './utils.js';\r\nimport {bidderSettings} from './bidderSettings.js';\r\nimport {MODULE_TYPE_BIDDER, MODULE_TYPE_PREBID, type ModuleType} from './activities/modules.js';\r\nimport {isActivityAllowed, registerActivityControl} from './activities/rules.js';\r\nimport {\r\n  ACTIVITY_PARAM_ADAPTER_CODE,\r\n  ACTIVITY_PARAM_COMPONENT_TYPE,\r\n  ACTIVITY_PARAM_STORAGE_KEY,\r\n  ACTIVITY_PARAM_STORAGE_TYPE,\r\n  ACTIVITY_PARAM_STORAGE_WRITE\r\n} from './activities/params.js';\r\n\r\nimport {ACTIVITY_ACCESS_DEVICE, ACTIVITY_ACCESS_REQUEST_CREDENTIALS} from './activities/activities.js';\r\nimport {config} from './config.js';\r\nimport {hook} from \"./hook.ts\";\r\nimport adapterManager from './adapterManager.js';\r\nimport {activityParams} from './activities/activityParams.js';\r\nimport type {AnyFunction} from \"./types/functions.d.ts\";\r\nimport type {BidderCode} from \"./types/common.d.ts\";\r\n\r\nexport const STORAGE_TYPE_LOCALSTORAGE = 'html5';\r\nexport const STORAGE_TYPE_COOKIES = 'cookie';\r\n\r\nexport type StorageType = typeof STORAGE_TYPE_LOCALSTORAGE | typeof STORAGE_TYPE_COOKIES;\r\n\r\nexport let storageCallbacks = [];\r\n\r\n/* eslint-disable no-restricted-properties */\r\n\r\ninterface AcceptsCallback<FN extends AnyFunction> {\r\n  (...args: Parameters<FN>): ReturnType<FN>;\r\n  (...args: [...Parameters<FN>, (result: ReturnType<FN>) => void]): void;\r\n}\r\n\r\ntype BrowserStorage = 'localStorage' | 'sessionStorage';\r\n\r\nexport type StorageManager = {\r\n  [M in BrowserStorage as `has${Capitalize<M>}`]: AcceptsCallback<() => boolean>;\r\n} & {\r\n  [M in BrowserStorage as `${M}IsEnabled`]: AcceptsCallback<() => boolean>;\r\n} & {\r\n  // eslint-disable-next-line no-restricted-globals\r\n  [M in BrowserStorage as `setDataIn${Capitalize<M>}`]: AcceptsCallback<typeof localStorage.setItem>;\r\n} & {\r\n  // eslint-disable-next-line no-restricted-globals\r\n  [M in BrowserStorage as `getDataFrom${Capitalize<M>}`]: AcceptsCallback<typeof localStorage.getItem>;\r\n} & {\r\n  // eslint-disable-next-line no-restricted-globals\r\n  [M in BrowserStorage as `removeDataFrom${Capitalize<M>}`]: AcceptsCallback<typeof localStorage.removeItem>\r\n} & {\r\n  setCookie: AcceptsCallback<(name: string, value: string, expires?: string, sameSite?: string, domain?: string) => void>;\r\n  getCookie: AcceptsCallback<(name: string) => string>;\r\n  cookiesAreEnabled: AcceptsCallback<() => boolean>;\r\n  findSimilarCookies: AcceptsCallback<(contains: string) => string[]>\r\n}\r\n\r\n/*\r\n *  Storage manager constructor. Consumers should prefer one of `getStorageManager` or `getCoreStorageManager`.\r\n */\r\nexport function newStorageManager({moduleName, moduleType, advertiseKeys = true}: {\r\n  moduleName: string;\r\n  moduleType: ModuleType;\r\n  /**\r\n   * If false, do not pass the 'storageKey' to activity checks - turning off storageControl for this manager.\r\n   */\r\n  advertiseKeys?: boolean;\r\n} = {} as any, {isAllowed = isActivityAllowed} = {}) {\r\n  function isValid(cb, storageType, storageKey, isWrite) {\r\n    let mod = moduleName;\r\n    const curBidder = config.getCurrentBidder();\r\n    if (curBidder && moduleType === MODULE_TYPE_BIDDER && adapterManager.aliasRegistry[curBidder] === moduleName) {\r\n      mod = curBidder;\r\n    }\r\n    const params = {\r\n      [ACTIVITY_PARAM_STORAGE_TYPE]: storageType,\r\n      [ACTIVITY_PARAM_STORAGE_WRITE]: isWrite,\r\n    };\r\n    if (advertiseKeys && storageKey != null) {\r\n      params[ACTIVITY_PARAM_STORAGE_KEY] = storageKey;\r\n    }\r\n    const result = {\r\n      valid: isAllowed(ACTIVITY_ACCESS_DEVICE, activityParams(moduleType, mod, params))\r\n    };\r\n\r\n    return cb(result);\r\n  }\r\n\r\n  function schedule(operation, storageType, storageKey, isWrite, done) {\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(operation, storageType, storageKey, isWrite);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(operation, storageType, storageKey, isWrite);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   * @param {string} value\r\n   * @param {string} [expires='']\r\n   * @param {string} [sameSite='/']\r\n   * @param {string} [domain] domain (e.g., 'example.com' or 'subdomain.example.com').\r\n   * If not specified, defaults to the host portion of the current document location.\r\n   * If a domain is specified, subdomains are always included.\r\n   * Domain must match the domain of the JavaScript origin. Setting cookies to foreign domains will be silently ignored.\r\n   * @param {function} [done]\r\n   */\r\n  const setCookie = function (key, value, expires, sameSite, domain, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        const domainPortion = (domain && domain !== '') ? ` ;domain=${encodeURIComponent(domain)}` : '';\r\n        const expiresPortion = (expires && expires !== '') ? ` ;expires=${expires}` : '';\r\n        const isNone = (sameSite != null && sameSite.toLowerCase() == 'none')\r\n        const secure = (isNone) ? '; Secure' : '';\r\n        document.cookie = `${key}=${encodeURIComponent(value)}${expiresPortion}; path=/${domainPortion}${sameSite ? `; SameSite=${sameSite}` : ''}${secure}`;\r\n      }\r\n    }\r\n    return schedule(cb, STORAGE_TYPE_COOKIES, key, true, done);\r\n  };\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @param {function} [done]\r\n   * @returns {(string|null)}\r\n   */\r\n  const getCookie = function(name, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\r\n        return m ? decodeURIComponent(m[2]) : null;\r\n      }\r\n      return null;\r\n    }\r\n    return schedule(cb, STORAGE_TYPE_COOKIES, name, false, done);\r\n  };\r\n\r\n  /**\r\n   * @param {function} [done]\r\n   * @returns {boolean}\r\n   */\r\n  const cookiesAreEnabled = function (done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        return checkCookieSupport();\r\n      }\r\n      return false;\r\n    }\r\n    return schedule(cb, STORAGE_TYPE_COOKIES, null, false, done);\r\n  }\r\n\r\n  function storageMethods(name) {\r\n    const capName = name.charAt(0).toUpperCase() + name.substring(1);\r\n    const backend = () => window[name] as any;\r\n\r\n    const hasStorage: AcceptsCallback<() => boolean> = function (done) {\r\n      let cb = function (result) {\r\n        if (result && result.valid) {\r\n          try {\r\n            return !!backend();\r\n          } catch (e) {\r\n            logError(`${name} api disabled`);\r\n          }\r\n        }\r\n        return false;\r\n      }\r\n      return schedule(cb, STORAGE_TYPE_LOCALSTORAGE, null, false, done);\r\n    } as any;\r\n\r\n    return {\r\n      [`has${capName}`]: hasStorage,\r\n      [`${name}IsEnabled`](done) {\r\n        let cb = function (result) {\r\n          if (result && result.valid) {\r\n            try {\r\n              backend().setItem('prebid.cookieTest', '1');\r\n              return backend().getItem('prebid.cookieTest') === '1';\r\n            } catch (error) {\r\n            } finally {\r\n              try {\r\n                backend().removeItem('prebid.cookieTest');\r\n              } catch (error) {}\r\n            }\r\n          }\r\n          return false;\r\n        }\r\n        return schedule(cb, STORAGE_TYPE_LOCALSTORAGE, null, false, done);\r\n      },\r\n      [`setDataIn${capName}`](key, value, done) {\r\n        let cb = function (result) {\r\n          if (result && result.valid && hasStorage()) {\r\n            backend().setItem(key, value);\r\n          }\r\n        }\r\n        return schedule(cb, STORAGE_TYPE_LOCALSTORAGE, key, true, done);\r\n      },\r\n      [`getDataFrom${capName}`](key, done) {\r\n        let cb = function (result) {\r\n          if (result && result.valid && hasStorage()) {\r\n            return backend().getItem(key);\r\n          }\r\n          return null;\r\n        }\r\n        return schedule(cb, STORAGE_TYPE_LOCALSTORAGE, key, false, done);\r\n      },\r\n      [`removeDataFrom${capName}`](key, done) {\r\n        let cb = function (result) {\r\n          if (result && result.valid && hasStorage()) {\r\n            backend().removeItem(key);\r\n          }\r\n        }\r\n        return schedule(cb, STORAGE_TYPE_LOCALSTORAGE, key, true, done);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns all cookie values from the jar whose names contain the `keyLike`\r\n   * Needs to exist in `utils.js` as it follows the StorageHandler interface defined in live-connect-js. If that module were to be removed, this function can go as well.\r\n   * @param {string} keyLike\r\n   * @param {function} [done]\r\n   * @returns {string[]}\r\n   */\r\n  const findSimilarCookies = function(keyLike, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        const all = [];\r\n        if (hasDeviceAccess()) {\r\n          const cookies = document.cookie.split(';');\r\n          while (cookies.length) {\r\n            const cookie = cookies.pop();\r\n            let separatorIndex = cookie.indexOf('=');\r\n            separatorIndex = separatorIndex < 0 ? cookie.length : separatorIndex;\r\n            const cookieName = decodeURIComponent(cookie.slice(0, separatorIndex).replace(/^\\s+/, ''));\r\n            if (cookieName.indexOf(keyLike) >= 0) {\r\n              all.push(decodeURIComponent(cookie.slice(separatorIndex + 1)));\r\n            }\r\n          }\r\n        }\r\n        return all;\r\n      }\r\n    }\r\n\r\n    return schedule(cb, STORAGE_TYPE_COOKIES, keyLike, false, done);\r\n  }\r\n\r\n  return {\r\n    setCookie,\r\n    getCookie,\r\n    cookiesAreEnabled,\r\n    ...storageMethods('localStorage'),\r\n    ...storageMethods('sessionStorage'),\r\n    findSimilarCookies\r\n  } as StorageManager;\r\n}\r\n\r\n/**\r\n * Get a storage manager for a particular module.\r\n *\r\n * Either bidderCode or a combination of moduleType + moduleName must be provided. The former is a shorthand\r\n *  for `{moduleType: 'bidder', moduleName: bidderCode}`.\r\n *\r\n */\r\nexport function getStorageManager({moduleType, moduleName, bidderCode}: {\r\n  moduleType?: ModuleType;\r\n  moduleName?: string;\r\n  bidderCode?: BidderCode;\r\n} = {}) {\r\n  function err() {\r\n    throw new Error(`Invalid invocation for getStorageManager: must set either bidderCode, or moduleType + moduleName`)\r\n  }\r\n  if (bidderCode) {\r\n    if ((moduleType && moduleType !== MODULE_TYPE_BIDDER) || moduleName) err()\r\n    moduleType = MODULE_TYPE_BIDDER;\r\n    moduleName = bidderCode;\r\n  } else if (!moduleName || !moduleType) {\r\n    err()\r\n  }\r\n  return newStorageManager({moduleType, moduleName});\r\n}\r\n\r\n/**\r\n * Get a storage manager for \"core\" (vendorless, or first-party) modules. Shorthand for `getStorageManager({moduleName, moduleType: 'core'})`.\r\n *\r\n * @param {string} moduleName Module name\r\n */\r\nexport function getCoreStorageManager(moduleName) {\r\n  return newStorageManager({moduleName: moduleName, moduleType: MODULE_TYPE_PREBID});\r\n}\r\n\r\n/**\r\n * Block all access to storage when deviceAccess = false\r\n */\r\nexport function deviceAccessRule() {\r\n  if (!hasDeviceAccess()) {\r\n    return {allow: false}\r\n  }\r\n}\r\nregisterActivityControl(ACTIVITY_ACCESS_DEVICE, 'deviceAccess config', deviceAccessRule);\r\n\r\n/**\r\n * Block all access to request credentials when deviceAccess = false\r\n */\r\nregisterActivityControl(ACTIVITY_ACCESS_REQUEST_CREDENTIALS, 'deviceAccess config', deviceAccessRule);\r\n\r\n/**\r\n * By default, deny bidders accessDevice unless they enable it through bidderSettings\r\n *\r\n * // TODO: for backwards compat, the check is done on the adapter - rather than bidder's code.\r\n */\r\nexport function storageAllowedRule(params, bs = bidderSettings) {\r\n  if (params[ACTIVITY_PARAM_COMPONENT_TYPE] !== MODULE_TYPE_BIDDER) return;\r\n  let allow = bs.get(params[ACTIVITY_PARAM_ADAPTER_CODE], 'storageAllowed');\r\n  if (!allow || allow === true) {\r\n    allow = !!allow\r\n  } else {\r\n    const storageType = params[ACTIVITY_PARAM_STORAGE_TYPE];\r\n    allow = Array.isArray(allow) ? allow.some((e) => e === storageType) : allow === storageType;\r\n  }\r\n  if (!allow) {\r\n    return {allow};\r\n  }\r\n}\r\n\r\nregisterActivityControl(ACTIVITY_ACCESS_DEVICE, 'bidderSettings.*.storageAllowed', storageAllowedRule);\r\n\r\nexport function resetData() {\r\n  storageCallbacks = [];\r\n}\r\n\r\ntype CookieStorageDisclosure = {\r\n  type: 'cookie',\r\n  /**\r\n   * The number, in seconds, of the duration for storage on a device, as set when using cookie storage.\r\n   */\r\n  maxAgeSeconds: number;\r\n  /**\r\n   * Indicates the vendor is refreshing a cookie.\r\n   */\r\n  cookieRefresh: boolean;\r\n}\r\ntype HTML5StorageDisclosure = {\r\n  type: 'web'\r\n  maxAgeSeconds?: null;\r\n  cookieRefresh?: null;\r\n}\r\n\r\n/**\r\n * First party storage use disclosure. Follows the same format as\r\n * https://github.com/InteractiveAdvertisingBureau/GDPR-Transparency-and-Consent-Framework/blob/master/TCFv2/Vendor%20Device%20Storage%20%26%20Operational%20Disclosures.md\r\n * except that `domain` is omitted.\r\n */\r\nexport type StorageDisclosure = (CookieStorageDisclosure | HTML5StorageDisclosure) & {\r\n  /**\r\n   * Key or object name, depending on type, for the storage item.\r\n   * Wildcards '*' are permitted. For example, \"id*\" or \"*id\" describes multiple prefixed or suffixed identifiers,\r\n   * all having the same purpose(s).\r\n   */\r\n  identifier: string;\r\n  /**\r\n   * The purpose ID or purpose IDs from the Global Vendor List (GVL) for which the storage is used.\r\n   */\r\n  purposes: number[];\r\n}\r\n\r\n/**\r\n * Disclose first party storage use.\r\n */\r\nexport const discloseStorageUse = hook('sync', (moduleName: string, disclosure: StorageDisclosure) => {});\r\n","import {auctionManager} from './auctionManager.js';\r\nimport {getBufferedTTL} from './bidTTL.js';\r\nimport {bidderSettings} from './bidderSettings.js';\r\nimport {config} from './config.js';\r\nimport {\r\n  BID_STATUS,\r\n  DEFAULT_TARGETING_KEYS,\r\n  EVENTS,\r\n  JSON_MAPPING,\r\n  TARGETING_KEYS\r\n} from './constants.js';\r\nimport * as events from './events.js';\r\nimport {hook} from './hook.js';\r\nimport {ADPOD} from './mediaTypes.js';\r\nimport {\r\n  deepAccess,\r\n  deepClone,\r\n  groupBy,\r\n  isAdUnitCodeMatchingSlot,\r\n  isArray,\r\n  isFn,\r\n  isStr,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  sortByHighestCpm,\r\n  timestamp,\r\n  uniques,\r\n} from './utils.js';\r\nimport {getHighestCpm, getOldestHighestCpmBid} from './utils/reducers.js';\r\nimport type {Bid} from './bidfactory.ts';\r\nimport type {AdUnitCode, ByAdUnit, Identifier} from './types/common.d.ts';\r\nimport type {DefaultTargeting} from './auction.ts';\r\n\r\nvar pbTargetingKeys = [];\r\n\r\nconst MAX_DFP_KEYLENGTH = 20;\r\n\r\nconst CFG_ALLOW_TARGETING_KEYS = `targetingControls.allowTargetingKeys`;\r\nconst CFG_ADD_TARGETING_KEYS = `targetingControls.addTargetingKeys`;\r\nconst TARGETING_KEY_CONFIGURATION_ERROR_MSG = `Only one of \"${CFG_ALLOW_TARGETING_KEYS}\" or \"${CFG_ADD_TARGETING_KEYS}\" can be set`;\r\n\r\nexport const TARGETING_KEYS_ARR = Object.keys(TARGETING_KEYS).map(\r\n  key => TARGETING_KEYS[key]\r\n);\r\n\r\n// return unexpired bids\r\nconst isBidNotExpired = (bid) => (bid.responseTimestamp + getBufferedTTL(bid) * 1000) > timestamp();\r\n\r\n// return bids whose status is not set. Winning bids can only have a status of `rendered`.\r\nconst isUnusedBid = (bid) => bid && ((bid.status && ![BID_STATUS.RENDERED].includes(bid.status)) || !bid.status);\r\n\r\nexport const filters = {\r\n  isBidNotExpired,\r\n  isUnusedBid\r\n};\r\n\r\nexport function isBidUsable(bid) {\r\n  return !Object.values(filters).some((predicate) => !predicate(bid));\r\n}\r\n\r\n// If two bids are found for same adUnitCode, we will use the highest one to take part in auction\r\n// This can happen in case of concurrent auctions\r\n// If adUnitBidLimit is set above 0 return top N number of bids\r\nexport const getHighestCpmBidsFromBidPool = hook('sync', function(bidsReceived, winReducer, adUnitBidLimit = 0, hasModified = false, winSorter = sortByHighestCpm) {\r\n  if (!hasModified) {\r\n    const bids = [];\r\n    const dealPrioritization = config.getConfig('sendBidsControl.dealPrioritization');\r\n    // bucket by adUnitcode\r\n    const buckets = groupBy(bidsReceived, 'adUnitCode');\r\n    // filter top bid for each bucket by bidder\r\n    Object.keys(buckets).forEach(bucketKey => {\r\n      let bucketBids = [];\r\n      const bidsByBidder = groupBy(buckets[bucketKey], 'bidderCode')\r\n      Object.keys(bidsByBidder).forEach(key => { bucketBids.push(bidsByBidder[key].reduce(winReducer)) });\r\n      // if adUnitBidLimit is set, pass top N number bids\r\n      if (adUnitBidLimit) {\r\n        bucketBids = dealPrioritization ? bucketBids.sort(sortByDealAndPriceBucketOrCpm(true)) : bucketBids.sort((a, b) => b.cpm - a.cpm);\r\n        bids.push(...bucketBids.slice(0, adUnitBidLimit));\r\n      } else {\r\n        bucketBids = bucketBids.sort(winSorter)\r\n        bids.push(...bucketBids);\r\n      }\r\n    });\r\n\r\n    return bids;\r\n  }\r\n\r\n  return bidsReceived;\r\n});\r\n\r\n/**\r\n * A descending sort function that will sort the list of objects based on the following two dimensions:\r\n *  - bids with a deal are sorted before bids w/o a deal\r\n *  - then sort bids in each grouping based on the hb_pb value\r\n * eg: the following list of bids would be sorted like:\r\n *  [{\r\n *    \"hb_adid\": \"vwx\",\r\n *    \"hb_pb\": \"28\",\r\n *    \"hb_deal\": \"7747\"\r\n *  }, {\r\n *    \"hb_adid\": \"jkl\",\r\n *    \"hb_pb\": \"10\",\r\n *    \"hb_deal\": \"9234\"\r\n *  }, {\r\n *    \"hb_adid\": \"stu\",\r\n *    \"hb_pb\": \"50\"\r\n *  }, {\r\n *    \"hb_adid\": \"def\",\r\n *    \"hb_pb\": \"2\"\r\n *  }]\r\n */\r\nexport function sortByDealAndPriceBucketOrCpm(useCpm = false) {\r\n  return function(a, b) {\r\n    if (a.adserverTargeting.hb_deal !== undefined && b.adserverTargeting.hb_deal === undefined) {\r\n      return -1;\r\n    }\r\n\r\n    if ((a.adserverTargeting.hb_deal === undefined && b.adserverTargeting.hb_deal !== undefined)) {\r\n      return 1;\r\n    }\r\n\r\n    // assuming both values either have a deal or don't have a deal - sort by the hb_pb param\r\n    if (useCpm) {\r\n      return b.cpm - a.cpm;\r\n    }\r\n\r\n    return b.adserverTargeting.hb_pb - a.adserverTargeting.hb_pb;\r\n  }\r\n}\r\n\r\n/**\r\n * Return a map where each code in `adUnitCodes` maps to a list of GPT slots that match it.\r\n *\r\n * @param adUnitCodes\r\n * @param customSlotMatching\r\n * @param getSlots\r\n */\r\nexport function getGPTSlotsForAdUnits(adUnitCodes: AdUnitCode[], customSlotMatching, getSlots = () => window.googletag.pubads().getSlots()): ByAdUnit<googletag.Slot[]> {\r\n  return getSlots().reduce((auToSlots, slot) => {\r\n    const customMatch = isFn(customSlotMatching) && customSlotMatching(slot);\r\n    Object.keys(auToSlots).filter(isFn(customMatch) ? customMatch : isAdUnitCodeMatchingSlot(slot)).forEach(au => auToSlots[au].push(slot));\r\n    return auToSlots;\r\n  }, Object.fromEntries(adUnitCodes.map(au => [au, []])));\r\n}\r\n\r\nexport type TargetingMap<V> = Partial<DefaultTargeting> & {\r\n  [targetingKey: string]: V\r\n}\r\n\r\nexport type TargetingValues = TargetingMap<string>;\r\ntype GPTTargetingValues = TargetingMap<string | string[]>;\r\n\r\ntype TargetingValueLists = TargetingMap<string[]>;\r\ntype TargetingArray = ByAdUnit<TargetingValueLists[]>[];\r\n\r\ntype AdUnitPredicate = (adUnitCode: AdUnitCode) => boolean;\r\nexport type SlotMatchingFn = (slot: googletag.Slot) => AdUnitPredicate;\r\n\r\ndeclare module './events' {\r\n  interface Events {\r\n    [EVENTS.SET_TARGETING]: [ByAdUnit<GPTTargetingValues>];\r\n  }\r\n}\r\n\r\nexport interface TargetingControlsConfig {\r\n  /**\r\n   * Specifies the maximum number of characters the system can add to ad server targeting.\r\n   */\r\n  auctionKeyMaxChars?: number;\r\n  /**\r\n   * If enableSendAllBids is false, set this value to true to ensure that deals are sent along with the winning bid\r\n   */\r\n  alwaysIncludeDeals?: boolean;\r\n  /**\r\n   * Selects supported default targeting keys.\r\n   */\r\n  allowTargetingKeys?: (keyof typeof TARGETING_KEYS)[];\r\n  /**\r\n   * Selects targeting keys to be supported in addition to the default ones\r\n   */\r\n  addTargetingKeys?: (keyof typeof TARGETING_KEYS)[];\r\n  /**\r\n   * Selects supported default targeting keys.\r\n   */\r\n  allowSendAllBidsTargetingKeys?: (keyof typeof TARGETING_KEYS)[];\r\n  /**\r\n   * Set to false to prevent custom targeting values from being set for non-winning bids\r\n   */\r\n  allBidsCustomTargeting?: boolean\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    targetingControls?: TargetingControlsConfig;\r\n  }\r\n}\r\n\r\nexport function newTargeting(auctionManager) {\r\n  const latestAuctionForAdUnit = {};\r\n\r\n  const targeting = {\r\n    setLatestAuctionForAdUnit(adUnitCode: AdUnitCode, auctionId: Identifier) {\r\n      latestAuctionForAdUnit[adUnitCode] = auctionId;\r\n    },\r\n\r\n    resetPresetTargetingAST(adUnitCode?: AdUnitCode | AdUnitCode[]) {\r\n      const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n      adUnitCodes.forEach(function(unit) {\r\n        const astTag = window.apntag.getTag(unit);\r\n        if (astTag && astTag.keywords) {\r\n          const currentKeywords = Object.keys(astTag.keywords);\r\n          const newKeywords = {};\r\n          currentKeywords.forEach((key) => {\r\n            if (!pbTargetingKeys.includes(key.toLowerCase())) {\r\n              newKeywords[key] = astTag.keywords[key];\r\n            }\r\n          })\r\n          window.apntag.modifyTag(unit, { keywords: newKeywords })\r\n        }\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Returns all ad server targeting for all ad units.\r\n     * @param adUnitCode\r\n     * @param bidLimit\r\n     * @param bidsReceived - The received bids, defaulting to the result of getBidsReceived().\r\n     * @param [winReducer = getHighestCpm] - reducer method\r\n     * @param [winSorter = sortByHighestCpm] - sorter method\r\n     * @return targeting\r\n     */\r\n    getAllTargeting(adUnitCode?: AdUnitCode | AdUnitCode[], bidLimit?: number, bidsReceived?: Bid[], winReducer = getHighestCpm, winSorter = sortByHighestCpm): ByAdUnit<TargetingValues> {\r\n      bidsReceived ||= getBidsReceived(winReducer, winSorter);\r\n      const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n      const sendAllBids = config.getConfig('enableSendAllBids');\r\n      const bidLimitConfigValue = config.getConfig('sendBidsControl.bidLimit');\r\n      const adUnitBidLimit = (sendAllBids && (bidLimit || bidLimitConfigValue)) || 0;\r\n      const { customKeysByUnit, filteredBids } = getfilteredBidsAndCustomKeys(adUnitCodes, bidsReceived);\r\n      const bidsSorted = getHighestCpmBidsFromBidPool(filteredBids, winReducer, adUnitBidLimit, undefined, winSorter);\r\n      let targeting = getTargetingLevels(bidsSorted, customKeysByUnit, adUnitCodes);\r\n\r\n      const defaultKeys = Object.keys(Object.assign({}, DEFAULT_TARGETING_KEYS));\r\n      let allowedKeys = config.getConfig(CFG_ALLOW_TARGETING_KEYS);\r\n      const addedKeys = config.getConfig(CFG_ADD_TARGETING_KEYS);\r\n\r\n      if (addedKeys != null && allowedKeys != null) {\r\n        throw new Error(TARGETING_KEY_CONFIGURATION_ERROR_MSG);\r\n      } else if (addedKeys != null) {\r\n        allowedKeys = defaultKeys.concat(addedKeys) as any;\r\n      } else {\r\n        allowedKeys = allowedKeys || defaultKeys as any;\r\n      }\r\n\r\n      if (Array.isArray(allowedKeys) && allowedKeys.length > 0) {\r\n        targeting = getAllowedTargetingKeyValues(targeting, allowedKeys);\r\n      }\r\n\r\n      let flatTargeting = flattenTargeting(targeting);\r\n\r\n      const auctionKeysThreshold = config.getConfig('targetingControls.auctionKeyMaxChars');\r\n      if (auctionKeysThreshold) {\r\n        logInfo(`Detected 'targetingControls.auctionKeyMaxChars' was active for this auction; set with a limit of ${auctionKeysThreshold} characters.  Running checks on auction keys...`);\r\n        flatTargeting = filterTargetingKeys(flatTargeting, auctionKeysThreshold);\r\n      }\r\n\r\n      // make sure at least there is a entry per adUnit code in the targetingSet so receivers of SET_TARGETING call's can know what ad units are being invoked\r\n      adUnitCodes.forEach(code => {\r\n        if (!flatTargeting[code]) {\r\n          flatTargeting[code] = {};\r\n        }\r\n      });\r\n\r\n      return flatTargeting;\r\n    },\r\n\r\n    setTargetingForGPT: hook('sync', function (adUnit?: AdUnitCode | AdUnitCode[], customSlotMatching?: SlotMatchingFn) {\r\n      // get our ad unit codes\r\n      const targetingSet: ByAdUnit<GPTTargetingValues> = targeting.getAllTargeting(adUnit);\r\n\r\n      const resetMap = Object.fromEntries(pbTargetingKeys.map(key => [key, null]));\r\n\r\n      Object.entries(getGPTSlotsForAdUnits(Object.keys(targetingSet), customSlotMatching)).forEach(([targetId, slots]) => {\r\n        slots.forEach(slot => {\r\n          // now set new targeting keys\r\n          Object.keys(targetingSet[targetId]).forEach(key => {\r\n            let value: string | string[] = targetingSet[targetId][key];\r\n            if (typeof value === 'string' && value.indexOf(',') !== -1) {\r\n              // due to the check the array will be formed only if string has ',' else plain string will be assigned as value\r\n              value = value.split(',');\r\n            }\r\n            targetingSet[targetId][key] = value;\r\n          });\r\n          logMessage(`Attempting to set targeting-map for slot: ${slot.getSlotElementId()} with targeting-map:`, targetingSet[targetId]);\r\n          slot.updateTargetingFromMap(Object.assign({}, resetMap, targetingSet[targetId]))\r\n        })\r\n      })\r\n\r\n      Object.keys(targetingSet).forEach((adUnitCode) => {\r\n        Object.keys(targetingSet[adUnitCode]).forEach((targetingKey) => {\r\n          if (targetingKey === 'hb_adid') {\r\n            auctionManager.setStatusForBids(targetingSet[adUnitCode][targetingKey], BID_STATUS.BID_TARGETING_SET);\r\n          }\r\n        });\r\n      });\r\n\r\n      targeting.targetingDone(targetingSet);\r\n\r\n      // emit event\r\n      events.emit(EVENTS.SET_TARGETING, targetingSet);\r\n    }, 'setTargetingForGPT'),\r\n\r\n    targetingDone: hook('sync', function (targetingSet: ByAdUnit<GPTTargetingValues>) {\r\n      return targetingSet;\r\n    }, 'targetingDone'),\r\n\r\n    /**\r\n     * Returns top bids for a given adUnit or set of adUnits.\r\n     * @param  adUnitCode adUnitCode or array of adUnitCodes\r\n     * @param  bids - The received bids, defaulting to the result of getBidsReceived().\r\n     * @param  [winReducer = getHighestCpm] - reducer method\r\n     * @param  [winSorter = sortByHighestCpm] - sorter method\r\n     * @return An array of winning bids.\r\n     */\r\n    getWinningBids(adUnitCode: AdUnitCode | AdUnitCode[], bids?: Bid[], winReducer = getHighestCpm, winSorter = sortByHighestCpm): Bid[] {\r\n      const bidsReceived = bids || getBidsReceived(winReducer, winSorter);\r\n      const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n\r\n      return bidsReceived\r\n        .filter(bid => adUnitCodes.includes(bid.adUnitCode))\r\n        .filter(bid => (bidderSettings.get(bid.bidderCode, 'allowZeroCpmBids') === true) ? bid.cpm >= 0 : bid.cpm > 0)\r\n        .map(bid => bid.adUnitCode)\r\n        .filter(uniques)\r\n        .map(adUnitCode => bidsReceived\r\n          .filter(bid => bid.adUnitCode === adUnitCode ? bid : null)\r\n          .reduce(getHighestCpm));\r\n    },\r\n\r\n    /**\r\n     * @param  adUnitCodes adUnitCode or array of adUnitCodes\r\n     * Sets targeting for AST\r\n     */\r\n    setTargetingForAst(adUnitCodes?: AdUnitCode | AdUnitCode[]) {\r\n      const astTargeting = targeting.getAllTargeting(adUnitCodes);\r\n\r\n      try {\r\n        targeting.resetPresetTargetingAST(adUnitCodes);\r\n      } catch (e) {\r\n        logError('unable to reset targeting for AST' + e)\r\n      }\r\n\r\n      Object.keys(astTargeting).forEach(targetId =>\r\n        Object.keys(astTargeting[targetId]).forEach(key => {\r\n          logMessage(`Attempting to set targeting for targetId: ${targetId} key: ${key} value: ${astTargeting[targetId][key]}`);\r\n          // setKeywords supports string and array as value\r\n          if (isStr(astTargeting[targetId][key]) || isArray(astTargeting[targetId][key])) {\r\n            const keywordsObj = {};\r\n            const regex = /pt[0-9]/;\r\n            if (key.search(regex) < 0) {\r\n              keywordsObj[key.toUpperCase()] = astTargeting[targetId][key];\r\n            } else {\r\n              // pt${n} keys should not be uppercased\r\n              keywordsObj[key] = astTargeting[targetId][key];\r\n            }\r\n            window.apntag.setKeywords(targetId, keywordsObj, { overrideKeyValue: true });\r\n          }\r\n        })\r\n      );\r\n    },\r\n    isApntagDefined() {\r\n      if (window.apntag && isFn(window.apntag.setKeywords)) {\r\n        return true;\r\n      }\r\n    },\r\n  }\r\n\r\n  function addBidToTargeting(bids, enableSendAllBids = false, deals = false): TargetingArray {\r\n    const standardKeys = TARGETING_KEYS_ARR.slice();\r\n    const allowSendAllBidsTargetingKeys = config.getConfig('targetingControls.allowSendAllBidsTargetingKeys');\r\n\r\n    const allowedSendAllBidTargeting = allowSendAllBidsTargetingKeys\r\n      ? allowSendAllBidsTargetingKeys.map((key) => TARGETING_KEYS[key])\r\n      : standardKeys;\r\n\r\n    return bids.reduce((result, bid) => {\r\n      if (enableSendAllBids || (deals && bid.dealId)) {\r\n        const targetingValue = getTargetingMap(bid, standardKeys.filter(\r\n          key => typeof bid.adserverTargeting[key] !== 'undefined' &&\r\n            (deals || allowedSendAllBidTargeting.indexOf(key) !== -1)));\r\n\r\n        if (targetingValue) {\r\n          result.push({[bid.adUnitCode]: targetingValue})\r\n        }\r\n      }\r\n      return result;\r\n    }, []);\r\n  }\r\n\r\n  function getBidderTargeting(bids) {\r\n    const alwaysIncludeDeals = config.getConfig('targetingControls.alwaysIncludeDeals');\r\n    const enableSendAllBids = config.getConfig('enableSendAllBids');\r\n    return addBidToTargeting(bids, enableSendAllBids, alwaysIncludeDeals);\r\n  }\r\n\r\n  /**\r\n   * Returns filtered ad server targeting for custom and allowed keys.\r\n   * @param targeting\r\n   * @param allowedKeys\r\n   * @return filtered targeting\r\n   */\r\n  function getAllowedTargetingKeyValues(targeting: TargetingArray, allowedKeys: string[]): TargetingArray {\r\n    const defaultKeyring = Object.assign({}, TARGETING_KEYS);\r\n    const defaultKeys = Object.keys(TARGETING_KEYS);\r\n    const keyDispositions = {};\r\n    logInfo(`allowTargetingKeys - allowed keys [ ${allowedKeys.map(k => defaultKeyring[k]).join(', ')} ]`);\r\n    targeting.map(adUnit => {\r\n      const adUnitCode = Object.keys(adUnit)[0];\r\n      const keyring = adUnit[adUnitCode];\r\n      const keys = keyring.filter(kvPair => {\r\n        const key = Object.keys(kvPair)[0];\r\n        // check if key is in default keys, if not, it's custom, we won't remove it.\r\n        const isCustom = defaultKeys.filter(defaultKey => key.indexOf(defaultKeyring[defaultKey]) === 0).length === 0;\r\n        // check if key explicitly allowed, if not, we'll remove it.\r\n        const found = isCustom || allowedKeys.find(allowedKey => {\r\n          const allowedKeyName = defaultKeyring[allowedKey];\r\n          // we're looking to see if the key exactly starts with one of our default keys.\r\n          // (which hopefully means it's not custom)\r\n          const found = key.indexOf(allowedKeyName) === 0;\r\n          return found;\r\n        });\r\n        keyDispositions[key] = !found;\r\n        return found;\r\n      });\r\n      adUnit[adUnitCode] = keys;\r\n    });\r\n    const removedKeys = Object.keys(keyDispositions).filter(d => keyDispositions[d]);\r\n    logInfo(`allowTargetingKeys - removed keys [ ${removedKeys.join(', ')} ]`);\r\n    // remove any empty targeting objects, as they're unnecessary.\r\n    const filteredTargeting = targeting.filter(adUnit => {\r\n      const adUnitCode = Object.keys(adUnit)[0];\r\n      const keyring = adUnit[adUnitCode];\r\n      return keyring.length > 0;\r\n    });\r\n    return filteredTargeting\r\n  }\r\n\r\n  function updatePBTargetingKeys(adUnitCode) {\r\n    (Object.keys(adUnitCode)).forEach(key => {\r\n      adUnitCode[key].forEach(targetKey => {\r\n        const targetKeys = Object.keys(targetKey);\r\n        if (pbTargetingKeys.indexOf(targetKeys[0]) === -1) {\r\n          pbTargetingKeys = targetKeys.concat(pbTargetingKeys);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  function getTargetingLevels(bidsSorted, customKeysByUnit, adUnitCodes) {\r\n    const useAllBidsCustomTargeting = config.getConfig('targetingControls.allBidsCustomTargeting') === true;\r\n\r\n    const targeting = getWinningBidTargeting(bidsSorted, adUnitCodes)\r\n      .concat(getBidderTargeting(bidsSorted))\r\n      .concat(getAdUnitTargeting(adUnitCodes));\r\n\r\n    if (useAllBidsCustomTargeting) {\r\n      targeting.push(...getCustomBidTargeting(bidsSorted, customKeysByUnit))\r\n    }\r\n\r\n    targeting.forEach(adUnitCode => {\r\n      updatePBTargetingKeys(adUnitCode);\r\n    });\r\n\r\n    return targeting;\r\n  }\r\n\r\n  function getfilteredBidsAndCustomKeys(adUnitCodes, bidsReceived) {\r\n    const filteredBids = [];\r\n    const customKeysByUnit = {};\r\n    const alwaysIncludeDeals = config.getConfig('targetingControls.alwaysIncludeDeals');\r\n\r\n    bidsReceived.forEach(bid => {\r\n      const adUnitIsEligible = adUnitCodes.includes(bid.adUnitCode);\r\n      const cpmAllowed = bidderSettings.get(bid.bidderCode, 'allowZeroCpmBids') === true ? bid.cpm >= 0 : bid.cpm > 0;\r\n      const isPreferredDeal = alwaysIncludeDeals && bid.dealId;\r\n\r\n      if (adUnitIsEligible && (isPreferredDeal || cpmAllowed)) {\r\n        filteredBids.push(bid);\r\n        Object.keys(bid.adserverTargeting)\r\n          .filter(getCustomKeys())\r\n          .forEach(key => {\r\n            const truncKey = key.substring(0, MAX_DFP_KEYLENGTH);\r\n            const data = customKeysByUnit[bid.adUnitCode] || {};\r\n            const value = [bid.adserverTargeting[key]];\r\n\r\n            if (data[truncKey]) {\r\n              data[truncKey] = data[truncKey].concat(value).filter(uniques);\r\n            } else {\r\n              data[truncKey] = value;\r\n            }\r\n\r\n            customKeysByUnit[bid.adUnitCode] = data;\r\n          })\r\n      }\r\n    });\r\n\r\n    return {filteredBids, customKeysByUnit};\r\n  }\r\n\r\n  // warn about conflicting configuration\r\n  config.getConfig('targetingControls', function (config) {\r\n    if (deepAccess(config, CFG_ALLOW_TARGETING_KEYS) != null && deepAccess(config, CFG_ADD_TARGETING_KEYS) != null) {\r\n      logError(TARGETING_KEY_CONFIGURATION_ERROR_MSG);\r\n    }\r\n  });\r\n\r\n  // create an encoded string variant based on the keypairs of the provided object\r\n  //  - note this will encode the characters between the keys (ie = and &)\r\n  function convertKeysToQueryForm(keyMap) {\r\n    return Object.keys(keyMap).reduce(function (queryString, key) {\r\n      const encodedKeyPair = `${key}%3d${encodeURIComponent(keyMap[key])}%26`;\r\n      queryString += encodedKeyPair;\r\n      return queryString;\r\n    }, '');\r\n  }\r\n\r\n  function filterTargetingKeys(targeting: ByAdUnit<TargetingValues>, auctionKeysThreshold: number) {\r\n    // read each targeting.adUnit object and sort the adUnits into a list of adUnitCodes based on priorization setting (eg CPM)\r\n    const targetingCopy = deepClone(targeting);\r\n\r\n    const targetingMap = Object.keys(targetingCopy).map(adUnitCode => {\r\n      return {\r\n        adUnitCode,\r\n        adserverTargeting: targetingCopy[adUnitCode]\r\n      };\r\n    }).sort(sortByDealAndPriceBucketOrCpm());\r\n\r\n    // iterate through the targeting based on above list and transform the keys into the query-equivalent and count characters\r\n    return targetingMap.reduce(function (accMap, currMap, index, arr) {\r\n      let adUnitQueryString = convertKeysToQueryForm(currMap.adserverTargeting);\r\n\r\n      // for the last adUnit - trim last encoded ampersand from the converted query string\r\n      if ((index + 1) === arr.length) {\r\n        adUnitQueryString = adUnitQueryString.slice(0, -3);\r\n      }\r\n\r\n      // if under running threshold add to result\r\n      const code = currMap.adUnitCode;\r\n      const querySize = adUnitQueryString.length;\r\n      if (querySize <= auctionKeysThreshold) {\r\n        auctionKeysThreshold -= querySize;\r\n        logInfo(`AdUnit '${code}' auction keys comprised of ${querySize} characters.  Deducted from running threshold; new limit is ${auctionKeysThreshold}`, targetingCopy[code]);\r\n\r\n        accMap[code] = targetingCopy[code];\r\n      } else {\r\n        logWarn(`The following keys for adUnitCode '${code}' exceeded the current limit of the 'auctionKeyMaxChars' setting.\\nThe key-set size was ${querySize}, the current allotted amount was ${auctionKeysThreshold}.\\n`, targetingCopy[code]);\r\n      }\r\n\r\n      if ((index + 1) === arr.length && Object.keys(accMap).length === 0) {\r\n        logError('No auction targeting keys were permitted due to the setting in setConfig(targetingControls.auctionKeyMaxChars).  Please review setup and consider adjusting.');\r\n      }\r\n      return accMap;\r\n    }, {});\r\n  }\r\n\r\n  /**\r\n   * Converts targeting array and flattens to make it easily iteratable\r\n   * e.g: Sample input to this function\r\n   * ```\r\n   * [\r\n   *    {\r\n   *      \"div-gpt-ad-1460505748561-0\": [{\"hb_bidder\": [\"appnexusAst\"]}]\r\n   *    },\r\n   *    {\r\n   *      \"div-gpt-ad-1460505748561-0\": [{\"hb_bidder_appnexusAs\": [\"appnexusAst\", \"other\"]}]\r\n   *    }\r\n   * ]\r\n   * ```\r\n   * Resulting array\r\n   * ```\r\n   * {\r\n   *  \"div-gpt-ad-1460505748561-0\": {\r\n   *    \"hb_bidder\": \"appnexusAst\",\r\n   *    \"hb_bidder_appnexusAs\": \"appnexusAst,other\"\r\n   *  }\r\n   * }\r\n   * ```\r\n   *\r\n   * @param targeting\r\n   * @return targeting\r\n   */\r\n  function flattenTargeting(targeting: TargetingArray): ByAdUnit<TargetingValues> {\r\n    return targeting.map(targeting => {\r\n      return {\r\n        [Object.keys(targeting)[0]]: targeting[Object.keys(targeting)[0]]\r\n          .map(target => {\r\n            return {\r\n              [Object.keys(target)[0]]: target[Object.keys(target)[0]].join(',')\r\n            };\r\n          }).reduce((p, c) => Object.assign(c, p), {})\r\n      };\r\n    }).reduce(function (accumulator, targeting) {\r\n      var key = Object.keys(targeting)[0];\r\n      accumulator[key] = Object.assign({}, accumulator[key], targeting[key]);\r\n      return accumulator;\r\n    }, {});\r\n  }\r\n\r\n  /**\r\n   * normlizes input to a `adUnit.code` array\r\n   * @param  adUnitCode\r\n   * @return AdUnit code array\r\n   */\r\n  function getAdUnitCodes(adUnitCode?: AdUnitCode | AdUnitCode[]): AdUnitCode[] {\r\n    if (typeof adUnitCode === 'string') {\r\n      return [adUnitCode];\r\n    } else if (isArray(adUnitCode)) {\r\n      return adUnitCode;\r\n    }\r\n    return auctionManager.getAdUnitCodes() || [];\r\n  }\r\n\r\n  function getBidsReceived(winReducer = getOldestHighestCpmBid, winSorter = undefined) {\r\n    const bidsReceived = auctionManager.getBidsReceived().reduce((bids, bid) => {\r\n      const bidCacheEnabled = config.getConfig('useBidCache');\r\n      const filterFunction = config.getConfig('bidCacheFilterFunction');\r\n      const isBidFromLastAuction = latestAuctionForAdUnit[bid.adUnitCode] === bid.auctionId;\r\n      const filterFunctionResult = bidCacheEnabled && !isBidFromLastAuction && typeof filterFunction === 'function' ? !!filterFunction(bid) : true;\r\n      const cacheFilter = bidCacheEnabled || isBidFromLastAuction;\r\n      const bidFilter = cacheFilter && filterFunctionResult;\r\n\r\n      if (bidFilter && bid?.video?.context !== ADPOD && isBidUsable(bid)) {\r\n        bid.latestTargetedAuctionId = latestAuctionForAdUnit[bid.adUnitCode];\r\n        bids.push(bid)\r\n      }\r\n\r\n      return bids;\r\n    }, []);\r\n\r\n    return getHighestCpmBidsFromBidPool(bidsReceived, winReducer, undefined, undefined, winSorter);\r\n  }\r\n\r\n  /**\r\n   * Get targeting key value pairs for winning bid.\r\n   * @param bidsReceived code array\r\n   * @param adUnitCodes code array\r\n   * @return winning bids targeting\r\n   */\r\n  function getWinningBidTargeting(bidsReceived, adUnitCodes): TargetingArray {\r\n    const winners = targeting.getWinningBids(adUnitCodes, bidsReceived);\r\n    const standardKeys = getStandardKeys();\r\n\r\n    return winners.map(winner => {\r\n      return {\r\n        [winner.adUnitCode]: Object.keys(winner.adserverTargeting)\r\n          .filter(key =>\r\n            typeof winner.sendStandardTargeting === 'undefined' ||\r\n            winner.sendStandardTargeting ||\r\n            standardKeys.indexOf(key) === -1)\r\n          .reduce((acc, key) => {\r\n            const targetingValue = [winner.adserverTargeting[key]];\r\n            const targeting = { [key.substring(0, MAX_DFP_KEYLENGTH)]: targetingValue };\r\n            if (key === TARGETING_KEYS.DEAL) {\r\n              const bidderCodeTargetingKey = `${key}_${winner.bidderCode}`.substring(0, MAX_DFP_KEYLENGTH);\r\n              const bidderCodeTargeting = { [bidderCodeTargetingKey]: targetingValue };\r\n              return [...acc, targeting, bidderCodeTargeting];\r\n            }\r\n            return [...acc, targeting];\r\n          }, [])\r\n      };\r\n    });\r\n  }\r\n\r\n  function getStandardKeys() {\r\n    return auctionManager.getStandardBidderAdServerTargeting() // in case using a custom standard key set\r\n      .map(targeting => targeting.key)\r\n      .concat(TARGETING_KEYS_ARR).filter(uniques); // standard keys defined in the library.\r\n  }\r\n\r\n  function getCustomKeys() {\r\n    const standardKeys = getStandardKeys();\r\n    return function(key) {\r\n      return standardKeys.indexOf(key) === -1;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get custom targeting key value pairs for bids.\r\n   * @param {Array<Object>} bidsSorted code array\r\n   * @param {Object} customKeysByUnit code array\r\n   * @return bids with custom targeting defined in bidderSettings\r\n   */\r\n  function getCustomBidTargeting(bidsSorted: Bid[], customKeysByUnit: ByAdUnit<any>): TargetingArray {\r\n    return bidsSorted\r\n      .reduce((acc, bid) => {\r\n        const newBid = Object.assign({}, bid);\r\n        const customKeysForUnit = customKeysByUnit[newBid.adUnitCode];\r\n        const targeting = [];\r\n\r\n        if (customKeysForUnit) {\r\n          Object.keys(customKeysForUnit).forEach(key => {\r\n            if (key && customKeysForUnit[key]) targeting.push({[key]: customKeysForUnit[key]});\r\n          })\r\n        }\r\n\r\n        acc.push({[newBid.adUnitCode]: targeting});\r\n\r\n        return acc;\r\n      }, []);\r\n  }\r\n\r\n  function getTargetingMap(bid: Bid, keys: string[]): TargetingValueLists[] {\r\n    return keys.reduce((targeting, key) => {\r\n      const value = bid.adserverTargeting[key];\r\n      if (value) {\r\n        targeting.push({[`${key}_${bid.bidderCode}`.substring(0, MAX_DFP_KEYLENGTH)]: [bid.adserverTargeting[key]]})\r\n      }\r\n      return targeting;\r\n    }, []);\r\n  }\r\n\r\n  function getAdUnitTargeting(adUnitCodes) {\r\n    function getTargetingObj(adUnit) {\r\n      return adUnit?.[JSON_MAPPING.ADSERVER_TARGETING];\r\n    }\r\n\r\n    function getTargetingValues(adUnit) {\r\n      const aut = getTargetingObj(adUnit);\r\n\r\n      return Object.keys(aut)\r\n        .map(function(key) {\r\n          if (isStr(aut[key])) aut[key] = aut[key].split(',').map(s => s.trim());\r\n          if (!isArray(aut[key])) aut[key] = [ aut[key] ];\r\n          return { [key]: aut[key] };\r\n        });\r\n    }\r\n\r\n    return auctionManager.getAdUnits()\r\n      .filter(adUnit => adUnitCodes.includes(adUnit.code) && getTargetingObj(adUnit))\r\n      .reduce((result, adUnit) => {\r\n        const targetingValues = getTargetingValues(adUnit);\r\n\r\n        if (targetingValues)result.push({[adUnit.code]: targetingValues});\r\n        return result;\r\n      }, []);\r\n  }\r\n\r\n  return targeting;\r\n}\r\n\r\nexport const targeting = newTargeting(auctionManager);\r\n","import {\r\n  deepClone, isPlainObject, logError, shuffle, logMessage, triggerPixel, insertUserSyncIframe, isArray,\r\n  logWarn, isStr, isSafariBrowser\r\n} from './utils.js';\r\nimport { config } from './config.js';\r\n\r\nimport { getCoreStorageManager } from './storageManager.js';\r\nimport {isActivityAllowed, registerActivityControl} from './activities/rules.js';\r\nimport {ACTIVITY_SYNC_USER} from './activities/activities.js';\r\nimport {\r\n  ACTIVITY_PARAM_COMPONENT_NAME,\r\n  ACTIVITY_PARAM_COMPONENT_TYPE,\r\n  ACTIVITY_PARAM_SYNC_TYPE, ACTIVITY_PARAM_SYNC_URL\r\n} from './activities/params.js';\r\nimport {MODULE_TYPE_BIDDER} from './activities/modules.js';\r\nimport {activityParams} from './activities/activityParams.js';\r\nimport type {BidderCode} from \"./types/common.d.ts\";\r\n\r\nexport type SyncType = 'image' | 'iframe';\r\ntype SyncConfig = {\r\n  bidders: '*' | BidderCode[];\r\n  filter: 'include' | 'exclude'\r\n}\r\ntype FilterSettings = {[K in SyncType | 'all']?: SyncConfig};\r\n\r\nexport interface UserSyncConfig {\r\n  /**\r\n   * Enable/disable the user syncing feature. Default: true.\r\n   */\r\n  syncEnabled?: boolean;\r\n  /**\r\n   * Configure lists of adapters to include or exclude their user syncing based on the pixel type (image/iframe).\r\n   */\r\n  filterSettings?: FilterSettings;\r\n  /**\r\n   * Number of registered syncs allowed per adapter. Default: 5. To allow all, set to 0.\r\n   */\r\n  syncsPerBidder?: number;\r\n  /**\r\n   * Delay in milliseconds for user syncing (both bid adapter user sync pixels and userId module ID providers)\r\n   * after the auction ends. Default: 3000. Ignored by the userId module if auctionDelay > 0.\r\n   */\r\n  syncDelay?: number;\r\n  /**\r\n   * Delay in milliseconds of the auction to retrieve user ids via the userId module before the auction starts.\r\n   * Continues auction once all IDs are retrieved or delay times out. Does not apply to bid adapter user sync pixels. Default: 0.\r\n   */\r\n  auctionDelay?: number;\r\n  /**\r\n   * Enable/disable publisher to trigger user syncs by calling pbjs.triggerUserSyncs(). Default: false.\r\n   */\r\n  enableOverride?: boolean;\r\n  /**\r\n   * Enable/disable registered syncs for aliased adapters. Default: false.\r\n   */\r\n  aliasSyncEnabled?: boolean;\r\n}\r\n\r\nexport const USERSYNC_DEFAULT_CONFIG: UserSyncConfig = {\r\n  syncEnabled: true,\r\n  filterSettings: {\r\n    image: {\r\n      bidders: '*',\r\n      filter: 'include'\r\n    }\r\n  },\r\n  syncsPerBidder: 5,\r\n  syncDelay: 3000,\r\n  auctionDelay: 500\r\n};\r\n\r\n// Set userSync default values\r\nconfig.setDefaults({\r\n  'userSync': deepClone(USERSYNC_DEFAULT_CONFIG)\r\n});\r\n\r\nconst storage = getCoreStorageManager('usersync');\r\n\r\n/**\r\n * Factory function which creates a new UserSyncPool.\r\n *\r\n * @param {} deps Configuration options and dependencies which the\r\n *   UserSync object needs in order to behave properly.\r\n */\r\nexport function newUserSync(deps) {\r\n  const publicApi: any = {};\r\n  // A queue of user syncs for each adapter\r\n  // Let getDefaultQueue() set the defaults\r\n  let queue = getDefaultQueue();\r\n\r\n  // Whether or not user syncs have been trigger on this page load for a specific bidder\r\n  const hasFiredBidder = new Set();\r\n  // How many bids for each adapter\r\n  let numAdapterBids = {};\r\n\r\n  // for now - default both to false in case filterSettings config is absent/misconfigured\r\n  const permittedPixels = {\r\n    image: true,\r\n    iframe: false\r\n  };\r\n\r\n  // Use what is in config by default\r\n  let usConfig = deps.config;\r\n  // Update if it's (re)set\r\n  config.getConfig('userSync', (conf) => {\r\n    // Added this logic for https://github.com/prebid/Prebid.js/issues/4864\r\n    // if userSync.filterSettings does not contain image/all configs, merge in default image config to ensure image pixels are fired\r\n    if (conf.userSync) {\r\n      const fs = conf.userSync.filterSettings;\r\n      if (isPlainObject(fs)) {\r\n        if (!fs.image && !fs.all) {\r\n          conf.userSync.filterSettings.image = {\r\n            bidders: '*',\r\n            filter: 'include'\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    usConfig = Object.assign(usConfig, conf.userSync);\r\n  });\r\n\r\n  deps.regRule(ACTIVITY_SYNC_USER, 'userSync config', (params) => {\r\n    if (!usConfig.syncEnabled) {\r\n      return {allow: false, reason: 'syncs are disabled'}\r\n    }\r\n    if (params[ACTIVITY_PARAM_COMPONENT_TYPE] === MODULE_TYPE_BIDDER) {\r\n      const syncType = params[ACTIVITY_PARAM_SYNC_TYPE];\r\n      const bidder = params[ACTIVITY_PARAM_COMPONENT_NAME];\r\n      if (!publicApi.canBidderRegisterSync(syncType, bidder)) {\r\n        return {allow: false, reason: `${syncType} syncs are not enabled for ${bidder}`}\r\n      }\r\n    }\r\n  });\r\n\r\n  /**\r\n   * @function getDefaultQueue\r\n   * @summary Returns the default empty queue\r\n   * @private\r\n   * @return {object} A queue with no syncs\r\n   */\r\n  function getDefaultQueue() {\r\n    return {\r\n      image: [],\r\n      iframe: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @function fireSyncs\r\n   * @summary Trigger all user syncs in the queue\r\n   * @private\r\n   */\r\n  function fireSyncs() {\r\n    if (!usConfig.syncEnabled || !deps.browserSupportsCookies) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Iframe syncs\r\n      loadIframes();\r\n      // Image pixels\r\n      fireImagePixels();\r\n    } catch (e) {\r\n      return logError('Error firing user syncs', e);\r\n    }\r\n    // Reset the user sync queue\r\n    queue = getDefaultQueue();\r\n  }\r\n\r\n  function forEachFire(queue, fn) {\r\n    // Randomize the order of the pixels before firing\r\n    // This is to avoid giving any bidder who has registered multiple syncs\r\n    // any preferential treatment and balancing them out\r\n    shuffle(queue).forEach(fn);\r\n  }\r\n\r\n  /**\r\n   * @function fireImagePixels\r\n   * @summary Loops through user sync pixels and fires each one\r\n   * @private\r\n   */\r\n  function fireImagePixels() {\r\n    if (!permittedPixels.image) {\r\n      return;\r\n    }\r\n    forEachFire(queue.image, (sync) => {\r\n      const [bidderName, trackingPixelUrl] = sync;\r\n      logMessage(`Invoking image pixel user sync for bidder: ${bidderName}`);\r\n      // Create image object and add the src url\r\n      triggerPixel(trackingPixelUrl);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @function loadIframes\r\n   * @summary Loops through iframe syncs and loads an iframe element into the page\r\n   * @private\r\n   */\r\n  function loadIframes() {\r\n    if (!(permittedPixels.iframe)) {\r\n      return;\r\n    }\r\n\r\n    forEachFire(queue.iframe, (sync) => {\r\n      const [bidderName, iframeUrl] = sync;\r\n      logMessage(`Invoking iframe user sync for bidder: ${bidderName}`);\r\n      // Insert iframe into DOM\r\n      insertUserSyncIframe(iframeUrl);\r\n      // for a bidder, if iframe sync is present then remove image pixel\r\n      removeImagePixelsForBidder(queue, bidderName);\r\n    });\r\n  }\r\n\r\n  function removeImagePixelsForBidder(queue, iframeSyncBidderName) {\r\n    queue.image = queue.image.filter(imageSync => {\r\n      const imageSyncBidderName = imageSync[0];\r\n      return imageSyncBidderName !== iframeSyncBidderName\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @function incrementAdapterBids\r\n   * @summary Increment the count of user syncs queue for the adapter\r\n   * @private\r\n   * @param {object} numAdapterBids The object contain counts for all adapters\r\n   * @param {string} bidder The name of the bidder adding a sync\r\n   * @returns {object} The updated version of numAdapterBids\r\n   */\r\n  function incrementAdapterBids(numAdapterBids, bidder) {\r\n    if (!numAdapterBids[bidder]) {\r\n      numAdapterBids[bidder] = 1;\r\n    } else {\r\n      numAdapterBids[bidder] += 1;\r\n    }\r\n    return numAdapterBids;\r\n  }\r\n\r\n  /**\r\n   * @function registerSync\r\n   * @summary Add sync for this bidder to a queue to be fired later\r\n   * @public\r\n   * @param {string} type The type of the sync including image, iframe\r\n   * @param {string} bidder The name of the adapter. e.g. \"rubicon\"\r\n   * @param {string} url Either the pixel url or iframe url depending on the type\r\n   * @example <caption>Using Image Sync</caption>\r\n   * // registerSync(type, adapter, pixelUrl)\r\n   * userSync.registerSync('image', 'rubicon', 'http://example.com/pixel')\r\n   */\r\n  publicApi.registerSync = (type, bidder, url) => {\r\n    if (hasFiredBidder.has(bidder)) {\r\n      return logMessage(`already fired syncs for \"${bidder}\", ignoring registerSync call`);\r\n    }\r\n    if (!usConfig.syncEnabled || !isArray(queue[type])) {\r\n      return logWarn(`User sync type \"${type}\" not supported`);\r\n    }\r\n    if (!bidder) {\r\n      return logWarn(`Bidder is required for registering sync`);\r\n    }\r\n    if (usConfig.syncsPerBidder !== 0 && Number(numAdapterBids[bidder]) >= usConfig.syncsPerBidder) {\r\n      return logWarn(`Number of user syncs exceeded for \"${bidder}\"`);\r\n    }\r\n\r\n    if (deps.isAllowed(ACTIVITY_SYNC_USER, activityParams(MODULE_TYPE_BIDDER, bidder, {\r\n      [ACTIVITY_PARAM_SYNC_TYPE]: type,\r\n      [ACTIVITY_PARAM_SYNC_URL]: url\r\n    }))) {\r\n      // the bidder's pixel has passed all checks and is allowed to register\r\n      queue[type].push([bidder, url]);\r\n      numAdapterBids = incrementAdapterBids(numAdapterBids, bidder);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Mark a bidder as done with its user syncs - no more will be accepted from them in this session.\r\n   * @param {string} bidderCode\r\n   */\r\n  publicApi.bidderDone = hasFiredBidder.add.bind(hasFiredBidder);\r\n\r\n  /**\r\n   * @function shouldBidderBeBlocked\r\n   * @summary Check filterSettings logic to determine if the bidder should be prevented from registering their userSync tracker\r\n   * @private\r\n   * @param {string} type The type of the sync; either image or iframe\r\n   * @param {string} bidder The name of the adapter. e.g. \"rubicon\"\r\n   * @returns {boolean} true => bidder is not allowed to register; false => bidder can register\r\n   */\r\n  function shouldBidderBeBlocked(type, bidder) {\r\n    const filterConfig = usConfig.filterSettings;\r\n\r\n    // apply the filter check if the config object is there (eg filterSettings.iframe exists) and if the config object is properly setup\r\n    if (isFilterConfigValid(filterConfig, type)) {\r\n      permittedPixels[type] = true;\r\n\r\n      const activeConfig = (filterConfig.all) ? filterConfig.all : filterConfig[type];\r\n      const biddersToFilter = (activeConfig.bidders === '*') ? [bidder] : activeConfig.bidders;\r\n      const filterType = activeConfig.filter || 'include'; // set default if undefined\r\n\r\n      // return true if the bidder is either: not part of the include (ie outside the whitelist) or part of the exclude (ie inside the blacklist)\r\n      const checkForFiltering = {\r\n        'include': (bidders, bidder) => !bidders.includes(bidder),\r\n        'exclude': (bidders, bidder) => bidders.includes(bidder)\r\n      }\r\n      return checkForFiltering[filterType](biddersToFilter, bidder);\r\n    }\r\n    return !permittedPixels[type];\r\n  }\r\n\r\n  /**\r\n   * @function isFilterConfigValid\r\n   * @summary Check if the filterSettings object in the userSync config is setup properly\r\n   * @private\r\n   * @param {object} filterConfig sub-config object taken from filterSettings\r\n   * @param {string} type The type of the sync; either image or iframe\r\n   * @returns {boolean} true => config is setup correctly, false => setup incorrectly or filterConfig[type] is not present\r\n   */\r\n  function isFilterConfigValid(filterConfig, type) {\r\n    if (filterConfig.all && filterConfig[type]) {\r\n      logWarn(`Detected presence of the \"filterSettings.all\" and \"filterSettings.${type}\" in userSync config.  You cannot mix \"all\" with \"iframe/image\" configs; they are mutually exclusive.`);\r\n      return false;\r\n    }\r\n\r\n    const activeConfig = (filterConfig.all) ? filterConfig.all : filterConfig[type];\r\n    const activeConfigName = (filterConfig.all) ? 'all' : type;\r\n\r\n    // if current pixel type isn't part of the config's logic, skip rest of the config checks...\r\n    // we return false to skip subsequent filter checks in shouldBidderBeBlocked() function\r\n    if (!activeConfig) {\r\n      return false;\r\n    }\r\n\r\n    const filterField = activeConfig.filter;\r\n    const biddersField = activeConfig.bidders;\r\n\r\n    if (filterField && filterField !== 'include' && filterField !== 'exclude') {\r\n      logWarn(`UserSync \"filterSettings.${activeConfigName}.filter\" setting '${filterField}' is not a valid option; use either 'include' or 'exclude'.`);\r\n      return false;\r\n    }\r\n\r\n    if (biddersField !== '*' && !(Array.isArray(biddersField) && biddersField.length > 0 && biddersField.every(bidderInList => isStr(bidderInList) && bidderInList !== '*'))) {\r\n      logWarn(`Detected an invalid setup in userSync \"filterSettings.${activeConfigName}.bidders\"; use either '*' (to represent all bidders) or an array of bidders.`);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @function syncUsers\r\n   * @summary Trigger all the user syncs based on publisher-defined timeout\r\n   * @public\r\n   * @param {number} timeout The delay in ms before syncing data - default 0\r\n   */\r\n  publicApi.syncUsers = (timeout = 0) => {\r\n    if (timeout) {\r\n      return setTimeout(fireSyncs, Number(timeout));\r\n    }\r\n    fireSyncs();\r\n  };\r\n\r\n  /**\r\n   * @function triggerUserSyncs\r\n   * @summary A `syncUsers` wrapper for determining if enableOverride has been turned on\r\n   * @public\r\n   */\r\n  publicApi.triggerUserSyncs = () => {\r\n    if (usConfig.enableOverride) {\r\n      publicApi.syncUsers();\r\n    }\r\n  };\r\n\r\n  publicApi.canBidderRegisterSync = (type, bidder) => {\r\n    if (usConfig.filterSettings) {\r\n      if (shouldBidderBeBlocked(type, bidder)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  return publicApi;\r\n}\r\n\r\nexport const userSync = newUserSync(Object.defineProperties({\r\n  config: config.getConfig('userSync'),\r\n  isAllowed: isActivityAllowed,\r\n  regRule: registerActivityControl,\r\n}, {\r\n  browserSupportsCookies: {\r\n    get: function() {\r\n      // call storage lazily to give time for consent data to be available\r\n      return !isSafariBrowser() && storage.cookiesAreEnabled();\r\n    }\r\n  }\r\n}));\r\n\r\n/**\r\n * @typedef {Object} UserSyncConfig\r\n *\r\n * @property {boolean} enableOverride\r\n * @property {boolean} syncEnabled\r\n * @property {number} syncsPerBidder\r\n * @property {string[]} enabledBidders\r\n * @property {Object} filterSettings\r\n */\r\n","import {config} from './config.js';\r\n\r\nimport {EVENTS} from './constants.js';\r\nimport {PbPromise} from './utils/promise.js';\r\nimport deepAccess from 'dlv/index.js';\r\nimport {isArray, isFn, isStr, isPlainObject} from './utils/objects.js';\r\n\r\nexport { deepAccess };\r\nexport { dset as deepSetValue } from 'dset';\r\nexport * from './utils/objects.js'\r\n\r\nconst consoleExists = Boolean(window.console);\r\nconst consoleLogExists = Boolean(consoleExists && window.console.log);\r\nconst consoleInfoExists = Boolean(consoleExists && window.console.info);\r\nconst consoleWarnExists = Boolean(consoleExists && window.console.warn);\r\nconst consoleErrorExists = Boolean(consoleExists && window.console.error);\r\n\r\nlet eventEmitter;\r\nlet windowDimensions;\r\n\r\nexport function _setEventEmitter(emitFn) {\r\n  // called from events.js - this hoop is to avoid circular imports\r\n  eventEmitter = emitFn;\r\n}\r\n\r\nfunction emitEvent(...args) {\r\n  if (eventEmitter != null) {\r\n    eventEmitter(...args);\r\n  }\r\n}\r\n\r\nexport const getWinDimensions = (function() {\r\n  let lastCheckTimestamp;\r\n  const CHECK_INTERVAL_MS = 20;\r\n  return () => {\r\n    if (!windowDimensions || !lastCheckTimestamp || (Date.now() - lastCheckTimestamp > CHECK_INTERVAL_MS)) {\r\n      internal.resetWinDimensions();\r\n      lastCheckTimestamp = Date.now();\r\n    }\r\n    return windowDimensions;\r\n  }\r\n})();\r\n\r\nexport function resetWinDimensions() {\r\n  const top = canAccessWindowTop() ? internal.getWindowTop() : internal.getWindowSelf();\r\n\r\n  windowDimensions = {\r\n    screen: {\r\n      width: top.screen?.width,\r\n      height: top.screen?.height,\r\n      availWidth: top.screen?.availWidth,\r\n      availHeight: top.screen?.availHeight,\r\n      colorDepth: top.screen?.colorDepth,\r\n    },\r\n    innerHeight: top.innerHeight,\r\n    innerWidth: top.innerWidth,\r\n    outerWidth: top.outerWidth,\r\n    outerHeight: top.outerHeight,\r\n    visualViewport: {\r\n      height: top.visualViewport?.height,\r\n      width: top.visualViewport?.width,\r\n    },\r\n    document: {\r\n      documentElement: {\r\n        clientWidth: top.document?.documentElement?.clientWidth,\r\n        clientHeight: top.document?.documentElement?.clientHeight,\r\n        scrollTop: top.document?.documentElement?.scrollTop,\r\n        scrollLeft: top.document?.documentElement?.scrollLeft,\r\n      },\r\n      body: {\r\n        scrollTop: document.body?.scrollTop,\r\n        scrollLeft: document.body?.scrollLeft,\r\n        clientWidth: document.body?.clientWidth,\r\n        clientHeight: document.body?.clientHeight,\r\n      },\r\n    }\r\n  };\r\n}\r\n\r\n// this allows stubbing of utility functions that are used internally by other utility functions\r\nexport const internal = {\r\n  checkCookieSupport,\r\n  createTrackPixelIframeHtml,\r\n  getWindowSelf,\r\n  getWindowTop,\r\n  canAccessWindowTop,\r\n  getWindowLocation,\r\n  insertUserSyncIframe,\r\n  insertElement,\r\n  isFn,\r\n  triggerPixel,\r\n  logError,\r\n  logWarn,\r\n  logMessage,\r\n  logInfo,\r\n  parseQS,\r\n  formatQS,\r\n  deepEqual,\r\n  resetWinDimensions\r\n};\r\n\r\nconst prebidInternal = {};\r\n/**\r\n * Returns object that is used as internal prebid namespace\r\n */\r\nexport function getPrebidInternal() {\r\n  return prebidInternal;\r\n}\r\n\r\n/* utility method to get incremental integer starting from 1 */\r\nvar getIncrementalInteger = (function () {\r\n  var count = 0;\r\n  return function () {\r\n    count++;\r\n    return count;\r\n  };\r\n})();\r\n\r\n// generate a random string (to be used as a dynamic JSONP callback)\r\nexport function getUniqueIdentifierStr() {\r\n  return getIncrementalInteger() + Math.random().toString(16).substr(2);\r\n}\r\n\r\n/**\r\n * Returns a random v4 UUID of the form xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx,\r\n * where each x is replaced with a random hexadecimal digit from 0 to f,\r\n * and y is replaced with a random hexadecimal digit from 8 to b.\r\n * https://gist.github.com/jed/982883 via node-uuid\r\n */\r\nexport function generateUUID(placeholder) {\r\n  return placeholder\r\n    ? (placeholder ^ _getRandomData() >> placeholder / 4).toString(16)\r\n    : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, generateUUID);\r\n}\r\n\r\n/**\r\n * Returns random data using the Crypto API if available and Math.random if not\r\n * Method is from https://gist.github.com/jed/982883 like generateUUID, direct link https://gist.github.com/jed/982883#gistcomment-45104\r\n */\r\nfunction _getRandomData() {\r\n  if (window && window.crypto && window.crypto.getRandomValues) {\r\n    return crypto.getRandomValues(new Uint8Array(1))[0] % 16;\r\n  } else {\r\n    return Math.random() * 16;\r\n  }\r\n}\r\n\r\nexport function getBidIdParameter(key, paramsObj) {\r\n  return paramsObj?.[key] || '';\r\n}\r\n\r\n// parse a query string object passed in bid params\r\n// bid params should be an object such as {key: \"value\", key1 : \"value1\"}\r\n// aliases to formatQS\r\nexport function parseQueryStringParameters(queryObj) {\r\n  let result = '';\r\n  for (var k in queryObj) {\r\n    if (queryObj.hasOwnProperty(k)) { result += k + '=' + encodeURIComponent(queryObj[k]) + '&'; }\r\n  }\r\n  result = result.replace(/&$/, '');\r\n  return result;\r\n}\r\n\r\n// transform an AdServer targeting bids into a query string to send to the adserver\r\nexport function transformAdServerTargetingObj(targeting) {\r\n  // we expect to receive targeting for a single slot at a time\r\n  if (targeting && Object.getOwnPropertyNames(targeting).length > 0) {\r\n    return Object.keys(targeting)\r\n      .map(key => `${key}=${encodeURIComponent(targeting[key])}`).join('&');\r\n  } else {\r\n    return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Parse a GPT-Style general size Array like `[[300, 250]]` or `\"300x250,970x90\"` into an array of width, height tuples `[[300, 250]]` or '[[300,250], [970,90]]'\r\n */\r\nexport function sizesToSizeTuples(sizes) {\r\n  if (typeof sizes === 'string') {\r\n    // multiple sizes will be comma-separated\r\n    return sizes\r\n      .split(/\\s*,\\s*/)\r\n      .map(sz => sz.match(/^(\\d+)x(\\d+)$/i))\r\n      .filter(match => match)\r\n      .map(([_, w, h]) => [parseInt(w, 10), parseInt(h, 10)])\r\n  } else if (Array.isArray(sizes)) {\r\n    if (isValidGPTSingleSize(sizes)) {\r\n      return [sizes]\r\n    }\r\n    return sizes.filter(isValidGPTSingleSize);\r\n  }\r\n  return [];\r\n}\r\n\r\n/**\r\n * Parse a GPT-Style general size Array like `[[300, 250]]` or `\"300x250,970x90\"` into an array of sizes `[\"300x250\"]` or '['300x250', '970x90']'\r\n * @param  {(Array.<number[]>|Array.<number>)} sizeObj Input array or double array [300,250] or [[300,250], [728,90]]\r\n * @return {Array.<string>}  Array of strings like `[\"300x250\"]` or `[\"300x250\", \"728x90\"]`\r\n */\r\nexport function parseSizesInput(sizeObj) {\r\n  return sizesToSizeTuples(sizeObj).map(sizeTupleToSizeString);\r\n}\r\n\r\nexport function sizeTupleToSizeString(size) {\r\n  return size[0] + 'x' + size[1]\r\n}\r\n\r\n// Parse a GPT style single size array, (i.e [300, 250])\r\n// into an AppNexus style string, (i.e. 300x250)\r\nexport function parseGPTSingleSizeArray(singleSize) {\r\n  if (isValidGPTSingleSize(singleSize)) {\r\n    return sizeTupleToSizeString(singleSize);\r\n  }\r\n}\r\n\r\nexport function sizeTupleToRtbSize(size) {\r\n  return {w: size[0], h: size[1]};\r\n}\r\n\r\n// Parse a GPT style single size array, (i.e [300, 250])\r\n// into OpenRTB-compatible (imp.banner.w/h, imp.banner.format.w/h, imp.video.w/h) object(i.e. {w:300, h:250})\r\nexport function parseGPTSingleSizeArrayToRtbSize(singleSize) {\r\n  if (isValidGPTSingleSize(singleSize)) {\r\n    return sizeTupleToRtbSize(singleSize)\r\n  }\r\n}\r\n\r\nfunction isValidGPTSingleSize(singleSize) {\r\n  // if we aren't exactly 2 items in this array, it is invalid\r\n  return isArray(singleSize) && singleSize.length === 2 && (!isNaN(singleSize[0]) && !isNaN(singleSize[1]));\r\n}\r\n\r\nexport function getWindowTop() {\r\n  return window.top;\r\n}\r\n\r\nexport function getWindowSelf() {\r\n  return window.self;\r\n}\r\n\r\nexport function getWindowLocation() {\r\n  return window.location;\r\n}\r\n\r\nexport function getDocument() {\r\n  return document;\r\n}\r\n\r\nexport function canAccessWindowTop() {\r\n  try {\r\n    if (internal.getWindowTop().location.href) {\r\n      return true;\r\n    }\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\r\n */\r\n// eslint-disable-next-line no-restricted-syntax\r\nexport function logMessage() {\r\n  if (debugTurnedOn() && consoleLogExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line no-restricted-syntax\r\nexport function logInfo() {\r\n  if (debugTurnedOn() && consoleInfoExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line no-restricted-syntax\r\nexport function logWarn() {\r\n  if (debugTurnedOn() && consoleWarnExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\r\n  }\r\n  emitEvent(EVENTS.AUCTION_DEBUG, { type: 'WARNING', arguments: arguments });\r\n}\r\n\r\n// eslint-disable-next-line no-restricted-syntax\r\nexport function logError() {\r\n  if (debugTurnedOn() && consoleErrorExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\r\n  }\r\n  emitEvent(EVENTS.AUCTION_DEBUG, { type: 'ERROR', arguments: arguments });\r\n}\r\n\r\nexport function prefixLog(prefix) {\r\n  function decorate(fn) {\r\n    return function (...args) {\r\n      fn(prefix, ...args);\r\n    }\r\n  }\r\n  return {\r\n    logError: decorate(logError),\r\n    logWarn: decorate(logWarn),\r\n    logMessage: decorate(logMessage),\r\n    logInfo: decorate(logInfo),\r\n  }\r\n}\r\n\r\nfunction decorateLog(args, prefix) {\r\n  args = [].slice.call(args);\r\n  const bidder = config.getCurrentBidder();\r\n\r\n  prefix && args.unshift(prefix);\r\n  if (bidder) {\r\n    args.unshift(label('#aaa'));\r\n  }\r\n  args.unshift(label('#3b88c3'));\r\n  args.unshift('%cPrebid' + (bidder ? `%c${bidder}` : ''));\r\n  return args;\r\n\r\n  function label(color) {\r\n    return `display: inline-block; color: #fff; background: ${color}; padding: 1px 4px; border-radius: 3px;`\r\n  }\r\n}\r\n\r\nexport function hasConsoleLogger() {\r\n  return consoleLogExists;\r\n}\r\n\r\nexport function debugTurnedOn() {\r\n  return !!config.getConfig('debug');\r\n}\r\n\r\nexport const createIframe = (() => {\r\n  const DEFAULTS = {\r\n    border: '0px',\r\n    hspace: '0',\r\n    vspace: '0',\r\n    marginWidth: '0',\r\n    marginHeight: '0',\r\n    scrolling: 'no',\r\n    frameBorder: '0',\r\n    allowtransparency: 'true'\r\n  }\r\n  return (doc, attrs, style = {}) => {\r\n    const f = doc.createElement('iframe');\r\n    Object.assign(f, Object.assign({}, DEFAULTS, attrs));\r\n    Object.assign(f.style, style);\r\n    return f;\r\n  }\r\n})();\r\n\r\nexport function createInvisibleIframe() {\r\n  return createIframe(document, {\r\n    id: getUniqueIdentifierStr(),\r\n    width: 0,\r\n    height: 0,\r\n    src: 'about:blank'\r\n  }, {\r\n    display: 'none',\r\n    height: '0px',\r\n    width: '0px',\r\n    border: '0px'\r\n  });\r\n}\r\n\r\n/*\r\n *   Check if a given parameter name exists in query string\r\n *   and if it does return the value\r\n */\r\nexport function getParameterByName(name) {\r\n  return parseQS(getWindowLocation().search)[name] || '';\r\n}\r\n\r\n/**\r\n * Return if the object is \"empty\";\r\n * this includes falsey, no keys, or no items at indices\r\n * @param {*} object object to test\r\n * @return {Boolean} if object is empty\r\n */\r\nexport function isEmpty(object) {\r\n  if (!object) return true;\r\n  if (isArray(object) || isStr(object)) {\r\n    return !(object.length > 0);\r\n  }\r\n  return Object.keys(object).length <= 0;\r\n}\r\n\r\n/**\r\n * Return if string is empty, null, or undefined\r\n * @param str string to test\r\n * @returns {boolean} if string is empty\r\n */\r\nexport function isEmptyStr(str) {\r\n  return isStr(str) && (!str || str.length === 0);\r\n}\r\n\r\n/**\r\n * Iterate object with the function\r\n * falls back to es5 `forEach`\r\n * @param {Array|Object} object\r\n * @param {Function} fn - The function to execute for each element. It receives three arguments: value, key, and the original object.\r\n * @returns {void}\r\n */\r\nexport function _each(object, fn) {\r\n  if (isFn(object?.forEach)) return object.forEach(fn, this);\r\n  Object.entries(object || {}).forEach(([k, v]) => fn.call(this, v, k));\r\n}\r\n\r\nexport function contains(a, obj) {\r\n  return isFn(a?.includes) && a.includes(obj);\r\n}\r\n\r\n/**\r\n * Map an array or object into another array\r\n * given a function\r\n * @param {Array|Object} object\r\n * @param {Function} callback - The function to execute for each element. It receives three arguments: value, key, and the original object.\r\n * @return {Array}\r\n */\r\nexport function _map(object, callback) {\r\n  if (isFn(object?.map)) return object.map(callback);\r\n  return Object.entries(object || {}).map(([k, v]) => callback(v, k, object))\r\n}\r\n\r\n/*\r\n* Inserts an element(elm) as targets child, by default as first child\r\n* @param {HTMLElement} elm\r\n* @param {HTMLElement} [doc]\r\n* @param {HTMLElement} [target]\r\n* @param {Boolean} [asLastChildChild]\r\n* @return {HTML Element}\r\n*/\r\nexport function insertElement(elm, doc, target, asLastChildChild) {\r\n  doc = doc || document;\r\n  let parentEl;\r\n  if (target) {\r\n    parentEl = doc.getElementsByTagName(target);\r\n  } else {\r\n    parentEl = doc.getElementsByTagName('head');\r\n  }\r\n  try {\r\n    parentEl = parentEl.length ? parentEl : doc.getElementsByTagName('body');\r\n    if (parentEl.length) {\r\n      parentEl = parentEl[0];\r\n      const insertBeforeEl = asLastChildChild ? null : parentEl.firstChild;\r\n      return parentEl.insertBefore(elm, insertBeforeEl);\r\n    }\r\n  } catch (e) {}\r\n}\r\n\r\n/**\r\n * Returns a promise that completes when the given element triggers a 'load' or 'error' DOM event, or when\r\n * `timeout` milliseconds have elapsed.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Number} [timeout]\r\n * @returns {Promise}\r\n */\r\nexport function waitForElementToLoad(element, timeout) {\r\n  let timer = null;\r\n  return new PbPromise((resolve) => {\r\n    const onLoad = function() {\r\n      element.removeEventListener('load', onLoad);\r\n      element.removeEventListener('error', onLoad);\r\n      if (timer != null) {\r\n        window.clearTimeout(timer);\r\n      }\r\n      resolve();\r\n    };\r\n    element.addEventListener('load', onLoad);\r\n    element.addEventListener('error', onLoad);\r\n    if (timeout != null) {\r\n      timer = window.setTimeout(onLoad, timeout);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Inserts an image pixel with the specified `url` for cookie sync\r\n * @param {string} url URL string of the image pixel to load\r\n * @param  {function} [done] an optional exit callback, used when this usersync pixel is added during an async process\r\n * @param  {Number} [timeout] an optional timeout in milliseconds for the image to load before calling `done`\r\n */\r\nexport function triggerPixel(url, done, timeout) {\r\n  const img = new Image();\r\n  if (done && internal.isFn(done)) {\r\n    waitForElementToLoad(img, timeout).then(done);\r\n  }\r\n  img.src = url;\r\n}\r\n\r\n/**\r\n * Inserts an empty iframe with the specified `html`, primarily used for tracking purposes\r\n * (though could be for other purposes)\r\n * @param {string} htmlCode snippet of HTML code used for tracking purposes\r\n */\r\nexport function insertHtmlIntoIframe(htmlCode) {\r\n  if (!htmlCode) {\r\n    return;\r\n  }\r\n  const iframe = createInvisibleIframe();\r\n  internal.insertElement(iframe, document, 'body');\r\n\r\n  ((doc) => {\r\n    doc.open();\r\n    doc.write(htmlCode);\r\n    doc.close();\r\n  })(iframe.contentWindow.document);\r\n}\r\n\r\n/**\r\n * Inserts empty iframe with the specified `url` for cookie sync\r\n * @param  {string} url URL to be requested\r\n * @param  {function} [done] an optional exit callback, used when this usersync pixel is added during an async process\r\n * @param  {Number} [timeout] an optional timeout in milliseconds for the iframe to load before calling `done`\r\n */\r\nexport function insertUserSyncIframe(url, done, timeout) {\r\n  const iframeHtml = internal.createTrackPixelIframeHtml(url, false, 'allow-scripts allow-same-origin');\r\n  const div = document.createElement('div');\r\n  div.innerHTML = iframeHtml;\r\n  const iframe = div.firstChild;\r\n  if (done && internal.isFn(done)) {\r\n    waitForElementToLoad(iframe, timeout).then(done);\r\n  }\r\n  internal.insertElement(iframe, document, 'html', true);\r\n}\r\n\r\n/**\r\n * Creates a snippet of HTML that retrieves the specified `url`\r\n * @param  {string} url URL to be requested\r\n * @param encode\r\n * @return {string}     HTML snippet that contains the img src = set to `url`\r\n */\r\nexport function createTrackPixelHtml(url, encode = encodeURI) {\r\n  if (!url) {\r\n    return '';\r\n  }\r\n\r\n  const escapedUrl = encode(url);\r\n  let img = '<div style=\"position:absolute;left:0px;top:0px;visibility:hidden;\">';\r\n  img += '<img src=\"' + escapedUrl + '\"></div>';\r\n  return img;\r\n};\r\n\r\n/**\r\n * encodeURI, but preserves macros of the form '${MACRO}' (e.g. '${AUCTION_PRICE}')\r\n * @param url\r\n * @return {string}\r\n */\r\nexport function encodeMacroURI(url) {\r\n  const macros = Array.from(url.matchAll(/\\$({[^}]+})/g)).map(match => match[1]);\r\n  return macros.reduce((str, macro) => {\r\n    return str.replace('$' + encodeURIComponent(macro), '$' + macro)\r\n  }, encodeURI(url))\r\n}\r\n\r\n/**\r\n * Creates a snippet of Iframe HTML that retrieves the specified `url`\r\n * @param  {string} url plain URL to be requested\r\n * @param  {string} encodeUri boolean if URL should be encoded before inserted. Defaults to true\r\n * @param  {string} sandbox string if provided the sandbox attribute will be included with the given value\r\n * @return {string}     HTML snippet that contains the iframe src = set to `url`\r\n */\r\nexport function createTrackPixelIframeHtml(url, encodeUri = true, sandbox = '') {\r\n  if (!url) {\r\n    return '';\r\n  }\r\n  if (encodeUri) {\r\n    url = encodeURI(url);\r\n  }\r\n  if (sandbox) {\r\n    sandbox = `sandbox=\"${sandbox}\"`;\r\n  }\r\n\r\n  return `<iframe ${sandbox} id=\"${getUniqueIdentifierStr()}\"\r\n      frameborder=\"0\"\r\n      allowtransparency=\"true\"\r\n      marginheight=\"0\" marginwidth=\"0\"\r\n      width=\"0\" hspace=\"0\" vspace=\"0\" height=\"0\"\r\n      style=\"height:0px;width:0px;display:none;\"\r\n      scrolling=\"no\"\r\n      src=\"${url}\">\r\n    </iframe>`;\r\n}\r\n\r\nexport function uniques(value, index, arry) {\r\n  return arry.indexOf(value) === index;\r\n}\r\n\r\nexport function flatten(a, b) {\r\n  return a.concat(b);\r\n}\r\n\r\nexport function getBidRequest(id, bidderRequests) {\r\n  if (!id) {\r\n    return;\r\n  }\r\n  return bidderRequests.flatMap(br => br.bids)\r\n    .find(bid => ['bidId', 'adId', 'bid_id'].some(prop => bid[prop] === id))\r\n}\r\n\r\nexport function getValue(obj, key) {\r\n  return obj[key];\r\n}\r\n\r\nexport function getBidderCodes(adUnits) {\r\n  // this could memoize adUnits\r\n  return adUnits.map(unit => unit.bids.map(bid => bid.bidder)\r\n    .reduce(flatten, [])).reduce(flatten, []).filter((bidder) => typeof bidder !== 'undefined').filter(uniques);\r\n}\r\n\r\nexport function isGptPubadsDefined() {\r\n  if (window.googletag && isFn(window.googletag.pubads) && isFn(window.googletag.pubads().getSlots)) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function isApnGetTagDefined() {\r\n  if (window.apntag && isFn(window.apntag.getTag)) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport const sortByHighestCpm = (a, b) => {\r\n  return b.cpm - a.cpm;\r\n}\r\n\r\n/**\r\n * Fisher–Yates shuffle\r\n * http://stackoverflow.com/a/6274398\r\n * https://bost.ocks.org/mike/shuffle/\r\n * istanbul ignore next\r\n */\r\nexport function shuffle(array) {\r\n  let counter = array.length;\r\n\r\n  // while there are elements in the array\r\n  while (counter > 0) {\r\n    // pick a random index\r\n    const index = Math.floor(Math.random() * counter);\r\n\r\n    // decrease counter by 1\r\n    counter--;\r\n\r\n    // and swap the last element with it\r\n    const temp = array[counter];\r\n    array[counter] = array[index];\r\n    array[index] = temp;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\nexport function inIframe() {\r\n  try {\r\n    return internal.getWindowSelf() !== internal.getWindowTop();\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * https://iabtechlab.com/wp-content/uploads/2016/03/SafeFrames_v1.1_final.pdf\r\n */\r\nexport function isSafeFrameWindow() {\r\n  if (!inIframe()) {\r\n    return false;\r\n  }\r\n\r\n  const ws = internal.getWindowSelf();\r\n  return !!(ws.$sf && ws.$sf.ext);\r\n}\r\n\r\n/**\r\n * Returns the result of calling the function $sf.ext.geom() if it exists\r\n * @see https://iabtechlab.com/wp-content/uploads/2016/03/SafeFrames_v1.1_final.pdf — 5.4 Function $sf.ext.geom\r\n * @returns {Object | undefined} geometric information about the container\r\n */\r\nexport function getSafeframeGeometry() {\r\n  try {\r\n    const ws = getWindowSelf();\r\n    return (typeof ws.$sf.ext.geom === 'function') ? ws.$sf.ext.geom() : undefined;\r\n  } catch (e) {\r\n    logError('Error getting SafeFrame geometry', e);\r\n    return undefined;\r\n  }\r\n}\r\n\r\nexport function isSafariBrowser() {\r\n  return /^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function replaceMacros(str, subs) {\r\n  if (!str) return;\r\n  return Object.entries(subs).reduce((str, [key, val]) => {\r\n    return str.replace(new RegExp('\\\\$\\\\{' + key + '\\\\}', 'g'), val || '');\r\n  }, str);\r\n}\r\n\r\nexport function replaceAuctionPrice(str, cpm) {\r\n  return replaceMacros(str, {AUCTION_PRICE: cpm})\r\n}\r\n\r\nexport function replaceClickThrough(str, clicktag) {\r\n  if (!str || !clicktag || typeof clicktag !== 'string') return;\r\n  return str.replace(/\\${CLICKTHROUGH}/g, clicktag);\r\n}\r\n\r\nexport function timestamp() {\r\n  return new Date().getTime();\r\n}\r\n\r\n/**\r\n * The returned value represents the time elapsed since the time origin. @see https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\r\n * @returns {number}\r\n */\r\nexport function getPerformanceNow() {\r\n  return (window.performance && window.performance.now && window.performance.now()) || 0;\r\n}\r\n\r\n/**\r\n * Retuns the difference between `timing.domLoading` and `timing.navigationStart`.\r\n * This function uses the deprecated `Performance.timing` API and should be removed in future.\r\n * It has not been updated yet because it is still used in some modules.\r\n * @deprecated\r\n * @param {Window} w The window object used to perform the api call. default to window.self\r\n * @returns {number}\r\n */\r\nexport function getDomLoadingDuration(w) {\r\n  let domLoadingDuration = -1;\r\n\r\n  w = w || getWindowSelf();\r\n\r\n  const performance = w.performance;\r\n\r\n  if (w.performance?.timing) {\r\n    if (w.performance.timing.navigationStart > 0) {\r\n      const val = performance.timing.domLoading - performance.timing.navigationStart;\r\n      if (val > 0) {\r\n        domLoadingDuration = val;\r\n      }\r\n    }\r\n  }\r\n\r\n  return domLoadingDuration;\r\n}\r\n\r\n/**\r\n * When the deviceAccess flag config option is false, no cookies should be read or set\r\n * @returns {boolean}\r\n */\r\nexport function hasDeviceAccess() {\r\n  return config.getConfig('deviceAccess') !== false;\r\n}\r\n\r\n/**\r\n * @returns {(boolean|undefined)}\r\n */\r\nexport function checkCookieSupport() {\r\n  // eslint-disable-next-line no-restricted-properties\r\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Given a function, return a function which only executes the original after\r\n * it's been called numRequiredCalls times.\r\n *\r\n * Note that the arguments from the previous calls will *not* be forwarded to the original function.\r\n * Only the final call's arguments matter.\r\n *\r\n * @param {function} func The function which should be executed, once the returned function has been executed\r\n *   numRequiredCalls times.\r\n * @param {number} numRequiredCalls The number of times which the returned function needs to be called before\r\n *   func is.\r\n */\r\nexport function delayExecution(func, numRequiredCalls) {\r\n  if (numRequiredCalls < 1) {\r\n    throw new Error(`numRequiredCalls must be a positive number. Got ${numRequiredCalls}`);\r\n  }\r\n  let numCalls = 0;\r\n  return function () {\r\n    numCalls++;\r\n    if (numCalls === numRequiredCalls) {\r\n      func.apply(this, arguments);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * https://stackoverflow.com/a/34890276/428704\r\n * @param {Array} xs\r\n * @param {string} key\r\n * @returns {Object} {${key_value}: ${groupByArray}, key_value: {groupByArray}}\r\n */\r\nexport function groupBy(xs, key) {\r\n  return xs.reduce(function(rv, x) {\r\n    (rv[x[key]] = rv[x[key]] || []).push(x);\r\n    return rv;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Validates an adunit's `mediaTypes` parameter\r\n * @param mediaTypes mediaTypes parameter to validate\r\n * @return If object is valid\r\n */\r\nexport function isValidMediaTypes(mediaTypes) {\r\n  const SUPPORTED_MEDIA_TYPES = ['banner', 'native', 'video'];\r\n  const SUPPORTED_STREAM_TYPES = ['instream', 'outstream', 'adpod'];\r\n\r\n  const types = Object.keys(mediaTypes);\r\n\r\n  if (!types.every(type => SUPPORTED_MEDIA_TYPES.includes(type))) {\r\n    return false;\r\n  }\r\n\r\n  if (FEATURES.VIDEO && mediaTypes.video && mediaTypes.video.context) {\r\n    return SUPPORTED_STREAM_TYPES.includes(mediaTypes.video.context);\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Returns user configured bidder params from adunit\r\n * @param {Object} adUnits\r\n * @param {string} adUnitCode code\r\n * @param {string} bidder code\r\n * @return {Array} user configured param for the given bidder adunit configuration\r\n */\r\nexport function getUserConfiguredParams(adUnits, adUnitCode, bidder) {\r\n  return adUnits\r\n    .filter(adUnit => adUnit.code === adUnitCode)\r\n    .flatMap((adUnit) => adUnit.bids)\r\n    .filter((bidderData) => bidderData.bidder === bidder)\r\n    .map((bidderData) => bidderData.params || {});\r\n}\r\n\r\n/**\r\n * Returns Do Not Track state\r\n */\r\nexport function getDNT() {\r\n  return navigator.doNotTrack === '1' || window.doNotTrack === '1' || navigator.msDoNotTrack === '1' || navigator.doNotTrack === 'yes';\r\n}\r\n\r\nexport const compareCodeAndSlot = (slot, adUnitCode) => slot.getAdUnitPath() === adUnitCode || slot.getSlotElementId() === adUnitCode;\r\n\r\n/**\r\n * Returns filter function to match adUnitCode in slot\r\n * @param slot GoogleTag slot\r\n * @return filter function\r\n */\r\nexport function isAdUnitCodeMatchingSlot(slot) {\r\n  return (adUnitCode) => compareCodeAndSlot(slot, adUnitCode);\r\n}\r\n\r\n/**\r\n * Constructs warning message for when unsupported bidders are dropped from an adunit\r\n * @param {Object} adUnit ad unit from which the bidder is being dropped\r\n * @param {string} bidder bidder code that is not compatible with the adUnit\r\n * @return {string} warning message to display when condition is met\r\n */\r\nexport function unsupportedBidderMessage(adUnit, bidder) {\r\n  const mediaType = Object.keys(adUnit.mediaTypes || {'banner': 'banner'}).join(', ');\r\n\r\n  return `\r\n    ${adUnit.code} is a ${mediaType} ad unit\r\n    containing bidders that don't support ${mediaType}: ${bidder}.\r\n    This bidder won't fetch demand.\r\n  `;\r\n}\r\n\r\n/**\r\n * Returns a new object with undefined properties removed from given object\r\n * @param obj the object to clean\r\n */\r\nexport function cleanObj(obj) {\r\n  return Object.fromEntries(Object.entries(obj).filter(([_, v]) => typeof v !== 'undefined'))\r\n}\r\n\r\n/**\r\n * Create a new object with selected properties.  Also allows property renaming and transform functions.\r\n * @param obj the original object\r\n * @param properties An array of desired properties\r\n */\r\nexport function pick(obj, properties) {\r\n  if (typeof obj !== 'object') {\r\n    return {};\r\n  }\r\n  return properties.reduce((newObj, prop, i) => {\r\n    if (typeof prop === 'function') {\r\n      return newObj;\r\n    }\r\n\r\n    let newProp = prop;\r\n    const match = prop.match(/^(.+?)\\sas\\s(.+?)$/i);\r\n\r\n    if (match) {\r\n      prop = match[1];\r\n      newProp = match[2];\r\n    }\r\n\r\n    let value = obj[prop];\r\n    if (typeof properties[i + 1] === 'function') {\r\n      value = properties[i + 1](value, newObj);\r\n    }\r\n    if (typeof value !== 'undefined') {\r\n      newObj[newProp] = value;\r\n    }\r\n\r\n    return newObj;\r\n  }, {});\r\n}\r\n\r\nexport function parseQS(query) {\r\n  return !query ? {} : query\r\n    .replace(/^\\?/, '')\r\n    .split('&')\r\n    .reduce((acc, criteria) => {\r\n      let [k, v] = criteria.split('=');\r\n      if (/\\[\\]$/.test(k)) {\r\n        k = k.replace('[]', '');\r\n        acc[k] = acc[k] || [];\r\n        acc[k].push(v);\r\n      } else {\r\n        acc[k] = v || '';\r\n      }\r\n      return acc;\r\n    }, {});\r\n}\r\n\r\nexport function formatQS(query) {\r\n  return Object\r\n    .keys(query)\r\n    .map(k => Array.isArray(query[k])\r\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\r\n      : `${k}=${query[k]}`)\r\n    .join('&');\r\n}\r\n\r\nexport function parseUrl(url, options) {\r\n  const parsed = document.createElement('a');\r\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\r\n    parsed.href = url;\r\n  } else {\r\n    parsed.href = decodeURIComponent(url);\r\n  }\r\n  // in window.location 'search' is string, not object\r\n  const qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\r\n  return {\r\n    href: parsed.href,\r\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\r\n    hostname: parsed.hostname,\r\n    port: +parsed.port,\r\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\r\n    search: (qsAsString) ? parsed.search : internal.parseQS(parsed.search || ''),\r\n    hash: (parsed.hash || '').replace(/^#/, ''),\r\n    host: parsed.host || window.location.host\r\n  };\r\n}\r\n\r\nexport function buildUrl(obj) {\r\n  return (obj.protocol || 'http') + '://' +\r\n    (obj.host ||\r\n      obj.hostname + (obj.port ? `:${obj.port}` : '')) +\r\n    (obj.pathname || '') +\r\n    (obj.search ? `?${internal.formatQS(obj.search || '')}` : '') +\r\n    (obj.hash ? `#${obj.hash}` : '');\r\n}\r\n\r\n/**\r\n * This function deeply compares two objects checking for their equivalence.\r\n * @param {Object} obj1\r\n * @param {Object} obj2\r\n * @param {Object} [options] - Options for comparison.\r\n * @param {boolean} [options.checkTypes=false] - If set, two objects with identical properties but different constructors will *not* be considered equivalent.\r\n * @returns {boolean} - Returns `true` if the objects are equivalent, `false` otherwise.\r\n */\r\nexport function deepEqual(obj1, obj2, { checkTypes = false } = {}) {\r\n  // Quick reference check\r\n  if (obj1 === obj2) return true;\r\n\r\n  // If either is null or not an object, do a direct equality check\r\n  if (\r\n    typeof obj1 !== 'object' || obj1 === null ||\r\n    typeof obj2 !== 'object' || obj2 === null\r\n  ) {\r\n    return false;\r\n  }\r\n  // Cache the Array checks\r\n  const isArr1 = Array.isArray(obj1);\r\n  const isArr2 = Array.isArray(obj2);\r\n  // Special case: both are arrays\r\n  if (isArr1 && isArr2) {\r\n    if (obj1.length !== obj2.length) return false;\r\n    for (let i = 0; i < obj1.length; i++) {\r\n      if (!deepEqual(obj1[i], obj2[i], { checkTypes })) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  } else if (isArr1 || isArr2) {\r\n    return false;\r\n  }\r\n\r\n  // If we’re checking types, compare constructors (e.g., plain object vs. Date)\r\n  if (checkTypes && obj1.constructor !== obj2.constructor) {\r\n    return false;\r\n  }\r\n\r\n  // Compare object keys. Cache keys for both to avoid repeated calls.\r\n  const keys1 = Object.keys(obj1);\r\n  const keys2 = Object.keys(obj2);\r\n\r\n  if (keys1.length !== keys2.length) return false;\r\n\r\n  for (const key of keys1) {\r\n    // If `obj2` doesn't have this key or sub-values aren't equal, bail out.\r\n    if (!Object.prototype.hasOwnProperty.call(obj2, key)) {\r\n      return false;\r\n    }\r\n    if (!deepEqual(obj1[key], obj2[key], { checkTypes })) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function mergeDeep(target, ...sources) {\r\n  for (let i = 0; i < sources.length; i++) {\r\n    const source = sources[i];\r\n    if (!isPlainObject(source)) {\r\n      continue;\r\n    }\r\n    mergeDeepHelper(target, source);\r\n  }\r\n  return target;\r\n}\r\n\r\nfunction mergeDeepHelper(target, source) {\r\n  // quick check\r\n  if (!isPlainObject(target) || !isPlainObject(source)) {\r\n    return;\r\n  }\r\n\r\n  const keys = Object.keys(source);\r\n  for (let i = 0; i < keys.length; i++) {\r\n    const key = keys[i];\r\n    if (key === '__proto__' || key === 'constructor') {\r\n      continue;\r\n    }\r\n    const val = source[key];\r\n\r\n    if (isPlainObject(val)) {\r\n      if (!target[key]) {\r\n        target[key] = {};\r\n      }\r\n      mergeDeepHelper(target[key], val);\r\n    } else if (Array.isArray(val)) {\r\n      if (!Array.isArray(target[key])) {\r\n        target[key] = [...val];\r\n      } else {\r\n        // deduplicate\r\n        val.forEach(obj => {\r\n          if (!target[key].some(item => deepEqual(item, obj))) {\r\n            target[key].push(obj);\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      // direct assignment\r\n      target[key] = val;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * returns a hash of a string using a fast algorithm\r\n * source: https://stackoverflow.com/a/52171480/845390\r\n * @param str\r\n * @param seed (optional)\r\n * @returns {string}\r\n */\r\nexport function cyrb53Hash(str, seed = 0) {\r\n  // IE doesn't support imul\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\r\n  const imul = function(opA, opB) {\r\n    if (isFn(Math.imul)) {\r\n      return Math.imul(opA, opB);\r\n    } else {\r\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\r\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\r\n      // automatically handled for our convienence:\r\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\r\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\r\n      var result = (opA & 0x003fffff) * opB;\r\n      // 2. We can remove an integer coersion from the statement above because:\r\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\r\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\r\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\r\n      return result | 0;\r\n    }\r\n  };\r\n\r\n  let h1 = 0xdeadbeef ^ seed;\r\n  let h2 = 0x41c6ce57 ^ seed;\r\n  for (let i = 0, ch; i < str.length; i++) {\r\n    ch = str.charCodeAt(i);\r\n    h1 = imul(h1 ^ ch, 2654435761);\r\n    h2 = imul(h2 ^ ch, 1597334677);\r\n  }\r\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\r\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\r\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\r\n}\r\n\r\n/**\r\n * returns the result of `JSON.parse(data)`, or undefined if that throws an error.\r\n * @param data\r\n * @returns {any}\r\n */\r\nexport function safeJSONParse(data) {\r\n  try {\r\n    return JSON.parse(data);\r\n  } catch (e) {}\r\n}\r\n\r\nexport function safeJSONEncode(data) {\r\n  try {\r\n    return JSON.stringify(data);\r\n  } catch (e) {\r\n    return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Returns a memoized version of `fn`.\r\n *\r\n * @param fn\r\n * @param key cache key generator, invoked with the same arguments passed to `fn`.\r\n *        By default, the first argument is used as key.\r\n * @return {*}\r\n */\r\nexport function memoize(fn, key = function (arg) { return arg; }) {\r\n  const cache = new Map();\r\n  const memoized = function () {\r\n    const cacheKey = key.apply(this, arguments);\r\n    if (!cache.has(cacheKey)) {\r\n      cache.set(cacheKey, fn.apply(this, arguments));\r\n    }\r\n    return cache.get(cacheKey);\r\n  }\r\n  memoized.clear = cache.clear.bind(cache);\r\n  return memoized;\r\n}\r\n\r\n/**\r\n * Returns a Unix timestamp for given time value and unit.\r\n * @param {number} timeValue numeric value, defaults to 0 (which means now)\r\n * @param {string} timeUnit defaults to days (or 'd'), use 'm' for minutes. Any parameter that isn't 'd' or 'm' will return Date.now().\r\n * @returns {number}\r\n */\r\nexport function getUnixTimestampFromNow(timeValue = 0, timeUnit = 'd') {\r\n  const acceptableUnits = ['m', 'd'];\r\n  if (acceptableUnits.indexOf(timeUnit) < 0) {\r\n    return Date.now();\r\n  }\r\n  const multiplication = timeValue / (timeUnit === 'm' ? 1440 : 1);\r\n  return Date.now() + (timeValue && timeValue > 0 ? (1000 * 60 * 60 * 24 * multiplication) : 0);\r\n}\r\n\r\n/**\r\n * Converts given object into an array, so {key: 1, anotherKey: 'fred', third: ['fred']} is turned\r\n * into [{key: 1}, {anotherKey: 'fred'}, {third: ['fred']}]\r\n * @param {Object} obj the object\r\n * @returns {Array}\r\n */\r\nexport function convertObjectToArray(obj) {\r\n  return Object.keys(obj).map(key => {\r\n    return {[key]: obj[key]};\r\n  });\r\n}\r\n\r\n/**\r\n * Sets dataset attributes on a script\r\n * @param {HTMLScriptElement} script\r\n * @param {object} attributes\r\n */\r\nexport function setScriptAttributes(script, attributes) {\r\n  Object.entries(attributes).forEach(([k, v]) => script.setAttribute(k, v))\r\n}\r\n\r\n/**\r\n * Perform a binary search for `el` on an ordered array `arr`.\r\n *\r\n * @returns the lowest nonnegative integer I that satisfies:\r\n *   key(arr[i]) >= key(el) for each i between I and arr.length\r\n *\r\n *   (if one or more matches are found for `el`, returns the index of the first;\r\n *   if the element is not found, return the index of the first element that's greater;\r\n *   if no greater element exists, return `arr.length`)\r\n */\r\nexport function binarySearch(arr, el, key = (el) => el) {\r\n  let left = 0;\r\n  let right = arr.length && arr.length - 1;\r\n  const target = key(el);\r\n  while (right - left > 1) {\r\n    const middle = left + Math.round((right - left) / 2);\r\n    if (target > key(arr[middle])) {\r\n      left = middle;\r\n    } else {\r\n      right = middle;\r\n    }\r\n  }\r\n  while (arr.length > left && target > key(arr[left])) {\r\n    left++;\r\n  }\r\n  return left;\r\n}\r\n\r\n/**\r\n * Checks if an object has non-serializable properties.\r\n * Non-serializable properties are functions and RegExp objects.\r\n *\r\n * @param {Object} obj - The object to check.\r\n * @param {Set} checkedObjects - A set of properties that have already been checked.\r\n * @returns {boolean} - Returns true if the object has non-serializable properties, false otherwise.\r\n */\r\nexport function hasNonSerializableProperty(obj, checkedObjects = new Set()) {\r\n  for (const key in obj) {\r\n    const value = obj[key];\r\n    const type = typeof value;\r\n\r\n    if (\r\n      value === undefined ||\r\n      type === 'function' ||\r\n      type === 'symbol' ||\r\n      value instanceof RegExp ||\r\n      value instanceof Map ||\r\n      value instanceof Set ||\r\n      value instanceof Date ||\r\n      (value !== null && type === 'object' && value.hasOwnProperty('toJSON'))\r\n    ) {\r\n      return true;\r\n    }\r\n    if (value !== null && type === 'object' && value.constructor === Object) {\r\n      if (checkedObjects.has(value)) {\r\n        // circular reference, means we have a non-serializable property\r\n        return true;\r\n      }\r\n      checkedObjects.add(value);\r\n      if (hasNonSerializableProperty(value, checkedObjects)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Returns the value of a nested property in an array of objects.\r\n *\r\n * @param {Array} collection - Array of objects.\r\n * @param {String} key - Key of nested property.\r\n * @returns {any|undefined} - Value of nested property.\r\n */\r\nexport function setOnAny(collection, key) {\r\n  for (let i = 0, result; i < collection.length; i++) {\r\n    result = deepAccess(collection[i], key);\r\n    if (result) {\r\n      return result;\r\n    }\r\n  }\r\n  return undefined;\r\n}\r\n\r\nexport function extractDomainFromHost(pageHost) {\r\n  let domain = null;\r\n  try {\r\n    const domains = /[-\\w]+\\.([-\\w]+|[-\\w]{3,}|[-\\w]{1,3}\\.[-\\w]{2})$/i.exec(pageHost);\r\n    if (domains != null && domains.length > 0) {\r\n      domain = domains[0];\r\n      for (let i = 1; i < domains.length; i++) {\r\n        if (domains[i].length > domain.length) {\r\n          domain = domains[i];\r\n        }\r\n      }\r\n    }\r\n  } catch (e) {\r\n    domain = null;\r\n  }\r\n  return domain;\r\n}\r\n\r\nexport function triggerNurlWithCpm(bid, cpm) {\r\n  if (isStr(bid.nurl) && bid.nurl !== '') {\r\n    bid.nurl = bid.nurl.replace(\r\n      /\\${AUCTION_PRICE}/,\r\n      cpm\r\n    );\r\n    triggerPixel(bid.nurl);\r\n  }\r\n}\r\n\r\n// To ensure that isGzipCompressionSupported() doesn’t become an overhead, we have used memoization to cache the result after the first execution.\r\n// This way, even if the function is called multiple times, it will only perform the actual check once and return the cached result in subsequent calls.\r\nexport const isGzipCompressionSupported = (function () {\r\n  let cachedResult; // Store the result\r\n\r\n  return function () {\r\n    if (cachedResult !== undefined) {\r\n      return cachedResult; // Return cached result if already computed\r\n    }\r\n\r\n    try {\r\n      if (typeof window.CompressionStream === 'undefined') {\r\n        cachedResult = false;\r\n      } else {\r\n        (() => new window.CompressionStream('gzip'))();\r\n        cachedResult = true;\r\n      }\r\n    } catch (error) {\r\n      cachedResult = false;\r\n    }\r\n\r\n    return cachedResult;\r\n  };\r\n})();\r\n\r\n// Make sure to use isGzipCompressionSupported before calling this function\r\nexport async function compressDataWithGZip(data) {\r\n  if (typeof data !== 'string') { // TextEncoder (below) expects a string\r\n    data = JSON.stringify(data);\r\n  }\r\n\r\n  const encoder = new TextEncoder();\r\n  const encodedData = encoder.encode(data);\r\n  const compressedStream = new Blob([encodedData])\r\n    .stream()\r\n    .pipeThrough(new window.CompressionStream('gzip'));\r\n\r\n  const compressedBlob = await new Response(compressedStream).blob();\r\n  const compressedArrayBuffer = await compressedBlob.arrayBuffer();\r\n  return new Uint8Array(compressedArrayBuffer);\r\n}\r\n","import {auctionManager} from '../auctionManager.js';\r\nimport {bidderSettings} from '../bidderSettings.js';\r\nimport {logError} from '../utils.js';\r\n\r\nexport function adjustCpm(cpm, bidResponse, bidRequest, {index = auctionManager.index, bs = bidderSettings} = {}) {\r\n  bidRequest = bidRequest || index.getBidRequest(bidResponse);\r\n  const adapterCode = bidResponse?.adapterCode;\r\n  const bidderCode = bidResponse?.bidderCode || bidRequest?.bidder;\r\n  const adjustAlternateBids = bs.get(bidResponse?.adapterCode, 'adjustAlternateBids');\r\n  const bidCpmAdjustment = bs.getOwn(bidderCode, 'bidCpmAdjustment') || bs.get(adjustAlternateBids ? adapterCode : bidderCode, 'bidCpmAdjustment');\r\n  if (bidCpmAdjustment && typeof bidCpmAdjustment === 'function') {\r\n    try {\r\n      return bidCpmAdjustment(cpm, Object.assign({}, bidResponse), bidRequest);\r\n    } catch (e) {\r\n      logError('Error during bid adjustment', e);\r\n    }\r\n  }\r\n  return cpm;\r\n}\r\n","let outOfFocusStart = null; // enforce null otherwise it could be undefined and the callback wouldn't execute\r\nlet timeOutOfFocus = 0;\r\nlet suspendedTimeouts = [];\r\n\r\nfunction trackTimeOutOfFocus() {\r\n  if (document.hidden) {\r\n    outOfFocusStart = Date.now()\r\n  } else {\r\n    timeOutOfFocus += Date.now() - (outOfFocusStart ?? 0); // when the page is loaded in hidden state outOfFocusStart is undefined, which results in timeoutOffset being NaN\r\n    outOfFocusStart = null;\r\n    suspendedTimeouts.forEach(({ callback, startTime, setTimerId }) => setTimerId(setFocusTimeout(callback, timeOutOfFocus - startTime)()));\r\n    suspendedTimeouts = [];\r\n  }\r\n}\r\n\r\ndocument.addEventListener('visibilitychange', trackTimeOutOfFocus);\r\n\r\nexport function reset() {\r\n  outOfFocusStart = null;\r\n  timeOutOfFocus = 0;\r\n  suspendedTimeouts = [];\r\n  document.removeEventListener('visibilitychange', trackTimeOutOfFocus);\r\n  document.addEventListener('visibilitychange', trackTimeOutOfFocus);\r\n}\r\n\r\n/**\r\n * Wraps native setTimeout function in order to count time only when page is focused\r\n *\r\n * @param {function(void): void} [callback] - A function that will be invoked after passed time\r\n * @param {number} [milliseconds] - Minimum duration (in milliseconds) that the callback will be executed after\r\n * @returns {function(): number} - Getter function for current timer id\r\n */\r\nexport function setFocusTimeout(callback, milliseconds) {\r\n  const startTime = timeOutOfFocus;\r\n  let timerId = setTimeout(() => {\r\n    if (timeOutOfFocus === startTime && outOfFocusStart == null) {\r\n      callback();\r\n    } else if (outOfFocusStart != null) {\r\n      // case when timeout ended during page is out of focus\r\n      suspendedTimeouts.push({\r\n        callback,\r\n        startTime,\r\n        setTimerId(newId) {\r\n          timerId = newId;\r\n        }\r\n      })\r\n    } else {\r\n      timerId = setFocusTimeout(callback, timeOutOfFocus - startTime)();\r\n    }\r\n  }, milliseconds);\r\n  return () => timerId;\r\n}\r\n","/**\r\n * Check if GDPR purpose 1 consent was given.\r\n *\r\n * @param gdprConsent GDPR consent data\r\n * @returns {boolean} true if the gdprConsent is null-y; or GDPR does not apply; or if purpose 1 consent was given.\r\n */\r\nexport function hasPurpose1Consent(gdprConsent) {\r\n  if (gdprConsent?.gdprApplies) {\r\n    return gdprConsent?.vendorData?.purpose?.consents?.[1] === true;\r\n  }\r\n  return true;\r\n}\r\n","export function scrubIPv4(ip) {\r\n  if (!ip) {\r\n    return null;\r\n  }\r\n\r\n  const ones = 24;\r\n\r\n  const ipParts = ip.split('.').map(Number)\r\n\r\n  if (ipParts.length != 4) {\r\n    return null;\r\n  }\r\n\r\n  const mask = [];\r\n  for (let i = 0; i < 4; i++) {\r\n    const n = Math.max(0, Math.min(8, ones - (i * 8)));\r\n    mask.push((0xff << (8 - n)) & 0xff);\r\n  }\r\n\r\n  const maskedIP = ipParts.map((part, i) => part & mask[i]);\r\n\r\n  return maskedIP.join('.');\r\n}\r\n\r\nexport function scrubIPv6(ip) {\r\n  if (!ip) {\r\n    return null;\r\n  }\r\n\r\n  const ones = 64;\r\n\r\n  let ipParts = ip.split(':').map(part => parseInt(part, 16));\r\n\r\n  ipParts = ipParts.map(part => isNaN(part) ? 0 : part);\r\n  while (ipParts.length < 8) {\r\n    ipParts.push(0);\r\n  }\r\n\r\n  if (ipParts.length != 8) {\r\n    return null;\r\n  }\r\n\r\n  const mask = [];\r\n  for (let i = 0; i < 8; i++) {\r\n    const n = Math.max(0, Math.min(16, ones - (i * 16)));\r\n    mask.push((0xffff << (16 - n)) & 0xffff);\r\n  }\r\n\r\n  const maskedIP = ipParts.map((part, i) => part & mask[i]);\r\n\r\n  return maskedIP.map(part => part.toString(16)).join(':');\r\n}\r\n","import {klona} from \"klona/json\";\r\nimport type {AnyFunction} from \"../types/functions.d.ts\";\r\nimport type {Repeat} from \"../types/tuples.d.ts\";\r\n\r\nexport function deepClone<T>(obj: T): T {\r\n  return (klona(obj) || {}) as T;\r\n}\r\n\r\n/**\r\n * Build an object consisting of only defined parameters to avoid creating an\r\n * object with defined keys and undefined values.\r\n * @param object The object to pick defined params out of\r\n * @param params An array of strings representing properties to look for in the object\r\n * @returns An object containing all the specified values that are defined\r\n */\r\nexport function getDefinedParams<T extends object, K extends readonly (keyof T)[]>(object: T, params: K): Partial<Pick<T, K[number]>> {\r\n  return params\r\n    .filter(param => object[param])\r\n    .reduce((bid, param) => Object.assign(bid, { [param]: object[param] }), {});\r\n}\r\n\r\nconst tStr = 'String';\r\nconst tFn = 'Function';\r\nconst tNumb = 'Number';\r\nconst tObject = 'Object';\r\nconst tBoolean = 'Boolean';\r\nconst toString = Object.prototype.toString;\r\n\r\n/**\r\n * Return if the object is of the\r\n * given type.\r\n * @param {*} object to test\r\n * @param {String} _t type string (e.g., Array)\r\n * @return {Boolean} if object is of type _t\r\n */\r\nexport function isA(object, _t) {\r\n  return toString.call(object) === '[object ' + _t + ']';\r\n}\r\n\r\nexport function isFn(object): object is AnyFunction {\r\n  return isA(object, tFn);\r\n}\r\n\r\nexport function isStr(object): object is string {\r\n  return isA(object, tStr);\r\n}\r\n\r\nexport const isArray: (object) => object is any[] = Array.isArray.bind(Array);\r\n\r\nexport function isNumber(object): object is number {\r\n  return isA(object, tNumb);\r\n}\r\n\r\nexport function isPlainObject(object): object is Record<any, unknown> {\r\n  return isA(object, tObject);\r\n}\r\n\r\nexport function isBoolean(object): object is boolean {\r\n  return isA(object, tBoolean);\r\n}\r\n\r\n/**\r\n * Checks input is integer or not\r\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\r\n */\r\nexport const isInteger: (value) => value is number = Number.isInteger.bind(Number);\r\n\r\nexport function isArrayOfNums<L extends number>(val, size?: L): val is Repeat<number, L> {\r\n  return (isArray(val)) && ((size) ? val.length === size : true) && (val.every(v => isInteger(v)));\r\n}\r\n","import {config} from '../config.js';\r\nimport type {AnyFunction, Wraps} from \"../types/functions.d.ts\";\r\nimport {type BeforeHook, type BeforeHookParams, type HookType, Next} from \"../hook.ts\";\r\nimport type {addBidResponse} from \"../auction.ts\";\r\nimport type {PrivRequestBidsOptions, StartAuctionOptions} from \"../prebid.ts\";\r\n\r\nexport const CONFIG_TOGGLE = 'performanceMetrics';\r\nconst getTime = window.performance && window.performance.now ? () => window.performance.now() : () => Date.now();\r\nconst NODES = new WeakMap();\r\n\r\nexport type Metrics = ReturnType<ReturnType<typeof metricsFactory>>;\r\n\r\n/**\r\n * A function that, when called, stops a time measure and saves it as a metric.\r\n */\r\nexport type MetricsTimer = {\r\n  (): void;\r\n  /**\r\n   * @return a wrapper around the given function that begins by stopping this time measure.\r\n   */\r\n  stopBefore<F extends AnyFunction>(fn: F): Wraps<F>;\r\n  /**\r\n   * @return a wrapper around the given function that ends by stopping this time measure.\r\n   */\r\n  stopAfter<F extends AnyFunction>(fn: F): Wraps<F>;\r\n};\r\n\r\nexport type InstrumentedNext<F extends AnyFunction> = Next<F> & {\r\n  /**\r\n   * The original `next` argument; using it will not affect the timer.\r\n   */\r\n  untimed: Next<F>;\r\n  stopTiming: MetricsTimer;\r\n}\r\n\r\nfunction wrapFn<F extends AnyFunction>(fn: F, before?: () => void, after?: () => void): Wraps<F> {\r\n  return function (...args) {\r\n    before && before();\r\n    try {\r\n      return fn.apply(this, args);\r\n    } finally {\r\n      after && after();\r\n    }\r\n  };\r\n}\r\n\r\nexport function metricsFactory({now = getTime, mkNode = makeNode, mkTimer = makeTimer, mkRenamer = (rename) => rename, nodes = NODES} = {}) {\r\n  return function newMetrics() {\r\n    function makeMetrics(self, rename = (n) => ({forEach(fn) { fn(n); }})) {\r\n      rename = mkRenamer(rename);\r\n\r\n      function accessor(slot) {\r\n        return function (name) {\r\n          return self.dfWalk({\r\n            visit(edge, node) {\r\n              const obj = node[slot];\r\n              if (obj.hasOwnProperty(name)) {\r\n                return obj[name];\r\n              }\r\n            }\r\n          });\r\n        };\r\n      }\r\n\r\n      const getTimestamp = accessor('timestamps');\r\n\r\n      /**\r\n       * Register a metric.\r\n       *\r\n       * @param name metric name\r\n       * @param value metric valiue\r\n       */\r\n      function setMetric(name: string, value: unknown): void {\r\n        const names = rename(name);\r\n        self.dfWalk({\r\n          follow(inEdge, outEdge) {\r\n            return outEdge.propagate && (!inEdge || !inEdge.stopPropagation)\r\n          },\r\n          visit(edge, node) {\r\n            names.forEach(name => {\r\n              if (edge == null) {\r\n                node.metrics[name] = value;\r\n              } else {\r\n                if (!node.groups.hasOwnProperty(name)) {\r\n                  node.groups[name] = [];\r\n                }\r\n                node.groups[name].push(value);\r\n              }\r\n            })\r\n          }\r\n        });\r\n      }\r\n\r\n      /**\r\n       * Mark the current time as a checkpoint with the given name, to be referenced later\r\n       * by `timeSince` or `timeBetween`.\r\n       *\r\n       * @param name checkpoint name\r\n       */\r\n      function checkpoint(name: string): void {\r\n        self.timestamps[name] = now();\r\n      }\r\n\r\n      /**\r\n       * Get the tame passed since `checkpoint`, and optionally save it as a metric.\r\n       *\r\n       * @param checkpoint checkpoint name\r\n       * @param metric The name of the metric to save. Optional.\r\n       * @return The time in milliseconds between now and the checkpoint, or `null` if the checkpoint is not found.\r\n       */\r\n      function timeSince(checkpoint: string, metric?: string): number | null {\r\n        const ts = getTimestamp(checkpoint);\r\n        const elapsed = ts != null ? now() - ts : null;\r\n        if (metric != null) {\r\n          setMetric(metric, elapsed);\r\n        }\r\n        return elapsed;\r\n      }\r\n\r\n      /**\r\n       * Get the time passed between `startCheckpoint` and `endCheckpoint`, optionally saving it as a metric.\r\n       *\r\n       * @param startCheckpoint - The name of the starting checkpoint.\r\n       * @param endCheckpoint - The name of the ending checkpoint.\r\n       * @param metric - The name of the metric to save.\r\n       * @return The time in milliseconds between `startCheckpoint` and `endCheckpoint`, or `null` if either checkpoint is not found.\r\n       */\r\n      function timeBetween(startCheckpoint: string, endCheckpoint: string, metric?: string): number | null {\r\n        const start = getTimestamp(startCheckpoint);\r\n        const end = getTimestamp(endCheckpoint);\r\n        const elapsed = start != null && end != null ? end - start : null;\r\n        if (metric != null) {\r\n          setMetric(metric, elapsed);\r\n        }\r\n        return elapsed;\r\n      }\r\n\r\n      /**\r\n       * Start measuring a time metric with the given name.\r\n       *\r\n       * @param name metric name\r\n       */\r\n      function startTiming(name: string): MetricsTimer {\r\n        return mkTimer(now, (val) => setMetric(name, val))\r\n      }\r\n\r\n      /**\r\n       * Run fn and measure the time spent in it.\r\n       *\r\n       * @param name the name to use for the measured time metric\r\n       * @param fn the function to run\r\n       * @return the return value of `fn`\r\n       */\r\n      function measureTime<R>(name: string, fn: () => R): R {\r\n        return startTiming(name).stopAfter(fn)();\r\n      }\r\n\r\n      /**\r\n       * Convenience method for measuring time spent in a `.before` or `.after` hook.\r\n       *\r\n       * @param name - The metric name.\r\n       * @param next - The hook's `next` (first) argument.\r\n       * @param fn   - A function that will be run immediately; it takes `next`, where both `next` and\r\n       *               `next.bail` automatically call `stopTiming` before continuing with the original hook.\r\n       * @return The return value of `fn`.\r\n       */\r\n      function measureHookTime<F extends AnyFunction, R>(name: string, next: Next<F>, fn: (next: InstrumentedNext<F>) => R): R {\r\n        const stopTiming = startTiming(name);\r\n        return fn((function (orig) {\r\n          const next = stopTiming.stopBefore(orig) as InstrumentedNext<F>;\r\n          next.bail = orig.bail && stopTiming.stopBefore(orig.bail);\r\n          next.stopTiming = stopTiming;\r\n          next.untimed = orig;\r\n          return next;\r\n        })(next));\r\n      }\r\n\r\n      /**\r\n       * Get all registered metrics.\r\n       */\r\n      function getMetrics(): { [name: string]: unknown } {\r\n        let result = {}\r\n        self.dfWalk({\r\n          visit(edge, node) {\r\n            result = Object.assign({}, !edge || edge.includeGroups ? node.groups : null, node.metrics, result);\r\n          }\r\n        });\r\n        return result;\r\n      }\r\n\r\n            type PropagationOptions = {\r\n              /**\r\n               * If false, the forked or joined metrics will not be propagated here.\r\n               */\r\n              propagate?: boolean;\r\n              /**\r\n               * If true, propagation from the new metrics is stopped here, instead of\r\n               * continuing up the chain (if for example these metrics were themselves created through `.fork()`).\r\n               */\r\n              stopPropagation?: boolean;\r\n              /**\r\n               * If true, the forked metrics will also replicate metrics that were propagated\r\n               *   here from elsewhere. For example:\r\n               *   ```\r\n               *   const metrics = newMetrics();\r\n               *   const op1 = metrics.fork();\r\n               *   const withoutGroups = metrics.fork();\r\n               *   const withGroups = metrics.fork({includeGroups: true});\r\n               *   op1.setMetric('foo', 'bar');\r\n               *   withoutGroups.getMetrics() // {}\r\n               *   withGroups.getMetrics() // {foo: ['bar']}\r\n               *   ```\r\n               */\r\n              includeGroups?: boolean;\r\n            };\r\n\r\n            /**\r\n             * Create and return a new metrics object that starts as a view on all metrics registered here,\r\n             * and - by default - also propagates all new metrics here.\r\n             *\r\n             * Propagated metrics are grouped together, and intended for repeated operations. For example, with the following:\r\n             *\r\n             * ```\r\n             * const metrics = newMetrics();\r\n             * const requests = metrics.measureTime('buildRequests', buildRequests)\r\n             * requests.forEach((req) => {\r\n             *   const requestMetrics = metrics.fork();\r\n             *   requestMetrics.measureTime('processRequest', () => processRequest(req);\r\n             * })\r\n             * ```\r\n             *\r\n             * if `buildRequests` takes 10ms and returns 3 objects, which respectively take 100, 200, and 300ms in `processRequest`, then\r\n             * the final `metrics.getMetrics()` would be:\r\n             *\r\n             * ```\r\n             * {\r\n             *    buildRequests: 10,\r\n             *    processRequest: [100, 200, 300]\r\n             * }\r\n             * ```\r\n             *\r\n             * while the inner `requestMetrics.getMetrics()` would be:\r\n             *\r\n             * ```\r\n             * {\r\n             *   buildRequests: 10,\r\n             *   processRequest: 100 // or 200 for the 2nd loop, etc\r\n             * }\r\n             * ```\r\n             */\r\n            function fork({propagate = true, stopPropagation = false, includeGroups = false}: PropagationOptions = {}): Metrics {\r\n              return makeMetrics(mkNode([[self, {propagate, stopPropagation, includeGroups}]]), rename);\r\n            }\r\n\r\n            /**\r\n             * Join `otherMetrics` with these; all metrics from `otherMetrics` will (by default) be propagated here,\r\n             * and all metrics from here will be included in `otherMetrics`.\r\n             */\r\n            function join(otherMetrics: Metrics, {propagate = true, stopPropagation = false, includeGroups = false}: PropagationOptions = {}): void {\r\n              const other = nodes.get(otherMetrics);\r\n              if (other != null) {\r\n                other.addParent(self, {propagate, stopPropagation, includeGroups});\r\n              }\r\n            }\r\n\r\n            /**\r\n             * @return a version of these metrics with the same propagation rules, but:\r\n             *  - all metrics are renamed according to `renameFn`, or\r\n             *  - without these metrics' rename rule (if `renameFn` is omitted).\r\n             */\r\n            function renameWith(renameFn?: (name: string) => string[]): Metrics {\r\n              return makeMetrics(self, renameFn);\r\n            }\r\n\r\n            /**\r\n             * @return a new metrics object that uses the same propagation and renaming rules as this one.\r\n             */\r\n            function newMetrics(): Metrics {\r\n              return makeMetrics(self.newSibling(), rename);\r\n            }\r\n\r\n            const metrics = {\r\n              startTiming,\r\n              measureTime,\r\n              measureHookTime,\r\n              checkpoint,\r\n              timeSince,\r\n              timeBetween,\r\n              setMetric,\r\n              getMetrics,\r\n              fork,\r\n              join,\r\n              newMetrics,\r\n              renameWith,\r\n              toJSON() {\r\n                return getMetrics();\r\n              }\r\n            };\r\n            nodes.set(metrics, self);\r\n            return metrics;\r\n    }\r\n\r\n    return makeMetrics(mkNode([]));\r\n  }\r\n}\r\n\r\nfunction makeTimer(now: () => number, cb: (elapsed: number) => void): MetricsTimer {\r\n  const start = now();\r\n  let done = false;\r\n  function stopTiming() {\r\n    if (!done) {\r\n      cb(now() - start);\r\n      done = true;\r\n    }\r\n  }\r\n  stopTiming.stopBefore = (fn) => wrapFn(fn, stopTiming);\r\n  stopTiming.stopAfter = (fn) => wrapFn(fn, null, stopTiming);\r\n  return stopTiming;\r\n}\r\n\r\nfunction makeNode(parents) {\r\n  return {\r\n    metrics: {},\r\n    timestamps: {},\r\n    groups: {},\r\n    addParent(node, edge) {\r\n      parents.push([node, edge]);\r\n    },\r\n    newSibling() {\r\n      return makeNode(parents.slice());\r\n    },\r\n    dfWalk({visit, follow = () => true, visited = new Set(), inEdge} = {} as any) {\r\n      let res;\r\n      if (!visited.has(this)) {\r\n        visited.add(this);\r\n        res = visit(inEdge, this);\r\n        if (res != null) return res;\r\n        for (const [parent, outEdge] of parents) {\r\n          if (follow(inEdge, outEdge)) {\r\n            res = parent.dfWalk({visit, follow, visited, inEdge: outEdge});\r\n            if (res != null) return res;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nconst nullMetrics: Metrics = (() => {\r\n  const nop = function () {};\r\n  const empty = () => ({});\r\n  const none = {forEach: nop};\r\n  const nullTimer = () => null;\r\n  nullTimer.stopBefore = (fn) => fn;\r\n  nullTimer.stopAfter = (fn) => fn;\r\n  const nullNode = Object.defineProperties(\r\n    {dfWalk: nop, newSibling: () => nullNode, addParent: nop},\r\n    Object.fromEntries(['metrics', 'timestamps', 'groups'].map(prop => [prop, {get: empty}])));\r\n  return metricsFactory({\r\n    now: () => 0,\r\n    mkNode: () => nullNode as any,\r\n    mkRenamer: () => () => none,\r\n    mkTimer: () => nullTimer,\r\n    nodes: {get: nop, set: nop} as unknown as Map<any, any>\r\n  })();\r\n})();\r\n\r\nlet enabled = true;\r\nconfig.getConfig(CONFIG_TOGGLE, (cfg) => { enabled = !!cfg[CONFIG_TOGGLE] });\r\n\r\n/**\r\n * convenience fallback function for metrics that may be undefined, especially during tests.\r\n */\r\nexport function useMetrics(metrics: Metrics): Metrics {\r\n  return (enabled && metrics) || nullMetrics;\r\n}\r\n\r\nexport const newMetrics = (() => {\r\n  const makeMetrics = metricsFactory();\r\n  return function (): Metrics {\r\n    return enabled ? makeMetrics() : nullMetrics;\r\n  }\r\n})();\r\n\r\nexport function hookTimer<TYP extends HookType, F extends AnyFunction>(prefix: string, getMetrics: (...args: Parameters<F>) => Metrics) {\r\n  return function(name: string, hookFn: (next: InstrumentedNext<(...args: BeforeHookParams<TYP, F>) => ReturnType<F>>, ...args: BeforeHookParams<TYP, F>) => unknown): BeforeHook<TYP, F> {\r\n    return (next, ...args) => {\r\n      return useMetrics(getMetrics.apply(this, args)).measureHookTime(prefix + name, next, (next) => {\r\n        return hookFn.call(this, next, ...args);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const timedAuctionHook = hookTimer<'async', (options: PrivRequestBidsOptions | StartAuctionOptions) => void>('requestBids.', (req) => req.metrics);\r\nexport const timedBidResponseHook = hookTimer<'async', typeof addBidResponse>('addBidResponse.', (_, bid) => bid.metrics)\r\n","import {logInfo} from '../utils.js';\r\nimport type {AnyFunction} from \"../types/functions.d.ts\";\r\nimport type {UnwrapPromise, ToPromise} from \"./promise.ts\";\r\n\r\n/**\r\n * Returns a wrapper around fn that delays execution until the page if activated, if it was prerendered and isDelayEnabled returns true.\r\n * https://developer.chrome.com/docs/web-platform/prerender-pages\r\n */\r\nexport function delayIfPrerendering<F extends AnyFunction>(isDelayEnabled: () => boolean, fn: F): (...args: Parameters<F>) => ToPromise<ReturnType<F>> {\r\n  return (...args) => {\r\n    if ((document as any).prerendering && isDelayEnabled()) {\r\n      return new Promise<UnwrapPromise<ReturnType<F>>>((resolve) => {\r\n        document.addEventListener('prerenderingchange', () => {\r\n          logInfo(`Auctions were suspended while page was prerendering`)\r\n          resolve(fn.apply(this, args))\r\n        }, {once: true})\r\n      })\r\n    } else {\r\n      return Promise.resolve<UnwrapPromise<ReturnType<F>>>(fn.apply(this, args));\r\n    }\r\n  }\r\n}\r\n","import {GreedyPromise, greedySetTimeout} from '../../libraries/greedy/greedyPromise.js';\r\nimport {getGlobal} from '../prebidGlobal.js';\r\n\r\ndeclare module '../prebidGlobal' {\r\n  interface PrebidJS {\r\n    /**\r\n     * The setTimeout implementation Prebid should use.\r\n     */\r\n    setTimeout?: typeof setTimeout;\r\n    /**\r\n     * The Promise constructor Prebid should use.\r\n     */\r\n    Promise?: typeof Promise\r\n  }\r\n}\r\n\r\nexport const pbSetTimeout: typeof setTimeout = getGlobal().setTimeout ?? (FEATURES.GREEDY ? greedySetTimeout : setTimeout)\r\nexport const PbPromise: typeof Promise = getGlobal().Promise ?? (FEATURES.GREEDY ? GreedyPromise : Promise) as any;\r\n\r\nexport function delay(delayMs = 0): Promise<void> {\r\n  return new PbPromise((resolve) => {\r\n    pbSetTimeout(resolve, delayMs);\r\n  });\r\n}\r\n\r\nexport interface Defer<T> {\r\n  promise: Promise<T>;\r\n  resolve: Parameters<ConstructorParameters<typeof Promise<T>>[0]>[0],\r\n  reject: Parameters<ConstructorParameters<typeof Promise<T>>[0]>[1],\r\n}\r\n\r\nexport type UnwrapPromise<T> = T extends PromiseLike<infer R> ? R : T;\r\nexport type ToPromise<T> = Promise<UnwrapPromise<T>>;\r\n\r\n/**\r\n * @returns a {promise, resolve, reject} trio where `promise` is resolved by calling `resolve` or `reject`.\r\n */\r\nexport function defer<T>({promiseFactory = (resolver) => new PbPromise(resolver) as Promise<T>}: {\r\n  promiseFactory?: (...args: ConstructorParameters<typeof Promise<T>>) => Promise<T>\r\n} = {}): Defer<T> {\r\n  function invoker(delegate) {\r\n    return (val) => delegate(val);\r\n  }\r\n\r\n  let resolveFn, rejectFn;\r\n\r\n  return {\r\n    promise: promiseFactory((resolve, reject) => {\r\n      resolveFn = resolve;\r\n      rejectFn = reject;\r\n    }),\r\n    resolve: invoker(resolveFn),\r\n    reject: invoker(rejectFn)\r\n  }\r\n}\r\n","export function simpleCompare(a, b) {\r\n  if (a === b) return 0;\r\n  return a < b ? -1 : 1;\r\n}\r\n\r\nexport function keyCompare(key = (item) => item) {\r\n  return (a, b) => simpleCompare(key(a), key(b))\r\n}\r\n\r\nexport function reverseCompare(compare = simpleCompare) {\r\n  return (a, b) => -compare(a, b) || 0;\r\n}\r\n\r\nexport function tiebreakCompare(...compares) {\r\n  return function (a, b) {\r\n    for (const cmp of compares) {\r\n      const val = cmp(a, b);\r\n      if (val !== 0) return val;\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n\r\nexport function minimum(compare = simpleCompare) {\r\n  return (min, item) => compare(item, min) < 0 ? item : min;\r\n}\r\n\r\nexport function maximum(compare = simpleCompare) {\r\n  return minimum(reverseCompare(compare));\r\n}\r\n\r\nconst cpmCompare = keyCompare((bid) => bid.cpm);\r\nconst timestampCompare = keyCompare((bid) => bid.responseTimestamp);\r\n\r\n// This function will get highest cpm value bid, in case of tie it will return the bid with lowest timeToRespond\r\nexport const getHighestCpm = maximum(tiebreakCompare(cpmCompare, reverseCompare(keyCompare((bid) => bid.timeToRespond))))\r\n\r\n// This function will get the oldest hightest cpm value bid, in case of tie it will return the bid which came in first\r\n// Use case for tie: https://github.com/prebid/Prebid.js/issues/2448\r\nexport const getOldestHighestCpmBid = maximum(tiebreakCompare(cpmCompare, reverseCompare(timestampCompare)))\r\n\r\n// This function will get the latest hightest cpm value bid, in case of tie it will return the bid which came in last\r\n// Use case for tie: https://github.com/prebid/Prebid.js/issues/2539\r\nexport const getLatestHighestCpmBid = maximum(tiebreakCompare(cpmCompare, timestampCompare))\r\n","import {PbPromise} from './promise.js';\r\nimport {binarySearch, logError, timestamp} from '../utils.js';\r\nimport {setFocusTimeout} from './focusTimeout.js';\r\n\r\nexport type TTLCollection<T> = ReturnType<typeof ttlCollection<T>>;\r\n\r\n/**\r\n * Create a set-like collection that automatically forgets items after a certain time.\r\n */\r\nexport function ttlCollection<T>(\r\n  {\r\n    startTime = timestamp,\r\n    ttl = () => null,\r\n    monotonic = false,\r\n    slack = 5000\r\n  }: {\r\n    /**\r\n     * A function taking an item added to this collection,\r\n     *   and returning (a promise to) a timestamp to be used as the starting time for the item\r\n     *   (the item will be dropped after `ttl(item)` milliseconds have elapsed since this timestamp).\r\n     *   Defaults to the time the item was added to the collection.\r\n     */\r\n    startTime?: (item: T) => number | Promise<number>;\r\n    /**\r\n     * A function taking an item added to this collection,\r\n     *   and returning (a promise to) the duration (in milliseconds) the item should be kept in it.\r\n     *   May return null to indicate that the item should be persisted indefinitely.\r\n     */\r\n    ttl?: (item: T) => number | null | Promise<number | null>;\r\n    /**\r\n     * Set to true for better performance, but only if, given any two items A and B in this collection:\r\n     *   if A was added before B, then:\r\n     *     - startTime(A) + ttl(A) <= startTime(B) + ttl(B)\r\n     *     - Promise.all([startTime(A), ttl(A)]) never resolves later than Promise.all([startTime(B), ttl(B)])\r\n     */\r\n    monotonic?: boolean\r\n    /**\r\n     * Maximum duration (in milliseconds) that an item is allowed to persist\r\n     *   once past its TTL. This is also roughly the interval between \"garbage collection\" sweeps.\r\n     */\r\n    slack?: number;\r\n  } = {}\r\n) {\r\n  const items = new Map<T, any>();\r\n  const callbacks = [];\r\n  const pendingPurge = [];\r\n  const markForPurge = monotonic\r\n    ? (entry) => pendingPurge.push(entry)\r\n    : (entry) => pendingPurge.splice(binarySearch(pendingPurge, entry, (el) => el.expiry), 0, entry)\r\n  let nextPurge, task;\r\n\r\n  function reschedulePurge() {\r\n    task && clearTimeout(task);\r\n    if (pendingPurge.length > 0) {\r\n      const now = timestamp();\r\n      nextPurge = Math.max(now, pendingPurge[0].expiry + slack);\r\n      task = setFocusTimeout(() => {\r\n        const now = timestamp();\r\n        let cnt = 0;\r\n        for (const entry of pendingPurge) {\r\n          if (entry.expiry > now) break;\r\n          callbacks.forEach(cb => {\r\n            try {\r\n              cb(entry.item)\r\n            } catch (e) {\r\n              logError(e);\r\n            }\r\n          });\r\n          items.delete(entry.item)\r\n          cnt++;\r\n        }\r\n        pendingPurge.splice(0, cnt);\r\n        task = null;\r\n        reschedulePurge();\r\n      }, nextPurge - now);\r\n    } else {\r\n      task = null;\r\n    }\r\n  }\r\n\r\n  function mkEntry(item) {\r\n    const values: any = {};\r\n    const thisCohort = currentCohort;\r\n    let expiry;\r\n\r\n    function update() {\r\n      if (thisCohort === currentCohort && values.start != null && values.delta != null) {\r\n        expiry = values.start + values.delta;\r\n        markForPurge(entry);\r\n        if (task == null || nextPurge > expiry + slack) {\r\n          reschedulePurge();\r\n        }\r\n      }\r\n    }\r\n\r\n    const [init, refresh] = Object.entries({\r\n      start: startTime,\r\n      delta: ttl\r\n    }).map(([field, getter]) => {\r\n      let currentCall;\r\n      return function() {\r\n        const thisCall = currentCall = {};\r\n        PbPromise.resolve(getter(item)).then((val) => {\r\n          if (thisCall === currentCall) {\r\n            values[field] = val;\r\n            update();\r\n          }\r\n        });\r\n      }\r\n    })\r\n\r\n    const entry = {\r\n      item,\r\n      refresh,\r\n      get expiry() {\r\n        return expiry;\r\n      },\r\n    };\r\n\r\n    init();\r\n    refresh();\r\n    return entry;\r\n  }\r\n\r\n  let currentCohort = {};\r\n\r\n  return {\r\n    [Symbol.iterator]: () => items.keys(),\r\n    /**\r\n     * Add an item to this collection.\r\n     * @param item\r\n     */\r\n    add(item: T) {\r\n      !items.has(item) && items.set(item, mkEntry(item));\r\n    },\r\n    /**\r\n     * Clear this collection.\r\n     */\r\n    clear() {\r\n      pendingPurge.length = 0;\r\n      reschedulePurge();\r\n      items.clear();\r\n      currentCohort = {};\r\n    },\r\n    /**\r\n     * @returns {[]} all the items in this collection, in insertion order.\r\n     */\r\n    toArray() {\r\n      return Array.from(items.keys());\r\n    },\r\n    /**\r\n     * Refresh the TTL for each item in this collection.\r\n     */\r\n    refresh() {\r\n      pendingPurge.length = 0;\r\n      reschedulePurge();\r\n      for (const entry of items.values()) {\r\n        entry.refresh();\r\n      }\r\n    },\r\n    /**\r\n     * Register a callback to be run when an item has expired and is about to be\r\n     * removed the from the collection.\r\n     * @param cb a callback that takes the expired item as argument\r\n     * @return an unregistration function.\r\n     */\r\n    onExpiry(cb: (item: T) => void) {\r\n      callbacks.push(cb);\r\n      return () => {\r\n        const idx = callbacks.indexOf(cb);\r\n        if (idx >= 0) {\r\n          callbacks.splice(idx, 1);\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n","import {getGlobal} from '../prebidGlobal.js';\r\nimport {PbPromise} from './promise.js';\r\n\r\nexport function pbYield(): Promise<void> {\r\n  const scheduler = getGlobal().scheduler ?? (window as any).scheduler;\r\n  return scheduler?.yield ? scheduler.yield() : PbPromise.resolve();\r\n}\r\n","import {isArrayOfNums, isInteger, isNumber, isPlainObject, isStr, logError, logWarn} from './utils.js';\r\nimport {config} from './config.js';\r\nimport {hook} from './hook.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport type {VideoBid} from \"./bidfactory.ts\";\r\nimport {ADPOD, type BaseMediaType} from \"./mediaTypes.ts\";\r\nimport type {ORTBImp} from \"./types/ortb/request.d.ts\";\r\nimport type {Size} from \"./types/common.d.ts\";\r\nimport type {AdUnitDefinition} from \"./adUnits.ts\";\r\n\r\nexport const OUTSTREAM = 'outstream';\r\nexport const INSTREAM = 'instream';\r\n\r\nconst ORTB_PARAMS = [\r\n  [ 'mimes', value => Array.isArray(value) && value.length > 0 && value.every(v => typeof v === 'string') ],\r\n  [ 'minduration', isInteger ],\r\n  [ 'maxduration', isInteger ],\r\n  [ 'startdelay', isInteger ],\r\n  [ 'maxseq', isInteger ],\r\n  [ 'poddur', isInteger ],\r\n  [ 'protocols', isArrayOfNums ],\r\n  [ 'w', isInteger ],\r\n  [ 'h', isInteger ],\r\n  [ 'podid', isStr ],\r\n  [ 'podseq', isInteger ],\r\n  [ 'rqddurs', isArrayOfNums ],\r\n  [ 'placement', isInteger ], // deprecated, see plcmt\r\n  [ 'plcmt', isInteger ],\r\n  [ 'linearity', isInteger ],\r\n  [ 'skip', value => [1, 0].includes(value) ],\r\n  [ 'skipmin', isInteger ],\r\n  [ 'skipafter', isInteger ],\r\n  [ 'sequence', isInteger ], // deprecated\r\n  [ 'slotinpod', isInteger ],\r\n  [ 'mincpmpersec', isNumber ],\r\n  [ 'battr', isArrayOfNums ],\r\n  [ 'maxextended', isInteger ],\r\n  [ 'minbitrate', isInteger ],\r\n  [ 'maxbitrate', isInteger ],\r\n  [ 'boxingallowed', isInteger ],\r\n  [ 'playbackmethod', isArrayOfNums ],\r\n  [ 'playbackend', isInteger ],\r\n  [ 'delivery', isArrayOfNums ],\r\n  [ 'pos', isInteger ],\r\n  [ 'api', isArrayOfNums ],\r\n  [ 'companiontype', isArrayOfNums ],\r\n  [ 'poddedupe', isArrayOfNums ]\r\n] as const;\r\n\r\n/**\r\n * List of OpenRTB 2.x video object properties with simple validators.\r\n * Not included: `companionad`, `durfloors`, `ext`\r\n * reference: https://github.com/InteractiveAdvertisingBureau/openrtb2.x/blob/main/2.6.md\r\n */\r\nexport const ORTB_VIDEO_PARAMS = new Map(ORTB_PARAMS);\r\n\r\nexport type VideoContext = typeof INSTREAM | typeof OUTSTREAM | typeof ADPOD;\r\n\r\nexport interface VideoMediaType extends BaseMediaType, Pick<ORTBImp['video'], (typeof ORTB_PARAMS)[number][0]> {\r\n  context: VideoContext;\r\n  playerSize?: Size | Size[];\r\n}\r\n\r\nexport function fillVideoDefaults(adUnit: AdUnitDefinition) {\r\n  const video = adUnit?.mediaTypes?.video;\r\n  if (video != null) {\r\n    if (video.plcmt == null) {\r\n      if (video.context === OUTSTREAM || [2, 3, 4].includes(video.placement)) {\r\n        video.plcmt = 4;\r\n      } else if (video.playbackmethod?.some?.(method => [2, 6].includes(method))) {\r\n        video.plcmt = 2;\r\n      }\r\n    }\r\n    const playerSize = isArrayOfNums(video.playerSize, 2)\r\n      ? video.playerSize\r\n      : Array.isArray(video.playerSize) && isArrayOfNums(video.playerSize[0]) ? video.playerSize[0] : null;\r\n    const size: [number, number] = isNumber(video.w) && isNumber(video.h) ? [video.w, video.h] : null;\r\n    let conflict = false;\r\n    if (playerSize == null) {\r\n      if (size != null) {\r\n        if (video.playerSize != null) {\r\n          conflict = true;\r\n        } else {\r\n          video.playerSize = [size];\r\n        }\r\n      }\r\n    } else {\r\n      ['w', 'h'].forEach((prop, i) => {\r\n        if (video[prop] != null && video[prop] !== playerSize[i]) {\r\n          conflict = true;\r\n        } else {\r\n          video[prop] = playerSize[i];\r\n        }\r\n      })\r\n    }\r\n    if (conflict) {\r\n      logWarn(`Ad unit \"${adUnit.code} has conflicting playerSize and w/h`, adUnit)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * validateOrtbVideoFields mutates the `adUnit.mediaTypes.video` object by removing invalid ortb properties (default).\r\n * The onInvalidParam callback can be used to handle invalid properties differently.\r\n * Other properties are ignored and kept as is.\r\n *\r\n * @param {Object} adUnit - The adUnit object.\r\n * @param {Function=} onInvalidParam - The callback function to be called with key, value, and adUnit.\r\n * @returns {void}\r\n */\r\nexport function validateOrtbVideoFields(adUnit, onInvalidParam?) {\r\n  const videoParams = adUnit?.mediaTypes?.video;\r\n\r\n  if (!isPlainObject(videoParams)) {\r\n    logWarn(`validateOrtbVideoFields: videoParams must be an object.`);\r\n    return;\r\n  }\r\n\r\n  if (videoParams != null) {\r\n    Object.entries(videoParams)\r\n      .forEach(([key, value]: any) => {\r\n        if (!ORTB_VIDEO_PARAMS.has(key)) {\r\n          return\r\n        }\r\n        const isValid = ORTB_VIDEO_PARAMS.get(key)(value);\r\n        if (!isValid) {\r\n          if (typeof onInvalidParam === 'function') {\r\n            onInvalidParam(key, value, adUnit);\r\n          } else {\r\n            delete videoParams[key];\r\n            logWarn(`Invalid prop in adUnit \"${adUnit.code}\": Invalid value for mediaTypes.video.${key} ORTB property. The property has been removed.`);\r\n          }\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\n/**\r\n * Validate that the assets required for video context are present on the bid\r\n */\r\nexport function isValidVideoBid(bid: VideoBid, {index = auctionManager.index} = {}): boolean {\r\n  const videoMediaType = index.getMediaTypes(bid)?.video;\r\n  const context = videoMediaType && videoMediaType?.context;\r\n  const useCacheKey = videoMediaType && videoMediaType?.useCacheKey;\r\n  const adUnit = index.getAdUnit(bid);\r\n\r\n  // if context not defined assume default 'instream' for video bids\r\n  // instream bids require a vast url or vast xml content\r\n  return checkVideoBidSetup(bid, adUnit, videoMediaType, context, useCacheKey);\r\n}\r\n\r\ndeclare module './bidfactory' {\r\n  interface VideoBidResponseProperties {\r\n    vastXml?: string;\r\n    vastUrl?: string;\r\n  }\r\n}\r\n\r\ndeclare module './hook' {\r\n  interface NamedHooks {\r\n    checkVideoBidSetup: typeof checkVideoBidSetup\r\n  }\r\n}\r\n\r\nexport const checkVideoBidSetup = hook('sync', function(bid: VideoBid, adUnit, videoMediaType, context, useCacheKey) {\r\n  if (videoMediaType && (useCacheKey || context !== OUTSTREAM)) {\r\n    // xml-only video bids require a prebid cache url\r\n    const { url, useLocal } = config.getConfig('cache') || {};\r\n    if ((!url && !useLocal) && bid.vastXml && !bid.vastUrl) {\r\n      logError(`\r\n        This bid contains only vastXml and will not work when a prebid cache url is not specified.\r\n        Try enabling either prebid cache with $$PREBID_GLOBAL$$.setConfig({ cache: {url: \"...\"} });\r\n        or local cache with $$PREBID_GLOBAL$$.setConfig({ cache: { useLocal: true }});\r\n      `);\r\n      return false;\r\n    }\r\n\r\n    return !!(bid.vastUrl || bid.vastXml);\r\n  }\r\n\r\n  // outstream bids require a renderer on the bid or pub-defined on adunit\r\n  if (context === OUTSTREAM && !useCacheKey) {\r\n    return !!(bid.renderer || (adUnit && adUnit.renderer) || videoMediaType.renderer);\r\n  }\r\n\r\n  return true;\r\n}, 'checkVideoBidSetup');\r\n","/**\r\n * This module interacts with the server used to cache video ad content to be restored later.\r\n * At a high level, the expected workflow goes like this:\r\n *\r\n *   - Request video ads from Bidders\r\n *   - Generate IDs for each valid bid, and cache the key/value pair on the server.\r\n *   - Return these IDs so that publishers can use them to fetch the bids later.\r\n *\r\n * This trickery helps integrate with ad servers, which set character limits on request params.\r\n */\r\n\r\nimport {ajaxBuilder} from './ajax.js';\r\nimport {config} from './config.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {generateUUID, logError, logWarn} from './utils.js';\r\nimport {addBidToAuction} from './auction.js';\r\nimport type {VideoBid} from \"./bidfactory.ts\";\r\n\r\n/**\r\n * Might be useful to be configurable in the future\r\n * Depending on publisher needs\r\n */\r\n// TODO: we have a `ttlBuffer` setting\r\nconst ttlBufferInSeconds = 15;\r\n\r\nexport const vastLocalCache = new Map();\r\n\r\n/**\r\n * Function which wraps a URI that serves VAST XML, so that it can be loaded.\r\n *\r\n * @param uri The URI where the VAST content can be found.\r\n * @param impTrackerURLs An impression tracker URL for the delivery of the video ad\r\n * @return A VAST URL which loads XML from the given URI.\r\n */\r\nfunction wrapURI(uri: string, impTrackerURLs: string | string[]) {\r\n  impTrackerURLs = impTrackerURLs && (Array.isArray(impTrackerURLs) ? impTrackerURLs : [impTrackerURLs]);\r\n  // Technically, this is vulnerable to cross-script injection by sketchy vastUrl bids.\r\n  // We could make sure it's a valid URI... but since we're loading VAST XML from the\r\n  // URL they provide anyway, that's probably not a big deal.\r\n  const impressions = impTrackerURLs ? impTrackerURLs.map(trk => `<Impression><![CDATA[${trk}]]></Impression>`).join('') : '';\r\n  return `<VAST version=\"3.0\">\r\n    <Ad>\r\n      <Wrapper>\r\n        <AdSystem>prebid.org wrapper</AdSystem>\r\n        <VASTAdTagURI><![CDATA[${uri}]]></VASTAdTagURI>\r\n        ${impressions}\r\n        <Creatives></Creatives>\r\n      </Wrapper>\r\n    </Ad>\r\n  </VAST>`;\r\n}\r\n\r\ndeclare module './bidfactory' {\r\n  interface VideoBidResponseProperties {\r\n    /**\r\n     *  VAST impression trackers to attach to this bid.\r\n     */\r\n    vastImpUrl?: string | string []\r\n    /**\r\n     * Cache key to use for caching this bid's VAST.\r\n     */\r\n    customCacheKey?: string\r\n  }\r\n  interface VideoBidProperties {\r\n    /**\r\n     * The cache key that was used for this bid.\r\n     */\r\n    videoCacheKey?: string;\r\n  }\r\n}\r\n\r\nexport interface CacheConfig {\r\n  /**\r\n   * The URL of the Prebid Cache server endpoint where VAST creatives will be sent.\r\n   */\r\n  url: string;\r\n  /**\r\n   * Flag determining whether to locally save VAST XML as a blob\r\n   */\r\n  useLocal?: boolean;\r\n  /**\r\n   * Timeout (in milliseconds) for network requests to the cache\r\n   */\r\n  timeout?: number;\r\n  /**\r\n   * Passes additional data to the url, used for additional event tracking data. Defaults to false.\r\n   */\r\n  vasttrack?: boolean;\r\n  /**\r\n   * If the bidder supplied their own cache key, setting this value to true adds a VAST wrapper around that URL,\r\n   * stores it in the cache defined by the url parameter, and replaces the original video cache key with the new one.\r\n   * This can dramatically simplify ad server setup because it means all VAST creatives reside behind a single URL.\r\n   * The tradeoff: this approach requires the video player to unwrap one extra level of VAST. Defaults to false.\r\n   */\r\n  ignoreBidderCacheKey?: boolean;\r\n  /**\r\n   * Enables video cache requests to be batched by a specified amount (defaults to 1) instead of making a single request per each video.\r\n   */\r\n  batchSize?: number;\r\n  /**\r\n   * Used in conjunction with batchSize, batchTimeout specifies how long to wait in milliseconds before sending\r\n   * a batch video cache request based on the value for batchSize (if present). A batch request will be made whether\r\n   * the batchSize amount was reached or the batchTimeout timer runs out. batchTimeout defaults to 0.\r\n   */\r\n  batchTimeout?: number;\r\n}\r\n\r\ndeclare module './config' {\r\n  interface Config {\r\n    cache?: CacheConfig;\r\n  }\r\n}\r\n/**\r\n * Wraps a bid in the format expected by the prebid-server endpoints, or returns null if\r\n * the bid can't be converted cleanly.\r\n *\r\n * @return {Object|null} - The payload to be sent to the prebid-server endpoints, or null if the bid can't be converted cleanly.\r\n */\r\nfunction toStorageRequest(bid, {index = auctionManager.index} = {}) {\r\n  const vastValue = getVastXml(bid);\r\n  const auction = index.getAuction(bid);\r\n  const ttlWithBuffer = Number(bid.ttl) + ttlBufferInSeconds;\r\n  const payload: any = {\r\n    type: 'xml',\r\n    value: vastValue,\r\n    ttlseconds: ttlWithBuffer\r\n  };\r\n\r\n  if (config.getConfig('cache.vasttrack')) {\r\n    payload.bidder = bid.bidder;\r\n    payload.bidid = bid.requestId;\r\n    payload.aid = bid.auctionId;\r\n  }\r\n\r\n  if (auction != null) {\r\n    payload.timestamp = auction.getAuctionStart();\r\n  }\r\n\r\n  if (typeof bid.customCacheKey === 'string' && bid.customCacheKey !== '') {\r\n    payload.key = bid.customCacheKey;\r\n  }\r\n\r\n  return payload;\r\n}\r\n\r\ninterface VideoCacheStoreCallback {\r\n  /**\r\n   * A function which should be called with the results of the storage operation.\r\n   *\r\n   * @param error The error, if one occurred.\r\n   * @param uuids An array of unique IDs. The array will have one element for each bid we were asked\r\n   *   to store. It may include null elements if some of the bids were malformed, or an error occurred.\r\n   *   Each non-null element in this array is a valid input into the retrieve function, which will fetch\r\n   *   some VAST XML which can be used to render this bid's ad.\r\n   */\r\n  (error: Error | null, uuids: { uuid: string }[])\r\n}\r\n\r\n/**\r\n * A function which bridges the APIs between the videoCacheStoreCallback and our ajax function's API.\r\n *\r\n * @param done A callback to the \"store\" function.\r\n */\r\nfunction shimStorageCallback(done: VideoCacheStoreCallback) {\r\n  return {\r\n    success: function (responseBody) {\r\n      let ids;\r\n      try {\r\n        ids = JSON.parse(responseBody).responses\r\n      } catch (e) {\r\n        done(e, []);\r\n        return;\r\n      }\r\n\r\n      if (ids) {\r\n        done(null, ids);\r\n      } else {\r\n        done(new Error(\"The cache server didn't respond with a responses property.\"), []);\r\n      }\r\n    },\r\n    error: function (statusText, responseBody) {\r\n      done(new Error(`Error storing video ad in the cache: ${statusText}: ${JSON.stringify(responseBody)}`), []);\r\n    }\r\n  }\r\n}\r\n\r\nfunction getVastXml(bid) {\r\n  return bid.vastXml ? bid.vastXml : wrapURI(bid.vastUrl, bid.vastImpUrl);\r\n};\r\n\r\n/**\r\n * If the given bid is for a Video ad, generate a unique ID and cache it somewhere server-side.\r\n *\r\n * @param bids A list of bid objects which should be cached.\r\n * @param done An optional callback which should be executed after\r\n * @param getAjax\r\n * the data has been stored in the cache.\r\n */\r\nexport function store(bids: VideoBid[], done?: VideoCacheStoreCallback, getAjax = ajaxBuilder) {\r\n  const requestData = {\r\n    puts: bids.map(bid => toStorageRequest(bid))\r\n  };\r\n  const ajax = getAjax(config.getConfig('cache.timeout'));\r\n  ajax(config.getConfig('cache.url'), shimStorageCallback(done), JSON.stringify(requestData), {\r\n    contentType: 'text/plain',\r\n    withCredentials: true\r\n  });\r\n}\r\n\r\nexport function getCacheUrl(id) {\r\n  return `${config.getConfig('cache.url')}?uuid=${id}`;\r\n}\r\n\r\nexport const storeLocally = (bid) => {\r\n  const vastXml = getVastXml(bid);\r\n  const bidVastUrl = URL.createObjectURL(new Blob([vastXml], { type: 'text/xml' }));\r\n\r\n  assignVastUrlAndCacheId(bid, bidVastUrl);\r\n\r\n  vastLocalCache.set(bid.videoCacheKey, bidVastUrl);\r\n};\r\n\r\nconst assignVastUrlAndCacheId = (bid, vastUrl, videoCacheKey?) => {\r\n  bid.videoCacheKey = videoCacheKey || generateUUID();\r\n  if (!bid.vastUrl) {\r\n    bid.vastUrl = vastUrl;\r\n  }\r\n}\r\n\r\nexport const _internal = {\r\n  store\r\n}\r\n\r\nexport function storeBatch(batch) {\r\n  const bids = batch.map(entry => entry.bidResponse)\r\n  function err(msg) {\r\n    logError(`Failed to save to the video cache: ${msg}. Video bids will be discarded:`, bids)\r\n  }\r\n  _internal.store(bids, function (error, cacheIds) {\r\n    if (error) {\r\n      err(error)\r\n    } else if (batch.length !== cacheIds.length) {\r\n      logError(`expected ${batch.length} cache IDs, got ${cacheIds.length} instead`)\r\n    } else {\r\n      cacheIds.forEach((cacheId, i) => {\r\n        const {auctionInstance, bidResponse, afterBidAdded} = batch[i];\r\n        if (cacheId.uuid === '') {\r\n          logWarn(`Supplied video cache key was already in use by Prebid Cache; caching attempt was rejected. Video bid must be discarded.`);\r\n        } else {\r\n          assignVastUrlAndCacheId(bidResponse, getCacheUrl(cacheId.uuid), cacheId.uuid);\r\n          addBidToAuction(auctionInstance, bidResponse);\r\n          afterBidAdded();\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nlet batchSize, batchTimeout, cleanupHandler;\r\nif (FEATURES.VIDEO) {\r\n  config.getConfig('cache', ({cache}) => {\r\n    batchSize = typeof cache.batchSize === 'number' && cache.batchSize > 0\r\n      ? cache.batchSize\r\n      : 1;\r\n    batchTimeout = typeof cache.batchTimeout === 'number' && cache.batchTimeout > 0\r\n      ? cache.batchTimeout\r\n      : 0;\r\n\r\n    // removing blobs that are not going to be used\r\n    if (cache.useLocal && !cleanupHandler) {\r\n      cleanupHandler = auctionManager.onExpiry((auction) => {\r\n        auction.getBidsReceived()\r\n          .forEach((bid) => {\r\n            const vastUrl = vastLocalCache.get(bid.videoCacheKey)\r\n            if (vastUrl && vastUrl.startsWith('blob')) {\r\n              URL.revokeObjectURL(vastUrl);\r\n            }\r\n            vastLocalCache.delete(bid.videoCacheKey);\r\n          })\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport const batchingCache = (timeout = setTimeout, cache = storeBatch) => {\r\n  let batches = [[]];\r\n  let debouncing = false;\r\n  const noTimeout = cb => cb();\r\n\r\n  return function (auctionInstance, bidResponse, afterBidAdded) {\r\n    const batchFunc = batchTimeout > 0 ? timeout : noTimeout;\r\n    if (batches[batches.length - 1].length >= batchSize) {\r\n      batches.push([]);\r\n    }\r\n\r\n    batches[batches.length - 1].push({auctionInstance, bidResponse, afterBidAdded});\r\n\r\n    if (!debouncing) {\r\n      debouncing = true;\r\n      batchFunc(() => {\r\n        batches.forEach(cache);\r\n        batches = [[]];\r\n        debouncing = false;\r\n      }, batchTimeout);\r\n    }\r\n  };\r\n};\r\n\r\nexport const batchAndStore = batchingCache();\r\n","import {getWinDimensions, getWindowTop} from '../../src/utils.js';\r\n\r\nexport function getViewportCoordinates() {\r\n  try {\r\n    const win = getWindowTop();\r\n    const { scrollY: top, scrollX: left } = win;\r\n    const { height: innerHeight, width: innerWidth } = getViewportSize();\r\n    return { top, right: left + innerWidth, bottom: top + innerHeight, left };\r\n  } catch (e) {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport function getViewportSize() {\r\n  const windowDimensions = getWinDimensions();\r\n  try {\r\n    const innerHeight = windowDimensions.innerHeight || windowDimensions.document.documentElement.clientHeight || windowDimensions.document.body.clientHeight || 0;\r\n    const innerWidth = windowDimensions.innerWidth || windowDimensions.document.documentElement.clientWidth || windowDimensions.document.body.clientWidth || 0;\r\n    return { width: innerWidth, height: innerHeight };\r\n  } catch (e) {\r\n    return {};\r\n  }\r\n}\r\n","// this file is autogenerated, see creative/README.md\r\nexport const RENDERER = \"(()=>{\\\"use strict\\\";window.render=function(e,t,n){let{ad:r,adUrl:i,width:o,height:d,instl:h}=e,{mkFrame:l}=t;if(!r&&!i){const e=new Error(\\\"Missing ad markup or URL\\\");throw e.reason=\\\"noAd\\\",e}{if(null==d){const e=n.document?.body;[e,e?.parentElement].filter((e=>null!=e?.style)).forEach((e=>e.style.height=\\\"100%\\\"))}const e=n.document,t={width:o??\\\"100%\\\",height:d??\\\"100%\\\"};if(i&&!r?t.src=i:t.srcdoc=r,e.body.appendChild(l(e,t)),h&&n.frameElement){const e=n.frameElement.style;e.width=o?`${o}px`:\\\"100vw\\\",e.height=d?`${d}px`:\\\"100vh\\\"}}}})();\"","import {_each, deepAccess, isArray, isNumber, isStr, mergeDeep, logWarn} from '../../src/utils.js';\r\nimport {getAllOrtbKeywords} from '../keywords/keywords.js';\r\nimport {CLIENT_SECTIONS} from '../../src/fpd/oneClient.js';\r\n\r\nconst ORTB_SEGTAX_KEY_MAP = {\r\n  526: '1plusX',\r\n  527: '1plusX',\r\n  541: 'captify_segments',\r\n  540: 'perid'\r\n};\r\nconst ORTB_SEG_PATHS = ['user.data'].concat(\r\n  CLIENT_SECTIONS.map((prefix) => `${prefix}.content.data`)\r\n);\r\n\r\nfunction getValueString(param, val, defaultValue) {\r\n  if (val === undefined || val === null) {\r\n    return defaultValue;\r\n  }\r\n  if (isStr(val)) {\r\n    return val;\r\n  }\r\n  if (isNumber(val)) {\r\n    return val.toString();\r\n  }\r\n  logWarn('Unsuported type for param: ' + param + ' required type: String');\r\n}\r\n\r\n/**\r\n * Converts an object of arrays (either strings or numbers) into an array of objects containing key and value properties\r\n * normally read from bidder params\r\n * eg { foo: ['bar', 'baz'], fizz: ['buzz'] }\r\n * becomes [{ key: 'foo', value: ['bar', 'baz']}, {key: 'fizz', value: ['buzz']}]\r\n * @param {Object} keywords object of arrays representing keyvalue pairs\r\n * @param {string} paramName name of parent object (eg 'keywords') containing keyword data, used in error handling\r\n * @returns {Array<{key, value}>}\r\n */\r\nexport function transformBidderParamKeywords(keywords, paramName = 'keywords') {\r\n  const arrs = [];\r\n\r\n  _each(keywords, (v, k) => {\r\n    if (isArray(v)) {\r\n      const values = [];\r\n      _each(v, (val) => {\r\n        val = getValueString(paramName + '.' + k, val);\r\n        if (val || val === '') {\r\n          values.push(val);\r\n        }\r\n      });\r\n      v = values;\r\n    } else {\r\n      v = getValueString(paramName + '.' + k, v);\r\n      if (isStr(v)) {\r\n        v = [v];\r\n      } else {\r\n        return;\r\n      } // unsuported types - don't send a key\r\n    }\r\n    v = v.filter(kw => kw !== '')\r\n    const entry = {key: k}\r\n    if (v.length > 0) {\r\n      entry.value = v;\r\n    }\r\n    arrs.push(entry);\r\n  });\r\n\r\n  return arrs;\r\n}\r\n\r\n// converts a comma separated list of keywords into the standard keyword object format used in appnexus bid params\r\n// 'genre=rock,genre=pop,pets=dog,music' goes to { 'genre': ['rock', 'pop'], 'pets': ['dog'], 'music': [''] }\r\nexport function convertKeywordStringToANMap(keyStr) {\r\n  if (isStr(keyStr) && keyStr !== '') {\r\n    // will split based on commas and will eat white space before/after the comma\r\n    return convertKeywordsToANMap(keyStr.split(/\\s*(?:,)\\s*/));\r\n  } else {\r\n    return {}\r\n  }\r\n}\r\n\r\n/**\r\n * @param {Array<String>} kwarray keywords as an array of strings\r\n * @return {{}} appnexus-style keyword map\r\n */\r\nfunction convertKeywordsToANMap(kwarray) {\r\n  const result = {};\r\n  kwarray.forEach(kw => {\r\n    // if = exists, then split\r\n    if (kw.indexOf('=') !== -1) {\r\n      const kwPair = kw.split('=');\r\n      const key = kwPair[0];\r\n      const val = kwPair[1];\r\n\r\n      // then check for existing key in result > if so add value to the array > if not, add new key and create value array\r\n      if (result.hasOwnProperty(key)) {\r\n        result[key].push(val);\r\n      } else {\r\n        result[key] = [val];\r\n      }\r\n    } else {\r\n      if (!result.hasOwnProperty(kw)) {\r\n        result[kw] = [];\r\n      }\r\n    }\r\n  })\r\n  return result;\r\n}\r\n\r\n/**\r\n * @param ortb2\r\n * @return {{}} appnexus-style keyword map using all keywords contained in ortb2\r\n */\r\nexport function getANMapFromOrtbKeywords(ortb2) {\r\n  return convertKeywordsToANMap(getAllOrtbKeywords(ortb2));\r\n}\r\n\r\nexport function getANKewyordParamFromMaps(...anKeywordMaps) {\r\n  return transformBidderParamKeywords(\r\n    mergeDeep(...anKeywordMaps.map(kwMap => Object.fromEntries(\r\n      Object.entries(kwMap || {})\r\n        .map(([k, v]) => [k, (isNumber(v) || isStr(v)) ? [v] : v])\r\n    )))\r\n  )\r\n}\r\n\r\nexport function getANMapFromOrtbIASKeywords(ortb2) {\r\n  const iasBrandSafety = ortb2?.site?.ext?.data?.['ias-brand-safety'];\r\n  if (iasBrandSafety && typeof iasBrandSafety === 'object' && Object.keys(iasBrandSafety).length > 0) {\r\n    // Convert IAS object to array of key=value strings\r\n    const iasArray = Object.entries(iasBrandSafety).map(([key, value]) => `${key}=${value}`);\r\n    return convertKeywordsToANMap(iasArray);\r\n  }\r\n  return {};\r\n}\r\n\r\nexport function getANKeywordParam(ortb2, ...anKeywordsMaps) {\r\n  return getANKewyordParamFromMaps(\r\n    getANMapFromOrtbKeywords(ortb2),\r\n    getANMapFromOrtbIASKeywords(ortb2), // <-- include IAS\r\n    getANMapFromOrtbSegments(ortb2),\r\n    ...anKeywordsMaps\r\n  )\r\n}\r\n\r\nexport function getANMapFromOrtbSegments(ortb2) {\r\n  const ortbSegData = {};\r\n  ORTB_SEG_PATHS.forEach(path => {\r\n    const ortbSegsArrObj = deepAccess(ortb2, path) || [];\r\n    ortbSegsArrObj.forEach(segObj => {\r\n      // only read segment data from known sources\r\n      const segtax = ORTB_SEGTAX_KEY_MAP[segObj?.ext?.segtax];\r\n      if (segtax) {\r\n        segObj.segment.forEach(seg => {\r\n          // if source was in multiple locations of ortb or had multiple segments in same area, stack them together into an array\r\n          if (ortbSegData[segtax]) {\r\n            ortbSegData[segtax].push(seg.id);\r\n          } else {\r\n            ortbSegData[segtax] = [seg.id]\r\n          }\r\n        });\r\n      }\r\n    });\r\n  });\r\n  return ortbSegData;\r\n}\r\n","/**\r\n * Converts a string value in camel-case to underscore eg 'placementId' becomes 'placement_id'\r\n * @param {string} value string value to convert\r\n */\r\nimport {deepClone, isPlainObject} from '../../src/utils.js';\r\n\r\nexport function convertCamelToUnderscore(value) {\r\n  return value.replace(/(?:^|\\.?)([A-Z])/g, function (x, y) {\r\n    return '_' + y.toLowerCase();\r\n  }).replace(/^_/, '');\r\n}\r\n\r\nexport const appnexusAliases = [\r\n  { code: 'appnexusAst', gvlid: 32 },\r\n  { code: 'emetriq', gvlid: 213 },\r\n  { code: 'pagescience', gvlid: 32 },\r\n  { code: 'gourmetads', gvlid: 32 },\r\n  { code: 'matomy', gvlid: 32 },\r\n  { code: 'featureforward', gvlid: 32 },\r\n  { code: 'oftmedia', gvlid: 32 },\r\n  { code: 'adasta', gvlid: 32 },\r\n  { code: 'beintoo', gvlid: 618 },\r\n  { code: 'projectagora', gvlid: 1032 },\r\n  { code: 'stailamedia', gvlid: 32 },\r\n  { code: 'uol', gvlid: 32 },\r\n  { code: 'adzymic', gvlid: 723 },\r\n];\r\n\r\n/**\r\n * Creates an array of n length and fills each item with the given value\r\n */\r\nexport function fill(value, length) {\r\n  const newArray = [];\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const valueToPush = isPlainObject(value) ? deepClone(value) : value;\r\n    newArray.push(valueToPush);\r\n  }\r\n\r\n  return newArray;\r\n}\r\n","import {isFn} from '../../src/utils.js';\r\n\r\n/**\r\n * Try to convert a value to a type.\r\n * If it can't be done, the value will be returned.\r\n *\r\n * @param {string} typeToConvert The target type. e.g. \"string\", \"number\", etc.\r\n * @param {*} value The value to be converted into typeToConvert.\r\n */\r\nfunction tryConvertType(typeToConvert, value) {\r\n  if (typeToConvert === 'string') {\r\n    return value && value.toString();\r\n  } else if (typeToConvert === 'number') {\r\n    return Number(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nexport function convertTypes(types, params) {\r\n  Object.keys(types).forEach(key => {\r\n    if (params[key]) {\r\n      if (isFn(types[key])) {\r\n        params[key] = types[key](params[key]);\r\n      } else {\r\n        params[key] = tryConvertType(types[key], params[key]);\r\n      }\r\n\r\n      // don't send invalid values\r\n      if (isNaN(params[key])) {\r\n        delete params.key;\r\n      }\r\n    }\r\n  });\r\n  return params;\r\n}\r\n","import {CLIENT_SECTIONS} from '../../src/fpd/oneClient.js';\r\nimport {deepAccess} from '../../src/utils.js';\r\n\r\nconst ORTB_KEYWORDS_PATHS = ['user.keywords'].concat(\r\n  CLIENT_SECTIONS.flatMap((prefix) => ['keywords', 'content.keywords'].map(suffix => `${prefix}.${suffix}`))\r\n);\r\n\r\n/**\r\n * @param commaSeparatedKeywords any number of either keyword arrays, or comma-separated keyword strings\r\n * @returns an array with all unique keywords contained across all inputs\r\n */\r\nexport function mergeKeywords(...commaSeparatedKeywords) {\r\n  const keywords = new Set();\r\n  commaSeparatedKeywords\r\n    .filter(kwds => kwds)\r\n    .flatMap(kwds => Array.isArray(kwds) ? kwds : kwds.split(','))\r\n    .map(kw => kw.replace(/^\\s*/, '').replace(/\\s*$/, ''))\r\n    .filter(kw => kw)\r\n    .forEach(kw => keywords.add(kw));\r\n  return Array.from(keywords.keys());\r\n}\r\n\r\n/**\r\n * Get an array with all keywords contained in an ortb2 object.\r\n */\r\nexport function getAllOrtbKeywords(ortb2, ...extraCommaSeparatedKeywords) {\r\n  return mergeKeywords(\r\n    ...ORTB_KEYWORDS_PATHS.map(path => deepAccess(ortb2, path)),\r\n    ...extraCommaSeparatedKeywords\r\n  )\r\n}\r\n","/**\r\n * http://npm.im/chunk\r\n * Returns an array with *size* chunks from given array\r\n *\r\n * Example:\r\n * ['a', 'b', 'c', 'd', 'e'] chunked by 2 =>\r\n * [['a', 'b'], ['c', 'd'], ['e']]\r\n */\r\nexport function chunk(array, size) {\r\n  const newArray = [];\r\n\r\n  for (let i = 0; i < Math.ceil(array.length / size); i++) {\r\n    const start = i * size;\r\n    const end = start + size;\r\n    newArray.push(array.slice(start, end));\r\n  }\r\n\r\n  return newArray;\r\n}\r\n","/**\r\n * Provides mapping objects used by bidders for categoryTranslation type logic for Adpod feature\r\n */\r\nexport const APPNEXUS_CATEGORY_MAPPING = {\r\n  '1': 'IAB20-3',\r\n  '2': 'IAB18-5',\r\n  '3': 'IAB10-1',\r\n  '4': 'IAB2-3',\r\n  '5': 'IAB19-8',\r\n  '6': 'IAB22-1',\r\n  '7': 'IAB18-1',\r\n  '8': 'IAB12-3',\r\n  '9': 'IAB5-1',\r\n  '10': 'IAB4-5',\r\n  '11': 'IAB13-4',\r\n  '12': 'IAB8-7',\r\n  '13': 'IAB9-7',\r\n  '14': 'IAB7-1',\r\n  '15': 'IAB20-18',\r\n  '16': 'IAB10-7',\r\n  '17': 'IAB19-18',\r\n  '18': 'IAB13-6',\r\n  '19': 'IAB18-4',\r\n  '20': 'IAB1-5',\r\n  '21': 'IAB1-6',\r\n  '22': 'IAB3-4',\r\n  '23': 'IAB19-13',\r\n  '24': 'IAB22-2',\r\n  '25': 'IAB3-9',\r\n  '26': 'IAB17-18',\r\n  '27': 'IAB19-6',\r\n  '28': 'IAB1-7',\r\n  '29': 'IAB9-30',\r\n  '30': 'IAB20-7',\r\n  '31': 'IAB20-17',\r\n  '32': 'IAB7-32',\r\n  '33': 'IAB16-5',\r\n  '34': 'IAB19-34',\r\n  '35': 'IAB11-5',\r\n  '36': 'IAB12-3',\r\n  '37': 'IAB11-4',\r\n  '38': 'IAB12-3',\r\n  '39': 'IAB9-30',\r\n  '41': 'IAB7-44',\r\n  '42': 'IAB7-1',\r\n  '43': 'IAB7-30',\r\n  '50': 'IAB19-30',\r\n  '51': 'IAB17-12',\r\n  '52': 'IAB19-30',\r\n  '53': 'IAB3-1',\r\n  '55': 'IAB13-2',\r\n  '56': 'IAB19-30',\r\n  '57': 'IAB19-30',\r\n  '58': 'IAB7-39',\r\n  '59': 'IAB22-1',\r\n  '60': 'IAB7-39',\r\n  '61': 'IAB21-3',\r\n  '62': 'IAB5-1',\r\n  '63': 'IAB12-3',\r\n  '64': 'IAB20-18',\r\n  '65': 'IAB11-2',\r\n  '66': 'IAB17-18',\r\n  '67': 'IAB9-9',\r\n  '68': 'IAB9-5',\r\n  '69': 'IAB7-44',\r\n  '71': 'IAB22-3',\r\n  '73': 'IAB19-30',\r\n  '74': 'IAB8-5',\r\n  '78': 'IAB22-1',\r\n  '85': 'IAB12-2',\r\n  '86': 'IAB22-3',\r\n  '87': 'IAB11-3',\r\n  '112': 'IAB7-32',\r\n  '113': 'IAB7-32',\r\n  '114': 'IAB7-32',\r\n  '115': 'IAB7-32',\r\n  '118': 'IAB9-5',\r\n  '119': 'IAB9-5',\r\n  '120': 'IAB9-5',\r\n  '121': 'IAB9-5',\r\n  '122': 'IAB9-5',\r\n  '123': 'IAB9-5',\r\n  '124': 'IAB9-5',\r\n  '125': 'IAB9-5',\r\n  '126': 'IAB9-5',\r\n  '127': 'IAB22-1',\r\n  '132': 'IAB1-2',\r\n  '133': 'IAB19-30',\r\n  '137': 'IAB3-9',\r\n  '138': 'IAB19-3',\r\n  '140': 'IAB2-3',\r\n  '141': 'IAB2-1',\r\n  '142': 'IAB2-3',\r\n  '143': 'IAB17-13',\r\n  '166': 'IAB11-4',\r\n  '175': 'IAB3-1',\r\n  '176': 'IAB13-4',\r\n  '182': 'IAB8-9',\r\n  '183': 'IAB3-5'\r\n};\r\n","import {PbPromise} from '../../src/utils/promise.js';\r\n\r\n/**\r\n * @typedef {function} CMPClient\r\n *\r\n * @param {{}} params CMP parameters. Currently this is a subset of {command, callback, parameter, version}.\r\n * @param {boolean} once if true, discard cross-frame event listeners once a reply message is received.\r\n * @returns {Promise<*>} a promise to the API's \"result\" - see the `mode` argument to `cmpClient` on how that's determined.\r\n * @property {boolean} isDirect true if the CMP is directly accessible (no postMessage required)\r\n * @property {() => void} close close the client; currently, this just stops listening for cross-frame messages.\r\n */\r\n\r\nexport const MODE_MIXED = 0;\r\nexport const MODE_RETURN = 1;\r\nexport const MODE_CALLBACK = 2;\r\n\r\n/**\r\n * Returns a client function that can interface with a CMP regardless of where it's located.\r\n *\r\n * @param {object} obj\r\n * @param obj.apiName name of the CMP api, e.g. \"__gpp\"\r\n * @param [obj.apiVersion] CMP API version\r\n * @param [obj.apiArgs] names of the arguments taken by the api function, in order.\r\n * @param [obj.callbackArgs] names of the cross-frame response payload properties that should be passed as callback arguments, in order\r\n * @param [obj.mode] controls the callbacks passed to the underlying API, and how the promises returned by the client are resolved.\r\n *\r\n * The client behaves differently when it's provided a `callback` argument vs when it's not - for short, let's name these\r\n * cases \"subscriptions\" and \"one-shot calls\" respectively:\r\n *\r\n * With `mode: MODE_MIXED` (the default), promises returned on subscriptions are resolved to undefined when the callback\r\n * is first run (that is, the promise resolves when the CMP replies, but what it replies with is discarded and\r\n * left for the callback to deal with). For one-shot calls, the returned promise is resolved to the API's\r\n * return value when it's directly accessible, or with the result from the first (and, presumably, the only)\r\n * cross-frame reply when it's not;\r\n *\r\n * With `mode: MODE_RETURN`, the returned promise always resolves to the API's return value - which is taken to be undefined\r\n * when cross-frame;\r\n *\r\n * With `mode: MODE_CALLBACK`, the underlying API is expected to never directly return anything significant; instead,\r\n * it should always accept a callback and - for one-shot calls - invoke it only once with the result. The client will\r\n * automatically generate an appropriate callback for one-shot calls and use the result it's given to resolve\r\n * the returned promise. Subscriptions are treated in the same way as MODE_MIXED.\r\n *\r\n * @param win\r\n * @returns {CMPClient} CMP invocation function (or null if no CMP was found).\r\n */\r\nexport function cmpClient(\r\n  {\r\n    apiName,\r\n    apiVersion,\r\n    apiArgs = ['command', 'callback', 'parameter', 'version'],\r\n    callbackArgs = ['returnValue', 'success'],\r\n    mode = MODE_MIXED,\r\n  },\r\n  win = window\r\n) {\r\n  const cmpCallbacks = {};\r\n  const callName = `${apiName}Call`;\r\n  const cmpDataPkgName = `${apiName}Return`;\r\n\r\n  function handleMessage(event) {\r\n    const json = (typeof event.data === 'string' && event.data.includes(cmpDataPkgName)) ? JSON.parse(event.data) : event.data;\r\n    if (json?.[cmpDataPkgName]?.callId) {\r\n      const payload = json[cmpDataPkgName];\r\n\r\n      if (cmpCallbacks.hasOwnProperty(payload.callId)) {\r\n        cmpCallbacks[payload.callId](...callbackArgs.map(name => payload[name]));\r\n      }\r\n    }\r\n  }\r\n\r\n  function findCMP() {\r\n    let f = win;\r\n    let cmpFrame;\r\n    let isDirect = false;\r\n    while (f != null) {\r\n      try {\r\n        if (typeof f[apiName] === 'function') {\r\n          cmpFrame = f;\r\n          isDirect = true;\r\n          break;\r\n        }\r\n      } catch (e) {\r\n      }\r\n\r\n      // need separate try/catch blocks due to the exception errors thrown when trying to check for a frame that doesn't exist in 3rd party env\r\n      try {\r\n        if (f.frames[`${apiName}Locator`]) {\r\n          cmpFrame = f;\r\n          break;\r\n        }\r\n      } catch (e) {\r\n      }\r\n\r\n      if (f === win.top) break;\r\n      f = f.parent;\r\n    }\r\n\r\n    return [\r\n      cmpFrame,\r\n      isDirect\r\n    ];\r\n  }\r\n\r\n  const [cmpFrame, isDirect] = findCMP();\r\n\r\n  if (!cmpFrame) {\r\n    return;\r\n  }\r\n\r\n  function resolveParams(params) {\r\n    params = Object.assign({version: apiVersion}, params);\r\n    return apiArgs.map(arg => [arg, params[arg]])\r\n  }\r\n\r\n  function wrapCallback(callback, resolve, reject, preamble) {\r\n    const haveCb = typeof callback === 'function';\r\n\r\n    return function (result, success) {\r\n      preamble && preamble();\r\n      if (mode !== MODE_RETURN) {\r\n        const resolver = success == null || success ? resolve : reject;\r\n        resolver(haveCb ? undefined : result);\r\n      }\r\n      haveCb && callback.apply(this, arguments);\r\n    }\r\n  }\r\n\r\n  let client;\r\n\r\n  if (isDirect) {\r\n    client = function invokeCMPDirect(params = {}) {\r\n      return new PbPromise((resolve, reject) => {\r\n        const ret = cmpFrame[apiName](...resolveParams({\r\n          ...params,\r\n          callback: (params.callback || mode === MODE_CALLBACK) ? wrapCallback(params.callback, resolve, reject) : undefined,\r\n        }).map(([_, val]) => val));\r\n        if (mode === MODE_RETURN || (params.callback == null && mode === MODE_MIXED)) {\r\n          resolve(ret);\r\n        }\r\n      });\r\n    };\r\n  } else {\r\n    win.addEventListener('message', handleMessage, false);\r\n\r\n    client = function invokeCMPFrame(params, once = false) {\r\n      return new PbPromise((resolve, reject) => {\r\n        // call CMP via postMessage\r\n        const callId = Math.random().toString();\r\n        const msg = {\r\n          [callName]: {\r\n            ...Object.fromEntries(resolveParams(params).filter(([param]) => param !== 'callback')),\r\n            callId: callId\r\n          }\r\n        };\r\n\r\n        cmpCallbacks[callId] = wrapCallback(params?.callback, resolve, reject, (once || params?.callback == null) && (() => { delete cmpCallbacks[callId] }));\r\n        cmpFrame.postMessage(msg, '*');\r\n        if (mode === MODE_RETURN) resolve();\r\n      });\r\n    };\r\n  }\r\n  return Object.assign(client, {\r\n    isDirect,\r\n    close() {\r\n      !isDirect && win.removeEventListener('message', handleMessage);\r\n    }\r\n  })\r\n}\r\n","import {timedAuctionHook} from '../../src/utils/perfMetrics.js';\r\nimport {isNumber, isPlainObject, isStr, logError, logInfo, logWarn} from '../../src/utils.js';\r\nimport {ConsentHandler} from '../../src/consentHandler.js';\r\nimport {PbPromise} from '../../src/utils/promise.js';\r\nimport {buildActivityParams} from '../../src/activities/params.js';\r\nimport {getHook} from '../../src/hook.js';\r\n\r\nexport function consentManagementHook(name, loadConsentData) {\r\n  const SEEN = new WeakSet();\r\n  return timedAuctionHook(name, function requestBidsHook(fn, reqBidsConfigObj) {\r\n    return loadConsentData().then(({consentData, error}) => {\r\n      if (error && (!consentData || !SEEN.has(error))) {\r\n        SEEN.add(error);\r\n        logWarn(error.message, ...(error.args || []));\r\n      }\r\n      fn.call(this, reqBidsConfigObj);\r\n    }).catch((error) => {\r\n      logError(`${error?.message} Canceling auction as per consentManagement config.`, ...(error?.args || []));\r\n      fn.stopTiming();\r\n      if (typeof reqBidsConfigObj.bidsBackHandler === 'function') {\r\n        reqBidsConfigObj.bidsBackHandler();\r\n      } else {\r\n        logError('Error executing bidsBackHandler');\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n *\r\n * @typedef {Function} CmpLookupFn CMP lookup function. Should set up communication and keep consent data updated\r\n *   through consent data handlers' `setConsentData`.\r\n * @param {SetProvisionalConsent} setProvisionalConsent optionally, the function can call this with provisional consent\r\n *   data, which will be used if the lookup times out before \"proper\" consent data can be retrieved.\r\n * @returns {Promise<{void}>} a promise that resolves when the auction should be continued, or rejects if it should be canceled.\r\n *\r\n * @typedef {Function} SetProvisionalConsent\r\n * @param {*} provisionalConsent\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * Look up consent data from CMP or config.\r\n *\r\n * @param {Object} options\r\n * @param {String} options.name e.g. 'GPP'. Used only for log messages.\r\n * @param {ConsentHandler} options.consentDataHandler consent data handler object (from src/consentHandler)\r\n * @param {CmpLookupFn} options.setupCmp\r\n * @param {Number?} options.cmpTimeout timeout (in ms) after which the auction should continue without consent data.\r\n * @param {Number?} options.actionTimeout timeout (in ms) from when provisional consent is available to when the auction should continue with it\r\n * @param {() => {}} options.getNullConsent consent data to use on timeout\r\n * @returns {Promise<{error: Error, consentData: {}}>}\r\n */\r\nexport function lookupConsentData(\r\n  {\r\n    name,\r\n    consentDataHandler,\r\n    setupCmp,\r\n    cmpTimeout,\r\n    actionTimeout,\r\n    getNullConsent\r\n  }\r\n) {\r\n  consentDataHandler.enable();\r\n  let timeoutHandle;\r\n\r\n  return new Promise((resolve, reject) => {\r\n    let provisionalConsent;\r\n    let cmpLoaded = false;\r\n\r\n    function setProvisionalConsent(consentData) {\r\n      provisionalConsent = consentData;\r\n      if (!cmpLoaded) {\r\n        cmpLoaded = true;\r\n        actionTimeout != null && resetTimeout(actionTimeout);\r\n      }\r\n    }\r\n\r\n    function resetTimeout(timeout) {\r\n      if (timeoutHandle != null) clearTimeout(timeoutHandle);\r\n      if (timeout != null) {\r\n        timeoutHandle = setTimeout(() => {\r\n          const consentData = consentDataHandler.getConsentData() ?? (cmpLoaded ? provisionalConsent : getNullConsent());\r\n          const message = `timeout waiting for ${cmpLoaded ? 'user action on CMP' : 'CMP to load'}`;\r\n          consentDataHandler.setConsentData(consentData);\r\n          resolve({consentData, error: new Error(`${name} ${message}`)});\r\n        }, timeout);\r\n      } else {\r\n        timeoutHandle = null;\r\n      }\r\n    }\r\n    setupCmp(setProvisionalConsent)\r\n      .then(() => resolve({consentData: consentDataHandler.getConsentData()}), reject);\r\n    cmpTimeout != null && resetTimeout(cmpTimeout);\r\n  }).finally(() => {\r\n    timeoutHandle && clearTimeout(timeoutHandle);\r\n  }).catch((e) => {\r\n    consentDataHandler.setConsentData(null);\r\n    throw e;\r\n  });\r\n}\r\n\r\nexport interface BaseCMConfig {\r\n  /**\r\n   * Length of time (in milliseconds) to delay auctions while waiting for consent data from the CMP.\r\n   * Default is 10,000.\r\n   */\r\n  timeout?: number;\r\n  /**\r\n   * Length of time (in milliseconds) to delay auctions while waiting for the user to interact with the CMP.\r\n   * When set, auctions will wait up to `timeout` for the CMP to load, and once loaded up to `actionTimeout`\r\n   * for the user to interact with the CMP.\r\n   */\r\n  actionTimeout?: number;\r\n}\r\n\r\nexport interface IABCMConfig {\r\n  cmpApi?: 'iab';\r\n  consentData?: undefined;\r\n}\r\nexport interface StaticCMConfig<T> {\r\n  cmpApi: 'static';\r\n  /**\r\n   * Consent data as would be returned by a CMP.\r\n   */\r\n  consentData: T;\r\n}\r\n\r\nexport type CMConfig<T> = BaseCMConfig & (IABCMConfig | StaticCMConfig<T>);\r\n\r\nexport function configParser(\r\n  {\r\n    namespace,\r\n    displayName,\r\n    consentDataHandler,\r\n    parseConsentData,\r\n    getNullConsent,\r\n    cmpHandlers,\r\n    DEFAULT_CMP = 'iab',\r\n    DEFAULT_CONSENT_TIMEOUT = 10000\r\n  } = {} as any\r\n) {\r\n  function msg(message) {\r\n    return `consentManagement.${namespace} ${message}`;\r\n  }\r\n  let requestBidsHook, cdLoader, staticConsentData;\r\n\r\n  function attachActivityParams(next, params) {\r\n    return next(Object.assign({[`${namespace}Consent`]: consentDataHandler.getConsentData()}, params));\r\n  }\r\n\r\n  function loadConsentData() {\r\n    return cdLoader().then(({error}) => ({error, consentData: consentDataHandler.getConsentData()}))\r\n  }\r\n\r\n  function activate() {\r\n    if (requestBidsHook == null) {\r\n      requestBidsHook = consentManagementHook(namespace, () => cdLoader());\r\n      getHook('requestBids').before(requestBidsHook, 50);\r\n      buildActivityParams.before(attachActivityParams);\r\n      logInfo(`${displayName} consentManagement module has been activated...`)\r\n    }\r\n  }\r\n\r\n  function reset() {\r\n    if (requestBidsHook != null) {\r\n      getHook('requestBids').getHooks({hook: requestBidsHook}).remove();\r\n      buildActivityParams.getHooks({hook: attachActivityParams}).remove();\r\n      requestBidsHook = null;\r\n    }\r\n  }\r\n\r\n  return function getConsentConfig(config: { [key: string]: CMConfig<any> }) {\r\n    const cmConfig = config?.[namespace];\r\n    if (!cmConfig || typeof cmConfig !== 'object') {\r\n      logWarn(msg(`config not defined, exiting consent manager module`));\r\n      reset();\r\n      return {};\r\n    }\r\n    let cmpHandler;\r\n    if (isStr(cmConfig.cmpApi)) {\r\n      cmpHandler = cmConfig.cmpApi;\r\n    } else {\r\n      cmpHandler = DEFAULT_CMP;\r\n      logInfo(msg(`config did not specify cmp.  Using system default setting (${DEFAULT_CMP}).`));\r\n    }\r\n    let cmpTimeout;\r\n    if (isNumber(cmConfig.timeout)) {\r\n      cmpTimeout = cmConfig.timeout;\r\n    } else {\r\n      cmpTimeout = DEFAULT_CONSENT_TIMEOUT;\r\n      logInfo(msg(`config did not specify timeout.  Using system default setting (${DEFAULT_CONSENT_TIMEOUT}).`));\r\n    }\r\n    const actionTimeout = isNumber(cmConfig.actionTimeout) ? cmConfig.actionTimeout : null;\r\n    let setupCmp;\r\n    if (cmpHandler === 'static') {\r\n      if (isPlainObject(cmConfig.consentData)) {\r\n        staticConsentData = cmConfig.consentData;\r\n        cmpTimeout = null;\r\n        setupCmp = () => new PbPromise(resolve => resolve(consentDataHandler.setConsentData(parseConsentData(staticConsentData))))\r\n      } else {\r\n        logError(msg(`config with cmpApi: 'static' did not specify consentData. No consents will be available to adapters.`));\r\n      }\r\n    } else if (!cmpHandlers.hasOwnProperty(cmpHandler)) {\r\n      consentDataHandler.setConsentData(null);\r\n      logWarn(`${displayName} CMP framework (${cmpHandler}) is not a supported framework.  Aborting consentManagement module and resuming auction.`);\r\n      setupCmp = () => PbPromise.resolve();\r\n    } else {\r\n      setupCmp = cmpHandlers[cmpHandler];\r\n    }\r\n\r\n    const lookup = () => lookupConsentData({\r\n      name: displayName,\r\n      consentDataHandler,\r\n      setupCmp,\r\n      cmpTimeout,\r\n      actionTimeout,\r\n      getNullConsent,\r\n    });\r\n\r\n    cdLoader = (() => {\r\n      let cd;\r\n      return function () {\r\n        if (cd == null) {\r\n          cd = lookup().catch(err => {\r\n            cd = null;\r\n            throw err;\r\n          })\r\n        }\r\n        return cd;\r\n      }\r\n    })();\r\n\r\n    activate();\r\n    return {\r\n      cmpHandler,\r\n      cmpTimeout,\r\n      actionTimeout,\r\n      staticConsentData,\r\n      loadConsentData,\r\n      requestBidsHook\r\n    }\r\n  }\r\n}\r\n","import {compose} from './lib/composer.js';\r\nimport {logError, memoize} from '../../src/utils.js';\r\nimport {DEFAULT_PROCESSORS} from './processors/default.js';\r\nimport {BID_RESPONSE, DEFAULT, getProcessors, IMP, REQUEST, RESPONSE} from '../../src/pbjsORTB.js';\r\nimport {mergeProcessors} from './lib/mergeProcessors.js';\r\nimport type {MediaType} from \"../../src/mediaTypes.ts\";\r\nimport type {NativeRequest} from '../../src/types/ortb/native.d.ts';\r\nimport type {ORTBImp, ORTBRequest} from \"../../src/types/ortb/request.d.ts\";\r\nimport type {Currency, BidderCode} from \"../../src/types/common.d.ts\";\r\nimport type {BidderRequest, BidRequest} from \"../../src/adapterManager.ts\";\r\nimport type {BidResponse} from \"../../src/bidfactory.ts\";\r\nimport type {AdapterResponse} from \"../../src/adapters/bidderFactory.ts\";\r\nimport type {ORTBResponse} from \"../../src/types/ortb/response\";\r\n\r\ntype Context = {\r\n  [key: string]: unknown;\r\n  /**\r\n   * A currency string (e.g. `'EUR'`). If specified, overrides the currency to use for computing price floors and `request.cur`.\r\n   * If omitted, both default to `getConfig('currency.adServerCurrency')`.\r\n   */\r\n  currency?: Currency;\r\n  /**\r\n   * A bid mediaType (`'banner'`, `'video'`, or `'native'`). If specified:\r\n   *  - disables `imp` generation for other media types (i.e., if `context.mediaType === 'banner'`, only `imp.banner` will be populated; `imp.video` and `imp.native` will not, even if the bid request specifies them);\r\n   *  - is passed as the `mediaType` option to `bidRequest.getFloor` when computing price floors;\r\n   *  - sets `bidResponse.mediaType`.\r\n   */\r\n  mediaType?: MediaType;\r\n  /**\r\n   * A plain object that serves as the base value for `imp.native.request` (and is relevant only for native bid requests).\r\n   * If not specified, the only property that is guaranteed to be populated is `assets`, since Prebid does not\r\n   * require anything else to define a native adUnit. You can use `context.nativeRequest` to provide other properties;\r\n   * for example, you may want to signal support for native impression trackers by setting it to `{eventtrackers: [{event: 1, methods: [1, 2]}]}` (see also the [ORTB Native spec](https://www.iab.com/wp-content/uploads/2018/03/OpenRTB-Native-Ads-Specification-Final-1.2.pdf)).\r\n   */\r\n  nativeRequest?: Partial<NativeRequest>;\r\n  /**\r\n   * The value to set as `bidResponse.netRevenue`. This is a required property of bid responses that does not have a clear ORTB counterpart.\r\n   */\r\n  netRevenue?: boolean;\r\n  /**\r\n   * the default value to use for `bidResponse.ttl` (if the ORTB response does not provide one in `seatbid[].bid[].exp`).\r\n   */\r\n  ttl?: number;\r\n}\r\n\r\ntype RequestContext = Context & {\r\n  /**\r\n   * Map from imp id to the context object used to generate that imp.\r\n   */\r\n  impContext: { [impId: string]: Context };\r\n}\r\n\r\ntype Params<B extends BidderCode> = {\r\n  [IMP]: (\r\n    bidRequest: BidRequest<B>,\r\n    context: Context & {\r\n      bidderRequest: BidderRequest<B>\r\n    }\r\n  ) => ORTBImp;\r\n  [REQUEST]: (\r\n    imps: ORTBImp[],\r\n    bidderRequest: BidderRequest<B>,\r\n    context: RequestContext & {\r\n      bidRequests: BidRequest<B>[]\r\n    }\r\n  ) => ORTBRequest;\r\n  [BID_RESPONSE]: (\r\n    bid: ORTBResponse['seatbid'][number]['bid'][number],\r\n    context: Context & {\r\n      seatbid: ORTBResponse['seatbid'][number];\r\n      imp: ORTBImp;\r\n      bidRequest: BidRequest<B>;\r\n      ortbRequest: ORTBRequest;\r\n      ortbResponse: ORTBResponse;\r\n    }\r\n  ) => BidResponse;\r\n  [RESPONSE]: (\r\n    bidResponses: BidResponse[],\r\n    ortbResponse: ORTBResponse,\r\n    context: RequestContext & {\r\n      ortbRequest: ORTBRequest;\r\n      bidderRequest: BidderRequest<B>;\r\n      bidRequests: BidRequest<B>[];\r\n    }\r\n  ) => AdapterResponse\r\n}\r\n\r\ntype Processors<B extends BidderCode> = {\r\n  [M in keyof Params<B>]?: {\r\n    [name: string]: (...args: [Partial<ReturnType<Params<B>[M]>>, ...Parameters<Params<B>[M]>]) => void;\r\n  }\r\n}\r\n\r\ntype Customizers<B extends BidderCode> = {\r\n  [M in keyof Params<B>]?: (buildObject: Params<B>[M], ...args: Parameters<Params<B>[M]>) => ReturnType<Params<B>[M]>;\r\n}\r\n\r\ntype Overrides<B extends BidderCode> = {\r\n  [M in keyof Params<B>]?: {\r\n    [name: string]: (orig: Processors<B>[M][string], ...args: Parameters<Processors<B>[M][string]>) => void;\r\n  }\r\n}\r\n\r\ntype ConverterConfig<B extends BidderCode> = Customizers<B> & {\r\n  context?: Context;\r\n  processors?: () => Processors<B>;\r\n  overrides?: Overrides<B>;\r\n}\r\n\r\nexport function ortbConverter<B extends BidderCode>({\r\n  context: defaultContext = {},\r\n  processors = defaultProcessors,\r\n  overrides = {},\r\n  imp,\r\n  request,\r\n  bidResponse,\r\n  response,\r\n}: ConverterConfig<B> = {}) {\r\n  const REQ_CTX = new WeakMap();\r\n\r\n  function builder(slot, wrapperFn, builderFn, errorHandler) {\r\n    let build;\r\n    return function (...args) {\r\n      if (build == null) {\r\n        build = (function () {\r\n          let delegate = builderFn.bind(this, compose(processors()[slot] || {}, overrides[slot] || {}));\r\n          if (wrapperFn) {\r\n            delegate = wrapperFn.bind(this, delegate);\r\n          }\r\n          return function (...args) {\r\n            try {\r\n              return delegate.apply(this, args);\r\n            } catch (e) {\r\n              errorHandler.call(this, e, ...args);\r\n            }\r\n          }\r\n        })();\r\n      }\r\n      return build.apply(this, args);\r\n    }\r\n  }\r\n\r\n  const buildImp = builder(IMP, imp,\r\n    function (process, bidRequest, context) {\r\n      const imp = {};\r\n      process(imp, bidRequest, context);\r\n      return imp;\r\n    },\r\n    function (error, bidRequest, context) {\r\n      logError('Error while converting bidRequest to ORTB imp; request skipped.', {error, bidRequest, context});\r\n    }\r\n  );\r\n\r\n  const buildRequest = builder(REQUEST, request,\r\n    function (process, imps, bidderRequest, context) {\r\n      const ortbRequest = {imp: imps};\r\n      process(ortbRequest, bidderRequest, context);\r\n      return ortbRequest;\r\n    },\r\n    function (error, imps, bidderRequest, context) {\r\n      logError('Error while converting to ORTB request', {error, imps, bidderRequest, context});\r\n      throw error;\r\n    }\r\n  );\r\n\r\n  const buildBidResponse = builder(BID_RESPONSE, bidResponse,\r\n    function (process, bid, context) {\r\n      const bidResponse = {};\r\n      process(bidResponse, bid, context);\r\n      return bidResponse;\r\n    },\r\n    function (error, bid, context) {\r\n      logError('Error while converting ORTB seatbid.bid to bidResponse; bid skipped.', {error, bid, context});\r\n    }\r\n  );\r\n\r\n  const buildResponse = builder(RESPONSE, response,\r\n    function (process, bidResponses, ortbResponse, context) {\r\n      const response = {bids: bidResponses};\r\n      process(response, ortbResponse, context);\r\n      return response;\r\n    },\r\n    function (error, bidResponses, ortbResponse, context) {\r\n      logError('Error while converting from ORTB response', {error, bidResponses, ortbResponse, context});\r\n      throw error;\r\n    }\r\n  );\r\n\r\n  return {\r\n    toORTB({bidderRequest, bidRequests, context = {}}: {\r\n      bidderRequest: BidderRequest<B>,\r\n      bidRequests?: BidRequest<B>[],\r\n      context?: Context\r\n    }): ORTBRequest {\r\n      bidRequests = bidRequests || bidderRequest.bids;\r\n      const ctx = {\r\n        req: Object.assign({bidRequests}, defaultContext, context),\r\n        imp: {}\r\n      }\r\n      ctx.req.impContext = ctx.imp;\r\n      const imps = bidRequests.map(bidRequest => {\r\n        const impContext = Object.assign({bidderRequest, reqContext: ctx.req}, defaultContext, context);\r\n        const result = buildImp(bidRequest, impContext);\r\n        if (result != null) {\r\n          if (result.hasOwnProperty('id')) {\r\n            Object.assign(impContext, {bidRequest, imp: result});\r\n            ctx.imp[result.id] = impContext;\r\n            return result;\r\n          }\r\n          logError('Converted ORTB imp does not specify an id, ignoring bid request', bidRequest, result);\r\n        }\r\n      }).filter(Boolean);\r\n\r\n      const request = buildRequest(imps, bidderRequest, ctx.req);\r\n      ctx.req.bidderRequest = bidderRequest;\r\n      if (request != null) {\r\n        REQ_CTX.set(request, ctx);\r\n      }\r\n      return request;\r\n    },\r\n    fromORTB({request, response}: {\r\n      request: ORTBRequest;\r\n      response: ORTBResponse | null;\r\n    }): AdapterResponse {\r\n      const ctx = REQ_CTX.get(request);\r\n      if (ctx == null) {\r\n        throw new Error('ortbRequest passed to `fromORTB` must be the same object returned by `toORTB`')\r\n      }\r\n      function augmentContext(ctx, extraParams = {}) {\r\n        return Object.assign(ctx, {ortbRequest: request}, extraParams);\r\n      }\r\n      const impsById = Object.fromEntries((request.imp || []).map(imp => [imp.id, imp]));\r\n      const bidResponses = (response?.seatbid || []).flatMap(seatbid =>\r\n        (seatbid.bid || []).map((bid) => {\r\n          if (impsById.hasOwnProperty(bid.impid) && ctx.imp.hasOwnProperty(bid.impid)) {\r\n            return buildBidResponse(bid, augmentContext(ctx.imp[bid.impid], {imp: impsById[bid.impid], seatbid, ortbResponse: response}));\r\n          }\r\n          logError('ORTB response seatbid[].bid[].impid does not match any imp in request; ignoring bid', bid);\r\n        })\r\n      ).filter(Boolean);\r\n      return buildResponse(bidResponses, response, augmentContext(ctx.req));\r\n    }\r\n  }\r\n}\r\n\r\nexport const defaultProcessors = memoize(() => mergeProcessors(DEFAULT_PROCESSORS, getProcessors(DEFAULT)));\r\n","const SORTED = new WeakMap();\r\n\r\n/**\r\n * @typedef {Object} Component\r\n * A component function, that can be composed with other compatible functions into one.\r\n * Compatible functions take the same arguments; return values are ignored.\r\n *\r\n * @property {function} fn the component function;\r\n * @property {number} priority determines the order in which this function will run when composed with others.\r\n */\r\n\r\n/**\r\n *\r\n * @param {Object.<string, Component>} components - An object where keys are component names and values are components to compose.\r\n * @param {Object.<string, (function|boolean)>} overrides - A map from component names to functions that should override those components.\r\n * Override functions are replacements, except that they get the original function they are overriding as their first argument. If the override\r\n * is `false`, the component is disabled.\r\n *\r\n * @return {function} - A function that will run all components in order of priority, with functions from `overrides` taking\r\n * precedence over components that match names.\r\n */\r\nexport function compose(components, overrides = {}) {\r\n  if (!SORTED.has(components)) {\r\n    const sorted = Object.entries(components);\r\n    sorted.sort((a, b) => {\r\n      a = a[1].priority || 0;\r\n      b = b[1].priority || 0;\r\n      return a === b ? 0 : a > b ? -1 : 1\r\n    });\r\n    SORTED.set(components, sorted.map(([name, cmp]) => [name, cmp.fn]))\r\n  }\r\n  const fns = SORTED.get(components)\r\n    .filter(([name]) => !overrides.hasOwnProperty(name) || overrides[name])\r\n    .map(function ([name, fn]) {\r\n      return overrides.hasOwnProperty(name) ? overrides[name].bind(this, fn) : fn;\r\n    });\r\n  return function () {\r\n    const args = Array.from(arguments);\r\n    fns.forEach(fn => {\r\n      fn.apply(this, args);\r\n    })\r\n  }\r\n}\r\n","import {PROCESSOR_TYPES} from '../../../src/pbjsORTB.js';\r\n\r\nexport function mergeProcessors(...processors) {\r\n  const left = processors.shift();\r\n  const right = processors.length > 1 ? mergeProcessors(...processors) : processors[0];\r\n  return Object.fromEntries(\r\n    PROCESSOR_TYPES.map(type => [type, Object.assign({}, left[type], right[type])])\r\n  )\r\n}\r\n","import {\r\n  createTrackPixelHtml,\r\n  inIframe,\r\n  mergeDeep,\r\n  sizesToSizeTuples,\r\n  sizeTupleToRtbSize,\r\n  encodeMacroURI\r\n} from '../../../src/utils.js';\r\nimport {BANNER} from '../../../src/mediaTypes.js';\r\n\r\n/**\r\n * fill in a request `imp` with banner parameters from `bidRequest`.\r\n */\r\nexport function fillBannerImp(imp, bidRequest, context) {\r\n  if (context.mediaType && context.mediaType !== BANNER) return;\r\n\r\n  const bannerParams = bidRequest?.mediaTypes?.banner;\r\n  if (bannerParams) {\r\n    const banner = {\r\n      topframe: inIframe() === true ? 0 : 1\r\n    };\r\n    if (bannerParams.sizes && bidRequest.ortb2Imp?.banner?.format == null) {\r\n      banner.format = sizesToSizeTuples(bannerParams.sizes).map(sizeTupleToRtbSize);\r\n    }\r\n    if (bannerParams.hasOwnProperty('pos')) {\r\n      banner.pos = bannerParams.pos;\r\n    }\r\n\r\n    imp.banner = mergeDeep(banner, imp.banner);\r\n  }\r\n}\r\n\r\nexport function bannerResponseProcessor({createPixel = (url) => createTrackPixelHtml(decodeURIComponent(url), encodeMacroURI)} = {}) {\r\n  return function fillBannerResponse(bidResponse, bid) {\r\n    if (bidResponse.mediaType === BANNER) {\r\n      if (bid.adm && bid.nurl) {\r\n        bidResponse.ad = createPixel(bid.nurl) + bid.adm;\r\n      } else if (bid.adm) {\r\n        bidResponse.ad = bid.adm;\r\n      } else if (bid.nurl) {\r\n        bidResponse.adUrl = bid.nurl;\r\n      }\r\n    }\r\n  };\r\n}\r\n","import {generateUUID, mergeDeep} from '../../../src/utils.js';\r\nimport {bannerResponseProcessor, fillBannerImp} from './banner.js';\r\nimport {fillVideoImp, fillVideoResponse} from './video.js';\r\nimport {setResponseMediaType} from './mediaType.js';\r\nimport {fillNativeImp, fillNativeResponse} from './native.js';\r\nimport {BID_RESPONSE, IMP, REQUEST} from '../../../src/pbjsORTB.js';\r\nimport {clientSectionChecker} from '../../../src/fpd/oneClient.js';\r\n\r\nexport const DEFAULT_PROCESSORS = {\r\n  [REQUEST]: {\r\n    fpd: {\r\n      // sets initial request to bidderRequest.ortb2\r\n      priority: 99,\r\n      fn(ortbRequest, bidderRequest) {\r\n        mergeDeep(ortbRequest, bidderRequest.ortb2)\r\n      }\r\n    },\r\n    onlyOneClient: {\r\n      // make sure only one of 'dooh', 'app', 'site' is set in request\r\n      priority: -99,\r\n      fn: clientSectionChecker('ORTB request')\r\n    },\r\n    props: {\r\n      // sets request properties id, tmax, test\r\n      fn(ortbRequest, bidderRequest) {\r\n        Object.assign(ortbRequest, {\r\n          id: ortbRequest.id || generateUUID(),\r\n          test: ortbRequest.test || 0\r\n        });\r\n        const timeout = parseInt(bidderRequest.timeout, 10);\r\n        if (!isNaN(timeout)) {\r\n          ortbRequest.tmax = timeout;\r\n        }\r\n      }\r\n    }\r\n  },\r\n  [IMP]: {\r\n    fpd: {\r\n      // sets initial imp to bidRequest.ortb2Imp\r\n      priority: 99,\r\n      fn(imp, bidRequest) {\r\n        mergeDeep(imp, bidRequest.ortb2Imp);\r\n      }\r\n    },\r\n    id: {\r\n      // sets imp.id\r\n      fn(imp, bidRequest) {\r\n        imp.id = bidRequest.bidId;\r\n      }\r\n    },\r\n    banner: {\r\n      // populates imp.banner\r\n      fn: fillBannerImp\r\n    },\r\n    secure: {\r\n      // should set imp.secure to 1 unless publisher has set it\r\n      fn(imp, bidRequest) {\r\n        imp.secure = imp.secure ?? 1;\r\n      }\r\n    }\r\n  },\r\n  [BID_RESPONSE]: {\r\n    mediaType: {\r\n      // sets bidResponse.mediaType from context.mediaType, falling back to seatbid.bid[].mtype\r\n      priority: 99,\r\n      fn: setResponseMediaType\r\n    },\r\n    banner: {\r\n      // sets banner response attributes if bidResponse.mediaType === BANNER\r\n      fn: bannerResponseProcessor(),\r\n    },\r\n    props: {\r\n      // sets base bidResponse properties common to all types of bids\r\n      fn(bidResponse, bid, context) {\r\n        Object.entries({\r\n          requestId: context.bidRequest?.bidId,\r\n          seatBidId: bid.id,\r\n          cpm: bid.price,\r\n          currency: context.ortbResponse.cur || context.currency,\r\n          width: bid.w,\r\n          height: bid.h,\r\n          wratio: bid.wratio,\r\n          hratio: bid.hratio,\r\n          dealId: bid.dealid,\r\n          creative_id: bid.crid,\r\n          creativeId: bid.crid,\r\n          burl: bid.burl,\r\n          ttl: bid.exp || context.ttl,\r\n          netRevenue: context.netRevenue,\r\n        }).filter(([k, v]) => typeof v !== 'undefined')\r\n          .forEach(([k, v]) => {\r\n            bidResponse[k] = v;\r\n          });\r\n        if (!bidResponse.meta) {\r\n          bidResponse.meta = {};\r\n        }\r\n        if (bid.adomain) {\r\n          bidResponse.meta.advertiserDomains = bid.adomain;\r\n        }\r\n        if (bid.ext?.dsa) {\r\n          bidResponse.meta.dsa = bid.ext.dsa;\r\n        }\r\n        if (bid.cat) {\r\n          bidResponse.meta.primaryCatId = bid.cat[0];\r\n          bidResponse.meta.secondaryCatIds = bid.cat.slice(1);\r\n        }\r\n        if (bid.attr) {\r\n          bidResponse.meta.attr = bid.attr;\r\n        }\r\n        if (bid.ext?.eventtrackers) {\r\n          bidResponse.eventtrackers = (bidResponse.eventtrackers ?? []).concat(bid.ext.eventtrackers);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nif (FEATURES.NATIVE) {\r\n  DEFAULT_PROCESSORS[IMP].native = {\r\n    // populates imp.native\r\n    fn: fillNativeImp\r\n  }\r\n  DEFAULT_PROCESSORS[BID_RESPONSE].native = {\r\n    // populates bidResponse.native if bidResponse.mediaType === NATIVE\r\n    fn: fillNativeResponse\r\n  }\r\n}\r\n\r\nif (FEATURES.VIDEO) {\r\n  DEFAULT_PROCESSORS[IMP].video = {\r\n    // populates imp.video\r\n    fn: fillVideoImp\r\n  }\r\n  DEFAULT_PROCESSORS[BID_RESPONSE].video = {\r\n    // sets video response attributes if bidResponse.mediaType === VIDEO\r\n    fn: fillVideoResponse\r\n  }\r\n}\r\n","import {BANNER, NATIVE, VIDEO} from '../../../src/mediaTypes.js';\r\n\r\nexport const ORTB_MTYPES = {\r\n  1: BANNER,\r\n  2: VIDEO,\r\n  4: NATIVE\r\n}\r\n\r\n/**\r\n * Sets response mediaType, using ORTB 2.6 `seatbid.bid[].mtype`.\r\n *\r\n * Note that this will throw away bids if there is no `mtype` in the response.\r\n */\r\nexport function setResponseMediaType(bidResponse, bid, context) {\r\n  if (bidResponse.mediaType) return;\r\n  const mediaType = context.mediaType;\r\n  if (!mediaType && !ORTB_MTYPES.hasOwnProperty(bid.mtype)) {\r\n    throw new Error('Cannot determine mediaType for response')\r\n  }\r\n  bidResponse.mediaType = mediaType || ORTB_MTYPES[bid.mtype];\r\n}\r\n","import {isPlainObject, logWarn, mergeDeep} from '../../../src/utils.js';\r\nimport {NATIVE} from '../../../src/mediaTypes.js';\r\n\r\nexport function fillNativeImp(imp, bidRequest, context) {\r\n  if (context.mediaType && context.mediaType !== NATIVE) return;\r\n  let nativeReq = bidRequest.nativeOrtbRequest;\r\n  if (nativeReq) {\r\n    nativeReq = Object.assign({}, context.nativeRequest, nativeReq);\r\n    if (nativeReq.assets?.length) {\r\n      imp.native = mergeDeep({}, {\r\n        request: JSON.stringify(nativeReq),\r\n        ver: nativeReq.ver\r\n      }, imp.native)\r\n    } else {\r\n      logWarn('mediaTypes.native is set, but no assets were specified. Native request skipped.', bidRequest)\r\n    }\r\n  }\r\n}\r\n\r\nexport function fillNativeResponse(bidResponse, bid) {\r\n  if (bidResponse.mediaType === NATIVE) {\r\n    let ortb;\r\n    if (typeof bid.adm === 'string') {\r\n      ortb = JSON.parse(bid.adm);\r\n    } else {\r\n      ortb = bid.adm;\r\n    }\r\n\r\n    if (isPlainObject(ortb) && Array.isArray(ortb.assets)) {\r\n      bidResponse.native = {\r\n        ortb,\r\n      }\r\n    } else {\r\n      throw new Error('ORTB native response contained no assets');\r\n    }\r\n  }\r\n}\r\n","import {isEmpty, logWarn, mergeDeep, sizesToSizeTuples, sizeTupleToRtbSize} from '../../../src/utils.js';\r\nimport {VIDEO} from '../../../src/mediaTypes.js';\r\n\r\nimport {ORTB_VIDEO_PARAMS} from '../../../src/video.js';\r\n\r\nexport function fillVideoImp(imp, bidRequest, context) {\r\n  if (context.mediaType && context.mediaType !== VIDEO) return;\r\n\r\n  const videoParams = bidRequest?.mediaTypes?.video;\r\n  if (!isEmpty(videoParams)) {\r\n    const video = Object.fromEntries(\r\n      // Parameters that share the same name & semantics between pbjs adUnits and imp.video\r\n      Object.entries(videoParams)\r\n        .filter(([name]) => ORTB_VIDEO_PARAMS.has(name))\r\n    );\r\n    if (videoParams.playerSize) {\r\n      const format = sizesToSizeTuples(videoParams.playerSize).map(sizeTupleToRtbSize);\r\n      if (format.length > 1) {\r\n        logWarn('video request specifies more than one playerSize; all but the first will be ignored')\r\n      }\r\n      Object.assign(video, format[0]);\r\n    }\r\n\r\n    imp.video = mergeDeep(video, imp.video);\r\n  }\r\n}\r\n\r\nexport function fillVideoResponse(bidResponse, seatbid, context) {\r\n  if (bidResponse.mediaType === VIDEO) {\r\n    if (context?.imp?.video?.w && context?.imp?.video?.h) {\r\n      [bidResponse.playerWidth, bidResponse.playerHeight] = [context.imp.video.w, context.imp.video.h];\r\n    }\r\n\r\n    if (seatbid.adm) { bidResponse.vastXml = seatbid.adm; }\r\n    if (seatbid.nurl) { bidResponse.vastUrl = seatbid.nurl; }\r\n  }\r\n}\r\n","import { CLIENT_SECTIONS } from '../../src/fpd/oneClient.js';\r\nimport {compareCodeAndSlot, deepAccess, isGptPubadsDefined, uniques} from '../../src/utils.js';\r\n\r\nconst slotInfoCache = new Map();\r\n\r\nexport function clearSlotInfoCache() {\r\n  slotInfoCache.clear();\r\n}\r\n\r\n/**\r\n * Returns filter function to match adUnitCode in slot\r\n * @param {string} adUnitCode AdUnit code\r\n * @return {function} filter function\r\n */\r\nexport function isSlotMatchingAdUnitCode(adUnitCode) {\r\n  return (slot) => compareCodeAndSlot(slot, adUnitCode);\r\n}\r\n\r\n/**\r\n * @summary Export a k-v pair to GAM\r\n */\r\nexport function setKeyValue(key, value) {\r\n  if (!key || typeof key !== 'string') return false;\r\n  window.googletag = window.googletag || {cmd: []};\r\n  window.googletag.cmd = window.googletag.cmd || [];\r\n  window.googletag.cmd.push(() => {\r\n    window.googletag.pubads().setTargeting(key, value);\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Uses the adUnit's code in order to find a matching gpt slot object on the page\r\n */\r\nexport function getGptSlotForAdUnitCode(adUnitCode) {\r\n  let matchingSlot;\r\n  if (isGptPubadsDefined()) {\r\n    // find the first matching gpt slot on the page\r\n    matchingSlot = window.googletag.pubads().getSlots().find(isSlotMatchingAdUnitCode(adUnitCode));\r\n  }\r\n  return matchingSlot;\r\n}\r\n\r\n/**\r\n * @summary Uses the adUnit's code in order to find a matching gptSlot on the page\r\n */\r\nexport function getGptSlotInfoForAdUnitCode(adUnitCode) {\r\n  if (slotInfoCache.has(adUnitCode)) {\r\n    return slotInfoCache.get(adUnitCode);\r\n  }\r\n  const matchingSlot = getGptSlotForAdUnitCode(adUnitCode);\r\n  let info = {};\r\n  if (matchingSlot) {\r\n    info = {\r\n      gptSlot: matchingSlot.getAdUnitPath(),\r\n      divId: matchingSlot.getSlotElementId()\r\n    };\r\n  }\r\n  slotInfoCache.set(adUnitCode, info);\r\n  return info;\r\n}\r\n\r\nexport const taxonomies = ['IAB_AUDIENCE_1_1', 'IAB_CONTENT_2_2'];\r\n\r\nexport function getSignals(fpd) {\r\n  const signals = Object.entries({\r\n    [taxonomies[0]]: getSegments(fpd, ['user.data'], 4),\r\n    [taxonomies[1]]: getSegments(fpd, CLIENT_SECTIONS.map(section => `${section}.content.data`), 6)\r\n  }).map(([taxonomy, values]) => values.length ? {taxonomy, values} : null)\r\n    .filter(ob => ob);\r\n\r\n  return signals;\r\n}\r\n\r\nexport function getSegments(fpd, sections, segtax) {\r\n  return sections\r\n    .flatMap(section => deepAccess(fpd, section) || [])\r\n    .filter(datum => datum.ext?.segtax === segtax)\r\n    .flatMap(datum => datum.segment?.map(seg => seg.id))\r\n    .filter(ob => ob)\r\n    .filter(uniques)\r\n}\r\n\r\n/**\r\n * Add an event listener on the given GAM event.\r\n * If GPT Pubads isn't defined, window.googletag is set to a new object.\r\n * @param {String} event\r\n * @param {Function} callback\r\n */\r\nexport function subscribeToGamEvent(event, callback) {\r\n  const register = () => window.googletag.pubads().addEventListener(event, callback);\r\n  if (isGptPubadsDefined()) {\r\n    register();\r\n    return;\r\n  }\r\n  window.googletag = window.googletag || {};\r\n  window.googletag.cmd = window.googletag.cmd || [];\r\n  window.googletag.cmd.push(register);\r\n}\r\n\r\n/**\r\n * @typedef {Object} Slot\r\n * @property {function(String): (String|null)} get\r\n * @property {function(): String} getAdUnitPath\r\n * @property {function(): String[]} getAttributeKeys\r\n * @property {function(): String[]} getCategoryExclusions\r\n * @property {function(String): String} getSlotElementId\r\n * @property {function(): String[]} getTargeting\r\n * @property {function(): String[]} getTargetingKeys\r\n * @see {@link https://developers.google.com/publisher-tag/reference#googletag.Slot GPT official docs}\r\n */\r\n\r\n/**\r\n * @typedef {Object} SlotRenderEndedEvent\r\n * @property {(String|null)} advertiserId\r\n * @property {(String|null)} campaignId\r\n * @property {(String[]|null)} companyIds\r\n * @property {(Number|null)} creativeId\r\n * @property {(Number|null)} creativeTemplateId\r\n * @property {(Boolean)} isBackfill\r\n * @property {(Boolean)} isEmpty\r\n * @property {(Number[]|null)} labelIds\r\n * @property {(Number|null)} lineItemId\r\n * @property {(String)} serviceName\r\n * @property {(string|Number[]|null)} size\r\n * @property {(Slot)} slot\r\n * @property {(Boolean)} slotContentChanged\r\n * @property {(Number|null)} sourceAgnosticCreativeId\r\n * @property {(Number|null)} sourceAgnosticLineItemId\r\n * @property {(Number[]|null)} yieldGroupIds\r\n * @see {@link https://developers.google.com/publisher-tag/reference#googletag.events.SlotRenderEndedEvent GPT official docs}\r\n */\r\n\r\n/**\r\n * @callback SlotRenderEndedEventCallback\r\n * @param {SlotRenderEndedEvent} event\r\n * @returns {void}\r\n */\r\n\r\n/**\r\n * Add an event listener on the GAM event 'slotRenderEnded'.\r\n * @param {SlotRenderEndedEventCallback} callback\r\n */\r\nexport function subscribeToGamSlotRenderEndedEvent(callback) {\r\n  subscribeToGamEvent('slotRenderEnded', callback)\r\n}\r\n","const XML_MIME_TYPE = 'application/xml';\r\n\r\nexport default function XMLUtil() {\r\n  let parser;\r\n  let serializer;\r\n\r\n  function getParser() {\r\n    if (!parser) {\r\n      // DOMParser instantiation is costly; instantiate only once throughout Prebid lifecycle.\r\n      parser = new DOMParser();\r\n    }\r\n    return parser;\r\n  }\r\n\r\n  function getSerializer() {\r\n    if (!serializer) {\r\n      // XMLSerializer instantiation is costly; instantiate only once throughout Prebid lifecycle.\r\n      serializer = new XMLSerializer();\r\n    }\r\n    return serializer;\r\n  }\r\n\r\n  function parse(xmlString) {\r\n    return getParser().parseFromString(xmlString, XML_MIME_TYPE);\r\n  }\r\n\r\n  function serialize(xmlDoc) {\r\n    return getSerializer().serializeToString(xmlDoc);\r\n  }\r\n\r\n  return {\r\n    parse,\r\n    serialize\r\n  };\r\n}\r\n","import {gdprDataHandler} from '../../src/consentHandler.js';\r\n\r\n/** Safe defaults which work on pretty much all video calls. */\r\nexport const DEFAULT_DFP_PARAMS = {\r\n  env: 'vp',\r\n  gdfp_req: 1,\r\n  output: 'vast',\r\n  unviewed_position_start: 1,\r\n}\r\n\r\nexport const DFP_ENDPOINT = {\r\n  protocol: 'https',\r\n  host: 'securepubads.g.doubleclick.net',\r\n  pathname: '/gampad/ads'\r\n}\r\n\r\nexport function gdprParams() {\r\n  const gdprConsent = gdprDataHandler.getConsentData();\r\n  const params = {};\r\n  if (gdprConsent) {\r\n    if (typeof gdprConsent.gdprApplies === 'boolean') { params.gdpr = Number(gdprConsent.gdprApplies); }\r\n    if (gdprConsent.consentString) { params.gdpr_consent = gdprConsent.consentString; }\r\n    if (gdprConsent.addtlConsent) { params.addtl_consent = gdprConsent.addtlConsent; }\r\n  }\r\n  return params;\r\n}\r\n","import {registerActivityControl} from '../../src/activities/rules.js';\r\nimport {\r\n  ACTIVITY_ENRICH_EIDS,\r\n  ACTIVITY_ENRICH_UFPD,\r\n  ACTIVITY_SYNC_USER,\r\n  ACTIVITY_TRANSMIT_PRECISE_GEO\r\n} from '../../src/activities/activities.js';\r\nimport {gppDataHandler} from '../../src/adapterManager.js';\r\nimport {logInfo} from '../../src/utils.js';\r\n\r\n// default interpretation for MSPA consent(s):\r\n// https://docs.prebid.org/features/mspa-usnat.html\r\n\r\nconst SENSITIVE_DATA_GEO = 7;\r\n\r\nfunction isApplicable(val) {\r\n  return val != null && val !== 0\r\n}\r\n\r\nexport function isBasicConsentDenied(cd) {\r\n  // service provider mode is always consent denied\r\n  return ['MspaServiceProviderMode', 'Gpc'].some(prop => cd[prop] === 1) ||\r\n    // you cannot consent to what you were not notified of\r\n    cd.PersonalDataConsents === 2 ||\r\n    // minors 13+ who have not given consent\r\n    cd.KnownChildSensitiveDataConsents[0] === 1 ||\r\n    // minors 16+ who have not given consent (added in usnat version 2)\r\n    cd.KnownChildSensitiveDataConsents[2] === 1 ||\r\n    // minors under 13 cannot consent\r\n    isApplicable(cd.KnownChildSensitiveDataConsents[1]) ||\r\n    // covered cannot be zero\r\n    cd.MspaCoveredTransaction === 0;\r\n}\r\n\r\nexport function sensitiveNoticeIs(cd, value) {\r\n  return ['SensitiveDataProcessingOptOutNotice', 'SensitiveDataLimitUseNotice'].some(prop => cd[prop] === value)\r\n}\r\n\r\nexport function isConsentDenied(cd) {\r\n  return isBasicConsentDenied(cd) ||\r\n    ['Sale', 'Sharing', 'TargetedAdvertising'].some(scope => {\r\n      const oo = cd[`${scope}OptOut`];\r\n      const notice = cd[`${scope}OptOutNotice`];\r\n      // user opted out\r\n      return oo === 1 ||\r\n      // opt-out notice was not given\r\n        notice === 2 ||\r\n      // do not trust CMP if it signals opt-in but no opt-out notice was given\r\n        (oo === 2 && notice === 0);\r\n    }) ||\r\n    // no sharing notice was given ...\r\n    cd.SharingNotice === 2 ||\r\n    // ... or the CMP says it was not applicable, while also claiming it got consent\r\n    (cd.SharingOptOut === 2 && cd.SharingNotice === 0);\r\n}\r\n\r\nexport const isTransmitUfpdConsentDenied = (() => {\r\n  const sensitiveFlags = (() => {\r\n    // deny anything that smells like: genetic, biometric, state/national ID, financial, union membership,\r\n    // personal communication data, status as victim of crime (version 2), status as transgender/nonbinary (version 2)\r\n    const cannotBeInScope = [6, 7, 9, 10, 12, 14, 16].map(el => --el);\r\n    // require consent for everything else (except geo, which is treated separately)\r\n    const allExceptGeo = Array.from(Array(16).keys()).filter((el) => el !== SENSITIVE_DATA_GEO)\r\n    const mustHaveConsent = allExceptGeo.filter(el => !cannotBeInScope.includes(el));\r\n\r\n    return Object.fromEntries(\r\n      Object.entries({\r\n        1: 12,\r\n        2: 16\r\n      }).map(([version, cardinality]) => {\r\n        const isInVersion = (el) => el < cardinality\r\n        return [version, {\r\n          cannotBeInScope: cannotBeInScope.filter(isInVersion),\r\n          allExceptGeo: allExceptGeo.filter(isInVersion),\r\n          mustHaveConsent: mustHaveConsent.filter(isInVersion)\r\n        }]\r\n      })\r\n    )\r\n  })()\r\n\r\n  return function (cd) {\r\n    const {cannotBeInScope, mustHaveConsent, allExceptGeo} = sensitiveFlags[cd.Version];\r\n    return isConsentDenied(cd) ||\r\n      // no notice about sensitive data was given\r\n      sensitiveNoticeIs(cd, 2) ||\r\n      // extra-sensitive data is applicable\r\n      cannotBeInScope.some(i => isApplicable(cd.SensitiveDataProcessing[i])) ||\r\n      // user opted out for not-as-sensitive data\r\n      mustHaveConsent.some(i => cd.SensitiveDataProcessing[i] === 1) ||\r\n      // CMP says it has consent, but did not give notice about it\r\n      (sensitiveNoticeIs(cd, 0) && allExceptGeo.some(i => cd.SensitiveDataProcessing[i] === 2))\r\n  }\r\n})();\r\n\r\nexport function isTransmitGeoConsentDenied(cd) {\r\n  const geoConsent = cd.SensitiveDataProcessing[SENSITIVE_DATA_GEO];\r\n  return geoConsent === 1 ||\r\n    isBasicConsentDenied(cd) ||\r\n    // no sensitive data notice was given\r\n    sensitiveNoticeIs(cd, 2) ||\r\n    // do not trust CMP if it says it has consent for geo but didn't show a sensitive data notice\r\n    (sensitiveNoticeIs(cd, 0) && geoConsent === 2)\r\n}\r\n\r\nconst CONSENT_RULES = {\r\n  [ACTIVITY_SYNC_USER]: isConsentDenied,\r\n  [ACTIVITY_ENRICH_EIDS]: isConsentDenied,\r\n  [ACTIVITY_ENRICH_UFPD]: isTransmitUfpdConsentDenied,\r\n  [ACTIVITY_TRANSMIT_PRECISE_GEO]: isTransmitGeoConsentDenied\r\n};\r\n\r\nexport function mspaRule(sids, getConsent, denies, applicableSids = () => gppDataHandler.getConsentData()?.applicableSections) {\r\n  return function () {\r\n    if (applicableSids().some(sid => sids.includes(sid))) {\r\n      const consent = getConsent();\r\n      if (consent == null) {\r\n        return {allow: false, reason: 'consent data not available'};\r\n      }\r\n      if (![1, 2].includes(consent.Version)) {\r\n        return {allow: false, reason: `unsupported consent specification version \"${consent.Version}\"`}\r\n      }\r\n      if (denies(consent)) {\r\n        return {allow: false};\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction flatSection(subsections) {\r\n  if (!Array.isArray(subsections)) return subsections;\r\n  return subsections.reduceRight((subsection, consent) => {\r\n    return Object.assign(consent, subsection);\r\n  }, {});\r\n}\r\n\r\nexport function setupRules(api, sids, normalizeConsent = (c) => c, rules = CONSENT_RULES, registerRule = registerActivityControl, getConsentData = () => gppDataHandler.getConsentData()) {\r\n  const unreg = [];\r\n  const ruleName = `MSPA (GPP '${api}' for section${sids.length > 1 ? 's' : ''} ${sids.join(', ')})`;\r\n  logInfo(`Enabling activity controls for ${ruleName}`)\r\n  Object.entries(rules).forEach(([activity, denies]) => {\r\n    unreg.push(registerRule(activity, ruleName, mspaRule(\r\n      sids,\r\n      () => normalizeConsent(flatSection(getConsentData()?.parsedSections?.[api])),\r\n      denies,\r\n      () => getConsentData()?.applicableSections || []\r\n    )));\r\n  });\r\n  return () => unreg.forEach(ur => ur());\r\n}\r\n","import {getGlobal} from '../../src/prebidGlobal.js';\r\nimport {keyCompare} from '../../src/utils/reducers.js';\r\n\r\n/**\r\n * Attempt to convert `amount` from the currency `fromCur` to the currency `toCur`.\r\n *\r\n * By default, when the conversion is not possible (currency module not present or\r\n * throwing errors), the amount is returned unchanged. This behavior can be\r\n * toggled off with bestEffort = false.\r\n */\r\nexport function convertCurrency(amount, fromCur, toCur, bestEffort = true) {\r\n  if (fromCur === toCur) return amount;\r\n  let result = amount;\r\n  try {\r\n    result = getGlobal().convertCurrency(amount, fromCur, toCur);\r\n  } catch (e) {\r\n    if (!bestEffort) throw e;\r\n  }\r\n  return result;\r\n}\r\n\r\nexport function currencyNormalizer(toCurrency = null, bestEffort = true, convert = convertCurrency) {\r\n  return function (amount, currency) {\r\n    if (toCurrency == null) toCurrency = currency;\r\n    return convert(amount, currency, toCurrency, bestEffort);\r\n  }\r\n}\r\n\r\nexport function currencyCompare(get = (obj) => [obj.cpm, obj.currency], normalize = currencyNormalizer()) {\r\n  return keyCompare(obj => normalize.apply(null, get(obj)))\r\n}\r\n","import {auctionManager} from '../../src/auctionManager.js';\r\n\r\nexport function weakStore(get) {\r\n  const store = new WeakMap();\r\n  return function (id, init = {}) {\r\n    const obj = get(id);\r\n    if (obj == null) return;\r\n    if (!store.has(obj)) {\r\n      store.set(obj, init);\r\n    }\r\n    return store.get(obj);\r\n  };\r\n}\r\n\r\nexport const auctionStore = () => weakStore((auctionId) => auctionManager.index.getAuction({auctionId}));\r\n","import {mergeProcessors} from '../ortbConverter/lib/mergeProcessors.js';\r\nimport {PBS_PROCESSORS} from './processors/pbs.js';\r\nimport {getProcessors, PBS} from '../../src/pbjsORTB.js';\r\nimport {defaultProcessors} from '../ortbConverter/converter.js';\r\nimport {memoize} from '../../src/utils.js';\r\n\r\n/**\r\n * ORTB converter processor set that understands Prebid Server extensions.\r\n *\r\n * Pass this as the `processors` option to `ortbConverter` if your backend is a PBS instance.\r\n */\r\nexport const pbsExtensions = memoize(() => mergeProcessors(defaultProcessors(), PBS_PROCESSORS, getProcessors(PBS)));\r\n","import {deepSetValue} from '../../../src/utils.js';\r\n\r\nexport function setImpAdUnitCode(imp, bidRequest) {\r\n  const adUnitCode = bidRequest.adUnitCode;\r\n\r\n  if (adUnitCode) {\r\n    deepSetValue(\r\n      imp,\r\n      `ext.prebid.adunitcode`,\r\n      adUnitCode\r\n    );\r\n  }\r\n}\r\n","import adapterManager from '../../../src/adapterManager.js';\r\nimport {config} from '../../../src/config.js';\r\nimport {deepSetValue} from '../../../src/utils.js';\r\n\r\nexport function setRequestExtPrebidAliases(ortbRequest, bidderRequest, context, {am = adapterManager} = {}) {\r\n  if (am.aliasRegistry[bidderRequest.bidderCode]) {\r\n    const bidder = am.bidderRegistry[bidderRequest.bidderCode];\r\n    // adding alias only if alias source bidder exists and alias isn't configured to be standalone\r\n    // pbs adapter\r\n    if (!bidder || !bidder.getSpec().skipPbsAliasing) {\r\n      // set alias\r\n      deepSetValue(\r\n        ortbRequest,\r\n        `ext.prebid.aliases.${bidderRequest.bidderCode}`,\r\n        am.aliasRegistry[bidderRequest.bidderCode]\r\n      );\r\n\r\n      // set alias gvlids if present also\r\n      const gvlId = config.getConfig(`gvlMapping.${bidderRequest.bidderCode}`) || bidder?.getSpec?.().gvlid;\r\n      if (gvlId) {\r\n        deepSetValue(\r\n          ortbRequest,\r\n          `ext.prebid.aliasgvlids.${bidderRequest.bidderCode}`,\r\n          gvlId\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n","import {EVENT_TYPE_IMPRESSION, EVENT_TYPE_WIN, TRACKER_METHOD_IMG} from '../../../src/eventTrackers.js';\r\n\r\nexport function addEventTrackers(bidResponse, bid) {\r\n  bidResponse.eventtrackers = bidResponse.eventtrackers || [];\r\n  [\r\n    [bid.burl, EVENT_TYPE_IMPRESSION], // core used to fire burl directly, but only for bids coming from PBS\r\n    [bid?.ext?.prebid?.events?.win, EVENT_TYPE_WIN]\r\n  ].filter(([winUrl, type]) => winUrl && bidResponse.eventtrackers.find(\r\n    ({method, event, url}) => event === type && method === TRACKER_METHOD_IMG && url === winUrl\r\n  ) == null)\r\n    .forEach(([url, event]) => {\r\n      bidResponse.eventtrackers.push({\r\n        method: TRACKER_METHOD_IMG,\r\n        event,\r\n        url\r\n      })\r\n    })\r\n}\r\n","import {BANNER, NATIVE, VIDEO} from '../../../src/mediaTypes.js';\r\nimport {ORTB_MTYPES} from '../../ortbConverter/processors/mediaType.js';\r\n\r\nexport const SUPPORTED_MEDIA_TYPES = {\r\n  // map from pbjs mediaType to its corresponding imp property\r\n  [BANNER]: 'banner',\r\n  [NATIVE]: 'native',\r\n  [VIDEO]: 'video'\r\n}\r\n\r\n/**\r\n * Sets bidResponse.mediaType, using ORTB 2.6 `seatbid.bid[].mtype`, falling back to `ext.prebid.type`, falling back to 'banner'.\r\n */\r\nexport function extPrebidMediaType(bidResponse, bid, context) {\r\n  let mediaType = context.mediaType;\r\n  if (!mediaType) {\r\n    mediaType = ORTB_MTYPES.hasOwnProperty(bid.mtype) ? ORTB_MTYPES[bid.mtype] : bid.ext?.prebid?.type\r\n    if (!SUPPORTED_MEDIA_TYPES.hasOwnProperty(mediaType)) {\r\n      mediaType = BANNER;\r\n    }\r\n  }\r\n  bidResponse.mediaType = mediaType;\r\n}\r\n","import {deepSetValue} from '../../../src/utils.js';\r\n\r\nexport function setImpBidParams(imp, bidRequest) {\r\n  const params = bidRequest.params;\r\n  if (params) {\r\n    deepSetValue(\r\n      imp,\r\n      `ext.prebid.bidder.${bidRequest.bidder}`,\r\n      params\r\n    );\r\n  }\r\n}\r\n","import {BID_RESPONSE, IMP, REQUEST, RESPONSE} from '../../../src/pbjsORTB.js';\r\nimport {deepAccess, isPlainObject, isStr, mergeDeep} from '../../../src/utils.js';\r\nimport {extPrebidMediaType} from './mediaType.js';\r\nimport {setRequestExtPrebidAliases} from './aliases.js';\r\nimport {setImpBidParams} from './params.js';\r\nimport {setImpAdUnitCode} from './adUnitCode.js';\r\nimport {setRequestExtPrebid, setRequestExtPrebidChannel} from './requestExtPrebid.js';\r\nimport {setBidResponseVideoCache} from './video.js';\r\nimport {addEventTrackers} from './eventTrackers.js';\r\n\r\nexport const PBS_PROCESSORS = {\r\n  [REQUEST]: {\r\n    extPrebid: {\r\n      // set request.ext.prebid.auctiontimestamp, .debug and .targeting\r\n      fn: setRequestExtPrebid\r\n    },\r\n    extPrebidChannel: {\r\n      // sets request.ext.prebid.channel\r\n      fn: setRequestExtPrebidChannel\r\n    },\r\n    extPrebidAliases: {\r\n      // sets ext.prebid.aliases\r\n      fn: setRequestExtPrebidAliases\r\n    }\r\n  },\r\n  [IMP]: {\r\n    params: {\r\n      // sets bid ext.prebid.bidder.[bidderCode] with bidRequest.params, passed through transformBidParams if necessary\r\n      fn: setImpBidParams\r\n    },\r\n    adUnitCode: {\r\n      // sets bid ext.prebid.adunitcode\r\n      fn: setImpAdUnitCode\r\n    }\r\n  },\r\n  [BID_RESPONSE]: {\r\n    mediaType: {\r\n      // sets bidResponse.mediaType according to context.mediaType, falling back to imp.ext.prebid.type\r\n      fn: extPrebidMediaType,\r\n      priority: 99,\r\n    },\r\n    videoCache: {\r\n      // sets response video attributes; in addition, looks at ext.prebid.cache and .targeting to set video cache key and URL\r\n      fn: setBidResponseVideoCache,\r\n      priority: -10, // after 'video'\r\n    },\r\n    bidderCode: {\r\n      // sets bidderCode from on seatbid.seat\r\n      fn(bidResponse, bid, context) {\r\n        bidResponse.bidderCode = context.seatbid.seat;\r\n        bidResponse.adapterCode = bid?.ext?.prebid?.meta?.adaptercode || context.bidRequest?.bidder || bidResponse.bidderCode;\r\n      }\r\n    },\r\n    pbsBidId: {\r\n      // sets bidResponse.pbsBidId from ext.prebid.bidid\r\n      fn(bidResponse, bid) {\r\n        const bidId = bid?.ext?.prebid?.bidid;\r\n        if (isStr(bidId)) {\r\n          bidResponse.pbsBidId = bidId;\r\n        }\r\n      }\r\n    },\r\n    adserverTargeting: {\r\n      // sets bidResponse.adserverTargeting from ext.prebid.targeting\r\n      fn(bidResponse, bid) {\r\n        const targeting = bid?.ext?.prebid?.targeting;\r\n        if (isPlainObject(targeting)) {\r\n          bidResponse.adserverTargeting = targeting;\r\n        }\r\n      }\r\n    },\r\n    extPrebidMeta: {\r\n      // sets bidResponse.meta from ext.prebid.meta\r\n      fn(bidResponse, bid) {\r\n        bidResponse.meta = mergeDeep({}, bid?.ext?.prebid?.meta, bidResponse.meta);\r\n      }\r\n    },\r\n    pbsWinTrackers: {\r\n      // converts \"legacy\" burl and ext.prebid.events.win into eventtrackers\r\n      fn: addEventTrackers\r\n    },\r\n  },\r\n  [RESPONSE]: {\r\n    serverSideStats: {\r\n      // updates bidderRequest and bidRequests with serverErrors from ext.errors and serverResponseTimeMs from ext.responsetimemillis\r\n      fn(response, ortbResponse, context) {\r\n        Object.entries({\r\n          errors: 'serverErrors',\r\n          responsetimemillis: 'serverResponseTimeMs'\r\n        }).forEach(([serverName, clientName]) => {\r\n          const value = deepAccess(ortbResponse, `ext.${serverName}.${context.bidderRequest.bidderCode}`);\r\n          if (value) {\r\n            context.bidderRequest[clientName] = value;\r\n            context.bidRequests.forEach(bid => {\r\n              bid[clientName] = value;\r\n            });\r\n          }\r\n        })\r\n      }\r\n    },\r\n  }\r\n}\r\n","import {deepSetValue, mergeDeep} from '../../../src/utils.js';\r\nimport {config} from '../../../src/config.js';\r\nimport {getGlobal} from '../../../src/prebidGlobal.js';\r\n\r\nexport function setRequestExtPrebid(ortbRequest, bidderRequest) {\r\n  deepSetValue(\r\n    ortbRequest,\r\n    'ext.prebid',\r\n    mergeDeep(\r\n      {\r\n        auctiontimestamp: bidderRequest.auctionStart,\r\n        targeting: {\r\n          includewinners: true,\r\n          includebidderkeys: false\r\n        }\r\n      },\r\n      ortbRequest.ext?.prebid,\r\n    )\r\n  );\r\n  if (config.getConfig('debug')) {\r\n    ortbRequest.ext.prebid.debug = true;\r\n  }\r\n}\r\n\r\nexport function setRequestExtPrebidChannel(ortbRequest) {\r\n  deepSetValue(ortbRequest, 'ext.prebid.channel', Object.assign({\r\n    name: 'pbjs',\r\n    version: getGlobal().version\r\n  }, ortbRequest.ext?.prebid?.channel));\r\n}\r\n","import {VIDEO} from '../../../src/mediaTypes.js';\r\n\r\nexport function setBidResponseVideoCache(bidResponse, bid) {\r\n  if (bidResponse.mediaType === VIDEO) {\r\n    // try to get cache values from 'response.ext.prebid.cache'\r\n    // else try 'bid.ext.prebid.targeting' as fallback\r\n    let {cacheId: videoCacheKey, url: vastUrl} = bid?.ext?.prebid?.cache?.vastXml ?? {};\r\n    if (!videoCacheKey || !vastUrl) {\r\n      const {hb_uuid: uuid, hb_cache_host: cacheHost, hb_cache_path: cachePath} = bid?.ext?.prebid?.targeting ?? {};\r\n      if (uuid && cacheHost && cachePath) {\r\n        videoCacheKey = uuid;\r\n        vastUrl = `https://${cacheHost}${cachePath}?uuid=${uuid}`;\r\n      }\r\n    }\r\n    if (videoCacheKey && vastUrl) {\r\n      Object.assign(bidResponse, {\r\n        videoCacheKey,\r\n        vastUrl\r\n      })\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Create a domainOverride callback for an ID module, closing over\r\n * an instance of StorageManager.\r\n *\r\n * The domainOverride function, given document.domain, will return\r\n * the topmost domain we are able to set a cookie on. For example,\r\n * given subdomain.example.com, it would return example.com.\r\n *\r\n * @param storage e.g. from getStorageManager()\r\n * @param {string} moduleName the name of the module using this function\r\n * @returns {function(): string}\r\n */\r\nexport function domainOverrideToRootDomain(storage, moduleName) {\r\n  return function() {\r\n    const domainElements = document.domain.split('.');\r\n    const cookieName = `_gd${Date.now()}_${moduleName}`;\r\n\r\n    for (let i = 0, topDomain, testCookie; i < domainElements.length; i++) {\r\n      const nextDomain = domainElements.slice(i).join('.');\r\n\r\n      // write test cookie\r\n      storage.setCookie(cookieName, '1', undefined, undefined, nextDomain);\r\n\r\n      // read test cookie to verify domain was valid\r\n      testCookie = storage.getCookie(cookieName);\r\n\r\n      // delete test cookie\r\n      storage.setCookie(cookieName, '', 'Thu, 01 Jan 1970 00:00:01 GMT', undefined, nextDomain);\r\n\r\n      if (testCookie === '1') {\r\n        // cookie was written successfully using test domain so the topDomain is updated\r\n        topDomain = nextDomain;\r\n      } else {\r\n        // cookie failed to write using test domain so exit by returning the topDomain\r\n        return topDomain;\r\n      }\r\n    }\r\n  }\r\n}\r\n","/**\r\n * This module houses the functionality to evaluate and process adpod adunits/bids.  Specifically there are several hooked functions,\r\n * that either supplement the base function (ie to check something additional or unique to adpod objects) or to replace the base function\r\n * entirely when appropriate.\r\n *\r\n * Brief outline of each hook:\r\n * - `callPrebidCacheHook` - for any adpod bids, this function will temporarily hold them in a queue in order to send the bids to Prebid Cache in bulk\r\n * - `checkAdUnitSetupHook` - evaluates the adUnits to ensure that required fields for adpod adUnits are present.  Invalid adpod adUntis are removed from the array.\r\n * - `checkVideoBidSetupHook` - evaluates the adpod bid returned from an adaptor/bidder to ensure required fields are populated; also initializes duration bucket field.\r\n *\r\n * To initialize the module, there is an `initAdpodHooks()` function that should be imported and executed by a corresponding `...AdServerVideo`\r\n * module that designed to support adpod video type ads.  This import process allows this module to effectively act as a sub-module.\r\n */\r\n\r\nimport {\r\n  deepAccess,\r\n  generateUUID,\r\n  groupBy,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  logInfo,\r\n  logWarn\r\n} from '../src/utils.js';\r\nimport {\r\n  addBidToAuction,\r\n  AUCTION_IN_PROGRESS,\r\n  getPriceByGranularity,\r\n  getPriceGranularity\r\n} from '../src/auction.js';\r\nimport {checkAdUnitSetup} from '../src/prebid.js';\r\nimport {checkVideoBidSetup} from '../src/video.js';\r\nimport {getHook, module, setupBeforeHookFnOnce} from '../src/hook.js';\r\nimport {store} from '../src/videoCache.js';\r\nimport {config} from '../src/config.js';\r\nimport {ADPOD} from '../src/mediaTypes.js';\r\nimport {auctionManager} from '../src/auctionManager.js';\r\nimport { TARGETING_KEYS } from '../src/constants.js';\r\n\r\nconst TARGETING_KEY_PB_CAT_DUR = 'hb_pb_cat_dur';\r\nconst TARGETING_KEY_CACHE_ID = 'hb_cache_id';\r\n\r\nlet queueTimeDelay = 50;\r\nlet queueSizeLimit = 5;\r\nconst bidCacheRegistry = createBidCacheRegistry();\r\n\r\n/**\r\n * Create a registry object that stores/manages bids while be held in queue for Prebid Cache.\r\n * @returns registry object with defined accessor functions\r\n */\r\nfunction createBidCacheRegistry() {\r\n  const registry = {};\r\n\r\n  function setupRegistrySlot(auctionId) {\r\n    registry[auctionId] = {};\r\n    registry[auctionId].bidStorage = new Set();\r\n    registry[auctionId].queueDispatcher = createDispatcher(queueTimeDelay);\r\n    registry[auctionId].initialCacheKey = generateUUID();\r\n  }\r\n\r\n  return {\r\n    addBid: function (bid) {\r\n      // create parent level object based on auction ID (in case there are concurrent auctions running) to store objects for that auction\r\n      if (!registry[bid.auctionId]) {\r\n        setupRegistrySlot(bid.auctionId);\r\n      }\r\n      registry[bid.auctionId].bidStorage.add(bid);\r\n    },\r\n    removeBid: function (bid) {\r\n      registry[bid.auctionId].bidStorage.delete(bid);\r\n    },\r\n    getBids: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].bidStorage.values();\r\n    },\r\n    getQueueDispatcher: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].queueDispatcher;\r\n    },\r\n    setupInitialCacheKey: function (bid) {\r\n      if (!registry[bid.auctionId]) {\r\n        registry[bid.auctionId] = {};\r\n        registry[bid.auctionId].initialCacheKey = generateUUID();\r\n      }\r\n    },\r\n    getInitialCacheKey: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].initialCacheKey;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Creates a function that when called updates the bid queue and extends the running timer (when called subsequently).\r\n * Once the time threshold for the queue (defined by queueSizeLimit) is reached, the queue will be flushed by calling the `firePrebidCacheCall` function.\r\n * If there is a long enough time between calls (based on timeoutDration), the queue will automatically flush itself.\r\n * @param {Number} timeoutDuration number of milliseconds to pass before timer expires and current bid queue is flushed\r\n * @returns {Function}\r\n */\r\nfunction createDispatcher(timeoutDuration) {\r\n  let timeout;\r\n  let counter = 1;\r\n\r\n  return function (auctionInstance, bidListArr, afterBidAdded, killQueue) {\r\n    const context = this;\r\n\r\n    var callbackFn = function () {\r\n      firePrebidCacheCall.call(context, auctionInstance, bidListArr, afterBidAdded);\r\n    };\r\n\r\n    clearTimeout(timeout);\r\n\r\n    if (!killQueue) {\r\n      // want to fire off the queue if either: size limit is reached or time has passed since last call to dispatcher\r\n      if (counter === queueSizeLimit) {\r\n        counter = 1;\r\n        callbackFn();\r\n      } else {\r\n        counter++;\r\n        timeout = setTimeout(callbackFn, timeoutDuration);\r\n      }\r\n    } else {\r\n      counter = 1;\r\n    }\r\n  };\r\n}\r\n\r\nfunction getPricePartForAdpodKey(bid) {\r\n  let pricePart\r\n  const prioritizeDeals = config.getConfig('adpod.prioritizeDeals');\r\n  if (prioritizeDeals && deepAccess(bid, 'video.dealTier')) {\r\n    const adpodDealPrefix = config.getConfig(`adpod.dealTier.${bid.bidderCode}.prefix`);\r\n    pricePart = (adpodDealPrefix) ? adpodDealPrefix + deepAccess(bid, 'video.dealTier') : deepAccess(bid, 'video.dealTier');\r\n  } else {\r\n    const granularity = getPriceGranularity(bid);\r\n    pricePart = getPriceByGranularity(granularity)(bid);\r\n  }\r\n  return pricePart\r\n}\r\n\r\n/**\r\n * This function reads certain fields from the bid to generate a specific key used for caching the bid in Prebid Cache\r\n * @param {Object} bid bid object to update\r\n * @param {Boolean} brandCategoryExclusion value read from setConfig; influences whether category is required or not\r\n */\r\nfunction attachPriceIndustryDurationKeyToBid(bid, brandCategoryExclusion) {\r\n  const initialCacheKey = bidCacheRegistry.getInitialCacheKey(bid);\r\n  const duration = deepAccess(bid, 'video.durationBucket');\r\n  const pricePart = getPricePartForAdpodKey(bid);\r\n  let pcd;\r\n\r\n  if (brandCategoryExclusion) {\r\n    const category = deepAccess(bid, 'meta.adServerCatId');\r\n    pcd = `${pricePart}_${category}_${duration}s`;\r\n  } else {\r\n    pcd = `${pricePart}_${duration}s`;\r\n  }\r\n\r\n  if (!bid.adserverTargeting) {\r\n    bid.adserverTargeting = {};\r\n  }\r\n  bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR] = pcd;\r\n  bid.adserverTargeting[TARGETING_KEY_CACHE_ID] = initialCacheKey;\r\n  bid.videoCacheKey = initialCacheKey;\r\n  bid.customCacheKey = `${pcd}_${initialCacheKey}`;\r\n}\r\n\r\n/**\r\n * Updates the running queue for the associated auction.\r\n * Does a check to ensure the auction is still running; if it's not - the previously running queue is killed.\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Object} bidResponse bid object being added to queue\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n */\r\nfunction updateBidQueue(auctionInstance, bidResponse, afterBidAdded) {\r\n  const bidListIter = bidCacheRegistry.getBids(bidResponse);\r\n\r\n  if (bidListIter) {\r\n    const bidListArr = Array.from(bidListIter);\r\n    const callDispatcher = bidCacheRegistry.getQueueDispatcher(bidResponse);\r\n    const killQueue = !!(auctionInstance.getAuctionStatus() !== AUCTION_IN_PROGRESS);\r\n    callDispatcher(auctionInstance, bidListArr, afterBidAdded, killQueue);\r\n  } else {\r\n    logWarn('Attempted to cache a bid from an unknown auction. Bid:', bidResponse);\r\n  }\r\n}\r\n\r\n/**\r\n * Small helper function to remove bids from internal storage; normally b/c they're about to sent to Prebid Cache for processing.\r\n * @param {Array[Object]} bidResponses list of bids to remove\r\n */\r\nfunction removeBidsFromStorage(bidResponses) {\r\n  for (let i = 0; i < bidResponses.length; i++) {\r\n    bidCacheRegistry.removeBid(bidResponses[i]);\r\n  }\r\n}\r\n\r\n/**\r\n * This function will send a list of bids to Prebid Cache.  It also removes the same bids from the internal bidCacheRegistry\r\n * to maintain which bids are in queue.\r\n * If the bids are successfully cached, they will be added to the respective auction.\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Array[Object]} bidList list of bid objects that need to be sent to Prebid Cache\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n */\r\nfunction firePrebidCacheCall(auctionInstance, bidList, afterBidAdded) {\r\n  // remove entries now so other incoming bids won't accidentally have a stale version of the list while PBC is processing the current submitted list\r\n  removeBidsFromStorage(bidList);\r\n\r\n  store(bidList, function (error, cacheIds) {\r\n    if (error) {\r\n      logWarn(`Failed to save to the video cache: ${error}. Video bid(s) must be discarded.`);\r\n    } else {\r\n      for (let i = 0; i < cacheIds.length; i++) {\r\n        // when uuid in response is empty string then the key already existed, so this bid wasn't cached\r\n        if (cacheIds[i].uuid !== '') {\r\n          addBidToAuction(auctionInstance, bidList[i]);\r\n        } else {\r\n          logInfo(`Detected a bid was not cached because the custom key was already registered.  Attempted to use key: ${bidList[i].customCacheKey}. Bid was: `, bidList[i]);\r\n        }\r\n        afterBidAdded();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * This is the main hook function to handle adpod bids; maintains the logic to temporarily hold bids in a queue in order to send bulk requests to Prebid Cache.\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Object} bidResponse incoming bid; if adpod, will be processed through hook function.  If not adpod, returns to original function.\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n * @param {Object} videoConfig mediaTypes.video from the bid's adUnit\r\n */\r\nexport function callPrebidCacheHook(fn, auctionInstance, bidResponse, afterBidAdded, videoConfig) {\r\n  if (videoConfig && videoConfig.context === ADPOD) {\r\n    const brandCategoryExclusion = config.getConfig('adpod.brandCategoryExclusion');\r\n    const adServerCatId = deepAccess(bidResponse, 'meta.adServerCatId');\r\n    if (!adServerCatId && brandCategoryExclusion) {\r\n      logWarn('Detected a bid without meta.adServerCatId while setConfig({adpod.brandCategoryExclusion}) was enabled.  This bid has been rejected:', bidResponse);\r\n      afterBidAdded();\r\n    } else {\r\n      if (config.getConfig('adpod.deferCaching') === false) {\r\n        bidCacheRegistry.addBid(bidResponse);\r\n        attachPriceIndustryDurationKeyToBid(bidResponse, brandCategoryExclusion);\r\n\r\n        updateBidQueue(auctionInstance, bidResponse, afterBidAdded);\r\n      } else {\r\n        // generate targeting keys for bid\r\n        bidCacheRegistry.setupInitialCacheKey(bidResponse);\r\n        attachPriceIndustryDurationKeyToBid(bidResponse, brandCategoryExclusion);\r\n\r\n        // add bid to auction\r\n        addBidToAuction(auctionInstance, bidResponse);\r\n        afterBidAdded();\r\n      }\r\n    }\r\n  } else {\r\n    fn.call(this, auctionInstance, bidResponse, afterBidAdded, videoConfig);\r\n  }\r\n}\r\n\r\n/**\r\n * This hook function will review the adUnit setup and verify certain required values are present in any adpod adUnits.\r\n * If the fields are missing or incorrectly setup, the adUnit is removed from the list.\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {Array[Object]} adUnits list of adUnits to be evaluated\r\n * @returns {Array[Object]} list of adUnits that passed the check\r\n */\r\nexport function checkAdUnitSetupHook(fn, adUnits) {\r\n  const goodAdUnits = adUnits.filter(adUnit => {\r\n    const mediaTypes = deepAccess(adUnit, 'mediaTypes');\r\n    const videoConfig = deepAccess(mediaTypes, 'video');\r\n    if (videoConfig && videoConfig.context === ADPOD) {\r\n      // run check to see if other mediaTypes are defined (ie multi-format); reject adUnit if so\r\n      if (Object.keys(mediaTypes).length > 1) {\r\n        logWarn(`Detected more than one mediaType in adUnitCode: ${adUnit.code} while attempting to define an 'adpod' video adUnit.  'adpod' adUnits cannot be mixed with other mediaTypes.  This adUnit will be removed from the auction.`);\r\n        return false;\r\n      }\r\n\r\n      let errMsg = `Detected missing or incorrectly setup fields for an adpod adUnit.  Please review the following fields of adUnitCode: ${adUnit.code}.  This adUnit will be removed from the auction.`;\r\n\r\n      const playerSize = !!(\r\n        (\r\n          videoConfig.playerSize && (\r\n            isArrayOfNums(videoConfig.playerSize, 2) || (\r\n              isArray(videoConfig.playerSize) && videoConfig.playerSize.every(sz => isArrayOfNums(sz, 2))\r\n            )\r\n          )\r\n        ) || (videoConfig.sizeConfig)\r\n      );\r\n      const adPodDurationSec = !!(videoConfig.adPodDurationSec && isNumber(videoConfig.adPodDurationSec) && videoConfig.adPodDurationSec > 0);\r\n      const durationRangeSec = !!(videoConfig.durationRangeSec && isArrayOfNums(videoConfig.durationRangeSec) && videoConfig.durationRangeSec.every(range => range > 0));\r\n\r\n      if (!playerSize || !adPodDurationSec || !durationRangeSec) {\r\n        errMsg += (!playerSize) ? '\\nmediaTypes.video.playerSize' : '';\r\n        errMsg += (!adPodDurationSec) ? '\\nmediaTypes.video.adPodDurationSec' : '';\r\n        errMsg += (!durationRangeSec) ? '\\nmediaTypes.video.durationRangeSec' : '';\r\n        logWarn(errMsg);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  });\r\n  adUnits = goodAdUnits;\r\n  fn.call(this, adUnits);\r\n}\r\n\r\n/**\r\n * This check evaluates the incoming bid's `video.durationSeconds` field and tests it against specific logic depending on adUnit config.  Summary of logic below:\r\n * when adUnit.mediaTypes.video.requireExactDuration is true\r\n *  - only bids that exactly match those listed values are accepted (don't round at all).\r\n *  - populate the `bid.video.durationBucket` field with the matching duration value\r\n * when adUnit.mediaTypes.video.requireExactDuration is false\r\n *  - round the duration to the next highest specified duration value based on adunit.  If the duration is above a range within a set buffer, that bid falls down into that bucket.\r\n *      (eg if range was [5, 15, 30] -> 2s is rounded to 5s; 17s is rounded back to 15s; 18s is rounded up to 30s)\r\n *  - if the bid is above the range of the listed durations (and outside the buffer), reject the bid\r\n *  - set the rounded duration value in the `bid.video.durationBucket` field for accepted bids\r\n * @param {Object} videoMediaType 'mediaTypes.video' associated to bidResponse\r\n * @param {Object} bidResponse incoming bidResponse being evaluated by bidderFactory\r\n * @returns {boolean} return false if bid duration is deemed invalid as per adUnit configuration; return true if fine\r\n */\r\nfunction checkBidDuration(videoMediaType, bidResponse) {\r\n  const buffer = 2;\r\n  const bidDuration = deepAccess(bidResponse, 'video.durationSeconds');\r\n  const adUnitRanges = videoMediaType.durationRangeSec;\r\n  adUnitRanges.sort((a, b) => a - b); // ensure the ranges are sorted in numeric order\r\n\r\n  if (!videoMediaType.requireExactDuration) {\r\n    const max = Math.max(...adUnitRanges);\r\n    if (bidDuration <= (max + buffer)) {\r\n      const nextHighestRange = ((adUnitRanges) || []).find(range => (range + buffer) >= bidDuration);\r\n      bidResponse.video.durationBucket = nextHighestRange;\r\n    } else {\r\n      logWarn(`Detected a bid with a duration value outside the accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Rejecting bid: `, bidResponse);\r\n      return false;\r\n    }\r\n  } else {\r\n    if (((adUnitRanges) || []).find(range => range === bidDuration)) {\r\n      bidResponse.video.durationBucket = bidDuration;\r\n    } else {\r\n      logWarn(`Detected a bid with a duration value not part of the list of accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Exact match durations must be used for this adUnit. Rejecting bid: `, bidResponse);\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * This hooked function evaluates an adpod bid and determines if the required fields are present.\r\n * If it's found to not be an adpod bid, it will return to original function via hook logic\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {Object} bid incoming bid object\r\n * @param {Object} adUnit adUnit object of associated bid\r\n * @param {Object} videoMediaType copy of the `bidRequest.mediaTypes.video` object; used in original function\r\n * @param {String} context value of the `bidRequest.mediaTypes.video.context` field; used in original function\r\n * @returns {boolean} this return is only used for adpod bids\r\n */\r\nexport function checkVideoBidSetupHook(fn, bid, adUnit, videoMediaType, context) {\r\n  if (context === ADPOD) {\r\n    let result = true;\r\n    const brandCategoryExclusion = config.getConfig('adpod.brandCategoryExclusion');\r\n    if (brandCategoryExclusion && !deepAccess(bid, 'meta.primaryCatId')) {\r\n      result = false;\r\n    }\r\n\r\n    if (deepAccess(bid, 'video')) {\r\n      if (!deepAccess(bid, 'video.context') || bid.video.context !== ADPOD) {\r\n        result = false;\r\n      }\r\n\r\n      if (!deepAccess(bid, 'video.durationSeconds') || bid.video.durationSeconds <= 0) {\r\n        result = false;\r\n      } else {\r\n        const isBidGood = checkBidDuration(videoMediaType, bid);\r\n        if (!isBidGood) result = false;\r\n      }\r\n    }\r\n\r\n    if (!config.getConfig('cache.url') && bid.vastXml && !bid.vastUrl) {\r\n      logError(`\r\n        This bid contains only vastXml and will not work when a prebid cache url is not specified.\r\n        Try enabling prebid cache with pbjs.setConfig({ cache: {url: \"...\"} });\r\n      `);\r\n      result = false;\r\n    };\r\n\r\n    fn.bail(result);\r\n  } else {\r\n    fn.call(this, bid, adUnit, videoMediaType, context);\r\n  }\r\n}\r\n\r\n/**\r\n * This function reads the (optional) settings for the adpod as set from the setConfig()\r\n * @param {Object} config contains the config settings for adpod module\r\n */\r\nexport function adpodSetConfig(config) {\r\n  if (config.bidQueueTimeDelay !== undefined) {\r\n    if (typeof config.bidQueueTimeDelay === 'number' && config.bidQueueTimeDelay > 0) {\r\n      queueTimeDelay = config.bidQueueTimeDelay;\r\n    } else {\r\n      logWarn(`Detected invalid value for adpod.bidQueueTimeDelay in setConfig; must be a positive number.  Using default: ${queueTimeDelay}`)\r\n    }\r\n  }\r\n\r\n  if (config.bidQueueSizeLimit !== undefined) {\r\n    if (typeof config.bidQueueSizeLimit === 'number' && config.bidQueueSizeLimit > 0) {\r\n      queueSizeLimit = config.bidQueueSizeLimit;\r\n    } else {\r\n      logWarn(`Detected invalid value for adpod.bidQueueSizeLimit in setConfig; must be a positive number.  Using default: ${queueSizeLimit}`)\r\n    }\r\n  }\r\n}\r\nconfig.getConfig('adpod', config => adpodSetConfig(config.adpod));\r\n\r\n/**\r\n * This function initializes the adpod module's hooks.  This is called by the corresponding adserver video module.\r\n * PBJS 10: Adding a deprecation warning\r\n */\r\nfunction initAdpodHooks() {\r\n  logWarn('DEPRECATION NOTICE: Prebid.js is not aware of any transactions requiring the ADPOD video mediatype context. Please open a github issue if you are relying on it as support for it may be removed in a future version.');\r\n\r\n  setupBeforeHookFnOnce(getHook('callPrebidCache'), callPrebidCacheHook);\r\n  setupBeforeHookFnOnce(checkAdUnitSetup, checkAdUnitSetupHook);\r\n  setupBeforeHookFnOnce(checkVideoBidSetup, checkVideoBidSetupHook);\r\n}\r\n\r\ninitAdpodHooks()\r\n\r\n/**\r\n *\r\n * @param {Array[Object]} bids list of 'winning' bids that need to be cached\r\n * @param {Function} callback send the cached bids (or error) back to adserverVideoModule for further processing\r\n }}\r\n */\r\nexport function callPrebidCacheAfterAuction(bids, callback) {\r\n  // will call PBC here and execute cb param to initialize player code\r\n  store(bids, function (error, cacheIds) {\r\n    if (error) {\r\n      callback(error, null);\r\n    } else {\r\n      const successfulCachedBids = [];\r\n      for (let i = 0; i < cacheIds.length; i++) {\r\n        if (cacheIds[i] !== '') {\r\n          successfulCachedBids.push(bids[i]);\r\n        }\r\n      }\r\n      callback(null, successfulCachedBids);\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Compare function to be used in sorting long-form bids. This will compare bids on price per second.\r\n */\r\nexport function sortByPricePerSecond(a, b) {\r\n  if (a.adserverTargeting[TARGETING_KEYS.PRICE_BUCKET] / a.video.durationBucket < b.adserverTargeting[TARGETING_KEYS.PRICE_BUCKET] / b.video.durationBucket) {\r\n    return 1;\r\n  }\r\n  if (a.adserverTargeting[TARGETING_KEYS.PRICE_BUCKET] / a.video.durationBucket > b.adserverTargeting[TARGETING_KEYS.PRICE_BUCKET] / b.video.durationBucket) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n}\r\n\r\n/**\r\n * This function returns targeting keyvalue pairs for long-form adserver modules. Freewheel and GAM are currently supporting Prebid long-form\r\n * @param {Object} options - Options for targeting.\r\n * @param {Array<string>} options.codes - Array of ad unit codes.\r\n * @param {function} options.callback - Callback function to handle the targeting key-value pairs.\r\n * @returns {Object} Targeting key-value pairs for ad unit codes.\r\n */\r\nexport function getTargeting({ codes, callback } = {}) {\r\n  if (!callback) {\r\n    logError('No callback function was defined in the getTargeting call.  Aborting getTargeting().');\r\n    return;\r\n  }\r\n  codes = codes || [];\r\n  const adPodAdUnits = getAdPodAdUnits(codes);\r\n  const bidsReceived = auctionManager.getBidsReceived();\r\n  const competiveExclusionEnabled = config.getConfig('adpod.brandCategoryExclusion');\r\n  const deferCachingSetting = config.getConfig('adpod.deferCaching');\r\n  const deferCachingEnabled = (typeof deferCachingSetting === 'boolean') ? deferCachingSetting : true;\r\n\r\n  let bids = getBidsForAdpod(bidsReceived, adPodAdUnits);\r\n  bids = (competiveExclusionEnabled || deferCachingEnabled) ? getExclusiveBids(bids) : bids;\r\n\r\n  const prioritizeDeals = config.getConfig('adpod.prioritizeDeals');\r\n  if (prioritizeDeals) {\r\n    const [otherBids, highPriorityDealBids] = bids.reduce((partitions, bid) => {\r\n      const bidDealTier = deepAccess(bid, 'video.dealTier');\r\n      const minDealTier = config.getConfig(`adpod.dealTier.${bid.bidderCode}.minDealTier`);\r\n      if (minDealTier && bidDealTier) {\r\n        if (bidDealTier >= minDealTier) {\r\n          partitions[1].push(bid)\r\n        } else {\r\n          partitions[0].push(bid)\r\n        }\r\n      } else if (bidDealTier) {\r\n        partitions[1].push(bid)\r\n      } else {\r\n        partitions[0].push(bid);\r\n      }\r\n      return partitions;\r\n    }, [[], []]);\r\n    highPriorityDealBids.sort(sortByPricePerSecond);\r\n    otherBids.sort(sortByPricePerSecond);\r\n    bids = highPriorityDealBids.concat(otherBids);\r\n  } else {\r\n    bids.sort(sortByPricePerSecond);\r\n  }\r\n\r\n  const targeting = {};\r\n  if (deferCachingEnabled === false) {\r\n    adPodAdUnits.forEach((adUnit) => {\r\n      const adPodTargeting = [];\r\n      let adPodDurationSeconds = deepAccess(adUnit, 'mediaTypes.video.adPodDurationSec');\r\n\r\n      bids\r\n        .filter((bid) => bid.adUnitCode === adUnit.code)\r\n        .forEach((bid, index, arr) => {\r\n          if (bid.video.durationBucket <= adPodDurationSeconds) {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR]\r\n            });\r\n            adPodDurationSeconds -= bid.video.durationBucket;\r\n          }\r\n          if (index === arr.length - 1 && adPodTargeting.length > 0) {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_CACHE_ID]: bid.adserverTargeting[TARGETING_KEY_CACHE_ID]\r\n            });\r\n          }\r\n        });\r\n      targeting[adUnit.code] = adPodTargeting;\r\n    });\r\n\r\n    callback(null, targeting);\r\n  } else {\r\n    const bidsToCache = [];\r\n    adPodAdUnits.forEach((adUnit) => {\r\n      let adPodDurationSeconds = deepAccess(adUnit, 'mediaTypes.video.adPodDurationSec');\r\n\r\n      bids\r\n        .filter((bid) => bid.adUnitCode === adUnit.code)\r\n        .forEach((bid) => {\r\n          if (bid.video.durationBucket <= adPodDurationSeconds) {\r\n            bidsToCache.push(bid);\r\n            adPodDurationSeconds -= bid.video.durationBucket;\r\n          }\r\n        });\r\n    });\r\n\r\n    callPrebidCacheAfterAuction(bidsToCache, function (error, bidsSuccessfullyCached) {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const groupedBids = groupBy(bidsSuccessfullyCached, 'adUnitCode');\r\n        Object.keys(groupedBids).forEach((adUnitCode) => {\r\n          const adPodTargeting = [];\r\n\r\n          groupedBids[adUnitCode].forEach((bid, index, arr) => {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR]\r\n            });\r\n\r\n            if (index === arr.length - 1 && adPodTargeting.length > 0) {\r\n              adPodTargeting.push({\r\n                [TARGETING_KEY_CACHE_ID]: bid.adserverTargeting[TARGETING_KEY_CACHE_ID]\r\n              });\r\n            }\r\n          });\r\n          targeting[adUnitCode] = adPodTargeting;\r\n        });\r\n\r\n        callback(null, targeting);\r\n      }\r\n    });\r\n  }\r\n  return targeting;\r\n}\r\n\r\n/**\r\n * This function returns the adunit of mediaType adpod\r\n * @param {Array} codes adUnitCodes\r\n * @returns {Array[Object]} adunits of mediaType adpod\r\n */\r\nfunction getAdPodAdUnits(codes) {\r\n  return auctionManager.getAdUnits()\r\n    .filter((adUnit) => deepAccess(adUnit, 'mediaTypes.video.context') === ADPOD)\r\n    .filter((adUnit) => (codes.length > 0) ? codes.indexOf(adUnit.code) != -1 : true);\r\n}\r\n\r\n/**\r\n * This function will create compare function to sort on object property\r\n * @param {string} property\r\n * @returns {function} compare function to be used in sorting\r\n */\r\nfunction compareOn(property) {\r\n  return function compare(a, b) {\r\n    if (a[property] < b[property]) {\r\n      return 1;\r\n    }\r\n    if (a[property] > b[property]) {\r\n      return -1;\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * This function removes bids of same category. It will be used when competitive exclusion is enabled.\r\n * @param {Array[Object]} bidsReceived\r\n * @returns {Array[Object]} unique category bids\r\n */\r\nfunction getExclusiveBids(bidsReceived) {\r\n  let bids = bidsReceived\r\n    .map((bid) => Object.assign({}, bid, { [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR] }));\r\n  bids = groupBy(bids, TARGETING_KEY_PB_CAT_DUR);\r\n  const filteredBids = [];\r\n  Object.keys(bids).forEach((targetingKey) => {\r\n    bids[targetingKey].sort(compareOn('responseTimestamp'));\r\n    filteredBids.push(bids[targetingKey][0]);\r\n  });\r\n  return filteredBids;\r\n}\r\n\r\n/**\r\n * This function returns bids for adpod adunits\r\n * @param {Array[Object]} bidsReceived\r\n * @param {Array[Object]} adPodAdUnits\r\n * @returns {Array[Object]} bids of mediaType adpod\r\n */\r\nfunction getBidsForAdpod(bidsReceived, adPodAdUnits) {\r\n  const adUnitCodes = adPodAdUnits.map((adUnit) => adUnit.code);\r\n  return bidsReceived\r\n    .filter((bid) => adUnitCodes.indexOf(bid.adUnitCode) != -1 && (bid.video && bid.video.context === ADPOD))\r\n}\r\n\r\nconst sharedMethods = {\r\n  TARGETING_KEY_PB_CAT_DUR: TARGETING_KEY_PB_CAT_DUR,\r\n  TARGETING_KEY_CACHE_ID: TARGETING_KEY_CACHE_ID,\r\n  'getTargeting': getTargeting\r\n}\r\nObject.freeze(sharedMethods);\r\n\r\nmodule('adpod', function shareAdpodUtilities(...args) {\r\n  if (!isPlainObject(args[0])) {\r\n    logError('Adpod module needs plain object to share methods with submodule');\r\n    return;\r\n  }\r\n  function addMethods(object, func) {\r\n    for (const name in func) {\r\n      object[name] = func[name];\r\n    }\r\n  }\r\n  addMethods(args[0], sharedMethods);\r\n});\r\n","import {\r\n  createTrackPixelHtml,\r\n  deepAccess,\r\n  deepClone,\r\n  getBidRequest,\r\n  getParameterByName,\r\n  getUniqueIdentifierStr,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isEmpty,\r\n  isFn,\r\n  isNumber,\r\n  isPlainObject,\r\n  isStr,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep\r\n} from '../src/utils.js';\r\nimport {Renderer} from '../src/Renderer.js';\r\nimport {config} from '../src/config.js';\r\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport {ADPOD, BANNER, NATIVE, VIDEO} from '../src/mediaTypes.js';\r\nimport {INSTREAM, OUTSTREAM} from '../src/video.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {bidderSettings} from '../src/bidderSettings.js';\r\nimport {hasPurpose1Consent} from '../src/utils/gdpr.js';\r\nimport {convertOrtbRequestToProprietaryNative} from '../src/native.js';\r\nimport {APPNEXUS_CATEGORY_MAPPING} from '../libraries/categoryTranslationMapping/index.js';\r\nimport {\r\n  convertKeywordStringToANMap,\r\n  getANKewyordParamFromMaps,\r\n  getANKeywordParam\r\n} from '../libraries/appnexusUtils/anKeywords.js';\r\nimport {convertCamelToUnderscore, fill, appnexusAliases} from '../libraries/appnexusUtils/anUtils.js';\r\nimport {convertTypes} from '../libraries/transformParamsUtils/convertTypes.js';\r\nimport {chunk} from '../libraries/chunk/chunk.js';\r\n\r\n/**\r\n * @typedef {import('../src/adapters/bidderFactory.js').BidRequest} BidRequest\r\n * @typedef {import('../src/adapters/bidderFactory.js').Bid} Bid\r\n */\r\n\r\nconst BIDDER_CODE = 'appnexus';\r\nconst URL = 'https://ib.adnxs.com/ut/v3/prebid';\r\nconst URL_SIMPLE = 'https://ib.adnxs-simple.com/ut/v3/prebid';\r\nconst VIDEO_TARGETING = ['id', 'minduration', 'maxduration',\r\n  'skippable', 'playback_method', 'frameworks', 'context', 'skipoffset'];\r\nconst VIDEO_RTB_TARGETING = ['minduration', 'maxduration', 'skip', 'skipafter', 'playbackmethod', 'api', 'startdelay', 'placement', 'plcmt'];\r\nconst USER_PARAMS = ['age', 'externalUid', 'external_uid', 'segments', 'gender', 'dnt', 'language'];\r\nconst APP_DEVICE_PARAMS = ['geo', 'device_id']; // appid is collected separately\r\nconst DEBUG_PARAMS = ['enabled', 'dongle', 'member_id', 'debug_timeout'];\r\nconst DEBUG_QUERY_PARAM_MAP = {\r\n  'apn_debug_dongle': 'dongle',\r\n  'apn_debug_member_id': 'member_id',\r\n  'apn_debug_timeout': 'debug_timeout'\r\n};\r\nconst VIDEO_MAPPING = {\r\n  playback_method: {\r\n    'unknown': 0,\r\n    'auto_play_sound_on': 1,\r\n    'auto_play_sound_off': 2,\r\n    'click_to_play': 3,\r\n    'mouse_over': 4,\r\n    'auto_play_sound_unknown': 5\r\n  },\r\n  context: {\r\n    'unknown': 0,\r\n    'pre_roll': 1,\r\n    'mid_roll': 2,\r\n    'post_roll': 3,\r\n    'outstream': 4,\r\n    'in-banner': 5,\r\n    'in-feed': 6,\r\n    'interstitial': 7,\r\n    'accompanying_content_pre_roll': 8,\r\n    'accompanying_content_mid_roll': 9,\r\n    'accompanying_content_post_roll': 10\r\n  }\r\n};\r\nconst NATIVE_MAPPING = {\r\n  body: 'description',\r\n  body2: 'desc2',\r\n  cta: 'ctatext',\r\n  image: {\r\n    serverName: 'main_image',\r\n    requiredParams: { required: true }\r\n  },\r\n  icon: {\r\n    serverName: 'icon',\r\n    requiredParams: { required: true }\r\n  },\r\n  sponsoredBy: 'sponsored_by',\r\n  privacyLink: 'privacy_link',\r\n  salePrice: 'saleprice',\r\n  displayUrl: 'displayurl'\r\n};\r\nconst SOURCE = 'pbjs';\r\nconst MAX_IMPS_PER_REQUEST = 15;\r\nconst SCRIPT_TAG_START = '<script';\r\nconst VIEWABILITY_URL_START = /\\/\\/cdn\\.adnxs\\.com\\/v|\\/\\/cdn\\.adnxs\\-simple\\.com\\/v/;\r\nconst VIEWABILITY_FILE_NAME = 'trk.js';\r\nconst GVLID = 32;\r\nconst storage = getStorageManager({bidderCode: BIDDER_CODE});\r\n// ORTB2 device types according to the OpenRTB specification\r\nconst ORTB2_DEVICE_TYPE = {\r\n  MOBILE_TABLET: 1,\r\n  PERSONAL_COMPUTER: 2,\r\n  CONNECTED_TV: 3,\r\n  PHONE: 4,\r\n  TABLET: 5,\r\n  CONNECTED_DEVICE: 6,\r\n  SET_TOP_BOX: 7,\r\n  OOH_DEVICE: 8\r\n};\r\n// Map of ORTB2 device types to AppNexus device types\r\nconst ORTB2_DEVICE_TYPE_MAP = new Map([\r\n  [ORTB2_DEVICE_TYPE.MOBILE_TABLET, 'Mobile/Tablet - General'],\r\n  [ORTB2_DEVICE_TYPE.PERSONAL_COMPUTER, 'Personal Computer'],\r\n  [ORTB2_DEVICE_TYPE.CONNECTED_TV, 'Connected TV'],\r\n  [ORTB2_DEVICE_TYPE.PHONE, 'Phone'],\r\n  [ORTB2_DEVICE_TYPE.TABLET, 'Tablet'],\r\n  [ORTB2_DEVICE_TYPE.CONNECTED_DEVICE, 'Connected Device'],\r\n  [ORTB2_DEVICE_TYPE.SET_TOP_BOX, 'Set Top Box'],\r\n  [ORTB2_DEVICE_TYPE.OOH_DEVICE, 'OOH Device'],\r\n]);\r\n\r\nexport const spec = {\r\n  code: BIDDER_CODE,\r\n  gvlid: GVLID,\r\n  aliases: appnexusAliases,\r\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\r\n\r\n  /**\r\n   * Determines whether or not the given bid request is valid.\r\n   *\r\n   * @param {object} bid The bid to validate.\r\n   * @return boolean True if this is a valid bid, and false otherwise.\r\n   */\r\n  isBidRequestValid: function (bid) {\r\n    return !!(\r\n      (bid.params.placementId || bid.params.placement_id) ||\r\n      (bid.params.member && (bid.params.invCode || bid.params.inv_code)));\r\n  },\r\n\r\n  /**\r\n   * Make a server request from the list of BidRequests.\r\n   *\r\n   * @param {BidRequest[]} bidRequests A non-empty list of bid requests which should be sent to the Server.\r\n   * @return ServerRequest Info describing the request to the server.\r\n   */\r\n  buildRequests: function (bidRequests, bidderRequest) {\r\n    // convert Native ORTB definition to old-style prebid native definition\r\n    bidRequests = convertOrtbRequestToProprietaryNative(bidRequests);\r\n\r\n    const tags = bidRequests.map(bidToTag);\r\n    const userObjBid = ((bidRequests) || []).find(hasUserInfo);\r\n    let userObj = {};\r\n    if (config.getConfig('coppa') === true) {\r\n      userObj = { 'coppa': true };\r\n    }\r\n    if (userObjBid) {\r\n      Object.keys(userObjBid.params.user)\r\n        .filter(param => USER_PARAMS.includes(param))\r\n        .forEach((param) => {\r\n          const uparam = convertCamelToUnderscore(param);\r\n          if (param === 'segments' && isArray(userObjBid.params.user[param])) {\r\n            const segs = [];\r\n            userObjBid.params.user[param].forEach(val => {\r\n              if (isNumber(val)) {\r\n                segs.push({'id': val});\r\n              } else if (isPlainObject(val)) {\r\n                segs.push(val);\r\n              }\r\n            });\r\n            userObj[uparam] = segs;\r\n          } else if (param !== 'segments') {\r\n            userObj[uparam] = userObjBid.params.user[param];\r\n          }\r\n        });\r\n    }\r\n\r\n    const appDeviceObjBid = ((bidRequests) || []).find(hasAppDeviceInfo);\r\n    let appDeviceObj;\r\n    if (appDeviceObjBid && appDeviceObjBid.params && appDeviceObjBid.params.app) {\r\n      appDeviceObj = {};\r\n      Object.keys(appDeviceObjBid.params.app)\r\n        .filter(param => APP_DEVICE_PARAMS.includes(param))\r\n        .forEach(param => {\r\n          appDeviceObj[param] = appDeviceObjBid.params.app[param];\r\n        });\r\n    }\r\n\r\n    const appIdObjBid = ((bidRequests) || []).find(hasAppId);\r\n    let appIdObj;\r\n    if (appIdObjBid && appIdObjBid.params && appDeviceObjBid.params.app && appDeviceObjBid.params.app.id) {\r\n      appIdObj = {\r\n        appid: appIdObjBid.params.app.id\r\n      };\r\n    }\r\n\r\n    let debugObj = {};\r\n    const debugObjParams = {};\r\n    const debugCookieName = 'apn_prebid_debug';\r\n    const debugCookie = storage.getCookie(debugCookieName) || null;\r\n\r\n    if (debugCookie) {\r\n      try {\r\n        debugObj = JSON.parse(debugCookie);\r\n      } catch (e) {\r\n        logError('AppNexus Debug Auction Cookie Error:\\n\\n' + e);\r\n      }\r\n    } else {\r\n      Object.keys(DEBUG_QUERY_PARAM_MAP).forEach(qparam => {\r\n        const qval = getParameterByName(qparam);\r\n        if (isStr(qval) && qval !== '') {\r\n          debugObj[DEBUG_QUERY_PARAM_MAP[qparam]] = qval;\r\n          debugObj.enabled = true;\r\n        }\r\n      });\r\n      debugObj = convertTypes({\r\n        'member_id': 'number',\r\n        'debug_timeout': 'number'\r\n      }, debugObj);\r\n\r\n      const debugBidRequest = ((bidRequests) || []).find(hasDebug);\r\n      if (debugBidRequest && debugBidRequest.debug) {\r\n        debugObj = debugBidRequest.debug;\r\n      }\r\n    }\r\n\r\n    if (debugObj && debugObj.enabled) {\r\n      Object.keys(debugObj)\r\n        .filter(param => DEBUG_PARAMS.includes(param))\r\n        .forEach(param => {\r\n          debugObjParams[param] = debugObj[param];\r\n        });\r\n    }\r\n\r\n    const memberIdBid = ((bidRequests) || []).find(hasMemberId);\r\n    const member = memberIdBid ? parseInt(memberIdBid.params.member, 10) : 0;\r\n    const schain = bidRequests[0]?.ortb2?.source?.ext?.schain;\r\n    const omidSupport = ((bidRequests) || []).find(hasOmidSupport);\r\n\r\n    const payload = {\r\n      tags: [...tags],\r\n      user: userObj,\r\n      sdk: {\r\n        source: SOURCE,\r\n        version: '$prebid.version$'\r\n      },\r\n      schain: schain\r\n    };\r\n\r\n    if (omidSupport) {\r\n      payload['iab_support'] = {\r\n        omidpn: 'Appnexus',\r\n        omidpv: '$prebid.version$'\r\n      };\r\n    }\r\n\r\n    if (member > 0) {\r\n      payload.member_id = member;\r\n    }\r\n\r\n    if (appDeviceObjBid) {\r\n      payload.device = appDeviceObj;\r\n    }\r\n    if (appIdObjBid) {\r\n      payload.app = appIdObj;\r\n    }\r\n\r\n    // if present, convert and merge device object from ortb2 into `payload.device`\r\n    if (bidderRequest?.ortb2?.device) {\r\n      payload.device = payload.device || {};\r\n      mergeDeep(payload.device, convertORTB2DeviceDataToAppNexusDeviceObject(bidderRequest.ortb2.device));\r\n    }\r\n\r\n    // grab the ortb2 keyword data (if it exists) and convert from the comma list string format to object format\r\n    const ortb2 = deepClone(bidderRequest && bidderRequest.ortb2);\r\n\r\n    const anAuctionKeywords = deepClone(config.getConfig('appnexusAuctionKeywords')) || {};\r\n    const auctionKeywords = getANKeywordParam(ortb2, anAuctionKeywords)\r\n    if (auctionKeywords.length > 0) {\r\n      payload.keywords = auctionKeywords;\r\n    }\r\n\r\n    if (ortb2?.source?.tid) {\r\n      if (!payload.source) {\r\n        payload.source = {\r\n          tid: ortb2.source.tid\r\n        };\r\n      } else {\r\n        Object.assign({}, payload.source, {\r\n          tid: ortb2.source.tid\r\n        });\r\n      }\r\n    }\r\n\r\n    if (config.getConfig('adpod.brandCategoryExclusion')) {\r\n      payload.brand_category_uniqueness = true;\r\n    }\r\n\r\n    if (debugObjParams.enabled) {\r\n      payload.debug = debugObjParams;\r\n      logInfo('AppNexus Debug Auction Settings:\\n\\n' + JSON.stringify(debugObjParams, null, 4));\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.gdprConsent) {\r\n      // note - objects for impbus use underscore instead of camelCase\r\n      payload.gdpr_consent = {\r\n        consent_string: bidderRequest.gdprConsent.consentString,\r\n        consent_required: bidderRequest.gdprConsent.gdprApplies\r\n      };\r\n\r\n      if (bidderRequest.gdprConsent.addtlConsent && bidderRequest.gdprConsent.addtlConsent.indexOf('~') !== -1) {\r\n        const ac = bidderRequest.gdprConsent.addtlConsent;\r\n        // pull only the ids from the string (after the ~) and convert them to an array of ints\r\n        const acStr = ac.substring(ac.indexOf('~') + 1);\r\n        payload.gdpr_consent.addtl_consent = acStr.split('.').map(id => parseInt(id, 10));\r\n      }\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.uspConsent) {\r\n      payload.us_privacy = bidderRequest.uspConsent;\r\n    }\r\n\r\n    if (bidderRequest?.gppConsent) {\r\n      payload.privacy = {\r\n        gpp: bidderRequest.gppConsent.gppString,\r\n        gpp_sid: bidderRequest.gppConsent.applicableSections\r\n      }\r\n    } else if (bidderRequest?.ortb2?.regs?.gpp) {\r\n      payload.privacy = {\r\n        gpp: bidderRequest.ortb2.regs.gpp,\r\n        gpp_sid: bidderRequest.ortb2.regs.gpp_sid\r\n      }\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.refererInfo) {\r\n      const refererinfo = {\r\n        // TODO: are these the correct referer values?\r\n        rd_ref: encodeURIComponent(bidderRequest.refererInfo.topmostLocation),\r\n        rd_top: bidderRequest.refererInfo.reachedTop,\r\n        rd_ifs: bidderRequest.refererInfo.numIframes,\r\n        rd_stk: bidderRequest.refererInfo.stack.map((url) => encodeURIComponent(url)).join(',')\r\n      };\r\n      const pubPageUrl = bidderRequest.refererInfo.canonicalUrl;\r\n      if (isStr(pubPageUrl) && pubPageUrl !== '') {\r\n        refererinfo.rd_can = pubPageUrl;\r\n      }\r\n      payload.referrer_detection = refererinfo;\r\n    }\r\n\r\n    if (FEATURES.VIDEO) {\r\n      const hasAdPodBid = ((bidRequests) || []).find(hasAdPod);\r\n      if (hasAdPodBid) {\r\n        bidRequests.filter(hasAdPod).forEach(adPodBid => {\r\n          const adPodTags = createAdPodRequest(tags, adPodBid);\r\n          // don't need the original adpod placement because it's in adPodTags\r\n          const nonPodTags = payload.tags.filter(tag => tag.uuid !== adPodBid.bidId);\r\n          payload.tags = [...nonPodTags, ...adPodTags];\r\n        });\r\n      }\r\n    }\r\n\r\n    if (bidRequests[0].userIdAsEids?.length > 0) {\r\n      const eids = [];\r\n      bidRequests[0].userIdAsEids.forEach(eid => {\r\n        if (!eid || !eid.uids || eid.uids.length < 1) { return; }\r\n        eid.uids.forEach(uid => {\r\n          const tmp = {'source': eid.source, 'id': uid.id};\r\n          if (eid.source == 'adserver.org') {\r\n            tmp.rti_partner = 'TDID';\r\n          } else if (eid.source == 'uidapi.com') {\r\n            tmp.rti_partner = 'UID2';\r\n          }\r\n          eids.push(tmp);\r\n        });\r\n      });\r\n\r\n      if (eids.length) {\r\n        payload.eids = eids;\r\n      }\r\n    }\r\n\r\n    if (bidderRequest?.ortb2?.regs?.ext?.dsa) {\r\n      const pubDsaObj = bidderRequest.ortb2.regs.ext.dsa;\r\n      const dsaObj = {};\r\n      ['dsarequired', 'pubrender', 'datatopub'].forEach((dsaKey) => {\r\n        if (isNumber(pubDsaObj[dsaKey])) {\r\n          dsaObj[dsaKey] = pubDsaObj[dsaKey];\r\n        }\r\n      });\r\n\r\n      if (isArray(pubDsaObj.transparency) && pubDsaObj.transparency.every((v) => isPlainObject(v))) {\r\n        const tpData = [];\r\n        pubDsaObj.transparency.forEach((tpObj) => {\r\n          if (isStr(tpObj.domain) && tpObj.domain != '' && isArray(tpObj.dsaparams) && tpObj.dsaparams.every((v) => isNumber(v))) {\r\n            tpData.push(tpObj);\r\n          }\r\n        });\r\n        if (tpData.length > 0) {\r\n          dsaObj.transparency = tpData;\r\n        }\r\n      }\r\n\r\n      if (!isEmpty(dsaObj)) payload.dsa = dsaObj;\r\n    }\r\n\r\n    if (tags[0].publisher_id) {\r\n      payload.publisher_id = tags[0].publisher_id;\r\n    }\r\n\r\n    const request = formatRequest(payload, bidderRequest);\r\n    return request;\r\n  },\r\n\r\n  /**\r\n   * Unpack the response from the server into a list of bids.\r\n   *\r\n   * @param {*} serverResponse A successful response from the server.\r\n   * @return {Bid[]} An array of bids which were nested inside the server.\r\n   */\r\n  interpretResponse: function (serverResponse, { bidderRequest }) {\r\n    serverResponse = serverResponse.body;\r\n    const bids = [];\r\n    if (!serverResponse || serverResponse.error) {\r\n      let errorMessage = `in response for ${bidderRequest.bidderCode} adapter`;\r\n      if (serverResponse && serverResponse.error) { errorMessage += `: ${serverResponse.error}`; }\r\n      logError(errorMessage);\r\n      return bids;\r\n    }\r\n\r\n    if (serverResponse.tags) {\r\n      serverResponse.tags.forEach(serverBid => {\r\n        const rtbBid = getRtbBid(serverBid);\r\n        if (rtbBid) {\r\n          const cpmCheck = (bidderSettings.get(bidderRequest.bidderCode, 'allowZeroCpmBids') === true) ? rtbBid.cpm >= 0 : rtbBid.cpm > 0;\r\n          if (cpmCheck && this.supportedMediaTypes.includes(rtbBid.ad_type)) {\r\n            const bid = newBid(serverBid, rtbBid, bidderRequest);\r\n            bid.mediaType = parseMediaType(rtbBid);\r\n            bids.push(bid);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (serverResponse.debug && serverResponse.debug.debug_info) {\r\n      const debugHeader = 'AppNexus Debug Auction for Prebid\\n\\n'\r\n      let debugText = debugHeader + serverResponse.debug.debug_info\r\n      debugText = debugText\r\n        .replace(/(<td>|<th>)/gm, '\\t') // Tables\r\n        .replace(/(<\\/td>|<\\/th>)/gm, '\\n') // Tables\r\n        .replace(/^<br>/gm, '') // Remove leading <br>\r\n        .replace(/(<br>\\n|<br>)/gm, '\\n') // <br>\r\n        .replace(/<h1>(.*)<\\/h1>/gm, '\\n\\n===== $1 =====\\n\\n') // Header H1\r\n        .replace(/<h[2-6]>(.*)<\\/h[2-6]>/gm, '\\n\\n*** $1 ***\\n\\n') // Headers\r\n        .replace(/(<([^>]+)>)/igm, ''); // Remove any other tags\r\n      logMessage('https://console.appnexus.com/docs/understanding-the-debug-auction');\r\n      logMessage(debugText);\r\n    }\r\n\r\n    return bids;\r\n  },\r\n\r\n  getUserSyncs: function (syncOptions, responses, gdprConsent, uspConsent, gppConsent) {\r\n    if (syncOptions.iframeEnabled && hasPurpose1Consent(gdprConsent)) {\r\n      return [{\r\n        type: 'iframe',\r\n        url: 'https://acdn.adnxs.com/dmp/async_usersync.html'\r\n      }];\r\n    }\r\n\r\n    if (syncOptions.pixelEnabled) {\r\n      // first attempt using static list\r\n      const imgList = ['https://px.ads.linkedin.com/setuid?partner=appNexus'];\r\n      return imgList.map(url => ({\r\n        type: 'image',\r\n        url\r\n      }));\r\n    }\r\n  }\r\n};\r\n\r\nfunction strIsAppnexusViewabilityScript(str) {\r\n  if (!str || str === '') return false;\r\n\r\n  const regexMatchUrlStart = str.match(VIEWABILITY_URL_START);\r\n  const viewUrlStartInStr = regexMatchUrlStart != null && regexMatchUrlStart.length >= 1;\r\n\r\n  const regexMatchFileName = str.match(VIEWABILITY_FILE_NAME);\r\n  const fileNameInStr = regexMatchFileName != null && regexMatchFileName.length >= 1;\r\n\r\n  return str.startsWith(SCRIPT_TAG_START) && fileNameInStr && viewUrlStartInStr;\r\n}\r\n\r\nfunction formatRequest(payload, bidderRequest) {\r\n  let request = [];\r\n  const options = {\r\n    withCredentials: true\r\n  };\r\n\r\n  let endpointUrl = URL;\r\n\r\n  if (!hasPurpose1Consent(bidderRequest?.gdprConsent)) {\r\n    endpointUrl = URL_SIMPLE;\r\n  }\r\n\r\n  if (getParameterByName('apn_test').toUpperCase() === 'TRUE' || config.getConfig('apn_test') === true) {\r\n    options.customHeaders = {\r\n      'X-Is-Test': 1\r\n    };\r\n  }\r\n\r\n  if (payload.tags.length > MAX_IMPS_PER_REQUEST) {\r\n    const clonedPayload = deepClone(payload);\r\n\r\n    chunk(payload.tags, MAX_IMPS_PER_REQUEST).forEach(tags => {\r\n      clonedPayload.tags = tags;\r\n      const payloadString = JSON.stringify(clonedPayload);\r\n      request.push({\r\n        method: 'POST',\r\n        url: endpointUrl,\r\n        data: payloadString,\r\n        bidderRequest,\r\n        options\r\n      });\r\n    });\r\n  } else {\r\n    const payloadString = JSON.stringify(payload);\r\n    request = {\r\n      method: 'POST',\r\n      url: endpointUrl,\r\n      data: payloadString,\r\n      bidderRequest,\r\n      options\r\n    };\r\n  }\r\n\r\n  return request;\r\n}\r\n\r\nfunction newRenderer(adUnitCode, rtbBid, rendererOptions = {}) {\r\n  const renderer = Renderer.install({\r\n    id: rtbBid.renderer_id,\r\n    url: rtbBid.renderer_url,\r\n    config: rendererOptions,\r\n    loaded: false,\r\n    adUnitCode\r\n  });\r\n\r\n  try {\r\n    renderer.setRender(outstreamRender);\r\n  } catch (err) {\r\n    logWarn('Prebid Error calling setRender on renderer', err);\r\n  }\r\n\r\n  renderer.setEventHandlers({\r\n    impression: () => logMessage('AppNexus outstream video impression event'),\r\n    loaded: () => logMessage('AppNexus outstream video loaded event'),\r\n    ended: () => {\r\n      logMessage('AppNexus outstream renderer video event');\r\n      document.querySelector(`#${adUnitCode}`).style.display = 'none';\r\n    }\r\n  });\r\n  return renderer;\r\n}\r\n\r\n/**\r\n * Unpack the Server's Bid into a Prebid-compatible one.\r\n * @param serverBid\r\n * @param rtbBid\r\n * @param bidderRequest\r\n * @return Bid\r\n */\r\nfunction newBid(serverBid, rtbBid, bidderRequest) {\r\n  const bidRequest = getBidRequest(serverBid.uuid, [bidderRequest]);\r\n  const adId = getUniqueIdentifierStr();\r\n  const bid = {\r\n    adId: adId,\r\n    requestId: serverBid.uuid,\r\n    cpm: rtbBid.cpm,\r\n    creativeId: rtbBid.creative_id,\r\n    dealId: rtbBid.deal_id,\r\n    currency: 'USD',\r\n    netRevenue: true,\r\n    ttl: 300,\r\n    adUnitCode: bidRequest.adUnitCode,\r\n    appnexus: {\r\n      buyerMemberId: rtbBid.buyer_member_id,\r\n      dealPriority: rtbBid.deal_priority,\r\n      dealCode: rtbBid.deal_code\r\n    }\r\n  };\r\n\r\n  if (rtbBid.adomain) {\r\n    bid.meta = Object.assign({}, bid.meta, { advertiserDomains: [rtbBid.adomain] });\r\n  }\r\n\r\n  if (rtbBid.advertiser_id) {\r\n    bid.meta = Object.assign({}, bid.meta, { advertiserId: rtbBid.advertiser_id });\r\n  }\r\n\r\n  if (rtbBid.dsa) {\r\n    bid.meta = Object.assign({}, bid.meta, { dsa: rtbBid.dsa });\r\n  }\r\n\r\n  // temporary function; may remove at later date if/when adserver fully supports dchain\r\n  function setupDChain(rtbBid) {\r\n    const dchain = {\r\n      ver: '1.0',\r\n      complete: 0,\r\n      nodes: [{\r\n        bsid: rtbBid.buyer_member_id.toString()\r\n      }]};\r\n\r\n    return dchain;\r\n  }\r\n  if (rtbBid.buyer_member_id) {\r\n    bid.meta = Object.assign({}, bid.meta, {dchain: setupDChain(rtbBid)});\r\n  }\r\n\r\n  if (rtbBid.brand_id) {\r\n    bid.meta = Object.assign({}, bid.meta, { brandId: rtbBid.brand_id });\r\n  }\r\n\r\n  if (FEATURES.VIDEO && rtbBid.rtb.video) {\r\n    // shared video properties used for all 3 contexts\r\n    Object.assign(bid, {\r\n      width: rtbBid.rtb.video.player_width,\r\n      height: rtbBid.rtb.video.player_height,\r\n      vastImpUrl: rtbBid.notify_url,\r\n      ttl: 3600\r\n    });\r\n\r\n    const videoContext = deepAccess(bidRequest, 'mediaTypes.video.context');\r\n    switch (videoContext) {\r\n      case ADPOD:\r\n        const primaryCatId = (APPNEXUS_CATEGORY_MAPPING[rtbBid.brand_category_id]) ? APPNEXUS_CATEGORY_MAPPING[rtbBid.brand_category_id] : null;\r\n        bid.meta = Object.assign({}, bid.meta, { primaryCatId });\r\n        const dealTier = rtbBid.deal_priority;\r\n        bid.video = {\r\n          context: ADPOD,\r\n          durationSeconds: Math.floor(rtbBid.rtb.video.duration_ms / 1000),\r\n          dealTier\r\n        };\r\n        bid.vastUrl = rtbBid.rtb.video.asset_url;\r\n        break;\r\n      case OUTSTREAM:\r\n        bid.adResponse = serverBid;\r\n        bid.adResponse.ad = bid.adResponse.ads[0];\r\n        bid.adResponse.ad.video = bid.adResponse.ad.rtb.video;\r\n        bid.vastXml = rtbBid.rtb.video.content;\r\n\r\n        if (rtbBid.renderer_url) {\r\n          const videoBid = ((bidderRequest.bids) || []).find(bid => bid.bidId === serverBid.uuid);\r\n          let rendererOptions = deepAccess(videoBid, 'mediaTypes.video.renderer.options'); // mediaType definition has preference (shouldn't options be .config?)\r\n          if (!rendererOptions) {\r\n            rendererOptions = deepAccess(videoBid, 'renderer.options'); // second the adUnit definition has preference (shouldn't options be .config?)\r\n          }\r\n          bid.renderer = newRenderer(bid.adUnitCode, rtbBid, rendererOptions);\r\n        }\r\n        break;\r\n      case INSTREAM:\r\n        bid.vastUrl = rtbBid.notify_url + '&redir=' + encodeURIComponent(rtbBid.rtb.video.asset_url);\r\n        break;\r\n    }\r\n  } else if (FEATURES.NATIVE && rtbBid.rtb[NATIVE]) {\r\n    const nativeAd = rtbBid.rtb[NATIVE];\r\n    let viewScript;\r\n\r\n    if (strIsAppnexusViewabilityScript(rtbBid.viewability.config)) {\r\n      const prebidParams = 'pbjs_adid=' + adId + ';pbjs_auc=' + bidRequest.adUnitCode;\r\n      viewScript = rtbBid.viewability.config.replace('dom_id=%native_dom_id%', prebidParams);\r\n    }\r\n\r\n    let jsTrackers = nativeAd.javascript_trackers;\r\n    if (jsTrackers == undefined) {\r\n      jsTrackers = viewScript;\r\n    } else if (isStr(jsTrackers)) {\r\n      jsTrackers = [jsTrackers, viewScript];\r\n    } else {\r\n      jsTrackers.push(viewScript);\r\n    }\r\n\r\n    bid[NATIVE] = {\r\n      title: nativeAd.title,\r\n      body: nativeAd.desc,\r\n      body2: nativeAd.desc2,\r\n      cta: nativeAd.ctatext,\r\n      rating: nativeAd.rating,\r\n      sponsoredBy: nativeAd.sponsored,\r\n      privacyLink: nativeAd.privacy_link,\r\n      address: nativeAd.address,\r\n      downloads: nativeAd.downloads,\r\n      likes: nativeAd.likes,\r\n      phone: nativeAd.phone,\r\n      price: nativeAd.price,\r\n      salePrice: nativeAd.saleprice,\r\n      clickUrl: nativeAd.link.url,\r\n      displayUrl: nativeAd.displayurl,\r\n      clickTrackers: nativeAd.link.click_trackers,\r\n      impressionTrackers: nativeAd.impression_trackers,\r\n      video: nativeAd.video,\r\n      javascriptTrackers: jsTrackers\r\n    };\r\n    if (nativeAd.main_img) {\r\n      bid[NATIVE].image = {\r\n        url: nativeAd.main_img.url,\r\n        height: nativeAd.main_img.height,\r\n        width: nativeAd.main_img.width,\r\n      };\r\n    }\r\n    if (nativeAd.icon) {\r\n      bid[NATIVE].icon = {\r\n        url: nativeAd.icon.url,\r\n        height: nativeAd.icon.height,\r\n        width: nativeAd.icon.width,\r\n      };\r\n    }\r\n\r\n    // Custom fields\r\n    bid[NATIVE].ext = {\r\n      video: nativeAd.video,\r\n      customImage1: nativeAd.image1 && {\r\n        url: nativeAd.image1.url,\r\n        height: nativeAd.image1.height,\r\n        width: nativeAd.image1.width,\r\n      },\r\n      customImage2: nativeAd.image2 && {\r\n        url: nativeAd.image2.url,\r\n        height: nativeAd.image2.height,\r\n        width: nativeAd.image2.width,\r\n      },\r\n      customImage3: nativeAd.image3 && {\r\n        url: nativeAd.image3.url,\r\n        height: nativeAd.image3.height,\r\n        width: nativeAd.image3.width,\r\n      },\r\n      customImage4: nativeAd.image4 && {\r\n        url: nativeAd.image4.url,\r\n        height: nativeAd.image4.height,\r\n        width: nativeAd.image4.width,\r\n      },\r\n      customImage5: nativeAd.image5 && {\r\n        url: nativeAd.image5.url,\r\n        height: nativeAd.image5.height,\r\n        width: nativeAd.image5.width,\r\n      },\r\n      customIcon1: nativeAd.icon1 && {\r\n        url: nativeAd.icon1.url,\r\n        height: nativeAd.icon1.height,\r\n        width: nativeAd.icon1.width,\r\n      },\r\n      customIcon2: nativeAd.icon2 && {\r\n        url: nativeAd.icon2.url,\r\n        height: nativeAd.icon2.height,\r\n        width: nativeAd.icon2.width,\r\n      },\r\n      customIcon3: nativeAd.icon3 && {\r\n        url: nativeAd.icon3.url,\r\n        height: nativeAd.icon3.height,\r\n        width: nativeAd.icon3.width,\r\n      },\r\n      customIcon4: nativeAd.icon4 && {\r\n        url: nativeAd.icon4.url,\r\n        height: nativeAd.icon4.height,\r\n        width: nativeAd.icon4.width,\r\n      },\r\n      customIcon5: nativeAd.icon5 && {\r\n        url: nativeAd.icon5.url,\r\n        height: nativeAd.icon5.height,\r\n        width: nativeAd.icon5.width,\r\n      },\r\n      customSocialIcon1: nativeAd.socialicon1 && {\r\n        url: nativeAd.socialicon1.url,\r\n        height: nativeAd.socialicon1.height,\r\n        width: nativeAd.socialicon1.width,\r\n      },\r\n      customSocialIcon2: nativeAd.socialicon2 && {\r\n        url: nativeAd.socialicon2.url,\r\n        height: nativeAd.socialicon2.height,\r\n        width: nativeAd.socialicon2.width,\r\n      },\r\n      customSocialIcon3: nativeAd.socialicon3 && {\r\n        url: nativeAd.socialicon3.url,\r\n        height: nativeAd.socialicon3.height,\r\n        width: nativeAd.socialicon3.width,\r\n      },\r\n      customSocialIcon4: nativeAd.socialicon4 && {\r\n        url: nativeAd.socialicon4.url,\r\n        height: nativeAd.socialicon4.height,\r\n        width: nativeAd.socialicon4.width,\r\n      },\r\n      customSocialIcon5: nativeAd.socialicon5 && {\r\n        url: nativeAd.socialicon5.url,\r\n        height: nativeAd.socialicon5.height,\r\n        width: nativeAd.socialicon5.width,\r\n      },\r\n      customTitle1: nativeAd.title1,\r\n      customTitle2: nativeAd.title2,\r\n      customTitle3: nativeAd.title3,\r\n      customTitle4: nativeAd.title4,\r\n      customTitle5: nativeAd.title5,\r\n      customBody1: nativeAd.body1,\r\n      customBody2: nativeAd.body2,\r\n      customBody3: nativeAd.body3,\r\n      customBody4: nativeAd.body4,\r\n      customBody5: nativeAd.body5,\r\n      customCta1: nativeAd.ctatext1,\r\n      customCta2: nativeAd.ctatext2,\r\n      customCta3: nativeAd.ctatext3,\r\n      customCta4: nativeAd.ctatext4,\r\n      customCta5: nativeAd.ctatext5,\r\n      customDisplayUrl1: nativeAd.displayurl1,\r\n      customDisplayUrl2: nativeAd.displayurl2,\r\n      customDisplayUrl3: nativeAd.displayurl3,\r\n      customDisplayUrl4: nativeAd.displayurl4,\r\n      customDisplayUrl5: nativeAd.displayurl5,\r\n      customSocialUrl1: nativeAd.socialurl1,\r\n      customSocialUrl2: nativeAd.socialurl2,\r\n      customSocialUrl3: nativeAd.socialurl3,\r\n      customSocialUrl4: nativeAd.socialurl4,\r\n      customSocialUrl5: nativeAd.socialurl5\r\n    };\r\n  } else {\r\n    Object.assign(bid, {\r\n      width: rtbBid.rtb.banner.width,\r\n      height: rtbBid.rtb.banner.height,\r\n      ad: rtbBid.rtb.banner.content\r\n    });\r\n    try {\r\n      if (rtbBid.rtb.trackers) {\r\n        for (let i = 0; i < rtbBid.rtb.trackers[0].impression_urls.length; i++) {\r\n          const url = rtbBid.rtb.trackers[0].impression_urls[i];\r\n          const tracker = createTrackPixelHtml(url);\r\n          bid.ad += tracker;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      logError('Error appending tracking pixel', error);\r\n    }\r\n  }\r\n\r\n  return bid;\r\n}\r\n\r\nfunction bidToTag(bid) {\r\n  const tag = {};\r\n  Object.keys(bid.params).forEach(paramKey => {\r\n    const convertedKey = convertCamelToUnderscore(paramKey);\r\n    if (convertedKey !== paramKey) {\r\n      bid.params[convertedKey] = bid.params[paramKey];\r\n      delete bid.params[paramKey];\r\n    }\r\n  });\r\n  tag.sizes = transformSizes(bid.sizes);\r\n  tag.primary_size = tag.sizes[0];\r\n  tag.ad_types = [];\r\n  tag.uuid = bid.bidId;\r\n  if (bid.params.placement_id) {\r\n    tag.id = parseInt(bid.params.placement_id, 10);\r\n  } else {\r\n    tag.code = bid.params.inv_code;\r\n  }\r\n  // Xandr expects GET variable to be in a following format:\r\n  // page.html?ast_override_div=divId:creativeId,divId2:creativeId2\r\n  const overrides = getParameterByName('ast_override_div');\r\n  if (isStr(overrides) && overrides !== '') {\r\n    const adUnitOverride = decodeURIComponent(overrides).split(',').find((pair) => pair.startsWith(`${bid.adUnitCode}:`));\r\n    if (adUnitOverride) {\r\n      const forceCreativeId = adUnitOverride.split(':')[1];\r\n      if (forceCreativeId) {\r\n        tag.force_creative_id = parseInt(forceCreativeId, 10);\r\n      }\r\n    }\r\n  }\r\n  tag.allow_smaller_sizes = bid.params.allow_smaller_sizes || false;\r\n  tag.use_pmt_rule = (typeof bid.params.use_payment_rule === 'boolean') ? bid.params.use_payment_rule\r\n    : (typeof bid.params.use_pmt_rule === 'boolean') ? bid.params.use_pmt_rule : false;\r\n  tag.prebid = true;\r\n  tag.disable_psa = true;\r\n  const bidFloor = getBidFloor(bid);\r\n  if (bidFloor) {\r\n    tag.reserve = bidFloor;\r\n  }\r\n  if (bid.params.position) {\r\n    tag.position = { 'above': 1, 'below': 2 }[bid.params.position] || 0;\r\n  } else {\r\n    const mediaTypePos = deepAccess(bid, `mediaTypes.banner.pos`) || deepAccess(bid, `mediaTypes.video.pos`);\r\n    // only support unknown, atf, and btf values for position at this time\r\n    if (mediaTypePos === 0 || mediaTypePos === 1 || mediaTypePos === 3) {\r\n      // ortb spec treats btf === 3, but our system interprets btf === 2; so converting the ortb value here for consistency\r\n      tag.position = (mediaTypePos === 3) ? 2 : mediaTypePos;\r\n    }\r\n  }\r\n  if (bid.params.traffic_source_code) {\r\n    tag.traffic_source_code = bid.params.traffic_source_code;\r\n  }\r\n  if (bid.params.private_sizes) {\r\n    tag.private_sizes = transformSizes(bid.params.private_sizes);\r\n  }\r\n  if (bid.params.supply_type) {\r\n    tag.supply_type = bid.params.supply_type;\r\n  }\r\n  if (bid.params.pub_click) {\r\n    tag.pubclick = bid.params.pub_click;\r\n  }\r\n  if (bid.params.ext_inv_code) {\r\n    tag.ext_inv_code = bid.params.ext_inv_code;\r\n  }\r\n  if (bid.params.publisher_id) {\r\n    tag.publisher_id = parseInt(bid.params.publisher_id, 10);\r\n  }\r\n  if (bid.params.external_imp_id) {\r\n    tag.external_imp_id = bid.params.external_imp_id;\r\n  }\r\n\r\n  const auKeywords = getANKewyordParamFromMaps(convertKeywordStringToANMap(deepAccess(bid, 'ortb2Imp.ext.data.keywords')), bid.params?.keywords);\r\n  if (auKeywords.length > 0) {\r\n    tag.keywords = auKeywords;\r\n  }\r\n\r\n  const gpid = deepAccess(bid, 'ortb2Imp.ext.gpid');\r\n  if (gpid) {\r\n    tag.gpid = gpid;\r\n  }\r\n\r\n  const tid = deepAccess(bid, 'ortb2Imp.ext.tid');\r\n  if (tid) {\r\n    tag.tid = tid;\r\n  }\r\n\r\n  if (FEATURES.NATIVE && (bid.mediaType === NATIVE || deepAccess(bid, `mediaTypes.${NATIVE}`))) {\r\n    tag.ad_types.push(NATIVE);\r\n    if (tag.sizes.length === 0) {\r\n      tag.sizes = transformSizes([1, 1]);\r\n    }\r\n\r\n    if (bid.nativeParams) {\r\n      const nativeRequest = buildNativeRequest(bid.nativeParams);\r\n      tag[NATIVE] = { layouts: [nativeRequest] };\r\n    }\r\n  }\r\n\r\n  if (FEATURES.VIDEO) {\r\n    const videoMediaType = deepAccess(bid, `mediaTypes.${VIDEO}`);\r\n    const context = deepAccess(bid, 'mediaTypes.video.context');\r\n\r\n    if (videoMediaType && context === 'adpod') {\r\n      tag.hb_source = 7;\r\n    } else {\r\n      tag.hb_source = 1;\r\n    }\r\n    if (bid.mediaType === VIDEO || videoMediaType) {\r\n      tag.ad_types.push(VIDEO);\r\n    }\r\n\r\n    // instream gets vastUrl, outstream gets vastXml\r\n    if (bid.mediaType === VIDEO || (videoMediaType && context !== 'outstream')) {\r\n      tag.require_asset_url = true;\r\n    }\r\n\r\n    if (bid.params.video) {\r\n      tag.video = {};\r\n      // place any valid video params on the tag\r\n      Object.keys(bid.params.video)\r\n        .filter(param => VIDEO_TARGETING.includes(param))\r\n        .forEach(param => {\r\n          switch (param) {\r\n            case 'context':\r\n            case 'playback_method':\r\n              let type = bid.params.video[param];\r\n              type = (isArray(type)) ? type[0] : type;\r\n              tag.video[param] = VIDEO_MAPPING[param][type];\r\n              break;\r\n            // Deprecating tags[].video.frameworks in favor of tags[].video_frameworks\r\n            case 'frameworks':\r\n              break;\r\n            default:\r\n              tag.video[param] = bid.params.video[param];\r\n          }\r\n        });\r\n\r\n      if (bid.params.video.frameworks && isArray(bid.params.video.frameworks)) {\r\n        tag['video_frameworks'] = bid.params.video.frameworks;\r\n      }\r\n    }\r\n\r\n    // use IAB ORTB values if the corresponding values weren't already set by bid.params.video\r\n    if (videoMediaType) {\r\n      tag.video = tag.video || {};\r\n      Object.keys(videoMediaType)\r\n        .filter(param => VIDEO_RTB_TARGETING.includes(param))\r\n        .forEach(param => {\r\n          switch (param) {\r\n            case 'minduration':\r\n            case 'maxduration':\r\n              if (typeof tag.video[param] !== 'number') tag.video[param] = videoMediaType[param];\r\n              break;\r\n            case 'skip':\r\n              if (typeof tag.video['skippable'] !== 'boolean') tag.video['skippable'] = (videoMediaType[param] === 1);\r\n              break;\r\n            case 'skipafter':\r\n              if (typeof tag.video['skipoffset'] !== 'number') tag.video['skippoffset'] = videoMediaType[param];\r\n              break;\r\n            case 'playbackmethod':\r\n              if (typeof tag.video['playback_method'] !== 'number') {\r\n                let type = videoMediaType[param];\r\n                type = (isArray(type)) ? type[0] : type;\r\n\r\n                // we only support iab's options 1-4 at this time.\r\n                if (type >= 1 && type <= 4) {\r\n                  tag.video['playback_method'] = type;\r\n                }\r\n              }\r\n              break;\r\n            case 'api':\r\n              if (!tag['video_frameworks'] && isArray(videoMediaType[param])) {\r\n                // need to read thru array; remove 6 (we don't support it), swap 4 <> 5 if found (to match our adserver mapping for these specific values)\r\n                const apiTmp = videoMediaType[param].map(val => {\r\n                  const v = (val === 4) ? 5 : (val === 5) ? 4 : val;\r\n\r\n                  if (v >= 1 && v <= 5) {\r\n                    return v;\r\n                  }\r\n                }).filter(v => v);\r\n                tag['video_frameworks'] = apiTmp;\r\n              }\r\n              break;\r\n            case 'startdelay':\r\n            case 'plcmt':\r\n            case 'placement':\r\n              if (typeof tag.video.context !== 'number') {\r\n                const plcmt = videoMediaType['plcmt'];\r\n                const placement = videoMediaType['placement'];\r\n                const startdelay = videoMediaType['startdelay'];\r\n                const contextVal = getContextFromPlcmt(plcmt, startdelay) || getContextFromPlacement(placement) || getContextFromStartDelay(startdelay);\r\n                tag.video.context = VIDEO_MAPPING.context[contextVal];\r\n              }\r\n              break;\r\n          }\r\n        });\r\n    }\r\n\r\n    if (bid.renderer) {\r\n      tag.video = Object.assign({}, tag.video, { custom_renderer_present: true });\r\n    }\r\n  } else {\r\n    tag.hb_source = 1;\r\n  }\r\n\r\n  if (bid.params.frameworks && isArray(bid.params.frameworks)) {\r\n    tag['banner_frameworks'] = bid.params.frameworks;\r\n  }\r\n\r\n  if (deepAccess(bid, `mediaTypes.${BANNER}`)) {\r\n    tag.ad_types.push(BANNER);\r\n  }\r\n\r\n  if (tag.ad_types.length === 0) {\r\n    delete tag.ad_types;\r\n  }\r\n\r\n  return tag;\r\n}\r\n\r\n/* Turn bid request sizes into ut-compatible format */\r\nfunction transformSizes(requestSizes) {\r\n  const sizes = [];\r\n  let sizeObj = {};\r\n\r\n  if (isArray(requestSizes) && requestSizes.length === 2 &&\r\n    !isArray(requestSizes[0])) {\r\n    sizeObj.width = parseInt(requestSizes[0], 10);\r\n    sizeObj.height = parseInt(requestSizes[1], 10);\r\n    sizes.push(sizeObj);\r\n  } else if (typeof requestSizes === 'object') {\r\n    for (let i = 0; i < requestSizes.length; i++) {\r\n      const size = requestSizes[i];\r\n      sizeObj = {};\r\n      sizeObj.width = parseInt(size[0], 10);\r\n      sizeObj.height = parseInt(size[1], 10);\r\n      sizes.push(sizeObj);\r\n    }\r\n  }\r\n\r\n  return sizes;\r\n}\r\n\r\nfunction getContextFromPlacement(ortbPlacement) {\r\n  if (!ortbPlacement) {\r\n    return;\r\n  }\r\n\r\n  if (ortbPlacement === 2) {\r\n    return 'in-banner';\r\n  } else if (ortbPlacement === 3) {\r\n    return 'outstream';\r\n  } else if (ortbPlacement === 4) {\r\n    return 'in-feed';\r\n  } else if (ortbPlacement === 5) {\r\n    return 'intersitial';\r\n  }\r\n}\r\n\r\nfunction getContextFromStartDelay(ortbStartDelay) {\r\n  if (typeof ortbStartDelay === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  if (ortbStartDelay === 0) {\r\n    return 'pre_roll';\r\n  } else if (ortbStartDelay === -1) {\r\n    return 'mid_roll';\r\n  } else if (ortbStartDelay === -2) {\r\n    return 'post_roll';\r\n  }\r\n}\r\n\r\nfunction getContextFromPlcmt(ortbPlcmt, ortbStartDelay) {\r\n  if (!ortbPlcmt) {\r\n    return;\r\n  }\r\n\r\n  if (ortbPlcmt === 2) {\r\n    if (typeof ortbStartDelay === 'undefined') {\r\n      return;\r\n    }\r\n    if (ortbStartDelay === 0) {\r\n      return 'accompanying_content_pre_roll';\r\n    } else if (ortbStartDelay === -1) {\r\n      return 'accompanying_content_mid_roll';\r\n    } else if (ortbStartDelay === -2) {\r\n      return 'accompanying_content_post_roll';\r\n    }\r\n  } else if (ortbPlcmt === 3) {\r\n    return 'interstitial';\r\n  } else if (ortbPlcmt === 4) {\r\n    return 'outstream';\r\n  }\r\n}\r\n\r\nfunction hasUserInfo(bid) {\r\n  return !!bid.params.user;\r\n}\r\n\r\nfunction hasMemberId(bid) {\r\n  return !!parseInt(bid.params.member, 10);\r\n}\r\n\r\nfunction hasAppDeviceInfo(bid) {\r\n  if (bid.params) {\r\n    return !!bid.params.app\r\n  }\r\n}\r\n\r\nfunction hasAppId(bid) {\r\n  if (bid.params && bid.params.app) {\r\n    return !!bid.params.app.id\r\n  }\r\n  return !!bid.params.app\r\n}\r\n\r\nfunction hasDebug(bid) {\r\n  return !!bid.debug\r\n}\r\n\r\nfunction hasAdPod(bid) {\r\n  return (\r\n    bid.mediaTypes &&\r\n    bid.mediaTypes.video &&\r\n    bid.mediaTypes.video.context === ADPOD\r\n  );\r\n}\r\n\r\nfunction hasOmidSupport(bid) {\r\n  let hasOmid = false;\r\n  const bidderParams = bid.params;\r\n  const videoParams = bid.params.video;\r\n  if (bidderParams.frameworks && isArray(bidderParams.frameworks)) {\r\n    hasOmid = bid.params.frameworks.includes(6);\r\n  }\r\n  if (!hasOmid && videoParams && videoParams.frameworks && isArray(videoParams.frameworks)) {\r\n    hasOmid = bid.params.video.frameworks.includes(6);\r\n  }\r\n  return hasOmid;\r\n}\r\n\r\n/**\r\n * Expand an adpod placement into a set of request objects according to the\r\n * total adpod duration and the range of duration seconds. Sets minduration/\r\n * maxduration video property according to requireExactDuration configuration\r\n */\r\nfunction createAdPodRequest(tags, adPodBid) {\r\n  const { durationRangeSec, requireExactDuration } = adPodBid.mediaTypes.video;\r\n\r\n  const numberOfPlacements = getAdPodPlacementNumber(adPodBid.mediaTypes.video);\r\n  const maxDuration = Math.max(...durationRangeSec);\r\n\r\n  const tagToDuplicate = tags.filter(tag => tag.uuid === adPodBid.bidId);\r\n  const request = fill(...tagToDuplicate, numberOfPlacements);\r\n\r\n  if (requireExactDuration) {\r\n    const divider = Math.ceil(numberOfPlacements / durationRangeSec.length);\r\n    const chunked = chunk(request, divider);\r\n\r\n    // each configured duration is set as min/maxduration for a subset of requests\r\n    durationRangeSec.forEach((duration, index) => {\r\n      chunked[index].map(tag => {\r\n        setVideoProperty(tag, 'minduration', duration);\r\n        setVideoProperty(tag, 'maxduration', duration);\r\n      });\r\n    });\r\n  } else {\r\n    // all maxdurations should be the same\r\n    request.map(tag => setVideoProperty(tag, 'maxduration', maxDuration));\r\n  }\r\n\r\n  return request;\r\n}\r\n\r\nfunction getAdPodPlacementNumber(videoParams) {\r\n  const { adPodDurationSec, durationRangeSec, requireExactDuration } = videoParams;\r\n  const minAllowedDuration = Math.min(...durationRangeSec);\r\n  const numberOfPlacements = Math.floor(adPodDurationSec / minAllowedDuration);\r\n\r\n  return requireExactDuration\r\n    ? Math.max(numberOfPlacements, durationRangeSec.length)\r\n    : numberOfPlacements;\r\n}\r\n\r\nfunction setVideoProperty(tag, key, value) {\r\n  if (isEmpty(tag.video)) { tag.video = {}; }\r\n  tag.video[key] = value;\r\n}\r\n\r\nfunction getRtbBid(tag) {\r\n  return tag && tag.ads && tag.ads.length && ((tag.ads) || []).find(ad => ad.rtb);\r\n}\r\n\r\nfunction buildNativeRequest(params) {\r\n  const request = {};\r\n\r\n  // map standard prebid native asset identifier to /ut parameters\r\n  // e.g., tag specifies `body` but /ut only knows `description`.\r\n  // mapping may be in form {tag: '<server name>'} or\r\n  // {tag: {serverName: '<server name>', requiredParams: {...}}}\r\n  Object.keys(params).forEach(key => {\r\n    // check if one of the <server name> forms is used, otherwise\r\n    // a mapping wasn't specified so pass the key straight through\r\n    const requestKey =\r\n      (NATIVE_MAPPING[key] && NATIVE_MAPPING[key].serverName) ||\r\n      NATIVE_MAPPING[key] ||\r\n      key;\r\n\r\n    // required params are always passed on request\r\n    const requiredParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].requiredParams;\r\n    request[requestKey] = Object.assign({}, requiredParams, params[key]);\r\n\r\n    // convert the sizes of image/icon assets to proper format (if needed)\r\n    const isImageAsset = !!(requestKey === NATIVE_MAPPING.image.serverName || requestKey === NATIVE_MAPPING.icon.serverName);\r\n    if (isImageAsset && request[requestKey].sizes) {\r\n      const sizes = request[requestKey].sizes;\r\n      if (isArrayOfNums(sizes) || (isArray(sizes) && sizes.length > 0 && sizes.every(sz => isArrayOfNums(sz)))) {\r\n        request[requestKey].sizes = transformSizes(request[requestKey].sizes);\r\n      }\r\n    }\r\n\r\n    if (requestKey === NATIVE_MAPPING.privacyLink) {\r\n      request.privacy_supported = true;\r\n    }\r\n  });\r\n\r\n  return request;\r\n}\r\n\r\n/**\r\n * This function hides google div container for outstream bids to remove unwanted space on page. Appnexus renderer creates a new iframe outside of google iframe to render the outstream creative.\r\n * @param {string} elementId element id\r\n */\r\nfunction hidedfpContainer(elementId) {\r\n  try {\r\n    const el = document.getElementById(elementId).querySelectorAll(\"div[id^='google_ads']\");\r\n    if (el[0]) {\r\n      el[0].style.setProperty('display', 'none');\r\n    }\r\n  } catch (e) {\r\n    // element not found!\r\n  }\r\n}\r\n\r\nfunction hideSASIframe(elementId) {\r\n  try {\r\n    // find script tag with id 'sas_script'. This ensures it only works if you're using Smart Ad Server.\r\n    const el = document.getElementById(elementId).querySelectorAll(\"script[id^='sas_script']\");\r\n    if (el[0].nextSibling && el[0].nextSibling.localName === 'iframe') {\r\n      el[0].nextSibling.style.setProperty('display', 'none');\r\n    }\r\n  } catch (e) {\r\n    // element not found!\r\n  }\r\n}\r\n\r\nfunction outstreamRender(bid, doc) {\r\n  hidedfpContainer(bid.adUnitCode);\r\n  hideSASIframe(bid.adUnitCode);\r\n  // push to render queue because ANOutstreamVideo may not be loaded yet\r\n  bid.renderer.push(() => {\r\n    const win = doc?.defaultView || window;\r\n    win.ANOutstreamVideo.renderAd({\r\n      tagId: bid.adResponse.tag_id,\r\n      sizes: [bid.getSize().split('x')],\r\n      targetId: bid.adUnitCode, // target div id to render video\r\n      uuid: bid.adResponse.uuid,\r\n      adResponse: bid.adResponse,\r\n      rendererOptions: bid.renderer.getConfig()\r\n    }, handleOutstreamRendererEvents.bind(null, bid));\r\n  });\r\n}\r\n\r\nfunction handleOutstreamRendererEvents(bid, id, eventName) {\r\n  bid.renderer.handleVideoEvent({ id, eventName });\r\n}\r\n\r\nfunction parseMediaType(rtbBid) {\r\n  const adType = rtbBid.ad_type;\r\n  if (adType === VIDEO) {\r\n    return VIDEO;\r\n  } else if (adType === NATIVE) {\r\n    return NATIVE;\r\n  } else {\r\n    return BANNER;\r\n  }\r\n}\r\n\r\nfunction getBidFloor(bid) {\r\n  if (!isFn(bid.getFloor)) {\r\n    return (bid.params.reserve) ? bid.params.reserve : null;\r\n  }\r\n\r\n  const floor = bid.getFloor({\r\n    currency: 'USD',\r\n    mediaType: '*',\r\n    size: '*'\r\n  });\r\n  if (isPlainObject(floor) && !isNaN(floor.floor) && floor.currency === 'USD') {\r\n    return floor.floor;\r\n  }\r\n  return null;\r\n}\r\n\r\n// Convert device data to a format that AppNexus expects\r\nfunction convertORTB2DeviceDataToAppNexusDeviceObject(ortb2DeviceData) {\r\n  const _device = {\r\n    useragent: ortb2DeviceData.ua,\r\n    devicetype: ORTB2_DEVICE_TYPE_MAP.get(ortb2DeviceData.devicetype),\r\n    make: ortb2DeviceData.make,\r\n    model: ortb2DeviceData.model,\r\n    os: ortb2DeviceData.os,\r\n    os_version: ortb2DeviceData.osv,\r\n    w: ortb2DeviceData.w,\r\n    h: ortb2DeviceData.h,\r\n    ppi: ortb2DeviceData.ppi,\r\n    pxratio: ortb2DeviceData.pxratio,\r\n  };\r\n\r\n  // filter out any empty values and return the object\r\n  return Object.keys(_device)\r\n    .reduce((r, key) => {\r\n      if (_device[key]) {\r\n        r[key] = _device[key];\r\n      }\r\n      return r;\r\n    }, {});\r\n}\r\n\r\nregisterBidder(spec);\r\n","/**\r\n * This module adds GPP consentManagement support to prebid.js.  It interacts with\r\n * supported CMPs (Consent Management Platforms) to grab the user's consent information\r\n * and make it available for any GPP supported adapters to read/pass this information to\r\n * their system and for various other features/modules in Prebid.js.\r\n */\r\nimport {deepSetValue, isEmpty, isPlainObject, isStr, logInfo, logWarn} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport {gppDataHandler} from '../src/adapterManager.js';\r\nimport {enrichFPD} from '../src/fpd/enrichment.js';\r\nimport {cmpClient, MODE_CALLBACK} from '../libraries/cmp/cmpClient.js';\r\nimport {PbPromise, defer} from '../src/utils/promise.js';\r\nimport {type CMConfig, configParser} from '../libraries/consentManagement/cmUtils.js';\r\nimport {CONSENT_GPP} from \"../src/consentHandler.ts\";\r\n\r\nexport let consentConfig = {} as any;\r\n\r\ntype RelevantCMPData = {\r\n  applicableSections: number[]\r\n  gppString: string;\r\n  parsedSections: Record<string, unknown>\r\n}\r\n\r\ntype CMPData = RelevantCMPData & { [key: string]: unknown };\r\n\r\nexport type GPPConsentData = RelevantCMPData & {\r\n  gppData: CMPData;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface GPPConfig {\r\n  // this is here to be extended by the control modules\r\n}\r\n\r\nexport type GPPCMConfig = GPPConfig & CMConfig<RelevantCMPData>;\r\n\r\ndeclare module '../src/consentHandler' {\r\n  interface ConsentData {\r\n    [CONSENT_GPP]: GPPConsentData;\r\n  }\r\n  interface ConsentManagementConfig {\r\n    [CONSENT_GPP]?: GPPCMConfig;\r\n  }\r\n}\r\n\r\nclass GPPError {\r\n  message;\r\n  args;\r\n  constructor(message, arg?) {\r\n    this.message = message;\r\n    this.args = arg == null ? [] : [arg];\r\n  }\r\n}\r\n\r\nexport class GPPClient {\r\n  apiVersion = '1.1';\r\n  cmp;\r\n  static INST;\r\n\r\n  static get(mkCmp = cmpClient) {\r\n    if (this.INST == null) {\r\n      const cmp = mkCmp({\r\n        apiName: '__gpp',\r\n        apiArgs: ['command', 'callback', 'parameter'], // do not pass version - not clear what it's for (or what we should use),\r\n        mode: MODE_CALLBACK\r\n      });\r\n      if (cmp == null) {\r\n        throw new GPPError('GPP CMP not found');\r\n      }\r\n      this.INST = new this(cmp);\r\n    }\r\n    return this.INST;\r\n  }\r\n\r\n  #resolve;\r\n  #reject;\r\n  #pending = [];\r\n\r\n  initialized = false;\r\n\r\n  constructor(cmp) {\r\n    this.cmp = cmp;\r\n    [this.#resolve, this.#reject] = ['resolve', 'reject'].map(slot => (result) => {\r\n      while (this.#pending.length) {\r\n        this.#pending.pop()[slot](result);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * initialize this client - update consent data if already available,\r\n   * and set up event listeners to also update on CMP changes\r\n   *\r\n   * @param pingData\r\n   * @returns {Promise<{}>} a promise to GPP consent data\r\n   */\r\n  init(pingData) {\r\n    const ready = this.updateWhenReady(pingData);\r\n    if (!this.initialized) {\r\n      if (pingData.gppVersion !== this.apiVersion) {\r\n        logWarn(`Unrecognized GPP CMP version: ${pingData.apiVersion}. Continuing using GPP API version ${this.apiVersion}...`);\r\n      }\r\n      this.initialized = true;\r\n      this.cmp({\r\n        command: 'addEventListener',\r\n        callback: (event, success) => {\r\n          if (success != null && !success) {\r\n            this.#reject(new GPPError('Received error response from CMP', event));\r\n          } else if (event?.pingData?.cmpStatus === 'error') {\r\n            this.#reject(new GPPError('CMP status is \"error\"; please check CMP setup', event));\r\n          } else if (this.isCMPReady(event?.pingData || {}) && ['sectionChange', 'signalStatus'].includes(event?.eventName)) {\r\n            this.#resolve(this.updateConsent(event.pingData));\r\n          }\r\n          // NOTE: according to https://github.com/InteractiveAdvertisingBureau/Global-Privacy-Platform/blob/main/Core/CMP%20API%20Specification.md,\r\n          // > [signalStatus] Event is called whenever the display status of the CMP changes (e.g. the CMP shows the consent layer).\r\n          //\r\n          // however, from real world testing, at least some CMPs only trigger 'cmpDisplayStatus'\r\n          // other CMPs may do something else yet; here we just look for 'signalStatus: not ready' on any event\r\n          // to decide if consent data is likely to change\r\n          if (gppDataHandler.getConsentData() != null && event?.pingData != null && !this.isCMPReady(event.pingData)) {\r\n            gppDataHandler.setConsentData(null);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    return ready;\r\n  }\r\n\r\n  refresh() {\r\n    return this.cmp({command: 'ping'}).then(this.init.bind(this));\r\n  }\r\n\r\n  /**\r\n   * Retrieve and store GPP consent data.\r\n   *\r\n   * @param pingData\r\n   * @returns {Promise<{}>} a promise to GPP consent data\r\n   */\r\n  updateConsent(pingData) {\r\n    return new PbPromise(resolve => {\r\n      if (pingData == null || isEmpty(pingData)) {\r\n        throw new GPPError('Received empty response from CMP', pingData);\r\n      }\r\n      const consentData = parseConsentData(pingData);\r\n      logInfo('Retrieved GPP consent from CMP:', consentData);\r\n      gppDataHandler.setConsentData(consentData);\r\n      resolve(consentData);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Return a promise to GPP consent data, to be retrieved the next time the CMP signals it's ready.\r\n   *\r\n   * @returns {Promise<{}>}\r\n   */\r\n  nextUpdate() {\r\n    const def = defer();\r\n    this.#pending.push(def);\r\n    return def.promise;\r\n  }\r\n\r\n  /**\r\n   * Return a promise to GPP consent data, to be retrieved immediately if the CMP is ready according to `pingData`,\r\n   * or as soon as it signals that it's ready otherwise.\r\n   *\r\n   * @param pingData\r\n   * @returns {Promise<{}>}\r\n   */\r\n  updateWhenReady(pingData) {\r\n    return this.isCMPReady(pingData) ? this.updateConsent(pingData) : this.nextUpdate();\r\n  }\r\n\r\n  isCMPReady(pingData) {\r\n    return pingData.signalStatus === 'ready';\r\n  }\r\n}\r\n\r\nfunction lookupIabConsent() {\r\n  return new PbPromise((resolve) => resolve(GPPClient.get().refresh()))\r\n}\r\n\r\n// add new CMPs here, with their dedicated lookup function\r\nconst cmpCallMap = {\r\n  'iab': lookupIabConsent,\r\n};\r\n\r\nfunction parseConsentData(cmpData) {\r\n  if (\r\n    (cmpData?.applicableSections != null && !Array.isArray(cmpData.applicableSections)) ||\r\n    (cmpData?.gppString != null && !isStr(cmpData.gppString)) ||\r\n    (cmpData?.parsedSections != null && !isPlainObject(cmpData.parsedSections))\r\n  ) {\r\n    throw new GPPError('CMP returned unexpected value during lookup process.', cmpData);\r\n  }\r\n  ['usnatv1', 'uscav1'].forEach(section => {\r\n    if (cmpData?.parsedSections?.[section]) {\r\n      logWarn(`Received invalid section from cmp: '${section}'. Some functionality may not work as expected`, cmpData);\r\n    }\r\n  });\r\n  return toConsentData(cmpData);\r\n}\r\n\r\nexport function toConsentData(gppData = {} as any): GPPConsentData {\r\n  return {\r\n    gppString: gppData?.gppString,\r\n    applicableSections: gppData?.applicableSections || [],\r\n    parsedSections: gppData?.parsedSections || {},\r\n    gppData: gppData\r\n  };\r\n}\r\n\r\n/**\r\n * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\r\n */\r\nexport function resetConsentData() {\r\n  consentConfig = {};\r\n  gppDataHandler.reset();\r\n  GPPClient.INST = null;\r\n}\r\n\r\nconst parseConfig = configParser({\r\n  namespace: 'gpp',\r\n  displayName: 'GPP',\r\n  consentDataHandler: gppDataHandler,\r\n  parseConsentData,\r\n  getNullConsent: () => toConsentData(null),\r\n  cmpHandlers: cmpCallMap\r\n});\r\n\r\nexport function setConsentConfig(config) {\r\n  consentConfig = parseConfig(config);\r\n  return consentConfig.loadConsentData?.()?.catch?.(() => null);\r\n}\r\nconfig.getConfig('consentManagement', config => setConsentConfig(config.consentManagement));\r\n\r\nexport function enrichFPDHook(next, fpd) {\r\n  return next(fpd.then(ortb2 => {\r\n    const consent = gppDataHandler.getConsentData();\r\n    if (consent) {\r\n      if (Array.isArray(consent.applicableSections)) {\r\n        deepSetValue(ortb2, 'regs.gpp_sid', consent.applicableSections);\r\n      }\r\n      deepSetValue(ortb2, 'regs.gpp', consent.gppString);\r\n    }\r\n    return ortb2;\r\n  }));\r\n}\r\n\r\nenrichFPD.before(enrichFPDHook);\r\n","/**\r\n * This module adds GDPR consentManagement support to prebid.js.  It interacts with\r\n * supported CMPs (Consent Management Platforms) to grab the user's consent information\r\n * and make it available for any GDPR supported adapters to read/pass this information to\r\n * their system.\r\n */\r\nimport {deepSetValue, isStr, logInfo} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport {gdprDataHandler} from '../src/adapterManager.js';\r\nimport {registerOrtbProcessor, REQUEST} from '../src/pbjsORTB.js';\r\nimport {enrichFPD} from '../src/fpd/enrichment.js';\r\nimport {cmpClient} from '../libraries/cmp/cmpClient.js';\r\nimport {configParser} from '../libraries/consentManagement/cmUtils.js';\r\nimport {CONSENT_GDPR} from \"../src/consentHandler.ts\";\r\nimport type {CMConfig} from \"../libraries/consentManagement/cmUtils.ts\";\r\n\r\nexport let consentConfig: any = {};\r\nexport let gdprScope;\r\nlet dsaPlatform;\r\nconst CMP_VERSION = 2;\r\n\r\n// add new CMPs here, with their dedicated lookup function\r\nconst cmpCallMap = {\r\n  'iab': lookupIabConsent,\r\n};\r\n\r\n/**\r\n * @see https://github.com/InteractiveAdvertisingBureau/GDPR-Transparency-and-Consent-Framework\r\n * @see https://github.com/InteractiveAdvertisingBureau/iabtcf-es/tree/master/modules/core#iabtcfcore\r\n */\r\nexport type TCFConsentData = {\r\n  apiVersion: typeof CMP_VERSION;\r\n  /**\r\n   * The consent string.\r\n   */\r\n  consentString: string;\r\n  /**\r\n   * True if GDPR is in scope.\r\n   */\r\n  gdprApplies: boolean;\r\n  /**\r\n   * The response from the CMP.\r\n   */\r\n  vendorData: Record<string, unknown>;\r\n  /**\r\n   * Additional consent string, if provided by the CMP.\r\n   * @see https://support.google.com/admanager/answer/9681920?hl=en\r\n   */\r\n  addtlConsent?: `${number}~${string}~${string}`;\r\n}\r\n\r\nexport interface TCFConfig {\r\n  /**\r\n   *  Defines what the gdprApplies flag should be when the CMP doesn’t respond in time or the static data doesn’t supply.\r\n   *  Defaults to false.\r\n   */\r\n  defaultGdprScope?: boolean;\r\n  /**\r\n   * If true, indicates that the publisher is to be considered an “Online Platform” for the purposes of the Digital Services Act\r\n   */\r\n  dsaPlatform?: boolean;\r\n}\r\n\r\ntype TCFCMConfig = TCFConfig & CMConfig<TCFConsentData>;\r\n\r\ndeclare module '../src/consentHandler' {\r\n  interface ConsentData {\r\n    [CONSENT_GDPR]: TCFConsentData;\r\n  }\r\n  interface ConsentManagementConfig {\r\n    [CONSENT_GDPR]?: TCFCMConfig;\r\n  }\r\n}\r\n\r\n/**\r\n * This function handles interacting with an IAB compliant CMP to obtain the consent information of the user.\r\n */\r\nfunction lookupIabConsent(setProvisionalConsent) {\r\n  return new Promise<void>((resolve, reject) => {\r\n    function cmpResponseCallback(tcfData, success) {\r\n      logInfo('Received a response from CMP', tcfData);\r\n      if (success) {\r\n        try {\r\n          setProvisionalConsent(parseConsentData(tcfData));\r\n        } catch (e) {\r\n        }\r\n\r\n        if (tcfData.gdprApplies === false || tcfData.eventStatus === 'tcloaded' || tcfData.eventStatus === 'useractioncomplete') {\r\n          try {\r\n            gdprDataHandler.setConsentData(parseConsentData(tcfData));\r\n            resolve();\r\n          } catch (e) {\r\n            reject(e);\r\n          }\r\n        }\r\n      } else {\r\n        reject(Error('CMP unable to register callback function.  Please check CMP setup.'))\r\n      }\r\n    }\r\n\r\n    const cmp = cmpClient({\r\n      apiName: '__tcfapi',\r\n      apiVersion: CMP_VERSION,\r\n      apiArgs: ['command', 'version', 'callback', 'parameter'],\r\n    });\r\n\r\n    if (!cmp) {\r\n      reject(new Error('TCF2 CMP not found.'))\r\n    }\r\n    if ((cmp as any).isDirect) {\r\n      logInfo('Detected CMP API is directly accessible, calling it now...');\r\n    } else {\r\n      logInfo('Detected CMP is outside the current iframe where Prebid.js is located, calling it now...');\r\n    }\r\n\r\n    cmp({\r\n      command: 'addEventListener',\r\n      callback: cmpResponseCallback\r\n    })\r\n  })\r\n}\r\n\r\nfunction parseConsentData(consentObject): TCFConsentData {\r\n  function checkData() {\r\n    // if CMP does not respond with a gdprApplies boolean, use defaultGdprScope (gdprScope)\r\n    const gdprApplies = consentObject && typeof consentObject.gdprApplies === 'boolean' ? consentObject.gdprApplies : gdprScope;\r\n    const tcString = consentObject && consentObject.tcString;\r\n    return !!(\r\n      (typeof gdprApplies !== 'boolean') ||\r\n      (gdprApplies === true && (!tcString || !isStr(tcString)))\r\n    );\r\n  }\r\n\r\n  if (checkData()) {\r\n    throw Object.assign(new Error(`CMP returned unexpected value during lookup process.`), {args: [consentObject]})\r\n  } else {\r\n    return toConsentData(consentObject);\r\n  }\r\n}\r\n\r\nfunction toConsentData(cmpConsentObject) {\r\n  const consentData: TCFConsentData = {\r\n    consentString: (cmpConsentObject) ? cmpConsentObject.tcString : undefined,\r\n    vendorData: (cmpConsentObject) || undefined,\r\n    gdprApplies: cmpConsentObject && typeof cmpConsentObject.gdprApplies === 'boolean' ? cmpConsentObject.gdprApplies : gdprScope,\r\n    apiVersion: CMP_VERSION\r\n  };\r\n  if (cmpConsentObject && cmpConsentObject.addtlConsent && isStr(cmpConsentObject.addtlConsent)) {\r\n    consentData.addtlConsent = cmpConsentObject.addtlConsent;\r\n  }\r\n  return consentData;\r\n}\r\n\r\n/**\r\n * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\r\n */\r\nexport function resetConsentData() {\r\n  consentConfig = {};\r\n  gdprDataHandler.reset();\r\n}\r\n\r\nconst parseConfig = configParser({\r\n  namespace: 'gdpr',\r\n  displayName: 'TCF',\r\n  consentDataHandler: gdprDataHandler,\r\n  cmpHandlers: cmpCallMap,\r\n  parseConsentData,\r\n  getNullConsent: () => toConsentData(null)\r\n} as any)\r\n/**\r\n * A configuration function that initializes some module variables, as well as add a hook into the requestBids function\r\n */\r\nexport function setConsentConfig(config) {\r\n  // if `config.gdpr`, `config.usp` or `config.gpp` exist, assume new config format.\r\n  // else for backward compatability, just use `config`\r\n  const tcfConfig: TCFCMConfig = config && (config.gdpr || config.usp || config.gpp ? config.gdpr : config);\r\n  if ((tcfConfig?.consentData as any)?.getTCData != null) {\r\n    tcfConfig.consentData = (tcfConfig.consentData as any).getTCData;\r\n  }\r\n  gdprScope = tcfConfig?.defaultGdprScope === true;\r\n  dsaPlatform = !!tcfConfig?.dsaPlatform;\r\n  consentConfig = parseConfig({gdpr: tcfConfig});\r\n  return consentConfig.loadConsentData?.()?.catch?.(() => null);\r\n}\r\nconfig.getConfig('consentManagement', config => setConsentConfig(config.consentManagement));\r\n\r\nexport function enrichFPDHook(next, fpd) {\r\n  return next(fpd.then(ortb2 => {\r\n    const consent = gdprDataHandler.getConsentData();\r\n    if (consent) {\r\n      if (typeof consent.gdprApplies === 'boolean') {\r\n        deepSetValue(ortb2, 'regs.ext.gdpr', consent.gdprApplies ? 1 : 0);\r\n      }\r\n      deepSetValue(ortb2, 'user.ext.consent', consent.consentString);\r\n    }\r\n    if (dsaPlatform) {\r\n      deepSetValue(ortb2, 'regs.ext.dsa.dsarequired', 3);\r\n    }\r\n    return ortb2;\r\n  }));\r\n}\r\n\r\nenrichFPD.before(enrichFPDHook);\r\n\r\nexport function setOrtbAdditionalConsent(ortbRequest, bidderRequest) {\r\n  // this is not a standardized name for addtlConsent, so keep this as an ORTB library processor rather than an FPD enrichment\r\n  const addtl = bidderRequest.gdprConsent?.addtlConsent;\r\n  if (addtl && typeof addtl === 'string') {\r\n    deepSetValue(ortbRequest, 'user.ext.ConsentedProvidersSettings.consented_providers', addtl);\r\n  }\r\n}\r\n\r\nregisterOrtbProcessor({type: REQUEST, name: 'gdprAddtlConsent', fn: setOrtbAdditionalConsent})\r\n","/**\r\n * This module adds USPAPI (CCPA) consentManagement support to prebid.js. It\r\n * interacts with supported USP Consent APIs to grab the user's consent\r\n * information and make it available for any USP (CCPA) supported adapters to\r\n * read/pass this information to their system.\r\n */\r\nimport {deepSetValue, isNumber, isPlainObject, isStr, logError, logInfo, logWarn} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport adapterManager, {uspDataHandler} from '../src/adapterManager.js';\r\nimport {timedAuctionHook} from '../src/utils/perfMetrics.js';\r\nimport {getHook} from '../src/hook.js';\r\nimport {enrichFPD} from '../src/fpd/enrichment.js';\r\nimport {cmpClient} from '../libraries/cmp/cmpClient.js';\r\nimport type {IABCMConfig, StaticCMConfig} from \"../libraries/consentManagement/cmUtils.ts\";\r\nimport type {CONSENT_USP} from \"../src/consentHandler.ts\";\r\n\r\nconst DEFAULT_CONSENT_API = 'iab';\r\nconst DEFAULT_CONSENT_TIMEOUT = 50;\r\nconst USPAPI_VERSION = 1;\r\n\r\nexport let consentAPI = DEFAULT_CONSENT_API;\r\nexport let consentTimeout = DEFAULT_CONSENT_TIMEOUT;\r\nexport let staticConsentData;\r\n\r\ntype USPConsentData = string;\r\ntype BaseUSPConfig = {\r\n  /**\r\n   * Length of time (in milliseconds) to delay auctions while waiting for consent data from the CMP.\r\n   * Default is 50.\r\n   */\r\n  timeout?: number;\r\n}\r\n\r\ntype StaticUSPData = {\r\n  getUSPData: {\r\n    uspString: USPConsentData;\r\n  }\r\n}\r\ntype USPCMConfig = BaseUSPConfig & (IABCMConfig | StaticCMConfig<StaticUSPData>);\r\n\r\ndeclare module '../src/consentHandler' {\r\n  interface ConsentData {\r\n    [CONSENT_USP]: USPConsentData;\r\n  }\r\n  interface ConsentManagementConfig {\r\n    [CONSENT_USP]?: USPCMConfig;\r\n  }\r\n}\r\n\r\nlet consentData;\r\nlet enabled = false;\r\n\r\n// consent APIs\r\nconst uspCallMap = {\r\n  'iab': lookupUspConsent,\r\n  'static': lookupStaticConsentData\r\n};\r\n\r\n/**\r\n * This function reads the consent string from the config to obtain the consent information of the user.\r\n */\r\nfunction lookupStaticConsentData({onSuccess, onError}) {\r\n  processUspData(staticConsentData, {onSuccess, onError});\r\n}\r\n\r\n/**\r\n * This function handles interacting with an USP compliant consent manager to obtain the consent information of the user.\r\n * Given the async nature of the USP's API, we pass in acting success/error callback functions to exit this function\r\n * based on the appropriate result.\r\n */\r\nfunction lookupUspConsent({onSuccess, onError}) {\r\n  function handleUspApiResponseCallbacks() {\r\n    const uspResponse = {} as any;\r\n\r\n    function afterEach() {\r\n      if (uspResponse.usPrivacy) {\r\n        processUspData(uspResponse, {onSuccess, onError})\r\n      } else {\r\n        onError('Unable to get USP consent string.');\r\n      }\r\n    }\r\n\r\n    return {\r\n      consentDataCallback: (consentResponse, success) => {\r\n        if (success && consentResponse.uspString) {\r\n          uspResponse.usPrivacy = consentResponse.uspString;\r\n        }\r\n        afterEach();\r\n      },\r\n    };\r\n  }\r\n\r\n  const callbackHandler = handleUspApiResponseCallbacks();\r\n\r\n  const cmp = cmpClient({\r\n    apiName: '__uspapi',\r\n    apiVersion: USPAPI_VERSION,\r\n    apiArgs: ['command', 'version', 'callback'],\r\n  }) as any;\r\n\r\n  if (!cmp) {\r\n    return onError('USP CMP not found.');\r\n  }\r\n\r\n  if (cmp.isDirect) {\r\n    logInfo('Detected USP CMP is directly accessible, calling it now...');\r\n  } else {\r\n    logInfo(\r\n      'Detected USP CMP is outside the current iframe where Prebid.js is located, calling it now...'\r\n    );\r\n  }\r\n\r\n  cmp({\r\n    command: 'getUSPData',\r\n    callback: callbackHandler.consentDataCallback\r\n  });\r\n\r\n  cmp({\r\n    command: 'registerDeletion',\r\n    callback: (res, success) => (success == null || success) && adapterManager.callDataDeletionRequest(res)\r\n  }).catch(e => {\r\n    logError('Error invoking CMP `registerDeletion`:', e);\r\n  });\r\n}\r\n\r\n/**\r\n * Lookup consent data and store it in the `consentData` global as well as `adapterManager.js`' uspDataHanlder.\r\n *\r\n * @param cb a callback that takes an error message and extra error arguments; all args will be undefined if consent\r\n * data was retrieved successfully.\r\n */\r\nfunction loadConsentData(cb?) {\r\n  let timer = null;\r\n  let isDone = false;\r\n\r\n  function done(consentData, errMsg, ...extraArgs) {\r\n    if (timer != null) {\r\n      clearTimeout(timer);\r\n    }\r\n    isDone = true;\r\n    uspDataHandler.setConsentData(consentData);\r\n    if (cb != null) {\r\n      cb(errMsg, ...extraArgs)\r\n    }\r\n  }\r\n\r\n  if (!uspCallMap[consentAPI]) {\r\n    done(null, `USP framework (${consentAPI}) is not a supported framework. Aborting consentManagement module and resuming auction.`);\r\n    return;\r\n  }\r\n\r\n  const callbacks = {\r\n    onSuccess: done,\r\n    onError: function (errMsg, ...extraArgs) {\r\n      done(null, `${errMsg} Resuming auction without consent data as per consentManagement config.`, ...extraArgs);\r\n    }\r\n  }\r\n\r\n  uspCallMap[consentAPI](callbacks);\r\n\r\n  if (!isDone) {\r\n    if (consentTimeout === 0) {\r\n      processUspData(undefined, callbacks);\r\n    } else {\r\n      timer = setTimeout(callbacks.onError.bind(null, 'USPAPI workflow exceeded timeout threshold.'), consentTimeout)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * If consentManagementUSP module is enabled (ie included in setConfig), this hook function will attempt to fetch the\r\n * user's encoded consent string from the supported USPAPI. Once obtained, the module will store this\r\n * data as part of a uspConsent object which gets transferred to adapterManager's uspDataHandler object.\r\n * This information is later added into the bidRequest object for any supported adapters to read/pass along to their system.\r\n * @param {object} reqBidsConfigObj required; This is the same param that's used in pbjs.requestBids.\r\n * @param {function} fn required; The next function in the chain, used by hook.ts\r\n */\r\nexport const requestBidsHook = timedAuctionHook('usp', function requestBidsHook(fn, reqBidsConfigObj) {\r\n  if (!enabled) {\r\n    enableConsentManagement();\r\n  }\r\n  loadConsentData((errMsg, ...extraArgs) => {\r\n    if (errMsg != null) {\r\n      logWarn(errMsg, ...extraArgs);\r\n    }\r\n    fn.call(this, reqBidsConfigObj);\r\n  });\r\n});\r\n\r\n/**\r\n * This function checks the consent data provided by USPAPI to ensure it's in an expected state.\r\n * If it's bad, we exit the module depending on config settings.\r\n * If it's good, then we store the value and exit the module.\r\n *\r\n * @param {Object} consentObject - The object returned by USPAPI that contains the user's consent choices.\r\n * @param {Object} callbacks - An object containing the callback functions.\r\n * @param {function(string): void} callbacks.onSuccess - Callback accepting the resolved USP consent string.\r\n * @param {function(string, ...Object?): void} callbacks.onError - Callback accepting an error message and any extra error arguments (used purely for logging).\r\n */\r\nfunction processUspData(consentObject, {onSuccess, onError}) {\r\n  const valid = !!(consentObject && consentObject.usPrivacy);\r\n  if (!valid) {\r\n    onError(`USPAPI returned unexpected value during lookup process.`, consentObject);\r\n    return;\r\n  }\r\n\r\n  storeUspConsentData(consentObject);\r\n  onSuccess(consentData);\r\n}\r\n\r\n/**\r\n * Stores USP data locally in module and then invokes uspDataHandler.setConsentData() to make information available in adaptermanger.js for later in the auction\r\n * @param {object} consentObject required; an object representing user's consent choices (can be undefined in certain use-cases for this function only)\r\n */\r\nfunction storeUspConsentData(consentObject) {\r\n  if (consentObject && consentObject.usPrivacy) {\r\n    consentData = consentObject.usPrivacy;\r\n  }\r\n}\r\n\r\n/**\r\n * Simply resets the module's consentData variable back to undefined, mainly for testing purposes\r\n */\r\nexport function resetConsentData() {\r\n  consentData = undefined;\r\n  consentAPI = undefined;\r\n  consentTimeout = undefined;\r\n  uspDataHandler.reset();\r\n  enabled = false;\r\n}\r\n\r\n/**\r\n * A configuration function that initializes some module variables, as well as add a hook into the requestBids function\r\n * @param {object} config required; consentManagementUSP module config settings; usp (string), timeout (int)\r\n */\r\nexport function setConsentConfig(config) {\r\n  config = config && config.usp;\r\n  if (!config || typeof config !== 'object') {\r\n    logWarn('consentManagement.usp config not defined, using defaults');\r\n  }\r\n  if (config && isStr(config.cmpApi)) {\r\n    consentAPI = config.cmpApi;\r\n  } else {\r\n    consentAPI = DEFAULT_CONSENT_API;\r\n    logInfo(`consentManagement.usp config did not specify cmpApi. Using system default setting (${DEFAULT_CONSENT_API}).`);\r\n  }\r\n\r\n  if (config && isNumber(config.timeout)) {\r\n    consentTimeout = config.timeout;\r\n  } else {\r\n    consentTimeout = DEFAULT_CONSENT_TIMEOUT;\r\n    logInfo(`consentManagement.usp config did not specify timeout. Using system default setting (${DEFAULT_CONSENT_TIMEOUT}).`);\r\n  }\r\n  if (consentAPI === 'static') {\r\n    if (isPlainObject(config.consentData) && isPlainObject(config.consentData.getUSPData)) {\r\n      if (config.consentData.getUSPData.uspString) staticConsentData = { usPrivacy: config.consentData.getUSPData.uspString };\r\n      consentTimeout = 0;\r\n    } else {\r\n      logError(`consentManagement config with cmpApi: 'static' did not specify consentData. No consents will be available to adapters.`);\r\n    }\r\n  }\r\n  enableConsentManagement(true);\r\n}\r\n\r\nfunction enableConsentManagement(configFromUser = false) {\r\n  if (!enabled) {\r\n    logInfo(`USPAPI consentManagement module has been activated${configFromUser ? '' : ` using default values (api: '${consentAPI}', timeout: ${consentTimeout}ms)`}`);\r\n    enabled = true;\r\n    uspDataHandler.enable();\r\n  }\r\n  loadConsentData(); // immediately look up consent data to make it available without requiring an auction\r\n}\r\nconfig.getConfig('consentManagement', config => setConsentConfig(config.consentManagement));\r\n\r\ngetHook('requestBids').before(requestBidsHook, 50);\r\n\r\nexport function enrichFPDHook(next, fpd) {\r\n  return next(fpd.then(ortb2 => {\r\n    const consent = uspDataHandler.getConsentData();\r\n    if (consent) {\r\n      deepSetValue(ortb2, 'regs.ext.us_privacy', consent)\r\n    }\r\n    return ortb2;\r\n  }))\r\n}\r\n\r\nenrichFPD.before(enrichFPDHook);\r\n","import {\r\n  buildUrl,\r\n  deepAccess,\r\n  getBidIdParameter,\r\n  isArray,\r\n  isFn,\r\n  isPlainObject,\r\n  isStr,\r\n  logWarn,\r\n  mergeDeep,\r\n  parseUrl,\r\n} from '../src/utils.js';\r\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport {BANNER, NATIVE, VIDEO} from '../src/mediaTypes.js';\r\nimport {ortbConverter} from '../libraries/ortbConverter/converter.js';\r\nimport {ORTB_MTYPES} from '../libraries/ortbConverter/processors/mediaType.js';\r\n\r\n// Maintainer: mediapsr@epsilon.com\r\n\r\n/**\r\n * @typedef {import('../src/adapters/bidderFactory.js').BidRequest} BidRequest\r\n * @typedef {import('../src/adapters/bidderFactory.js').Bid} Bid\r\n * @typedef {import('../src/adapters/bidderFactory.js').ServerRequest} ServerRequest\r\n * @typedef {import('../src/adapters/bidderFactory.js').Device} Device\r\n */\r\n\r\nconst GVLID = 24;\r\n\r\nconst BIDDER_CODE = 'conversant';\r\nconst URL = 'https://web.hb.ad.cpe.dotomi.com/cvx/client/hb/ortb/25';\r\n\r\nfunction setSiteId(bidRequest, request) {\r\n  if (bidRequest.params.site_id) {\r\n    if (request.site) {\r\n      request.site.id = bidRequest.params.site_id;\r\n    }\r\n    if (request.app) {\r\n      request.app.id = bidRequest.params.site_id;\r\n    }\r\n  }\r\n}\r\n\r\nconst converter = ortbConverter({\r\n  context: {\r\n    netRevenue: true,\r\n    ttl: 300\r\n  },\r\n  request: function (buildRequest, imps, bidderRequest, context) {\r\n    const request = buildRequest(imps, bidderRequest, context);\r\n    request.at = 1;\r\n    request.cur = ['USD'];\r\n    if (context.bidRequests) {\r\n      const bidRequest = context.bidRequests[0];\r\n      setSiteId(bidRequest, request);\r\n    }\r\n\r\n    return request;\r\n  },\r\n  imp(buildImp, bidRequest, context) {\r\n    const imp = buildImp(bidRequest, context);\r\n    const data = {\r\n      secure: 1,\r\n      bidfloor: getBidFloor(bidRequest) || 0,\r\n      displaymanager: 'Prebid.js',\r\n      displaymanagerver: '$prebid.version$'\r\n    };\r\n    copyOptProperty(bidRequest.params.tag_id, data, 'tagid');\r\n    mergeDeep(imp, data, imp);\r\n    return imp;\r\n  },\r\n  bidResponse: function (buildBidResponse, bid, context) {\r\n    if (!bid.price) return;\r\n\r\n    // ensure that context.mediaType is set to banner or video otherwise\r\n    if (!context.mediaType && context.bidRequest.mediaTypes) {\r\n      const [type] = Object.keys(context.bidRequest.mediaTypes);\r\n      if (Object.values(ORTB_MTYPES).includes(type)) {\r\n        context.mediaType = type;\r\n      }\r\n    }\r\n    const bidResponse = buildBidResponse(bid, context);\r\n    return bidResponse;\r\n  },\r\n  response(buildResponse, bidResponses, ortbResponse, context) {\r\n    const response = buildResponse(bidResponses, ortbResponse, context);\r\n    return response;\r\n  },\r\n  overrides: {\r\n    imp: {\r\n      banner(fillBannerImp, imp, bidRequest, context) {\r\n        if (bidRequest.mediaTypes && !bidRequest.mediaTypes.banner) return;\r\n        if (bidRequest.params.position) {\r\n          // fillBannerImp looks for mediaTypes.banner.pos so put it under the right name here\r\n          mergeDeep(bidRequest, {mediaTypes: {banner: {pos: bidRequest.params.position}}});\r\n        }\r\n        fillBannerImp(imp, bidRequest, context);\r\n      },\r\n      video(fillVideoImp, imp, bidRequest, context) {\r\n        if (bidRequest.mediaTypes && !bidRequest.mediaTypes.video) return;\r\n        const videoData = {};\r\n        copyOptProperty(bidRequest.params?.position, videoData, 'pos');\r\n        copyOptProperty(bidRequest.params?.mimes, videoData, 'mimes');\r\n        copyOptProperty(bidRequest.params?.maxduration, videoData, 'maxduration');\r\n        copyOptProperty(bidRequest.params?.protocols, videoData, 'protocols');\r\n        copyOptProperty(bidRequest.params?.api, videoData, 'api');\r\n        imp.video = mergeDeep(videoData, imp.video);\r\n        fillVideoImp(imp, bidRequest, context);\r\n      }\r\n    },\r\n  }\r\n});\r\n\r\nexport const spec = {\r\n  code: BIDDER_CODE,\r\n  gvlid: GVLID,\r\n  aliases: ['cnvr', 'epsilon'], // short code\r\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\r\n\r\n  /**\r\n   * Determines whether or not the given bid request is valid.\r\n   *\r\n   * @param {BidRequest} bid - The bid params to validate.\r\n   * @return {boolean} True if this is a valid bid, and false otherwise.\r\n   */\r\n  isBidRequestValid: function(bid) {\r\n    if (!bid || !bid.params) {\r\n      logWarn(BIDDER_CODE + ': Missing bid parameters');\r\n      return false;\r\n    }\r\n\r\n    if (!isStr(bid.params.site_id)) {\r\n      logWarn(BIDDER_CODE + ': site_id must be specified as a string');\r\n      return false;\r\n    }\r\n\r\n    if (isVideoRequest(bid)) {\r\n      const mimes = bid.params.mimes || deepAccess(bid, 'mediaTypes.video.mimes');\r\n      if (!mimes) {\r\n        // Give a warning but let it pass\r\n        logWarn(BIDDER_CODE + ': mimes should be specified for videos');\r\n      } else if (!isArray(mimes) || !mimes.every(s => isStr(s))) {\r\n        logWarn(BIDDER_CODE + ': mimes must be an array of strings');\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  buildRequests: function(bidRequests, bidderRequest) {\r\n    const payload = converter.toORTB({bidderRequest, bidRequests});\r\n    const result = {\r\n      method: 'POST',\r\n      url: makeBidUrl(bidRequests[0]),\r\n      data: payload,\r\n    };\r\n    return result;\r\n  },\r\n  /**\r\n   * Unpack the response from the server into a list of bids.\r\n   *\r\n   * @param {*} serverResponse A successful response from the server.\r\n   * @param bidRequest\r\n   * @return {Bid[]} An array of bids which were nested inside the server.\r\n   */\r\n  interpretResponse: function(serverResponse, bidRequest) {\r\n    const ortbBids = converter.fromORTB({request: bidRequest.data, response: serverResponse.body});\r\n    return ortbBids;\r\n  },\r\n\r\n  /**\r\n   * Register User Sync.\r\n   */\r\n  getUserSyncs: function(syncOptions, responses, gdprConsent, uspConsent) {\r\n    const params = {};\r\n    const syncs = [];\r\n\r\n    // Attaching GDPR Consent Params in UserSync url\r\n    if (gdprConsent) {\r\n      params.gdpr = (gdprConsent.gdprApplies) ? 1 : 0;\r\n      params.gdpr_consent = encodeURIComponent(gdprConsent.consentString || '');\r\n    }\r\n\r\n    // CCPA\r\n    if (uspConsent) {\r\n      params.us_privacy = encodeURIComponent(uspConsent);\r\n    }\r\n\r\n    if (responses && responses.ext) {\r\n      const pixels = [{urls: responses.ext.fsyncs, type: 'iframe'}, {urls: responses.ext.psyncs, type: 'image'}]\r\n        .filter((entry) => {\r\n          return entry.urls &&\r\n            ((entry.type === 'iframe' && syncOptions.iframeEnabled) ||\r\n            (entry.type === 'image' && syncOptions.pixelEnabled));\r\n        })\r\n        .map((entry) => {\r\n          return entry.urls.map((endpoint) => {\r\n            const urlInfo = parseUrl(endpoint);\r\n            mergeDeep(urlInfo.search, params);\r\n            if (Object.keys(urlInfo.search).length === 0) {\r\n              delete urlInfo.search; // empty search object causes buildUrl to add a trailing ? to the url\r\n            }\r\n            return {type: entry.type, url: buildUrl(urlInfo)};\r\n          })\r\n            .reduce((x, y) => x.concat(y), []);\r\n        })\r\n        .reduce((x, y) => x.concat(y), []);\r\n      syncs.push(...pixels);\r\n    }\r\n    return syncs;\r\n  }\r\n};\r\n\r\n/**\r\n * Check if it's a video bid request\r\n *\r\n * @param {BidRequest} bid - Bid request generated from ad slots\r\n * @returns {boolean} True if it's a video bid\r\n */\r\nfunction isVideoRequest(bid) {\r\n  return bid.mediaType === 'video' || !!deepAccess(bid, 'mediaTypes.video');\r\n}\r\n\r\n/**\r\n * Copy property if exists from src to dst\r\n *\r\n * @param {object} src - source object\r\n * @param {object} dst - destination object\r\n * @param {string} dstName - destination property name\r\n */\r\nfunction copyOptProperty(src, dst, dstName) {\r\n  if (src) {\r\n    dst[dstName] = src;\r\n  }\r\n}\r\n\r\n/**\r\n * Get the floor price from bid.params for backward compatibility.\r\n * If not found, then check floor module.\r\n * @param bid A valid bid object\r\n * @returns {*|number} floor price\r\n */\r\nfunction getBidFloor(bid) {\r\n  let floor = getBidIdParameter('bidfloor', bid.params);\r\n\r\n  if (!floor && isFn(bid.getFloor)) {\r\n    const floorObj = bid.getFloor({\r\n      currency: 'USD',\r\n      mediaType: '*',\r\n      size: '*'\r\n    });\r\n\r\n    if (isPlainObject(floorObj) && !isNaN(floorObj.floor) && floorObj.currency === 'USD') {\r\n      floor = floorObj.floor;\r\n    }\r\n  }\r\n\r\n  return floor\r\n}\r\n\r\nfunction makeBidUrl(bid) {\r\n  let bidurl = URL;\r\n  if (bid.params.white_label_url) {\r\n    bidurl = bid.params.white_label_url;\r\n  }\r\n  return bidurl;\r\n}\r\n\r\nregisterBidder(spec);\r\n","import {BANNER, VIDEO} from '../../src/mediaTypes.js';\r\nimport {deepAccess, deepClone, delayExecution, hasNonSerializableProperty, mergeDeep} from '../../src/utils.js';\r\nimport responseResolvers from './responses.js';\r\n\r\n/**\r\n * @typedef {Number|String|boolean|null|undefined} Scalar\r\n */\r\n\r\nexport function BidInterceptor(opts = {}) {\r\n  ({setTimeout: this.setTimeout = window.setTimeout.bind(window)} = opts);\r\n  this.logger = opts.logger;\r\n  this.rules = [];\r\n}\r\n\r\nObject.assign(BidInterceptor.prototype, {\r\n  DEFAULT_RULE_OPTIONS: {\r\n    delay: 0\r\n  },\r\n  serializeConfig(ruleDefs) {\r\n    const isSerializable = (ruleDef, i) => {\r\n      const serializable = !hasNonSerializableProperty(ruleDef);\r\n      if (!serializable && !deepAccess(ruleDef, 'options.suppressWarnings')) {\r\n        this.logger.logWarn(`Bid interceptor rule definition #${i + 1} contains non-serializable properties and will be lost after a refresh. Rule definition: `, ruleDef);\r\n      }\r\n      return serializable;\r\n    }\r\n    return ruleDefs.filter(isSerializable);\r\n  },\r\n  updateConfig(config) {\r\n    this.rules = (config.intercept || []).map((ruleDef, i) => this.rule(ruleDef, i + 1))\r\n  },\r\n  /**\r\n   * @typedef {Object} RuleOptions\r\n   * @property {Number} [delay=0] delay between bid interception and mocking of response (to simulate network delay)\r\n   * @property {boolean} [suppressWarnings=false] if enabled, do not warn about unserializable rules\r\n   *\r\n   * @typedef {Object} Rule\r\n   * @property {Number} no rule number (used only as an identifier for logging)\r\n   * @property {function({}, {}): boolean} match a predicate function that tests a bid against this rule\r\n   * @property {ReplacerFn} replacer generator function for mock bid responses\r\n   * @property {RuleOptions} options\r\n   */\r\n\r\n  /**\r\n   * @param {{}} ruleDef\r\n   * @param {Number} ruleNo\r\n   * @returns {Rule}\r\n   */\r\n  rule(ruleDef, ruleNo) {\r\n    return {\r\n      no: ruleNo,\r\n      match: this.matcher(ruleDef.when, ruleNo),\r\n      replace: this.replacer(ruleDef.then, ruleNo),\r\n      options: Object.assign({}, this.DEFAULT_RULE_OPTIONS, ruleDef.options),\r\n      paapi: this.paapiReplacer(ruleDef.paapi || [], ruleNo)\r\n    }\r\n  },\r\n  /**\r\n   * @typedef {Function} MatchPredicate\r\n   * @param {*} candidate a bid to match, or a portion of it if used inside an ObjectMather.\r\n   * e.g. matcher((bid, bidRequest) => ....) or matcher({property: (property, bidRequest) => ...})\r\n   * @param {*} bidRequest the request `candidate` belongs to\r\n   * @returns {boolean}\r\n   *\r\n   */\r\n\r\n  /**\r\n   * @param {*} matchDef matcher definition\r\n   * @param {Number} ruleNo\r\n   * @returns {MatchPredicate} a predicate function that matches a bid against the given `matchDef`\r\n   */\r\n  matcher(matchDef, ruleNo) {\r\n    if (typeof matchDef === 'function') {\r\n      return matchDef;\r\n    }\r\n    if (typeof matchDef !== 'object') {\r\n      this.logger.logError(`Invalid 'when' definition for debug bid interceptor (in rule #${ruleNo})`);\r\n      return () => false;\r\n    }\r\n    function matches(candidate, {ref = matchDef, args = []}) {\r\n      return Object.entries(ref).map(([key, val]) => {\r\n        const cVal = candidate[key];\r\n        if (val instanceof RegExp) {\r\n          return val.exec(cVal) != null;\r\n        }\r\n        if (typeof val === 'function') {\r\n          return !!val(cVal, ...args);\r\n        }\r\n        if (typeof val === 'object') {\r\n          return matches(cVal, {ref: val, args});\r\n        }\r\n        return cVal === val;\r\n      }).every((i) => i);\r\n    }\r\n    return (candidate, ...args) => matches(candidate, {args});\r\n  },\r\n  /**\r\n   * @typedef {Function} ReplacerFn\r\n   * @param {*} bid a bid that was intercepted\r\n   * @param {*} bidRequest the request `bid` belongs to\r\n   * @returns {*} the response to mock for `bid`, or a portion of it if used inside an ObjectReplacer.\r\n   * e.g. replacer((bid, bidRequest) => mockResponse) or replacer({property: (bid, bidRequest) => mockProperty})\r\n   *\r\n   */\r\n\r\n  /**\r\n   * @param {*} replDef replacer definition\r\n   * @param ruleNo\r\n   * @return {ReplacerFn}\r\n   */\r\n  replacer(replDef, ruleNo) {\r\n    if (replDef === null) {\r\n      return () => null\r\n    }\r\n    replDef = replDef || {};\r\n    let replFn;\r\n    if (typeof replDef === 'function') {\r\n      replFn = ({args}) => replDef(...args);\r\n    } else if (typeof replDef !== 'object') {\r\n      this.logger.logError(`Invalid 'then' definition for debug bid interceptor (in rule #${ruleNo})`);\r\n      replFn = () => ({});\r\n    } else {\r\n      replFn = ({args, ref = replDef}) => {\r\n        const result = Array.isArray(ref) ? [] : {};\r\n        Object.entries(ref).forEach(([key, val]) => {\r\n          if (typeof val === 'function') {\r\n            result[key] = val(...args);\r\n          } else if (val != null && typeof val === 'object') {\r\n            result[key] = replFn({args, ref: val})\r\n          } else {\r\n            result[key] = val;\r\n          }\r\n        });\r\n        return result;\r\n      }\r\n    }\r\n    return (bid, ...args) => {\r\n      const response = this.responseDefaults(bid);\r\n      mergeDeep(response, replFn({args: [bid, ...args]}));\r\n      const resolver = responseResolvers[response.mediaType];\r\n      resolver && resolver(bid, response);\r\n      response.isDebug = true;\r\n      return response;\r\n    }\r\n  },\r\n\r\n  paapiReplacer(paapiDef, ruleNo) {\r\n    function wrap(configs = []) {\r\n      return configs.map(config => {\r\n        return Object.keys(config).some(k => !['config', 'igb'].includes(k))\r\n          ? {config}\r\n          : config\r\n      });\r\n    }\r\n    if (Array.isArray(paapiDef)) {\r\n      return () => wrap(paapiDef);\r\n    } else if (typeof paapiDef === 'function') {\r\n      return (...args) => wrap(paapiDef(...args))\r\n    } else {\r\n      this.logger.logError(`Invalid 'paapi' definition for debug bid interceptor (in rule #${ruleNo})`);\r\n    }\r\n  },\r\n\r\n  responseDefaults(bid) {\r\n    const response = {\r\n      requestId: bid.bidId,\r\n      cpm: 3.5764,\r\n      currency: 'EUR',\r\n      ttl: 360,\r\n      creativeId: 'mock-creative-id',\r\n      netRevenue: false,\r\n      meta: {}\r\n    };\r\n\r\n    if (!bid.mediaType) {\r\n      response.mediaType = Object.keys(bid.mediaTypes ?? {})[0] ?? BANNER;\r\n    }\r\n    let size;\r\n    if (response.mediaType === BANNER) {\r\n      size = bid.mediaTypes?.banner?.sizes?.[0] ?? [300, 250];\r\n    } else if (response.mediaType === VIDEO) {\r\n      size = bid.mediaTypes?.video?.playerSize?.[0] ?? [600, 500];\r\n    }\r\n    if (Array.isArray(size)) {\r\n      ([response.width, response.height] = size);\r\n    }\r\n    return response;\r\n  },\r\n  /**\r\n   * Match a candidate bid against all registered rules.\r\n   *\r\n   * @param {{}} candidate\r\n   * @param args\r\n   * @returns {Rule|undefined} the first matching rule, or undefined if no match was found.\r\n   */\r\n  match(candidate, ...args) {\r\n    return this.rules.find((rule) => rule.match(candidate, ...args));\r\n  },\r\n  /**\r\n   * Match a set of bids against all registered rules.\r\n   *\r\n   * @param bids\r\n   * @param bidRequest\r\n   * @returns {[{bid: *, rule: Rule}[], *[]]} a 2-tuple for matching bids (decorated with the matching rule) and\r\n   * non-matching bids.\r\n   */\r\n  matchAll(bids, bidRequest) {\r\n    const [matches, remainder] = [[], []];\r\n    bids.forEach((bid) => {\r\n      const rule = this.match(bid, bidRequest);\r\n      if (rule != null) {\r\n        matches.push({rule: rule, bid: bid});\r\n      } else {\r\n        remainder.push(bid);\r\n      }\r\n    })\r\n    return [matches, remainder];\r\n  },\r\n  /**\r\n   * Run a set of bids against all registered rules, filter out those that match,\r\n   * and generate mock responses for them.\r\n   *\r\n   * {{}[]} bids?\r\n   * {*} bidRequest\r\n   * {function(*)} addBid called once for each mock response\r\n   * addPaapiConfig called once for each mock PAAPI config\r\n   * {function()} done called once after all mock responses have been run through `addBid`\r\n   * returns {{bids: {}[], bidRequest: {}} remaining bids that did not match any rule (this applies also to\r\n   * bidRequest.bids)\r\n   */\r\n  intercept({bids, bidRequest, addBid, addPaapiConfig, done}) {\r\n    if (bids == null) {\r\n      bids = bidRequest.bids;\r\n    }\r\n    const [matches, remainder] = this.matchAll(bids, bidRequest);\r\n    if (matches.length > 0) {\r\n      const callDone = delayExecution(done, matches.length);\r\n      matches.forEach((match) => {\r\n        const mockResponse = match.rule.replace(match.bid, bidRequest);\r\n        const mockPaapi = match.rule.paapi(match.bid, bidRequest);\r\n        const delay = match.rule.options.delay;\r\n        this.logger.logMessage(`Intercepted bid request (matching rule #${match.rule.no}), mocking response in ${delay}ms. Request, response, PAAPI configs:`, match.bid, mockResponse, mockPaapi)\r\n        this.setTimeout(() => {\r\n          mockResponse && addBid(mockResponse, match.bid);\r\n          mockPaapi.forEach(cfg => addPaapiConfig(cfg, match.bid, bidRequest));\r\n          callDone();\r\n        }, delay)\r\n      });\r\n      bidRequest = deepClone(bidRequest);\r\n      bids = bidRequest.bids = remainder;\r\n    } else {\r\n      this.setTimeout(done, 0);\r\n    }\r\n    return {bids, bidRequest};\r\n  }\r\n});\r\n","import {deepClone, delayExecution} from '../../src/utils.js';\r\nimport {BidInterceptor} from './bidInterceptor.js';\r\nimport {makePbsInterceptor} from './pbsInterceptor.js';\r\nimport {addHooks, removeHooks} from './legacy.js';\r\n\r\nconst interceptorHooks = [];\r\nlet bidInterceptor;\r\nlet enabled = false;\r\n\r\nfunction enableDebugging(debugConfig, {fromSession = false, config, hook, logger}) {\r\n  config.setConfig({debug: true});\r\n  bidInterceptor.updateConfig(debugConfig);\r\n  resetHooks(true);\r\n  // also enable \"legacy\" overrides\r\n  removeHooks({hook});\r\n  addHooks(debugConfig, {hook, logger});\r\n  if (!enabled) {\r\n    enabled = true;\r\n    logger.logMessage(`Debug overrides enabled${fromSession ? ' from session' : ''}`);\r\n  }\r\n}\r\n\r\nexport function disableDebugging({hook, logger}) {\r\n  bidInterceptor.updateConfig(({}));\r\n  resetHooks(false);\r\n  // also disable \"legacy\" overrides\r\n  removeHooks({hook});\r\n  if (enabled) {\r\n    enabled = false;\r\n    logger.logMessage('Debug overrides disabled');\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line no-restricted-properties\r\nfunction saveDebuggingConfig(debugConfig, {sessionStorage = window.sessionStorage, DEBUG_KEY} = {}) {\r\n  if (!debugConfig.enabled) {\r\n    try {\r\n      sessionStorage.removeItem(DEBUG_KEY);\r\n    } catch (e) {\r\n    }\r\n  } else {\r\n    if (debugConfig.intercept) {\r\n      debugConfig = deepClone(debugConfig);\r\n      debugConfig.intercept = bidInterceptor.serializeConfig(debugConfig.intercept);\r\n    }\r\n    try {\r\n      sessionStorage.setItem(DEBUG_KEY, JSON.stringify(debugConfig));\r\n    } catch (e) {\r\n    }\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line no-restricted-properties\r\nexport function getConfig(debugging, {getStorage = () => window.sessionStorage, DEBUG_KEY, config, hook, logger} = {}) {\r\n  if (debugging == null) return;\r\n  let sessionStorage;\r\n  try {\r\n    sessionStorage = getStorage();\r\n  } catch (e) {\r\n    logger.logError(`sessionStorage is not available: debugging configuration will not persist on page reload`, e);\r\n  }\r\n  if (sessionStorage != null) {\r\n    saveDebuggingConfig(debugging, {sessionStorage, DEBUG_KEY});\r\n  }\r\n  if (!debugging.enabled) {\r\n    disableDebugging({hook, logger});\r\n  } else {\r\n    enableDebugging(debugging, {config, hook, logger});\r\n  }\r\n}\r\n\r\nexport function sessionLoader({DEBUG_KEY, storage, config, hook, logger}) {\r\n  let overrides;\r\n  try {\r\n    // eslint-disable-next-line no-restricted-properties\r\n    storage = storage || window.sessionStorage;\r\n    overrides = JSON.parse(storage.getItem(DEBUG_KEY));\r\n  } catch (e) {\r\n  }\r\n  if (overrides) {\r\n    enableDebugging(overrides, {fromSession: true, config, hook, logger});\r\n  }\r\n}\r\n\r\nfunction resetHooks(enable) {\r\n  interceptorHooks.forEach(([getHookFn, interceptor]) => {\r\n    getHookFn().getHooks({hook: interceptor}).remove();\r\n  });\r\n  if (enable) {\r\n    interceptorHooks.forEach(([getHookFn, interceptor]) => {\r\n      getHookFn().before(interceptor);\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerBidInterceptor(getHookFn, interceptor) {\r\n  const interceptBids = (...args) => bidInterceptor.intercept(...args);\r\n  interceptorHooks.push([getHookFn, function (next, ...args) {\r\n    interceptor(next, interceptBids, ...args);\r\n  }]);\r\n}\r\n\r\nexport function bidderBidInterceptor(next, interceptBids, spec, bids, bidRequest, ajax, wrapCallback, cbs) {\r\n  const done = delayExecution(cbs.onCompletion, 2);\r\n  ({bids, bidRequest} = interceptBids({\r\n    bids,\r\n    bidRequest,\r\n    addBid: wrapCallback(cbs.onBid),\r\n    addPaapiConfig: wrapCallback((config, bidRequest) => cbs.onPaapi({bidId: bidRequest.bidId, ...config})),\r\n    done\r\n  }));\r\n  if (bids.length === 0) {\r\n    cbs.onResponse?.({}); // trigger onResponse so that the bidder may be marked as \"timely\" if necessary\r\n    done();\r\n  } else {\r\n    next(spec, bids, bidRequest, ajax, wrapCallback, {...cbs, onCompletion: done});\r\n  }\r\n}\r\n\r\nexport function install({DEBUG_KEY, config, hook, createBid, logger}) {\r\n  bidInterceptor = new BidInterceptor({logger});\r\n  const pbsBidInterceptor = makePbsInterceptor({createBid});\r\n  registerBidInterceptor(() => hook.get('processBidderRequests'), bidderBidInterceptor);\r\n  registerBidInterceptor(() => hook.get('processPBSRequest'), pbsBidInterceptor);\r\n  sessionLoader({DEBUG_KEY, config, hook, logger});\r\n  config.getConfig('debugging', ({debugging}) => getConfig(debugging, {DEBUG_KEY, config, hook, logger}), {init: true});\r\n}\r\n","import {config} from '../../src/config.js';\r\nimport {hook} from '../../src/hook.js';\r\nimport {install} from './debugging.js';\r\nimport {prefixLog} from '../../src/utils.js';\r\nimport {createBid} from '../../src/bidfactory.js';\r\nimport {DEBUG_KEY} from '../../src/debugging.js';\r\n\r\ninstall({DEBUG_KEY, config, hook, createBid, logger: prefixLog('DEBUG:')});\r\n","export let addBidResponseBound;\r\nexport let addBidderRequestsBound;\r\n\r\nexport function addHooks(overrides, {hook, logger}) {\r\n  addBidResponseBound = addBidResponseHook.bind({overrides, logger});\r\n  hook.get('addBidResponse').before(addBidResponseBound, 5);\r\n\r\n  addBidderRequestsBound = addBidderRequestsHook.bind({overrides, logger});\r\n  hook.get('addBidderRequests').before(addBidderRequestsBound, 5);\r\n}\r\n\r\nexport function removeHooks({hook}) {\r\n  hook.get('addBidResponse').getHooks({hook: addBidResponseBound}).remove();\r\n  hook.get('addBidderRequests').getHooks({hook: addBidderRequestsBound}).remove();\r\n}\r\n\r\n/**\r\n * @param {{bidder:string, adUnitCode:string}} overrideObj\r\n * @param {string} bidderCode\r\n * @param {string} adUnitCode\r\n * @returns {boolean}\r\n */\r\nexport function bidExcluded(overrideObj, bidderCode, adUnitCode) {\r\n  if (overrideObj.bidder && overrideObj.bidder !== bidderCode) {\r\n    return true;\r\n  }\r\n  if (overrideObj.adUnitCode && overrideObj.adUnitCode !== adUnitCode) {\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * @param {string[]} bidders\r\n * @param {string} bidderCode\r\n * @returns {boolean}\r\n */\r\nexport function bidderExcluded(bidders, bidderCode) {\r\n  return (Array.isArray(bidders) && bidders.indexOf(bidderCode) === -1);\r\n}\r\n\r\n/**\r\n * @param {Object} overrideObj\r\n * @param {Object} bidObj\r\n * @param {Object} bidType\r\n * @returns {Object} bidObj with overridden properties\r\n */\r\nexport function applyBidOverrides(overrideObj, bidObj, bidType, logger) {\r\n  return Object.keys(overrideObj).filter(key => (['adUnitCode', 'bidder'].indexOf(key) === -1)).reduce(function(result, key) {\r\n    logger.logMessage(`bidder overrides changed '${result.adUnitCode}/${result.bidderCode}' ${bidType}.${key} from '${result[key]}.js' to '${overrideObj[key]}'`);\r\n    result[key] = overrideObj[key];\r\n    result.isDebug = true;\r\n    return result;\r\n  }, bidObj);\r\n}\r\n\r\nexport function addBidResponseHook(next, adUnitCode, bid, reject) {\r\n  const {overrides, logger} = this;\r\n\r\n  if (bidderExcluded(overrides.bidders, bid.bidderCode)) {\r\n    logger.logWarn(`bidder '${bid.bidderCode}' excluded from auction by bidder overrides`);\r\n    return;\r\n  }\r\n\r\n  if (Array.isArray(overrides.bids)) {\r\n    overrides.bids.forEach(function(overrideBid) {\r\n      if (!bidExcluded(overrideBid, bid.bidderCode, adUnitCode)) {\r\n        applyBidOverrides(overrideBid, bid, 'bidder', logger);\r\n      }\r\n    });\r\n  }\r\n\r\n  next(adUnitCode, bid, reject);\r\n}\r\n\r\nexport function addBidderRequestsHook(next, bidderRequests) {\r\n  const {overrides, logger} = this;\r\n\r\n  const includedBidderRequests = bidderRequests.filter(function (bidderRequest) {\r\n    if (bidderExcluded(overrides.bidders, bidderRequest.bidderCode)) {\r\n      logger.logWarn(`bidRequest '${bidderRequest.bidderCode}' excluded from auction by bidder overrides`);\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  if (Array.isArray(overrides.bidRequests)) {\r\n    includedBidderRequests.forEach(function(bidderRequest) {\r\n      overrides.bidRequests.forEach(function(overrideBid) {\r\n        bidderRequest.bids.forEach(function(bid) {\r\n          if (!bidExcluded(overrideBid, bidderRequest.bidderCode, bid.adUnitCode)) {\r\n            applyBidOverrides(overrideBid, bid, 'bidRequest', logger);\r\n          }\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  next(includedBidderRequests);\r\n}\r\n","import {deepClone, delayExecution} from '../../src/utils.js';\r\n\r\nexport function makePbsInterceptor({createBid}) {\r\n  return function pbsBidInterceptor(next, interceptBids, s2sBidRequest, bidRequests, ajax, {\r\n    onResponse,\r\n    onError,\r\n    onBid,\r\n    onFledge,\r\n  }) {\r\n    let responseArgs;\r\n    const done = delayExecution(() => onResponse(...responseArgs), bidRequests.length + 1)\r\n    function signalResponse(...args) {\r\n      responseArgs = args;\r\n      done();\r\n    }\r\n    function addBid(bid, bidRequest) {\r\n      onBid({\r\n        adUnit: bidRequest.adUnitCode,\r\n        bid: Object.assign(createBid(bidRequest), {requestBidder: bidRequest.bidder}, bid)\r\n      })\r\n    }\r\n    bidRequests = bidRequests\r\n      .map((req) => interceptBids({\r\n        bidRequest: req,\r\n        addBid,\r\n        addPaapiConfig(config, bidRequest, bidderRequest) {\r\n          onFledge({\r\n            adUnitCode: bidRequest.adUnitCode,\r\n            ortb2: bidderRequest.ortb2,\r\n            ortb2Imp: bidRequest.ortb2Imp,\r\n            ...config\r\n          })\r\n        },\r\n        done\r\n      }).bidRequest)\r\n      .filter((req) => req.bids.length > 0)\r\n\r\n    if (bidRequests.length > 0) {\r\n      const bidIds = new Set();\r\n      bidRequests.forEach((req) => req.bids.forEach((bid) => bidIds.add(bid.bidId)));\r\n      s2sBidRequest = deepClone(s2sBidRequest);\r\n      s2sBidRequest.ad_units.forEach((unit) => {\r\n        unit.bids = unit.bids.filter((bid) => bidIds.has(bid.bid_id));\r\n      })\r\n      s2sBidRequest.ad_units = s2sBidRequest.ad_units.filter((unit) => unit.bids.length > 0);\r\n      next(s2sBidRequest, bidRequests, ajax, {onResponse: signalResponse, onError, onBid});\r\n    } else {\r\n      signalResponse(true, []);\r\n    }\r\n  }\r\n}\r\n","import {BANNER, NATIVE, VIDEO} from '../../src/mediaTypes.js';\r\nimport {Renderer} from '../../src/Renderer.js';\r\nimport {getGptSlotInfoForAdUnitCode} from '../../libraries/gptUtils/gptUtils.js';\r\n\r\nconst ORTB_NATIVE_ASSET_TYPES = ['img', 'video', 'link', 'data', 'title'];\r\n\r\nexport default {\r\n  [BANNER]: (bid, bidResponse) => {\r\n    if (!bidResponse.hasOwnProperty('ad') && !bidResponse.hasOwnProperty('adUrl')) {\r\n      let [size, repeat] = (bidResponse.width ?? bidResponse.wratio) < (bidResponse.height ?? bidResponse.hratio) ? [bidResponse.width, 'repeat-y'] : [bidResponse.height, 'repeat-x'];\r\n      size = size == null ? '100%' : `${size}px`;\r\n      bidResponse.ad = `<html><body><div style=\"display: inline-block; height: ${bidResponse.height == null ? '100%' : bidResponse.height + 'px'}; width: ${bidResponse.width == null ? '100%' : bidResponse.width + 'px'}; background-image: url(https://vcdn.adnxs.com/p/creative-image/27/c0/52/67/27c05267-5a6d-4874-834e-18e218493c32.png); background-size: ${size}; background-repeat: ${repeat}\"></div></body></html>`;\r\n    }\r\n  },\r\n  [VIDEO]: (bid, bidResponse) => {\r\n    if (!bidResponse.hasOwnProperty('vastXml') && !bidResponse.hasOwnProperty('vastUrl')) {\r\n      bidResponse.vastXml = '<?xml version=\"1.0\" encoding=\"UTF-8\"?><VAST version=\"3.0\"><Ad><InLine><AdSystem>GDFP</AdSystem><AdTitle>Demo</AdTitle><Description><![CDATA[Demo]]></Description><Creatives><Creative><Linear ><Duration>00:00:11</Duration><VideoClicks><ClickThrough><![CDATA[https://prebid.org/]]></ClickThrough></VideoClicks><MediaFiles><MediaFile delivery=\"progressive\" width=\"640\" height=\"360\" type=\"video/mp4\" scalable=\"true\" maintainAspectRatio=\"true\"><![CDATA[https://s3.amazonaws.com/files.prebid.org/creatives/PrebidLogo.mp4]]></MediaFile></MediaFiles></Linear></Creative></Creatives></InLine></Ad></VAST>';\r\n      bidResponse.renderer = Renderer.install({\r\n        url: 'https://cdn.jwplayer.com/libraries/l5MchIxB.js',\r\n      });\r\n      bidResponse.renderer.setRender(function (bid, doc) {\r\n        const parentId = getGptSlotInfoForAdUnitCode(bid.adUnitCode).divId ?? bid.adUnitCode;\r\n        const div = doc.createElement('div');\r\n        div.id = `${parentId}-video-player`;\r\n        doc.getElementById(parentId).appendChild(div);\r\n        const player = window.jwplayer(div.id).setup({\r\n          debug: true,\r\n          width: bidResponse.width,\r\n          height: bidResponse.height,\r\n          advertising: {\r\n            client: 'vast',\r\n            outstream: true,\r\n            endstate: 'close'\r\n          },\r\n        });\r\n        player.on('ready', async function () {\r\n          if (bid.vastUrl) {\r\n            player.loadAdTag(bid.vastUrl);\r\n          } else {\r\n            player.loadAdXml(bid.vastXml);\r\n          }\r\n        });\r\n      })\r\n    }\r\n  },\r\n  [NATIVE]: (bid, bidResponse) => {\r\n    if (!bidResponse.hasOwnProperty('native')) {\r\n      bidResponse.native = {\r\n        ortb: {\r\n          link: {\r\n            url: 'https://www.link.example',\r\n            clicktrackers: ['https://impression.example']\r\n          },\r\n          assets: bid.nativeOrtbRequest.assets.map(mapDefaultNativeOrtbAsset)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction mapDefaultNativeOrtbAsset(asset) {\r\n  const assetType = ORTB_NATIVE_ASSET_TYPES.find(type => asset.hasOwnProperty(type));\r\n  switch (assetType) {\r\n    case 'img':\r\n      return {\r\n        ...asset,\r\n        img: {\r\n          type: 3,\r\n          w: 600,\r\n          h: 500,\r\n          url: 'https://vcdn.adnxs.com/p/creative-image/27/c0/52/67/27c05267-5a6d-4874-834e-18e218493c32.png',\r\n        }\r\n      }\r\n    case 'video':\r\n      return {\r\n        ...asset,\r\n        video: {\r\n          vasttag: '<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><VAST version=\\\"3.0\\\"><Ad><InLine><AdSystem>GDFP</AdSystem><AdTitle>Demo</AdTitle><Description><![CDATA[Demo]]></Description><Creatives><Creative><Linear ><Duration>00:00:11</Duration><VideoClicks><ClickThrough><![CDATA[https://prebid.org/]]></ClickThrough></VideoClicks><MediaFiles><MediaFile delivery=\\\"progressive\\\" width=\\\"640\\\" height=\\\"360\\\" type=\\\"video/mp4\\\" scalable=\\\"true\\\" maintainAspectRatio=\\\"true\\\"><![CDATA[https://s3.amazonaws.com/files.prebid.org/creatives/PrebidLogo.mp4]]></MediaFile></MediaFiles></Linear></Creative></Creatives></InLine></Ad></VAST>'\r\n        }\r\n      }\r\n    case 'data': {\r\n      return {\r\n        ...asset,\r\n        data: {\r\n          value: '5 stars'\r\n        }\r\n      }\r\n    }\r\n    case 'title': {\r\n      return {\r\n        ...asset,\r\n        title: {\r\n          text: 'Prebid Native Example'\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","/* eslint prebid/validate-imports: \"off\" */\r\nimport {registerVideoSupport} from '../src/adServerManager.js';\r\nimport {buildGamVideoUrl, getVastXml, notifyTranslationModule, dep, VAST_TAG_URI_TAGNAME, getBase64BlobContent} from './gamAdServerVideo.js';\r\n\r\nexport const buildDfpVideoUrl = buildGamVideoUrl;\r\nexport { getVastXml, notifyTranslationModule, dep, VAST_TAG_URI_TAGNAME, getBase64BlobContent };\r\n\r\nregisterVideoSupport('dfp', {\r\n  buildVideoUrl: buildDfpVideoUrl,\r\n  getVastXml\r\n});\r\n","/**\r\n * This module adds [GAM support]{@link https://www.doubleclickbygoogle.com/} for Video to Prebid.\r\n */\r\n\r\nimport { getSignals } from '../libraries/gptUtils/gptUtils.js';\r\nimport { registerVideoSupport } from '../src/adServerManager.js';\r\nimport { getPPID } from '../src/adserver.js';\r\nimport { auctionManager } from '../src/auctionManager.js';\r\nimport { config } from '../src/config.js';\r\nimport { EVENTS } from '../src/constants.js';\r\nimport * as events from '../src/events.js';\r\nimport { getHook } from '../src/hook.js';\r\nimport { getRefererInfo } from '../src/refererDetection.js';\r\nimport { targeting } from '../src/targeting.js';\r\nimport {\r\n  buildUrl,\r\n  formatQS,\r\n  isEmpty,\r\n  isNumber,\r\n  logError,\r\n  logWarn,\r\n  parseSizesInput,\r\n  parseUrl\r\n} from '../src/utils.js';\r\nimport {DEFAULT_GAM_PARAMS, GAM_ENDPOINT, gdprParams} from '../libraries/gamUtils/gamUtils.js';\r\nimport { vastLocalCache } from '../src/videoCache.js';\r\nimport { fetch } from '../src/ajax.js';\r\nimport XMLUtil from '../libraries/xmlUtils/xmlUtils.js';\r\n/**\r\n * @typedef {Object} DfpVideoParams\r\n *\r\n * This object contains the params needed to form a URL which hits the\r\n * [DFP API]{@link https://support.google.com/dfp_premium/answer/1068325?hl=en}.\r\n *\r\n * All params (except iu, mentioned below) should be considered optional. This module will choose reasonable\r\n * defaults for all of the other required params.\r\n *\r\n * The cust_params property, if present, must be an object. It will be merged with the rest of the\r\n * standard Prebid targeting params (hb_adid, hb_bidder, etc).\r\n *\r\n * @param {string} iu This param *must* be included, in order for us to create a valid request.\r\n * @param [string] description_url This field is required if you want Ad Exchange to bid on our ad unit...\r\n *   but otherwise optional\r\n */\r\n\r\n/**\r\n * @typedef {Object} DfpVideoOptions\r\n *\r\n * @param {Object} adUnit The adUnit which this bid is supposed to help fill.\r\n * @param [Object] bid The bid which should be considered alongside the rest of the adserver's demand.\r\n *   If this isn't defined, then we'll use the winning bid for the adUnit.\r\n *\r\n * @param {DfpVideoParams} [params] Query params which should be set on the DFP request.\r\n *   These will override this module's defaults whenever they conflict.\r\n * @param {string} [url] video adserver url\r\n */\r\n\r\nexport const dep = {\r\n  ri: getRefererInfo\r\n}\r\n\r\nexport const VAST_TAG_URI_TAGNAME = 'VASTAdTagURI';\r\n\r\n/**\r\n * Merge all the bid data and publisher-supplied options into a single URL, and then return it.\r\n *\r\n * @see [The DFP API]{@link https://support.google.com/dfp_premium/answer/1068325?hl=en#env} for details.\r\n *\r\n * @param {DfpVideoOptions} options Options which should be used to construct the URL.\r\n *\r\n * @return {string} A URL which calls DFP, letting options.bid\r\n *   (or the auction's winning bid for this adUnit, if undefined) compete alongside the rest of the\r\n *   demand in DFP.\r\n */\r\nexport function buildGamVideoUrl(options) {\r\n  if (!options.params && !options.url) {\r\n    logError(`A params object or a url is required to use $$PREBID_GLOBAL$$.adServers.gam.buildVideoUrl`);\r\n    return;\r\n  }\r\n\r\n  const adUnit = options.adUnit;\r\n  const bid = options.bid || targeting.getWinningBids(adUnit.code)[0];\r\n\r\n  let urlComponents = {};\r\n\r\n  if (options.url) {\r\n    // when both `url` and `params` are given, parsed url will be overwriten\r\n    // with any matching param components\r\n    urlComponents = parseUrl(options.url, {noDecodeWholeURL: true});\r\n\r\n    if (isEmpty(options.params)) {\r\n      return buildUrlFromAdserverUrlComponents(urlComponents, bid, options);\r\n    }\r\n  }\r\n\r\n  const derivedParams = {\r\n    correlator: Date.now(),\r\n    sz: parseSizesInput(adUnit?.mediaTypes?.video?.playerSize).join('|'),\r\n    url: encodeURIComponent(location.href),\r\n  };\r\n\r\n  const urlSearchComponent = urlComponents.search;\r\n  const urlSzParam = urlSearchComponent && urlSearchComponent.sz;\r\n  if (urlSzParam) {\r\n    derivedParams.sz = urlSzParam + '|' + derivedParams.sz;\r\n  }\r\n\r\n  const encodedCustomParams = getCustParams(bid, options, urlSearchComponent && urlSearchComponent.cust_params);\r\n\r\n  const queryParams = Object.assign({},\r\n    DEFAULT_GAM_PARAMS,\r\n    urlComponents.search,\r\n    derivedParams,\r\n    options.params,\r\n    { cust_params: encodedCustomParams },\r\n    gdprParams()\r\n  );\r\n\r\n  const descriptionUrl = getDescriptionUrl(bid, options, 'params');\r\n  if (descriptionUrl) { queryParams.description_url = descriptionUrl; }\r\n\r\n  if (!queryParams.ppid) {\r\n    const ppid = getPPID();\r\n    if (ppid != null) {\r\n      queryParams.ppid = ppid;\r\n    }\r\n  }\r\n\r\n  const video = options.adUnit?.mediaTypes?.video;\r\n  Object.entries({\r\n    plcmt: () => video?.plcmt,\r\n    min_ad_duration: () => isNumber(video?.minduration) ? video.minduration * 1000 : null,\r\n    max_ad_duration: () => isNumber(video?.maxduration) ? video.maxduration * 1000 : null,\r\n    vpos() {\r\n      const startdelay = video?.startdelay;\r\n      if (isNumber(startdelay)) {\r\n        if (startdelay === -2) return 'postroll';\r\n        if (startdelay === -1 || startdelay > 0) return 'midroll';\r\n        return 'preroll';\r\n      }\r\n    },\r\n    vconp: () => Array.isArray(video?.playbackmethod) && video.playbackmethod.some(m => m === 7) ? '2' : undefined,\r\n    vpa() {\r\n      // playbackmethod = 3 is play on click; 1, 2, 4, 5, 6 are autoplay\r\n      if (Array.isArray(video?.playbackmethod)) {\r\n        const click = video.playbackmethod.some(m => m === 3);\r\n        const auto = video.playbackmethod.some(m => [1, 2, 4, 5, 6].includes(m));\r\n        if (click && !auto) return 'click';\r\n        if (auto && !click) return 'auto';\r\n      }\r\n    },\r\n    vpmute() {\r\n      // playbackmethod = 2, 6 are muted; 1, 3, 4, 5 are not\r\n      if (Array.isArray(video?.playbackmethod)) {\r\n        const muted = video.playbackmethod.some(m => [2, 6].includes(m));\r\n        const talkie = video.playbackmethod.some(m => [1, 3, 4, 5].includes(m));\r\n        if (muted && !talkie) return '1';\r\n        if (talkie && !muted) return '0';\r\n      }\r\n    }\r\n  }).forEach(([param, getter]) => {\r\n    if (!queryParams.hasOwnProperty(param)) {\r\n      const val = getter();\r\n      if (val != null) {\r\n        queryParams[param] = val;\r\n      }\r\n    }\r\n  });\r\n  const fpd = auctionManager.index.getBidRequest(options.bid || {})?.ortb2 ??\r\n    auctionManager.index.getAuction(options.bid || {})?.getFPD()?.global;\r\n\r\n  const signals = getSignals(fpd);\r\n\r\n  if (signals.length) {\r\n    queryParams.ppsj = btoa(JSON.stringify({\r\n      PublisherProvidedTaxonomySignals: signals\r\n    }))\r\n  }\r\n\r\n  return buildUrl(Object.assign({}, GAM_ENDPOINT, urlComponents, { search: queryParams }));\r\n}\r\n\r\nexport function notifyTranslationModule(fn) {\r\n  fn.call(this, 'dfp');\r\n}\r\n\r\nif (config.getConfig('brandCategoryTranslation.translationFile')) { getHook('registerAdserver').before(notifyTranslationModule); }\r\n\r\n/**\r\n * Builds a video url from a base dfp video url and a winning bid, appending\r\n * Prebid-specific key-values.\r\n * @param {Object} components base video adserver url parsed into components object\r\n * @param {Object} bid winning bid object to append parameters from\r\n * @param {Object} options Options which should be used to construct the URL (used for custom params).\r\n * @return {string} video url\r\n */\r\nfunction buildUrlFromAdserverUrlComponents(components, bid, options) {\r\n  const descriptionUrl = getDescriptionUrl(bid, components, 'search');\r\n  if (descriptionUrl) {\r\n    components.search.description_url = descriptionUrl;\r\n  }\r\n\r\n  components.search.cust_params = getCustParams(bid, options, components.search.cust_params);\r\n  return buildUrl(components);\r\n}\r\n\r\n/**\r\n * Returns the encoded vast url if it exists on a bid object, only if prebid-cache\r\n * is disabled, and description_url is not already set on a given input\r\n * @param {Object} bid object to check for vast url\r\n * @param {Object} components the object to check that description_url is NOT set on\r\n * @param {string} prop the property of components that would contain description_url\r\n * @return {string | undefined} The encoded vast url if it exists, or undefined\r\n */\r\nfunction getDescriptionUrl(bid, components, prop) {\r\n  return components?.[prop]?.description_url || encodeURIComponent(dep.ri().page);\r\n}\r\n\r\n/**\r\n * Returns the encoded `cust_params` from the bid.adserverTargeting and adds the `hb_uuid`, and `hb_cache_id`. Optionally the options.params.cust_params\r\n * @param {Object} bid\r\n * @param {Object} options this is the options passed in from the `buildGamVideoUrl` function\r\n * @return {Object} Encoded key value pairs for cust_params\r\n */\r\nfunction getCustParams(bid, options, urlCustParams) {\r\n  const adserverTargeting = (bid && bid.adserverTargeting) || {};\r\n\r\n  let allTargetingData = {};\r\n  const adUnit = options && options.adUnit;\r\n  if (adUnit) {\r\n    const allTargeting = targeting.getAllTargeting(adUnit.code);\r\n    allTargetingData = (allTargeting) ? allTargeting[adUnit.code] : {};\r\n  }\r\n\r\n  const prebidTargetingSet = Object.assign({},\r\n    // Why are we adding standard keys here ? Refer https://github.com/prebid/Prebid.js/issues/3664\r\n    { hb_uuid: bid && bid.videoCacheKey },\r\n    // hb_cache_id became optional in prebid 5.0 after 4.x enabled the concept of optional keys. Discussion led to reversing the prior expectation of deprecating hb_uuid\r\n    { hb_cache_id: bid && bid.videoCacheKey },\r\n    allTargetingData,\r\n    adserverTargeting,\r\n  );\r\n\r\n  // TODO: WTF is this? just firing random events, guessing at the argument, hoping noone notices?\r\n  events.emit(EVENTS.SET_TARGETING, {[adUnit.code]: prebidTargetingSet});\r\n\r\n  // merge the prebid + publisher targeting sets\r\n  const publisherTargetingSet = options?.params?.cust_params;\r\n  const targetingSet = Object.assign({}, prebidTargetingSet, publisherTargetingSet);\r\n  let encodedParams = encodeURIComponent(formatQS(targetingSet));\r\n  if (urlCustParams) {\r\n    encodedParams = urlCustParams + '%26' + encodedParams;\r\n  }\r\n\r\n  return encodedParams;\r\n}\r\n\r\nasync function getVastForLocallyCachedBids(gamVastWrapper, localCacheMap) {\r\n  try {\r\n    const xmlUtil = XMLUtil();\r\n    const xmlDoc = xmlUtil.parse(gamVastWrapper);\r\n    const vastAdTagUriElement = xmlDoc.querySelectorAll(VAST_TAG_URI_TAGNAME)[0];\r\n\r\n    if (!vastAdTagUriElement || !vastAdTagUriElement.textContent) {\r\n      return gamVastWrapper;\r\n    }\r\n\r\n    const uuidExp = new RegExp(`[A-Fa-f0-9]{8}-(?:[A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}`, 'gi');\r\n    const matchResult = Array.from(vastAdTagUriElement.textContent.matchAll(uuidExp));\r\n    const uuidCandidates = matchResult\r\n      .map(([uuid]) => uuid)\r\n      .filter(uuid => localCacheMap.has(uuid));\r\n\r\n    if (uuidCandidates.length != 1) {\r\n      logWarn(`Unable to determine unique uuid in ${VAST_TAG_URI_TAGNAME}`);\r\n      return gamVastWrapper;\r\n    }\r\n    const uuid = uuidCandidates[0];\r\n\r\n    const blobUrl = localCacheMap.get(uuid);\r\n    const base64BlobContent = await getBase64BlobContent(blobUrl);\r\n    const cdata = xmlDoc.createCDATASection(base64BlobContent);\r\n    vastAdTagUriElement.textContent = '';\r\n    vastAdTagUriElement.appendChild(cdata);\r\n    return xmlUtil.serialize(xmlDoc);\r\n  } catch (error) {\r\n    logWarn('Unable to process xml', error);\r\n    return gamVastWrapper;\r\n  }\r\n};\r\n\r\nexport async function getVastXml(options, localCacheMap = vastLocalCache) {\r\n  const vastUrl = buildGamVideoUrl(options);\r\n  const response = await fetch(vastUrl);\r\n  if (!response.ok) {\r\n    throw new Error('Unable to fetch GAM VAST wrapper');\r\n  }\r\n\r\n  const gamVastWrapper = await response.text();\r\n\r\n  if (config.getConfig('cache.useLocal')) {\r\n    const vastXml = await getVastForLocallyCachedBids(gamVastWrapper, localCacheMap);\r\n    return vastXml;\r\n  }\r\n\r\n  return gamVastWrapper;\r\n}\r\n\r\nexport async function getBase64BlobContent(blobUrl) {\r\n  const response = await fetch(blobUrl);\r\n  if (!response.ok) {\r\n    logError('Unable to fetch blob');\r\n    throw new Error('Blob not found');\r\n  }\r\n  // Mechanism to handle cases where VAST tags are fetched\r\n  // from a context where the blob resource is not accessible.\r\n  // like IMA SDK iframe\r\n  const blobContent = await response.text();\r\n  const dataUrl = `data://text/xml;base64,${btoa(blobContent)}`;\r\n  return dataUrl;\r\n}\r\n\r\nexport { buildGamVideoUrl as buildDfpVideoUrl };\r\n\r\nregisterVideoSupport('gam', {\r\n  buildVideoUrl: buildGamVideoUrl,\r\n  getVastXml\r\n});\r\n","import {config} from '../src/config.js';\r\nimport {setupRules} from '../libraries/mspa/activityControls.js';\r\n\r\nlet setupDone = false;\r\n\r\nconfig.getConfig('consentManagement', (cfg) => {\r\n  if (cfg?.consentManagement?.gpp != null && !setupDone) {\r\n    setupRules('usnat', [7]);\r\n    setupDone = true;\r\n  }\r\n})\r\n","import {config} from '../src/config.js';\r\nimport {setupRules} from '../libraries/mspa/activityControls.js';\r\nimport {deepSetValue, prefixLog} from '../src/utils.js';\r\n\r\nconst FIELDS = {\r\n  Version: 0,\r\n  Gpc: 0,\r\n  SharingNotice: 0,\r\n  SaleOptOutNotice: 0,\r\n  SharingOptOutNotice: 0,\r\n  TargetedAdvertisingOptOutNotice: 0,\r\n  SensitiveDataProcessingOptOutNotice: 0,\r\n  SensitiveDataLimitUseNotice: 0,\r\n  SaleOptOut: 0,\r\n  SharingOptOut: 0,\r\n  TargetedAdvertisingOptOut: 0,\r\n  SensitiveDataProcessing: 12,\r\n  KnownChildSensitiveDataConsents: 2,\r\n  PersonalDataConsents: 0,\r\n  MspaCoveredTransaction: 0,\r\n  MspaOptOutOptionMode: 0,\r\n  MspaServiceProviderMode: 0,\r\n};\r\n\r\n/**\r\n * Generate a normalization function for converting US state strings to the usnat format.\r\n *\r\n * Scalar fields are copied over if they exist in the input (state) data, or set to null otherwise.\r\n * List fields are also copied, but forced to the \"correct\" length (by truncating or padding with nulls);\r\n * additionally, elements within them can be moved around using the `move` argument.\r\n */\r\nexport function normalizer({nullify = [], move = {}, fn}: {\r\n  /**\r\n   * list of fields to force to null\r\n   */\r\n  nullify?: string[];\r\n  /**\r\n   * Map from list field name to an index remapping for elements within that field (using 1 as the first index).\r\n   * For example, {SensitiveDataProcessing: {1: 2, 2: [1, 3]}} means \"rearrange SensitiveDataProcessing by moving\r\n   * the first element to the second position, and the second element to both the first and third position.\"\r\n   */\r\n  move?: { [name: string]: { [position: number]: number | number[] } };\r\n  /**\r\n   * an optional function to run once all the processing described above is complete;\r\n   * it's passed two arguments, the original (state) data, and its normalized (usnat) version.\r\n   */\r\n  fn?: (original, normalized) => any;\r\n}, fields = FIELDS) {\r\n  move = Object.fromEntries(Object.entries(move).map(([k, map]) => [k,\r\n    Object.fromEntries(Object.entries(map)\r\n      .map(([k, v]) => [k, Array.isArray(v) ? v : [v]])\r\n      .map(([k, v]: [any, any]) => [--k, v.map(el => --el)])\r\n    )])\r\n  );\r\n  return function (cd) {\r\n    const norm = Object.fromEntries(Object.entries(fields)\r\n      .map(([field, len]) => {\r\n        let val = null;\r\n        if (len > 0) {\r\n          val = Array(len).fill(null);\r\n          if (Array.isArray(cd[field])) {\r\n            const remap = (move[field] || {}) as Record<number, number[]>;\r\n            const done = [];\r\n            cd[field].forEach((el, i) => {\r\n              const [dest, moved] = remap.hasOwnProperty(i) ? [remap[i], true] : [[i], false];\r\n              dest.forEach(d => {\r\n                if (d < len && !done.includes(d)) {\r\n                  val[d] = el;\r\n                  moved && done.push(d);\r\n                }\r\n              });\r\n            });\r\n          }\r\n        } else if (cd[field] != null) {\r\n          val = Array.isArray(cd[field]) ? null : cd[field];\r\n        }\r\n        return [field, val];\r\n      }));\r\n    nullify.forEach(path => deepSetValue(norm, path, null));\r\n    fn && fn(cd, norm);\r\n    return norm;\r\n  };\r\n}\r\n\r\nfunction scalarMinorsAreChildren(original, normalized) {\r\n  normalized.KnownChildSensitiveDataConsents = original.KnownChildSensitiveDataConsents === 0 ? [0, 0] : [1, 1];\r\n}\r\n\r\nexport const NORMALIZATIONS = {\r\n  // normalization rules - convert state consent into usnat consent\r\n  // https://docs.prebid.org/features/mspa-usnat.html\r\n  7: (consent) => consent,\r\n  8: normalizer({\r\n    move: {\r\n      SensitiveDataProcessing: {\r\n        1: 9,\r\n        2: 10,\r\n        3: 8,\r\n        4: [1, 2],\r\n        5: 12,\r\n        8: 3,\r\n        9: 4,\r\n      }\r\n    },\r\n    fn(original, normalized) {\r\n      if (original.KnownChildSensitiveDataConsents.some(el => el !== 0)) {\r\n        normalized.KnownChildSensitiveDataConsents = [1, 1];\r\n      }\r\n    }\r\n  }),\r\n  9: normalizer({fn: scalarMinorsAreChildren}),\r\n  10: normalizer({fn: scalarMinorsAreChildren}),\r\n  11: normalizer({\r\n    move: {\r\n      SensitiveDataProcessing: {\r\n        3: 4,\r\n        4: 5,\r\n        5: 3,\r\n      }\r\n    },\r\n    fn: scalarMinorsAreChildren\r\n  }),\r\n  12: normalizer({\r\n    fn(original, normalized) {\r\n      const cc = original.KnownChildSensitiveDataConsents;\r\n      let repl;\r\n      if (!cc.some(el => el !== 0)) {\r\n        repl = [0, 0];\r\n      } else if (cc[1] === 2 && cc[2] === 2) {\r\n        repl = [2, 1];\r\n      } else {\r\n        repl = [1, 1];\r\n      }\r\n      normalized.KnownChildSensitiveDataConsents = repl;\r\n    }\r\n  })\r\n};\r\n\r\nexport const DEFAULT_SID_MAPPING = {\r\n  8: 'usca',\r\n  9: 'usva',\r\n  10: 'usco',\r\n  11: 'usut',\r\n  12: 'usct'\r\n};\r\n\r\nexport const getSections = (() => {\r\n  const allSIDs = Object.keys(DEFAULT_SID_MAPPING).map(Number);\r\n  return function ({sections = {}, sids = allSIDs} = {}) {\r\n    return sids.map(sid => {\r\n      const logger = prefixLog(`Cannot set up MSPA controls for SID ${sid}:`);\r\n      const ov = sections[sid] || {};\r\n      const normalizeAs = ov.normalizeAs || sid;\r\n      if (!NORMALIZATIONS.hasOwnProperty(normalizeAs)) {\r\n        logger.logError(`no normalization rules are known for SID ${normalizeAs}`)\r\n        return;\r\n      }\r\n      const api = ov.name || DEFAULT_SID_MAPPING[sid];\r\n      if (typeof api !== 'string') {\r\n        logger.logError(`cannot determine GPP section name`)\r\n        return;\r\n      }\r\n      return [\r\n        api,\r\n        [sid],\r\n        NORMALIZATIONS[normalizeAs]\r\n      ]\r\n    }).filter(el => el != null);\r\n  }\r\n})();\r\n\r\nconst handles = [];\r\n\r\ndeclare module './consentManagementGpp' {\r\n  interface GPPConfig {\r\n    mspa?: {\r\n      /**\r\n       * GPP SIDs that should be covered by activity restrictions. Defaults to all US state SIDs.\r\n       */\r\n      sids?: number[];\r\n      /**\r\n       * Map from section ID to per-section configuration options\r\n       */\r\n      sections?: {\r\n        [sid: number]: {\r\n          /**\r\n           * GPP API name to use for the section. Defaults to the names listed in the GPP spec:\r\n           * https://github.com/InteractiveAdvertisingBureau/Global-Privacy-Platform/blob/main/Sections/Section%20Information.md#section-ids\r\n           * This option would only be used if your CMP has named their sections in a non-standard way.y\r\n           */\r\n          name?: string;\r\n          /**\r\n           * Normalize the flags for this section as if it were the number provided.\r\n           * Cfr https://docs.prebid.org/features/mspa-usnat.html#interpreting-usnat-strings\r\n           * Each section defaults to its own ID.\r\n           */\r\n          normalizeAs?: number;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconfig.getConfig('consentManagement', (cfg) => {\r\n  const gppConf = cfg.consentManagement?.gpp;\r\n  if (gppConf) {\r\n    while (handles.length) {\r\n      handles.pop()();\r\n    }\r\n    getSections(gppConf?.mspa || {})\r\n      .forEach(([api, sids, normalize]) => handles.push(setupRules(api, sids, normalize)));\r\n  }\r\n});\r\n","import { getSignals as getSignalsFn, getSegments as getSegmentsFn, taxonomies } from '../libraries/gptUtils/gptUtils.js';\r\nimport { auctionManager } from '../src/auctionManager.js';\r\nimport { config } from '../src/config.js';\r\nimport { TARGETING_KEYS } from '../src/constants.js';\r\nimport { getHook } from '../src/hook.js';\r\nimport {\r\n  deepAccess,\r\n  deepSetValue,\r\n  isAdUnitCodeMatchingSlot,\r\n  isGptPubadsDefined,\r\n  logInfo,\r\n  logWarn,\r\n  pick,\r\n  uniques\r\n} from '../src/utils.js';\r\nimport type {SlotMatchingFn} from '../src/targeting.ts';\r\nimport type {AdUnitCode} from '../src/types/common.d.ts';\r\nimport type {AdUnit} from '../src/adUnits.ts';\r\n\r\nconst MODULE_NAME = 'GPT Pre-Auction';\r\nexport let _currentConfig: any = {};\r\nlet hooksAdded = false;\r\n\r\nexport function getSegments(fpd, sections, segtax) {\r\n  return getSegmentsFn(fpd, sections, segtax);\r\n}\r\n\r\nexport function getSignals(fpd) {\r\n  return getSignalsFn(fpd);\r\n}\r\n\r\nexport function getSignalsArrayByAuctionsIds(auctionIds, index = auctionManager.index) {\r\n  const signals = auctionIds\r\n    .map(auctionId => index.getAuction({ auctionId })?.getFPD()?.global)\r\n    .map(getSignals)\r\n    .filter(fpd => fpd);\r\n\r\n  return signals;\r\n}\r\n\r\nexport function getSignalsIntersection(signals) {\r\n  const result = {};\r\n  taxonomies.forEach((taxonomy) => {\r\n    const allValues = signals\r\n      .flatMap(x => x)\r\n      .filter(x => x.taxonomy === taxonomy)\r\n      .map(x => x.values);\r\n    result[taxonomy] = allValues.length ? (\r\n      allValues.reduce((commonElements, subArray) => {\r\n        return commonElements.filter(element => subArray.includes(element));\r\n      })\r\n    ) : []\r\n    result[taxonomy] = { values: result[taxonomy] };\r\n  })\r\n  return result;\r\n}\r\n\r\nexport function getAuctionsIdsFromTargeting(targeting, am = auctionManager) {\r\n  return Object.values(targeting)\r\n    .flatMap(x => Object.entries(x))\r\n    .filter((entry) => entry[0] === TARGETING_KEYS.AD_ID || entry[0].startsWith(TARGETING_KEYS.AD_ID + '_'))\r\n    .flatMap(entry => entry[1])\r\n    .map(adId => am.findBidByAdId(adId)?.auctionId)\r\n    .filter(id => id != null)\r\n    .filter(uniques);\r\n}\r\n\r\nexport const appendGptSlots = adUnits => {\r\n  const { customGptSlotMatching } = _currentConfig;\r\n\r\n  if (!isGptPubadsDefined()) {\r\n    return;\r\n  }\r\n\r\n  const adUnitMap = adUnits.reduce((acc, adUnit) => {\r\n    acc[adUnit.code] = acc[adUnit.code] || [];\r\n    acc[adUnit.code].push(adUnit);\r\n    return acc;\r\n  }, {});\r\n\r\n  const adUnitPaths = {};\r\n\r\n  window.googletag.pubads().getSlots().forEach((slot: googletag.Slot) => {\r\n    const matchingAdUnitCode = Object.keys(adUnitMap).find(customGptSlotMatching\r\n      ? customGptSlotMatching(slot)\r\n      : isAdUnitCodeMatchingSlot(slot));\r\n\r\n    if (matchingAdUnitCode) {\r\n      const path = adUnitPaths[matchingAdUnitCode] = slot.getAdUnitPath();\r\n      const adserver = {\r\n        name: 'gam',\r\n        adslot: sanitizeSlotPath(path)\r\n      };\r\n      adUnitMap[matchingAdUnitCode].forEach((adUnit) => {\r\n        deepSetValue(adUnit, 'ortb2Imp.ext.data.adserver', Object.assign({}, adUnit.ortb2Imp?.ext?.data?.adserver, adserver));\r\n      });\r\n    }\r\n  });\r\n  return adUnitPaths;\r\n};\r\n\r\nconst sanitizeSlotPath = (path) => {\r\n  const gptConfig = config.getConfig('gptPreAuction') || {};\r\n\r\n  if (gptConfig.mcmEnabled) {\r\n    return path.replace(/(^\\/\\d*),\\d*\\//, '$1/');\r\n  }\r\n\r\n  return path;\r\n}\r\n\r\nconst defaultPreAuction = (adUnit, adServerAdSlot, adUnitPath) => {\r\n  // confirm that GPT is set up\r\n  if (!isGptPubadsDefined()) {\r\n    return;\r\n  }\r\n\r\n  // find all GPT slots with this name\r\n  var gptSlots = window.googletag.pubads().getSlots().filter((slot: googletag.Slot) => slot.getAdUnitPath() === adUnitPath);\r\n\r\n  if (gptSlots.length === 0) {\r\n    return; // should never happen\r\n  }\r\n\r\n  if (gptSlots.length === 1) {\r\n    return adServerAdSlot;\r\n  }\r\n\r\n  // else the adunit code must be div id. append it.\r\n  return `${adServerAdSlot}#${adUnit.code}`;\r\n}\r\n\r\nexport const makeBidRequestsHook = (fn, adUnits, ...args) => {\r\n  const adUnitPaths = appendGptSlots(adUnits);\r\n  const { useDefaultPreAuction, customPreAuction } = _currentConfig;\r\n  adUnits.forEach(adUnit => {\r\n    // init the ortb2Imp if not done yet\r\n    adUnit.ortb2Imp = adUnit.ortb2Imp || {};\r\n    adUnit.ortb2Imp.ext = adUnit.ortb2Imp.ext || {};\r\n    adUnit.ortb2Imp.ext.data = adUnit.ortb2Imp.ext.data || {};\r\n    const context = adUnit.ortb2Imp.ext;\r\n\r\n    const adserverSlot = deepAccess(context, 'data.adserver.adslot');\r\n\r\n    // @todo: check if should have precedence over customPreAuction and defaultPreAuction\r\n    if (context.gpid) return;\r\n\r\n    let result;\r\n    if (customPreAuction) {\r\n      result = customPreAuction(adUnit, adserverSlot, adUnitPaths?.[adUnit.code]);\r\n    } else if (useDefaultPreAuction) {\r\n      result = defaultPreAuction(adUnit, adserverSlot, adUnitPaths?.[adUnit.code]);\r\n    } else {\r\n      logWarn('Neither customPreAuction, defaultPreAuction and gpid were specified')\r\n    }\r\n    if (result) {\r\n      context.gpid = result;\r\n    }\r\n  });\r\n  return fn.call(this, adUnits, ...args);\r\n};\r\n\r\nconst setPpsConfigFromTargetingSet = (next, targetingSet) => {\r\n  // set gpt config\r\n  const auctionsIds = getAuctionsIdsFromTargeting(targetingSet);\r\n  const signals = getSignalsIntersection(getSignalsArrayByAuctionsIds(auctionsIds));\r\n  window.googletag.setConfig && window.googletag.setConfig({pps: { taxonomies: signals }});\r\n  next(targetingSet);\r\n};\r\n\r\ntype GPTPreAuctionConfig = {\r\n  /**\r\n   * allows turning off of module. Default value is true\r\n   */\r\n  enabled?: boolean;\r\n  /**\r\n   * If true, use default behavior for determining GPID and PbAdSlot. Defaults to false.\r\n   */\r\n  useDefaultPreAuction?: boolean;\r\n  customGptSlotMatching?: SlotMatchingFn;\r\n  /**\r\n   * @param adUnitCode Ad unit code\r\n   * @param adServerAdSlot The value of that ad unit's `ortb2Imp.ext.data.adserver.adslot`\r\n   * @returns pbadslot for the ad unit\r\n   */\r\n  customPbAdSlot?: (adUnitCode: AdUnitCode, adServerAdSlot: string) => string;\r\n  /**\r\n   * @param adUnit An ad unit object\r\n   * @param adServerAdSlot The value of that ad unit's `ortb2Imp.ext.data.adserver.adslot`\r\n   * @param gptAdUnitPath GPT ad unit path for the slot matching the PBJS ad unit\r\n   * @returns GPID for the ad unit\r\n   */\r\n  customPreAuction?: (adUnit: AdUnit, adServerAdSlot: string, gptAdUnitPath: string) => string;\r\n  /**\r\n   * Removes extra network IDs when Multiple Customer Management is active. Default is false.\r\n   */\r\n  mcmEnabled?: boolean;\r\n}\r\n\r\ndeclare module '../src/config' {\r\n  interface Config {\r\n    gptPreAuction?: GPTPreAuctionConfig;\r\n  }\r\n}\r\n\r\nconst handleSetGptConfig = moduleConfig => {\r\n  _currentConfig = pick(moduleConfig, [\r\n    'enabled', enabled => enabled !== false,\r\n    'customGptSlotMatching', customGptSlotMatching =>\r\n      typeof customGptSlotMatching === 'function' && customGptSlotMatching,\r\n    'customPreAuction', customPreAuction => typeof customPreAuction === 'function' && customPreAuction,\r\n    'useDefaultPreAuction', useDefaultPreAuction => useDefaultPreAuction ?? true,\r\n  ]);\r\n\r\n  if (_currentConfig.enabled) {\r\n    if (!hooksAdded) {\r\n      getHook('makeBidRequests').before(makeBidRequestsHook);\r\n      getHook('targetingDone').after(setPpsConfigFromTargetingSet)\r\n      hooksAdded = true;\r\n    }\r\n  } else {\r\n    logInfo(`${MODULE_NAME}: Turning off module`);\r\n    _currentConfig = {};\r\n    getHook('makeBidRequests').getHooks({hook: makeBidRequestsHook}).remove();\r\n    getHook('targetingDone').getHooks({hook: setPpsConfigFromTargetingSet}).remove();\r\n    hooksAdded = false;\r\n  }\r\n};\r\n\r\nconfig.getConfig('gptPreAuction', config => handleSetGptConfig(config.gptPreAuction));\r\nhandleSetGptConfig({});\r\n","/**\r\n * This module adds IdentityLink to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/identityLinkSubmodule\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport * as utils from '../src/utils.js'\r\nimport { ajax } from '../src/ajax.js';\r\nimport { submodule } from '../src/hook.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {MODULE_TYPE_UID} from '../src/activities/modules.js';\r\n\r\n/**\r\n * @typedef {import('../modules/userId/index.js').Submodule} Submodule\r\n * @typedef {import('../modules/userId/index.js').SubmoduleConfig} SubmoduleConfig\r\n * @typedef {import('../modules/userId/index.js').ConsentData} ConsentData\r\n * @typedef {import('../modules/userId/index.js').IdResponse} IdResponse\r\n */\r\n\r\nconst MODULE_NAME = 'identityLink';\r\n\r\nexport const storage = getStorageManager({moduleType: MODULE_TYPE_UID, moduleName: MODULE_NAME});\r\n\r\nconst liverampEnvelopeName = '_lr_env';\r\n\r\n/** @type {Submodule} */\r\nexport const identityLinkSubmodule = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: MODULE_NAME,\r\n  /**\r\n   * used to specify vendor id\r\n   * @type {number}\r\n   */\r\n  gvlid: 97,\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   * @function\r\n   * @param {string} value\r\n   * @returns {{idl_env:string}}\r\n   */\r\n  decode(value) {\r\n    return { 'idl_env': value }\r\n  },\r\n  /**\r\n   * performs action to obtain id and return a value in the callback's response argument\r\n   * @function\r\n   * @param {SubmoduleConfig} [config]\r\n   * @param {ConsentData} [consentData]\r\n   * @returns {IdResponse|undefined}\r\n   */\r\n  getId(config, consentData) {\r\n    const configParams = (config && config.params) || {};\r\n    if (!configParams || typeof configParams.pid !== 'string') {\r\n      utils.logError('identityLink: requires partner id to be defined');\r\n      return;\r\n    }\r\n    const {gdpr, gpp: gppData} = consentData ?? {};\r\n    const hasGdpr = (gdpr && typeof gdpr.gdprApplies === 'boolean' && gdpr.gdprApplies) ? 1 : 0;\r\n    const gdprConsentString = hasGdpr ? gdpr.consentString : '';\r\n    // use protocol relative urls for http or https\r\n    if (hasGdpr && (!gdprConsentString || gdprConsentString === '')) {\r\n      utils.logInfo('identityLink: Consent string is required to call envelope API.');\r\n      return;\r\n    }\r\n    const gppString = gppData && gppData.gppString ? gppData.gppString : false;\r\n    const gppSectionId = gppData && gppData.gppString && gppData.applicableSections.length > 0 && gppData.applicableSections[0] !== -1 ? gppData.applicableSections[0] : false;\r\n    const hasGpp = gppString && gppSectionId;\r\n    const url = `https://api.rlcdn.com/api/identity/envelope?pid=${configParams.pid}${hasGdpr ? '&ct=4&cv=' + gdprConsentString : ''}${hasGpp ? '&gpp=' + gppString + '&gpp_sid=' + gppSectionId : ''}`;\r\n    let resp;\r\n    resp = function (callback) {\r\n      // Check ats during callback so it has a chance to initialise.\r\n      // If ats library is available, use it to retrieve envelope. If not use standard third party endpoint\r\n      if (window.ats && window.ats.retrieveEnvelope) {\r\n        utils.logInfo('identityLink: ATS exists!');\r\n        window.ats.retrieveEnvelope(function (envelope) {\r\n          if (envelope) {\r\n            utils.logInfo('identityLink: An envelope can be retrieved from ATS!');\r\n            setEnvelopeSource(true);\r\n            callback(JSON.parse(envelope).envelope);\r\n          } else {\r\n            getEnvelope(url, callback, configParams);\r\n          }\r\n        });\r\n      } else {\r\n        // try to get envelope directly from storage if ats lib is not present on a page\r\n        const envelope = getEnvelopeFromStorage();\r\n        if (envelope) {\r\n          utils.logInfo('identityLink: LiveRamp envelope successfully retrieved from storage!');\r\n          callback(JSON.parse(envelope).envelope);\r\n        } else {\r\n          getEnvelope(url, callback, configParams);\r\n        }\r\n      }\r\n    };\r\n\r\n    return { callback: resp };\r\n  },\r\n  eids: {\r\n    'idl_env': {\r\n      source: 'liveramp.com',\r\n      atype: 3\r\n    },\r\n  }\r\n};\r\n// return envelope from third party endpoint\r\nfunction getEnvelope(url, callback, configParams) {\r\n  const callbacks = {\r\n    success: response => {\r\n      let responseObj;\r\n      if (response) {\r\n        try {\r\n          responseObj = JSON.parse(response);\r\n        } catch (error) {\r\n          utils.logInfo(error);\r\n        }\r\n      }\r\n      callback((responseObj && responseObj.envelope) ? responseObj.envelope : '');\r\n    },\r\n    error: error => {\r\n      utils.logInfo(`identityLink: identityLink: ID fetch encountered an error`, error);\r\n      callback();\r\n    }\r\n  };\r\n\r\n  if (!configParams.notUse3P && !storage.getCookie('_lr_retry_request')) {\r\n    setRetryCookie();\r\n    utils.logInfo('identityLink: A 3P retrieval is attempted!');\r\n    setEnvelopeSource(false);\r\n    ajax(url, callbacks, undefined, { method: 'GET', withCredentials: true });\r\n  } else {\r\n    callback()\r\n  }\r\n}\r\n\r\nfunction setRetryCookie() {\r\n  const now = new Date();\r\n  now.setTime(now.getTime() + 3600000);\r\n  storage.setCookie('_lr_retry_request', 'true', now.toUTCString());\r\n}\r\n\r\nfunction setEnvelopeSource(src) {\r\n  const now = new Date();\r\n  now.setTime(now.getTime() + 2592000000);\r\n  storage.setCookie('_lr_env_src_ats', src, now.toUTCString());\r\n}\r\n\r\nexport function getEnvelopeFromStorage() {\r\n  const rawEnvelope = storage.getCookie(liverampEnvelopeName) || storage.getDataFromLocalStorage(liverampEnvelopeName);\r\n  if (!rawEnvelope) {\r\n    return undefined;\r\n  }\r\n  try {\r\n    return window.atob(rawEnvelope);\r\n  } catch (e) {\r\n    try {\r\n      return window.atob(rawEnvelope.replace(/-/g, '+').replace(/_/g, '/'));\r\n    } catch (e2) {\r\n      utils.logError('identityLink: invalid envelope format');\r\n      return undefined;\r\n    }\r\n  }\r\n}\r\n\r\nsubmodule('userId', identityLinkSubmodule);\r\n","import {config} from '../src/config.js';\r\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport * as utils from '../src/utils.js';\r\nimport {mergeDeep} from '../src/utils.js';\r\nimport {BANNER, NATIVE, VIDEO} from '../src/mediaTypes.js';\r\nimport {ortbConverter} from '../libraries/ortbConverter/converter.js';\r\n\r\nconst bidderConfig = 'hb_pb_ortb';\r\nconst bidderVersion = '2.0';\r\nexport const REQUEST_URL = 'https://rtb.openx.net/openrtbb/prebidjs';\r\nexport const SYNC_URL = 'https://u.openx.net/w/1.0/pd';\r\nexport const DEFAULT_PH = '2d1251ae-7f3a-47cf-bd2a-2f288854a0ba';\r\nexport const spec = {\r\n  code: 'openx',\r\n  gvlid: 69,\r\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\r\n  isBidRequestValid,\r\n  buildRequests,\r\n  interpretResponse,\r\n  getUserSyncs\r\n};\r\n\r\nregisterBidder(spec);\r\n\r\nconst converter = ortbConverter({\r\n  context: {\r\n    netRevenue: true,\r\n    ttl: 300,\r\n    nativeRequest: {\r\n      eventtrackers: [\r\n        {event: 1, methods: [1, 2]},\r\n      ]\r\n    }\r\n  },\r\n  imp(buildImp, bidRequest, context) {\r\n    const imp = buildImp(bidRequest, context);\r\n    mergeDeep(imp, {\r\n      tagid: bidRequest.params.unit,\r\n      ext: {\r\n        divid: bidRequest.adUnitCode\r\n      }\r\n    });\r\n    if (bidRequest.params.customParams) {\r\n      utils.deepSetValue(imp, 'ext.customParams', bidRequest.params.customParams);\r\n    }\r\n    if (bidRequest.params.customFloor && !imp.bidfloor) {\r\n      imp.bidfloor = bidRequest.params.customFloor;\r\n    }\r\n    return imp;\r\n  },\r\n  request(buildRequest, imps, bidderRequest, context) {\r\n    const req = buildRequest(imps, bidderRequest, context);\r\n    mergeDeep(req, {\r\n      at: 1,\r\n      ext: {\r\n        bc: `${bidderConfig}_${bidderVersion}`,\r\n        pv: '$prebid.version$'\r\n      }\r\n    })\r\n    const bid = context.bidRequests[0];\r\n    if (bid.params.coppa) {\r\n      utils.deepSetValue(req, 'regs.coppa', 1);\r\n    }\r\n    if (bid.params.doNotTrack) {\r\n      utils.deepSetValue(req, 'device.dnt', 1);\r\n    }\r\n    if (bid.params.platform) {\r\n      utils.deepSetValue(req, 'ext.platform', bid.params.platform);\r\n    }\r\n    if (bid.params.delDomain) {\r\n      utils.deepSetValue(req, 'ext.delDomain', bid.params.delDomain);\r\n    }\r\n    if (bid.params.response_template_name) {\r\n      utils.deepSetValue(req, 'ext.response_template_name', bid.params.response_template_name);\r\n    }\r\n    if (bid.params.test) {\r\n      req.test = 1\r\n    }\r\n    return req;\r\n  },\r\n  bidResponse(buildBidResponse, bid, context) {\r\n    const bidResponse = buildBidResponse(bid, context);\r\n    if (bid.ext) {\r\n      bidResponse.meta.networkId = bid.ext.dsp_id;\r\n      bidResponse.meta.advertiserId = bid.ext.buyer_id;\r\n      bidResponse.meta.brandId = bid.ext.brand_id;\r\n    }\r\n    return bidResponse;\r\n  },\r\n  response(buildResponse, bidResponses, ortbResponse, context) {\r\n    // pass these from request to the responses for use in userSync\r\n    const {ortbRequest} = context;\r\n    if (ortbRequest.ext) {\r\n      if (ortbRequest.ext.delDomain) {\r\n        utils.deepSetValue(ortbResponse, 'ext.delDomain', ortbRequest.ext.delDomain);\r\n      }\r\n      if (ortbRequest.ext.platform) {\r\n        utils.deepSetValue(ortbResponse, 'ext.platform', ortbRequest.ext.platform);\r\n      }\r\n    }\r\n    const response = buildResponse(bidResponses, ortbResponse, context);\r\n    // TODO: we may want to standardize this and move fledge logic to ortbConverter\r\n    let fledgeAuctionConfigs = utils.deepAccess(ortbResponse, 'ext.fledge_auction_configs');\r\n    if (fledgeAuctionConfigs) {\r\n      fledgeAuctionConfigs = Object.entries(fledgeAuctionConfigs).map(([bidId, cfg]) => {\r\n        return {\r\n          bidId,\r\n          config: mergeDeep(Object.assign({}, cfg), {\r\n            auctionSignals: {\r\n              ortb2Imp: context.impContext[bidId]?.imp,\r\n            },\r\n          }),\r\n        }\r\n      });\r\n      return {\r\n        bids: response.bids,\r\n        paapi: fledgeAuctionConfigs,\r\n      }\r\n    } else {\r\n      return response\r\n    }\r\n  },\r\n  overrides: {\r\n    imp: {\r\n      bidfloor(setBidFloor, imp, bidRequest, context) {\r\n        // enforce floors should always be in USD\r\n        // TODO: does it make sense that request.cur can be any currency, but request.imp[].bidfloorcur must be USD?\r\n        const floor = {};\r\n        setBidFloor(floor, bidRequest, {...context, currency: 'USD'});\r\n        if (floor.bidfloorcur === 'USD') {\r\n          Object.assign(imp, floor);\r\n        }\r\n      },\r\n      video(orig, imp, bidRequest, context) {\r\n        if (FEATURES.VIDEO) {\r\n          // `orig` is the video imp processor, which looks at bidRequest.mediaTypes[VIDEO]\r\n          // to populate imp.video\r\n          // alter its input `bidRequest` to also pick up parameters from `bidRequest.params`\r\n          let videoParams = bidRequest.mediaTypes[VIDEO];\r\n          if (videoParams) {\r\n            videoParams = Object.assign({}, videoParams, bidRequest.params.video);\r\n            bidRequest = {...bidRequest, mediaTypes: {[VIDEO]: videoParams}}\r\n          }\r\n          orig(imp, bidRequest, context);\r\n        }\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nfunction isBidRequestValid(bidRequest) {\r\n  const hasDelDomainOrPlatform = bidRequest.params.delDomain ||\r\n    bidRequest.params.platform;\r\n\r\n  if (utils.deepAccess(bidRequest, 'mediaTypes.banner') &&\r\n    hasDelDomainOrPlatform) {\r\n    return !!bidRequest.params.unit ||\r\n      utils.deepAccess(bidRequest, 'mediaTypes.banner.sizes.length') > 0;\r\n  }\r\n\r\n  return !!(bidRequest.params.unit && hasDelDomainOrPlatform);\r\n}\r\n\r\nfunction buildRequests(bidRequests, bidderRequest) {\r\n  const videoRequests = bidRequests.filter(bidRequest => isVideoBidRequest(bidRequest));\r\n  const bannerAndNativeRequests = bidRequests.filter(bidRequest => isBannerBidRequest(bidRequest) || isNativeBidRequest(bidRequest))\r\n    // In case of multi-format bids remove `video` from mediaTypes as for video a separate bid request is built\r\n    .map(bid => ({...bid, mediaTypes: {...bid.mediaTypes, video: undefined}}));\r\n\r\n  const requests = bannerAndNativeRequests.length ? [createRequest(bannerAndNativeRequests, bidderRequest, null)] : [];\r\n  videoRequests.forEach(bid => {\r\n    requests.push(createRequest([bid], bidderRequest, VIDEO));\r\n  });\r\n  return requests;\r\n}\r\n\r\nfunction createRequest(bidRequests, bidderRequest, mediaType) {\r\n  return {\r\n    method: 'POST',\r\n    url: config.getConfig('openxOrtbUrl') || REQUEST_URL,\r\n    data: converter.toORTB({bidRequests, bidderRequest, context: {mediaType}})\r\n  }\r\n}\r\n\r\nfunction isVideoBidRequest(bidRequest) {\r\n  return utils.deepAccess(bidRequest, 'mediaTypes.video');\r\n}\r\n\r\nfunction isNativeBidRequest(bidRequest) {\r\n  return utils.deepAccess(bidRequest, 'mediaTypes.native');\r\n}\r\n\r\nfunction isBannerBidRequest(bidRequest) {\r\n  const isNotVideoOrNativeBid = !isVideoBidRequest(bidRequest) && !isNativeBidRequest(bidRequest)\r\n  return utils.deepAccess(bidRequest, 'mediaTypes.banner') || isNotVideoOrNativeBid;\r\n}\r\n\r\nfunction interpretResponse(resp, req) {\r\n  if (!resp.body) {\r\n    resp.body = {nbr: 0};\r\n  }\r\n  return converter.fromORTB({request: req.data, response: resp.body});\r\n}\r\n\r\n/**\r\n * @param syncOptions\r\n * @param responses\r\n * @param gdprConsent\r\n * @param uspConsent\r\n * @param gppConsent\r\n * @return {{type: (string), url: (*|string)}[]}\r\n */\r\nfunction getUserSyncs(syncOptions, responses, gdprConsent, uspConsent, gppConsent) {\r\n  if (syncOptions.iframeEnabled || syncOptions.pixelEnabled) {\r\n    const pixelType = syncOptions.iframeEnabled ? 'iframe' : 'image';\r\n    const queryParamStrings = [];\r\n    let syncUrl = SYNC_URL;\r\n    if (gdprConsent) {\r\n      queryParamStrings.push('gdpr=' + (gdprConsent.gdprApplies ? 1 : 0));\r\n      queryParamStrings.push('gdpr_consent=' + encodeURIComponent(gdprConsent.consentString || ''));\r\n    }\r\n    if (uspConsent) {\r\n      queryParamStrings.push('us_privacy=' + encodeURIComponent(uspConsent));\r\n    }\r\n    if (gppConsent?.gppString && gppConsent?.applicableSections?.length) {\r\n      queryParamStrings.push('gpp=' + encodeURIComponent(gppConsent.gppString));\r\n      queryParamStrings.push('gpp_sid=' + gppConsent.applicableSections.join(','));\r\n    }\r\n    if (responses.length > 0 && responses[0].body && responses[0].body.ext) {\r\n      const ext = responses[0].body.ext;\r\n      if (ext.delDomain) {\r\n        syncUrl = `https://${ext.delDomain}/w/1.0/pd`\r\n      } else if (ext.platform) {\r\n        queryParamStrings.push('ph=' + ext.platform)\r\n      }\r\n    } else {\r\n      queryParamStrings.push('ph=' + DEFAULT_PH)\r\n    }\r\n    return [{\r\n      type: pixelType,\r\n      url: `${syncUrl}${queryParamStrings.length > 0 ? '?' + queryParamStrings.join('&') : ''}`\r\n    }];\r\n  }\r\n}\r\n","/**\r\n * Collect PAAPI component auction configs from bid adapters and make them available through `pbjs.getPAAPIConfig()`\r\n */\r\nimport {config} from '../src/config.js';\r\nimport {getHook, hook, module} from '../src/hook.js';\r\nimport {\r\n  deepAccess,\r\n  deepEqual,\r\n  deepSetValue,\r\n  logError,\r\n  logInfo,\r\n  logWarn,\r\n  mergeDeep,\r\n  sizesToSizeTuples\r\n} from '../src/utils.js';\r\nimport {IMP, PBS, registerOrtbProcessor, RESPONSE} from '../src/pbjsORTB.js';\r\nimport * as events from '../src/events.js';\r\nimport {EVENTS} from '../src/constants.js';\r\nimport {currencyCompare} from '../libraries/currencyUtils/currency.js';\r\nimport {keyCompare, maximum, minimum} from '../src/utils/reducers.js';\r\nimport {getGlobal} from '../src/prebidGlobal.js';\r\nimport {auctionStore} from '../libraries/weakStore/weakStore.js';\r\nimport {adapterMetrics, guardTids} from '../src/adapters/bidderFactory.js';\r\nimport {defer, PbPromise} from '../src/utils/promise.js';\r\nimport {auctionManager} from '../src/auctionManager.js';\r\n\r\nconst MODULE = 'PAAPI';\r\n\r\nconst submodules = [];\r\nconst USED = new WeakSet();\r\n\r\nexport function registerSubmodule(submod) {\r\n  submodules.push(submod);\r\n  submod.init && submod.init({\r\n    getPAAPIConfig,\r\n    expandFilters\r\n  });\r\n}\r\n\r\nmodule('paapi', registerSubmodule);\r\n\r\n/* auction configs as returned by getPAAPIConfigs */\r\nconst configsForAuction = auctionStore();\r\n\r\n/* auction configs returned by adapters, but waiting for end-of-auction signals before they're added to configsForAuction */\r\nconst pendingConfigsForAuction = auctionStore();\r\n\r\n/* igb returned by adapters, waiting for end-of-auction signals before they're merged into configForAuctions */\r\nconst pendingBuyersForAuction = auctionStore();\r\n\r\n/* for auction configs that were generated in parallel with auctions (and contain promises), their resolve/reject methods */\r\nconst deferredConfigsForAuction = auctionStore();\r\n\r\nlet latestAuctionForAdUnit = {};\r\nlet moduleConfig = {};\r\n\r\nconfig.getConfig('paapi', config => {\r\n  init(config.paapi);\r\n});\r\n\r\nexport function reset() {\r\n  submodules.splice(0, submodules.length);\r\n  latestAuctionForAdUnit = {};\r\n}\r\n\r\nexport function init(cfg) {\r\n  if (cfg && cfg.enabled === true) {\r\n    if (!moduleConfig.enabled) {\r\n      attachHandlers();\r\n    }\r\n    moduleConfig = cfg;\r\n    logInfo(`${MODULE} enabled (browser ${isFledgeSupported() ? 'supports' : 'does NOT support'} runAdAuction)`, cfg);\r\n  } else {\r\n    if (moduleConfig.enabled) {\r\n      detachHandlers();\r\n    }\r\n    moduleConfig = {};\r\n    logInfo(`${MODULE} disabled`, cfg);\r\n  }\r\n}\r\n\r\nfunction attachHandlers() {\r\n  getHook('addPaapiConfig').before(addPaapiConfigHook);\r\n  getHook('makeBidRequests').before(addPaapiData);\r\n  getHook('makeBidRequests').after(markForFledge);\r\n  getHook('processBidderRequests').before(parallelPaapiProcessing, 9);\r\n  // resolve params before parallel processing\r\n  getHook('processBidderRequests').before(buildPAAPIParams, 10);\r\n  getHook('processBidderRequests').before(adAuctionHeadersHook);\r\n  events.on(EVENTS.AUCTION_INIT, onAuctionInit);\r\n  events.on(EVENTS.AUCTION_END, onAuctionEnd);\r\n}\r\n\r\nfunction detachHandlers() {\r\n  getHook('addPaapiConfig').getHooks({hook: addPaapiConfigHook}).remove();\r\n  getHook('makeBidRequests').getHooks({hook: addPaapiData}).remove();\r\n  getHook('makeBidRequests').getHooks({hook: markForFledge}).remove();\r\n  getHook('processBidderRequests').getHooks({hook: parallelPaapiProcessing}).remove();\r\n  getHook('processBidderRequests').getHooks({hook: buildPAAPIParams}).remove();\r\n  getHook('processBidderRequests').getHooks({hook: adAuctionHeadersHook}).remove();\r\n  events.off(EVENTS.AUCTION_INIT, onAuctionInit);\r\n  events.off(EVENTS.AUCTION_END, onAuctionEnd);\r\n}\r\n\r\nexport function adAuctionHeadersHook(next, spec, bids, bidderRequest, ajax, ...args) {\r\n  if (bidderRequest.paapi?.enabled) {\r\n    ajax = ((orig) => {\r\n      return function (url, callback, data, options) {\r\n        options = options ?? {};\r\n        options.adAuctionHeaders = options.adAuctionHeaders ?? true;\r\n        return orig.call(this, url, callback, data, options);\r\n      }\r\n    })(ajax);\r\n  }\r\n  return next.call(this, spec, bids, bidderRequest, ajax, ...args);\r\n}\r\n\r\nfunction getStaticSignals(adUnit = {}) {\r\n  const cfg = {};\r\n  const requestedSize = getRequestedSize(adUnit);\r\n  if (requestedSize) {\r\n    cfg.requestedSize = requestedSize;\r\n  }\r\n  return cfg;\r\n}\r\n\r\nfunction getSlotSignals(bidsReceived = [], bidRequests = []) {\r\n  let bidfloor, bidfloorcur;\r\n  if (bidsReceived.length > 0) {\r\n    const bestBid = bidsReceived.reduce(maximum(currencyCompare(bid => [bid.cpm, bid.currency])));\r\n    bidfloor = bestBid.cpm;\r\n    bidfloorcur = bestBid.currency;\r\n  } else {\r\n    const floors = bidRequests.map(bid => typeof bid.getFloor === 'function' && bid.getFloor()).filter(f => f);\r\n    const minFloor = floors.length && floors.reduce(minimum(currencyCompare(floor => [floor.floor, floor.currency])));\r\n    bidfloor = minFloor?.floor;\r\n    bidfloorcur = minFloor?.currency;\r\n  }\r\n  const cfg = {};\r\n  if (bidfloor) {\r\n    deepSetValue(cfg, 'auctionSignals.prebid.bidfloor', bidfloor);\r\n    bidfloorcur && deepSetValue(cfg, 'auctionSignals.prebid.bidfloorcur', bidfloorcur);\r\n  }\r\n  return cfg;\r\n}\r\n\r\nexport function buyersToAuctionConfigs(igbRequests, merge = mergeBuyers, config = moduleConfig?.componentSeller ?? {}, partitioners = {\r\n  compact: (igbRequests) => partitionBuyers(igbRequests.map(req => req[1])).map(part => [{}, part]),\r\n  expand: partitionBuyersByBidder\r\n}) {\r\n  if (!config.auctionConfig) {\r\n    logWarn(MODULE, 'Cannot use IG buyers: paapi.componentSeller.auctionConfig not set', igbRequests.map(req => req[1]));\r\n    return [];\r\n  }\r\n  const partition = partitioners[config.separateAuctions ? 'expand' : 'compact'];\r\n  return partition(igbRequests)\r\n    .map(([request, igbs]) => {\r\n      const auctionConfig = mergeDeep(merge(igbs), config.auctionConfig);\r\n      auctionConfig.auctionSignals = setFPD(auctionConfig.auctionSignals || {}, request);\r\n      return [request, auctionConfig];\r\n    });\r\n}\r\n\r\nfunction onAuctionEnd({auctionId, bidsReceived, bidderRequests, adUnitCodes, adUnits}) {\r\n  const adUnitsByCode = Object.fromEntries(adUnits?.map(au => [au.code, au]) || []);\r\n  const allReqs = bidderRequests?.flatMap(br => br.bids);\r\n  const paapiConfigs = configsForAuction(auctionId);\r\n  (adUnitCodes || []).forEach(au => {\r\n    if (!paapiConfigs.hasOwnProperty(au)) {\r\n      paapiConfigs[au] = null;\r\n    }\r\n    !latestAuctionForAdUnit.hasOwnProperty(au) && (latestAuctionForAdUnit[au] = null);\r\n  });\r\n\r\n  const pendingConfigs = pendingConfigsForAuction(auctionId);\r\n  const pendingBuyers = pendingBuyersForAuction(auctionId);\r\n\r\n  if (pendingConfigs && pendingBuyers) {\r\n    Object.entries(pendingBuyers).forEach(([adUnitCode, igbRequests]) => {\r\n      buyersToAuctionConfigs(igbRequests).forEach(([{bidder}, auctionConfig]) => append(pendingConfigs, adUnitCode, {id: getComponentSellerConfigId(bidder), config: auctionConfig}))\r\n    })\r\n  }\r\n\r\n  const deferredConfigs = deferredConfigsForAuction(auctionId);\r\n\r\n  const adUnitsWithConfigs = Array.from(new Set(Object.keys(pendingConfigs).concat(Object.keys(deferredConfigs))));\r\n  const signals = Object.fromEntries(\r\n    adUnitsWithConfigs.map(adUnitCode => {\r\n      latestAuctionForAdUnit[adUnitCode] = auctionId;\r\n      const forThisAdUnit = (bid) => bid.adUnitCode === adUnitCode;\r\n      return [adUnitCode, {\r\n        ...getStaticSignals(adUnitsByCode[adUnitCode]),\r\n        ...getSlotSignals(bidsReceived?.filter(forThisAdUnit), allReqs?.filter(forThisAdUnit))\r\n      }]\r\n    })\r\n  )\r\n\r\n  const configsById = {};\r\n  Object.entries(pendingConfigs || {}).forEach(([adUnitCode, auctionConfigs]) => {\r\n    auctionConfigs.forEach(({id, config}) => append(configsById, id, {\r\n      adUnitCode,\r\n      config: mergeDeep({}, signals[adUnitCode], config)\r\n    }));\r\n  });\r\n\r\n  function resolveSignals(signals, deferrals) {\r\n    Object.entries(deferrals).forEach(([signal, {resolve, default: defaultValue}]) => {\r\n      let value = signals.hasOwnProperty(signal) ? signals[signal] : null;\r\n      if (value == null && defaultValue == null) {\r\n        value = undefined;\r\n      } else if (typeof defaultValue === 'object' && typeof value === 'object') {\r\n        value = mergeDeep({}, defaultValue, value);\r\n      } else {\r\n        value = value ?? defaultValue\r\n      }\r\n      resolve(value);\r\n    })\r\n  }\r\n\r\n  Object.entries(deferredConfigs).forEach(([adUnitCode, {top, components}]) => {\r\n    resolveSignals(signals[adUnitCode], top);\r\n    Object.entries(components).forEach(([configId, {deferrals}]) => {\r\n      const matchingConfigs = configsById.hasOwnProperty(configId) ? configsById[configId] : [];\r\n      if (matchingConfigs.length > 1) {\r\n        logWarn(`Received multiple PAAPI configs for the same bidder and seller (${configId}), active PAAPI auctions will only see the first`);\r\n      }\r\n      const {config} = matchingConfigs.shift() ?? {config: {...signals[adUnitCode]}}\r\n      resolveSignals(config, deferrals);\r\n    })\r\n  });\r\n\r\n  const newConfigs = Object.values(configsById).flatMap(configs => configs);\r\n  const hasDeferredConfigs = Object.keys(deferredConfigs).length > 0;\r\n\r\n  if (moduleConfig.parallel && hasDeferredConfigs && newConfigs.length > 0) {\r\n    logError(`Received PAAPI configs after PAAPI auctions were already started in parallel with their contextual auction`, newConfigs)\r\n  }\r\n\r\n  newConfigs.forEach(({adUnitCode, config}) => {\r\n    if (paapiConfigs[adUnitCode] == null) {\r\n      paapiConfigs[adUnitCode] = {\r\n        ...signals[adUnitCode],\r\n        componentAuctions: []\r\n      }\r\n    }\r\n    paapiConfigs[adUnitCode].componentAuctions.push(mergeDeep({}, signals[adUnitCode], config));\r\n  });\r\n\r\n  if (!moduleConfig.parallel || !hasDeferredConfigs) {\r\n    submodules.forEach(submod => submod.onAuctionConfig?.(auctionId, paapiConfigs));\r\n  }\r\n}\r\n\r\nfunction append(target, key, value) {\r\n  !target.hasOwnProperty(key) && (target[key] = []);\r\n  target[key].push(value);\r\n}\r\n\r\nfunction setFPD(target, {ortb2, ortb2Imp}) {\r\n  ortb2 != null && deepSetValue(target, 'prebid.ortb2', mergeDeep({}, ortb2, target.prebid?.ortb2));\r\n  ortb2Imp != null && deepSetValue(target, 'prebid.ortb2Imp', mergeDeep({}, ortb2Imp, target.prebid?.ortb2Imp));\r\n  return target;\r\n}\r\n\r\nfunction getConfigId(bidderCode, seller) {\r\n  return `${bidderCode}::${seller}`;\r\n}\r\n\r\nfunction getComponentSellerConfigId(bidderCode) {\r\n  return moduleConfig.componentSeller.separateAuctions ? `igb::${bidderCode}` : 'igb';\r\n}\r\n\r\nexport function addPaapiConfigHook(next, request, paapiConfig) {\r\n  if (getFledgeConfig(config.getCurrentBidder()).enabled) {\r\n    const {adUnitCode, auctionId, bidder} = request;\r\n\r\n    function storePendingData(store, data) {\r\n      const target = store(auctionId);\r\n      if (target != null) {\r\n        append(target, adUnitCode, data)\r\n      } else {\r\n        logWarn(MODULE, `Received PAAPI config for auction that has closed (auction '${auctionId}', adUnit '${adUnitCode}')`, data);\r\n      }\r\n    }\r\n\r\n    const {config, igb} = paapiConfig;\r\n    if (config) {\r\n      config.auctionSignals = setFPD(config.auctionSignals || {}, request);\r\n      const pbs = config.perBuyerSignals = config.perBuyerSignals ?? {};\r\n      (config.interestGroupBuyers || []).forEach(buyer => {\r\n        pbs[buyer] = setFPD(pbs[buyer] ?? {}, request);\r\n      })\r\n      storePendingData(pendingConfigsForAuction, {id: getConfigId(bidder, config.seller), config});\r\n    }\r\n    if (igb && checkOrigin(igb)) {\r\n      igb.pbs = setFPD(igb.pbs || {}, request);\r\n      storePendingData(pendingBuyersForAuction, [request, igb])\r\n    }\r\n  }\r\n  next(request, paapiConfig);\r\n}\r\n\r\nexport const IGB_TO_CONFIG = {\r\n  cur: 'perBuyerCurrencies',\r\n  pbs: 'perBuyerSignals',\r\n  ps: 'perBuyerPrioritySignals',\r\n  maxbid: 'auctionSignals.prebid.perBuyerMaxbid',\r\n}\r\n\r\nfunction checkOrigin(igb) {\r\n  if (igb.origin) return true;\r\n  logWarn('PAAPI buyer does not specify origin and will be ignored', igb);\r\n}\r\n\r\n/**\r\n * Convert a list of InterestGroupBuyer (igb) objects into a partial auction config.\r\n * https://github.com/InteractiveAdvertisingBureau/openrtb/blob/main/extensions/community_extensions/Protected%20Audience%20Support.md\r\n */\r\nexport function mergeBuyers(igbs) {\r\n  const buyers = new Set();\r\n  return Object.assign(\r\n    igbs.reduce((config, igb) => {\r\n      if (checkOrigin(igb)) {\r\n        if (!buyers.has(igb.origin)) {\r\n          buyers.add(igb.origin);\r\n          Object.entries(IGB_TO_CONFIG).forEach(([igbField, configField]) => {\r\n            if (igb[igbField] != null) {\r\n              const entry = deepAccess(config, configField) || {}\r\n              entry[igb.origin] = igb[igbField];\r\n              deepSetValue(config, configField, entry);\r\n            }\r\n          });\r\n        } else {\r\n          logWarn(MODULE, `Duplicate buyer: ${igb.origin}. All but the first will be ignored`, igbs);\r\n        }\r\n      }\r\n      return config;\r\n    }, {}),\r\n    {\r\n      interestGroupBuyers: Array.from(buyers.keys())\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Partition a list of InterestGroupBuyer (igb) object into sets that can each be merged into a single auction.\r\n * If the same buyer (origin) appears more than once, it will be split across different partition unless the igb objects\r\n * are identical.\r\n */\r\nexport function partitionBuyers(igbs) {\r\n  return igbs.reduce((partitions, igb) => {\r\n    if (checkOrigin(igb)) {\r\n      let partition = partitions.find(part => !part.hasOwnProperty(igb.origin) || deepEqual(part[igb.origin], igb));\r\n      if (!partition) {\r\n        partition = {};\r\n        partitions.push(partition);\r\n      }\r\n      partition[igb.origin] = igb;\r\n    }\r\n    return partitions;\r\n  }, []).map(part => Object.values(part));\r\n}\r\n\r\nexport function partitionBuyersByBidder(igbRequests) {\r\n  const requests = {};\r\n  const igbs = {};\r\n  igbRequests.forEach(([request, igb]) => {\r\n    !requests.hasOwnProperty(request.bidder) && (requests[request.bidder] = request);\r\n    append(igbs, request.bidder, igb);\r\n  })\r\n  return Object.entries(igbs).map(([bidder, igbs]) => [requests[bidder], igbs])\r\n}\r\n\r\n/**\r\n * Expand PAAPI api filters into a map from ad unit code to auctionId.\r\n *\r\n * auctionId when specified, the result will have this as the value for each entry.\r\n * when not specified, each ad unit will map to the latest auction that involved that ad unit.\r\n * adUnitCode when specified, the result will contain only one entry (for this ad unit) or be empty (if this ad\r\n * unit was never involved in an auction).\r\n * when not specified, the result will contain an entry for every ad unit that was involved in any auction.\r\n * @return {{[adUnitCode: string]: string}}\r\n */\r\nfunction expandFilters({auctionId, adUnitCode} = {}) {\r\n  let adUnitCodes = [];\r\n  if (adUnitCode == null) {\r\n    adUnitCodes = Object.keys(latestAuctionForAdUnit);\r\n  } else if (latestAuctionForAdUnit.hasOwnProperty(adUnitCode)) {\r\n    adUnitCodes = [adUnitCode];\r\n  }\r\n  return Object.fromEntries(\r\n    adUnitCodes.map(au => [au, auctionId ?? latestAuctionForAdUnit[au]])\r\n  );\r\n}\r\n\r\n/**\r\n * Get PAAPI auction configuration.\r\n *\r\n * @param {Object} [filters] - Filters object\r\n * @param {string} [filters.auctionId] optional auction filter; if omitted, the latest auction for each ad unit is used\r\n * @param {string} [filters.adUnitCode] optional ad unit filter\r\n * @param {boolean} [includeBlanks=false] if true, include null entries for ad units that match the given filters but do not have any available auction configs.\r\n * @returns {Object} a map from ad unit code to auction config for the ad unit.\r\n */\r\nexport function getPAAPIConfig(filters = {}, includeBlanks = false) {\r\n  const output = {};\r\n  Object.entries(expandFilters(filters)).forEach(([au, auctionId]) => {\r\n    const auctionConfigs = configsForAuction(auctionId);\r\n    if (auctionConfigs?.hasOwnProperty(au)) {\r\n      // ad unit was involved in a PAAPI auction\r\n      const candidate = auctionConfigs[au];\r\n      if (candidate && !USED.has(candidate)) {\r\n        output[au] = candidate;\r\n        USED.add(candidate);\r\n      } else if (includeBlanks) {\r\n        output[au] = null;\r\n      }\r\n    } else if (auctionId == null && includeBlanks) {\r\n      // ad unit was involved in a non-PAAPI auction\r\n      output[au] = null;\r\n    }\r\n  });\r\n  return output;\r\n}\r\n\r\ngetGlobal().getPAAPIConfig = (filters) => getPAAPIConfig(filters);\r\n\r\nfunction isFledgeSupported() {\r\n  return 'runAdAuction' in navigator && 'joinAdInterestGroup' in navigator;\r\n}\r\n\r\nfunction getFledgeConfig(bidder) {\r\n  const enabled = moduleConfig.enabled && (bidder == null || !moduleConfig.bidders?.length || moduleConfig.bidders?.includes(bidder));\r\n  return {\r\n    enabled,\r\n    ae: enabled ? moduleConfig.defaultForSlots : undefined\r\n  };\r\n}\r\n\r\n/**\r\n * Given an array of size tuples, return the one that should be used for PAAPI.\r\n */\r\nexport const getPAAPISize = hook('sync', function (sizes) {\r\n  sizes = sizes\r\n    ?.filter(([w, h]) => !(w === h && w <= 5));\r\n\r\n  if (sizes?.length) {\r\n    return sizes\r\n      .reduce(maximum(keyCompare(([w, h]) => w * h)));\r\n  }\r\n}, 'getPAAPISize');\r\n\r\nfunction getRequestedSize(adUnit) {\r\n  return adUnit.ortb2Imp?.ext?.paapi?.requestedSize || (() => {\r\n    const size = getPAAPISize(sizesToSizeTuples(adUnit.mediaTypes?.banner?.sizes));\r\n    if (size) {\r\n      return {\r\n        width: size[0],\r\n        height: size[1]\r\n      };\r\n    }\r\n  })();\r\n}\r\n\r\nexport function addPaapiData(next, adUnits, ...args) {\r\n  if (isFledgeSupported() && moduleConfig.enabled) {\r\n    adUnits.forEach(adUnit => {\r\n      // https://github.com/InteractiveAdvertisingBureau/openrtb/blob/main/extensions/community_extensions/Protected%20Audience%20Support.md\r\n      const igsAe = adUnit.ortb2Imp?.ext?.igs != null\r\n        ? adUnit.ortb2Imp.ext.igs.ae || 1\r\n        : null;\r\n      const extAe = adUnit.ortb2Imp?.ext?.ae;\r\n      if (igsAe !== extAe && igsAe != null && extAe != null) {\r\n        logWarn(MODULE, `Ad unit defines conflicting ortb2Imp.ext.ae and ortb2Imp.ext.igs, using the latter`, adUnit);\r\n      }\r\n      const ae = igsAe ?? extAe ?? moduleConfig.defaultForSlots;\r\n      if (ae) {\r\n        deepSetValue(adUnit, 'ortb2Imp.ext.ae', ae);\r\n        adUnit.ortb2Imp.ext.igs = Object.assign({\r\n          ae: ae,\r\n          biddable: 1\r\n        }, adUnit.ortb2Imp.ext.igs);\r\n        const requestedSize = getRequestedSize(adUnit);\r\n        if (requestedSize) {\r\n          deepSetValue(adUnit, 'ortb2Imp.ext.paapi.requestedSize', requestedSize);\r\n        }\r\n        adUnit.bids.forEach(bidReq => {\r\n          if (!getFledgeConfig(bidReq.bidder).enabled) {\r\n            deepSetValue(bidReq, 'ortb2Imp.ext.ae', 0);\r\n            bidReq.ortb2Imp.ext.igs = {ae: 0, biddable: 0};\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n  next(adUnits, ...args);\r\n}\r\n\r\nexport const NAVIGATOR_APIS = ['createAuctionNonce', 'getInterestGroupAdAuctionData'];\r\n\r\nexport function markForFledge(next, bidderRequests) {\r\n  if (isFledgeSupported()) {\r\n    bidderRequests.forEach((bidderReq) => {\r\n      const {enabled} = getFledgeConfig(bidderReq.bidderCode);\r\n      Object.assign(bidderReq, {\r\n        paapi: {\r\n          enabled,\r\n          componentSeller: !!moduleConfig.componentSeller?.auctionConfig\r\n        }\r\n      });\r\n      if (enabled) {\r\n        NAVIGATOR_APIS.forEach(method => {\r\n          bidderReq.paapi[method] = (...args) => new AsyncPAAPIParam(() => navigator[method](...args))\r\n        })\r\n      }\r\n    });\r\n  }\r\n  next(bidderRequests);\r\n}\r\n\r\nexport const ASYNC_SIGNALS = [\r\n  'auctionSignals',\r\n  'sellerSignals',\r\n  'perBuyerSignals',\r\n  'perBuyerTimeouts',\r\n  'directFromSellerSignals',\r\n  'perBuyerCurrencies',\r\n  'perBuyerCumulativeTimeouts',\r\n  'serverResponse'\r\n];\r\n\r\nconst validatePartialConfig = (() => {\r\n  const REQUIRED_SYNC_SIGNALS = [\r\n    {\r\n      props: ['seller'],\r\n      validate: (val) => typeof val === 'string'\r\n    },\r\n    {\r\n      props: ['interestGroupBuyers'],\r\n      validate: (val) => Array.isArray(val) && val.length > 0\r\n    },\r\n    {\r\n      props: ['decisionLogicURL', 'decisionLogicUrl'],\r\n      validate: (val) => typeof val === 'string'\r\n    }\r\n  ];\r\n\r\n  return function (config) {\r\n    const invalid = REQUIRED_SYNC_SIGNALS.find(({props, validate}) => props.every(prop => !config.hasOwnProperty(prop) || !config[prop] || !validate(config[prop])));\r\n    if (invalid) {\r\n      logError(`Partial PAAPI config has missing or invalid property \"${invalid.props[0]}\"`, config)\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n})()\r\n\r\nfunction callAdapterApi(spec, method, bids, bidderRequest) {\r\n  const metrics = adapterMetrics(bidderRequest);\r\n  const tidGuard = guardTids(bidderRequest);\r\n  let result;\r\n  metrics.measureTime(method, () => {\r\n    try {\r\n      result = spec[method](bids.map(tidGuard.bidRequest), tidGuard.bidderRequest(bidderRequest))\r\n    } catch (e) {\r\n      logError(`Error invoking \"${method}\":`, e);\r\n    }\r\n  });\r\n  return result;\r\n}\r\n\r\n/**\r\n * Adapters can provide a `spec.buildPAAPIConfigs(validBidRequests, bidderRequest)` to be included in PAAPI auctions\r\n * that can be started in parallel with contextual auctions.\r\n *\r\n * If PAAPI is enabled, and an adapter provides `buildPAAPIConfigs`, it is invoked just before `buildRequests`,\r\n * and takes the same arguments. It should return an array of PAAPI configuration objects with the same format\r\n * as in `interpretResponse` (`{bidId, config?, igb?}`).\r\n *\r\n * Everything returned by `buildPAAPIConfigs` is treated in the same way as if it was returned by `interpretResponse` -\r\n * except for signals that can be provided asynchronously (cfr. `ASYNC_SIGNALS`), which are replaced by promises.\r\n * When the (contextual) auction ends, the promises are resolved.\r\n *\r\n * If during the auction the adapter's `interpretResponse` returned matching configurations (same `bidId`,\r\n * and a `config` with the same `seller`, or an `igb` with the same `origin`), the promises resolve to their contents.\r\n * Otherwise, they resolve to the values provided by `buildPAAPIConfigs`, or an empty object if no value was provided.\r\n *\r\n * Promisified auction configs are available from `getPAAPIConfig` immediately after `requestBids`.\r\n * If the `paapi.parallel` config flag is set, PAAPI submodules are also triggered at the same time\r\n * (instead of when the auction ends).\r\n */\r\nexport function parallelPaapiProcessing(next, spec, bids, bidderRequest, ...args) {\r\n  function makeDeferrals(defaults = {}) {\r\n    const promises = {};\r\n    const deferrals = Object.fromEntries(ASYNC_SIGNALS.map(signal => {\r\n      const def = defer({promiseFactory: (resolver) => new Promise(resolver)});\r\n      def.default = defaults.hasOwnProperty(signal) ? defaults[signal] : null;\r\n      promises[signal] = def.promise;\r\n      return [signal, def]\r\n    }))\r\n    return [deferrals, promises];\r\n  }\r\n\r\n  const {auctionId, paapi: {enabled, componentSeller} = {}} = bidderRequest;\r\n  const auctionConfigs = configsForAuction(auctionId);\r\n  bids.map(bid => bid.adUnitCode).forEach(adUnitCode => {\r\n    latestAuctionForAdUnit[adUnitCode] = auctionId;\r\n    if (!auctionConfigs.hasOwnProperty(adUnitCode)) {\r\n      auctionConfigs[adUnitCode] = null;\r\n    }\r\n  });\r\n\r\n  if (enabled && spec.buildPAAPIConfigs) {\r\n    const partialConfigs = callAdapterApi(spec, 'buildPAAPIConfigs', bids, bidderRequest)\r\n    const requestsById = Object.fromEntries(bids.map(bid => [bid.bidId, bid]));\r\n    (partialConfigs ?? []).forEach(({bidId, config, igb}) => {\r\n      const bidRequest = requestsById.hasOwnProperty(bidId) && requestsById[bidId];\r\n      if (!bidRequest) {\r\n        logError(`Received partial PAAPI config for unknown bidId`, {bidId, config});\r\n      } else {\r\n        const adUnitCode = bidRequest.adUnitCode;\r\n        latestAuctionForAdUnit[adUnitCode] = auctionId;\r\n        const deferredConfigs = deferredConfigsForAuction(auctionId);\r\n\r\n        const getDeferredConfig = () => {\r\n          if (!deferredConfigs.hasOwnProperty(adUnitCode)) {\r\n            const [deferrals, promises] = makeDeferrals();\r\n            auctionConfigs[adUnitCode] = {\r\n              ...getStaticSignals(auctionManager.index.getAdUnit(bidRequest)),\r\n              ...promises,\r\n              componentAuctions: []\r\n            }\r\n            deferredConfigs[adUnitCode] = {\r\n              top: deferrals,\r\n              components: {},\r\n              auctionConfig: auctionConfigs[adUnitCode]\r\n            }\r\n          }\r\n          return deferredConfigs[adUnitCode];\r\n        }\r\n\r\n        if (config && validatePartialConfig(config)) {\r\n          const configId = getConfigId(bidRequest.bidder, config.seller);\r\n          const deferredConfig = getDeferredConfig();\r\n          if (deferredConfig.components.hasOwnProperty(configId)) {\r\n            logWarn(`Received multiple PAAPI configs for the same bidder and seller; config will be ignored`, {\r\n              config,\r\n              bidder: bidRequest.bidder\r\n            })\r\n          } else {\r\n            const [deferrals, promises] = makeDeferrals(config);\r\n            const auctionConfig = {\r\n              ...getStaticSignals(bidRequest),\r\n              ...config,\r\n              ...promises\r\n            }\r\n            deferredConfig.auctionConfig.componentAuctions.push(auctionConfig)\r\n            deferredConfig.components[configId] = {auctionConfig, deferrals};\r\n          }\r\n        }\r\n        if (componentSeller && igb && checkOrigin(igb)) {\r\n          const configId = getComponentSellerConfigId(spec.code);\r\n          const deferredConfig = getDeferredConfig();\r\n          const partialConfig = buyersToAuctionConfigs([[bidRequest, igb]])[0][1];\r\n          if (deferredConfig.components.hasOwnProperty(configId)) {\r\n            const {auctionConfig, deferrals} = deferredConfig.components[configId];\r\n            if (!auctionConfig.interestGroupBuyers.includes(igb.origin)) {\r\n              const immediate = {};\r\n              Object.entries(partialConfig).forEach(([key, value]) => {\r\n                if (deferrals.hasOwnProperty(key)) {\r\n                  mergeDeep(deferrals[key], {default: value});\r\n                } else {\r\n                  immediate[key] = value;\r\n                }\r\n              })\r\n              mergeDeep(auctionConfig, immediate);\r\n            } else {\r\n              logWarn(`Received the same PAAPI buyer multiple times for the same PAAPI auction. Consider setting paapi.componentSeller.separateAuctions: true`, igb)\r\n            }\r\n          } else {\r\n            const [deferrals, promises] = makeDeferrals(partialConfig);\r\n            const auctionConfig = {\r\n              ...partialConfig,\r\n              ...getStaticSignals(bidRequest),\r\n              ...promises,\r\n            }\r\n            deferredConfig.components[configId] = {auctionConfig, deferrals};\r\n            deferredConfig.auctionConfig.componentAuctions.push(auctionConfig);\r\n          }\r\n        }\r\n      }\r\n    })\r\n  }\r\n  return next.call(this, spec, bids, bidderRequest, ...args);\r\n}\r\n\r\nexport class AsyncPAAPIParam {\r\n  constructor(resolve) {\r\n    this.resolve = resolve;\r\n  }\r\n}\r\n\r\nexport function buildPAAPIParams(next, spec, bids, bidderRequest, ...args) {\r\n  if (bidderRequest.paapi?.enabled && spec.paapiParameters) {\r\n    const params = callAdapterApi(spec, 'paapiParameters', bids, bidderRequest);\r\n    return PbPromise.all(\r\n      Object.entries(params ?? {}).map(([key, value]) =>\r\n        value instanceof AsyncPAAPIParam\r\n          ? value.resolve().then(result => [key, result])\r\n          : Promise.resolve([key, value]))\r\n    ).then(resolved => {\r\n      bidderRequest.paapi.params = Object.fromEntries(resolved);\r\n    }).catch(err => {\r\n      logError(`Could not resolve PAAPI parameters`, err);\r\n    }).then(() => {\r\n      next.call(this, spec, bids, bidderRequest, ...args);\r\n    })\r\n  } else {\r\n    next.call(this, spec, bids, bidderRequest, ...args);\r\n  }\r\n}\r\n\r\nexport function onAuctionInit({auctionId}) {\r\n  if (moduleConfig.parallel) {\r\n    auctionManager.index.getAuction({auctionId}).requestsDone.then(() => {\r\n      if (Object.keys(deferredConfigsForAuction(auctionId)).length > 0) {\r\n        submodules.forEach(submod => submod.onAuctionConfig?.(auctionId, configsForAuction(auctionId)));\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nexport function setImpExtAe(imp, bidRequest, context) {\r\n  if (!context.bidderRequest.paapi?.enabled) {\r\n    delete imp.ext?.ae;\r\n    delete imp.ext?.igs;\r\n  }\r\n}\r\n\r\nregisterOrtbProcessor({type: IMP, name: 'impExtAe', fn: setImpExtAe});\r\n\r\nexport function parseExtIgi(response, ortbResponse, context) {\r\n  paapiResponseParser(\r\n    (ortbResponse.ext?.igi || []).flatMap(igi => {\r\n      return (igi?.igs || []).map(igs => {\r\n        if (igs.impid !== igi.impid && igs.impid != null && igi.impid != null) {\r\n          logWarn(MODULE, 'ORTB response ext.igi.igs.impid conflicts with parent\\'s impid', igi);\r\n        }\r\n        return {\r\n          config: igs.config,\r\n          impid: igs.impid ?? igi.impid\r\n        }\r\n      }).concat((igi?.igb || []).map(igb => ({\r\n        igb,\r\n        impid: igi.impid\r\n      })))\r\n    }),\r\n    response,\r\n    context\r\n  )\r\n}\r\n\r\nfunction paapiResponseParser(configs, response, context) {\r\n  configs.forEach((config) => {\r\n    const impCtx = context.impContext[config.impid];\r\n    if (!impCtx?.imp?.ext?.ae) {\r\n      logWarn(MODULE, 'Received auction configuration for an impression that was not in the request or did not ask for it', config, impCtx?.imp);\r\n    } else {\r\n      impCtx.paapiConfigs = impCtx.paapiConfigs || [];\r\n      impCtx.paapiConfigs.push(config);\r\n    }\r\n  });\r\n}\r\n\r\n// to make it easier to share code between the PBS adapter and adapters whose backend is PBS, break up\r\n// fledge response processing in two steps: first aggregate all the auction configs by their imp...\r\n\r\nexport function parseExtPrebidFledge(response, ortbResponse, context) {\r\n  paapiResponseParser(\r\n    (ortbResponse.ext?.prebid?.fledge?.auctionconfigs || []),\r\n    response,\r\n    context\r\n  )\r\n}\r\n\r\nregisterOrtbProcessor({type: RESPONSE, name: 'extPrebidFledge', fn: parseExtPrebidFledge, dialects: [PBS]});\r\nregisterOrtbProcessor({type: RESPONSE, name: 'extIgiIgs', fn: parseExtIgi});\r\n\r\n// ...then, make them available in the adapter's response. This is the client side version, for which the\r\n// interpretResponse api is {fledgeAuctionConfigs: [{bidId, config}]}\r\n\r\nexport function setResponsePaapiConfigs(response, ortbResponse, context) {\r\n  const configs = Object.values(context.impContext)\r\n    .flatMap((impCtx) => (impCtx.paapiConfigs || []).map(cfg => ({\r\n      bidId: impCtx.bidRequest.bidId,\r\n      ...cfg\r\n    })));\r\n  if (configs.length > 0) {\r\n    response.paapi = configs;\r\n  }\r\n}\r\n\r\nregisterOrtbProcessor({\r\n  type: RESPONSE,\r\n  name: 'paapiConfigs',\r\n  priority: -1,\r\n  fn: setResponsePaapiConfigs,\r\n});\r\n","/**\r\n * GPT-specific slot configuration logic for PAAPI.\r\n */\r\nimport {getHook, submodule} from '../src/hook.js';\r\nimport {deepAccess, logInfo, logWarn, sizeTupleToSizeString} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport {getGlobal} from '../src/prebidGlobal.js';\r\n\r\nimport {keyCompare} from '../src/utils/reducers.js';\r\nimport {getGPTSlotsForAdUnits, targeting} from '../src/targeting.js';\r\n\r\nconst MODULE = 'paapiForGpt';\r\n\r\nlet getPAAPIConfig;\r\n\r\nconfig.getConfig('paapi', (cfg) => {\r\n  if (deepAccess(cfg, 'paapi.gpt.configWithTargeting', true)) {\r\n    logInfo(MODULE, 'enabling PAAPI configuration with setTargetingForGPTAsync')\r\n    targeting.setTargetingForGPT.before(setTargetingHook);\r\n  } else {\r\n    targeting.setTargetingForGPT.getHooks({hook: setTargetingHook}).remove();\r\n  }\r\n});\r\n\r\nexport function setTargetingHookFactory(setPaapiConfig = getGlobal().setPAAPIConfigForGPT) {\r\n  return function(next, adUnit, customSlotMatching) {\r\n    const adUnitCodes = Array.isArray(adUnit) ? adUnit : [adUnit]\r\n    adUnitCodes\r\n      .map(adUnitCode => adUnitCode == null ? undefined : {adUnitCode})\r\n      .forEach(filters => setPaapiConfig(filters, customSlotMatching))\r\n    next(adUnit, customSlotMatching);\r\n  }\r\n}\r\n\r\nexport function slotConfigurator() {\r\n  const PREVIOUSLY_SET = {};\r\n  return function setComponentAuction(adUnitCode, gptSlots, auctionConfigs, reset = true) {\r\n    if (gptSlots.length > 0) {\r\n      let previous = PREVIOUSLY_SET[adUnitCode] ?? {};\r\n      let configsBySeller = Object.fromEntries(auctionConfigs.map(cfg => [cfg.seller, cfg]));\r\n      const sellers = Object.keys(configsBySeller);\r\n      if (reset) {\r\n        configsBySeller = Object.assign(previous, configsBySeller);\r\n        previous = Object.fromEntries(sellers.map(seller => [seller, null]));\r\n      } else {\r\n        sellers.forEach(seller => {\r\n          previous[seller] = null;\r\n        });\r\n      }\r\n      Object.keys(previous).length ? PREVIOUSLY_SET[adUnitCode] = previous : delete PREVIOUSLY_SET[adUnitCode];\r\n      const componentAuction = Object.entries(configsBySeller)\r\n        .map(([configKey, auctionConfig]) => ({configKey, auctionConfig}));\r\n      if (componentAuction.length > 0) {\r\n        gptSlots.forEach(gptSlot => {\r\n          gptSlot.setConfig({componentAuction});\r\n          logInfo(MODULE, `register component auction configs for: ${adUnitCode}: ${gptSlot.getAdUnitPath()}`, auctionConfigs);\r\n          // reference https://developers.google.com/publisher-tag/reference#googletag.config.ComponentAuctionConfig\r\n        });\r\n      }\r\n    } else if (auctionConfigs.length > 0) {\r\n      logWarn(MODULE, `unable to register component auction config for ${adUnitCode}`, auctionConfigs);\r\n    }\r\n  };\r\n}\r\n\r\nconst setComponentAuction = slotConfigurator();\r\n\r\nexport const getPAAPISizeHook = (() => {\r\n  /*\r\n    https://github.com/google/ads-privacy/tree/master/proposals/fledge-multiple-seller-testing#faq\r\n    https://support.google.com/admanager/answer/1100453?hl=en\r\n\r\n    Ignore any placeholder sizes, where placeholder is defined as a square creative with a side of <= 5 pixels\r\n    Look if there are any sizes that are part of the set of supported ad sizes defined here. If there are, choose the largest supported size by area (width * height)\r\n        For clarity, the set of supported ad sizes includes all of the ad sizes listed under “Top-performing ad sizes”, “Other supported ad sizes”, and “Regional ad sizes”.\r\n    If not, choose the largest remaining size (i.e. that isn’t in the list of supported ad sizes) by area (width * height)\r\n   */\r\n  const SUPPORTED_SIZES = [\r\n    [728, 90],\r\n    [336, 280],\r\n    [300, 250],\r\n    [300, 50],\r\n    [160, 600],\r\n    [1024, 768],\r\n    [970, 250],\r\n    [970, 90],\r\n    [768, 1024],\r\n    [480, 320],\r\n    [468, 60],\r\n    [320, 480],\r\n    [320, 100],\r\n    [320, 50],\r\n    [300, 600],\r\n    [300, 100],\r\n    [250, 250],\r\n    [234, 60],\r\n    [200, 200],\r\n    [180, 150],\r\n    [125, 125],\r\n    [120, 600],\r\n    [120, 240],\r\n    [120, 60],\r\n    [88, 31],\r\n    [980, 120],\r\n    [980, 90],\r\n    [950, 90],\r\n    [930, 180],\r\n    [750, 300],\r\n    [750, 200],\r\n    [750, 100],\r\n    [580, 400],\r\n    [250, 360],\r\n    [240, 400],\r\n  ].sort(keyCompare(([w, h]) => -(w * h)))\r\n    .map(size => [size, sizeTupleToSizeString(size)]);\r\n\r\n  return function(next, sizes) {\r\n    if (sizes?.length) {\r\n      const sizeStrings = new Set(sizes.map(sizeTupleToSizeString));\r\n      const preferredSize = SUPPORTED_SIZES.find(([_, sizeStr]) => sizeStrings.has(sizeStr));\r\n      if (preferredSize) {\r\n        next.bail(preferredSize[0]);\r\n        return;\r\n      }\r\n    }\r\n    next(sizes);\r\n  }\r\n})();\r\n\r\nexport function setPAAPIConfigFactory(\r\n  getConfig = (filters) => getPAAPIConfig(filters, true),\r\n  setGptConfig = setComponentAuction,\r\n  getSlots = getGPTSlotsForAdUnits) {\r\n  /**\r\n   * Configure GPT slots with PAAPI auction configs.\r\n   * `filters` are the same filters accepted by `pbjs.getPAAPIConfig`;\r\n   */\r\n  return function(filters = {}, customSlotMatching) {\r\n    let some = false;\r\n    const cfg = getConfig(filters) || {};\r\n    const auToSlots = getSlots(Object.keys(cfg), customSlotMatching);\r\n\r\n    Object.entries(cfg).forEach(([au, config]) => {\r\n      if (config != null) {\r\n        some = true;\r\n      }\r\n      setGptConfig(au, auToSlots[au], config?.componentAuctions || [], true);\r\n    })\r\n    if (!some) {\r\n      logInfo(`${MODULE}: No component auctions available to set`);\r\n    }\r\n  }\r\n}\r\n/**\r\n * Configure GPT slots with PAAPI component auctions. Accepts the same filter arguments as `pbjs.getPAAPIConfig`.\r\n */\r\ngetGlobal().setPAAPIConfigForGPT = setPAAPIConfigFactory();\r\nconst setTargetingHook = setTargetingHookFactory();\r\n\r\nsubmodule('paapi', {\r\n  name: 'gpt',\r\n  init(params) {\r\n    getPAAPIConfig = params.getPAAPIConfig;\r\n    getHook('getPAAPISize').before(getPAAPISizeHook);\r\n  }\r\n});\r\n","import {mergeDeep, deepEqual, deepAccess, deepSetValue, deepClone} from '../../src/utils.js';\r\nimport {ORTB_EIDS_PATHS} from '../../src/activities/redactor.js';\r\n\r\n/**\r\n * Perform a partial pre-merge of bidder config for PBS.\r\n *\r\n * Prebid.js and Prebid Server use different strategies for merging global and bidder-specific config; JS attemps to\r\n * merge arrays (concatenating them, with some deduping, cfr. mergeDeep), while PBS only merges objects -\r\n * a bidder-specific array will replace a global array.\r\n *\r\n * This returns bidder config (from `bidder`) where arrays are replaced with what you get from merging them with `global`,\r\n * so that the result of merging in PBS is the same as in JS.\r\n */\r\nexport function getPBSBidderConfig({global, bidder}) {\r\n  return Object.fromEntries(\r\n    Object.entries(bidder).map(([bidderCode, bidderConfig]) => {\r\n      return [bidderCode, replaceArrays(bidderConfig, mergeDeep({}, global, bidderConfig))]\r\n    })\r\n  )\r\n}\r\n\r\nfunction replaceArrays(config, mergedConfig) {\r\n  return Object.fromEntries(\r\n    Object.entries(config).map(([key, value]) => {\r\n      const mergedValue = mergedConfig[key];\r\n      if (Array.isArray(value)) {\r\n        if (!deepEqual(value, mergedValue) && Array.isArray(mergedValue)) {\r\n          value = mergedValue;\r\n        }\r\n      } else if (value != null && typeof value === 'object') {\r\n        value = replaceArrays(value, mergedValue);\r\n      }\r\n      return [key, value];\r\n    })\r\n  )\r\n}\r\n\r\n/**\r\n * Extract all EIDs from FPD.\r\n *\r\n * Returns {eids, conflicts}, where:\r\n *\r\n *  - `eids` contains an object of the form `{eid, bidders}` for each unique EID object found anywhere in FPD;\r\n *      `bidders` is a list of all the bidders that refer to that specific EID object, or false if that EID object is defined globally.\r\n *   - `conflicts` is a set containing all EID sources that appear in multiple, otherwise different, EID objects.\r\n */\r\nexport function extractEids({global, bidder}) {\r\n  const entries = [];\r\n  const bySource = {};\r\n  const conflicts = new Set()\r\n\r\n  function getEntry(eid) {\r\n    let entry = entries.find((candidate) => deepEqual(candidate.eid, eid));\r\n    if (entry == null) {\r\n      entry = {eid, bidders: new Set()}\r\n      entries.push(entry);\r\n    }\r\n    if (bySource[eid.source] == null) {\r\n      bySource[eid.source] = entry.eid;\r\n    } else if (entry.eid === eid) {\r\n      // if this is the first time we see this eid, but not the first time we see its source, we have a conflict\r\n      conflicts.add(eid.source);\r\n    }\r\n    return entry;\r\n  }\r\n\r\n  ORTB_EIDS_PATHS.forEach(path => {\r\n    (deepAccess(global, path) || []).forEach(eid => {\r\n      getEntry(eid).bidders = false;\r\n    });\r\n  })\r\n  Object.entries(bidder).forEach(([bidderCode, bidderConfig]) => {\r\n    ORTB_EIDS_PATHS.forEach(path => {\r\n      (deepAccess(bidderConfig, path) || []).forEach(eid => {\r\n        const entry = getEntry(eid);\r\n        if (entry.bidders !== false) {\r\n          entry.bidders.add(bidderCode);\r\n        }\r\n      })\r\n    })\r\n  })\r\n  return {eids: entries.map(({eid, bidders}) => ({eid, bidders: bidders && Array.from(bidders)})), conflicts};\r\n}\r\n\r\n/**\r\n * Consolidate extracted EIDs to take advantage of PBS's eidpermissions feature:\r\n * https://docs.prebid.org/prebid-server/endpoints/openrtb2/pbs-endpoint-auction.html#eid-permissions\r\n *\r\n * If different bidders have different EID configurations, in most cases we can avoid repeating it in each bidder's\r\n * specific config. As long as there are no conflicts (different EID objects that refer to the same source constitute a conflict),\r\n * the EID can be set as global, and eidpermissions can restrict its access only to specific bidders.\r\n *\r\n * Returns {global, bidder, permissions}, where:\r\n *  - `global` is a list of global EID objects (some of which may be restricted through `permissions`\r\n *  - `bidder` is a map from bidder code to EID objects that are specific to that bidder, and cannot be restricted through `permissions`\r\n *  - `permissions` is a list of EID permissions as expected by PBS.\r\n */\r\nexport function consolidateEids({eids, conflicts = new Set()}) {\r\n  const globalEntries = [];\r\n  const bidderEntries = [];\r\n  const byBidder = {};\r\n  eids.forEach(eid => {\r\n    (eid.bidders === false ? globalEntries : bidderEntries).push(eid);\r\n  });\r\n  bidderEntries.forEach(({eid, bidders}) => {\r\n    if (!conflicts.has(eid.source)) {\r\n      globalEntries.push({eid, bidders})\r\n    } else {\r\n      bidders.forEach(bidderCode => {\r\n        (byBidder[bidderCode] = byBidder[bidderCode] || []).push(eid)\r\n      })\r\n    }\r\n  });\r\n  return {\r\n    global: globalEntries.map(({eid}) => eid),\r\n    permissions: globalEntries.filter(({bidders}) => bidders !== false).map(({eid, bidders}) => ({\r\n      source: eid.source,\r\n      bidders\r\n    })),\r\n    bidder: byBidder\r\n  }\r\n}\r\n\r\nfunction replaceEids({global, bidder}, requestedBidders) {\r\n  const consolidated = consolidateEids(extractEids({global, bidder}));\r\n  global = deepClone(global);\r\n  bidder = deepClone(bidder);\r\n  function removeEids(target) {\r\n    delete target?.user?.eids;\r\n    delete target?.user?.ext?.eids;\r\n  }\r\n  removeEids(global);\r\n  Object.values(bidder).forEach(removeEids);\r\n  if (consolidated.global.length) {\r\n    deepSetValue(global, 'user.ext.eids', consolidated.global);\r\n  }\r\n  if (requestedBidders?.length) {\r\n    consolidated.permissions.forEach((permission) => {\r\n      permission.bidders = permission.bidders.filter(bidder => requestedBidders.includes(bidder));\r\n    });\r\n  }\r\n  if (consolidated.permissions.length) {\r\n    deepSetValue(global, 'ext.prebid.data.eidpermissions', consolidated.permissions);\r\n  }\r\n  Object.entries(consolidated.bidder).forEach(([bidderCode, bidderEids]) => {\r\n    if (bidderEids.length) {\r\n      deepSetValue(bidder[bidderCode], 'user.ext.eids', bidderEids);\r\n    }\r\n  })\r\n  return {global, bidder}\r\n}\r\n\r\nexport function premergeFpd(ortb2Fragments, requestedBidders) {\r\n  if (ortb2Fragments == null || Object.keys(ortb2Fragments.bidder || {}).length === 0) {\r\n    return ortb2Fragments;\r\n  } else {\r\n    ortb2Fragments = replaceEids(ortb2Fragments, requestedBidders);\r\n    return {\r\n      ...ortb2Fragments,\r\n      bidder: getPBSBidderConfig(ortb2Fragments)\r\n    };\r\n  }\r\n}\r\n","import Adapter from '../../src/adapter.js';\r\nimport {\r\n  compressDataWithGZip,\r\n  debugTurnedOn,\r\n  deepClone,\r\n  flatten,\r\n  generateUUID,\r\n  getParameterByName,\r\n  insertUserSyncIframe,\r\n  isGzipCompressionSupported,\r\n  isNumber,\r\n  isPlainObject,\r\n  isStr,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  triggerPixel,\r\n  uniques,\r\n} from '../../src/utils.js';\r\nimport {DEBUG_MODE, EVENTS, REJECTION_REASON, S2S} from '../../src/constants.js';\r\nimport adapterManager, {s2sActivityParams} from '../../src/adapterManager.js';\r\nimport {config} from '../../src/config.js';\r\nimport {addPaapiConfig, isValid} from '../../src/adapters/bidderFactory.js';\r\nimport * as events from '../../src/events.js';\r\nimport {ajax} from '../../src/ajax.js';\r\nimport {hook} from '../../src/hook.js';\r\nimport {hasPurpose1Consent} from '../../src/utils/gdpr.js';\r\nimport {buildPBSRequest, interpretPBSResponse} from './ortbConverter.js';\r\nimport {useMetrics} from '../../src/utils/perfMetrics.js';\r\nimport {isActivityAllowed} from '../../src/activities/rules.js';\r\nimport {ACTIVITY_TRANSMIT_UFPD} from '../../src/activities/activities.js';\r\nimport type {Identifier, BidderCode} from '../../src/types/common.d.ts';\r\nimport type {Metrics} from \"../../src/utils/perfMetrics.ts\";\r\nimport type {ORTBResponse} from \"../../src/types/ortb/response.d.ts\";\r\nimport type {NativeRequest} from '../../src/types/ortb/native.d.ts';\r\nimport type {SyncType} from \"../../src/userSync.ts\";\r\n\r\nconst getConfig = config.getConfig;\r\n\r\nconst TYPE = S2S.SRC;\r\nlet _syncCount = 0;\r\nlet _s2sConfigs: S2SConfig[];\r\n\r\ntype Endpoint = string | {\r\n  /**\r\n   * Defines the auction endpoint or the cookie_sync endpoint for the Prebid Server cluster for non-consent requests or users who grant consent.\r\n   */\r\n  p1Consent: string;\r\n  /**\r\n   * Defines the auction endpoint or the cookie_sync endpoint for the Prebid Server cluster for users who do not grant consent.\r\n   * (This is useful for a server configured to not accept any cookies to ensure compliance regulations.)\r\n   */\r\n  noP1Consent: string;\r\n};\r\n\r\ntype S2SConfig = {\r\n  /**\r\n   * Your Prebid Server account ID. This is obtained from whoever’s hosting your Prebid Server.\r\n   */\r\n  accountId: string;\r\n  /**\r\n   * A handle for this configuration, used to reference a specific server (when multiple are present) from ad unit configuration\r\n   */\r\n  name?: string;\r\n  /**\r\n   * Which bidders auctions should take place on the server side\r\n   */\r\n  bidders?: BidderCode[];\r\n  /**\r\n   * Allow Prebid Server to bid on behalf of bidders that are not explicitly listed in the adUnit.\r\n   * Defaults to false.\r\n   */\r\n  allowUnknownBidderCodes?: boolean;\r\n  /**\r\n   * Enables this s2sConfig block - defaults to false\r\n   */\r\n  enabled?: boolean;\r\n  /**\r\n   * Number of milliseconds allowed for the server-side auctions.\r\n   * This should be approximately 200ms-300ms less than your Prebid.js timeout to allow for all bids to be returned\r\n   * in a timely manner. Defaults to 75% of bidderTimeout or `maxTimeout`, whichever is lesser.\r\n   */\r\n  timeout?: number;\r\n  /**\r\n   * Upper limit on the default timeout. Defaults to 1500.\r\n   */\r\n  maxTimeout?: number;\r\n  /**\r\n   * Adapter to use to connect to Prebid Server. Defaults to ‘prebidServer’\r\n   */\r\n  adapter?: string;\r\n  /**\r\n   * Defines the auction endpoint for the Prebid Server cluster.\r\n   */\r\n  endpoint: Endpoint;\r\n  /**\r\n   * Defines the cookie_sync endpoint for the Prebid Server cluster.\r\n   */\r\n  syncEndpoint: Endpoint;\r\n  /**\r\n   * Max number of userSync URLs that can be executed by Prebid Server cookie_sync per request.\r\n   * If not defined, PBS will execute all userSync URLs included in the request.\r\n   */\r\n  userSyncLimit?: number;\r\n  /**\r\n   * Maximum number of milliseconds allowed for each server-side userSync to load. Default is 1000.\r\n   */\r\n  syncTimeout?: number;\r\n  /**\r\n   * Functions to modify a bidder’s sync url before the actual call to the sync endpoint.\r\n   * Bidder must be enabled for s2sConfig.\r\n   */\r\n  syncUrlModifier?: {\r\n    [bidder: BidderCode]: (type: SyncType, url: string, bidder: BidderCode) => string;\r\n  };\r\n  /**\r\n   * Whether or not PBS is allowed to perform “cooperative syncing” for bidders not on this page.\r\n   * Publishers help each other improve match rates by allowing this. Default is true.\r\n   */\r\n  coopSync?: boolean;\r\n  /**\r\n   * Configures the default TTL in the Prebid Server adapter to use when Prebid Server does not return a bid TTL.\r\n   * Defaults to 60.\r\n   */\r\n  defaultTTL?: number;\r\n  /**\r\n   * Arguments will be added to resulting OpenRTB payload to Prebid Server in every impression object at request.imp[].ext.BIDDER\r\n   */\r\n  adapterOptions?: { [bidder: BidderCode]: Record<string, unknown> };\r\n  /**\r\n   * Arguments will be added to resulting OpenRTB payload to Prebid Server in request.ext.prebid.\r\n   */\r\n  extPrebid?: Record<string, unknown>;\r\n  /**\r\n   * Base value for imp.native.request\r\n   */\r\n  ortbNative?: Partial<NativeRequest>;\r\n  /**\r\n   * If true, enable gzip compression of outgoing requests.\r\n   */\r\n  endpointCompression?: boolean\r\n  /**\r\n   * If true, exclude ad units that have no bidders defined.\r\n   */\r\n  filterBidderlessCalls?: boolean;\r\n}\r\n\r\nexport const s2sDefaultConfig: Partial<S2SConfig> = {\r\n  bidders: Object.freeze([]) as any,\r\n  syncTimeout: 1000,\r\n  adapter: 'prebidServer',\r\n  allowUnknownBidderCodes: false,\r\n  adapterOptions: {},\r\n  syncUrlModifier: {},\r\n  ortbNative: {\r\n    eventtrackers: [\r\n      {event: 1, methods: [1, 2]}\r\n    ],\r\n  },\r\n  maxTimeout: 1500,\r\n  filterBidderlessCalls: false\r\n};\r\n\r\nconfig.setDefaults({\r\n  's2sConfig': s2sDefaultConfig\r\n});\r\n\r\ndeclare module '../../src/config' {\r\n  interface Config {\r\n    s2sConfig?: S2SConfig | S2SConfig[];\r\n  }\r\n}\r\n\r\nfunction updateConfigDefaults(s2sConfig: S2SConfig) {\r\n  if (s2sConfig.adapter == null) {\r\n    s2sConfig.adapter = 'prebidServer';\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction validateConfigRequiredProps(s2sConfig: S2SConfig) {\r\n  for (const key of ['accountId', 'endpoint']) {\r\n    if (s2sConfig[key] == null) {\r\n      logError(key + ' missing in server to server config');\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n// temporary change to modify the s2sConfig for new format used for endpoint URLs;\r\n// could be removed later as part of a major release, if we decide to not support the old format\r\nfunction formatUrlParams(option) {\r\n  ['endpoint', 'syncEndpoint'].forEach((prop) => {\r\n    if (isStr(option[prop])) {\r\n      const temp = option[prop];\r\n      option[prop] = { p1Consent: temp, noP1Consent: temp };\r\n    }\r\n    if (isPlainObject(option[prop]) && (!option[prop].p1Consent || !option[prop].noP1Consent)) {\r\n      ['p1Consent', 'noP1Consent'].forEach((conUrl) => {\r\n        if (!option[prop][conUrl]) {\r\n          logWarn(`s2sConfig.${prop}.${conUrl} not defined.  PBS request will be skipped in some P1 scenarios.`);\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport function validateConfig(options: S2SConfig[]) {\r\n  if (!options) {\r\n    return;\r\n  }\r\n  options = Array.isArray(options) ? options : [options];\r\n  const activeBidders = new Set();\r\n  return options.filter(s2sConfig => {\r\n    formatUrlParams(s2sConfig);\r\n    if (\r\n      updateConfigDefaults(s2sConfig) &&\r\n      validateConfigRequiredProps(s2sConfig) &&\r\n      s2sConfig.enabled\r\n    ) {\r\n      if (Array.isArray(s2sConfig.bidders)) {\r\n        s2sConfig.bidders = s2sConfig.bidders.filter(bidder => {\r\n          if (activeBidders.has(bidder)) {\r\n            return false;\r\n          } else {\r\n            activeBidders.add(bidder);\r\n            return true;\r\n          }\r\n        })\r\n      }\r\n      return true;\r\n    } else {\r\n      logWarn('prebidServer: s2s config is disabled', s2sConfig);\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * @param {(S2SConfig[]|S2SConfig)} options\r\n */\r\nfunction setS2sConfig(options) {\r\n  options = validateConfig(options);\r\n  if (options.length) {\r\n    _s2sConfigs = options;\r\n  }\r\n}\r\ngetConfig('s2sConfig', ({s2sConfig}) => setS2sConfig(s2sConfig));\r\n\r\n/**\r\n * resets the _synced variable back to false, primiarily used for testing purposes\r\n */\r\nexport function resetSyncedStatus() {\r\n  _syncCount = 0;\r\n}\r\n\r\n/**\r\n * @param  {Array} bidderCodes list of bidders to request user syncs for.\r\n */\r\nfunction queueSync(bidderCodes, gdprConsent, uspConsent, gppConsent, s2sConfig: S2SConfig) {\r\n  if (_s2sConfigs.length === _syncCount) {\r\n    return;\r\n  }\r\n  _syncCount++;\r\n\r\n  let filterSettings = {};\r\n  const userSyncFilterSettings = getConfig('userSync.filterSettings');\r\n\r\n  if (userSyncFilterSettings) {\r\n    const { all, iframe, image } = userSyncFilterSettings;\r\n    const ifrm = iframe || all;\r\n    const img = image || all;\r\n\r\n    if (ifrm) filterSettings = Object.assign({ iframe: ifrm }, filterSettings);\r\n    if (img) filterSettings = Object.assign({ image: img }, filterSettings);\r\n  }\r\n\r\n  const payload: any = {\r\n    uuid: generateUUID(),\r\n    bidders: bidderCodes,\r\n    account: s2sConfig.accountId,\r\n    filterSettings\r\n  };\r\n\r\n  const userSyncLimit = s2sConfig.userSyncLimit;\r\n  if (isNumber(userSyncLimit) && userSyncLimit > 0) {\r\n    payload['limit'] = userSyncLimit;\r\n  }\r\n\r\n  if (gdprConsent) {\r\n    payload.gdpr = (gdprConsent.gdprApplies) ? 1 : 0;\r\n    // attempt to populate gdpr_consent if we know gdprApplies or it may apply\r\n    if (gdprConsent.gdprApplies !== false) {\r\n      payload.gdpr_consent = gdprConsent.consentString;\r\n    }\r\n  }\r\n\r\n  // US Privacy (CCPA) support\r\n  if (uspConsent) {\r\n    payload.us_privacy = uspConsent;\r\n  }\r\n\r\n  if (gppConsent) {\r\n    payload.gpp_sid = gppConsent.applicableSections.join();\r\n    // should we add check if applicableSections was not equal to -1 (where user was out of scope)?\r\n    //   this would be similar to what was done above for TCF\r\n    payload.gpp = gppConsent.gppString;\r\n  }\r\n\r\n  if (typeof s2sConfig.coopSync === 'boolean') {\r\n    payload.coopSync = s2sConfig.coopSync;\r\n  }\r\n\r\n  const jsonPayload = JSON.stringify(payload);\r\n  ajax(getMatchingConsentUrl(s2sConfig.syncEndpoint, gdprConsent),\r\n    (response) => {\r\n      try {\r\n        const responseJson = JSON.parse(response);\r\n        doAllSyncs(responseJson.bidder_status, s2sConfig);\r\n      } catch (e) {\r\n        logError(e);\r\n      }\r\n    },\r\n    jsonPayload,\r\n    {\r\n      contentType: 'text/plain',\r\n      withCredentials: true\r\n    });\r\n}\r\n\r\nfunction doAllSyncs(bidders, s2sConfig) {\r\n  if (bidders.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // pull the syncs off the list in the order that prebid server sends them\r\n  const thisSync = bidders.shift();\r\n\r\n  // if PBS reports this bidder doesn't have an ID, then call the sync and recurse to the next sync entry\r\n  if (thisSync.no_cookie) {\r\n    doPreBidderSync(thisSync.usersync.type, thisSync.usersync.url, thisSync.bidder, doAllSyncs.bind(null, bidders, s2sConfig), s2sConfig);\r\n  } else {\r\n    // bidder already has an ID, so just recurse to the next sync entry\r\n    doAllSyncs(bidders, s2sConfig);\r\n  }\r\n}\r\n\r\n/**\r\n * Modify the cookie sync url from prebid server to add new params.\r\n *\r\n * @param {string} type the type of sync, \"image\", \"redirect\", \"iframe\"\r\n * @param {string} url the url to sync\r\n * @param {string} bidder name of bidder doing sync for\r\n * @param {function} done an exit callback; to signify this pixel has either: finished rendering or something went wrong\r\n * @param {S2SConfig} s2sConfig\r\n */\r\nfunction doPreBidderSync(type, url, bidder, done, s2sConfig) {\r\n  if (s2sConfig.syncUrlModifier && typeof s2sConfig.syncUrlModifier[bidder] === 'function') {\r\n    url = s2sConfig.syncUrlModifier[bidder](type, url, bidder);\r\n  }\r\n  doBidderSync(type, url, bidder, done, s2sConfig.syncTimeout)\r\n}\r\n\r\n/**\r\n * Run a cookie sync for the given type, url, and bidder\r\n *\r\n * @param {string} type the type of sync, \"image\", \"redirect\", \"iframe\"\r\n * @param {string} url the url to sync\r\n * @param {string} bidder name of bidder doing sync for\r\n * @param {function} done an exit callback; to signify this pixel has either: finished rendering or something went wrong\r\n * @param {number} timeout maximum time to wait for rendering in milliseconds\r\n */\r\nfunction doBidderSync(type, url, bidder, done, timeout) {\r\n  if (!url) {\r\n    logError(`No sync url for bidder \"${bidder}\": ${url}`);\r\n    done();\r\n  } else if (type === 'image' || type === 'redirect') {\r\n    logMessage(`Invoking image pixel user sync for bidder: \"${bidder}\"`);\r\n    triggerPixel(url, done, timeout);\r\n  } else if (type === 'iframe') {\r\n    logMessage(`Invoking iframe user sync for bidder: \"${bidder}\"`);\r\n    insertUserSyncIframe(url, done, timeout);\r\n  } else {\r\n    logError(`User sync type \"${type}\" not supported for bidder: \"${bidder}\"`);\r\n    done();\r\n  }\r\n}\r\n\r\n/**\r\n * Do client-side syncs for bidders.\r\n *\r\n * @param {Array} bidders a list of bidder names\r\n */\r\nfunction doClientSideSyncs(bidders, gdprConsent, uspConsent, gppConsent) {\r\n  bidders.forEach(bidder => {\r\n    const clientAdapter = adapterManager.getBidAdapter(bidder);\r\n    if (clientAdapter && clientAdapter.registerSyncs) {\r\n      config.runWithBidder(\r\n        bidder,\r\n        clientAdapter.registerSyncs.bind(\r\n          clientAdapter,\r\n          [],\r\n          gdprConsent,\r\n          uspConsent,\r\n          gppConsent\r\n        )\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\nfunction getMatchingConsentUrl(urlProp, gdprConsent) {\r\n  const hasPurpose = hasPurpose1Consent(gdprConsent);\r\n  const url = hasPurpose ? urlProp.p1Consent : urlProp.noP1Consent\r\n  if (!url) {\r\n    logWarn('Missing matching consent URL when gdpr=' + hasPurpose);\r\n  }\r\n  return url;\r\n}\r\n\r\nfunction getConsentData(bidRequests) {\r\n  let gdprConsent, uspConsent, gppConsent;\r\n  if (Array.isArray(bidRequests) && bidRequests.length > 0) {\r\n    gdprConsent = bidRequests[0].gdprConsent;\r\n    uspConsent = bidRequests[0].uspConsent;\r\n    gppConsent = bidRequests[0].gppConsent;\r\n  }\r\n  return { gdprConsent, uspConsent, gppConsent };\r\n}\r\n\r\nexport type SeatNonBid = {\r\n  /**\r\n   * Auction ID associated with the PBS response.\r\n   */\r\n  auctionId: Identifier;\r\n  /**\r\n   * The PBS response's `ext.seatnonbid`.\r\n   */\r\n  seatnonbid: unknown;\r\n  /**\r\n   * Bidders that were included in the request to PBS.\r\n   */\r\n  requestedBidders: BidderCode[];\r\n  /**\r\n   * PBS response data.\r\n   */\r\n  response: ORTBResponse;\r\n  adapterMetrics: Metrics;\r\n}\r\n\r\nexport type PbsAnalytics = SeatNonBid & {\r\n  /**\r\n   * The PBS response's `ext.prebid.analytics.tags`.\r\n   */\r\n  atag: unknown;\r\n}\r\n\r\ndeclare module '../../src/events' {\r\n  interface Events {\r\n    [EVENTS.SEAT_NON_BID]: [SeatNonBid];\r\n    [EVENTS.PBS_ANALYTICS]: [PbsAnalytics];\r\n    [EVENTS.BEFORE_PBS_HTTP]: [PbsRequestData];\r\n  }\r\n}\r\n\r\n/**\r\n * Bidder adapter for Prebid Server\r\n */\r\nexport function PrebidServer() {\r\n  const baseAdapter: any = Adapter('prebidServer');\r\n\r\n  /* Prebid executes this function when the page asks to send out bid requests */\r\n  baseAdapter.callBids = function(s2sBidRequest, bidRequests, addBidResponse, done, ajax) {\r\n    const adapterMetrics = s2sBidRequest.metrics = useMetrics(bidRequests?.[0]?.metrics)\r\n      .newMetrics()\r\n      .renameWith((n) => [`adapter.s2s.${n}`, `adapters.s2s.${s2sBidRequest.s2sConfig.defaultVendor}.${n}`])\r\n    done = adapterMetrics.startTiming('total').stopBefore(done);\r\n    bidRequests.forEach(req => useMetrics(req.metrics).join(adapterMetrics, {stopPropagation: true}));\r\n\r\n    const { gdprConsent, uspConsent, gppConsent } = getConsentData(bidRequests);\r\n\r\n    if (Array.isArray(_s2sConfigs)) {\r\n      if (s2sBidRequest.s2sConfig && s2sBidRequest.s2sConfig.syncEndpoint && getMatchingConsentUrl(s2sBidRequest.s2sConfig.syncEndpoint, gdprConsent)) {\r\n        const s2sAliases = (s2sBidRequest.s2sConfig.extPrebid && s2sBidRequest.s2sConfig.extPrebid.aliases) ?? {};\r\n        const syncBidders = s2sBidRequest.s2sConfig.bidders\r\n          .map(bidder => adapterManager.aliasRegistry[bidder] || s2sAliases[bidder] || bidder)\r\n          .filter((bidder, index, array) => (array.indexOf(bidder) === index));\r\n\r\n        queueSync(syncBidders, gdprConsent, uspConsent, gppConsent, s2sBidRequest.s2sConfig);\r\n      }\r\n\r\n      processPBSRequest(s2sBidRequest, bidRequests, ajax, {\r\n        onResponse: function (isValid, requestedBidders, response) {\r\n          if (isValid) {\r\n            bidRequests.forEach(bidderRequest => events.emit(EVENTS.BIDDER_DONE, bidderRequest));\r\n          }\r\n          const { seatNonBidData, atagData } = getAnalyticsFlags(s2sBidRequest.s2sConfig, response)\r\n          if (seatNonBidData) {\r\n            events.emit(EVENTS.SEAT_NON_BID, {\r\n              seatnonbid: response.ext.seatnonbid,\r\n              auctionId: bidRequests[0].auctionId,\r\n              requestedBidders,\r\n              response,\r\n              adapterMetrics\r\n            });\r\n          }\r\n          // pbs analytics event\r\n          if (seatNonBidData || atagData) {\r\n            const data: PbsAnalytics = {\r\n              seatnonbid: seatNonBidData,\r\n              atag: atagData,\r\n              auctionId: bidRequests[0].auctionId,\r\n              requestedBidders,\r\n              response,\r\n              adapterMetrics\r\n            }\r\n            events.emit(EVENTS.PBS_ANALYTICS, data);\r\n          }\r\n          done(false);\r\n          doClientSideSyncs(requestedBidders, gdprConsent, uspConsent, gppConsent);\r\n        },\r\n        onError(msg, error) {\r\n          const {p1Consent = '', noP1Consent = ''} = s2sBidRequest?.s2sConfig?.endpoint || {};\r\n          if (p1Consent === noP1Consent) {\r\n            logError(`Prebid server call failed: '${msg}'. Endpoint: \"${p1Consent}\"}`, error);\r\n          } else {\r\n            logError(`Prebid server call failed: '${msg}'. Endpoints: p1Consent \"${p1Consent}\", noP1Consent \"${noP1Consent}\"}`, error);\r\n          }\r\n          bidRequests.forEach(bidderRequest => events.emit(EVENTS.BIDDER_ERROR, { error, bidderRequest }));\r\n          done(error.timedOut);\r\n        },\r\n        onBid: function ({adUnit, bid}) {\r\n          const metrics = bid.metrics = s2sBidRequest.metrics.fork().renameWith();\r\n          metrics.checkpoint('addBidResponse');\r\n          if ((bid.requestId == null || bid.requestBidder == null) && !s2sBidRequest.s2sConfig.allowUnknownBidderCodes) {\r\n            logWarn(`PBS adapter received bid from unknown bidder (${bid.bidder}), but 's2sConfig.allowUnknownBidderCodes' is not set. Ignoring bid.`);\r\n            addBidResponse.reject(adUnit, bid, REJECTION_REASON.BIDDER_DISALLOWED);\r\n          } else {\r\n            if (metrics.measureTime('addBidResponse.validate', () => isValid(adUnit, bid))) {\r\n              addBidResponse(adUnit, bid);\r\n            } else {\r\n              addBidResponse.reject(adUnit, bid, REJECTION_REASON.INVALID);\r\n            }\r\n          }\r\n        },\r\n        onFledge: (params) => {\r\n          config.runWithBidder(params.bidder, () => {\r\n            addPaapiConfig({auctionId: bidRequests[0].auctionId, ...params}, {config: params.config});\r\n          })\r\n        }\r\n      })\r\n    }\r\n  };\r\n\r\n  Object.assign(this, {\r\n    callBids: baseAdapter.callBids,\r\n    setBidderCode: baseAdapter.setBidderCode,\r\n    type: TYPE\r\n  });\r\n}\r\n\r\ntype PbsRequestData = {\r\n  endpointUrl: string;\r\n  requestJson: string;\r\n  customHeaders: Record<string, string>;\r\n}\r\n\r\n/**\r\n * Build and send the appropriate HTTP request over the network, then interpret the response.\r\n * @param s2sBidRequest\r\n * @param bidRequests\r\n * @param ajax\r\n * @param onResponse {function(boolean, Array[String])} invoked on a successful HTTP response - with a flag indicating whether it was successful,\r\n * and a list of the unique bidder codes that were sent in the request\r\n * @param onError {function(String, {})} invoked on HTTP failure - with status message and XHR error\r\n * @param onBid {function({})} invoked once for each bid in the response - with the bid as returned by interpretResponse\r\n */\r\nexport const processPBSRequest = hook('async', function (s2sBidRequest, bidRequests, ajax, {onResponse, onError, onBid, onFledge}) {\r\n  const { gdprConsent } = getConsentData(bidRequests);\r\n  const adUnits = deepClone(s2sBidRequest.ad_units);\r\n\r\n  // in case config.bidders contains invalid bidders, we only process those we sent requests for\r\n  const requestedBidders = adUnits\r\n    .map(adUnit => adUnit.bids.map(bid => bid.bidder).filter(uniques))\r\n    .reduce(flatten, [])\r\n    .filter(uniques);\r\n\r\n  const request = s2sBidRequest.metrics.measureTime('buildRequests', () => buildPBSRequest(s2sBidRequest, bidRequests, adUnits, requestedBidders));\r\n  const requestData: PbsRequestData = {\r\n    endpointUrl: getMatchingConsentUrl(s2sBidRequest.s2sConfig.endpoint, gdprConsent),\r\n    requestJson: request && JSON.stringify(request),\r\n    customHeaders: s2sBidRequest?.s2sConfig?.customHeaders ?? {},\r\n  };\r\n  events.emit(EVENTS.BEFORE_PBS_HTTP, requestData)\r\n  logInfo('BidRequest: ' + requestData);\r\n  if (request && requestData.requestJson && requestData.endpointUrl) {\r\n    const callAjax = (payload, endpointUrl) => {\r\n      const networkDone = s2sBidRequest.metrics.startTiming('net');\r\n      ajax(\r\n        endpointUrl,\r\n        {\r\n          success: function (response) {\r\n            networkDone();\r\n            let result;\r\n            try {\r\n              result = JSON.parse(response);\r\n              const {bids, paapi} = s2sBidRequest.metrics.measureTime('interpretResponse', () => interpretPBSResponse(result, request));\r\n              bids.forEach(onBid);\r\n              if (paapi) {\r\n                paapi.forEach(onFledge);\r\n              }\r\n            } catch (error) {\r\n              logError(error);\r\n            }\r\n            if (!result || (result.status && result.status.includes('Error'))) {\r\n              logError('error parsing response: ', result ? result.status : 'not valid JSON');\r\n              onResponse(false, requestedBidders);\r\n            } else {\r\n              onResponse(true, requestedBidders, result);\r\n            }\r\n          },\r\n          error: function (...args) {\r\n            networkDone();\r\n            onError.apply(this, args);\r\n          }\r\n        },\r\n        payload,\r\n        {\r\n          contentType: 'text/plain',\r\n          withCredentials: true,\r\n          browsingTopics: isActivityAllowed(ACTIVITY_TRANSMIT_UFPD, s2sActivityParams(s2sBidRequest.s2sConfig)),\r\n          customHeaders: requestData.customHeaders\r\n        }\r\n      );\r\n    }\r\n\r\n    const enableGZipCompression = s2sBidRequest.s2sConfig.endpointCompression && !requestData.customHeaders['Content-Encoding'];\r\n    const debugMode = getParameterByName(DEBUG_MODE).toUpperCase() === 'TRUE' || debugTurnedOn();\r\n    if (enableGZipCompression && debugMode) {\r\n      logWarn('Skipping GZIP compression for PBS as debug mode is enabled');\r\n    }\r\n\r\n    if (enableGZipCompression && !debugMode && isGzipCompressionSupported()) {\r\n      compressDataWithGZip(requestData.requestJson).then(compressedPayload => {\r\n        const url = new URL(requestData.endpointUrl);\r\n        url.searchParams.set('gzip', '1');\r\n        callAjax(compressedPayload, url.href);\r\n      });\r\n    } else {\r\n      callAjax(requestData.requestJson, requestData.endpointUrl);\r\n    }\r\n  } else {\r\n    logError('PBS request not made.  Check endpoints.');\r\n  }\r\n}, 'processPBSRequest');\r\n\r\nfunction getAnalyticsFlags(s2sConfig, response) {\r\n  return {\r\n    atagData: getAtagData(response),\r\n    seatNonBidData: getNonBidData(s2sConfig, response)\r\n  }\r\n}\r\nfunction getNonBidData(s2sConfig, response) {\r\n  return s2sConfig?.extPrebid?.returnallbidstatus ? response?.ext?.seatnonbid : undefined;\r\n}\r\n\r\nfunction getAtagData(response) {\r\n  return response?.ext?.prebid?.analytics?.tags;\r\n}\r\n\r\nadapterManager.registerBidAdapter(new PrebidServer(), 'prebidServer');\r\n","import {ortbConverter} from '../../libraries/ortbConverter/converter.js';\r\nimport {deepClone, deepSetValue, getBidRequest, logError, logWarn, mergeDeep, timestamp} from '../../src/utils.js';\r\nimport {config} from '../../src/config.js';\r\nimport {S2S} from '../../src/constants.js';\r\nimport {createBid} from '../../src/bidfactory.js';\r\nimport {pbsExtensions} from '../../libraries/pbsExtensions/pbsExtensions.js';\r\nimport {setImpBidParams} from '../../libraries/pbsExtensions/processors/params.js';\r\nimport {SUPPORTED_MEDIA_TYPES} from '../../libraries/pbsExtensions/processors/mediaType.js';\r\nimport {IMP, REQUEST, RESPONSE} from '../../src/pbjsORTB.js';\r\nimport {redactor} from '../../src/activities/redactor.js';\r\nimport {s2sActivityParams} from '../../src/adapterManager.js';\r\nimport {activityParams} from '../../src/activities/activityParams.js';\r\nimport {MODULE_TYPE_BIDDER} from '../../src/activities/modules.js';\r\nimport {isActivityAllowed} from '../../src/activities/rules.js';\r\nimport {ACTIVITY_TRANSMIT_TID} from '../../src/activities/activities.js';\r\nimport {currencyCompare} from '../../libraries/currencyUtils/currency.js';\r\nimport {minimum} from '../../src/utils/reducers.js';\r\nimport {s2sDefaultConfig} from './index.js';\r\nimport {premergeFpd} from './bidderConfig.js';\r\nimport {ALL_MEDIATYPES, BANNER} from '../../src/mediaTypes.js';\r\n\r\nconst DEFAULT_S2S_TTL = 60;\r\nconst DEFAULT_S2S_CURRENCY = 'USD';\r\nconst DEFAULT_S2S_NETREVENUE = true;\r\nconst BIDDER_SPECIFIC_REQUEST_PROPS = new Set(['bidderCode', 'bidderRequestId', 'uniquePbsTid', 'bids', 'timeout']);\r\n\r\nconst getMinimumFloor = (() => {\r\n  const getMin = minimum(currencyCompare(floor => [floor.bidfloor, floor.bidfloorcur]));\r\n  return function(candidates) {\r\n    let min;\r\n    for (const candidate of candidates) {\r\n      if (candidate?.bidfloorcur == null || candidate?.bidfloor == null) return null;\r\n      min = min == null ? candidate : getMin(min, candidate);\r\n    }\r\n    return min;\r\n  }\r\n})();\r\n\r\nconst PBS_CONVERTER = ortbConverter({\r\n  processors: pbsExtensions,\r\n  context: {\r\n    netRevenue: DEFAULT_S2S_NETREVENUE,\r\n  },\r\n  imp(buildImp, proxyBidRequest, context) {\r\n    Object.assign(context, proxyBidRequest.pbsData);\r\n    const imp = buildImp(proxyBidRequest, context);\r\n    (proxyBidRequest.bids || []).forEach(bid => {\r\n      if (bid.ortb2Imp && Object.keys(bid.ortb2Imp).length > 0) {\r\n        // set bidder-level imp attributes; see https://github.com/prebid/prebid-server/issues/2335\r\n        deepSetValue(imp, `ext.prebid.imp.${bid.bidder}`, bid.ortb2Imp);\r\n      }\r\n    });\r\n    if (Object.values(SUPPORTED_MEDIA_TYPES).some(mtype => imp[mtype])) {\r\n      imp.secure = proxyBidRequest.ortb2Imp?.secure ?? 1;\r\n      return imp;\r\n    }\r\n  },\r\n  request(buildRequest, imps, proxyBidderRequest, context) {\r\n    if (!imps.length) {\r\n      logError('Request to Prebid Server rejected due to invalid media type(s) in adUnit.');\r\n    } else {\r\n      const {s2sBidRequest} = context;\r\n      const request = buildRequest(imps, proxyBidderRequest, context);\r\n\r\n      request.tmax = Math.floor(s2sBidRequest.s2sConfig.timeout ?? Math.min(s2sBidRequest.requestBidsTimeout * 0.75, s2sBidRequest.s2sConfig.maxTimeout ?? s2sDefaultConfig.maxTimeout));\r\n      request.ext.tmaxmax = request.ext.tmaxmax || s2sBidRequest.requestBidsTimeout;\r\n\r\n      [request.app, request.dooh, request.site].forEach(section => {\r\n        if (section && !section.publisher?.id) {\r\n          deepSetValue(section, 'publisher.id', s2sBidRequest.s2sConfig.accountId);\r\n        }\r\n      })\r\n\r\n      if (!context.transmitTids) {\r\n        deepSetValue(request, 'ext.prebid.createtids', false);\r\n      }\r\n\r\n      return request;\r\n    }\r\n  },\r\n  bidResponse(buildBidResponse, bid, context) {\r\n    // before sending the response throgh \"stock\" ortb conversion, here we need to:\r\n    // - filter out ones that come from an \"unknown\" bidder (if allowUnknownBidderCode is not set)\r\n    // - overwrite context.bidRequest with the actual bid request for this seat / imp combination\r\n\r\n    let bidRequest = context.actualBidRequests.get(context.seatbid.seat);\r\n    if (bidRequest == null) {\r\n      // for stored impressions, a request was made with bidder code `null`. Pick it up here so that NO_BID, BID_WON, etc events\r\n      // can work as expected (otherwise, the original request will always result in NO_BID).\r\n      bidRequest = context.actualBidRequests.get(null);\r\n    }\r\n\r\n    if (bidRequest) {\r\n      Object.assign(context, {\r\n        bidRequest,\r\n        bidderRequest: context.actualBidderRequests.find(req => req.bidderCode === bidRequest.bidder)\r\n      })\r\n    }\r\n\r\n    const bidResponse = buildBidResponse(bid, context);\r\n    bidResponse.requestBidder = bidRequest?.bidder;\r\n\r\n    if (bidResponse.native?.ortb) {\r\n      // TODO: do we need to set bidResponse.adm here?\r\n      // Any consumers can now get the same object from bidResponse.native.ortb;\r\n      // I could not find any, which raises the question - who is looking for this?\r\n      bidResponse.adm = bidResponse.native.ortb;\r\n    }\r\n\r\n    // because core has special treatment for PBS adapter responses, we need some additional processing\r\n    bidResponse.requestTimestamp = context.requestTimestamp;\r\n    return {\r\n      bid: Object.assign(createBid({\r\n        src: S2S.SRC,\r\n        bidId: bidRequest ? (bidRequest.bidId || bidRequest.bid_Id) : null,\r\n        transactionId: context.adUnit.transactionId,\r\n        adUnitId: context.adUnit.adUnitId,\r\n        auctionId: context.bidderRequest.auctionId,\r\n      }), bidResponse, {\r\n        deferRendering: !!context.adUnit.deferBilling,\r\n        deferBilling: !!context.adUnit.deferBilling\r\n      }),\r\n      adUnit: context.adUnit.code\r\n    };\r\n  },\r\n  overrides: {\r\n    [IMP]: {\r\n      id(orig, imp, proxyBidRequest, context) {\r\n        imp.id = context.impId;\r\n      },\r\n      params(orig, imp, proxyBidRequest, context) {\r\n        // override params processing to do it for each bidRequest in this imp;\r\n        // also, take overrides from s2sConfig.adapterOptions\r\n        const adapterOptions = context.s2sBidRequest.s2sConfig.adapterOptions;\r\n        for (const req of context.actualBidRequests.values()) {\r\n          setImpBidParams(imp, req, context, context);\r\n          if (adapterOptions && adapterOptions[req.bidder]) {\r\n            Object.assign(imp.ext.prebid.bidder[req.bidder], adapterOptions[req.bidder]);\r\n          }\r\n        }\r\n      },\r\n      // for bid floors, we pass each bidRequest associated with this imp through normal bidfloor/extBidfloor processing,\r\n      // and aggregate all of them into a single, minimum floor to put in the request\r\n      bidfloor(orig, imp, proxyBidRequest, context) {\r\n        const min = getMinimumFloor((function * () {\r\n          for (const req of context.actualBidRequests.values()) {\r\n            const floor = {};\r\n            orig(floor, req, context);\r\n            yield floor;\r\n          }\r\n        })())\r\n        if (min != null) {\r\n          Object.assign(imp, min);\r\n        }\r\n      },\r\n      extBidfloor(orig, imp, proxyBidRequest, context) {\r\n        function setExtFloor(target, minFloor) {\r\n          if (minFloor != null) {\r\n            deepSetValue(target, 'ext.bidfloor', minFloor.bidfloor);\r\n            deepSetValue(target, 'ext.bidfloorcur', minFloor.bidfloorcur);\r\n          }\r\n        }\r\n        const imps = Array.from(context.actualBidRequests.values())\r\n          .map(request => {\r\n            const requestImp = deepClone(imp);\r\n            orig(requestImp, request, context);\r\n            return requestImp;\r\n          });\r\n        Object.values(ALL_MEDIATYPES).forEach(mediaType => {\r\n          setExtFloor(imp[mediaType], getMinimumFloor(imps.map(imp => imp[mediaType]?.ext)))\r\n        });\r\n        (imp[BANNER]?.format || []).forEach((format, i) => {\r\n          setExtFloor(format, getMinimumFloor(imps.map(imp => imp[BANNER].format[i]?.ext)))\r\n        })\r\n      }\r\n    },\r\n    [REQUEST]: {\r\n      fpd(orig, ortbRequest, proxyBidderRequest, context) {\r\n        // FPD is handled different for PBS - the base request will only contain global FPD;\r\n        // bidder-specific values are set in ext.prebid.bidderconfig\r\n\r\n        if (context.transmitTids) {\r\n          deepSetValue(ortbRequest, 'source.tid', proxyBidderRequest.auctionId);\r\n        }\r\n\r\n        mergeDeep(ortbRequest, context.s2sBidRequest.ortb2Fragments?.global);\r\n\r\n        // also merge in s2sConfig.extPrebid\r\n        if (context.s2sBidRequest.s2sConfig.extPrebid && typeof context.s2sBidRequest.s2sConfig.extPrebid === 'object') {\r\n          deepSetValue(ortbRequest, 'ext.prebid', mergeDeep(ortbRequest.ext?.prebid || {}, context.s2sBidRequest.s2sConfig.extPrebid));\r\n        }\r\n\r\n        // for global FPD, check allowed activities against \"prebid.pbsBidAdapter\"...\r\n        context.getRedactor().ortb2(ortbRequest);\r\n\r\n        const fpdConfigs = Object.entries(context.s2sBidRequest.ortb2Fragments?.bidder || {}).filter(([bidder]) => {\r\n          const bidders = context.s2sBidRequest.s2sConfig.bidders;\r\n          const allowUnknownBidderCodes = context.s2sBidRequest.s2sConfig.allowUnknownBidderCodes;\r\n          return allowUnknownBidderCodes || (bidders && bidders.includes(bidder));\r\n        }).map(([bidder, ortb2]) => ({\r\n          // ... but for bidder specific FPD we can use the actual bidder\r\n          bidders: [bidder],\r\n          config: {ortb2: context.getRedactor(bidder).ortb2(ortb2)}\r\n        }));\r\n        if (fpdConfigs.length) {\r\n          deepSetValue(ortbRequest, 'ext.prebid.bidderconfig', fpdConfigs);\r\n        }\r\n\r\n        // Handle schain information after FPD processing\r\n        // Collect schains from bidder requests and organize into ext.prebid.schains\r\n        let chains = ortbRequest?.ext?.prebid?.schains || [];\r\n        const chainBidders = new Set(chains.flatMap((item) => item.bidders));\r\n\r\n        chains = Object.values(\r\n          chains\r\n            .concat(context.actualBidderRequests\r\n              .filter((req) => !chainBidders.has(req.bidderCode)) // schain defined in s2sConfig.extPrebid takes precedence\r\n              .map((req) => ({\r\n                bidders: [req.bidderCode],\r\n                schain: req?.bids?.[0]?.ortb2?.source?.schain\r\n              })))\r\n            .filter(({bidders, schain}) => bidders?.length > 0 && schain)\r\n            .reduce((chains, {bidders, schain}) => {\r\n              const key = JSON.stringify(schain);\r\n              if (!chains.hasOwnProperty(key)) {\r\n                chains[key] = {bidders: new Set(), schain};\r\n              }\r\n              bidders.forEach((bidder) => chains[key].bidders.add(bidder));\r\n              return chains;\r\n            }, {})\r\n        ).map(({bidders, schain}) => ({bidders: Array.from(bidders), schain}));\r\n\r\n        if (chains.length) {\r\n          deepSetValue(ortbRequest, 'ext.prebid.schains', chains);\r\n        }\r\n      },\r\n      extPrebidAliases(orig, ortbRequest, proxyBidderRequest, context) {\r\n        // override alias processing to do it for each bidder in the request\r\n        context.actualBidderRequests.forEach(req => orig(ortbRequest, req, context));\r\n      }\r\n    },\r\n    [RESPONSE]: {\r\n      serverSideStats(orig, response, ortbResponse, context) {\r\n        // override to process each request\r\n        context.actualBidderRequests.forEach(req => orig(response, ortbResponse, {...context, bidderRequest: req, bidRequests: req.bids}));\r\n      },\r\n      paapiConfigs(orig, response, ortbResponse, context) {\r\n        const configs = Object.values(context.impContext)\r\n          .flatMap((impCtx) => (impCtx.paapiConfigs || []).map(cfg => {\r\n            const bidderReq = impCtx.actualBidderRequests.find(br => br.bidderCode === cfg.bidder);\r\n            const bidReq = impCtx.actualBidRequests.get(cfg.bidder);\r\n            return {\r\n              adUnitCode: impCtx.adUnit.code,\r\n              ortb2: bidderReq?.ortb2,\r\n              ortb2Imp: bidReq?.ortb2Imp,\r\n              bidder: cfg.bidder,\r\n              config: cfg.config\r\n            };\r\n          }));\r\n        if (configs.length > 0) {\r\n          response.paapi = configs;\r\n        }\r\n      }\r\n    }\r\n  },\r\n});\r\n\r\nexport function buildPBSRequest(s2sBidRequest, bidderRequests, adUnits, requestedBidders) {\r\n  const requestTimestamp = timestamp();\r\n  const impIds = new Set();\r\n  const proxyBidRequests = [];\r\n  const s2sParams = s2sActivityParams(s2sBidRequest.s2sConfig);\r\n\r\n  const getRedactor = (() => {\r\n    const global = redactor(s2sParams);\r\n    const bidders = {};\r\n    return (bidder) => {\r\n      if (bidder == null) return global;\r\n      if (!bidders.hasOwnProperty(bidder)) {\r\n        bidders[bidder] = redactor(activityParams(MODULE_TYPE_BIDDER, bidder));\r\n      }\r\n      return bidders[bidder]\r\n    }\r\n  })();\r\n\r\n  adUnits = adUnits.map((au) => getRedactor().bidRequest(au))\r\n\r\n  adUnits.forEach(adUnit => {\r\n    const actualBidRequests = new Map();\r\n    adUnits.bids = adUnit.bids.map(br => getRedactor(br.bidder).bidRequest(br));\r\n    adUnit.bids.forEach((bid) => {\r\n      if (bid.mediaTypes != null) {\r\n        // TODO: support labels / conditional bids\r\n        // for now, just warn about them\r\n        logWarn(`Prebid Server adapter does not (yet) support bidder-specific mediaTypes for the same adUnit. Size mapping configuration will be ignored for adUnit: ${adUnit.code}, bidder: ${bid.bidder}`);\r\n      }\r\n      actualBidRequests.set(bid.bidder, getBidRequest(bid.bid_id, bidderRequests));\r\n    });\r\n\r\n    let impId = adUnit.code;\r\n    let i = 1;\r\n    while (impIds.has(impId)) {\r\n      i++;\r\n      impId = `${adUnit.code}-${i}`;\r\n    }\r\n    impIds.add(impId)\r\n    proxyBidRequests.push({\r\n      ...adUnit,\r\n      adUnitCode: adUnit.code,\r\n      pbsData: {impId, actualBidRequests, adUnit},\r\n    });\r\n  });\r\n\r\n  const proxyBidderRequest = {\r\n    ...Object.fromEntries(Object.entries(bidderRequests[0]).filter(([k]) => !BIDDER_SPECIFIC_REQUEST_PROPS.has(k))),\r\n    paapi: {\r\n      enabled: bidderRequests.some(br => br.paapi?.enabled)\r\n    }\r\n  }\r\n\r\n  return PBS_CONVERTER.toORTB({\r\n    bidderRequest: proxyBidderRequest,\r\n    bidRequests: proxyBidRequests,\r\n    context: {\r\n      currency: config.getConfig('currency.adServerCurrency') || DEFAULT_S2S_CURRENCY,\r\n      ttl: s2sBidRequest.s2sConfig.defaultTtl || DEFAULT_S2S_TTL,\r\n      requestTimestamp,\r\n      s2sBidRequest: {\r\n        ...s2sBidRequest,\r\n        ortb2Fragments: premergeFpd(s2sBidRequest.ortb2Fragments, requestedBidders)\r\n      },\r\n      requestedBidders,\r\n      actualBidderRequests: bidderRequests,\r\n      nativeRequest: s2sBidRequest.s2sConfig.ortbNative,\r\n      getRedactor,\r\n      transmitTids: isActivityAllowed(ACTIVITY_TRANSMIT_TID, s2sParams),\r\n    }\r\n  });\r\n}\r\n\r\nexport function interpretPBSResponse(response, request) {\r\n  return PBS_CONVERTER.fromORTB({response, request});\r\n}\r\n","/**\r\n * This module adds the PublinkId to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/publinkIdSystem\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport {submodule} from '../src/hook.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {ajax} from '../src/ajax.js';\r\nimport { parseUrl, buildUrl, logError } from '../src/utils.js';\r\nimport {MODULE_TYPE_UID} from '../src/activities/modules.js';\r\n\r\n/**\r\n * @typedef {import('../modules/userId/index.js').Submodule} Submodule\r\n * @typedef {import('../modules/userId/index.js').SubmoduleConfig} SubmoduleConfig\r\n * @typedef {import('../modules/userId/index.js').ConsentData} ConsentData\r\n * @typedef {import('../modules/userId/index.js').IdResponse} IdResponse\r\n */\r\n\r\nconst MODULE_NAME = 'publinkId';\r\nconst GVLID = 24;\r\nconst PUBLINK_COOKIE = '_publink';\r\nconst PUBLINK_S2S_COOKIE = '_publink_srv';\r\nconst PUBLINK_REQUEST_PATH = '/cvx/client/sync/publink';\r\nconst PUBLINK_REFRESH_PATH = '/cvx/client/sync/publink/refresh';\r\n\r\nexport const storage = getStorageManager({moduleType: MODULE_TYPE_UID, moduleName: MODULE_NAME});\r\n\r\nfunction isHex(s) {\r\n  return /^[A-F0-9]+$/i.test(s);\r\n}\r\n\r\nfunction publinkIdUrl(params, consentData, storedId) {\r\n  const url = parseUrl('https://proc.ad.cpe.dotomi.com' + PUBLINK_REFRESH_PATH);\r\n  url.search = {\r\n    mpn: 'Prebid.js',\r\n    mpv: '$prebid.version$',\r\n  };\r\n\r\n  if (consentData?.gdpr) {\r\n    url.search.gdpr = (consentData.gdpr.gdprApplies) ? 1 : 0;\r\n    url.search.gdpr_consent = consentData.gdpr.consentString;\r\n  }\r\n\r\n  if (params) {\r\n    if (params.e) {\r\n      // if there's an email parameter call the request path\r\n      url.search.deh = params.e;\r\n      url.pathname = PUBLINK_REQUEST_PATH;\r\n    }\r\n\r\n    if (params.site_id) { url.search.sid = params.site_id; }\r\n\r\n    if (params.api_key) { url.search.apikey = params.api_key; }\r\n  }\r\n\r\n  if (storedId) {\r\n    url.search.publink = storedId;\r\n  }\r\n\r\n  const usPrivacyString = consentData?.usp;\r\n  if (usPrivacyString && typeof usPrivacyString === 'string') {\r\n    url.search.us_privacy = usPrivacyString;\r\n  }\r\n\r\n  return buildUrl(url);\r\n}\r\n\r\nfunction makeCallback(config = {}, consentData, storedId) {\r\n  return function(prebidCallback) {\r\n    const options = {method: 'GET', withCredentials: true};\r\n    const handleResponse = function(responseText, xhr) {\r\n      if (xhr.status === 200) {\r\n        const response = JSON.parse(responseText);\r\n        if (response) {\r\n          prebidCallback(response.publink);\r\n        }\r\n      }\r\n    };\r\n    if ((config.params && config.params.e && isHex(config.params.e)) || storedId) {\r\n      ajax(publinkIdUrl(config.params, consentData, storedId), handleResponse, undefined, options);\r\n    } else if (config.params.e) {\r\n      logError('params.e must be a hex string');\r\n    }\r\n  }\r\n}\r\n\r\nfunction getlocalValue() {\r\n  let result;\r\n  function getData(key) {\r\n    let value;\r\n    if (storage.hasLocalStorage()) {\r\n      value = storage.getDataFromLocalStorage(key);\r\n    }\r\n    if (!value) {\r\n      value = storage.getCookie(key);\r\n    }\r\n\r\n    if (typeof value === 'string') {\r\n      // if it's a json object parse it and return the publink value, otherwise assume the value is the id\r\n      if (value.charAt(0) === '{') {\r\n        try {\r\n          const obj = JSON.parse(value);\r\n          if (obj) {\r\n            return obj.publink;\r\n          }\r\n        } catch (e) {\r\n          logError(e);\r\n        }\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n  result = getData(PUBLINK_S2S_COOKIE);\r\n  if (!result) {\r\n    result = getData(PUBLINK_COOKIE);\r\n  }\r\n  return result;\r\n}\r\n\r\n/** @type {Submodule} */\r\nexport const publinkIdSubmodule = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: MODULE_NAME,\r\n  gvlid: GVLID,\r\n\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   * @function\r\n   * @param {string} publinkId encrypted userid\r\n   * @returns {{publinkId: string} | undefined}\r\n   */\r\n  decode(publinkId) {\r\n    return {publinkId: publinkId};\r\n  },\r\n\r\n  /**\r\n   * performs action to obtain id\r\n   * Use a publink cookie first if it is present, otherwise use prebids copy, if neither are available callout to get a new id\r\n   * @function\r\n   * @param {SubmoduleConfig} [config] Config object with params and storage properties\r\n   * @param {ConsentData|undefined} consentData GDPR consent\r\n   * @param {(Object|undefined)} storedId Previously cached id\r\n   * @returns {IdResponse}\r\n   */\r\n  getId: function(config, consentData, storedId) {\r\n    const localValue = getlocalValue();\r\n    if (localValue) {\r\n      return {id: localValue};\r\n    }\r\n    return {callback: makeCallback(config, consentData, storedId)};\r\n  },\r\n  eids: {\r\n    'publinkId': {\r\n      source: 'epsilon.com',\r\n      atype: 3\r\n    },\r\n  },\r\n};\r\nsubmodule('userId', publinkIdSubmodule);\r\n","/**\r\n * This module adds SharedId to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/sharedIdSystem\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport {parseUrl, buildUrl, triggerPixel, logInfo, hasDeviceAccess, generateUUID} from '../src/utils.js';\r\nimport {submodule} from '../src/hook.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {VENDORLESS_GVLID} from '../src/consentHandler.js';\r\nimport {MODULE_TYPE_UID} from '../src/activities/modules.js';\r\nimport {domainOverrideToRootDomain} from '../libraries/domainOverrideToRootDomain/index.js';\r\n\r\nimport type {IdProviderSpec} from \"./userId/spec.ts\";\r\n\r\nexport const storage = getStorageManager({moduleType: MODULE_TYPE_UID, moduleName: 'sharedId'});\r\nconst COOKIE = 'cookie';\r\nconst LOCAL_STORAGE = 'html5';\r\nconst OPTOUT_NAME = '_pubcid_optout';\r\nconst PUB_COMMON_ID = 'PublisherCommonId';\r\n\r\ntype SharedIdParams = {\r\n  /**\r\n   * If true, then an id is created automatically if it’s missing.\r\n   * Default is true. If your server has a component that generates the id instead, then this should be set to false\r\n   */\r\n  create?: boolean;\r\n  /**\r\n   * If true, the the expiration time is automatically extended whenever the script is executed even if the id exists already.\r\n   * Default is true. If false, then the id expires from the time it was initially created.\r\n   */\r\n  extend?: boolean;\r\n  /**\r\n   * For publisher server support only. Where to call out to for a server cookie.\r\n   */\r\n  pixelUrl?: string;\r\n  /**\r\n   * The value to use for `inserter` in EIDs.\r\n   */\r\n  inserter?: string;\r\n}\r\n\r\ndeclare module './userId/spec' {\r\n  interface UserId {\r\n    pubcid: string;\r\n  }\r\n  interface ProvidersToId {\r\n    sharedId: 'pubcid';\r\n    pubCommonId: 'pubcid';\r\n  }\r\n\r\n  interface ProviderParams {\r\n    sharedId: SharedIdParams;\r\n    pubCommonId: SharedIdParams;\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * Read a value either from cookie or local storage\r\n * @param {string} name Name of the item\r\n * @param {string} type storage type override\r\n * @returns {string|null} a string if item exists\r\n */\r\nfunction readValue(name, type) {\r\n  if (type === COOKIE) {\r\n    return storage.getCookie(name);\r\n  } else if (type === LOCAL_STORAGE) {\r\n    if (storage.hasLocalStorage()) {\r\n      const expValue = storage.getDataFromLocalStorage(`${name}_exp`);\r\n      if (!expValue) {\r\n        return storage.getDataFromLocalStorage(name);\r\n      } else if ((new Date(expValue)).getTime() - Date.now() > 0) {\r\n        return storage.getDataFromLocalStorage(name)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getIdCallback(pubcid, pixelUrl) {\r\n  return function (callback, getStoredId) {\r\n    if (pixelUrl) {\r\n      queuePixelCallback(pixelUrl, pubcid, () => {\r\n        callback(getStoredId() || pubcid);\r\n      })();\r\n    } else {\r\n      callback(pubcid);\r\n    }\r\n  }\r\n}\r\n\r\nfunction queuePixelCallback(pixelUrl, id = '', callback?) {\r\n  if (!pixelUrl) {\r\n    return;\r\n  }\r\n\r\n  // Use pubcid as a cache buster\r\n  const urlInfo = parseUrl(pixelUrl);\r\n  urlInfo.search.id = encodeURIComponent('pubcid:' + id);\r\n  const targetUrl = buildUrl(urlInfo);\r\n\r\n  return function () {\r\n    triggerPixel(targetUrl, callback);\r\n  };\r\n}\r\n\r\nfunction hasOptedOut() {\r\n  return !!((storage.cookiesAreEnabled() && readValue(OPTOUT_NAME, COOKIE)) ||\r\n    (storage.hasLocalStorage() && readValue(OPTOUT_NAME, LOCAL_STORAGE)));\r\n}\r\n\r\nexport const sharedIdSystemSubmodule: IdProviderSpec<'sharedId'> = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: 'sharedId',\r\n  aliasName: 'pubCommonId',\r\n  gvlid: VENDORLESS_GVLID as any,\r\n  disclosureURL: 'local://prebid/sharedId-optout.json',\r\n\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   */\r\n  decode(value, config) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId decode: Has opted-out');\r\n      return undefined;\r\n    }\r\n    logInfo(' Decoded value PubCommonId ' + value);\r\n    const idObj = {'pubcid': value as string};\r\n    return idObj;\r\n  },\r\n  getId: function (config = {} as any, consentData, storedId) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId: Has opted-out');\r\n      return;\r\n    }\r\n    if (consentData?.coppa) {\r\n      logInfo('PubCommonId: IDs not provided for coppa requests, exiting PubCommonId');\r\n      return;\r\n    }\r\n    const {params: {create = true, pixelUrl} = {}} = config;\r\n    let newId = storedId;\r\n    if (!newId) {\r\n      try {\r\n        if (typeof window[PUB_COMMON_ID] === 'object') {\r\n          // If the page includes its own pubcid module, then save a copy of id.\r\n          newId = window[PUB_COMMON_ID].getId();\r\n        }\r\n      } catch (e) {\r\n      }\r\n\r\n      if (!newId) newId = (create && hasDeviceAccess()) ? generateUUID() : undefined;\r\n    }\r\n\r\n    return {id: newId, callback: getIdCallback(newId, pixelUrl)};\r\n  },\r\n  /**\r\n   * performs action to extend an id.  There are generally two ways to extend the expiration time\r\n   * of stored id: using pixelUrl or return the id and let main user id module write it again with\r\n   * the new expiration time.\r\n   *\r\n   * PixelUrl, if defined, should point back to a first party domain endpoint.  On the server\r\n   * side, there is either a plugin, or customized logic to read and write back the pubcid cookie.\r\n   * The extendId function itself should return only the callback, and not the id itself to avoid\r\n   * having the script-side overwriting server-side.  This applies to both pubcid and sharedid.\r\n   *\r\n   * On the other hand, if there is no pixelUrl, then the extendId should return storedId so that\r\n   * its expiration time is updated.\r\n   */\r\n  extendId: function(config = {} as any, consentData, storedId) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId: Has opted-out');\r\n      return {id: undefined};\r\n    }\r\n    if (consentData?.coppa) {\r\n      logInfo('PubCommonId: IDs not provided for coppa requests, exiting PubCommonId');\r\n      return;\r\n    }\r\n    const {params: {extend = false, pixelUrl} = {}} = config;\r\n\r\n    if (extend) {\r\n      if (pixelUrl) {\r\n        const callback = queuePixelCallback(pixelUrl, storedId as string);\r\n        return {callback: callback};\r\n      } else {\r\n        return {id: storedId};\r\n      }\r\n    }\r\n  },\r\n  domainOverride: domainOverrideToRootDomain(storage, 'sharedId'),\r\n  eids: {\r\n    'pubcid'(values, config) {\r\n      const eid: any = {\r\n        source: 'pubcid.org',\r\n        uids: values.map(id => ({id, atype: 1}))\r\n      }\r\n      if (config?.params?.inserter != null) {\r\n        eid.inserter = config.params.inserter;\r\n      }\r\n      return eid;\r\n    },\r\n  }\r\n};\r\n\r\nsubmodule('userId', sharedIdSystemSubmodule);\r\n","/**\r\n * This module gives publishers extra set of features to enforce individual purposes of TCF v2\r\n */\r\n\r\nimport {deepAccess, logError, logWarn} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport adapterManager, {gdprDataHandler} from '../src/adapterManager.js';\r\nimport * as events from '../src/events.js';\r\nimport {EVENTS} from '../src/constants.js';\r\nimport {GDPR_GVLIDS, VENDORLESS_GVLID} from '../src/consentHandler.js';\r\nimport {\r\n  MODULE_TYPE_ANALYTICS,\r\n  MODULE_TYPE_BIDDER,\r\n  MODULE_TYPE_PREBID,\r\n  MODULE_TYPE_RTD,\r\n  MODULE_TYPE_UID\r\n} from '../src/activities/modules.js';\r\nimport {\r\n  ACTIVITY_PARAM_ANL_CONFIG,\r\n  ACTIVITY_PARAM_COMPONENT_NAME,\r\n  ACTIVITY_PARAM_COMPONENT_TYPE\r\n} from '../src/activities/params.js';\r\nimport {registerActivityControl} from '../src/activities/rules.js';\r\nimport {\r\n  ACTIVITY_ACCESS_DEVICE,\r\n  ACTIVITY_ACCESS_REQUEST_CREDENTIALS,\r\n  ACTIVITY_ENRICH_EIDS,\r\n  ACTIVITY_ENRICH_UFPD,\r\n  ACTIVITY_FETCH_BIDS,\r\n  ACTIVITY_REPORT_ANALYTICS,\r\n  ACTIVITY_SYNC_USER,\r\n  ACTIVITY_TRANSMIT_EIDS,\r\n  ACTIVITY_TRANSMIT_PRECISE_GEO,\r\n  ACTIVITY_TRANSMIT_UFPD\r\n} from '../src/activities/activities.js';\r\nimport {processRequestOptions} from '../src/ajax.js';\r\n\r\nexport const STRICT_STORAGE_ENFORCEMENT = 'strictStorageEnforcement';\r\n\r\nexport const ACTIVE_RULES = {\r\n  purpose: {},\r\n  feature: {}\r\n};\r\n\r\nconst CONSENT_PATHS = {\r\n  purpose: false,\r\n  feature: 'specialFeatureOptins'\r\n};\r\n\r\nconst CONFIGURABLE_RULES = {\r\n  storage: {\r\n    type: 'purpose',\r\n    default: {\r\n      purpose: 'storage',\r\n      enforcePurpose: true,\r\n      enforceVendor: true,\r\n      vendorExceptions: []\r\n    },\r\n    id: 1,\r\n  },\r\n  basicAds: {\r\n    type: 'purpose',\r\n    id: 2,\r\n    default: {\r\n      purpose: 'basicAds',\r\n      enforcePurpose: true,\r\n      enforceVendor: true,\r\n      vendorExceptions: []\r\n    }\r\n  },\r\n  personalizedAds: {\r\n    type: 'purpose',\r\n    id: 4,\r\n    default: {\r\n      purpose: 'personalizedAds',\r\n      enforcePurpose: true,\r\n      enforceVendor: true,\r\n      vendorExceptions: [],\r\n      eidsRequireP4Consent: false\r\n    }\r\n  },\r\n  measurement: {\r\n    type: 'purpose',\r\n    id: 7,\r\n    default: {\r\n      purpose: 'measurement',\r\n      enforcePurpose: true,\r\n      enforceVendor: true,\r\n      vendorExceptions: []\r\n    }\r\n  },\r\n  transmitPreciseGeo: {\r\n    type: 'feature',\r\n    id: 1,\r\n    default: {\r\n      purpose: 'transmitPreciseGeo',\r\n      enforcePurpose: true,\r\n      enforceVendor: true,\r\n      vendorExceptions: []\r\n    }\r\n  },\r\n} as const;\r\n\r\nconst storageBlocked = new Set();\r\nconst biddersBlocked = new Set();\r\nconst analyticsBlocked = new Set();\r\nconst ufpdBlocked = new Set();\r\nconst eidsBlocked = new Set();\r\nconst geoBlocked = new Set();\r\n\r\nlet hooksAdded = false;\r\nlet strictStorageEnforcement = false;\r\n\r\nconst GVLID_LOOKUP_PRIORITY = [\r\n  MODULE_TYPE_BIDDER,\r\n  MODULE_TYPE_UID,\r\n  MODULE_TYPE_ANALYTICS,\r\n  MODULE_TYPE_RTD\r\n];\r\n\r\nconst RULE_NAME = 'TCF2';\r\nconst RULE_HANDLES = [];\r\n\r\n// in JS we do not have access to the GVL; assume that everyone declares legitimate interest for basic ads\r\nconst LI_PURPOSES = [2];\r\nconst PUBLISHER_LI_PURPOSES = [2, 7, 9, 10];\r\n\r\ndeclare module '../src/config' {\r\n  interface Config {\r\n    /**\r\n     * Map from module name to that module's GVL ID. This overrides the GVL ID provided\r\n     * by the modules themselves.\r\n     */\r\n    gvlMapping?: { [moduleName: string]: number }\r\n  }\r\n}\r\n/**\r\n * Retrieve a module's GVL ID.\r\n */\r\nexport function getGvlid(moduleType, moduleName, fallbackFn) {\r\n  if (moduleName) {\r\n    // Check user defined GVL Mapping in pbjs.setConfig()\r\n    const gvlMapping = config.getConfig('gvlMapping');\r\n\r\n    // Return GVL ID from user defined gvlMapping\r\n    if (gvlMapping && gvlMapping[moduleName]) {\r\n      return gvlMapping[moduleName];\r\n    } else if (moduleType === MODULE_TYPE_PREBID) {\r\n      return VENDORLESS_GVLID;\r\n    } else {\r\n      let {gvlid, modules} = GDPR_GVLIDS.get(moduleName);\r\n      if (gvlid == null && Object.keys(modules).length > 0) {\r\n        // this behavior is for backwards compatibility; if multiple modules with the same\r\n        // name declare different GVL IDs, pick the bidder's first, then userId, then analytics\r\n        for (const type of GVLID_LOOKUP_PRIORITY) {\r\n          if (modules.hasOwnProperty(type)) {\r\n            gvlid = modules[type];\r\n            if (type !== moduleType) {\r\n              logWarn(`Multiple GVL IDs found for module '${moduleName}'; using the ${type} module's ID (${gvlid}) instead of the ${moduleType}'s ID (${modules[moduleType]})`);\r\n            }\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (gvlid == null && fallbackFn) {\r\n        gvlid = fallbackFn();\r\n      }\r\n      return gvlid || null;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Retrieve GVL IDs that are dynamically set on analytics adapters.\r\n */\r\nexport function getGvlidFromAnalyticsAdapter(code, config) {\r\n  const adapter = adapterManager.getAnalyticsAdapter(code);\r\n  return ((gvlid) => {\r\n    if (typeof gvlid !== 'function') return gvlid;\r\n    try {\r\n      return gvlid.call(adapter.adapter, config);\r\n    } catch (e) {\r\n      logError(`Error invoking ${code} adapter.gvlid()`, e);\r\n    }\r\n  })(adapter?.adapter?.gvlid);\r\n}\r\n\r\nexport function shouldEnforce(consentData, purpose, name) {\r\n  if (consentData == null && gdprDataHandler.enabled) {\r\n    // there is no consent data, but the GDPR module has been installed and configured\r\n    // NOTE: this check is not foolproof, as when Prebid first loads, enforcement hooks have not been attached yet\r\n    // This piece of code would not run at all, and `gdprDataHandler.enabled` would be false, until the first\r\n    // `setConfig({consentManagement})`\r\n    logWarn(`Attempting operation that requires purpose ${purpose} consent while consent data is not available${name ? ` (module: ${name})` : ''}. Assuming no consent was given.`);\r\n    return true;\r\n  }\r\n  return consentData && consentData.gdprApplies;\r\n}\r\n\r\nfunction getConsentOrLI(consentData, path, id, acceptLI) {\r\n  const data = deepAccess(consentData, `vendorData.${path}`);\r\n  return !!data?.consents?.[id] || (acceptLI && !!data?.legitimateInterests?.[id]);\r\n}\r\n\r\nfunction getConsent(consentData, type, purposeNo, gvlId) {\r\n  let purpose;\r\n  if (CONSENT_PATHS[type] !== false) {\r\n    purpose = !!deepAccess(consentData, `vendorData.${CONSENT_PATHS[type]}.${purposeNo}`);\r\n  } else {\r\n    const [path, liPurposes] = gvlId === VENDORLESS_GVLID\r\n      ? ['publisher', PUBLISHER_LI_PURPOSES]\r\n      : ['purpose', LI_PURPOSES];\r\n    purpose = getConsentOrLI(consentData, path, purposeNo, liPurposes.includes(purposeNo));\r\n  }\r\n  return {\r\n    purpose,\r\n    vendor: getConsentOrLI(consentData, 'vendor', gvlId, LI_PURPOSES.includes(purposeNo))\r\n  }\r\n}\r\n\r\n/**\r\n * This function takes in a rule and consentData and validates against the consentData provided. Depending on what it returns,\r\n * the caller may decide to suppress a TCF-sensitive activity.\r\n * @param {Object} rule - enforcement rules set in config\r\n * @param {Object} consentData - gdpr consent data\r\n * @param {string=} currentModule - Bidder code of the current module\r\n * @param {number=} gvlId - GVL ID for the module\r\n * @returns {boolean}\r\n */\r\nexport function validateRules(rule, consentData, currentModule, gvlId) {\r\n  const ruleOptions = CONFIGURABLE_RULES[rule.purpose];\r\n\r\n  // return 'true' if vendor present in 'vendorExceptions'\r\n  if ((rule.vendorExceptions || []).includes(currentModule)) {\r\n    return true;\r\n  }\r\n  const vendorConsentRequred = rule.enforceVendor && !((gvlId === VENDORLESS_GVLID || (rule.softVendorExceptions || []).includes(currentModule)));\r\n  const {purpose, vendor} = getConsent(consentData, ruleOptions.type, ruleOptions.id, gvlId);\r\n  return (!rule.enforcePurpose || purpose) && (!vendorConsentRequred || vendor);\r\n}\r\n\r\nfunction gdprRule(purposeNo, checkConsent, blocked = null, gvlidFallback: any = () => null) {\r\n  return function (params) {\r\n    const consentData = gdprDataHandler.getConsentData();\r\n    const modName = params[ACTIVITY_PARAM_COMPONENT_NAME];\r\n\r\n    if (shouldEnforce(consentData, purposeNo, modName)) {\r\n      const gvlid = getGvlid(params[ACTIVITY_PARAM_COMPONENT_TYPE], modName, gvlidFallback(params));\r\n      const allow = !!checkConsent(consentData, modName, gvlid);\r\n      if (!allow) {\r\n        blocked && blocked.add(modName);\r\n        return {allow};\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction singlePurposeGdprRule(purposeNo, blocked = null, gvlidFallback: any = () => null) {\r\n  return gdprRule(purposeNo, (cd, modName, gvlid) => !!validateRules(ACTIVE_RULES.purpose[purposeNo], cd, modName, gvlid), blocked, gvlidFallback);\r\n}\r\n\r\nfunction exceptPrebidModules(ruleFn) {\r\n  return function (params) {\r\n    if (params[ACTIVITY_PARAM_COMPONENT_TYPE] === MODULE_TYPE_PREBID) {\r\n      // TODO: this special case is for the PBS adapter (componentType is 'prebid')\r\n      // we should check for generic purpose 2 consent & vendor consent based on the PBS vendor's GVL ID;\r\n      // that is, however, a breaking change and skipped for now\r\n      return;\r\n    }\r\n    return ruleFn(params);\r\n  };\r\n}\r\n\r\nexport const accessDeviceRule = ((rule) => {\r\n  return function (params) {\r\n    // for vendorless (core) storage, do not enforce rules unless strictStorageEnforcement is set\r\n    if (params[ACTIVITY_PARAM_COMPONENT_TYPE] === MODULE_TYPE_PREBID && !strictStorageEnforcement) return;\r\n    return rule(params);\r\n  };\r\n})(singlePurposeGdprRule(1, storageBlocked));\r\n\r\nexport const syncUserRule = singlePurposeGdprRule(1, storageBlocked);\r\nexport const enrichEidsRule = singlePurposeGdprRule(1, storageBlocked);\r\nexport const fetchBidsRule = exceptPrebidModules(singlePurposeGdprRule(2, biddersBlocked));\r\nexport const reportAnalyticsRule = singlePurposeGdprRule(7, analyticsBlocked, (params) => getGvlidFromAnalyticsAdapter(params[ACTIVITY_PARAM_COMPONENT_NAME], params[ACTIVITY_PARAM_ANL_CONFIG]));\r\nexport const ufpdRule = singlePurposeGdprRule(4, ufpdBlocked);\r\n\r\nexport const transmitEidsRule = exceptPrebidModules((() => {\r\n  // Transmit EID special case:\r\n  // by default, legal basis or vendor exceptions for any purpose between 2 and 10\r\n  // (but disregarding enforcePurpose and enforceVendor config) is enough to allow EIDs through\r\n  function check2to10Consent(consentData, modName, gvlId) {\r\n    for (let pno = 2; pno <= 10; pno++) {\r\n      if (ACTIVE_RULES.purpose[pno]?.vendorExceptions?.includes(modName)) {\r\n        return true;\r\n      }\r\n      const {purpose, vendor} = getConsent(consentData, 'purpose', pno, gvlId);\r\n      if (purpose && (vendor || ACTIVE_RULES.purpose[pno]?.softVendorExceptions?.includes(modName))) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  const defaultBehavior = gdprRule('2-10', check2to10Consent, eidsBlocked);\r\n  const p4Behavior = singlePurposeGdprRule(4, eidsBlocked);\r\n  return function (...args) {\r\n    const fn = ACTIVE_RULES.purpose[4]?.eidsRequireP4Consent ? p4Behavior : defaultBehavior;\r\n    return fn.apply(this, args);\r\n  };\r\n})());\r\n\r\nexport const transmitPreciseGeoRule = gdprRule('Special Feature 1', (cd, modName, gvlId) => validateRules(ACTIVE_RULES.feature[1], cd, modName, gvlId), geoBlocked);\r\n\r\n/**\r\n * Compiles the TCF2.0 enforcement results into an object, which is emitted as an event payload to \"tcf2Enforcement\" event.\r\n */\r\nfunction emitTCF2FinalResults() {\r\n  // remove null and duplicate values\r\n  const formatSet = function (st) {\r\n    return Array.from(st.keys()).filter(el => el != null);\r\n  };\r\n  const tcf2FinalResults = {\r\n    storageBlocked: formatSet(storageBlocked),\r\n    biddersBlocked: formatSet(biddersBlocked),\r\n    analyticsBlocked: formatSet(analyticsBlocked),\r\n    ufpdBlocked: formatSet(ufpdBlocked),\r\n    eidsBlocked: formatSet(eidsBlocked),\r\n    geoBlocked: formatSet(geoBlocked)\r\n  };\r\n\r\n  events.emit(EVENTS.TCF2_ENFORCEMENT, tcf2FinalResults);\r\n  [storageBlocked, biddersBlocked, analyticsBlocked, ufpdBlocked, eidsBlocked, geoBlocked].forEach(el => el.clear());\r\n}\r\n\r\nevents.on(EVENTS.AUCTION_END, emitTCF2FinalResults);\r\n\r\ntype TCFControlRule = {\r\n  purpose: keyof typeof CONFIGURABLE_RULES;\r\n  /**\r\n   * Determines whether to enforce the purpose consent.\r\n   */\r\n  enforcePurpose?: boolean;\r\n  /**\r\n   * Determines whether to check vendor signals for this purpose.\r\n   */\r\n  enforceVendor?: boolean;\r\n  /**\r\n   * Defines a list of bidder codes or module names that are exempt from determining legal basis for this Purpose.\r\n   * Note: Prebid.org recommends working with a privacy lawyer before making enforcement exceptions for any vendor.\r\n   */\r\n  vendorExceptions?: string[]\r\n  /**\r\n   * Defines a list of bidder codes or module names that are exempt from the checking vendor signals for this purpose.\r\n   * Unlike with vendorExceptions, Purpose consent is still checked.\r\n   * Note: Prebid.org recommends working with a privacy lawyer before making enforcement exceptions for any vendor.\r\n   */\r\n  softVendorExceptions?: string[]\r\n  /**\r\n   * Only relevant when `purpose` is  `'personalizedAds'`.\r\n   * If true, user IDs and EIDs will not be shared without evidence of consent for TCF Purpose 4.\r\n   * If false (the default), evidence of consent for any of Purposes 2-10 is sufficient for sharing user IDs and EIDs.\r\n   */\r\n  eidsRequireP4Consent?: boolean;\r\n}\r\n\r\ndeclare module '../src/consentHandler' {\r\n  interface ConsentManagementConfig {\r\n    /**\r\n     * If false (the default), allows some use of storage regardless of purpose 1 consent.\r\n     */\r\n    [STRICT_STORAGE_ENFORCEMENT]?: boolean;\r\n  }\r\n\r\n}\r\ndeclare module './consentManagementTcf' {\r\n  interface TCFConfig {\r\n    rules?: TCFControlRule[];\r\n  }\r\n}\r\n\r\n/**\r\n * A configuration function that initializes some module variables, as well as adds hooks\r\n * @param {Object} config - GDPR enforcement config object\r\n */\r\nexport function setEnforcementConfig(config) {\r\n  let rules: Record<keyof typeof CONFIGURABLE_RULES, TCFControlRule> = deepAccess(config, 'gdpr.rules');\r\n  if (!rules) {\r\n    logWarn('TCF2: enforcing P1 and P2 by default');\r\n  }\r\n  rules = Object.fromEntries((rules as any || []).map(r => [r.purpose, r])) as any;\r\n  strictStorageEnforcement = !!deepAccess(config, STRICT_STORAGE_ENFORCEMENT);\r\n\r\n  Object.entries(CONFIGURABLE_RULES).forEach(([name, opts]) => {\r\n    ACTIVE_RULES[opts.type][opts.id] = rules[name] ?? opts.default;\r\n  });\r\n\r\n  if (!hooksAdded) {\r\n    if (ACTIVE_RULES.purpose[1] != null) {\r\n      hooksAdded = true;\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_ACCESS_DEVICE, RULE_NAME, accessDeviceRule));\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_SYNC_USER, RULE_NAME, syncUserRule));\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_ENRICH_EIDS, RULE_NAME, enrichEidsRule));\r\n      processRequestOptions.after(checkIfCredentialsAllowed);\r\n    }\r\n    if (ACTIVE_RULES.purpose[2] != null) {\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_FETCH_BIDS, RULE_NAME, fetchBidsRule));\r\n    }\r\n    if (ACTIVE_RULES.purpose[4] != null) {\r\n      RULE_HANDLES.push(\r\n        registerActivityControl(ACTIVITY_TRANSMIT_UFPD, RULE_NAME, ufpdRule),\r\n        registerActivityControl(ACTIVITY_ENRICH_UFPD, RULE_NAME, ufpdRule)\r\n      );\r\n    }\r\n    if (ACTIVE_RULES.purpose[7] != null) {\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_REPORT_ANALYTICS, RULE_NAME, reportAnalyticsRule));\r\n    }\r\n    if (ACTIVE_RULES.feature[1] != null) {\r\n      RULE_HANDLES.push(registerActivityControl(ACTIVITY_TRANSMIT_PRECISE_GEO, RULE_NAME, transmitPreciseGeoRule));\r\n    }\r\n    RULE_HANDLES.push(registerActivityControl(ACTIVITY_TRANSMIT_EIDS, RULE_NAME, transmitEidsRule));\r\n  }\r\n}\r\n\r\nexport function checkIfCredentialsAllowed(next, options: { withCredentials?: boolean } = {}, moduleType?: string, moduleName?: string) {\r\n  if (!options.withCredentials || (moduleType && moduleName)) {\r\n    next(options);\r\n    return;\r\n  }\r\n  const consentData = gdprDataHandler.getConsentData();\r\n  const rule = ACTIVE_RULES.purpose[1];\r\n  const ruleOptions = CONFIGURABLE_RULES[rule.purpose];\r\n  const {purpose} = getConsent(consentData, ruleOptions.type, ruleOptions.id, null);\r\n\r\n  if (!purpose && rule.enforcePurpose) {\r\n    options.withCredentials = false;\r\n    logWarn(`${RULE_NAME} denied ${ACTIVITY_ACCESS_REQUEST_CREDENTIALS}`);\r\n  }\r\n  next(options);\r\n}\r\n\r\nexport function uninstall() {\r\n  while (RULE_HANDLES.length) RULE_HANDLES.pop()();\r\n  processRequestOptions.getHooks({hook: checkIfCredentialsAllowed}).remove();\r\n  hooksAdded = false;\r\n}\r\n\r\nconfig.getConfig('consentManagement', config => setEnforcementConfig(config.consentManagement));\r\n","import {submodule} from '../src/hook.js';\r\nimport {config} from '../src/config.js';\r\nimport {logError, logInfo, logWarn, mergeDeep} from '../src/utils.js';\r\nimport {auctionStore} from '../libraries/weakStore/weakStore.js';\r\nimport {getGlobal} from '../src/prebidGlobal.js';\r\nimport {emit} from '../src/events.js';\r\nimport {BID_STATUS, EVENTS} from '../src/constants.js';\r\nimport {PbPromise} from '../src/utils/promise.js';\r\nimport {getBidToRender, getRenderingData, markWinningBid} from '../src/adRendering.js';\r\n\r\nlet getPAAPIConfig, expandFilters, moduleConfig;\r\n\r\nconst paapiBids = auctionStore();\r\nconst MODULE_NAME = 'topLevelPaapi';\r\n\r\nconfig.getConfig('paapi', (cfg) => {\r\n  moduleConfig = cfg.paapi?.topLevelSeller;\r\n  if (moduleConfig) {\r\n    getBidToRender.before(renderPaapiHook);\r\n    getBidToRender.after(renderOverrideHook);\r\n    getRenderingData.before(getRenderingDataHook);\r\n    markWinningBid.before(markWinningBidHook);\r\n  } else {\r\n    getBidToRender.getHooks({hook: renderPaapiHook}).remove();\r\n    getBidToRender.getHooks({hook: renderOverrideHook}).remove();\r\n    getRenderingData.getHooks({hook: getRenderingDataHook}).remove();\r\n    markWinningBid.getHooks({hook: markWinningBidHook}).remove();\r\n  }\r\n});\r\n\r\nfunction isPaapiBid(bid) {\r\n  return bid?.source === 'paapi';\r\n}\r\n\r\nfunction bidIfRenderable(bid) {\r\n  if (bid && !bid.urn) {\r\n    logWarn(MODULE_NAME, 'rendering in fenced frames is not supported. Consider using resolveToConfig: false', bid);\r\n    return;\r\n  }\r\n  return bid;\r\n}\r\n\r\nconst forRenderStack = [];\r\n\r\nfunction renderPaapiHook(next, adId, forRender = true, override = PbPromise.resolve()) {\r\n  forRenderStack.push(forRender);\r\n  const ids = parsePaapiAdId(adId);\r\n  if (ids) {\r\n    override = override.then((bid) => {\r\n      if (bid) return bid;\r\n      const [auctionId, adUnitCode] = ids;\r\n      return paapiBids(auctionId)?.[adUnitCode]?.then(bid => {\r\n        if (!bid) {\r\n          logWarn(MODULE_NAME, `No PAAPI bid found for auctionId: \"${auctionId}\", adUnit: \"${adUnitCode}\"`);\r\n        }\r\n        return bidIfRenderable(bid);\r\n      });\r\n    });\r\n  }\r\n  next(adId, forRender, override);\r\n}\r\n\r\nfunction renderOverrideHook(next, bidPm) {\r\n  const forRender = forRenderStack.pop();\r\n  if (moduleConfig?.overrideWinner) {\r\n    bidPm = bidPm.then((bid) => {\r\n      if (isPaapiBid(bid) || bid?.status === BID_STATUS.RENDERED) return bid;\r\n      return getPAAPIBids({adUnitCode: bid.adUnitCode}).then(res => {\r\n        const paapiBid = bidIfRenderable(res[bid.adUnitCode]);\r\n        if (paapiBid) {\r\n          if (!forRender) return paapiBid;\r\n          if (forRender && paapiBid.status !== BID_STATUS.RENDERED) {\r\n            paapiBid.overriddenAdId = bid.adId;\r\n            logInfo(MODULE_NAME, 'overriding contextual bid with PAAPI bid', bid, paapiBid)\r\n            return paapiBid;\r\n          }\r\n        }\r\n        return bid;\r\n      });\r\n    });\r\n  }\r\n  next(bidPm);\r\n}\r\n\r\nexport function getRenderingDataHook(next, bid, options) {\r\n  if (isPaapiBid(bid)) {\r\n    next.bail({\r\n      width: bid.width,\r\n      height: bid.height,\r\n      adUrl: bid.urn\r\n    });\r\n  } else {\r\n    next(bid, options);\r\n  }\r\n}\r\n\r\nexport function markWinningBidHook(next, bid) {\r\n  if (isPaapiBid(bid)) {\r\n    emit(EVENTS.BID_WON, bid);\r\n    next.bail();\r\n  } else {\r\n    next(bid);\r\n  }\r\n}\r\n\r\nfunction getBaseAuctionConfig() {\r\n  if (moduleConfig?.auctionConfig) {\r\n    return Object.assign({\r\n      resolveToConfig: false\r\n    }, moduleConfig.auctionConfig);\r\n  }\r\n}\r\n\r\nfunction onAuctionConfig(auctionId, auctionConfigs) {\r\n  const base = getBaseAuctionConfig();\r\n  if (base) {\r\n    Object.entries(auctionConfigs).forEach(([adUnitCode, auctionConfig]) => {\r\n      mergeDeep(auctionConfig, base);\r\n      if (moduleConfig.autorun ?? true) {\r\n        getPAAPIBids({adUnitCode, auctionId});\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function parsePaapiSize(size) {\r\n  /* From https://github.com/WICG/turtledove/blob/main/FLEDGE.md#12-interest-group-attributes:\r\n   *  Each size has the format {width: widthVal, height: heightVal},\r\n   *  where the values can have either pixel units (e.g. 100 or '100px') or screen dimension coordinates (e.g. 100sw or 100sh).\r\n   */\r\n  if (typeof size === 'number') return size;\r\n  if (typeof size === 'string') {\r\n    const px = /^(\\d+)(px)?$/.exec(size)?.[1];\r\n    if (px) {\r\n      return parseInt(px, 10);\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getPaapiAdId(auctionId, adUnitCode) {\r\n  return `paapi:/${auctionId.replace(/:/g, '::')}/:/${adUnitCode.replace(/:/g, '::')}`;\r\n}\r\n\r\nexport function parsePaapiAdId(adId) {\r\n  const match = /^paapi:\\/(.*)\\/:\\/(.*)$/.exec(adId);\r\n  if (match) {\r\n    return [match[1], match[2]].map(s => s.replace(/::/g, ':'));\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the PAAPI runAdAuction result for the given filters, as a map from ad unit code to auction result\r\n * (an object with `width`, `height`, and one of `urn` or `frameConfig`).\r\n *\r\n * @param filters\r\n * @param raa\r\n * @return {Promise<{[p: string]: any}>}\r\n */\r\nexport function getPAAPIBids(filters, raa = (...args) => navigator.runAdAuction(...args)) {\r\n  return Promise.all(\r\n    Object.entries(expandFilters(filters))\r\n      .map(([adUnitCode, auctionId]) => {\r\n        const bids = paapiBids(auctionId);\r\n        if (bids && !bids.hasOwnProperty(adUnitCode)) {\r\n          const auctionConfig = getPAAPIConfig({adUnitCode, auctionId})[adUnitCode];\r\n          if (auctionConfig) {\r\n            emit(EVENTS.RUN_PAAPI_AUCTION, {\r\n              auctionId,\r\n              adUnitCode,\r\n              auctionConfig\r\n            });\r\n            bids[adUnitCode] = new Promise((resolve, reject) => raa(auctionConfig).then(resolve, reject))\r\n              .then(result => {\r\n                if (result) {\r\n                  const bid = {\r\n                    source: 'paapi',\r\n                    adId: getPaapiAdId(auctionId, adUnitCode),\r\n                    width: parsePaapiSize(auctionConfig.requestedSize?.width),\r\n                    height: parsePaapiSize(auctionConfig.requestedSize?.height),\r\n                    adUnitCode,\r\n                    auctionId,\r\n                    [typeof result === 'string' ? 'urn' : 'frameConfig']: result,\r\n                    auctionConfig,\r\n                  };\r\n                  emit(EVENTS.PAAPI_BID, bid);\r\n                  return bid;\r\n                } else {\r\n                  emit(EVENTS.PAAPI_NO_BID, {auctionId, adUnitCode, auctionConfig});\r\n                  return null;\r\n                }\r\n              }).catch(error => {\r\n                logError(MODULE_NAME, `error (auction \"${auctionId}\", adUnit \"${adUnitCode}\"):`, error);\r\n                emit(EVENTS.PAAPI_ERROR, {auctionId, adUnitCode, error, auctionConfig});\r\n                return null;\r\n              });\r\n          }\r\n        }\r\n        return bids?.[adUnitCode]?.then(res => [adUnitCode, res]);\r\n      }).filter(e => e)\r\n  ).then(result => Object.fromEntries(result));\r\n}\r\n\r\ngetGlobal().getPAAPIBids = (filters) => getPAAPIBids(filters);\r\n\r\nexport const topLevelPAAPI = {\r\n  name: MODULE_NAME,\r\n  init(params) {\r\n    getPAAPIConfig = params.getPAAPIConfig;\r\n    expandFilters = params.expandFilters;\r\n  },\r\n  onAuctionConfig\r\n};\r\nsubmodule('paapi', topLevelPAAPI);\r\n","import {logError, deepClone, isFn, isStr} from '../../src/utils.js';\r\n\r\nexport const EID_CONFIG = new Map();\r\n\r\n// this function will create an eid object for the given UserId sub-module\r\nfunction createEidObject(userIdData, subModuleKey, eidConf) {\r\n  if (eidConf && userIdData) {\r\n    const eid = {};\r\n    eid.source = isFn(eidConf['getSource']) ? eidConf['getSource'](userIdData) : eidConf['source'];\r\n    const value = isFn(eidConf['getValue']) ? eidConf['getValue'](userIdData) : userIdData;\r\n    if (isStr(value)) {\r\n      const uid = { id: value, atype: eidConf['atype'] };\r\n      // getUidExt\r\n      if (isFn(eidConf['getUidExt'])) {\r\n        const uidExt = eidConf['getUidExt'](userIdData);\r\n        if (uidExt) {\r\n          uid.ext = uidExt;\r\n        }\r\n      }\r\n      eid.uids = [uid];\r\n      if (eidConf['inserter'] || isFn(eidConf['getInserter'])) {\r\n        const inserter = isFn(eidConf['getInserter']) ? eidConf['getInserter'](userIdData) : eidConf['inserter'];\r\n        if (inserter != null) {\r\n          eid.inserter = inserter;\r\n        }\r\n      }\r\n      if (eidConf['matcher'] || isFn(eidConf['getMatcher'])) {\r\n        const matcher = isFn(eidConf['getMatcher']) ? eidConf['getMatcher'](userIdData) : eidConf['matcher'];\r\n        if (matcher != null) {\r\n          eid.matcher = matcher;\r\n        }\r\n      }\r\n      if (eidConf['mm'] != null) {\r\n        eid.mm = eidConf['mm'];\r\n      }\r\n      // getEidExt\r\n      if (isFn(eidConf['getEidExt'])) {\r\n        const eidExt = eidConf['getEidExt'](userIdData);\r\n        if (eidExt) {\r\n          eid.ext = eidExt;\r\n        }\r\n      }\r\n      return eid;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function createEidsArray(bidRequestUserId, eidConfigs = EID_CONFIG) {\r\n  const allEids = {};\r\n  function collect(eid) {\r\n    const key = JSON.stringify([\r\n      eid.source?.toLowerCase(),\r\n      ...Object.keys(eid).filter(k => !['uids', 'source'].includes(k)).sort().map(k => eid[k])\r\n    ]);\r\n    if (allEids.hasOwnProperty(key)) {\r\n      allEids[key].uids.push(...eid.uids);\r\n    } else {\r\n      allEids[key] = eid;\r\n    }\r\n  }\r\n\r\n  Object.entries(bidRequestUserId).forEach(([name, values]) => {\r\n    values = Array.isArray(values) ? values : [values];\r\n    const eidConf = eidConfigs.get(name);\r\n    let eids;\r\n    if (name === 'pubProvidedId') {\r\n      eids = deepClone(values);\r\n    } else if (typeof eidConf === 'function') {\r\n      try {\r\n        eids = eidConf(values);\r\n        if (!Array.isArray(eids)) {\r\n          eids = [eids];\r\n        }\r\n        eids.forEach(eid => {\r\n          eid.uids = eid.uids.filter(({id}) => isStr(id))\r\n        })\r\n        eids = eids.filter(({uids}) => uids?.length > 0);\r\n      } catch (e) {\r\n        logError(`Could not generate EID for \"${name}\"`, e);\r\n      }\r\n    } else {\r\n      eids = values.map(value => createEidObject(value, name, eidConf));\r\n    }\r\n    if (Array.isArray(eids)) {\r\n      eids.filter(eid => eid != null).forEach(collect);\r\n    }\r\n  })\r\n  return Object.values(allEids);\r\n}\r\n\r\nexport function getEids(priorityMap) {\r\n  const eidConfigs = new Map();\r\n  const idValues = {};\r\n  Object.entries(priorityMap).forEach(([key, getActiveModule]) => {\r\n    const submodule = getActiveModule();\r\n    if (submodule) {\r\n      idValues[key] = submodule.idObj[key];\r\n      let eidConf = submodule.submodule.eids?.[key];\r\n      if (typeof eidConf === 'function') {\r\n        // if eid config is given as a function, append the active module configuration to its args\r\n        eidConf = ((orig) => (...args) => orig(...args, submodule.config))(eidConf);\r\n      }\r\n      eidConfigs.set(key, eidConf);\r\n    }\r\n  })\r\n  return createEidsArray(idValues, eidConfigs);\r\n}\r\n","/**\r\n * This module adds User ID support to prebid.js\r\n * @module modules/userId\r\n */\r\n\r\nimport {config} from '../../src/config.js';\r\nimport * as events from '../../src/events.js';\r\nimport {addApiMethod, startAuction, type StartAuctionOptions} from '../../src/prebid.js';\r\nimport adapterManager from '../../src/adapterManager.js';\r\nimport {EVENTS} from '../../src/constants.js';\r\nimport {module, ready as hooksReady} from '../../src/hook.js';\r\nimport {EID_CONFIG, getEids} from './eids.js';\r\nimport {\r\n  discloseStorageUse,\r\n  getCoreStorageManager,\r\n  newStorageManager,\r\n  STORAGE_TYPE_COOKIES,\r\n  STORAGE_TYPE_LOCALSTORAGE,\r\n  type StorageManager,\r\n  type StorageType\r\n} from '../../src/storageManager.js';\r\nimport {\r\n  deepEqual,\r\n  deepSetValue,\r\n  delayExecution,\r\n  isArray,\r\n  isEmpty,\r\n  isFn,\r\n  isGptPubadsDefined,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  logInfo,\r\n  logWarn,\r\n} from '../../src/utils.js';\r\nimport {getPPID as coreGetPPID} from '../../src/adserver.js';\r\nimport {defer, delay, PbPromise} from '../../src/utils/promise.js';\r\nimport {newMetrics, timedAuctionHook, useMetrics} from '../../src/utils/perfMetrics.js';\r\nimport {findRootDomain} from '../../src/fpd/rootDomain.js';\r\nimport {allConsent, GDPR_GVLIDS} from '../../src/consentHandler.js';\r\nimport {MODULE_TYPE_UID} from '../../src/activities/modules.js';\r\nimport {isActivityAllowed, registerActivityControl} from '../../src/activities/rules.js';\r\nimport {ACTIVITY_ACCESS_DEVICE, ACTIVITY_ENRICH_EIDS} from '../../src/activities/activities.js';\r\nimport {activityParams} from '../../src/activities/activityParams.js';\r\nimport {USERSYNC_DEFAULT_CONFIG, type UserSyncConfig} from '../../src/userSync.js';\r\nimport type {ORTBRequest} from \"../../src/types/ortb/request.d.ts\";\r\nimport type {AnyFunction, Wraps} from \"../../src/types/functions.d.ts\";\r\nimport type {ProviderParams, UserId, UserIdProvider, UserIdConfig, IdProviderSpec, ProviderResponse} from \"./spec.ts\";\r\nimport {\r\n  ACTIVITY_PARAM_COMPONENT_NAME,\r\n  ACTIVITY_PARAM_COMPONENT_TYPE,\r\n  ACTIVITY_PARAM_STORAGE_TYPE,\r\n  ACTIVITY_PARAM_STORAGE_WRITE\r\n} from '../../src/activities/params.js';\r\n\r\nconst MODULE_NAME = 'User ID';\r\nconst COOKIE = STORAGE_TYPE_COOKIES;\r\nconst LOCAL_STORAGE = STORAGE_TYPE_LOCALSTORAGE;\r\nexport const PBJS_USER_ID_OPTOUT_NAME = '_pbjs_id_optout';\r\nexport const coreStorage = getCoreStorageManager('userId');\r\nexport const dep = {\r\n  isAllowed: isActivityAllowed\r\n}\r\n\r\ndeclare module '../../src/userSync' {\r\n  interface UserSyncConfig {\r\n    /**\r\n     * EID source to use as PPID for GAM.\r\n     *\r\n     * Publishers using Google AdManager may want to sync one of the identifiers as their Google PPID for frequency capping or reporting.\r\n     * The PPID in GAM (which is unrelated to the PPID UserId Submodule) has strict rules; refer to Google AdManager documentation for them.\r\n     * Please note, Prebid uses a GPT command to sync identifiers for publisher convenience.\r\n     * It doesn’t currently work for instream video requests, as Prebid typically interacts with the player,\r\n     * which in turn may interact with IMA. IMA does has a similar method as GPT, but IMA does not gather this ID from GPT.\r\n     */\r\n    ppid?: string;\r\n    /**\r\n     * Map from userID name (the key in the object returned by `getUserIds`) to names of modules that should be preferred\r\n     * as sources for that ID, in order of decreasing priority.\r\n     */\r\n    idPriority?: {\r\n      [idName: keyof UserId]: UserIdProvider[]\r\n    }\r\n    userIds?: (UserIdConfig<keyof ProviderParams> | UserIdConfig<UserIdProvider>)[];\r\n    // TODO documentation for these is either missing or inscrutable\r\n    encryptedSignalSources?: {\r\n      sources: {\r\n        source: string[]\r\n        encrypt: boolean;\r\n        customFunc: AnyFunction\r\n      }[]\r\n      /**\r\n       * The amount of time (in milliseconds) after which registering of signals will happen. Default value 0 is considered if ‘registerDelay’ is not provided.\r\n       */\r\n      registerDelay?: number;\r\n    }\r\n    /**\r\n     * If true (the default), updating userSync.userIds will not remove previously configured IDs.\r\n     */\r\n    retainConfig?: boolean;\r\n    /**\r\n     * If true, updating userSync.userIds will automatically refresh IDs that have not yet been fetched.\r\n     */\r\n    autoRefresh?: boolean;\r\n\r\n    /**\r\n     * If true, user ID modules will only be allowed to save data in the location specified in the configuration.\r\n     */\r\n    enforceStorageType?: boolean;\r\n  }\r\n}\r\n\r\nlet submodules: SubmoduleContainer<UserIdProvider>[] = [];\r\nlet initializedSubmodules;\r\nlet configRegistry = [];\r\nlet idPriority = {};\r\nlet submoduleRegistry: IdProviderSpec<UserIdProvider>[] = [];\r\nlet timeoutID;\r\nexport let syncDelay;\r\nexport let auctionDelay;\r\n\r\nlet ppidSource;\r\n\r\nlet configListener;\r\n\r\nconst uidMetrics = (() => {\r\n  let metrics;\r\n  return () => {\r\n    if (metrics == null) {\r\n      metrics = newMetrics();\r\n    }\r\n    return metrics;\r\n  }\r\n})();\r\n\r\nfunction submoduleMetrics(moduleName) {\r\n  return uidMetrics().fork().renameWith(n => [`userId.mod.${n}`, `userId.mods.${moduleName}.${n}`])\r\n}\r\n\r\nexport function setSubmoduleRegistry(submodules) {\r\n  submoduleRegistry = submodules;\r\n  updateEIDConfig(submodules);\r\n}\r\n\r\nfunction cookieSetter(submodule, storageMgr?) {\r\n  storageMgr = storageMgr || submodule.storageMgr;\r\n  const domainOverride = (typeof submodule.submodule.domainOverride === 'function') ? submodule.submodule.domainOverride() : null;\r\n  const name = submodule.config.storage.name;\r\n  return function setCookie(suffix, value, expiration) {\r\n    storageMgr.setCookie(name + (suffix || ''), value, expiration, 'Lax', domainOverride);\r\n  }\r\n}\r\n\r\nfunction setValueInCookie(submodule, valueStr, expiresStr) {\r\n  const storage = submodule.config.storage;\r\n  const setCookie = cookieSetter(submodule);\r\n\r\n  setCookie(null, valueStr, expiresStr);\r\n  setCookie('_cst', getConsentHash(), expiresStr);\r\n  if (typeof storage.refreshInSeconds === 'number') {\r\n    setCookie('_last', new Date().toUTCString(), expiresStr);\r\n  }\r\n}\r\n\r\nfunction setValueInLocalStorage(submodule, valueStr, expiresStr) {\r\n  const storage = submodule.config.storage;\r\n  const mgr = submodule.storageMgr;\r\n\r\n  mgr.setDataInLocalStorage(`${storage.name}_exp`, expiresStr);\r\n  mgr.setDataInLocalStorage(`${storage.name}_cst`, getConsentHash());\r\n  mgr.setDataInLocalStorage(storage.name, encodeURIComponent(valueStr));\r\n  if (typeof storage.refreshInSeconds === 'number') {\r\n    mgr.setDataInLocalStorage(`${storage.name}_last`, new Date().toUTCString());\r\n  }\r\n}\r\n\r\nexport function setStoredValue(submodule, value) {\r\n  const storage = submodule.config.storage;\r\n\r\n  try {\r\n    const expiresStr = (new Date(Date.now() + (storage.expires * (60 * 60 * 24 * 1000)))).toUTCString();\r\n    const valueStr = isPlainObject(value) ? JSON.stringify(value) : value;\r\n\r\n    submodule.enabledStorageTypes.forEach(storageType => {\r\n      switch (storageType) {\r\n        case COOKIE:\r\n          setValueInCookie(submodule, valueStr, expiresStr);\r\n          break;\r\n        case LOCAL_STORAGE:\r\n          setValueInLocalStorage(submodule, valueStr, expiresStr);\r\n          break;\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logError(error);\r\n  }\r\n}\r\n\r\nexport const COOKIE_SUFFIXES = ['', '_last', '_cst'];\r\n\r\nfunction deleteValueFromCookie(submodule) {\r\n  const setCookie = cookieSetter(submodule, coreStorage);\r\n  const expiry = (new Date(Date.now() - 1000 * 60 * 60 * 24)).toUTCString();\r\n\r\n  COOKIE_SUFFIXES.forEach(suffix => {\r\n    try {\r\n      setCookie(suffix, '', expiry);\r\n    } catch (e) {\r\n      logError(e);\r\n    }\r\n  })\r\n}\r\n\r\nexport const HTML5_SUFFIXES = ['', '_last', '_exp', '_cst'];\r\n\r\nfunction deleteValueFromLocalStorage(submodule) {\r\n  HTML5_SUFFIXES.forEach(suffix => {\r\n    try {\r\n      coreStorage.removeDataFromLocalStorage(submodule.config.storage.name + suffix);\r\n    } catch (e) {\r\n      logError(e);\r\n    }\r\n  });\r\n}\r\n\r\nexport function deleteStoredValue(submodule) {\r\n  populateEnabledStorageTypes(submodule);\r\n\r\n  submodule.enabledStorageTypes.forEach(storageType => {\r\n    switch (storageType) {\r\n      case COOKIE:\r\n        deleteValueFromCookie(submodule);\r\n        break;\r\n      case LOCAL_STORAGE:\r\n        deleteValueFromLocalStorage(submodule);\r\n        break;\r\n    }\r\n  });\r\n}\r\n\r\nfunction getValueFromCookie(submodule, storedKey) {\r\n  return submodule.storageMgr.getCookie(storedKey)\r\n}\r\n\r\nfunction getValueFromLocalStorage(submodule, storedKey) {\r\n  const mgr = submodule.storageMgr;\r\n  const storage = submodule.config.storage;\r\n  const storedValueExp = mgr.getDataFromLocalStorage(`${storage.name}_exp`);\r\n\r\n  // empty string means no expiration set\r\n  if (storedValueExp === '') {\r\n    return mgr.getDataFromLocalStorage(storedKey);\r\n  } else if (storedValueExp && ((new Date(storedValueExp)).getTime() - Date.now() > 0)) {\r\n    return decodeURIComponent(mgr.getDataFromLocalStorage(storedKey));\r\n  }\r\n}\r\n\r\nfunction getStoredValue(submodule, key = undefined) {\r\n  const storage = submodule.config.storage;\r\n  const storedKey = key ? `${storage.name}_${key}` : storage.name;\r\n  let storedValue;\r\n  try {\r\n    submodule.enabledStorageTypes.find(storageType => {\r\n      switch (storageType) {\r\n        case COOKIE:\r\n          storedValue = getValueFromCookie(submodule, storedKey);\r\n          break;\r\n        case LOCAL_STORAGE:\r\n          storedValue = getValueFromLocalStorage(submodule, storedKey);\r\n          break;\r\n      }\r\n\r\n      return !!storedValue;\r\n    });\r\n\r\n    // support storing a string or a stringified object\r\n    if (typeof storedValue === 'string' && storedValue.trim().charAt(0) === '{') {\r\n      storedValue = JSON.parse(storedValue);\r\n    }\r\n  } catch (e) {\r\n    logError(e);\r\n  }\r\n  return storedValue;\r\n}\r\n\r\nfunction processSubmoduleCallbacks(submodules, cb, priorityMaps) {\r\n  cb = uidMetrics().fork().startTiming('userId.callbacks.total').stopBefore(cb);\r\n  const done = delayExecution(() => {\r\n    clearTimeout(timeoutID);\r\n    cb();\r\n  }, submodules.length);\r\n  submodules.forEach(function (submodule) {\r\n    const moduleDone = submoduleMetrics(submodule.submodule.name).startTiming('callback').stopBefore(done);\r\n    function callbackCompleted(idObj) {\r\n      // if valid, id data should be saved to cookie/html storage\r\n      if (idObj) {\r\n        if (submodule.config.storage) {\r\n          setStoredValue(submodule, idObj);\r\n        }\r\n        // cache decoded value (this is copied to every adUnit bid)\r\n        submodule.idObj = submodule.submodule.decode(idObj, submodule.config);\r\n        priorityMaps.refresh();\r\n        updatePPID(priorityMaps);\r\n      } else {\r\n        logInfo(`${MODULE_NAME}: ${submodule.submodule.name} - request id responded with an empty value`);\r\n      }\r\n      moduleDone();\r\n    }\r\n    try {\r\n      submodule.callback(callbackCompleted, getStoredValue.bind(null, submodule));\r\n    } catch (e) {\r\n      logError(`Error in userID module '${submodule.submodule.name}':`, e);\r\n      moduleDone();\r\n    }\r\n    // clear callback, this prop is used to test if all submodule callbacks are complete below\r\n    submodule.callback = undefined;\r\n  });\r\n}\r\n\r\nfunction getIds(priorityMap): Partial<UserId> {\r\n  return Object.fromEntries(\r\n    Object.entries(priorityMap)\r\n      .map(([key, getActiveModule]: [string, any]) => [key, getActiveModule()?.idObj?.[key]])\r\n      .filter(([_, value]) => value != null)\r\n  )\r\n}\r\n\r\nfunction getPrimaryIds(submodule) {\r\n  if (submodule.primaryIds) return submodule.primaryIds;\r\n  const ids = Object.keys(submodule.eids ?? {});\r\n  if (ids.length > 1) {\r\n    throw new Error(`ID submodule ${submodule.name} can provide multiple IDs, but does not specify 'primaryIds'`)\r\n  }\r\n  return ids;\r\n}\r\n\r\n/**\r\n * Given a collection of items, where each item maps to any number of IDs (getKeys) and an ID module (getIdMod),\r\n * return a map from ID key to all items that map to that ID key, in order of priority (highest priority first).\r\n *\r\n */\r\nfunction orderByPriority(items, getKeys, getIdMod) {\r\n  const tally = {};\r\n  items.forEach(item => {\r\n    const module = getIdMod(item);\r\n    const primaryIds = getPrimaryIds(module);\r\n    getKeys(item).forEach(key => {\r\n      const keyItems = tally[key] = tally[key] ?? []\r\n      const keyPriority = idPriority[key]?.indexOf(module.name) ?? (primaryIds.includes(key) ? 0 : -1);\r\n      const pos = keyItems.findIndex(([priority]) => priority < keyPriority);\r\n      keyItems.splice(pos === -1 ? keyItems.length : pos, 0, [keyPriority, item])\r\n    })\r\n  })\r\n  return Object.fromEntries(Object.entries(tally).map(([key, items]: [string, any]) => [key, items.map(([_, item]) => item)]))\r\n}\r\n\r\nfunction mkPriorityMaps() {\r\n  const map = {\r\n    submodules: [],\r\n    global: {},\r\n    bidder: {},\r\n    combined: {},\r\n    /**\r\n     * @param {SubmoduleContainer[]} addtlModules\r\n     */\r\n    refresh(addtlModules = []) {\r\n      const refreshing = new Set(addtlModules.map(mod => mod.submodule));\r\n      map.submodules = map.submodules.filter((mod) => !refreshing.has(mod.submodule)).concat(addtlModules);\r\n      update();\r\n    }\r\n  }\r\n  function update() {\r\n    const modulesById = orderByPriority(\r\n      map.submodules,\r\n      (submod) => Object.keys(submod.idObj ?? {}),\r\n      (submod) => submod.submodule,\r\n    )\r\n    const global: any = {};\r\n    const bidder: any = {};\r\n\r\n    function activeModuleGetter(key, useGlobals, modules) {\r\n      return function () {\r\n        for (const {allowed, bidders, module} of modules) {\r\n          if (!dep.isAllowed(ACTIVITY_ENRICH_EIDS, activityParams(MODULE_TYPE_UID, module?.config?.name, {init: false}))) {\r\n            continue;\r\n          }\r\n          const value = module.idObj?.[key];\r\n          if (value != null) {\r\n            if (allowed) {\r\n              return module;\r\n            } else if (useGlobals) {\r\n              // value != null, allowed = false, useGlobals = true:\r\n              // this module has the preferred ID but it cannot be used (because it's restricted to only some bidders\r\n              // and we are calculating global IDs).\r\n              // since we don't (yet) have a way to express \"global except for these bidders\" in FPD,\r\n              // do not keep looking for alternative IDs in other (lower priority) modules; the ID will be provided only\r\n              // to the bidders this module is configured for.\r\n              const listModules = (modules) => modules.map(mod => mod.module.submodule.name).join(', ');\r\n              logWarn(`userID modules ${listModules(modules)} provide the same ID ('${key}'); ${module.submodule.name} is the preferred source, but it's configured only for some bidders, unlike ${listModules(modules.filter(mod => mod.bidders == null))}. Other bidders will not see the \"${key}\" ID.`)\r\n              return null;\r\n            } else if (bidders == null) {\r\n              // value != null, allowed = false, useGlobals = false, bidders == null:\r\n              // this module has the preferred ID but it should not be used because it's not bidder-restricted and\r\n              // we are calculating bidder-specific ids. Do not keep looking in other lower priority modules, as the ID\r\n              // will be set globally.\r\n              return null;\r\n            }\r\n          }\r\n        }\r\n        return null;\r\n      }\r\n    }\r\n\r\n    Object.entries(modulesById)\r\n      .forEach(([key, modules]) => {\r\n        let allNonGlobal = true;\r\n        const bidderFilters = new Set<any>();\r\n        modules = modules.map(module => {\r\n          let bidders = null;\r\n          if (Array.isArray(module.config.bidders) && module.config.bidders.length > 0) {\r\n            bidders = module.config.bidders;\r\n            bidders.forEach(bidder => bidderFilters.add(bidder));\r\n          } else {\r\n            allNonGlobal = false;\r\n          }\r\n          return {\r\n            module,\r\n            bidders\r\n          }\r\n        })\r\n        if (!allNonGlobal) {\r\n          global[key] = activeModuleGetter(key, true, modules.map(({bidders, module}) => ({allowed: bidders == null, bidders, module})));\r\n        }\r\n        bidderFilters.forEach(bidderCode => {\r\n          bidder[bidderCode] = bidder[bidderCode] ?? {};\r\n          bidder[bidderCode][key] = activeModuleGetter(key, false, modules.map(({bidders, module}) => ({allowed: bidders?.includes(bidderCode), bidders, module})));\r\n        })\r\n      });\r\n    const combined = Object.values(bidder).concat([global]).reduce((combo, map) => Object.assign(combo, map), {});\r\n    Object.assign(map, {global, bidder, combined});\r\n  }\r\n  return map;\r\n}\r\n\r\nexport function enrichEids(ortb2Fragments) {\r\n  const {global: globalFpd, bidder: bidderFpd} = ortb2Fragments;\r\n  const {global: globalMods, bidder: bidderMods} = initializedSubmodules;\r\n  const globalEids = getEids(globalMods);\r\n  if (globalEids.length > 0) {\r\n    deepSetValue(globalFpd, 'user.ext.eids', (globalFpd.user?.ext?.eids ?? []).concat(globalEids));\r\n  }\r\n  Object.entries(bidderMods).forEach(([bidder, moduleMap]) => {\r\n    const bidderEids = getEids(moduleMap);\r\n    if (bidderEids.length > 0) {\r\n      deepSetValue(\r\n        bidderFpd,\r\n        `${bidder}.user.ext.eids`,\r\n        (bidderFpd[bidder]?.user?.ext?.eids ?? []).concat(bidderEids)\r\n      );\r\n    }\r\n  })\r\n  return ortb2Fragments;\r\n}\r\n\r\ndeclare module '../../src/adapterManager' {\r\n  interface BaseBidRequest {\r\n    userIdAsEids: ORTBRequest['user']['eids'];\r\n  }\r\n}\r\n\r\nexport function addIdData({ortb2Fragments}) {\r\n  ortb2Fragments = ortb2Fragments ?? {global: {}, bidder: {}}\r\n  enrichEids(ortb2Fragments);\r\n}\r\n\r\nconst INIT_CANCELED = {};\r\n\r\nfunction idSystemInitializer({mkDelay = delay} = {}) {\r\n  const startInit = defer<void>();\r\n  const startCallbacks = defer<void>();\r\n  let cancel;\r\n  let initialized = false;\r\n  let initMetrics;\r\n\r\n  function cancelAndTry(promise) {\r\n    initMetrics = uidMetrics().fork();\r\n    if (cancel != null) {\r\n      cancel.reject(INIT_CANCELED);\r\n    }\r\n    cancel = defer();\r\n    return PbPromise.race([promise, cancel.promise])\r\n      .finally(initMetrics.startTiming('userId.total'))\r\n  }\r\n\r\n  // grab a reference to global vars so that the promise chains remain isolated;\r\n  // multiple calls to `init` (from tests) might otherwise cause them to interfere with each other\r\n  const initModules = initializedSubmodules;\r\n  const allModules = submodules;\r\n\r\n  function checkRefs(fn) {\r\n    // unfortunately tests have their own global state that needs to be guarded, so even if we keep ours tidy,\r\n    // we cannot let things like submodule callbacks run (they pollute things like the global `server` XHR mock)\r\n    return function(...args) {\r\n      if (initModules === initializedSubmodules && allModules === submodules) {\r\n        return fn(...args);\r\n      }\r\n    }\r\n  }\r\n\r\n  function timeConsent() {\r\n    return allConsent.promise.finally(initMetrics.startTiming('userId.init.consent'))\r\n  }\r\n\r\n  let done = cancelAndTry(\r\n    PbPromise.all([hooksReady, startInit.promise])\r\n      .then(timeConsent)\r\n      .then(checkRefs(() => {\r\n        initSubmodules(initModules, allModules);\r\n      }))\r\n      .then(() => startCallbacks.promise.finally(initMetrics.startTiming('userId.callbacks.pending')))\r\n      .then(checkRefs(() => {\r\n        const modWithCb = initModules.submodules.filter(item => isFn(item.callback));\r\n        if (modWithCb.length) {\r\n          return new PbPromise((resolve) => processSubmoduleCallbacks(modWithCb, resolve, initModules));\r\n        }\r\n      }))\r\n  );\r\n\r\n  /**\r\n   * with `ready` = true, starts initialization; with `refresh` = true, reinitialize submodules (optionally\r\n   * filtered by `submoduleNames`).\r\n   */\r\n  return function ({refresh = false, submoduleNames = null, ready = false} = {}) {\r\n    if (ready && !initialized) {\r\n      initialized = true;\r\n      startInit.resolve();\r\n      // submodule callbacks should run immediately if `auctionDelay` > 0, or `syncDelay` ms after the\r\n      // auction ends otherwise\r\n      if (auctionDelay > 0) {\r\n        startCallbacks.resolve();\r\n      } else {\r\n        events.on(EVENTS.AUCTION_END, function auctionEndHandler() {\r\n          events.off(EVENTS.AUCTION_END, auctionEndHandler);\r\n          mkDelay(syncDelay).then(startCallbacks.resolve);\r\n        });\r\n      }\r\n    }\r\n    if (refresh && initialized) {\r\n      done = cancelAndTry(\r\n        done\r\n          .catch(() => null)\r\n          .then(timeConsent) // fetch again in case a refresh was forced before this was resolved\r\n          .then(checkRefs(() => {\r\n            const cbModules = initSubmodules(\r\n              initModules,\r\n              allModules.filter((sm) => submoduleNames == null || submoduleNames.includes(sm.submodule.name)),\r\n              true\r\n            ).filter((sm) => {\r\n              return sm.callback != null;\r\n            });\r\n            if (cbModules.length) {\r\n              return new PbPromise((resolve) => processSubmoduleCallbacks(cbModules, resolve, initModules));\r\n            }\r\n          }))\r\n      );\r\n    }\r\n    return done;\r\n  };\r\n}\r\n\r\nlet initIdSystem;\r\n\r\nfunction getPPID(eids = getUserIdsAsEids() || []) {\r\n  // userSync.ppid should be one of the 'source' values in getUserIdsAsEids() eg pubcid.org or id5-sync.com\r\n  const matchingUserId = ppidSource && eids.find(userID => userID.source === ppidSource);\r\n  if (matchingUserId && typeof matchingUserId?.uids?.[0]?.id === 'string') {\r\n    const ppidValue = matchingUserId.uids[0].id.replace(/[\\W_]/g, '');\r\n    if (ppidValue.length >= 32 && ppidValue.length <= 150) {\r\n      return ppidValue;\r\n    } else {\r\n      logWarn(`User ID - Googletag Publisher Provided ID for ${ppidSource} is not between 32 and 150 characters - ${ppidValue}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hook is executed before adapters, but after consentManagement. Consent data is requied because\r\n * this module requires GDPR consent with Purpose #1 to save data locally.\r\n * The two main actions handled by the hook are:\r\n * 1. check gdpr consentData and handle submodule initialization.\r\n * 2. append user id data (loaded from cookied/html or from the getId method) to bids to be accessed in adapters.\r\n * @param {Object} reqBidsConfigObj required; This is the same param that's used in pbjs.requestBids.\r\n * @param {function} fn required; The next function in the chain, used by hook.ts\r\n */\r\nexport const startAuctionHook = timedAuctionHook('userId', function requestBidsHook(fn, reqBidsConfigObj: StartAuctionOptions, {mkDelay = delay, getIds = getUserIdsAsync} = {}) {\r\n  PbPromise.race([\r\n    getIds().catch(() => null),\r\n    mkDelay(auctionDelay)\r\n  ]).then(() => {\r\n    addIdData(reqBidsConfigObj);\r\n    uidMetrics().join(useMetrics(reqBidsConfigObj.metrics), {propagate: false, includeGroups: true});\r\n    // calling fn allows prebid to continue processing\r\n    fn.call(this, reqBidsConfigObj);\r\n  });\r\n});\r\n\r\n/**\r\n * Alias bid requests' `userIdAsEids` to `ortb2.user.ext.eids`\r\n * Do this lazily (instead of attaching a copy) so that it also shows EIDs added after the userId module runs (e.g. from RTD modules)\r\n */\r\nfunction aliasEidsHook(next, bidderRequests) {\r\n  bidderRequests.forEach(bidderRequest => {\r\n    bidderRequest.bids.forEach(bid =>\r\n      Object.defineProperty(bid, 'userIdAsEids', {\r\n        configurable: true,\r\n        get() {\r\n          return bidderRequest.ortb2.user?.ext?.eids;\r\n        }\r\n      })\r\n    )\r\n  })\r\n  next(bidderRequests);\r\n}\r\n\r\n/**\r\n * Is startAuctionHook added\r\n * @returns {boolean}\r\n */\r\nfunction addedStartAuctionHook() {\r\n  return !!startAuction.getHooks({hook: startAuctionHook}).length;\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\nfunction getUserIds() {\r\n  return getIds(initializedSubmodules.combined)\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\nfunction getUserIdsAsEids(): ORTBRequest['user']['eids'] {\r\n  return getEids(initializedSubmodules.combined)\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\n\r\nfunction getUserIdsAsEidBySource(sourceName: string): ORTBRequest['user']['eids'][0] | undefined {\r\n  return getUserIdsAsEids().filter(eid => eid.source === sourceName)[0];\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds for a source can be exposed\r\n * Sample use case is exposing this function to ESP\r\n */\r\nfunction getEncryptedEidsForSource(source, encrypt, customFunction) {\r\n  return retryOnCancel().then(() => {\r\n    const eidsSignals = {};\r\n\r\n    if (isFn(customFunction)) {\r\n      logInfo(`${MODULE_NAME} - Getting encrypted signal from custom function : ${customFunction.name} & source : ${source} `);\r\n      // Publishers are expected to define a common function which will be proxy for signal function.\r\n      const customSignals = customFunction(source);\r\n      eidsSignals[source] = customSignals ? encryptSignals(customSignals) : null; // by default encrypt using base64 to avoid JSON errors\r\n    } else {\r\n      // initialize signal with eids by default\r\n      const eid = getUserIdsAsEidBySource(source);\r\n      logInfo(`${MODULE_NAME} - Getting encrypted signal for eids :${JSON.stringify(eid)}`);\r\n      if (!isEmpty(eid)) {\r\n        eidsSignals[eid.source] = encrypt === true ? encryptSignals(eid) : eid.uids[0].id; // If encryption is enabled append version (1||) and encrypt entire object\r\n      }\r\n    }\r\n    logInfo(`${MODULE_NAME} - Fetching encrypted eids: ${eidsSignals[source]}`);\r\n    return eidsSignals[source];\r\n  })\r\n}\r\n\r\nfunction encryptSignals(signals, version = 1) {\r\n  let encryptedSig = '';\r\n  switch (version) {\r\n    case 1: // Base64 Encryption\r\n      encryptedSig = typeof signals === 'object' ? window.btoa(JSON.stringify(signals)) : window.btoa(signals); // Test encryption. To be replaced with better algo\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n  return `${version}||${encryptedSig}`;\r\n}\r\n\r\n/**\r\n * This function will be exposed in the global-name-space so that publisher can register the signals-ESP.\r\n */\r\nfunction registerSignalSources() {\r\n  if (!isGptPubadsDefined()) {\r\n    return;\r\n  }\r\n\r\n  const providers: googletag.secureSignals.SecureSignalProvider[] = window.googletag.secureSignalProviders = (window.googletag.secureSignalProviders || []) as googletag.secureSignals.SecureSignalProvider[];\r\n  const existingIds = new Set(providers.map(p => 'id' in p ? p.id : p.networkCode));\r\n  const encryptedSignalSources = config.getConfig('userSync.encryptedSignalSources');\r\n  if (encryptedSignalSources) {\r\n    const registerDelay = encryptedSignalSources.registerDelay || 0;\r\n    setTimeout(() => {\r\n      encryptedSignalSources['sources'] && encryptedSignalSources['sources'].forEach(({ source, encrypt, customFunc }) => {\r\n        source.forEach((src) => {\r\n          if (!existingIds.has(src)) {\r\n            providers.push({\r\n              id: src,\r\n              collectorFunction: () => getEncryptedEidsForSource(src, encrypt, customFunc)\r\n            });\r\n            existingIds.add(src);\r\n          }\r\n        });\r\n      })\r\n    }, registerDelay)\r\n  } else {\r\n    logWarn(`${MODULE_NAME} - ESP : encryptedSignalSources config not defined under userSync Object`);\r\n  }\r\n}\r\n\r\nfunction retryOnCancel(initParams?) {\r\n  return initIdSystem(initParams).then(\r\n    () => getUserIds(),\r\n    (e) => {\r\n      if (e === INIT_CANCELED) {\r\n        // there's a pending refresh - because GreedyPromise runs this synchronously, we are now in the middle\r\n        // of canceling the previous init, before the refresh logic has had a chance to run.\r\n        // Use a \"normal\" Promise to clear the stack and let it complete (or this will just recurse infinitely)\r\n        return Promise.resolve().then(getUserIdsAsync)\r\n      } else {\r\n        logError('Error initializing userId', e)\r\n        return PbPromise.reject(e)\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * Force (re)initialization of ID submodules.\r\n *\r\n * This will force a refresh of the specified ID submodules regardless of `auctionDelay` / `syncDelay` settings, and\r\n * return a promise that resolves to the same value as `getUserIds()` when the refresh is complete.\r\n * If a refresh is already in progress, it will be canceled (rejecting promises returned by previous calls to `refreshUserIds`).\r\n *\r\n * submoduleNames submodules to refresh. If omitted, refresh all submodules.\r\n * callback called when the refresh is complete\r\n */\r\nfunction refreshUserIds({submoduleNames}: {\r\n  submoduleNames?: string[]\r\n} = {}, callback?: () => void): Promise<Partial<UserId>> {\r\n  return retryOnCancel({refresh: true, submoduleNames})\r\n    .then((userIds) => {\r\n      if (callback && isFn(callback)) {\r\n        callback();\r\n      }\r\n      return userIds;\r\n    });\r\n}\r\n\r\n/**\r\n * @returns a promise that resolves to the same value as `getUserIds()`, but only once all ID submodules have completed\r\n * initialization. This can also be used to synchronize calls to other ID accessors, e.g.\r\n *\r\n * ```\r\n * pbjs.getUserIdsAsync().then(() => {\r\n *   const eids = pbjs.getUserIdsAsEids(); // guaranteed to be completely initialized at this point\r\n * });\r\n * ```\r\n */\r\n\r\nfunction getUserIdsAsync(): Promise<Partial<UserId>> {\r\n  return retryOnCancel();\r\n}\r\n\r\nexport function getConsentHash() {\r\n  // transform decimal string into base64 to save some space on cookies\r\n  let hash = Number(allConsent.hash);\r\n  const bytes = [];\r\n  while (hash > 0) {\r\n    bytes.push(String.fromCharCode(hash & 255));\r\n    hash = hash >>> 8;\r\n  }\r\n  return btoa(bytes.join(''));\r\n}\r\n\r\nfunction consentChanged(submodule) {\r\n  const storedConsent = getStoredValue(submodule, 'cst');\r\n  return !storedConsent || storedConsent !== getConsentHash();\r\n}\r\n\r\nfunction populateSubmoduleId(submodule: SubmoduleContainer<UserIdProvider>, forceRefresh) {\r\n  const consentData = allConsent.getConsentData();\r\n\r\n  // There are two submodule configuration types to handle: storage or value\r\n  // 1. storage: retrieve user id data from cookie/html storage or with the submodule's getId method\r\n  // 2. value: pass directly to bids\r\n  if (submodule.config.storage) {\r\n    let storedId = getStoredValue(submodule);\r\n    let response;\r\n\r\n    let refreshNeeded = false;\r\n    if (typeof submodule.config.storage.refreshInSeconds === 'number') {\r\n      const storedDate = new Date(getStoredValue(submodule, 'last'));\r\n      refreshNeeded = storedDate && (Date.now() - storedDate.getTime() > submodule.config.storage.refreshInSeconds * 1000);\r\n    }\r\n\r\n    if (!storedId || refreshNeeded || forceRefresh || consentChanged(submodule)) {\r\n      const extendedConfig = Object.assign({ enabledStorageTypes: submodule.enabledStorageTypes }, submodule.config);\r\n\r\n      // No id previously saved, or a refresh is needed, or consent has changed. Request a new id from the submodule.\r\n      response = submodule.submodule.getId(extendedConfig, consentData, storedId);\r\n    } else if (typeof submodule.submodule.extendId === 'function') {\r\n      // If the id exists already, give submodule a chance to decide additional actions that need to be taken\r\n      response = submodule.submodule.extendId(submodule.config, consentData, storedId);\r\n    }\r\n\r\n    if (isPlainObject(response)) {\r\n      if (response.id) {\r\n        // A getId/extendId result assumed to be valid user id data, which should be saved to users local storage or cookies\r\n        setStoredValue(submodule, response.id);\r\n        storedId = response.id;\r\n      }\r\n\r\n      if (typeof response.callback === 'function') {\r\n        // Save async callback to be invoked after auction\r\n        submodule.callback = response.callback as any;\r\n      }\r\n    }\r\n\r\n    if (storedId) {\r\n      // cache decoded value (this is copied to every adUnit bid)\r\n      submodule.idObj = submodule.submodule.decode(storedId, submodule.config);\r\n    }\r\n  } else if (submodule.config.value) {\r\n    // cache decoded value (this is copied to every adUnit bid)\r\n    submodule.idObj = submodule.config.value;\r\n  } else {\r\n    const response = submodule.submodule.getId(submodule.config, consentData);\r\n    if (isPlainObject(response)) {\r\n      if (typeof response.callback === 'function') { submodule.callback = response.callback; }\r\n      if (response.id) { submodule.idObj = submodule.submodule.decode(response.id, submodule.config); }\r\n    }\r\n  }\r\n}\r\n\r\nfunction updatePPID(priorityMaps) {\r\n  const eids = getEids(priorityMaps.combined);\r\n  if (eids.length && ppidSource) {\r\n    const ppid = getPPID(eids);\r\n    if (ppid) {\r\n      if (isGptPubadsDefined()) {\r\n        window.googletag.pubads().setPublisherProvidedId(ppid);\r\n      } else {\r\n        (window as any).googletag = window.googletag || {};\r\n        (window.googletag as any).cmd = window.googletag.cmd || [];\r\n        window.googletag.cmd.push(function() {\r\n          window.googletag.pubads().setPublisherProvidedId(ppid);\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction initSubmodules(priorityMaps, submodules, forceRefresh = false) {\r\n  return uidMetrics().fork().measureTime('userId.init.modules', function () {\r\n    if (!submodules.length) return []; // to simplify log messages from here on\r\n    submodules.forEach(submod => populateEnabledStorageTypes(submod));\r\n\r\n    /**\r\n     * filter out submodules that:\r\n     *\r\n     *  - cannot use the storage they've been set up with (storage not available / not allowed / disabled)\r\n     *  - are not allowed to perform the `enrichEids` activity\r\n     */\r\n    submodules = submodules.filter((submod) => {\r\n      return (!submod.config.storage || canUseStorage(submod)) &&\r\n        dep.isAllowed(ACTIVITY_ENRICH_EIDS, activityParams(MODULE_TYPE_UID, submod.config.name));\r\n    });\r\n\r\n    if (!submodules.length) {\r\n      logWarn(`${MODULE_NAME} - no ID module configured`);\r\n      return [];\r\n    }\r\n\r\n    const initialized = submodules.reduce((carry, submodule) => {\r\n      return submoduleMetrics(submodule.submodule.name).measureTime('init', () => {\r\n        try {\r\n          populateSubmoduleId(submodule, forceRefresh);\r\n          carry.push(submodule);\r\n        } catch (e) {\r\n          logError(`Error in userID module '${submodule.submodule.name}':`, e);\r\n        }\r\n        return carry;\r\n      })\r\n    }, []);\r\n    priorityMaps.refresh(initialized);\r\n    updatePPID(priorityMaps);\r\n    return initialized;\r\n  })\r\n}\r\n\r\nfunction getConfiguredStorageTypes(config) {\r\n  return config?.storage?.type?.trim().split(/\\s*&\\s*/) || [];\r\n}\r\n\r\nfunction hasValidStorageTypes(config) {\r\n  const storageTypes = getConfiguredStorageTypes(config);\r\n\r\n  return storageTypes.every(storageType => ALL_STORAGE_TYPES.has(storageType));\r\n}\r\n\r\n/**\r\n * list of submodule configurations with valid 'storage' or 'value' obj definitions\r\n * storage config: contains values for storing/retrieving User ID data in browser storage\r\n * value config: object properties that are copied to bids (without saving to storage)\r\n */\r\nexport function getValidSubmoduleConfigs(configRegistry) {\r\n  function err(msg, ...args) {\r\n    logWarn(`Invalid userSync.userId config: ${msg}`, ...args)\r\n  }\r\n  if (!Array.isArray(configRegistry)) {\r\n    if (configRegistry != null) {\r\n      err('must be an array', configRegistry);\r\n    }\r\n    return [];\r\n  }\r\n  return configRegistry.filter(config => {\r\n    if (!config?.name) {\r\n      return err('must specify \"name\"', config);\r\n    } else if (config.storage) {\r\n      if (!config.storage.name || !config.storage.type) {\r\n        return err('must specify \"storage.name\" and \"storage.type\"', config);\r\n      } else if (!hasValidStorageTypes(config)) {\r\n        return err('invalid \"storage.type\"', config)\r\n      }\r\n      ['expires', 'refreshInSeconds'].forEach(param => {\r\n        let value = config.storage[param];\r\n        if (value != null && typeof value !== 'number') {\r\n          value = Number(value)\r\n          if (isNaN(value)) {\r\n            err(`storage.${param} must be a number and will be ignored`, config);\r\n            delete config.storage[param];\r\n          } else {\r\n            config.storage[param] = value;\r\n          }\r\n        }\r\n      });\r\n    }\r\n    return true;\r\n  })\r\n}\r\n\r\nconst ALL_STORAGE_TYPES = new Set([LOCAL_STORAGE, COOKIE]);\r\n\r\nfunction canUseLocalStorage(submodule) {\r\n  if (!submodule.storageMgr.localStorageIsEnabled()) {\r\n    return false;\r\n  }\r\n\r\n  if (coreStorage.getDataFromLocalStorage(PBJS_USER_ID_OPTOUT_NAME)) {\r\n    logInfo(`${MODULE_NAME} - opt-out localStorage found, storage disabled`);\r\n    return false\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction canUseCookies(submodule) {\r\n  if (!submodule.storageMgr.cookiesAreEnabled()) {\r\n    return false;\r\n  }\r\n\r\n  if (coreStorage.getCookie(PBJS_USER_ID_OPTOUT_NAME)) {\r\n    logInfo(`${MODULE_NAME} - opt-out cookie found, storage disabled`);\r\n    return false;\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nconst STORAGE_PURPOSES = [1, 2, 3, 4, 7];\r\n\r\nfunction populateEnabledStorageTypes(submodule: SubmoduleContainer<UserIdProvider>) {\r\n  if (submodule.enabledStorageTypes) {\r\n    return;\r\n  }\r\n\r\n  const storageTypes = getConfiguredStorageTypes(submodule.config);\r\n\r\n  submodule.enabledStorageTypes = storageTypes.filter(type => {\r\n    switch (type) {\r\n      case LOCAL_STORAGE:\r\n        HTML5_SUFFIXES.forEach(suffix => {\r\n          discloseStorageUse('userId', {\r\n            type: 'web',\r\n            identifier: submodule.config.storage.name + suffix,\r\n            purposes: STORAGE_PURPOSES\r\n          })\r\n        })\r\n        return canUseLocalStorage(submodule);\r\n      case COOKIE:\r\n        COOKIE_SUFFIXES.forEach(suffix => {\r\n          discloseStorageUse('userId', {\r\n            type: 'cookie',\r\n            identifier: submodule.config.storage.name + suffix,\r\n            purposes: STORAGE_PURPOSES,\r\n            maxAgeSeconds: (submodule.config.storage.expires ?? 0) * 24 * 60 * 60,\r\n            cookieRefresh: true\r\n          })\r\n        })\r\n        return canUseCookies(submodule);\r\n    }\r\n\r\n    return false;\r\n  });\r\n}\r\n\r\nfunction canUseStorage(submodule) {\r\n  return !!submodule.enabledStorageTypes.length;\r\n}\r\n\r\nfunction updateEIDConfig(submodules) {\r\n  EID_CONFIG.clear();\r\n  Object.entries(\r\n    orderByPriority(\r\n      submodules,\r\n      (mod) => Object.keys(mod.eids || {}),\r\n      (mod) => mod\r\n    )\r\n  ).forEach(([key, submodules]) => EID_CONFIG.set(key, submodules[0].eids[key]))\r\n}\r\n\r\nexport function generateSubmoduleContainers(options, configs, prevSubmodules = submodules, registry = submoduleRegistry) {\r\n  const {autoRefresh, retainConfig} = options;\r\n  return registry\r\n    .reduce((acc, submodule) => {\r\n      const {name, aliasName} = submodule;\r\n      const matchesName = (query) => [name, aliasName].some(value => value?.toLowerCase() === query.toLowerCase());\r\n      const submoduleConfig = configs.find((configItem) => matchesName(configItem.name));\r\n\r\n      if (!submoduleConfig) {\r\n        if (!retainConfig) return acc;\r\n        const previousSubmodule = prevSubmodules.find(prevSubmodules => matchesName(prevSubmodules.config.name));\r\n        return previousSubmodule ? [...acc, previousSubmodule] : acc;\r\n      }\r\n\r\n      const newSubmoduleContainer: SubmoduleContainer<UserIdProvider> = {\r\n        submodule,\r\n        config: {\r\n          ...submoduleConfig,\r\n          name: submodule.name\r\n        },\r\n        callback: undefined,\r\n        idObj: undefined,\r\n        storageMgr: newStorageManager({\r\n          moduleType: MODULE_TYPE_UID,\r\n          moduleName: submoduleConfig.name,\r\n          // since this manager is only using keys provided directly by the publisher,\r\n          // turn off storageControl checks\r\n          advertiseKeys: false,\r\n        })\r\n      };\r\n\r\n      if (autoRefresh) {\r\n        const previousSubmodule = prevSubmodules.find(prevSubmodules => matchesName(prevSubmodules.config.name));\r\n        newSubmoduleContainer.refreshIds = !previousSubmodule || !deepEqual(newSubmoduleContainer.config, previousSubmodule.config);\r\n      }\r\n\r\n      return [...acc, newSubmoduleContainer];\r\n    }, []);\r\n}\r\n\r\ntype SubmoduleContainer<P extends UserIdProvider> = {\r\n  submodule: IdProviderSpec<P>;\r\n  enabledStorageTypes?: StorageType[];\r\n  config: UserIdConfig<P>;\r\n  callback?: ProviderResponse['callback'];\r\n  idObj;\r\n  storageMgr: StorageManager;\r\n  refreshIds?: boolean;\r\n}\r\n\r\n/**\r\n * update submodules by validating against existing configs and storage types\r\n */\r\nfunction updateSubmodules(options = {}) {\r\n  updateEIDConfig(submoduleRegistry);\r\n  const configs = getValidSubmoduleConfigs(configRegistry);\r\n  if (!configs.length) {\r\n    return;\r\n  }\r\n\r\n  const updatedContainers = generateSubmoduleContainers(options, configs);\r\n  submodules.splice(0, submodules.length);\r\n  submodules.push(...updatedContainers);\r\n\r\n  if (submodules.length) {\r\n    if (!addedStartAuctionHook()) {\r\n      startAuction.before(startAuctionHook, 100) // use higher priority than dataController / rtd\r\n      adapterManager.callDataDeletionRequest.before(requestDataDeletion);\r\n      coreGetPPID.after((next) => next(getPPID()));\r\n    }\r\n    logInfo(`${MODULE_NAME} - usersync config updated for ${submodules.length} submodules: `, submodules.map(a => a.submodule.name));\r\n  }\r\n}\r\n\r\n/**\r\n * This function will update the idPriority according to the provided configuration\r\n */\r\nfunction updateIdPriority(idPriorityConfig, submodules) {\r\n  if (idPriorityConfig) {\r\n    const result = {};\r\n    const aliasToName = new Map(submodules.map(s => s.aliasName ? [s.aliasName, s.name] : []));\r\n    Object.keys(idPriorityConfig).forEach(key => {\r\n      const priority = isArray(idPriorityConfig[key]) ? [...idPriorityConfig[key]].reverse() : []\r\n      result[key] = priority.map(s => aliasToName.has(s) ? aliasToName.get(s) : s);\r\n    });\r\n    idPriority = result;\r\n  } else {\r\n    idPriority = {};\r\n  }\r\n  initializedSubmodules.refresh();\r\n  updateEIDConfig(submodules)\r\n}\r\n\r\nexport function requestDataDeletion(next, ...args) {\r\n  logInfo('UserID: received data deletion request; deleting all stored IDs...')\r\n  submodules.forEach(submodule => {\r\n    if (typeof submodule.submodule.onDataDeletionRequest === 'function') {\r\n      try {\r\n        submodule.submodule.onDataDeletionRequest(submodule.config, submodule.idObj, ...args);\r\n      } catch (e) {\r\n        logError(`Error calling onDataDeletionRequest for ID submodule ${submodule.submodule.name}`, e);\r\n      }\r\n    }\r\n    deleteStoredValue(submodule);\r\n  })\r\n  next.apply(this, args);\r\n}\r\n\r\n/**\r\n * enable submodule in User ID\r\n */\r\nexport function attachIdSystem(submodule: IdProviderSpec<UserIdProvider>) {\r\n  submodule.findRootDomain = findRootDomain;\r\n  if (!(submoduleRegistry || []).find(i => i.name === submodule.name)) {\r\n    submoduleRegistry.push(submodule);\r\n    GDPR_GVLIDS.register(MODULE_TYPE_UID, submodule.name, submodule.gvlid)\r\n    updateSubmodules();\r\n    // TODO: a test case wants this to work even if called after init (the setConfig({userId}))\r\n    // so we trigger a refresh. But is that even possible outside of tests?\r\n    initIdSystem({refresh: true, submoduleNames: [submodule.name]});\r\n  }\r\n}\r\n\r\nfunction normalizePromise<T extends AnyFunction>(fn: T): Wraps<T> {\r\n  // for public methods that return promises, make sure we return a \"normal\" one - to avoid\r\n  // exposing confusing stack traces\r\n  return function(...args) {\r\n    return Promise.resolve(fn.apply(this, args));\r\n  } as any;\r\n}\r\n\r\ndeclare module '../../src/prebidGlobal' {\r\n  interface PrebidJS {\r\n    getUserIds: typeof getUserIds;\r\n    getUserIdsAsync: typeof getUserIdsAsync;\r\n    getUserIdsAsEids: typeof getUserIdsAsEids;\r\n    getEncryptedEidsForSource: typeof getEncryptedEidsForSource;\r\n    registerSignalSources: typeof registerSignalSources;\r\n    refreshUserIds: typeof refreshUserIds;\r\n    getUserIdsAsEidBySource: typeof getUserIdsAsEidBySource;\r\n  }\r\n}\r\n\r\nconst enforceStorageTypeRule = (userIdsConfig, enforceStorageType) => {\r\n  return (params) => {\r\n    if (params[ACTIVITY_PARAM_COMPONENT_TYPE] !== MODULE_TYPE_UID || !params[ACTIVITY_PARAM_STORAGE_WRITE]) return;\r\n\r\n    const matchesName = (query) => params[ACTIVITY_PARAM_COMPONENT_NAME]?.toLowerCase() === query?.toLowerCase();\r\n    const submoduleConfig = userIdsConfig.find((configItem) => matchesName(configItem.name));\r\n\r\n    if (!submoduleConfig || !submoduleConfig.storage) return;\r\n\r\n    if (params[ACTIVITY_PARAM_STORAGE_TYPE] !== submoduleConfig.storage.type) {\r\n      const reason = `${submoduleConfig.name} attempts to store data in ${params[ACTIVITY_PARAM_STORAGE_TYPE]} while configuration allows ${submoduleConfig.storage.type}.`;\r\n      if (enforceStorageType) {\r\n        return {allow: false, reason};\r\n      } else {\r\n        logWarn(reason);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * test browser support for storage config types (local storage or cookie), initializes submodules but consentManagement is required,\r\n * so a callback is added to fire after the consentManagement module.\r\n * @param {{getConfig:function}} config\r\n */\r\nexport function init(config, {mkDelay = delay} = {}) {\r\n  ppidSource = undefined;\r\n  submodules = [];\r\n  configRegistry = [];\r\n  initializedSubmodules = mkPriorityMaps();\r\n  initIdSystem = idSystemInitializer({mkDelay});\r\n  if (configListener != null) {\r\n    configListener();\r\n  }\r\n  submoduleRegistry = [];\r\n  let unregisterEnforceStorageTypeRule: () => void\r\n\r\n  // listen for config userSyncs to be set\r\n  configListener = config.getConfig('userSync', conf => {\r\n    // Note: support for 'usersync' was dropped as part of Prebid.js 4.0\r\n    const userSync: UserSyncConfig = conf.userSync;\r\n    if (userSync) {\r\n      ppidSource = userSync.ppid;\r\n      if (userSync.userIds) {\r\n        const {autoRefresh = false, retainConfig = true, enforceStorageType} = userSync;\r\n        configRegistry = userSync.userIds;\r\n        syncDelay = isNumber(userSync.syncDelay) ? userSync.syncDelay : USERSYNC_DEFAULT_CONFIG.syncDelay\r\n        auctionDelay = isNumber(userSync.auctionDelay) ? userSync.auctionDelay : USERSYNC_DEFAULT_CONFIG.auctionDelay;\r\n        updateSubmodules({retainConfig, autoRefresh});\r\n        unregisterEnforceStorageTypeRule?.();\r\n        unregisterEnforceStorageTypeRule = registerActivityControl(ACTIVITY_ACCESS_DEVICE, 'enforceStorageTypeRule', enforceStorageTypeRule(submodules.map(({config}) => config), enforceStorageType));\r\n        updateIdPriority(userSync.idPriority, submoduleRegistry);\r\n        initIdSystem({ready: true});\r\n        const submodulesToRefresh = submodules.filter(item => item.refreshIds);\r\n        if (submodulesToRefresh.length) {\r\n          refreshUserIds({submoduleNames: submodulesToRefresh.map(item => item.submodule.name)});\r\n        }\r\n      }\r\n    }\r\n  });\r\n  adapterManager.makeBidRequests.after(aliasEidsHook);\r\n\r\n  // exposing getUserIds function in global-name-space so that userIds stored in Prebid can be used by external codes.\r\n  addApiMethod('getUserIds', getUserIds);\r\n  addApiMethod('getUserIdsAsEids', getUserIdsAsEids);\r\n  addApiMethod('getEncryptedEidsForSource', normalizePromise(getEncryptedEidsForSource));\r\n  addApiMethod('registerSignalSources', registerSignalSources);\r\n  addApiMethod('refreshUserIds', normalizePromise(refreshUserIds));\r\n  addApiMethod('getUserIdsAsync', normalizePromise(getUserIdsAsync));\r\n  addApiMethod('getUserIdsAsEidBySource', getUserIdsAsEidBySource);\r\n}\r\n\r\nexport function resetUserIds() {\r\n  config.setConfig({userSync: {}})\r\n  init(config);\r\n}\r\n\r\n// init config update listener to start the application\r\ninit(config);\r\n\r\nmodule('userId', attachIdSystem, { postInstallAllowed: true });\r\n","})()\r\n \r\n   pbjs.processQueue();\r\n \r\n} else {\r\n try {\r\n  if(window.pbjs.getConfig('debug')) {\r\n    console.warn('Attempted to load a copy of Prebid.js that clashes with the existing \\'pbjs\\' instance. Load aborted.');\r\n  }\r\n } catch (e) {}\r\n}\r\n"]}
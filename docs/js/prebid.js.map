{"version":3,"sources":["../prebid-header.js","webpack://prebid.js/src/Renderer.js","webpack://prebid.js/src/adRendering.js","webpack://prebid.js/src/adUnits.js","webpack://prebid.js/src/adapter.js","webpack://prebid.js/src/adapterManager.js","webpack://prebid.js/src/adapters/bidderFactory.js","webpack://prebid.js/src/adloader.js","webpack://prebid.js/src/ajax.js","webpack://prebid.js/src/auction.js","webpack://prebid.js/src/auctionIndex.js","webpack://prebid.js/src/auctionManager.js","webpack://prebid.js/src/bidderSettings.js","webpack://prebid.js/src/bidfactory.js","webpack://prebid.js/src/config.js","webpack://prebid.js/src/consentHandler.js","webpack://prebid.js/src/cpmBucketManager.js","webpack://prebid.js/src/debugging.js","webpack://prebid.js/src/events.js","webpack://prebid.js/src/hook.js","webpack://prebid.js/src/mediaTypes.js","webpack://prebid.js/src/native.js","webpack://prebid.js/src/polyfill.js","webpack://prebid.js/src/prebid.js","webpack://prebid.js/src/prebidGlobal.js","webpack://prebid.js/src/refererDetection.js","webpack://prebid.js/src/secureCreatives.js","webpack://prebid.js/src/sizeMapping.js","webpack://prebid.js/src/storageManager.js","webpack://prebid.js/src/targeting.js","webpack://prebid.js/src/userSync.js","webpack://prebid.js/src/utils.js","webpack://prebid.js/src/utils/perfMetrics.js","webpack://prebid.js/src/utils/promise.js","webpack://prebid.js/src/video.js","webpack://prebid.js/src/videoCache.js","webpack://prebid.js/node_modules/dlv/index.js","webpack://prebid.js/node_modules/fun-hooks/no-eval/index.js","webpack://prebid.js/node_modules/just-clone/index.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classApplyDescriptorGet.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classApplyDescriptorSet.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classExtractFieldDescriptor.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/get.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/inherits.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/superPropBase.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://prebid.js/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://prebid.js/node_modules/dset/dist/index.mjs","webpack://prebid.js/webpack/bootstrap","webpack://prebid.js/webpack/runtime/chunk loaded","webpack://prebid.js/webpack/runtime/compat get default export","webpack://prebid.js/webpack/runtime/define property getters","webpack://prebid.js/webpack/runtime/hasOwnProperty shorthand","webpack://prebid.js/webpack/runtime/jsonp chunk loading","webpack://prebid.js/webpack/startup","webpack://prebid.js/libraries/analyticsAdapter/AnalyticsAdapter.js","webpack://prebid.js/modules/adpod.js","webpack://prebid.js/modules/appnexusBidAdapter.js","webpack://prebid.js/src/utils/gpdr.js","webpack://prebid.js/modules/conversantAnalyticsAdapter.js","webpack://prebid.js/modules/conversantBidAdapter.js","webpack://prebid.js/modules/dfpAdServerVideo.js","webpack://prebid.js/src/adServerManager.js","webpack://prebid.js/src/adserver.js","webpack://prebid.js/modules/identityLinkIdSystem.js","webpack://prebid.js/modules/openxBidAdapter.js","webpack://prebid.js/modules/publinkIdSystem.js","webpack://prebid.js/modules/sharedIdSystem.js","webpack://prebid.js/modules/userId/eids.js","webpack://prebid.js/modules/userId/index.js","../prebid-footer.js"],"names":["moduleCode","Renderer","options","url","config","id","callback","loaded","adUnitCode","renderNow","handlers","cmd","push","func","logError","call","process","render","renderArgs","arguments","runRender","_render","apply","logWarn","isRendererPreferredFromAdUnit","unshift","loadExternalScript","documentContext","bind","install","prototype","getConfig","setRender","fn","setEventHandlers","handleVideoEvent","eventName","logMessage","length","shift","error","isRendererRequired","renderer","executeRenderer","bid","doc","docContext","documentResolver","document","adUnits","adUnit","find","code","adUnitRenderer","deepAccess","hasValidAdUnitRenderer","mediaTypeRenderer","hasValidMediaTypeRenderer","backupOnly","CONSTANTS","AD_RENDER_FAILED","AD_RENDER_SUCCEEDED","emitAdRenderFail","reason","message","data","adId","events","emitAdRenderSucceeded","ensureAdUnit","adunit","bidderCode","bidders","incrementAdUnitCount","counter","incrementRequestsCounter","incrementBidderRequestsCounter","incrementBidderWinsCounter","getRequestsCounter","getBidderRequestsCounter","bidder","getBidderWinsCounter","adunitCounter","Adapter","setBidderCode","getBidderCode","callBids","PARTITIONS","CLIENT","SERVER","adapterManager","_bidderRegistry","bidderRegistry","_aliasRegistry","aliasRegistry","_s2sConfigs","s2sConfig","isArray","_analyticsRegistry","getBids","auctionId","bidderRequestId","src","metrics","reduce","result","bids","filter","Object","assign","getDefinedParams","mediaTypes","isValidMediaTypes","transactionId","sizes","bidId","bid_id","getUniqueIdentifierStr","bidRequestsCount","bidderRequestsCount","bidderWinsCount","flatten","val","hookedGetBids","hook","_filterBidsForAdUnit","getS2SBidders","getS2SBidderSet","serverBidders","has","filterBidsForAdUnit","getAdUnitCopyForPrebidServer","adUnitsCopy","deepClone","forEach","map","getAdUnitCopyForClientAdapters","adUnitsClientCopy","gdprDataHandler","GdprConsentHandler","uspDataHandler","UspConsentHandler","coppaDataHandler","getCoppa","setupAdUnitMediaTypes","labels","processAdUnitsForLabels","s2sConfigs","Set","s2s","enabled","flatMap","add","_partitionBidders","getBidderCodes","memo","partition","partitionBidders","makeBidRequests","auctionStart","cbTimeout","ortb2Fragments","auctionMetrics","useMetrics","decorateAdUnitsWithNativeParams","clientBidders","RANDOM","shuffle","refererInfo","getRefererInfo","bidRequests","ortb2","global","bidderOrtb2","addOrtb2","bidderRequest","fpd","freeze","mergeDeep","adUnitsS2SCopy","uniquePbsTid","generateUUID","fork","timeout","adUnitCopy","validBids","adUnitBid","request","reqBid","undefined","adapter","getConsentData","bidRequest","fledgeEnabledFromConfig","navigator","runAdAuction","addBidResponse","doneCb","requestCallbacks","requestBidsTimeout","onTimelyResponse","partitions","Number","clientBidRequests","serverBidRequests","uniqueServerBidRequests","serverBidRequest","index","i","s2sAjax","ajaxBuilder","done","adaptersServerSide","s2sAdapter","uniqueServerRequests","s2sBidRequest","ad_units","doneCbs","start","timestamp","includes","join","tid","ajax","adapterDone","e","getSupportedMediaTypes","supportedMediaTypes","videoAdapters","nativeAdapters","registerBidAdapter","bidAdapter","aliasBidAdapter","alias","existingAlias","nonS2SAlias","s2sBidders","newAdapter","constructor","spec","getSpec","gvlid","skipPbsAliasing","newBidder","registerAnalyticsAdapter","enableAnalytics","_each","adapterConfig","entry","provider","getBidAdapter","getAnalyticsAdapter","tryCallBidderMethod","method","param","logInfo","callTimedOutBidders","timedOutBidders","timedOutBidder","params","getUserConfiguredParams","groupBy","keys","callBidWonBidder","callSetTargetingBidder","callBidViewableBidder","callBidderError","storage","getCoreStorageManager","COMMON_BID_RESPONSE_KEYS","DEFAULT_REFRESHIN_DAYS","registerBidder","Array","putBidder","aliases","aliasCode","isPlainObject","registerSyncs","configEnabledCallback","adUnitCodesHandled","addBidWithCode","checkpoint","measureTime","isValid","responses","afterAllResponses","gdprConsent","uspConsent","validBidRequests","adapterMetrics","filterAndWarn","bidRequestMap","placementCode","processBidderRequests","onRequest","requestObject","onResponse","resp","onFledgeAuctionConfigs","fledgeAuctionConfigs","fledgeAuctionConfig","addComponentAuction","onError","errorMessage","status","onBid","requestId","adapterCode","isInvalidAlternateBidder","originalCpm","cpm","originalCurrency","currency","meta","prebidBid","createBid","onCompletion","responseBidder","requestBidder","allowAlternateBidderCodes","bidderSettings","alternateBiddersList","trim","toLowerCase","uniques","registerSyncInner","isBidRequestValid","JSON","stringify","wrapCallback","startTiming","stopBefore","requests","buildRequests","requestDone","delayExecution","requestMetrics","addBid","renameWith","onSuccess","response","responseObj","networkDone","parse","body","headers","headerParser","interpretResponse","err","xmlHttpResponse","get","getResponseHeader","onFailure","formatGetParameters","success","withCredentials","contentType","type","parseQueryStringParameters","aliasSyncEnabled","getUserSyncs","filterConfig","syncs","iframeEnabled","iframe","all","pixelEnabled","image","sync","userSync","_bidRequest","preloadBidderMappingFile","adPodBidders","ADPOD","bidderSpec","getMappingFileInfo","info","refreshInDays","key","localStorageKey","mappingData","getDataFromLocalStorage","lastUpdated","mapping","setDataInLocalStorage","getHook","before","getIabSubCategory","category","validBidSize","auctionManager","width","parseInt","height","getBidRequest","getMediaTypes","banner","parsedSizes","parseSizesInput","split","hasValidKeys","bidKeys","every","msg","mediaType","nativeBidIsValid","isValidVideoBid","n","_requestCache","WeakMap","_approvedLoadExternalJSList","attributes","storedCachedObject","getCacheObject","callbacks","tag","cachedDocObj","cacheObject","set","requestResource","tagSrc","jptScript","createElement","async","readyState","onreadystatechange","onload","setScriptAttributes","insertElement","XHR_DONE","x","parser","href","window","XMLHttpRequest","origin","responseText","statusText","ontimeout","urlInfo","parseUrl","search","buildUrl","open","customHeaders","value","header","setRequestHeader","preflight","send","syncUsers","AUCTION_STARTED","AUCTION_IN_PROGRESS","AUCTION_COMPLETED","adjustBids","MAX_REQUESTS_PER_ORIGIN","outstandingRequests","sourceInfo","queuedCalls","resetAuctionState","ob","k","newAuction","adUnitCodes","_adUnits","_labels","_adUnitCodes","_bidderRequests","_bidsReceived","_noBids","_auctionStart","_auctionEnd","_auctionId","_auctionStatus","_callback","_timer","_timeout","_winningBids","_timelyBidders","addBidRequests","bidderRequests","concat","addBidReceived","bidsReceived","addNoBid","noBid","getProperties","auctionEnd","auctionStatus","noBids","winningBids","startAuctionTimer","timedOut","timeoutCallback","executeCallback","timer","setTimeout","cleartimer","clearTimeout","getTimedOutBids","Date","now","timeBetween","bidsBackCallback","adUnitsFilter","groupByPlacement","userSyncConfig","enableOverride","syncDelay","auctionDone","addBidderRequests","dispatch","addBidderRequestsCallback","context","run","auctionCallbacks","source","increment","SRA","runIfOriginHasCapacity","hasCapacity","maxRequests","some","Math","min","obj","prop","addWinningBid","winningBid","setBidTargeting","getWinningBids","getAuctionStart","getTimeout","getAuctionId","getAuctionStatus","getAdUnits","getAdUnitCodes","getBidRequests","getBidsReceived","getNoBids","getFPD","getMetrics","auctionInstance","outstandingBidsAdded","allAdapterCalledDone","bidderRequestsDone","bidResponseMap","ready","waitFor","GreedyPromise","then","catch","guard","timeRemaining","wait","orphanWait","afterBidAdded","handleBidResponse","bidResponse","getPreparedBidForAuction","tryAddVideoBid","addBidToAuction","auctionOptionsConfig","isEmpty","secondaryBidders","getBidderRequest","doCallbacksIfTimedout","timeToRespond","setupBidTargeting","timeSince","videoMediaType","originalRequestId","useCacheKey","OUTSTREAM","videoCacheKey","callPrebidCache","vastUrl","storeInCache","batch","store","cacheIds","cacheId","uuid","getCacheUrl","batchSize","batchTimeout","cacheConfig","cache","batchingCache","batches","debouncing","noTimeout","cb","batchFunc","batchAndStore","requestTimestamp","bidObject","responseTimestamp","parseFloat","getAdUnit","bidObjectMediaType","bidMediaType","mediaTypeGranularity","getMediaTypeGranularity","priceStringsObj","getPriceBucketString","pbLg","low","pbMg","med","pbHg","high","pbAg","auto","pbDg","dense","pbCg","custom","keyValues","cpmCheck","dealId","getKeyValueTargetingPairs","adserverTargeting","mediaTypePriceGranularity","VIDEO","getPriceGranularity","granularity","getPriceByGranularity","bidGranularity","getAdvertiserDomain","advertiserDomains","createKeyVal","bidReq","getValue","defaultAdserverTargeting","TARGETING_KEYS","BIDDER","AD_ID","PRICE_BUCKET","SIZE","DEAL","SOURCE","FORMAT","ADOMAIN","getStandardBidderSettings","standardSettings","slice","UUID","CACHE_ID","targetingKeyVal","kvPair","CACHE_HOST","hostname","custBidObj","setKeys","sendStandardTargeting","getNativeTargeting","targeting","size","getSize","isFn","suppressEmptyKeys","isEmptyStr","bidPriceAdjusted","bidCpmAdjustment","bidsByPlacement","timelyBidders","timedOutBids","AuctionIndex","getAuctions","getAuction","auction","a","au","req","bers","ber","br","newAuctionManager","_auctions","getAllWinningBids","getBidsRequested","getAllBidsForAdUnitCode","createAuction","opts","_addAuction","findBidByAdId","getStandardBidderAdServerTargeting","setStatusForBids","getLastAuctionId","clearAllAuctions","ScopedSettings","getSettings","defaultScope","scope","path","getOwn","ownSettingsFor","getGlobal","Bid","statusCode","_bidSrc","_statusCode","statusMessage","_getStatus","getStatusCode","getIdentifiers","identifiers","DEFAULT_DEBUG","getParameterByName","toUpperCase","DEFAULT_BIDDER_TIMEOUT","DEFAULT_ENABLE_SEND_ALL_BIDS","DEFAULT_DISABLE_AJAX_TIMEOUT","DEFAULT_BID_CACHE","DEFAULT_DEVICE_ACCESS","DEFAULT_MAX_NESTED_IFRAMES","DEFAULT_TIMEOUTBUFFER","FIXED","VALID_ORDERS","DEFAULT_BIDDER_SEQUENCE","GRANULARITY_OPTIONS","LOW","MEDIUM","HIGH","AUTO","DENSE","CUSTOM","ALL_TOPICS","newConfig","listeners","defaults","bidderConfig","currBidder","resetConfig","_debug","debug","_bidderTimeout","bidderTimeout","_publisherDomain","publisherDomain","_priceGranularity","priceGranularity","validatePriceGranularity","hasGranularity","_customPriceBucket","customPriceBucket","_mediaTypePriceGranularity","aggregate","item","_sendAllBids","enableSendAllBids","_useBidCache","useBidCache","_deviceAccess","deviceAccess","_bidderSequence","bidderSequence","_timeoutBuffer","timeoutBuffer","_disableAjaxTimeout","disableAjaxTimeout","_maxNestedIframes","maxNestedIframes","_auctionOptions","auctionOptions","validateauctionOptions","callSubscribers","topic","option","isValidPriceConfig","isStr","isBoolean","_getConfig","currBidderConfig","configTopicSet","from","_getRestrictedConfig","conf","defineProperty","Error","accessor","subscribe","getAnyConfig","wrapee","readConfig","res","readAnyConfig","getBidderConfig","setConfig","topics","topicalConfig","setDefaults","listener","nl","init","unsubscribe","splice","indexOf","TOPICS","setBidderConfig","mergeFlag","check","mergeConfig","mergedConfig","mergeBidderConfig","runWithBidder","resetBidder","callbackWithBidder","args","getCurrentBidder","ConsentHandler","reset","defer","generatedTime","promise","time","resolve","consentData","usp","generatedAt","vendorData","gdprApplies","consentStringSize","tcString","apiVersion","_defaultPrecision","_lgPriceConfig","_mgPriceConfig","_hgPriceConfig","_densePriceConfig","_autoPriceConfig","customConfig","granularityMultiplier","cpmFloat","isNaN","getCpmStringValue","cpmStr","cap","buckets","prev","curr","max","bucketFloor","bucket","precision","toFixed","getCpmTarget","bucketMin","roundingFunction","floor","customRoundingFunction","pow","cpmToRound","cpmTarget","invalidRounding","DEBUG_KEY","isDebuggingInstalled","installedModules","loadScript","debuggingModuleLoader","alreadyInstalled","script","loading","reject","_installDebugging","logger","prefixLog","debuggingControls","load","waitForDebugging","next","enable","disable","getHooks","remove","ctl","loadSession","sessionStorage","debugging","getItem","allEvents","utils","v","idPaths","eventsFired","_public","_handlers","_dispatch","eventString","eventPayload","idPath","event","que","eventKeys","eventType","elapsedTime","_checkAvailableEvent","on","handler","emit","off","_handler","getEvents","arrayCopy","newProp","funHooks","QUEUE","readyCtl","setupBeforeHookFnOnce","baseFn","hookFn","priority","submoduleInstallMap","module","name","postInstallAllowed","submodules","submodule","modules","wrapHook","wrapper","defineProperties","fromEntries","m","NATIVE","BANNER","NATIVE_TARGETING_KEYS","IMAGE","ortb","ver","assets","required","img","wmin","hmin","title","len","sponsoredBy","clickUrl","icon","SUPPORTED_TYPES","NATIVE_ASSET_TYPES","NATIVE_IMAGE_TYPES","PREBID_NATIVE_DATA_KEYS_TO_ORTB","NATIVE_KEYS_THAT_ARE_NOT_ASSETS","NATIVE_KEYS","PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE","inverse","NATIVE_ASSET_TYPES_INVERSE","TRACKER_METHODS","js","TRACKER_EVENTS","impression","processNativeAdUnitParams","typeIsSupported","isOpenRTBBidRequestValid","nativeParams","nativeOrtbRequest","toOrtbNativeRequest","ids","asset","hasOwnProperty","eventtrackers","isOpenRTBAssetValid","isNumber","w","h","video","mimes","protocols","minduration","maxduration","nativeAdUnit","nativeBidder","hasNonNativeBidder","ortbRequest","ortbResponse","native","toOrtbNativeResponse","isNativeOpenRTBBidValid","bidORTB","bidRequestORTB","requiredAssetIds","returnedAssetIds","match","assetId","fireNativeTrackers","nativeResponse","legacyPropertiesToOrtbNative","action","fireClickTrackers","fireImpressionTrackers","runMarkup","mkup","insertHtmlIntoIframe","fetchURL","triggerPixel","impTrackers","tracker","tally","imptrackers","jstracker","link","clicktrackers","assetIdLinkMap","masterClickTrackers","assetLink","clickTrackers","getAssetValue","globalSendTargetingKeys","nativeKeys","getNativeKeys","flatBidNativeKeys","ext","sendPlaceholder","placeholder","assetSendTargetingKeys","sendTargeting","getNativeRequest","assetsMessage","adObject","getNativeReq","nativeResp","legacyResponse","toLegacyResponse","adTemplate","rendererUrl","extKey","getAssetMessage","getKeyByValue","getAllAssetsMessage","extraNativeKeys","legacyNativeAssets","ortbAsset","ICON","MAIN","aspect_ratios","minWidth","min_width","minHeight","min_height","isInteger","aspectRatios","ar","ratio_width","ratio_height","ratio","aspectratios","fromOrtbNativeRequest","openRTBRequest","oldNativeObject","Boolean","assetType","prebidAssetName","convertOrtbRequestToProprietaryNative","bidRequestsCopy","pick","legacyNative","entries","useRequestAsset","predicate","titleAsset","text","imageType","imageAsset","dataAsset","requestAssets","privacyLink","privacy","requestAsset","reqAsset","retobj","target","elem","arrayFrom","arr","pred","thisArg","findIndex","triggerUserSyncs","ADD_AD_UNITS","BID_WON","REQUEST_BIDS","SET_TARGETING","STALE_RENDER","PREVENT_WRITING_ON_MAIN_DOCUMENT","NO_AD","EXCEPTION","CANNOT_FIND_AD","MISSING_DOC_OR_ADID","eventValidators","bidWon","checkDefinedPlacement","libLoaded","version","bidSet","contains","setRenderSize","defaultView","frameElement","validateSizes","targLength","cleanSizes","sz","isArrayOfNums","validateBannerMediaType","validatedAdUnit","bannerSizes","validateVideoMediaType","playerSize","tarPlayerSizeLen","videoSizes","validateNativeMediaType","legacyNativeKeys","intersection","nativeKey","legacyKey","validateAdUnitPos","pos","isFinite","warning","validateAdUnit","ortb2Imp","adUnitSetupChecks","checkAdUnitSetup","validatedAdUnits","validatedBanner","validatedVideo","validatedNative","getAdserverTargetingForAdUnitCodeStr","adunitCode","getAdserverTargetingForAdUnitCode","transformAdServerTargetingObj","getHighestUnusedBidResponseForAdUnitCode","filters","getHighestCpm","getAdserverTargeting","getConsentMetadata","gdpr","coppa","currentAuctionId","b","getNoBidsForAdUnitCode","getBidResponses","getBidResponsesForAdUnitCode","setTargetingForGPTAsync","customSlotMatching","isGptPubadsDefined","targetingSet","targetingKey","setTargetingForAst","reinjectNodeIfRemoved","node","tagName","injectionNode","querySelector","parentNode","renderAd","shouldRender","ad","replaceAuctionPrice","adUrl","clickThrough","replaceClickThrough","creativeComment","createComment","creativeId","inIframe","write","close","callBurl","createInvisibleIframe","style","display","overflow","removeAdUnit","requestBids","delegate","bidsBackHandler","cfg","_","startAuction","newMetrics","unit","adUnitMediaTypes","allBidders","deepSetValue","bidderMediaTypes","bidderEligible","unsupportedBidderMessage","adUnitsLen","executeCallbacks","reqBidsConfigObj","runAll","storageCallbacks","enableAnalyticsCallbacks","queue","queued","addAdUnits","adUnitArr","onEvent","offEvent","bidderAdaptor","enableAnalyticsCb","aliasBidder","getAllPrebidWinningBids","getHighestCpmBids","markWinningBidAsUsed","markBidRequest","listenMessagesFromCreative","command","stack","processQueue","called","_pbjsGlobals","ensureProtocol","win","exec","windowProto","location","protocol","top","parseDomain","noLeadingWww","noPort","URL","host","startsWith","substring","detectReferer","getAncestorOrigins","ancestorOrigins","getCanonicalUrl","element","ancestors","currentWindow","bestLocation","bestCanonicalUrl","reachedTop","level","valuesFromAmp","inAmpFrame","hasTopLocation","previousWindow","wasInAmpFrame","currentLocation","crossOrigin","foundLocation","parent","sourceUrl","canonicalUrl","referrer","reverse","ref","page","isAmp","numIframes","topmostLocation","domain","legacy","referer","constants","WON_AD_IDS","WeakSet","HANDLER_MAP","handleRenderRequest","handleEventRequest","handleNativeRequest","addEventListener","receiveMessage","getReplier","ev","ports","postMessage","reply","_sendAdToCreative","resizeRemoteCreative","elmType","getElementByAdUnit","elementStyle","getElementIdBasedOnAdServer","parentDivEle","getElementById","getDfpElementId","isApnGetTagDefined","getAstElementId","slot","googletag","pubads","getSlots","getTargetingKeys","getTargeting","getSlotElementId","astTag","apntag","getTag","targetId","sizeConfig","setSizeConfig","getLabels","bidOrAdUnit","activeLabels","labelAll","labelAny","sizeSupported","configs","maps","evaluateSizeConfig","shouldFilter","sizesSupported","resolveStatus","oldSizes","results","active","label","filterResults","after","mediaQuery","ruleMatch","getWindowTop","matchMedia","matches","thing","moduleTypeWhiteList","newStorageManager","moduleName","moduleType","defaultBidderSettings","isBidderAllowed","storageAllowed","isVendorless","valid","hookDetails","hasEnforcementHook","validateStorageEnforcement","hasDeviceAccess","setCookie","expires","sameSite","domainPortion","encodeURIComponent","expiresPortion","isNone","secure","cookie","getCookie","decodeURIComponent","localStorageIsEnabled","localStorage","setItem","removeItem","cookiesAreEnabled","checkCookieSupport","hasLocalStorage","removeDataFromLocalStorage","findSimilarCookies","keyLike","cookies","pop","separatorIndex","cookieName","replace","getStorageManager","resetData","pbTargetingKeys","MAX_DFP_KEYLENGTH","TTL_BUFFER","CFG_ALLOW_TARGETING_KEYS","CFG_ADD_TARGETING_KEYS","TARGETING_KEY_CONFIGURATION_ERROR_MSG","isBidNotExpired","ttl","isUnusedBid","getHighestCpmBidsFromBidPool","highestCpmCallback","adUnitBidLimit","hasModified","dealPrioritization","bucketKey","bucketBids","bidsByBidder","sort","sortByDealAndPriceBucketOrCpm","useCpm","hb_deal","hb_pb","newTargeting","latestAuctionForAdUnit","setLatestAuctionForAdUnit","resetPresetTargeting","unsetKeys","reducer","customSlotMatchingFunc","getAdUnitPath","updateTargetingFromMap","resetPresetTargetingAST","keywords","currentKeywords","newKeywords","modifyTag","bidShouldBeAddedToTargeting","getDealBids","standardKeys","getTargetingMap","getAllowedTargetingKeyValues","allowedKeys","defaultKeyring","defaultKeys","keyDispositions","keyring","isCustom","defaultKey","found","allowedKey","allowedKeyName","removedKeys","d","filteredTargeting","getAllTargeting","getWinningBidTargeting","getCustomBidTargeting","getBidLandscapeTargeting","getAdUnitTargeting","targetKey","addedKeys","flattenTargeting","auctionKeysThreshold","filterTargetingKeys","convertKeysToQueryForm","keyMap","queryString","encodedKeyPair","targetingCopy","targetingMap","accMap","currMap","adUnitQueryString","querySize","targetingObj","p","c","accumulator","setTargetingForGPT","targetingConfig","isAdUnitCodeMatchingSlot","filterFunction","getOldestHighestCpmBid","astTargeting","keywordsObj","regex","setKeywords","overrideKeyValue","winners","getStandardKeys","winner","acc","targetingValue","bidderCodeTargetingKey","bidderCodeTargeting","mergeAdServerTargeting","concatTargetingValue","currentBidElement","hasSameAdunitCodeAndKey","getCustomKeys","truncateCustomKeys","allowSendAllBidsTargetingKeys","allowedSendAllBidTargeting","getTargetingObj","getTargetingValues","aut","s","isApntagDefined","USERSYNC_DEFAULT_CONFIG","syncEnabled","filterSettings","syncsPerBidder","auctionDelay","newUserSync","userSyncDependencies","publicApi","getDefaultQueue","hasFiredBidder","numAdapterBids","permittedPixels","usConfig","fs","fireSyncs","browserSupportsCookies","loadIframes","fireImagePixels","forEachFire","bidderName","trackingPixelUrl","iframeUrl","insertUserSyncIframe","removeImagePixelsForBidder","iframeSyncBidderName","imageSync","imageSyncBidderName","incrementAdapterBids","registerSync","canBidderRegisterSync","shouldBidderBeBlocked","isFilterConfigValid","activeConfig","biddersToFilter","filterType","checkForFiltering","activeConfigName","filterField","biddersField","bidderInList","isSafariBrowser","tArr","tStr","tFn","tNumb","tObject","tBoolean","toString","consoleExists","console","consoleLogExists","log","consoleInfoExists","consoleWarnExists","warn","consoleErrorExists","eventEmitter","_setEventEmitter","emitFn","emitEvent","internal","createTrackPixelIframeHtml","getWindowSelf","getWindowLocation","parseQS","formatQS","deepEqual","prebidInternal","getPrebidInternal","uniqueRef","Function","self","getIncrementalInteger","count","random","substr","_getRandomData","crypto","getRandomValues","Uint8Array","getBidIdParameter","paramsObj","tryAppendQueryString","existingUrl","queryObj","getOwnPropertyNames","getKeys","getAdUnitSizes","sizeObj","sizeRegex","curSizePos","hasOwn","sizeArrayLength","parseGPTSingleSizeArray","singleSize","isValidGPTSingleSize","parseGPTSingleSizeArrayToRtbSize","debugTurnedOn","decorateLog","prefix","decorate","color","hasConsoleLogger","f","border","hspace","vspace","marginWidth","marginHeight","scrolling","frameBorder","isA","object","_t","str","l","_map","output","objectToCheck","propertyToCheckFor","elm","asLastChildChild","parentEl","getElementsByTagName","insertBeforeEl","firstChild","insertBefore","waitForElementToLoad","onLoad","removeEventListener","Image","burl","htmlCode","allowtransparency","contentWindow","iframeHtml","div","innerHTML","createTrackPixelHtml","escapedUrl","encodeURI","encodeUri","sandbox","getValueString","defaultValue","arry","getHighestCpmCallback","previous","current","getLatestHighestCpmBid","useTieBreakerProperty","tieBreakerCallback","array","temp","clone","test","userAgent","clicktag","getTime","getPerformanceNow","performance","cookieEnabled","numRequiredCalls","numCalls","xs","rv","SUPPORTED_MEDIA_TYPES","SUPPORTED_STREAM_TYPES","types","bidderData","getDNT","doNotTrack","msDoNotTrack","compareCodeAndSlot","isSlotMatchingAdUnitCode","getGptSlotForAdUnitCode","matchingSlot","getGptSlotInfoForAdUnitCode","gptSlot","divId","convertCamelToUnderscore","y","cleanObj","newObj","properties","transformBidderParamKeywords","paramName","arrs","values","tryConvertType","typeToConvert","convertTypes","fill","newArray","valueToPush","chunk","ceil","end","getMinValueFromArray","getMaxValueFromArray","compareOn","property","compare","query","criteria","parsed","noDecodeWholeURL","qsAsString","decodeSearchAsString","port","pathname","hash","obj1","obj2","checkTypes","sources","addItFlag","cyrb53Hash","seed","imul","opA","opB","h1","h2","ch","charCodeAt","getWindowFromDocument","safeJSONParse","setAttribute","escapeUnsafeChars","escapes","CONFIG_TOGGLE","NODES","metricsFactory","mkNode","makeNode","mkTimer","makeTimer","mkRenamer","rename","nodes","makeMetrics","dfWalk","visit","edge","getTimestamp","setMetric","names","follow","inEdge","outEdge","propagate","stopPropagation","groups","timestamps","metric","ts","elapsed","startCheckpoint","endCheckpoint","stopAfter","measureHookTime","stopTiming","orig","bail","untimed","includeGroups","otherMetrics","other","addParent","renameFn","newSibling","toJSON","wrapFn","parents","visited","nullMetrics","nop","empty","none","nullTimer","nullNode","hookTimer","that","timedAuctionHook","timedBidResponseHook","SUCCESS","FAIL","resolver","resolveFn","rejectHandler","resolveHandler","continuation","delayMs","Promise","promiseFactory","invoker","rejectFn","VIDEO_MEDIA_TYPE","INSTREAM","videoAdUnit","videoBidder","hasNonVideoBidder","checkVideoBidSetup","vastXml","ttlBufferInSeconds","wrapURI","uri","impUrl","vastImp","toStorageRequest","vastValue","vastImpUrl","ttlWithBuffer","payload","ttlseconds","bidid","aid","customCacheKey","shimStorageCallback","responseBody","requestData","puts","_internal","AUCTION_INIT","AUCTION_END","BID_REQUESTED","BID_TIMEOUT","BID_RESPONSE","NO_BID","BID_ADJUSTMENT","BIDDER_DONE","AUCTION_DEBUG","BILLABLE_EVENT","ENDPOINT","BUNDLE","AnalyticsAdapter","analyticsType","_queue","_eventCount","_enableCheck","_enabled","_sampled","_emptyQueue","track","_track","enqueue","_enqueue","_enable","disableAnalytics","_disable","getAdapterType","getHandler","getUrl","_callEndpoint","_this","sampling","_oldEnable","TARGETING_KEY_PB_CAT_DUR","TARGETING_KEY_CACHE_ID","queueTimeDelay","queueSizeLimit","bidCacheRegistry","createBidCacheRegistry","registry","setupRegistrySlot","bidStorage","queueDispatcher","createDispatcher","initialCacheKey","removeBid","delete","getQueueDispatcher","setupInitialCacheKey","getInitialCacheKey","timeoutDuration","bidListArr","killQueue","callbackFn","firePrebidCacheCall","getPricePartForAdpodKey","pricePart","prioritizeDeals","adpodDealPrefix","attachPriceIndustryDurationKeyToBid","brandCategoryExclusion","duration","pcd","updateBidQueue","bidListIter","callDispatcher","removeBidsFromStorage","bidResponses","bidList","callPrebidCacheHook","videoConfig","adServerCatId","checkAdUnitSetupHook","goodAdUnits","errMsg","adPodDurationSec","durationRangeSec","range","checkBidDuration","buffer","bidDuration","adUnitRanges","requireExactDuration","nextHighestRange","durationBucket","checkVideoBidSetupHook","durationSeconds","isBidGood","adpodSetConfig","bidQueueTimeDelay","bidQueueSizeLimit","adpod","initAdpodHooks","callPrebidCacheAfterAuction","successfulCachedBids","sortByPricePerSecond","codes","adPodAdUnits","getAdPodAdUnits","competiveExclusionEnabled","deferCachingSetting","deferCachingEnabled","getBidsForAdpod","getExclusiveBids","bidDealTier","minDealTier","otherBids","highPriorityDealBids","adPodTargeting","adPodDurationSeconds","bidsToCache","bidsSuccessfullyCached","groupedBids","filteredBids","sharedMethods","shareAdpodUtilities","addMethods","pbjs","BIDDER_CODE","URL_SIMPLE","VIDEO_TARGETING","VIDEO_RTB_TARGETING","USER_PARAMS","APP_DEVICE_PARAMS","DEBUG_PARAMS","VIDEO_MAPPING","playback_method","NATIVE_MAPPING","body2","cta","serverName","requiredParams","salePrice","displayUrl","MAX_IMPS_PER_REQUEST","mappingFileUrl","SCRIPT_TAG_START","VIEWABILITY_URL_START","VIEWABILITY_FILE_NAME","GVLID","placementId","member","invCode","tags","bidToTag","userObjBid","hasUserInfo","userObj","user","uparam","segs","appDeviceObjBid","hasAppDeviceInfo","appDeviceObj","app","appIdObjBid","hasAppId","appIdObj","appid","debugObj","debugObjParams","debugCookieName","debugCookie","debugBidRequest","hasDebug","memberIdBid","hasMemberId","schain","omidSupport","hasOmidSupport","sdk","omidpn","omidpv","member_id","device","grabOrtb2Keywords","ortb2Obj","fields","keyStr","ortb2KeywordsObjList","convertStringToKeywordsObj","anAuctionKeywords","mergedAuctionKeywords","auctionKeywords","deleteValues","brand_category_uniqueness","gdpr_consent","consent_string","consentString","consent_required","addtlConsent","ac","acStr","addtl_consent","us_privacy","refererinfo","rd_ref","rd_top","rd_ifs","rd_stk","pubPageUrl","rd_can","referrer_detection","hasAdPodBid","hasAdPod","adPodBid","adPodTags","createAdPodRequest","nonPodTags","userId","eids","addUserId","pubProvidedId","ppId","uids","uid","publisher_id","formatRequest","serverResponse","serverBid","rtbBid","getRtbBid","ad_type","newBid","parseMediaType","debug_info","debugHeader","debugText","syncOptions","hasPurpose1Consent","transformBidParams","isOpenRtb","conversionFn","s2sEndpointUrl","s2sCfg","convertKeywordsToString","use_pmt_rule","usePaymentRule","isPopulatedArray","paramKey","convertedKey","keyPairObj","strIsAppnexusViewabilityScript","regexMatchUrlStart","viewUrlStartInStr","regexMatchFileName","fileNameInStr","endpointUrl","clonedPayload","payloadString","newRenderer","rendererOptions","renderer_id","renderer_url","outstreamRender","ended","creative_id","deal_id","netRevenue","appnexus","buyerMemberId","buyer_member_id","dealPriority","deal_priority","dealCode","deal_code","adomain","advertiser_id","advertiserId","setupDChain","dchain","complete","bsid","brand_id","brandId","rtb","player_width","player_height","notify_url","videoContext","primaryCatId","brand_category_id","dealTier","duration_ms","asset_url","adResponse","ads","content","videoBid","nativeAd","viewScript","viewability","prebidParams","jsTrackers","javascript_trackers","desc","desc2","ctatext","rating","sponsored","privacy_link","address","downloads","likes","phone","price","saleprice","displayurl","click_trackers","impressionTrackers","impression_trackers","javascriptTrackers","main_img","trackers","impression_urls","transformSizes","primary_size","ad_types","allow_smaller_sizes","allowSmallerSizes","prebid","disable_psa","bidFloor","getBidFloor","reserve","position","mediaTypePos","trafficSourceCode","traffic_source_code","privateSizes","private_sizes","supplyType","supply_type","pubClick","pubclick","extInvCode","ext_inv_code","publisherId","externalImpId","external_imp_id","ortb2ImpKwStr","ortb2ImpKwObj","bidParamsKwObj","keywordsUt","gpid","nativeRequest","buildNativeRequest","layouts","hb_source","require_asset_url","frameworks","apiTmp","custom_renderer_present","requestSizes","hasOmid","bidderParams","videoParams","numberOfPlacements","getAdPodPlacementNumber","maxDuration","tagToDuplicate","divider","chunked","setVideoProperty","minAllowedDuration","requestKey","isImageAsset","privacy_supported","hidedfpContainer","elementId","el","querySelectorAll","setProperty","hideSASIframe","nextSibling","localName","ANOutstreamVideo","tagId","tag_id","handleOutstreamRendererEvents","adType","rti","rti_partner","getFloor","keywordList","kw","kwPair","ANALYTICS_TYPE","ANALYTICS_CODE","CNVR_CONSTANTS","LOG_PREFIX","MAX_MILLISECONDS_IN_CACHE","CACHE_CLEANUP_TIME_IN_MILLIS","DEFAULT_SAMPLE_RATE","WIN","BID","TIMEOUT","RENDER_FAILED","initOptions","conversantAnalyticsEnabled","cnvrHelper","doSample","adIdLookup","timeoutCache","auctionIdTimestampCache","cacheCleanupInterval","conversantAnalytics","onAuctionEnd","onAdRenderFailed","onBidWon","onBidTimeout","timedOutBid","timeoutCacheKey","getLookupKey","timeReceived","bidWonPayload","createPayload","adUnitPayload","createAdUnit","bidPayload","adSize","createAdSize","sendData","adIdObj","renderFailedPayload","auctionTimestamp","auctionEndPayload","cnvrAdUnit","timeoutKey","keyExistsAndIsObject","mediaTypeName","bidPayloadArray","adCode","deduplicateArray","tmpArray","tmpObj","cleanCache","cacheObj","currTime","timeInCache","payloadType","requestType","globalSampleRate","global_sample_rate","cnvrSampleRate","cnvr_sample_rate","preBidVersion","sid","site_id","eventCode","getSampleRate","parentObj","propNm","defaultSampleRate","sampleRate","originEnableAnalytics","originDisableAnalytics","setInterval","clearInterval","isVideoRequest","siteId","pubcid","pubcidName","bidurl","conversantImps","bidfloor","imp","displaymanager","displaymanagerver","copyOptProperty","videoData","format","convertSizes","api","bannerData","crumbs","white_label_url","site","mobile","getDevice","at","userExt","consent","readStoredValue","fpc","collectEids","firstPartyData","requestMap","seatbid","conversantBid","responseCPM","impid","responseAd","adm","responseNurl","nurl","cur","crid","charAt","pixels","urls","fsyncs","psyncs","endpoint","msDoNoTrack","language","screen","dnt","make","vendor","ua","bidSizes","dst","dstName","userIdAsEids","requiredSourceValues","eid","storedValue","storedValueExp","floorObj","defaultParamConstants","env","gdfp_req","unviewed_position_start","adpodUtils","buildDfpVideoUrl","urlComponents","buildUrlFromAdserverUrlComponents","derivedParams","correlator","urlSearchComponent","urlSzParam","encodedCustomParams","getCustParams","cust_params","queryParams","descriptionUrl","getDescriptionUrl","description_url","ppid","getPPID","notifyTranslationModule","buildAdpodVideoUrl","getSizeForAdUnit","createMasterTag","initialValue","customParams","curValue","masterTag","components","urlCustParams","allTargetingData","allTargeting","prebidTargetingSet","hb_uuid","hb_cache_id","publisherTargetingSet","encodedParams","registerVideoSupport","buildVideoUrl","getAdpodTargeting","videoSupport","adServers","identityLinkSubmodule","decode","getId","configParams","pid","hasGdpr","gdprConsentString","tcfPolicyV2","ats","retrieveEnvelope","envelope","setEnvelopeSource","getEnvelope","notUse3P","setRetryCookie","setTime","toUTCString","SUPPORTED_AD_TYPES","BIDDER_CONFIG","BIDDER_VERSION","DEFAULT_CURRENCY","USER_ID_CODE_TO_QUERY_ARG","britepoolid","criteoId","fabrickId","hadronId","id5id","idl_env","IDP","idxId","intentIqId","lipb","lotamePanoramaId","merkleId","netId","parrableId","quantcastId","tapadId","tdid","uid2","admixerId","deepintentId","dmdId","nextrollId","novatiq","mwOpenLinkId","dapId","amxId","kpuid","publinkId","naveggId","imuid","adtelligentId","hasDelDomainOrPlatform","delDomain","platform","partitionByVideoBids","videoBids","bannerBids","buildOXBannerRequest","buildOXVideoRequest","serverRequest","oxResponseObj","getMediaTypeFromRequest","createVideoBidResponses","createBannerBidResponses","pixelType","generateDefaultSyncUrl","queryParamStrings","startTime","adUnitIdx","idx","pub_rev","creative","html","tbd","adv_id","dspid","getViewportDimensions","isIfr","tWin","tDoc","docEl","documentElement","innerWidth","clientWidth","innerHeight","clientHeight","formatCustomParms","customKey","buildCommonQueryParamsFromBids","isInIframe","defaultParams","ju","charSet","characterSet","colorDepth","ifr","tz","getTimezoneOffset","tws","be","bc","dddid","nocache","userDataSegments","buildFpdQueryParams","sm","siteContentDataSegments","scsm","ph","gdprConsentConfig","x_gdpr_f","appendUserIdsToQueryParams","serializeSupplyChain","fpdPath","segment","segtax","seg","userIds","userIdObjectOrValue","userIdProviderKey","lipbid","segments","liveIntentSegments","snowflake","supplyChain","serializeSupplyChainNodes","supplyChainNodes","supplyChainNodePropertyOrder","supplyChainNode","customParamsForAllBids","hasCustomParam","auids","aus","divids","aucs","auid","ns","tfcd","customParamsForBid","formattedCustomParams","btoa","tps","enrichQueryWithFloors","oxVideoParams","generateVideoParameters","oxVideoConfig","openRtbParams","legacyParams","openrtb","openRtbReq","vwd","vht","vos","vmimes","vtest","vastQueryParams","adid","colo","customFloorsForAllBids","hasCustomFloor","aumfs","floorInfo","customFloor","round","MODULE_NAME","PUBLINK_COOKIE","PUBLINK_S2S_COOKIE","isHex","publinkIdUrl","deh","mpn","mpv","api_key","apikey","usPrivacyString","makeCallback","prebidCallback","handleResponse","xhr","publink","getlocalValue","getData","publinkIdSubmodule","storedId","localValue","COOKIE","LOCAL_STORAGE","OPTOUT_NAME","PUB_COMMON_ID","readValue","expValue","getIdCallback","pixelCallback","queuePixelCallback","pixelUrl","targetUrl","hasOptedOut","sharedIdSystemSubmodule","aliasName","idObj","create","newId","extendId","extend","domainOverride","domainElements","topDomain","testCookie","nextDomain","USER_IDS_CONFIG","gc_id","atype","getUidExt","extendedData","rtiPartner","DeviceID","ccpaOptout","getEidExt","getSource","ssp","keyID","preferences","createEidObject","userIdData","subModuleKey","uidExt","eidExt","createEidsArray","bidRequestUserId","ftrackId","buildEidPermissions","eidPermissions","DEFAULT_SYNC_DELAY","NO_AUCTION_DELAY","CONSENT_DATA_COOKIE_STORAGE_CONFIG","PBJS_USER_ID_OPTOUT_NAME","coreStorage","addedUserIdHook","initializedSubmodules","configRegistry","submoduleRegistry","timeoutID","ppidSource","configListener","uidMetrics","submoduleMetrics","setSubmoduleRegistry","setStoredValue","valueStr","expiresStr","refreshInSeconds","setPrebidServerEidPermissions","setEidPermissions","getStoredValue","storedKey","makeStoredConsentDataHash","storedConsentData","setStoredConsentData","getStoredConsentData","storedConsentDataMatchesConsentData","findRootDomain","fullDomain","domainParts","rootDomain","continueSearching","startIndex","TEST_COOKIE_NAME","TEST_COOKIE_VALUE","expirationDate","abs","processSubmoduleCallbacks","moduleDone","callbackCompleted","getCombinedSubmoduleIds","combinedSubmoduleIds","carry","getSubmoduleId","sourceName","sub","getCombinedSubmoduleIdsForBidder","addIdDataToAdUnitBids","INIT_CANCELED","idSystemInitializer","delay","startInit","startCallbacks","cancel","initialized","initMetrics","cancelAndTry","finally","initModules","allModules","checkRefs","timeGdpr","hooksReady","initSubmodules","modWithCb","refresh","submoduleNames","auctionEndHandler","cbModules","initIdSystem","matchingUserId","getUserIdsAsEids","userID","ppidValue","requestBidsHook","getIds","getUserIdsAsync","setPublisherProvidedId","getUserIds","getUserIdsAsEidBySource","getEncryptedEidsForSource","encrypt","customFunction","eidsSignals","customSignals","encryptSignals","signals","encryptedSig","registerSignalSources","encryptedSignalProviders","encryptedSignalSources","registerDelay","customFunc","collectorFunction","refreshUserIds","validateGdprEnforcement","userIdModules","hasValidated","populateSubmoduleId","forceRefresh","refreshNeeded","storedDate","dest","storageTypes","getActiveStorageTypes","submod","updateInitializedSubmodules","updated","getValidSubmoduleConfigs","ALL_STORAGE_TYPES","disabled","updateSubmodules","addedSubmodules","j","submoduleConfig","coreGetPPID","attachIdSystem","normalizePromise"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;ACLA;AACA;AAGA;AACA,IAAMA,UAAU,GAAG,WAAnB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,SAASC,QAAT,CAAkBC,OAAlB,EAA2B;EAAA;;EAChC,IAAQC,GAAR,GAAqED,OAArE,CAAQC,GAAR;EAAA,IAAaC,MAAb,GAAqEF,OAArE,CAAaE,MAAb;EAAA,IAAqBC,EAArB,GAAqEH,OAArE,CAAqBG,EAArB;EAAA,IAAyBC,QAAzB,GAAqEJ,OAArE,CAAyBI,QAAzB;EAAA,IAAmCC,MAAnC,GAAqEL,OAArE,CAAmCK,MAAnC;EAAA,IAA2CC,UAA3C,GAAqEN,OAArE,CAA2CM,UAA3C;EAAA,IAAuDC,SAAvD,GAAqEP,OAArE,CAAuDO,SAAvD;EACA,KAAKN,GAAL,GAAWA,GAAX;EACA,KAAKC,MAAL,GAAcA,MAAd;EACA,KAAKM,QAAL,GAAgB,EAAhB;EACA,KAAKL,EAAL,GAAUA,EAAV,CALgC,CAOhC;EACA;EACA;;EACA,KAAKE,MAAL,GAAcA,MAAd;EACA,KAAKI,GAAL,GAAW,EAAX;;EACA,KAAKC,IAAL,GAAY,UAAAC,IAAI,EAAI;IAClB,IAAI,OAAOA,IAAP,KAAgB,UAApB,EAAgC;MAC9BC,mDAAQ,CAAC,+DAAD,CAAR;MACA;IACD;;IACD,KAAI,CAACP,MAAL,GAAcM,IAAI,CAACE,IAAL,EAAd,GAA4B,KAAI,CAACJ,GAAL,CAASC,IAAT,CAAcC,IAAd,CAA5B;EACD,CAND,CAZgC,CAoBhC;;;EACA,KAAKP,QAAL,GAAgBA,QAAQ,IAAK,YAAM;IACjC,KAAI,CAACC,MAAL,GAAc,IAAd;;IACA,KAAI,CAACS,OAAL;EACD,CAHD,CArBgC,CA0BhC;;;EACA,KAAKC,MAAL,GAAc,YAAY;IAAA;;IACxB,IAAMC,UAAU,GAAGC,SAAnB;;IACA,IAAMC,SAAS,GAAG,SAAZA,SAAY,GAAM;MACtB,IAAI,MAAI,CAACC,OAAT,EAAkB;QAChB,MAAI,CAACA,OAAL,CAAaC,KAAb,CAAmB,MAAnB,EAAyBJ,UAAzB;MACD,CAFD,MAEO;QACLK,kDAAO,0EAAP;MACD;IACF,CAND;;IAQA,IAAIC,6BAA6B,CAAChB,UAAD,CAAjC,EAA+C;MAC7Ce,kDAAO,2GAAoGf,UAApG,EAAP;MACAY,SAAS;IACV,CAHD,MAGO,IAAIX,SAAJ,EAAe;MACpBW,SAAS;IACV,CAFM,MAEA;MACL;MACA,KAAKT,GAAL,CAASc,OAAT,CAAiBL,SAAjB,EAFK,CAEuB;;MAC5BM,gEAAkB,CAACvB,GAAD,EAAMH,UAAN,EAAkB,KAAKM,QAAvB,EAAiC,KAAKqB,eAAtC,CAAlB;IACD;EACF,CApBa,CAoBZC,IApBY,CAoBP,IApBO,CAAd,CA3BgC,CA+ClB;;AACf;;AAED3B,QAAQ,CAAC4B,OAAT,GAAmB,gBAAuE;EAAA,IAA5D1B,GAA4D,QAA5DA,GAA4D;EAAA,IAAvDC,MAAuD,QAAvDA,MAAuD;EAAA,IAA/CC,EAA+C,QAA/CA,EAA+C;EAAA,IAA3CC,QAA2C,QAA3CA,QAA2C;EAAA,IAAjCC,MAAiC,QAAjCA,MAAiC;EAAA,IAAzBC,UAAyB,QAAzBA,UAAyB;EAAA,IAAbC,SAAa,QAAbA,SAAa;EACxF,OAAO,IAAIR,QAAJ,CAAa;IAAEE,GAAG,EAAHA,GAAF;IAAOC,MAAM,EAANA,MAAP;IAAeC,EAAE,EAAFA,EAAf;IAAmBC,QAAQ,EAARA,QAAnB;IAA6BC,MAAM,EAANA,MAA7B;IAAqCC,UAAU,EAAVA,UAArC;IAAiDC,SAAS,EAATA;EAAjD,CAAb,CAAP;AACD,CAFD;;AAIAR,QAAQ,CAAC6B,SAAT,CAAmBC,SAAnB,GAA+B,YAAW;EACxC,OAAO,KAAK3B,MAAZ;AACD,CAFD;;AAIAH,QAAQ,CAAC6B,SAAT,CAAmBE,SAAnB,GAA+B,UAASC,EAAT,EAAa;EAC1C,KAAKZ,OAAL,GAAeY,EAAf;AACD,CAFD;;AAIAhC,QAAQ,CAAC6B,SAAT,CAAmBI,gBAAnB,GAAsC,UAASxB,QAAT,EAAmB;EACvD,KAAKA,QAAL,GAAgBA,QAAhB;AACD,CAFD;;AAIAT,QAAQ,CAAC6B,SAAT,CAAmBK,gBAAnB,GAAsC,iBAA4B;EAAA,IAAjB9B,EAAiB,SAAjBA,EAAiB;EAAA,IAAb+B,SAAa,SAAbA,SAAa;;EAChE,IAAI,OAAO,KAAK1B,QAAL,CAAc0B,SAAd,CAAP,KAAoC,UAAxC,EAAoD;IAClD,KAAK1B,QAAL,CAAc0B,SAAd;EACD;;EAEDC,qDAAU,wCAAiChC,EAAjC,mBAA4C+B,SAA5C,EAAV;AACD,CAND;AAQA;AACA;AACA;AACA;;;AACAnC,QAAQ,CAAC6B,SAAT,CAAmBd,OAAnB,GAA6B,YAAW;EACtC,OAAO,KAAKL,GAAL,CAAS2B,MAAT,GAAkB,CAAzB,EAA4B;IAC1B,IAAI;MACF,KAAK3B,GAAL,CAAS4B,KAAT,GAAiBxB,IAAjB;IACD,CAFD,CAEE,OAAOyB,KAAP,EAAc;MACd1B,mDAAQ,CAAC,qCAAD,EAAwC0B,KAAxC,CAAR;IACD;EACF;AACF,CARD;AAUA;AACA;AACA;AACA;AACA;;;AACO,SAASC,kBAAT,CAA4BC,QAA5B,EAAsC;EAC3C,OAAO,CAAC,EAAEA,QAAQ,IAAIA,QAAQ,CAACvC,GAAvB,CAAR;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwC,eAAT,CAAyBD,QAAzB,EAAmCE,GAAnC,EAAwCC,GAAxC,EAA6C;EAClD,IAAIC,UAAU,GAAG,IAAjB;;EACA,IAAIJ,QAAQ,CAACtC,MAAT,IAAmBsC,QAAQ,CAACtC,MAAT,CAAgB2C,gBAAvC,EAAyD;IACvDD,UAAU,GAAGJ,QAAQ,CAACtC,MAAT,CAAgB2C,gBAAhB,CAAiCH,GAAjC,EAAsCI,QAAtC,EAAgDH,GAAhD,CAAb,CADuD,CACW;EACnE;;EACD,IAAI,CAACC,UAAL,EAAiB;IACfA,UAAU,GAAGE,QAAb;EACD;;EACDN,QAAQ,CAACf,eAAT,GAA2BmB,UAA3B;EACAJ,QAAQ,CAACzB,MAAT,CAAgB2B,GAAhB,EAAqBF,QAAQ,CAACf,eAA9B;AACD;;AAED,SAASH,6BAAT,CAAuChB,UAAvC,EAAmD;EACjD,IAAMyC,OAAO,GAAG,KAAkBA,OAAlC;EACA,IAAMC,MAAM,GAAGC,kDAAI,CAACF,OAAD,EAAU,UAAAC,MAAM,EAAI;IACrC,OAAOA,MAAM,CAACE,IAAP,KAAgB5C,UAAvB;EACD,CAFkB,CAAnB;;EAIA,IAAI,CAAC0C,MAAL,EAAa;IACX,OAAO,KAAP;EACD,CARgD,CAUjD;;;EACA,IAAMG,cAAc,GAAGC,qDAAU,CAACJ,MAAD,EAAS,UAAT,CAAjC;EACA,IAAMK,sBAAsB,GAAG,CAAC,EAAEF,cAAc,IAAIA,cAAc,CAAClD,GAAjC,IAAwCkD,cAAc,CAACpC,MAAzD,CAAhC,CAZiD,CAcjD;;EACA,IAAMuC,iBAAiB,GAAGF,qDAAU,CAACJ,MAAD,EAAS,2BAAT,CAApC;EACA,IAAMO,yBAAyB,GAAG,CAAC,EAAED,iBAAiB,IAAIA,iBAAiB,CAACrD,GAAvC,IAA8CqD,iBAAiB,CAACvC,MAAlE,CAAnC;EAEA,OAAO,CAAC,EACLsC,sBAAsB,IAAI,EAAEF,cAAc,CAACK,UAAf,KAA8B,IAAhC,CAA3B,IACCD,yBAAyB,IAAI,EAAED,iBAAiB,CAACE,UAAlB,KAAiC,IAAnC,CAFxB,CAAR;AAID;;;;;;;;;;;;;;;;;;ACxJD;AACA;AACA;AAEA,wBAAgDC,mDAAhD;AAAA,IAAOC,gBAAP,qBAAOA,gBAAP;AAAA,IAAyBC,mBAAzB,qBAAyBA,mBAAzB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,gBAAT,OAAwD;EAAA,IAA5BC,MAA4B,QAA5BA,MAA4B;EAAA,IAApBC,OAAoB,QAApBA,OAAoB;EAAA,IAAXpB,GAAW,QAAXA,GAAW;EAAA,IAANvC,EAAM,QAANA,EAAM;EAC7D,IAAM4D,IAAI,GAAG;IAAEF,MAAM,EAANA,MAAF;IAAUC,OAAO,EAAPA;EAAV,CAAb;EACA,IAAIpB,GAAJ,EAASqB,IAAI,CAACrB,GAAL,GAAWA,GAAX;EACT,IAAIvC,EAAJ,EAAQ4D,IAAI,CAACC,IAAL,GAAY7D,EAAZ;EAERS,mDAAQ,CAACkD,OAAD,CAAR;EACAG,4CAAA,CAAYP,gBAAZ,EAA8BK,IAA9B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASG,qBAAT,QAAiD;EAAA,IAAhBvB,GAAgB,SAAhBA,GAAgB;EAAA,IAAXD,GAAW,SAAXA,GAAW;EAAA,IAANvC,EAAM,SAANA,EAAM;EACtD,IAAM4D,IAAI,GAAG;IAAEpB,GAAG,EAAHA;EAAF,CAAb;EACA,IAAID,GAAJ,EAASqB,IAAI,CAACrB,GAAL,GAAWA,GAAX;EACT,IAAIvC,EAAJ,EAAQ4D,IAAI,CAACC,IAAL,GAAY7D,EAAZ;EAER8D,4CAAA,CAAYN,mBAAZ,EAAiCI,IAAjC;AACD;;;;;;;;;;;;;;;ACrCD;AAEA,IAAIhB,OAAO,GAAG,EAAd;;AAEA,SAASoB,YAAT,CAAsBC,MAAtB,EAA8BC,UAA9B,EAA0C;EACxC,IAAIrB,MAAM,GAAGD,OAAO,CAACqB,MAAD,CAAP,GAAkBrB,OAAO,CAACqB,MAAD,CAAP,IAAmB;IAAEE,OAAO,EAAE;EAAX,CAAlD;;EACA,IAAID,UAAJ,EAAgB;IACd,OAAOrB,MAAM,CAACsB,OAAP,CAAeD,UAAf,IAA6BrB,MAAM,CAACsB,OAAP,CAAeD,UAAf,KAA8B,EAAlE;EACD;;EACD,OAAOrB,MAAP;AACD;;AAED,SAASuB,oBAAT,CAA8BH,MAA9B,EAAsCI,OAAtC,EAA+CH,UAA/C,EAA2D;EACzD,IAAIrB,MAAM,GAAGmB,YAAY,CAACC,MAAD,EAASC,UAAT,CAAzB;EACArB,MAAM,CAACwB,OAAD,CAAN,GAAkB,CAACxB,MAAM,CAACwB,OAAD,CAAN,IAAmB,CAApB,IAAyB,CAA3C;EACA,OAAOxB,MAAM,CAACwB,OAAD,CAAb;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASC,wBAAT,CAAkCL,MAAlC,EAA0C;EACxC,OAAOG,oBAAoB,CAACH,MAAD,EAAS,iBAAT,CAA3B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASM,8BAAT,CAAwCN,MAAxC,EAAgDC,UAAhD,EAA4D;EAC1D,OAAOE,oBAAoB,CAACH,MAAD,EAAS,iBAAT,EAA4BC,UAA5B,CAA3B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASM,0BAAT,CAAoCP,MAApC,EAA4CC,UAA5C,EAAwD;EACtD,OAAOE,oBAAoB,CAACH,MAAD,EAAS,aAAT,EAAwBC,UAAxB,CAA3B;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASO,kBAAT,CAA4BR,MAA5B,EAAoC;EAClC,OAAOhB,qDAAU,CAACL,OAAD,YAAaqB,MAAb,sBAAV,IAAoD,CAA3D;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASS,wBAAT,CAAkCT,MAAlC,EAA0CU,MAA1C,EAAkD;EAChD,OAAO1B,qDAAU,CAACL,OAAD,YAAaqB,MAAb,sBAA+BU,MAA/B,sBAAV,IAAsE,CAA7E;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,oBAAT,CAA8BX,MAA9B,EAAsCU,MAAtC,EAA8C;EAC5C,OAAO1B,qDAAU,CAACL,OAAD,YAAaqB,MAAb,sBAA+BU,MAA/B,kBAAV,IAAkE,CAAzE;AACD;AAED;AACA;AACA;AACA;;;AACA,IAAIE,aAAa,GAAG;EAClBP,wBAAwB,EAAxBA,wBADkB;EAElBC,8BAA8B,EAA9BA,8BAFkB;EAGlBC,0BAA0B,EAA1BA,0BAHkB;EAIlBC,kBAAkB,EAAlBA,kBAJkB;EAKlBC,wBAAwB,EAAxBA,wBALkB;EAMlBE,oBAAoB,EAApBA;AANkB,CAApB;;;;;;;;;;;;;;;AChFe,SAASE,OAAT,CAAiB/B,IAAjB,EAAuB;EACpC,IAAImB,UAAU,GAAGnB,IAAjB;;EAEA,SAASgC,aAAT,CAAuBhC,IAAvB,EAA6B;IAC3BmB,UAAU,GAAGnB,IAAb;EACD;;EAED,SAASiC,aAAT,GAAyB;IACvB,OAAOd,UAAP;EACD;;EAED,SAASe,QAAT,GAAoB,CACnB;;EAED,OAAO;IACLA,QAAQ,EAAEA,QADL;IAELF,aAAa,EAAEA,aAFV;IAGLC,aAAa,EAAEA;EAHV,CAAP;AAKD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBD;AAEA;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEO,IAAME,UAAU,GAAG;EACxBC,MAAM,EAAE,QADgB;EAExBC,MAAM,EAAE;AAFgB,CAAnB;AAKP,IAAIC,cAAc,GAAG,EAArB;;AAEA,IAAIC,eAAe,GAAGD,cAAc,CAACE,cAAf,GAAgC,EAAtD;;AACA,IAAIC,cAAc,GAAGH,cAAc,CAACI,aAAf,GAA+B,EAApD;;AAEA,IAAIC,WAAW,GAAG,EAAlB;AACA3F,wDAAA,CAAiB,WAAjB,EAA8B,UAAAA,MAAM,EAAI;EACtC,IAAIA,MAAM,IAAIA,MAAM,CAAC4F,SAArB,EAAgC;IAC9BD,WAAW,GAAGE,kDAAO,CAAC7F,MAAM,CAAC4F,SAAR,CAAP,GAA4B5F,MAAM,CAAC4F,SAAnC,GAA+C,CAAC5F,MAAM,CAAC4F,SAAR,CAA7D;EACD;AACF,CAJD;AAMA,IAAIE,kBAAkB,GAAG,EAAzB;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASC,OAAT,OAAkF;EAAA,IAAhE5B,UAAgE,QAAhEA,UAAgE;EAAA,IAApD6B,SAAoD,QAApDA,SAAoD;EAAA,IAAzCC,eAAyC,QAAzCA,eAAyC;EAAA,IAAxBpD,OAAwB,QAAxBA,OAAwB;EAAA,IAAfqD,GAAe,QAAfA,GAAe;EAAA,IAAVC,OAAU,QAAVA,OAAU;EAChF,OAAOtD,OAAO,CAACuD,MAAR,CAAe,UAACC,MAAD,EAASvD,MAAT,EAAoB;IACxCuD,MAAM,CAAC7F,IAAP,CAAYsC,MAAM,CAACwD,IAAP,CAAYC,MAAZ,CAAmB,UAAA/D,GAAG;MAAA,OAAIA,GAAG,CAACoC,MAAJ,KAAeT,UAAnB;IAAA,CAAtB,EACTiC,MADS,CACF,UAACE,IAAD,EAAO9D,GAAP,EAAe;MACrBA,GAAG,GAAGgE,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,EAAuBkE,2DAAgB,CAAC5D,MAAD,EAAS,CACpD,cADoD,EAEpD,mBAFoD,EAGpD,UAHoD,EAIpD,WAJoD,EAKpD,UALoD,CAAT,CAAvC,CAAN;MAQA,IAAM6D,UAAU,GAAGnE,GAAG,CAACmE,UAAJ,IAAkB,IAAlB,GAAyB7D,MAAM,CAAC6D,UAAhC,GAA6CnE,GAAG,CAACmE,UAApE;;MAEA,IAAIC,4DAAiB,CAACD,UAAD,CAArB,EAAmC;QACjCnE,GAAG,GAAGgE,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,EAAuB;UAC3BmE,UAAU,EAAVA;QAD2B,CAAvB,CAAN;MAGD,CAJD,MAIO;QACLjG,mDAAQ,6DAC+CoC,MAAM,CAACE,IADtD,EAAR;MAGD;;MAEDsD,IAAI,CAAC9F,IAAL,CAAUgG,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,EAAuB;QAC/BpC,UAAU,EAAE0C,MAAM,CAACE,IADY;QAE/B6D,aAAa,EAAE/D,MAAM,CAAC+D,aAFS;QAG/BC,KAAK,EAAE5D,qDAAU,CAACyD,UAAD,EAAa,cAAb,CAAV,IAA0CzD,qDAAU,CAACyD,UAAD,EAAa,kBAAb,CAApD,IAAwF,EAHhE;QAI/BI,KAAK,EAAEvE,GAAG,CAACwE,MAAJ,IAAcC,iEAAsB,EAJZ;QAK/BhB,eAAe,EAAfA,eAL+B;QAM/BD,SAAS,EAATA,SAN+B;QAO/BE,GAAG,EAAHA,GAP+B;QAQ/BC,OAAO,EAAPA,OAR+B;QAS/Be,gBAAgB,EAAEpC,yEAAA,CAAiChC,MAAM,CAACE,IAAxC,CATa;QAU/BmE,mBAAmB,EAAErC,+EAAA,CAAuChC,MAAM,CAACE,IAA9C,EAAoDR,GAAG,CAACoC,MAAxD,CAVU;QAW/BwC,eAAe,EAAEtC,2EAAA,CAAmChC,MAAM,CAACE,IAA1C,EAAgDR,GAAG,CAACoC,MAApD;MAXc,CAAvB,CAAV;MAaA,OAAO0B,IAAP;IACD,CApCS,EAoCP,EApCO,CAAZ;IAsCA,OAAOD,MAAP;EACD,CAxCM,EAwCJ,EAxCI,EAwCAD,MAxCA,CAwCOiB,8CAxCP,EAwCgB,EAxChB,EAwCoBd,MAxCpB,CAwC2B,UAAAe,GAAG;IAAA,OAAIA,GAAG,KAAK,EAAZ;EAAA,CAxC9B,CAAP;AAyCD;;AAED,IAAMC,aAAa,GAAGC,8CAAI,CAAC,MAAD,EAASzB,OAAT,EAAkB,SAAlB,CAA1B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS0B,oBAAT,CAA8BnB,IAA9B,EAAoCV,SAApC,EAAuF;EAAA,gFAAJ,EAAI;EAAA,gCAAvC8B,aAAuC;EAAA,IAAvCA,aAAuC,oCAAvBC,eAAuB;;EAC5F,IAAI/B,SAAS,IAAI,IAAjB,EAAuB;IACrB,OAAOU,IAAP;EACD,CAFD,MAEO;IACL,IAAMsB,aAAa,GAAGF,aAAa,CAAC9B,SAAD,CAAnC;IACA,OAAOU,IAAI,CAACC,MAAL,CAAY,UAAC/D,GAAD;MAAA,OAASoF,aAAa,CAACC,GAAd,CAAkBrF,GAAG,CAACoC,MAAtB,CAAT;IAAA,CAAZ,CAAP;EACD;AACF;AACM,IAAMkD,mBAAmB,GAAGN,8CAAI,CAAC,MAAD,EAASC,oBAAT,EAA+B,qBAA/B,CAAhC;;AAEP,SAASM,4BAAT,CAAsClF,OAAtC,EAA+C+C,SAA/C,EAA0D;EACxD,IAAIoC,WAAW,GAAGC,oDAAS,CAACpF,OAAD,CAA3B;EAEAmF,WAAW,CAACE,OAAZ,CAAoB,UAACpF,MAAD,EAAY;IAC9B;IACAA,MAAM,CAACwD,IAAP,GAAcwB,mBAAmB,CAAChF,MAAM,CAACwD,IAAR,EAAcV,SAAd,CAAnB,CACXuC,GADW,CACP,UAAC3F,GAAD,EAAS;MACZA,GAAG,CAACwE,MAAJ,GAAaC,iEAAsB,EAAnC;MACA,OAAOzE,GAAP;IACD,CAJW,CAAd;EAKD,CAPD,EAHwD,CAYxD;;EACAwF,WAAW,GAAGA,WAAW,CAACzB,MAAZ,CAAmB,UAAAzD,MAAM,EAAI;IACzC,OAAOA,MAAM,CAACwD,IAAP,CAAYpE,MAAZ,KAAuB,CAA9B;EACD,CAFa,CAAd;EAGA,OAAO8F,WAAP;AACD;;AAED,SAASI,8BAAT,CAAwCvF,OAAxC,EAAiD;EAC/C,IAAIwF,iBAAiB,GAAGJ,oDAAS,CAACpF,OAAD,CAAjC;EACAwF,iBAAiB,CAACH,OAAlB,CAA0B,UAACpF,MAAD,EAAY;IACpCA,MAAM,CAACwD,IAAP,GAAcwB,mBAAmB,CAAChF,MAAM,CAACwD,IAAR,EAAc,IAAd,CAAjC;EACD,CAFD,EAF+C,CAM/C;;EACA+B,iBAAiB,GAAGA,iBAAiB,CAAC9B,MAAlB,CAAyB,UAAAzD,MAAM,EAAI;IACrD,OAAOA,MAAM,CAACwD,IAAP,CAAYpE,MAAZ,KAAuB,CAA9B;EACD,CAFmB,CAApB;EAIA,OAAOmG,iBAAP;AACD;;AAEM,IAAIC,eAAe,GAAG,IAAIC,kEAAJ,EAAtB;AACA,IAAIC,cAAc,GAAG,IAAIC,iEAAJ,EAArB;AAEA,IAAIC,gBAAgB,GAAG;EAC5BC,QAAQ,EAAE,oBAAW;IACnB,OAAO,CAAC,CAAE3I,wDAAA,CAAiB,OAAjB,CAAV;EACD;AAH2B,CAAvB;AAMP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM4I,qBAAqB,GAAGpB,8CAAI,CAAC,MAAD,EAAS,UAAC3E,OAAD,EAAUgG,MAAV,EAAqB;EACrE,OAAOC,wEAAuB,CAACjG,OAAD,EAAUgG,MAAV,CAA9B;AACD,CAFwC,EAEtC,uBAFsC,CAAlC;AAIP;AACA;AACA;AACA;AACA;;AACO,SAASlB,eAAT,CAAyBoB,UAAzB,EAAqC;EAC1C,IAAI,CAAClD,kDAAO,CAACkD,UAAD,CAAZ,EAA0BA,UAAU,GAAG,CAACA,UAAD,CAAb,CADgB,CAE1C;;EACA,IAAMnB,aAAa,GAAG,IAAIoB,GAAJ,CAAQ,CAAC,IAAD,CAAR,CAAtB;EACAD,UAAU,CAACxC,MAAX,CAAkB,UAAC0C,GAAD;IAAA,OAASA,GAAG,IAAIA,GAAG,CAACC,OAApB;EAAA,CAAlB,EACGC,OADH,CACW,UAACF,GAAD;IAAA,OAASA,GAAG,CAAC7E,OAAb;EAAA,CADX,EAEG8D,OAFH,CAEW,UAACtD,MAAD;IAAA,OAAYgD,aAAa,CAACwB,GAAd,CAAkBxE,MAAlB,CAAZ;EAAA,CAFX;EAGA,OAAOgD,aAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASyB,iBAAT,CAA4BxG,OAA5B,EAAqCkG,UAArC,EAAyF;EAAA;;EAAA,gFAAJ,EAAI;EAAA,gCAAvCrB,aAAuC;EAAA,IAAvCA,aAAuC,oCAAvBC,eAAuB;;EAC9F,IAAMC,aAAa,GAAGF,aAAa,CAACqB,UAAD,CAAnC;EACA,OAAOO,yDAAc,CAACzG,OAAD,CAAd,CAAwBuD,MAAxB,CAA+B,UAACmD,IAAD,EAAO3E,MAAP,EAAkB;IACtD,IAAM4E,SAAS,GAAG5B,aAAa,CAACC,GAAd,CAAkBjD,MAAlB,IAA4BO,UAAU,CAACE,MAAvC,GAAgDF,UAAU,CAACC,MAA7E;IACAmE,IAAI,CAACC,SAAD,CAAJ,CAAgBhJ,IAAhB,CAAqBoE,MAArB;IACA,OAAO2E,IAAP;EACD,CAJM,wIAIFpE,UAAU,CAACC,MAJT,EAIkB,EAJlB,4GAIuBD,UAAU,CAACE,MAJlC,EAI2C,EAJ3C,0BAAP;AAKD;AAEM,IAAMoE,gBAAgB,GAAGjC,8CAAI,CAAC,MAAD,EAAS6B,iBAAT,EAA4B,kBAA5B,CAA7B;AAEP/D,cAAc,CAACoE,eAAf,GAAiClC,8CAAI,CAAC,MAAD,EAAS,UAAU3E,OAAV,EAAmB8G,YAAnB,EAAiC3D,SAAjC,EAA4C4D,SAA5C,EAAuDf,MAAvD,EAAoG;EAAA,IAArCgB,cAAqC,uEAApB,EAAoB;EAAA,IAAhBC,cAAgB;EAChJA,cAAc,GAAGC,iEAAU,CAACD,cAAD,CAA3B;EACA;AACF;AACA;AACA;;EACE/F,4CAAA,CAAYR,wEAAZ,EAAkDV,OAAlD;;EACA,IAAI,MAAiB;IACnBmH,4EAA+B,CAACnH,OAAD,CAA/B;EACD;;EACDA,OAAO,GAAG+F,qBAAqB,CAAC/F,OAAD,EAAUgG,MAAV,CAA/B;;EAEA,yBAA+EY,gBAAgB,CAAC5G,OAAD,EAAU8C,WAAV,CAA/F;EAAA,IAA0BsE,aAA1B,sBAAM9E,UAAU,CAACC,MAAjB;EAAA,IAA8DwC,aAA9D,sBAA0CzC,UAAU,CAACE,MAArD;;EAEA,IAAIrF,wDAAA,CAAiB,gBAAjB,MAAuCkK,8CAA3C,EAAmD;IACjDD,aAAa,GAAGE,kDAAO,CAACF,aAAD,CAAvB;EACD;;EACD,IAAMG,WAAW,GAAGC,qEAAc,EAAlC;EAEA,IAAIC,WAAW,GAAG,EAAlB;EAEA,IAAMC,KAAK,GAAGV,cAAc,CAACW,MAAf,IAAyB,EAAvC;EACA,IAAMC,WAAW,GAAGZ,cAAc,CAACjF,MAAf,IAAyB,EAA7C;;EAEA,SAAS8F,QAAT,CAAkBC,aAAlB,EAAiC;IAC/B,IAAMC,GAAG,GAAGpE,MAAM,CAACqE,MAAP,CAAcC,oDAAS,CAAC,EAAD,EAAKP,KAAL,EAAYE,WAAW,CAACE,aAAa,CAACxG,UAAf,CAAvB,CAAvB,CAAZ;IACAwG,aAAa,CAACJ,KAAd,GAAsBK,GAAtB;IACAD,aAAa,CAACrE,IAAd,CAAmB4B,OAAnB,CAA2B,UAAC1F,GAAD;MAAA,OAASA,GAAG,CAAC+H,KAAJ,GAAYK,GAArB;IAAA,CAA3B;IACA,OAAOD,aAAP;EACD;;EAEDhF,WAAW,CAACuC,OAAZ,CAAoB,UAAAtC,SAAS,EAAI;IAC/B,IAAIA,SAAS,IAAIA,SAAS,CAACsD,OAA3B,EAAoC;MAClC,IAAI6B,cAAc,GAAGhD,4BAA4B,CAAClF,OAAD,EAAU+C,SAAV,CAAjD,CADkC,CAGlC;;MACA,IAAIoF,YAAY,GAAGC,uDAAY,EAA/B;MACArD,aAAa,CAACM,OAAd,CAAsB,UAAA/D,UAAU,EAAI;QAClC,IAAM8B,eAAe,GAAGgB,iEAAsB,EAA9C;QACA,IAAMd,OAAO,GAAG2D,cAAc,CAACoB,IAAf,EAAhB;QACA,IAAMP,aAAa,GAAGD,QAAQ,CAAC;UAC7BvG,UAAU,EAAVA,UAD6B;UAE7B6B,SAAS,EAATA,SAF6B;UAG7BC,eAAe,EAAfA,eAH6B;UAI7B+E,YAAY,EAAZA,YAJ6B;UAK7B1E,IAAI,EAAEiB,aAAa,CAAC;YAACpD,UAAU,EAAVA,UAAD;YAAa6B,SAAS,EAATA,SAAb;YAAwBC,eAAe,EAAfA,eAAxB;YAAyC,WAAWgC,oDAAS,CAAC8C,cAAD,CAA7D;YAA+E7E,GAAG,EAAE3C,qDAApF;YAAuG4C,OAAO,EAAPA;UAAvG,CAAD,CALU;UAM7BwD,YAAY,EAAEA,YANe;UAO7BwB,OAAO,EAAEvF,SAAS,CAACuF,OAPU;UAQ7BjF,GAAG,EAAE3C,qDARwB;UAS7B6G,WAAW,EAAXA,WAT6B;UAU7BjE,OAAO,EAAPA;QAV6B,CAAD,CAA9B;;QAYA,IAAIwE,aAAa,CAACrE,IAAd,CAAmBpE,MAAnB,KAA8B,CAAlC,EAAqC;UACnCoI,WAAW,CAAC9J,IAAZ,CAAiBmK,aAAjB;QACD;MACF,CAlBD,EALkC,CAyBlC;MACA;;MACAI,cAAc,CAAC7C,OAAf,CAAuB,UAACkD,UAAD,EAAgB;QACrC,IAAIC,SAAS,GAAGD,UAAU,CAAC9E,IAAX,CAAgBC,MAAhB,CAAuB,UAAC+E,SAAD;UAAA,OACrCvI,mDAAI,CAACuH,WAAD,EAAc,UAAAiB,OAAO;YAAA,OACvBxI,mDAAI,CAACwI,OAAO,CAACjF,IAAT,EAAe,UAACkF,MAAD;cAAA,OAAYA,MAAM,CAACzE,KAAP,KAAiBuE,SAAS,CAACtE,MAAvC;YAAA,CAAf,CADmB;UAAA,CAArB,CADiC;QAAA,CAAvB,CAAhB;QAGAoE,UAAU,CAAC9E,IAAX,GAAkB+E,SAAlB;MACD,CALD;MAOAf,WAAW,CAACpC,OAAZ,CAAoB,UAAAqD,OAAO,EAAI;QAC7B,IAAIA,OAAO,CAACR,cAAR,KAA2BU,SAA/B,EAA0C;UACxCF,OAAO,CAACR,cAAR,GAAyBA,cAAc,CAACxE,MAAf,CAAsB,UAAA6E,UAAU;YAAA,OAAIA,UAAU,CAAC9E,IAAX,CAAgBpE,MAAhB,GAAyB,CAA7B;UAAA,CAAhC,CAAzB;QACD;MACF,CAJD;IAKD;EACF,CAzCD,EA/BgJ,CA0EhJ;;;EACA,IAAImG,iBAAiB,GAAGD,8BAA8B,CAACvF,OAAD,CAAtD;EACAoH,aAAa,CAAC/B,OAAd,CAAsB,UAAA/D,UAAU,EAAI;IAClC,IAAM8B,eAAe,GAAGgB,iEAAsB,EAA9C;IACA,IAAMd,OAAO,GAAG2D,cAAc,CAACoB,IAAf,EAAhB;IACA,IAAMP,aAAa,GAAGD,QAAQ,CAAC;MAC7BvG,UAAU,EAAVA,UAD6B;MAE7B6B,SAAS,EAATA,SAF6B;MAG7BC,eAAe,EAAfA,eAH6B;MAI7BK,IAAI,EAAEiB,aAAa,CAAC;QAACpD,UAAU,EAAVA,UAAD;QAAa6B,SAAS,EAATA,SAAb;QAAwBC,eAAe,EAAfA,eAAxB;QAAyC,WAAWgC,oDAAS,CAACI,iBAAD,CAA7D;QAAkFQ,MAAM,EAANA,MAAlF;QAA0F3C,GAAG,EAAE,QAA/F;QAAyGC,OAAO,EAAPA;MAAzG,CAAD,CAJU;MAK7BwD,YAAY,EAAEA,YALe;MAM7BwB,OAAO,EAAEvB,SANoB;MAO7BQ,WAAW,EAAXA,WAP6B;MAQ7BjE,OAAO,EAAPA;IAR6B,CAAD,CAA9B;IAUA,IAAMuF,OAAO,GAAGnG,eAAe,CAACpB,UAAD,CAA/B;;IACA,IAAI,CAACuH,OAAL,EAAc;MACZhL,mDAAQ,oEAA6DyD,UAA7D,EAAR;IACD;;IAED,IAAIuH,OAAO,IAAIf,aAAa,CAACrE,IAAzB,IAAiCqE,aAAa,CAACrE,IAAd,CAAmBpE,MAAnB,KAA8B,CAAnE,EAAsE;MACpEoI,WAAW,CAAC9J,IAAZ,CAAiBmK,aAAjB;IACD;EACF,CArBD;;EAuBA,IAAIrC,eAAe,CAACqD,cAAhB,EAAJ,EAAsC;IACpCrB,WAAW,CAACpC,OAAZ,CAAoB,UAAA0D,UAAU,EAAI;MAChCA,UAAU,CAAC,aAAD,CAAV,GAA4BtD,eAAe,CAACqD,cAAhB,EAA5B;IACD,CAFD;EAGD;;EAED,IAAInD,cAAc,CAACmD,cAAf,EAAJ,EAAqC;IACnCrB,WAAW,CAACpC,OAAZ,CAAoB,UAAA0D,UAAU,EAAI;MAChCA,UAAU,CAAC,YAAD,CAAV,GAA2BpD,cAAc,CAACmD,cAAf,EAA3B;IACD,CAFD;EAGD;;EAEDrB,WAAW,CAACpC,OAAZ,CAAoB,UAAA0D,UAAU,EAAI;IAChC5L,4DAAA,CAAqB4L,UAAU,CAACzH,UAAhC,EAA4C,YAAM;MAChD,IAAM0H,uBAAuB,GAAG7L,wDAAA,CAAiB,eAAjB,CAAhC;MACA4L,UAAU,CAAC,eAAD,CAAV,GAA8BE,SAAS,CAACC,YAAV,IAA0BF,uBAAxD;IACD,CAHD;EAID,CALD;EAOA,OAAOvB,WAAP;AACD,CAvHoC,EAuHlC,iBAvHkC,CAArC;;AAyHAhF,cAAc,CAACJ,QAAf,GAA0B,UAACrC,OAAD,EAAUyH,WAAV,EAAuB0B,cAAvB,EAAuCC,MAAvC,EAA+CC,gBAA/C,EAAiEC,kBAAjE,EAAqFC,gBAArF,EAA+H;EAAA,IAAxBvC,cAAwB,uEAAP,EAAO;;EACvJ,IAAI,CAACS,WAAW,CAACpI,MAAjB,EAAyB;IACvBf,kDAAO,CAAC,iFAAD,CAAP;IACA;EACD;;EAED,0BAA6CmJ,WAAW,CAAClE,MAAZ,CAAmB,UAACiG,UAAD,EAAaT,UAAb,EAA4B;IAC1FS,UAAU,CAACC,MAAM,CAAC,OAAOV,UAAU,CAAC1F,GAAlB,KAA0B,WAA1B,IAAyC0F,UAAU,CAAC1F,GAAX,KAAmB3C,qDAA7D,CAAP,CAAV,CAAkG/C,IAAlG,CAAuGoL,UAAvG;IACA,OAAOS,UAAP;EACD,CAH4C,EAG1C,CAAC,EAAD,EAAK,EAAL,CAH0C,CAA7C;EAAA;EAAA,IAAKE,iBAAL;EAAA,IAAwBC,iBAAxB;;EAKA,IAAIC,uBAAuB,GAAG,EAA9B;EACAD,iBAAiB,CAACtE,OAAlB,CAA0B,UAAAwE,gBAAgB,EAAI;IAC5C,IAAIC,KAAK,GAAG,CAAC,CAAb;;IACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,uBAAuB,CAACvK,MAA5C,EAAoD,EAAE0K,CAAtD,EAAyD;MACvD,IAAIF,gBAAgB,CAAC1B,YAAjB,KAAkCyB,uBAAuB,CAACG,CAAD,CAAvB,CAA2B5B,YAAjE,EAA+E;QAC7E2B,KAAK,GAAGC,CAAR;QACA;MACD;IACF;;IACD,IAAID,KAAK,IAAI,CAAC,CAAd,EAAiB;MACfF,uBAAuB,CAACjM,IAAxB,CAA6BkM,gBAA7B;IACD;EACF,CAXD;EAaA,IAAIpI,OAAO,GAAG,CAAd;;EAEAqB,WAAW,CAACuC,OAAZ,CAAoB,UAACtC,SAAD,EAAe;IACjC,IAAIA,SAAS,IAAI6G,uBAAuB,CAACnI,OAAD,CAApC,IAAiDqD,eAAe,CAAC/B,SAAD,CAAf,CAA2BiC,GAA3B,CAA+B4E,uBAAuB,CAACnI,OAAD,CAAvB,CAAiCH,UAAhE,CAArD,EAAkI;MAChI;MACA,IAAM0I,OAAO,GAAGC,sDAAW,CAACX,kBAAD,EAAqBD,gBAAgB,GAAG;QACjEX,OAAO,EAAEW,gBAAgB,CAACX,OAAjB,CAAyB/J,IAAzB,CAA8B,IAA9B,EAAoC,KAApC,CADwD;QAEjEuL,IAAI,EAAEb,gBAAgB,CAACa;MAF0C,CAAH,GAG5DtB,SAHuB,CAA3B;MAIA,IAAIuB,kBAAkB,GAAGpH,SAAS,CAACxB,OAAnC;MACA,IAAM6I,UAAU,GAAG1H,eAAe,CAACK,SAAS,CAAC8F,OAAX,CAAlC;MACA,IAAIV,YAAY,GAAGyB,uBAAuB,CAACnI,OAAD,CAAvB,CAAiC0G,YAApD;MACA,IAAID,cAAc,GAAG0B,uBAAuB,CAACnI,OAAD,CAAvB,CAAiCyG,cAAtD;MAEA,IAAImC,oBAAoB,GAAGV,iBAAiB,CAACjG,MAAlB,CAAyB,UAAAmG,gBAAgB;QAAA,OAAIA,gBAAgB,CAAC1B,YAAjB,KAAkCA,YAAtC;MAAA,CAAzC,CAA3B;;MAEA,IAAIiC,UAAJ,EAAgB;QACd,IAAIE,aAAa,GAAG;UAAC,YAAYpC,cAAb;UAA6BnF,SAAS,EAATA,SAA7B;UAAwCiE,cAAc,EAAdA;QAAxC,CAApB;;QACA,IAAIsD,aAAa,CAACC,QAAd,CAAuBlL,MAA3B,EAAmC;UACjC,IAAImL,OAAO,GAAGH,oBAAoB,CAAC/E,GAArB,CAAyB,UAAAyD,UAAU,EAAI;YACnDA,UAAU,CAAC0B,KAAX,GAAmBC,oDAAS,EAA5B;YACA,OAAOtB,MAAM,CAACzK,IAAP,CAAYoK,UAAZ,CAAP;UACD,CAHa,CAAd;UAKA,IAAMxH,OAAO,GAAGkF,yDAAc,CAAC6D,aAAa,CAACC,QAAf,CAAd,CAAuC7G,MAAvC,CAA8C,UAAC3B,MAAD;YAAA,OAAYoI,kBAAkB,CAACQ,QAAnB,CAA4B5I,MAA5B,CAAZ;UAAA,CAA9C,CAAhB;UACA3C,qDAAU,2CAAoCmC,OAAO,CAAClC,MAAR,GAAiB,CAAjB,GAAqBkC,OAAO,CAACqJ,IAAR,CAAa,IAAb,CAArB,GAA0C,0DAA9E,EAAV,CAPiC,CASjC;;UACAP,oBAAoB,CAAChF,OAArB,CAA6B,UAAA0D,UAAU,EAAI;YACzC;YACA7H,4CAAA,CAAYR,kEAAZ,kCAAgDqI,UAAhD;cAA4D8B,GAAG,EAAE9B,UAAU,CAAC5F;YAA5E;UACD,CAHD,EAViC,CAejC;;UACAiH,UAAU,CAAC/H,QAAX,CACEiI,aADF,EAEEX,iBAFF,EAGER,cAHF,EAIE;YAAA,OAAMqB,OAAO,CAACnF,OAAR,CAAgB,UAAA6E,IAAI;cAAA,OAAIA,IAAI,EAAR;YAAA,CAApB,CAAN;UAAA,CAJF,EAKEF,OALF;QAOD;MACF,CA1BD,MA0BO;QACLnM,mDAAQ,CAAC,aAAakF,SAAS,CAAC8F,OAAxB,CAAR;MACD;;MACDpH,OAAO;IACR;EACF,CA7CD,EA3BuJ,CA0EvJ;;;EACAiI,iBAAiB,CAACrE,OAAlB,CAA0B,UAAA0D,UAAU,EAAI;IACtCA,UAAU,CAAC0B,KAAX,GAAmBC,oDAAS,EAA5B,CADsC,CAEtC;;IACA,IAAM7B,OAAO,GAAGnG,eAAe,CAACqG,UAAU,CAACzH,UAAZ,CAA/B;IACAnE,4DAAA,CAAqB4L,UAAU,CAACzH,UAAhC,EAA4C,YAAM;MAChDlC,qDAAU,kBAAV;MACA8B,4CAAA,CAAYR,kEAAZ,EAA4CqI,UAA5C;IACD,CAHD;IAIA,IAAI+B,IAAI,GAAGb,sDAAW,CAACX,kBAAD,EAAqBD,gBAAgB,GAAG;MAC5DX,OAAO,EAAEW,gBAAgB,CAACX,OAAjB,CAAyB/J,IAAzB,CAA8B,IAA9B,EAAoCoK,UAAU,CAACzH,UAA/C,CADmD;MAE5D4I,IAAI,EAAEb,gBAAgB,CAACa;IAFqC,CAAH,GAGvDtB,SAHkB,CAAtB;IAIA,IAAMmC,WAAW,GAAG3B,MAAM,CAACzK,IAAP,CAAYoK,UAAZ,CAApB;;IACA,IAAI;MACF5L,4DAAA,CACE4L,UAAU,CAACzH,UADb,EAEE3C,gDAAA,CACEkK,OAAO,CAACxG,QADV,EAEEwG,OAFF,EAGEE,UAHF,EAIEI,cAJF,EAKE4B,WALF,EAMED,IANF,EAOEvB,gBAPF,EAQEpM,iEAAA,CAA0B4L,UAAU,CAACzH,UAArC,CARF,CAFF;IAaD,CAdD,CAcE,OAAO0J,CAAP,EAAU;MACVnN,mDAAQ,WAAIkL,UAAU,CAACzH,UAAf,2EAAiG;QAAC0J,CAAC,EAADA,CAAD;QAAIjC,UAAU,EAAVA;MAAJ,CAAjG,CAAR;MACAgC,WAAW;IACZ;EACF,CA/BD;AAgCD,CA3GD;;AA6GA,SAASE,sBAAT,CAAgC3J,UAAhC,EAA4C;EAC1C,IAAI4J,mBAAmB,GAAG,EAA1B;EACA,IAAIP,uDAAQ,CAAClI,cAAc,CAAC0I,aAAhB,EAA+B7J,UAA/B,CAAZ,EAAwD4J,mBAAmB,CAACvN,IAApB,CAAyB,OAAzB;EACxD,IAAI,SAAmBgN,uDAAQ,CAACS,uDAAD,EAAiB9J,UAAjB,CAA/B,EAA6D4J,mBAAmB,CAACvN,IAApB,CAAyB,QAAzB;EAC7D,OAAOuN,mBAAP;AACD;;AAEDzI,cAAc,CAAC0I,aAAf,GAA+B,EAA/B,EAAmC;;AAEnC1I,cAAc,CAAC4I,kBAAf,GAAoC,UAAUC,UAAV,EAAsBhK,UAAtB,EAAmE;EAAA,gFAAJ,EAAI;EAAA,kCAAhC4J,mBAAgC;EAAA,IAAhCA,mBAAgC,sCAAV,EAAU;;EACrG,IAAII,UAAU,IAAIhK,UAAlB,EAA8B;IAC5B,IAAI,OAAOgK,UAAU,CAACjJ,QAAlB,KAA+B,UAAnC,EAA+C;MAC7CK,eAAe,CAACpB,UAAD,CAAf,GAA8BgK,UAA9B;;MAEA,IAAIX,uDAAQ,CAACO,mBAAD,EAAsB,OAAtB,CAAZ,EAA4C;QAC1CzI,cAAc,CAAC0I,aAAf,CAA6BxN,IAA7B,CAAkC2D,UAAlC;MACD;;MACD,IAAI,SAAmBqJ,uDAAQ,CAACO,mBAAD,EAAsB,QAAtB,CAA/B,EAAgE;QAC9DE,4DAAA,CAAoB9J,UAApB;MACD;IACF,CATD,MASO;MACLzD,mDAAQ,CAAC,2CAA2CyD,UAA3C,GAAwD,6CAAzD,CAAR;IACD;EACF,CAbD,MAaO;IACLzD,mDAAQ,CAAC,wCAAD,CAAR;EACD;AACF,CAjBD;;AAmBA4E,cAAc,CAAC8I,eAAf,GAAiC,UAAUjK,UAAV,EAAsBkK,KAAtB,EAA6BvO,OAA7B,EAAsC;EACrE,IAAIwO,aAAa,GAAG/I,eAAe,CAAC8I,KAAD,CAAnC;;EAEA,IAAI,OAAOC,aAAP,KAAyB,WAA7B,EAA0C;IACxC,IAAIH,UAAU,GAAG5I,eAAe,CAACpB,UAAD,CAAhC;;IACA,IAAI,OAAOgK,UAAP,KAAsB,WAA1B,EAAuC;MACrC;MACA,IAAMI,WAAW,GAAG,EAApB;;MACA5I,WAAW,CAACuC,OAAZ,CAAoB,UAAAtC,SAAS,EAAI;QAC/B,IAAIA,SAAS,CAACxB,OAAV,IAAqBwB,SAAS,CAACxB,OAAV,CAAkBlC,MAA3C,EAAmD;UACjD,IAAMsM,UAAU,GAAG5I,SAAS,IAAIA,SAAS,CAACxB,OAA1C;;UACA,IAAI,EAAEwB,SAAS,IAAI4H,uDAAQ,CAACgB,UAAD,EAAaH,KAAb,CAAvB,CAAJ,EAAiD;YAC/CE,WAAW,CAAC/N,IAAZ,CAAiB2D,UAAjB;UACD,CAFD,MAEO;YACLsB,cAAc,CAAC4I,KAAD,CAAd,GAAwBlK,UAAxB;UACD;QACF;MACF,CATD;;MAUAoK,WAAW,CAACrG,OAAZ,CAAoB,UAAA/D,UAAU,EAAI;QAChCzD,mDAAQ,CAAC,iBAAiByD,UAAjB,GAA8B,8BAA/B,EAA+D,gCAA/D,CAAR;MACD,CAFD;IAGD,CAhBD,MAgBO;MACL,IAAI;QACF,IAAIsK,UAAJ;QACA,IAAIV,mBAAmB,GAAGD,sBAAsB,CAAC3J,UAAD,CAAhD,CAFE,CAGF;QACA;;QACA,IAAIgK,UAAU,CAACO,WAAX,CAAuBhN,SAAvB,IAAoC8E,MAAM,CAAC9E,SAA/C,EAA0D;UACxD+M,UAAU,GAAG,IAAIN,UAAU,CAACO,WAAf,EAAb;UACAD,UAAU,CAACzJ,aAAX,CAAyBqJ,KAAzB;QACD,CAHD,MAGO;UACL,IAAIM,IAAI,GAAGR,UAAU,CAACS,OAAX,EAAX;UACA,IAAIC,KAAK,GAAG/O,OAAO,IAAIA,OAAO,CAAC+O,KAA/B;UACA,IAAIC,eAAe,GAAGhP,OAAO,IAAIA,OAAO,CAACgP,eAAzC;UACAL,UAAU,GAAGM,sEAAS,CAACvI,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBkI,IAAlB,EAAwB;YAAE3L,IAAI,EAAEqL,KAAR;YAAeQ,KAAK,EAALA,KAAf;YAAsBC,eAAe,EAAfA;UAAtB,CAAxB,CAAD,CAAtB;UACArJ,cAAc,CAAC4I,KAAD,CAAd,GAAwBlK,UAAxB;QACD;;QACDmB,cAAc,CAAC4I,kBAAf,CAAkCO,UAAlC,EAA8CJ,KAA9C,EAAqD;UACnDN,mBAAmB,EAAnBA;QADmD,CAArD;MAGD,CAlBD,CAkBE,OAAOF,CAAP,EAAU;QACVnN,mDAAQ,CAACyD,UAAU,GAAG,8CAAd,EAA8D,gCAA9D,CAAR;MACD;IACF;EACF,CAzCD,MAyCO;IACLlC,qDAAU,CAAC,iBAAiBoM,KAAjB,GAAyB,+BAA1B,CAAV;EACD;AACF,CA/CD;;AAiDA/I,cAAc,CAAC0J,wBAAf,GAA0C,iBAAkC;EAAA,IAAvBtD,OAAuB,SAAvBA,OAAuB;EAAA,IAAd1I,IAAc,SAAdA,IAAc;EAAA,IAAR6L,KAAQ,SAARA,KAAQ;;EAC1E,IAAInD,OAAO,IAAI1I,IAAf,EAAqB;IACnB,IAAI,OAAO0I,OAAO,CAACuD,eAAf,KAAmC,UAAvC,EAAmD;MACjDvD,OAAO,CAAC1I,IAAR,GAAeA,IAAf;MACA8C,kBAAkB,CAAC9C,IAAD,CAAlB,GAA2B;QAAE0I,OAAO,EAAPA,OAAF;QAAWmD,KAAK,EAALA;MAAX,CAA3B;IACD,CAHD,MAGO;MACLnO,mDAAQ,iEAAyDsC,IAAzD,gFAAR;IAED;EACF,CARD,MAQO;IACLtC,mDAAQ,CAAC,+DAAD,CAAR;EACD;AACF,CAZD;;AAcA4E,cAAc,CAAC2J,eAAf,GAAiC,UAAUjP,MAAV,EAAkB;EACjD,IAAI,CAAC6F,kDAAO,CAAC7F,MAAD,CAAZ,EAAsB;IACpBA,MAAM,GAAG,CAACA,MAAD,CAAT;EACD;;EAEDkP,gDAAK,CAAClP,MAAD,EAAS,UAAAmP,aAAa,EAAI;IAC7B,IAAMC,KAAK,GAAGtJ,kBAAkB,CAACqJ,aAAa,CAACE,QAAf,CAAhC;;IACA,IAAID,KAAK,IAAIA,KAAK,CAAC1D,OAAnB,EAA4B;MAC1B0D,KAAK,CAAC1D,OAAN,CAAcuD,eAAd,CAA8BE,aAA9B;IACD,CAFD,MAEO;MACLzO,mDAAQ,qEAA8DyO,aAAa,CAACE,QAA5E,QAAR;IACD;EACF,CAPI,CAAL;AAQD,CAbD;;AAeA/J,cAAc,CAACgK,aAAf,GAA+B,UAAS1K,MAAT,EAAiB;EAC9C,OAAOW,eAAe,CAACX,MAAD,CAAtB;AACD,CAFD;;AAIAU,cAAc,CAACiK,mBAAf,GAAqC,UAASvM,IAAT,EAAe;EAClD,OAAO8C,kBAAkB,CAAC9C,IAAD,CAAzB;AACD,CAFD;;AAIA,SAASwM,mBAAT,CAA6B5K,MAA7B,EAAqC6K,MAArC,EAA6CC,KAA7C,EAAoD;EAClD,IAAI;IACF,IAAMhE,OAAO,GAAGnG,eAAe,CAACX,MAAD,CAA/B;IACA,IAAM+J,IAAI,GAAGjD,OAAO,CAACkD,OAAR,EAAb;;IACA,IAAID,IAAI,IAAIA,IAAI,CAACc,MAAD,CAAZ,IAAwB,OAAOd,IAAI,CAACc,MAAD,CAAX,KAAwB,UAApD,EAAgE;MAC9DE,kDAAO,oBAAa/K,MAAb,cAAuB6K,MAAvB,EAAP;MACAzP,4DAAA,CAAqB4E,MAArB,EAA6BpD,gDAAA,CAAUmN,IAAI,CAACc,MAAD,CAAd,EAAwBd,IAAxB,EAA8Be,KAA9B,CAA7B;IACD;EACF,CAPD,CAOE,OAAO7B,CAAP,EAAU;IACV1M,kDAAO,yBAAkBsO,MAAlB,iBAA+B7K,MAA/B,EAAP;EACD;AACF;;AAEDU,cAAc,CAACsK,mBAAf,GAAqC,UAAS/M,OAAT,EAAkBgN,eAAlB,EAAmCjG,SAAnC,EAA8C;EACjFiG,eAAe,GAAGA,eAAe,CAAC1H,GAAhB,CAAoB,UAAC2H,cAAD,EAAoB;IACxD;IACAA,cAAc,CAACC,MAAf,GAAwBC,kEAAuB,CAACnN,OAAD,EAAUiN,cAAc,CAAC1P,UAAzB,EAAqC0P,cAAc,CAAClL,MAApD,CAA/C;IACAkL,cAAc,CAAC3E,OAAf,GAAyBvB,SAAzB;IACA,OAAOkG,cAAP;EACD,CALiB,CAAlB;EAMAD,eAAe,GAAGI,kDAAO,CAACJ,eAAD,EAAkB,QAAlB,CAAzB;EAEArJ,MAAM,CAAC0J,IAAP,CAAYL,eAAZ,EAA6B3H,OAA7B,CAAqC,UAACtD,MAAD,EAAY;IAC/C4K,mBAAmB,CAAC5K,MAAD,EAAS,WAAT,EAAsBiL,eAAe,CAACjL,MAAD,CAArC,CAAnB;EACD,CAFD;AAGD,CAZD;;AAcAU,cAAc,CAAC6K,gBAAf,GAAkC,UAASvL,MAAT,EAAiBpC,GAAjB,EAAsBK,OAAtB,EAA+B;EAC/D;EACAL,GAAG,CAACuN,MAAJ,GAAaC,kEAAuB,CAACnN,OAAD,EAAUL,GAAG,CAACpC,UAAd,EAA0BoC,GAAG,CAACoC,MAA9B,CAApC;EACAE,iFAAA,CAAyCtC,GAAG,CAACpC,UAA7C,EAAyDoC,GAAG,CAACoC,MAA7D;EACA4K,mBAAmB,CAAC5K,MAAD,EAAS,UAAT,EAAqBpC,GAArB,CAAnB;AACD,CALD;;AAOA8C,cAAc,CAAC8K,sBAAf,GAAwC,UAASxL,MAAT,EAAiBpC,GAAjB,EAAsB;EAC5DgN,mBAAmB,CAAC5K,MAAD,EAAS,gBAAT,EAA2BpC,GAA3B,CAAnB;AACD,CAFD;;AAIA8C,cAAc,CAAC+K,qBAAf,GAAuC,UAASzL,MAAT,EAAiBpC,GAAjB,EAAsB;EAC3DgN,mBAAmB,CAAC5K,MAAD,EAAS,eAAT,EAA0BpC,GAA1B,CAAnB;AACD,CAFD;;AAIA8C,cAAc,CAACgL,eAAf,GAAiC,UAAS1L,MAAT,EAAiBxC,KAAjB,EAAwBuI,aAAxB,EAAuC;EACtE,IAAM+E,KAAK,GAAG;IAAEtN,KAAK,EAALA,KAAF;IAASuI,aAAa,EAAbA;EAAT,CAAd;EACA6E,mBAAmB,CAAC5K,MAAD,EAAS,eAAT,EAA0B8K,KAA1B,CAAnB;AACD,CAHD;;AAKA,+DAAepK,cAAf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1lBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEO,IAAMiL,OAAO,GAAGC,yEAAqB,CAAC,eAAD,CAArC;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA,IAAMC,wBAAwB,GAAG,CAAC,KAAD,EAAQ,KAAR,EAAe,YAAf,EAA6B,YAA7B,EAA2C,UAA3C,CAAjC;AAEA,IAAMC,sBAAsB,GAAG,CAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,cAAT,CAAwBhC,IAAxB,EAA8B;EACnC,IAAMhI,UAAU,GAAGiK,KAAK,CAAC/K,OAAN,CAAc8I,IAAI,CAACZ,mBAAnB,IACf;IAAEA,mBAAmB,EAAEY,IAAI,CAACZ;EAA5B,CADe,GAEftC,SAFJ;;EAGA,SAASoF,SAAT,CAAmBlC,IAAnB,EAAyB;IACvB,IAAM/J,MAAM,GAAGmK,SAAS,CAACJ,IAAD,CAAxB;IACArJ,6EAAA,CAAkCV,MAAlC,EAA0C+J,IAAI,CAAC3L,IAA/C,EAAqD2D,UAArD;EACD;;EAEDkK,SAAS,CAAClC,IAAD,CAAT;;EACA,IAAIiC,KAAK,CAAC/K,OAAN,CAAc8I,IAAI,CAACmC,OAAnB,CAAJ,EAAiC;IAC/BnC,IAAI,CAACmC,OAAL,CAAa5I,OAAb,CAAqB,UAAAmG,KAAK,EAAI;MAC5B,IAAI0C,SAAS,GAAG1C,KAAhB;MACA,IAAIQ,KAAJ;MACA,IAAIC,eAAJ;;MACA,IAAIkC,wDAAa,CAAC3C,KAAD,CAAjB,EAA0B;QACxB0C,SAAS,GAAG1C,KAAK,CAACrL,IAAlB;QACA6L,KAAK,GAAGR,KAAK,CAACQ,KAAd;QACAC,eAAe,GAAGT,KAAK,CAACS,eAAxB;MACD;;MACDxJ,wEAAA,CAA6ByL,SAA7B,IAA0CpC,IAAI,CAAC3L,IAA/C;MACA6N,SAAS,CAACrK,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBkI,IAAlB,EAAwB;QAAE3L,IAAI,EAAE+N,SAAR;QAAmBlC,KAAK,EAALA,KAAnB;QAA0BC,eAAe,EAAfA;MAA1B,CAAxB,CAAD,CAAT;IACD,CAXD;EAYD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,SAAT,CAAmBJ,IAAnB,EAAyB;EAC9B,OAAOnI,MAAM,CAACC,MAAP,CAAc,IAAI1B,mDAAJ,CAAY4J,IAAI,CAAC3L,IAAjB,CAAd,EAAsC;IAC3C4L,OAAO,EAAE,mBAAW;MAClB,OAAOpI,MAAM,CAACqE,MAAP,CAAc8D,IAAd,CAAP;IACD,CAH0C;IAI3CsC,aAAa,EAAbA,aAJ2C;IAK3C/L,QAAQ,EAAE,kBAASyF,aAAT,EAAwBqB,cAAxB,EAAwCe,IAAxC,EAA8CY,IAA9C,EAAoDvB,gBAApD,EAAsE8E,qBAAtE,EAA6F;MACrG,IAAI,CAACN,KAAK,CAAC/K,OAAN,CAAc8E,aAAa,CAACrE,IAA5B,CAAL,EAAwC;QACtC;MACD;;MAED,IAAM6K,kBAAkB,GAAG,EAA3B;;MACA,SAASC,cAAT,CAAwBhR,UAAxB,EAAoCoC,GAApC,EAAyC;QACvC,IAAM2D,OAAO,GAAG4D,iEAAU,CAACvH,GAAG,CAAC2D,OAAL,CAA1B;QACAA,OAAO,CAACkL,UAAR,CAAmB,gBAAnB;QACAF,kBAAkB,CAAC/Q,UAAD,CAAlB,GAAiC,IAAjC;;QACA,IAAI+F,OAAO,CAACmL,WAAR,CAAoB,yBAApB,EAA+C;UAAA,OAAMC,OAAO,CAACnR,UAAD,EAAaoC,GAAb,CAAb;QAAA,CAA/C,CAAJ,EAAoF;UAClFwJ,cAAc,CAAC5L,UAAD,EAAaoC,GAAb,CAAd;QACD;MACF,CAboG,CAerG;MACA;;;MACA,IAAMgP,SAAS,GAAG,EAAlB;;MACA,SAASC,iBAAT,GAA6B;QAC3B1E,IAAI;QACJ/M,4DAAA,CAAqB2O,IAAI,CAAC3L,IAA1B,EAAgC,YAAM;UACpCe,4CAAA,CAAYR,+DAAZ,EAA0CoH,aAA1C;UACAsG,aAAa,CAACO,SAAD,EAAY7G,aAAa,CAAC+G,WAA1B,EAAuC/G,aAAa,CAACgH,UAArD,CAAb;QACD,CAHD;MAID;;MAED,IAAMC,gBAAgB,GAAGC,cAAc,CAAClH,aAAD,CAAd,CACtB2G,WADsB,CACV,UADU,EACE;QAAA,OAAM3G,aAAa,CAACrE,IAAd,CAAmBC,MAAnB,CAA0BuL,aAA1B,CAAN;MAAA,CADF,CAAzB;;MAGA,IAAIF,gBAAgB,CAAC1P,MAAjB,KAA4B,CAAhC,EAAmC;QACjCuP,iBAAiB;QACjB;MACD;;MACD,IAAMM,aAAa,GAAG,EAAtB;MACAH,gBAAgB,CAAC1J,OAAjB,CAAyB,UAAA1F,GAAG,EAAI;QAC9BuP,aAAa,CAACvP,GAAG,CAACuE,KAAL,CAAb,GAA2BvE,GAA3B,CAD8B,CAE9B;;QACA,IAAI,CAACA,GAAG,CAACpC,UAAT,EAAqB;UACnBoC,GAAG,CAACpC,UAAJ,GAAiBoC,GAAG,CAACwP,aAArB;QACD;MACF,CAND;MAQAC,qBAAqB,CAACtD,IAAD,EAAOiD,gBAAP,EAAyBjH,aAAzB,EAAwCgD,IAAxC,EAA8CuD,qBAA9C,EAAqE;QACxFgB,SAAS,EAAE,mBAAAC,aAAa;UAAA,OAAIpO,4CAAA,CAAYR,sEAAZ,EAAiDoH,aAAjD,EAAgEwH,aAAhE,CAAJ;QAAA,CADgE;QAExFC,UAAU,EAAE,oBAACC,IAAD,EAAU;UACpBjG,gBAAgB,CAACuC,IAAI,CAAC3L,IAAN,CAAhB;UACAwO,SAAS,CAAChR,IAAV,CAAe6R,IAAf;QACD,CALuF;;QAMxF;AACR;AACA;QACQC,sBAAsB,EAAE,gCAACC,oBAAD,EAA0B;UAChDA,oBAAoB,CAACrK,OAArB,CAA6B,UAACsK,mBAAD,EAAyB;YACpD,IAAM5G,UAAU,GAAGmG,aAAa,CAACS,mBAAmB,CAACzL,KAArB,CAAhC;;YACA,IAAI6E,UAAJ,EAAgB;cACd6G,mBAAmB,CAAC7G,UAAD,EAAa4G,mBAAb,CAAnB;YACD;UACF,CALD;QAMD,CAhBuF;QAiBxF;QACAE,OAAO,EAAE,iBAACC,YAAD,EAAevQ,KAAf,EAAyB;UAChCgK,gBAAgB,CAACuC,IAAI,CAAC3L,IAAN,CAAhB;UACAsC,0EAAA,CAA+BqJ,IAAI,CAAC3L,IAApC,EAA0CZ,KAA1C,EAAiDuI,aAAjD;UACA5G,4CAAA,CAAYR,gEAAZ,EAA2C;YAAEnB,KAAK,EAALA,KAAF;YAASuI,aAAa,EAAbA;UAAT,CAA3C;UACAjK,mDAAQ,2BAAoBiO,IAAI,CAAC3L,IAAzB,sBAAyC2P,YAAzC,cAAyDvQ,KAAK,CAACwQ,MAA/D,gCAAR;QACD,CAvBuF;QAwBxFC,KAAK,EAAE,eAACrQ,GAAD,EAAS;UACd,IAAMoJ,UAAU,GAAGmG,aAAa,CAACvP,GAAG,CAACsQ,SAAL,CAAhC;;UACA,IAAIlH,UAAJ,EAAgB;YACdpJ,GAAG,CAACuQ,WAAJ,GAAkBnH,UAAU,CAAChH,MAA7B;;YACA,IAAIoO,wBAAwB,CAACxQ,GAAG,CAAC2B,UAAL,EAAiByH,UAAU,CAAChH,MAA5B,CAA5B,EAAiE;cAC/DzD,kDAAO,WAAIqB,GAAG,CAAC2B,UAAR,6DAAqEyH,UAAU,CAAChH,MAAhF,0IAAP;cACA;YACD,CALa,CAMd;;;YACApC,GAAG,CAACyQ,WAAJ,GAAkBzQ,GAAG,CAAC0Q,GAAtB;YACA1Q,GAAG,CAAC2Q,gBAAJ,GAAuB3Q,GAAG,CAAC4Q,QAA3B;YACA5Q,GAAG,CAAC6Q,IAAJ,GAAW7Q,GAAG,CAAC6Q,IAAJ,IAAY7M,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAG,CAACoJ,UAAU,CAAChH,MAAZ,CAArB,CAAvB;YACA,IAAM0O,SAAS,GAAG9M,MAAM,CAACC,MAAP,CAAc8M,yDAAS,CAAChQ,wDAAD,EAAwBqI,UAAxB,CAAvB,EAA4DpJ,GAA5D,CAAlB;YACA4O,cAAc,CAACxF,UAAU,CAACxL,UAAZ,EAAwBkT,SAAxB,CAAd;UACD,CAZD,MAYO;YACLnS,kDAAO,kBAAWwN,IAAI,CAAC3L,IAAhB,+CAAyDR,GAAG,CAACsQ,SAA7D,iBAAP;UACD;QACF,CAzCuF;QA0CxFU,YAAY,EAAE/B;MA1C0E,CAArE,CAArB;IA4CD;EA3F0C,CAAtC,CAAP;;EA8FA,SAASuB,wBAAT,CAAkCS,cAAlC,EAAkDC,aAAlD,EAAiE;IAC/D,IAAIC,yBAAyB,GAAGC,kEAAA,CAAmBF,aAAnB,EAAkC,2BAAlC,KAAkE,KAAlG;IACA,IAAIG,oBAAoB,GAAGD,kEAAA,CAAmBF,aAAnB,EAAkC,6BAAlC,CAA3B;;IACA,IAAI,CAAC,CAACD,cAAF,IAAoB,CAAC,CAACC,aAAtB,IAAuCA,aAAa,KAAKD,cAA7D,EAA6E;MAC3EI,oBAAoB,GAAGhO,kDAAO,CAACgO,oBAAD,CAAP,GAAgCA,oBAAoB,CAAC1L,GAArB,CAAyB,UAAAb,GAAG;QAAA,OAAIA,GAAG,CAACwM,IAAJ,GAAWC,WAAX,EAAJ;MAAA,CAA5B,EAA0DxN,MAA1D,CAAiE,UAAAe,GAAG;QAAA,OAAI,CAAC,CAACA,GAAN;MAAA,CAApE,EAA+Ef,MAA/E,CAAsFyN,8CAAtF,CAAhC,GAAiIH,oBAAxJ;;MACA,IAAI,CAACF,yBAAD,IAA+B9N,kDAAO,CAACgO,oBAAD,CAAP,IAAkCA,oBAAoB,CAAC,CAAD,CAApB,KAA4B,GAA5B,IAAmC,CAACA,oBAAoB,CAACrG,QAArB,CAA8BiG,cAA9B,CAAzG,EAA0J;QACxJ,OAAO,IAAP;MACD;IACF;;IACD,OAAO,KAAP;EACD;;EAED,SAASxC,aAAT,CAAuBO,SAAvB,EAAkCE,WAAlC,EAA+CC,UAA/C,EAA2D;IACzDsC,iBAAiB,CAACtF,IAAD,EAAO6C,SAAP,EAAkBE,WAAlB,EAA+BC,UAA/B,CAAjB;EACD;;EAED,SAASG,aAAT,CAAuBtP,GAAvB,EAA4B;IAC1B,IAAI,CAACmM,IAAI,CAACuF,iBAAL,CAAuB1R,GAAvB,CAAL,EAAkC;MAChCrB,kDAAO,sCAA+BwN,IAAI,CAAC3L,IAApC,eAA6CmR,IAAI,CAACC,SAAL,CAAe5R,GAAf,CAA7C,EAAP;MACA,OAAO,KAAP;IACD;;IACD,OAAO,IAAP;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAMyP,qBAAqB,GAAGzK,+CAAI,CAAC,MAAD,EAAS,UAAUmH,IAAV,EAAgBrI,IAAhB,EAAsBqE,aAAtB,EAAqCgD,IAArC,EAA2C0G,YAA3C,QAAwI;EAAA,IAA9EnC,SAA8E,QAA9EA,SAA8E;EAAA,IAAnEE,UAAmE,QAAnEA,UAAmE;EAAA,IAAvDE,sBAAuD,QAAvDA,sBAAuD;EAAA,IAA/BI,OAA+B,QAA/BA,OAA+B;EAAA,IAAtBG,KAAsB,QAAtBA,KAAsB;EAAA,IAAfW,YAAe,QAAfA,YAAe;EACxL,IAAMrN,OAAO,GAAG0L,cAAc,CAAClH,aAAD,CAA9B;EACA6I,YAAY,GAAGrN,OAAO,CAACmO,WAAR,CAAoB,OAApB,EAA6BC,UAA7B,CAAwCf,YAAxC,CAAf;EAEA,IAAIgB,QAAQ,GAAGrO,OAAO,CAACmL,WAAR,CAAoB,eAApB,EAAqC;IAAA,OAAM3C,IAAI,CAAC8F,aAAL,CAAmBnO,IAAnB,EAAyBqE,aAAzB,CAAN;EAAA,CAArC,CAAf;;EAEA,IAAI,CAAC6J,QAAD,IAAaA,QAAQ,CAACtS,MAAT,KAAoB,CAArC,EAAwC;IACtCsR,YAAY;IACZ;EACD;;EACD,IAAI,CAAC5C,KAAK,CAAC/K,OAAN,CAAc2O,QAAd,CAAL,EAA8B;IAC5BA,QAAQ,GAAG,CAACA,QAAD,CAAX;EACD;;EAED,IAAME,WAAW,GAAGC,yDAAc,CAACnB,YAAD,EAAegB,QAAQ,CAACtS,MAAxB,CAAlC;EAEAsS,QAAQ,CAACtM,OAAT,CAAiB,UAACqD,OAAD,EAAa;IAC5B,IAAMqJ,cAAc,GAAGzO,OAAO,CAAC+E,IAAR,EAAvB;;IACA,SAAS2J,MAAT,CAAgBrS,GAAhB,EAAqB;MACnB,IAAIA,GAAG,IAAI,IAAX,EAAiBA,GAAG,CAAC2D,OAAJ,GAAcyO,cAAc,CAAC1J,IAAf,GAAsB4J,UAAtB,EAAd;MACjBjC,KAAK,CAACrQ,GAAD,CAAL;IACD,CAL2B,CAM5B;IACA;IACA;;;IACA,IAAMuS,SAAS,GAAGV,YAAY,CAAC,UAASW,QAAT,EAAmBC,WAAnB,EAAgC;MAC7DC,WAAW;;MACX,IAAI;QACFF,QAAQ,GAAGb,IAAI,CAACgB,KAAL,CAAWH,QAAX,CAAX;MACD,CAFD,CAEE,OAAOnH,CAAP,EAAU;QAAE;MAAgD,CAJD,CAM7D;;;MACAmH,QAAQ,GAAG;QACTI,IAAI,EAAEJ,QADG;QAETK,OAAO,EAAEC,YAAY,CAACL,WAAD;MAFZ,CAAX;MAIA7C,UAAU,CAAC4C,QAAD,CAAV;;MAEA,IAAI;QACFA,QAAQ,GAAGJ,cAAc,CAACtD,WAAf,CAA2B,mBAA3B,EAAgD;UAAA,OAAM3C,IAAI,CAAC4G,iBAAL,CAAuBP,QAAvB,EAAiCzJ,OAAjC,CAAN;QAAA,CAAhD,CAAX;MACD,CAFD,CAEE,OAAOiK,GAAP,EAAY;QACZ9U,mDAAQ,kBAAWiO,IAAI,CAAC3L,IAAhB,0EAA2F,IAA3F,EAAiGwS,GAAjG,CAAR;QACAd,WAAW;QACX;MACD;;MAED,IAAIpO,IAAJ,CArB6D,CAsB7D;;MACA,IAAI0O,QAAQ,IAAInP,kDAAO,CAACmP,QAAQ,CAACzC,oBAAV,CAAvB,EAAwD;QACtDD,sBAAsB,CAAC0C,QAAQ,CAACzC,oBAAV,CAAtB;QACAjM,IAAI,GAAG0O,QAAQ,CAAC1O,IAAhB;MACD,CAHD,MAGO;QACLA,IAAI,GAAG0O,QAAP;MACD;;MAED,IAAI1O,IAAJ,EAAU;QACR,IAAIT,kDAAO,CAACS,IAAD,CAAX,EAAmB;UACjBA,IAAI,CAAC4B,OAAL,CAAa2M,MAAb;QACD,CAFD,MAEO;UACLA,MAAM,CAACvO,IAAD,CAAN;QACD;MACF;;MACDoO,WAAW;;MAEX,SAASY,YAAT,CAAsBG,eAAtB,EAAuC;QACrC,OAAO;UACLC,GAAG,EAAET,WAAW,CAACU,iBAAZ,CAA8BnU,IAA9B,CAAmCyT,WAAnC;QADA,CAAP;MAGD;IACF,CA5C6B,CAA9B;IA8CA,IAAMW,SAAS,GAAGvB,YAAY,CAAC,UAAU1B,YAAV,EAAwBvQ,KAAxB,EAA+B;MAC5D8S,WAAW;MACXxC,OAAO,CAACC,YAAD,EAAevQ,KAAf,CAAP;MACAsS,WAAW;IACZ,CAJ6B,CAA9B;IAMAxC,SAAS,CAAC3G,OAAD,CAAT;IAEA,IAAM2J,WAAW,GAAGN,cAAc,CAACN,WAAf,CAA2B,KAA3B,CAApB;;IACA,QAAQ/I,OAAO,CAACkE,MAAhB;MACE,KAAK,KAAL;QACE9B,IAAI,WACCpC,OAAO,CAACxL,GADT,SACe8V,mBAAmB,CAACtK,OAAO,CAAC1H,IAAT,CADlC,GAEF;UACEiS,OAAO,EAAEf,SADX;UAEE3S,KAAK,EAAEwT;QAFT,CAFE,EAMFnK,SANE,EAOFjF,MAAM,CAACC,MAAP,CAAc;UACZgJ,MAAM,EAAE,KADI;UAEZsG,eAAe,EAAE;QAFL,CAAd,EAGGxK,OAAO,CAACzL,OAHX,CAPE,CAAJ;QAYA;;MACF,KAAK,MAAL;QACE6N,IAAI,CACFpC,OAAO,CAACxL,GADN,EAEF;UACE+V,OAAO,EAAEf,SADX;UAEE3S,KAAK,EAAEwT;QAFT,CAFE,EAMF,OAAOrK,OAAO,CAAC1H,IAAf,KAAwB,QAAxB,GAAmC0H,OAAO,CAAC1H,IAA3C,GAAkDsQ,IAAI,CAACC,SAAL,CAAe7I,OAAO,CAAC1H,IAAvB,CANhD,EAOF2C,MAAM,CAACC,MAAP,CAAc;UACZgJ,MAAM,EAAE,MADI;UAEZuG,WAAW,EAAE,YAFD;UAGZD,eAAe,EAAE;QAHL,CAAd,EAIGxK,OAAO,CAACzL,OAJX,CAPE,CAAJ;QAaA;;MACF;QACEqB,kDAAO,yCAAkCwN,IAAI,CAAC3L,IAAvC,4BAA6DuI,OAAO,CAAC0K,IAArE,0BAAP;QACAvB,WAAW;IAhCf;;IAmCA,SAASmB,mBAAT,CAA6BhS,IAA7B,EAAmC;MACjC,IAAIA,IAAJ,EAAU;QACR,kBAAW,2EAAOA,IAAP,MAAgB,QAAhB,GAA2BqS,qEAA0B,CAACrS,IAAD,CAArD,GAA8DA,IAAzE;MACD;;MAED,OAAO,EAAP;IACD;EACF,CA1GD;AA2GD,CA3HwC,EA2HtC,uBA3HsC,CAAlC;AA6HA,IAAMoQ,iBAAiB,GAAGzM,+CAAI,CAAC,OAAD,EAAU,UAASmH,IAAT,EAAe6C,SAAf,EAA0BE,WAA1B,EAAuCC,UAAvC,EAAmD;EAChG,IAAMwE,gBAAgB,GAAGnW,wDAAA,CAAiB,2BAAjB,CAAzB;;EACA,IAAI2O,IAAI,CAACyH,YAAL,KAAsBD,gBAAgB,IAAI,CAAC7Q,wEAAA,CAA6BqJ,IAAI,CAAC3L,IAAlC,CAA3C,CAAJ,EAAyF;IACvF,IAAIqT,YAAY,GAAGrW,wDAAA,CAAiB,yBAAjB,CAAnB;IACA,IAAIsW,KAAK,GAAG3H,IAAI,CAACyH,YAAL,CAAkB;MAC5BG,aAAa,EAAE,CAAC,EAAEF,YAAY,KAAKA,YAAY,CAACG,MAAb,IAAuBH,YAAY,CAACI,GAAzC,CAAd,CADY;MAE5BC,YAAY,EAAE,CAAC,EAAEL,YAAY,KAAKA,YAAY,CAACM,KAAb,IAAsBN,YAAY,CAACI,GAAxC,CAAd;IAFa,CAAlB,EAGTjF,SAHS,EAGEE,WAHF,EAGeC,UAHf,CAAZ;;IAIA,IAAI2E,KAAJ,EAAW;MACT,IAAI,CAAC1F,KAAK,CAAC/K,OAAN,CAAcyQ,KAAd,CAAL,EAA2B;QACzBA,KAAK,GAAG,CAACA,KAAD,CAAR;MACD;;MACDA,KAAK,CAACpO,OAAN,CAAc,UAAC0O,IAAD,EAAU;QACtBC,gEAAA,CAAsBD,IAAI,CAACX,IAA3B,EAAiCtH,IAAI,CAAC3L,IAAtC,EAA4C4T,IAAI,CAAC7W,GAAjD;MACD,CAFD;IAGD;EACF;AACF,CAjBoC,EAiBlC,eAjBkC,CAA9B;AAmBA,IAAM0S,mBAAmB,GAAGjL,+CAAI,CAAC,MAAD,EAAS,UAACsP,WAAD,EAActE,mBAAd,EAAsC;EACpF7C,kDAAO,sCAAsC6C,mBAAtC,CAAP;AACD,CAFsC,EAEpC,qBAFoC,CAAhC;AAIA,SAASuE,wBAAT,CAAkClV,EAAlC,EAAsCgB,OAAtC,EAA+C;EACpD,IAAI,CAAC7C,wDAAA,CAAiB,8BAAjB,CAAL,EAAuD;IACrD,OAAO6B,EAAE,CAAClB,IAAH,CAAQ,IAAR,EAAckC,OAAd,CAAP;EACD;;EACD,IAAImU,YAAY,GAAGnU,OAAO,CACvB0D,MADgB,CACT,UAACzD,MAAD;IAAA,OAAYI,sDAAU,CAACJ,MAAD,EAAS,0BAAT,CAAV,KAAmDmU,kDAA/D;EAAA,CADS,EAEhB9O,GAFgB,CAEZ,UAACrF,MAAD;IAAA,OAAYA,MAAM,CAACwD,IAAP,CAAY6B,GAAZ,CAAgB,UAAC3F,GAAD;MAAA,OAASA,GAAG,CAACoC,MAAb;IAAA,CAAhB,CAAZ;EAAA,CAFY,EAGhBwB,MAHgB,CAGTiB,8CAHS,EAGA,EAHA,EAIhBd,MAJgB,CAITyN,8CAJS,CAAnB;EAMAgD,YAAY,CAAC9O,OAAb,CAAqB,UAAAtD,MAAM,EAAI;IAC7B,IAAIsS,UAAU,GAAG5R,wEAAA,CAA6BV,MAA7B,CAAjB;;IACA,IAAIsS,UAAU,CAACtI,OAAX,GAAqBuI,kBAAzB,EAA6C;MAC3C,IAAIC,IAAI,GAAGF,UAAU,CAACtI,OAAX,GAAqBuI,kBAArB,EAAX;MACA,IAAIE,aAAa,GAAID,IAAI,CAACC,aAAN,GAAuBD,IAAI,CAACC,aAA5B,GAA4C3G,sBAAhE;MACA,IAAI4G,GAAG,GAAIF,IAAI,CAACG,eAAN,GAAyBH,IAAI,CAACG,eAA9B,GAAgDL,UAAU,CAACtI,OAAX,GAAqB5L,IAA/E;MACA,IAAIwU,WAAW,GAAGjH,OAAO,CAACkH,uBAAR,CAAgCH,GAAhC,CAAlB;;MACA,IAAI;QACFE,WAAW,GAAGA,WAAW,GAAGrD,IAAI,CAACgB,KAAL,CAAWqC,WAAX,CAAH,GAA6B/L,SAAtD;;QACA,IAAI,CAAC+L,WAAD,IAAgBjK,oDAAS,KAAKiK,WAAW,CAACE,WAAZ,GAA0BL,aAAa,GAAG,EAAhB,GAAqB,EAArB,GAA0B,EAA1B,GAA+B,IAA3F,EAAiG;UAC/F1J,+CAAI,CAACyJ,IAAI,CAACrX,GAAN,EACF;YACE+V,OAAO,EAAE,iBAACd,QAAD,EAAc;cACrB,IAAI;gBACFA,QAAQ,GAAGb,IAAI,CAACgB,KAAL,CAAWH,QAAX,CAAX;gBACA,IAAI2C,OAAO,GAAG;kBACZD,WAAW,EAAEnK,oDAAS,EADV;kBAEZoK,OAAO,EAAE3C,QAAQ,CAAC2C;gBAFN,CAAd;gBAIApH,OAAO,CAACqH,qBAAR,CAA8BN,GAA9B,EAAmCnD,IAAI,CAACC,SAAL,CAAeuD,OAAf,CAAnC;cACD,CAPD,CAOE,OAAOvV,KAAP,EAAc;gBACd1B,mDAAQ,2BAAoBkE,MAApB,sCAAR;cACD;YACF,CAZH;YAaExC,KAAK,EAAE,iBAAM;cACX1B,mDAAQ,0BAAmBkE,MAAnB,8BAAR;YACD;UAfH,CADE,CAAJ;QAmBD;MACF,CAvBD,CAuBE,OAAOxC,KAAP,EAAc;QACd1B,mDAAQ,2BAAoBkE,MAApB,sCAAR;MACD;IACF;EACF,CAlCD;EAmCA/C,EAAE,CAAClB,IAAH,CAAQ,IAAR,EAAckC,OAAd;AACD;AAEDgV,kDAAO,CAAC,kBAAD,CAAP,CAA4BC,MAA5B,CAAmCf,wBAAnC;AAEA;AACA;AACA;AACA;AACA;;AACO,SAASgB,iBAAT,CAA2B5T,UAA3B,EAAuC6T,QAAvC,EAAiD;EACtD,IAAId,UAAU,GAAG5R,wEAAA,CAA6BnB,UAA7B,CAAjB;;EACA,IAAI+S,UAAU,CAACtI,OAAX,GAAqBuI,kBAAzB,EAA6C;IAC3C,IAAIC,IAAI,GAAGF,UAAU,CAACtI,OAAX,GAAqBuI,kBAArB,EAAX;IACA,IAAIG,GAAG,GAAIF,IAAI,CAACG,eAAN,GAAyBH,IAAI,CAACG,eAA9B,GAAgDL,UAAU,CAACjS,aAAX,EAA1D;IACA,IAAIpB,IAAI,GAAG0M,OAAO,CAACkH,uBAAR,CAAgCH,GAAhC,CAAX;;IACA,IAAIzT,IAAJ,EAAU;MACR,IAAI;QACFA,IAAI,GAAGsQ,IAAI,CAACgB,KAAL,CAAWtR,IAAX,CAAP;MACD,CAFD,CAEE,OAAOzB,KAAP,EAAc;QACd1B,mDAAQ,2BAAoByD,UAApB,2CAAR;MACD;;MACD,OAAQN,IAAI,CAAC8T,OAAL,CAAaK,QAAb,CAAD,GAA2BnU,IAAI,CAAC8T,OAAL,CAAaK,QAAb,CAA3B,GAAoD,IAA3D;IACD;EACF;AACF,EAED;;AACA,SAASC,YAAT,CAAsB7X,UAAtB,EAAkCoC,GAAlC,EAA4E;EAAA,gFAAJ,EAAI;EAAA,wBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,qEAA4B;;EAC1E,IAAI,CAAC1V,GAAG,CAAC2V,KAAJ,IAAaC,QAAQ,CAAC5V,GAAG,CAAC2V,KAAL,EAAY,EAAZ,CAAR,KAA4B,CAA1C,MAAiD3V,GAAG,CAAC6V,MAAJ,IAAcD,QAAQ,CAAC5V,GAAG,CAAC6V,MAAL,EAAa,EAAb,CAAR,KAA6B,CAA5F,CAAJ,EAAoG;IAClG7V,GAAG,CAAC2V,KAAJ,GAAYC,QAAQ,CAAC5V,GAAG,CAAC2V,KAAL,EAAY,EAAZ,CAApB;IACA3V,GAAG,CAAC6V,MAAJ,GAAaD,QAAQ,CAAC5V,GAAG,CAAC6V,MAAL,EAAa,EAAb,CAArB;IACA,OAAO,IAAP;EACD;;EAED,IAAMzM,UAAU,GAAGe,KAAK,CAAC2L,aAAN,CAAoB9V,GAApB,CAAnB;EACA,IAAMmE,UAAU,GAAGgG,KAAK,CAAC4L,aAAN,CAAoB/V,GAApB,CAAnB;EAEA,IAAMsE,KAAK,GAAI8E,UAAU,IAAIA,UAAU,CAAC9E,KAA1B,IAAqCH,UAAU,IAAIA,UAAU,CAAC6R,MAAzB,IAAmC7R,UAAU,CAAC6R,MAAX,CAAkB1R,KAAxG;EACA,IAAM2R,WAAW,GAAGC,0DAAe,CAAC5R,KAAD,CAAnC,CAX0E,CAa1E;EACA;;EACA,IAAI2R,WAAW,CAACvW,MAAZ,KAAuB,CAA3B,EAA8B;IAC5B,2BAA0BuW,WAAW,CAAC,CAAD,CAAX,CAAeE,KAAf,CAAqB,GAArB,CAA1B;IAAA;IAAA,IAAQR,KAAR;IAAA,IAAeE,MAAf;;IACA7V,GAAG,CAAC2V,KAAJ,GAAYC,QAAQ,CAACD,KAAD,EAAQ,EAAR,CAApB;IACA3V,GAAG,CAAC6V,MAAJ,GAAaD,QAAQ,CAACC,MAAD,EAAS,EAAT,CAArB;IACA,OAAO,IAAP;EACD;;EAED,OAAO,KAAP;AACD,EAED;;;AACO,SAAS9G,OAAT,CAAiBnR,UAAjB,EAA6BoC,GAA7B,EAAuE;EAAA,gFAAJ,EAAI;EAAA,wBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,qEAA4B;;EAC5E,SAASU,YAAT,GAAwB;IACtB,IAAIC,OAAO,GAAGrS,MAAM,CAAC0J,IAAP,CAAY1N,GAAZ,CAAd;IACA,OAAOiO,wBAAwB,CAACqI,KAAzB,CAA+B,UAAAxB,GAAG;MAAA,OAAI9J,uDAAQ,CAACqL,OAAD,EAAUvB,GAAV,CAAR,IAA0B,CAAC9J,uDAAQ,CAAC,CAAC/B,SAAD,EAAY,IAAZ,CAAD,EAAoBjJ,GAAG,CAAC8U,GAAD,CAAvB,CAAvC;IAAA,CAAlC,CAAP;EACD;;EAED,SAAS3E,YAAT,CAAsBoG,GAAtB,EAA2B;IACzB,kCAA2BvW,GAAG,CAAC2B,UAA/B,6BAA4D4U,GAA5D;EACD;;EAED,IAAI,CAAC3Y,UAAL,EAAiB;IACfe,kDAAO,CAAC,+CAAD,CAAP;IACA,OAAO,KAAP;EACD;;EAED,IAAI,CAACqB,GAAL,EAAU;IACRrB,kDAAO,0DAAmDf,UAAnD,OAAP;IACA,OAAO,KAAP;EACD;;EAED,IAAI,CAACwY,YAAY,EAAjB,EAAqB;IACnBlY,mDAAQ,CAACiS,YAAY,kBAAWnQ,GAAG,CAAC2B,UAAf,6GAAb,CAAR;IACA,OAAO,KAAP;EACD;;EAED,IAAI,SAAmB3B,GAAG,CAACwW,SAAJ,KAAkB,QAArC,IAAiD,CAACC,6DAAgB,CAACzW,GAAD,EAAM;IAACmK,KAAK,EAALA;EAAD,CAAN,CAAtE,EAAsF;IACpFjM,mDAAQ,CAACiS,YAAY,CAAC,8CAAD,CAAb,CAAR;IACA,OAAO,KAAP;EACD;;EACD,IAAInQ,GAAG,CAACwW,SAAJ,KAAkB,OAAlB,IAA6B,CAACE,2DAAe,CAAC1W,GAAD,EAAM;IAACmK,KAAK,EAALA;EAAD,CAAN,CAAjD,EAAiE;IAC/DjM,mDAAQ,CAACiS,YAAY,iEAAb,CAAR;IACA,OAAO,KAAP;EACD;;EACD,IAAInQ,GAAG,CAACwW,SAAJ,KAAkB,QAAlB,IAA8B,CAACf,YAAY,CAAC7X,UAAD,EAAaoC,GAAb,EAAkB;IAACmK,KAAK,EAALA;EAAD,CAAlB,CAA/C,EAA2E;IACzEjM,mDAAQ,CAACiS,YAAY,0CAAb,CAAR;IACA,OAAO,KAAP;EACD;;EAED,OAAO,IAAP;AACD;;AAED,SAASd,cAAT,CAAwBlH,aAAxB,EAAuC;EACrC,OAAOZ,iEAAU,CAACY,aAAa,CAACxE,OAAf,CAAV,CAAkC2O,UAAlC,CAA6C,UAAAqE,CAAC;IAAA,OAAI,0BAAmBA,CAAnB,6BAA2CxO,aAAa,CAACxG,UAAzD,cAAuEgV,CAAvE,EAAJ;EAAA,CAA9C,CAAP;AACD;;;;;;;;;;;;;;;;ACnmBD;AACA;;AAEA,IAAMC,aAAa,GAAG,IAAIC,OAAJ,EAAtB,EACA;;;AACA,IAAMC,2BAA2B,GAAG,CAClC,WADkC,EAElC,QAFkC,EAGlC,QAHkC,EAIlC,WAJkC,EAKlC,QALkC,EAMlC,OANkC,EAOlC,QAPkC,EAQlC,cARkC,EASlC,SATkC,EAUlC,OAVkC,EAWlC,WAXkC,EAYlC,UAZkC,EAalC,QAbkC,EAclC,QAdkC,EAelC,UAfkC,EAgBlC,gBAhBkC,CAApC;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAShY,kBAAT,CAA4BvB,GAA5B,EAAiCH,UAAjC,EAA6CM,QAA7C,EAAuDuC,GAAvD,EAA4D8W,UAA5D,EAAwE;EAC7E,IAAI,CAAC3Z,UAAD,IAAe,CAACG,GAApB,EAAyB;IACvBW,mDAAQ,CAAC,wDAAD,CAAR;IACA;EACD;;EACD,IAAI,CAAC8M,sDAAQ,CAAC8L,2BAAD,EAA8B1Z,UAA9B,CAAb,EAAwD;IACtDc,mDAAQ,WAAId,UAAJ,sDAAR;IACA;EACD;;EACD,IAAI,CAAC6C,GAAL,EAAU;IACRA,GAAG,GAAGG,QAAN,CADQ,CACQ;EACjB,CAX4E,CAY7E;;;EACA,IAAM4W,kBAAkB,GAAGC,cAAc,CAAChX,GAAD,EAAM1C,GAAN,CAAzC;;EACA,IAAIyZ,kBAAJ,EAAwB;IACtB,IAAItZ,QAAQ,IAAI,OAAOA,QAAP,KAAoB,UAApC,EAAgD;MAC9C,IAAIsZ,kBAAkB,CAACrZ,MAAvB,EAA+B;QAC7B;QACAD,QAAQ;MACT,CAHD,MAGO;QACL;QACAsZ,kBAAkB,CAACE,SAAnB,CAA6BlZ,IAA7B,CAAkCN,QAAlC;MACD;IACF;;IACD,OAAOsZ,kBAAkB,CAACG,GAA1B;EACD;;EACD,IAAMC,YAAY,GAAGR,aAAa,CAAC1D,GAAd,CAAkBjT,GAAlB,KAA0B,EAA/C;EACA,IAAMoX,WAAW,GAAG;IAClB1Z,MAAM,EAAE,KADU;IAElBwZ,GAAG,EAAE,IAFa;IAGlBD,SAAS,EAAE;EAHO,CAApB;EAKAE,YAAY,CAAC7Z,GAAD,CAAZ,GAAoB8Z,WAApB;;EACAT,aAAa,CAACU,GAAd,CAAkBrX,GAAlB,EAAuBmX,YAAvB;;EAEA,IAAI1Z,QAAQ,IAAI,OAAOA,QAAP,KAAoB,UAApC,EAAgD;IAC9C2Z,WAAW,CAACH,SAAZ,CAAsBlZ,IAAtB,CAA2BN,QAA3B;EACD;;EAEDiB,kDAAO,kBAAWvB,UAAX,qCAAP;EACA,OAAOma,eAAe,CAACha,GAAD,EAAM,YAAY;IACtC8Z,WAAW,CAAC1Z,MAAZ,GAAqB,IAArB;;IACA,IAAI;MACF,KAAK,IAAIyM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiN,WAAW,CAACH,SAAZ,CAAsBxX,MAA1C,EAAkD0K,CAAC,EAAnD,EAAuD;QACrDiN,WAAW,CAACH,SAAZ,CAAsB9M,CAAtB;MACD;IACF,CAJD,CAIE,OAAOiB,CAAP,EAAU;MACVnN,mDAAQ,CAAC,0BAAD,EAA6B,gCAA7B,EAA+DmN,CAA/D,CAAR;IACD;EACF,CATqB,EASnBpL,GATmB,EASd8W,UATc,CAAtB;;EAWA,SAASQ,eAAT,CAAyBC,MAAzB,EAAiC9Z,QAAjC,EAA2CuC,GAA3C,EAAgD8W,UAAhD,EAA4D;IAC1D,IAAI,CAAC9W,GAAL,EAAU;MACRA,GAAG,GAAGG,QAAN;IACD;;IACD,IAAIqX,SAAS,GAAGxX,GAAG,CAACyX,aAAJ,CAAkB,QAAlB,CAAhB;IACAD,SAAS,CAAChE,IAAV,GAAiB,iBAAjB;IACAgE,SAAS,CAACE,KAAV,GAAkB,IAAlB;IAEA,IAAMN,WAAW,GAAGJ,cAAc,CAAChX,GAAD,EAAM1C,GAAN,CAAlC;;IACA,IAAI8Z,WAAJ,EAAiB;MACfA,WAAW,CAACF,GAAZ,GAAkBM,SAAlB;IACD;;IAED,IAAIA,SAAS,CAACG,UAAd,EAA0B;MACxBH,SAAS,CAACI,kBAAV,GAA+B,YAAY;QACzC,IAAIJ,SAAS,CAACG,UAAV,KAAyB,QAAzB,IAAqCH,SAAS,CAACG,UAAV,KAAyB,UAAlE,EAA8E;UAC5EH,SAAS,CAACI,kBAAV,GAA+B,IAA/B;UACAna,QAAQ;QACT;MACF,CALD;IAMD,CAPD,MAOO;MACL+Z,SAAS,CAACK,MAAV,GAAmB,YAAY;QAC7Bpa,QAAQ;MACT,CAFD;IAGD;;IAED+Z,SAAS,CAAC/T,GAAV,GAAgB8T,MAAhB;;IAEA,IAAIT,UAAJ,EAAgB;MACdgB,8DAAmB,CAACN,SAAD,EAAYV,UAAZ,CAAnB;IACD,CA9ByD,CAgC1D;;;IACAiB,wDAAa,CAACP,SAAD,EAAYxX,GAAZ,CAAb;IAEA,OAAOwX,SAAP;EACD;;EACD,SAASR,cAAT,CAAwBhX,GAAxB,EAA6B1C,GAA7B,EAAkC;IAChC,IAAM6Z,YAAY,GAAGR,aAAa,CAAC1D,GAAd,CAAkBjT,GAAlB,CAArB;;IACA,IAAImX,YAAY,IAAIA,YAAY,CAAC7Z,GAAD,CAAhC,EAAuC;MACrC,OAAO6Z,YAAY,CAAC7Z,GAAD,CAAnB;IACD;;IACD,OAAO,IAAP,CALgC,CAKnB;EACd;AACF;AAAA;;;;;;;;;;;;;;;;;;;AChID;AACA;AAEA,IAAM0a,QAAQ,GAAG,CAAjB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM9M,IAAI,GAAGb,WAAW,EAAxB;AAEA,SAASA,WAAT,GAA2D;EAAA,IAAtC3B,OAAsC,uEAA5B,IAA4B;;EAAA,+EAAJ,EAAI;EAAA,IAArBI,OAAqB,QAArBA,OAAqB;EAAA,IAAZwB,IAAY,QAAZA,IAAY;;EAChE,OAAO,UAAShN,GAAT,EAAcG,QAAd,EAAwB2D,IAAxB,EAA4C;IAAA,IAAd/D,OAAc,uEAAJ,EAAI;;IACjD,IAAI;MACF,IAAI4a,CAAJ;MACA,IAAIjL,MAAM,GAAG3P,OAAO,CAAC2P,MAAR,KAAmB5L,IAAI,GAAG,MAAH,GAAY,KAAnC,CAAb;MACA,IAAI8W,MAAM,GAAG/X,QAAQ,CAACsX,aAAT,CAAuB,GAAvB,CAAb;MACAS,MAAM,CAACC,IAAP,GAAc7a,GAAd;MAEA,IAAI2Z,SAAS,GAAG,0EAAOxZ,QAAP,MAAoB,QAApB,IAAgCA,QAAQ,KAAK,IAA7C,GAAoDA,QAApD,GAA+D;QAC7E4V,OAAO,EAAE,mBAAW;UAClB7T,qDAAU,CAAC,aAAD,CAAV;QACD,CAH4E;QAI7EG,KAAK,EAAE,eAASyL,CAAT,EAAY;UACjBnN,mDAAQ,CAAC,WAAD,EAAc,IAAd,EAAoBmN,CAApB,CAAR;QACD;MAN4E,CAA/E;;MASA,IAAI,OAAO3N,QAAP,KAAoB,UAAxB,EAAoC;QAClCwZ,SAAS,CAAC5D,OAAV,GAAoB5V,QAApB;MACD;;MAEDwa,CAAC,GAAG,IAAIG,MAAM,CAACC,cAAX,EAAJ;;MAEAJ,CAAC,CAACL,kBAAF,GAAuB,YAAY;QACjC,IAAIK,CAAC,CAACN,UAAF,KAAiBK,QAArB,EAA+B;UAC7B,IAAI,OAAO1N,IAAP,KAAgB,UAApB,EAAgC;YAC9BA,IAAI,CAAC4N,MAAM,CAACI,MAAR,CAAJ;UACD;;UACD,IAAInI,MAAM,GAAG8H,CAAC,CAAC9H,MAAf;;UACA,IAAKA,MAAM,IAAI,GAAV,IAAiBA,MAAM,GAAG,GAA3B,IAAmCA,MAAM,KAAK,GAAlD,EAAuD;YACrD8G,SAAS,CAAC5D,OAAV,CAAkB4E,CAAC,CAACM,YAApB,EAAkCN,CAAlC;UACD,CAFD,MAEO;YACLhB,SAAS,CAACtX,KAAV,CAAgBsY,CAAC,CAACO,UAAlB,EAA8BP,CAA9B;UACD;QACF;MACF,CAZD,CArBE,CAmCF;;;MACA,IAAI,CAAC1a,wDAAA,CAAiB,oBAAjB,CAAL,EAA6C;QAC3C0a,CAAC,CAACQ,SAAF,GAAc,YAAY;UACxBxa,mDAAQ,CAAC,sBAAD,EAAyBga,CAAC,CAACvP,OAA3B,EAAoC,IAApC,CAAR;QACD,CAFD;MAGD;;MAED,IAAIsE,MAAM,KAAK,KAAX,IAAoB5L,IAAxB,EAA8B;QAC5B,IAAIsX,OAAO,GAAGC,mDAAQ,CAACrb,GAAD,EAAMD,OAAN,CAAtB;QACA0G,MAAM,CAACC,MAAP,CAAc0U,OAAO,CAACE,MAAtB,EAA8BxX,IAA9B;QACA9D,GAAG,GAAGub,mDAAQ,CAACH,OAAD,CAAd;MACD;;MAEDT,CAAC,CAACa,IAAF,CAAO9L,MAAP,EAAe1P,GAAf,EAAoB,IAApB,EAhDE,CAiDF;MACA;;MACA,IAAI,CAACC,wDAAA,CAAiB,oBAAjB,CAAL,EAA6C;QAC3C0a,CAAC,CAACvP,OAAF,GAAYA,OAAZ;MACD;;MAED,IAAIrL,OAAO,CAACiW,eAAZ,EAA6B;QAC3B2E,CAAC,CAAC3E,eAAF,GAAoB,IAApB;MACD;;MACD7G,gDAAK,CAACpP,OAAO,CAAC0b,aAAT,EAAwB,UAACC,KAAD,EAAQC,MAAR,EAAmB;QAC9ChB,CAAC,CAACiB,gBAAF,CAAmBD,MAAnB,EAA2BD,KAA3B;MACD,CAFI,CAAL;;MAGA,IAAI3b,OAAO,CAAC8b,SAAZ,EAAuB;QACrBlB,CAAC,CAACiB,gBAAF,CAAmB,kBAAnB,EAAuC,gBAAvC;MACD;;MACDjB,CAAC,CAACiB,gBAAF,CAAmB,cAAnB,EAAmC7b,OAAO,CAACkW,WAAR,IAAuB,YAA1D;;MAEA,IAAI,OAAOzK,OAAP,KAAmB,UAAvB,EAAmC;QACjCA,OAAO,CAACoP,MAAM,CAACI,MAAR,CAAP;MACD;;MAED,IAAItL,MAAM,KAAK,MAAX,IAAqB5L,IAAzB,EAA+B;QAC7B6W,CAAC,CAACmB,IAAF,CAAOhY,IAAP;MACD,CAFD,MAEO;QACL6W,CAAC,CAACmB,IAAF;MACD;IACF,CA3ED,CA2EE,OAAOzZ,KAAP,EAAc;MACd1B,mDAAQ,CAAC,kBAAD,EAAqB0B,KAArB,CAAR;MACA,0EAAOlC,QAAP,MAAoB,QAApB,IAAgCA,QAAQ,KAAK,IAA7C,IAAqDA,QAAQ,CAACkC,KAAT,CAAeA,KAAf,CAArD;IACD;EACF,CAhFD;AAiFD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAQ0Z,SAAR,GAAsBjF,4DAAtB;AAEO,IAAMkF,eAAe,GAAG,SAAxB;AACA,IAAMC,mBAAmB,GAAG,YAA5B;AACA,IAAMC,iBAAiB,GAAG,WAA1B,EAEP;;AACAlY,0CAAA,CAAUR,kEAAV,EAA2C,UAAUf,GAAV,EAAe;EACxD0Z,UAAU,CAAC1Z,GAAD,CAAV;AACD,CAFD;AAIA,IAAM2Z,uBAAuB,GAAG,CAAhC;AACA,IAAMC,mBAAmB,GAAG,EAA5B;AACA,IAAMC,UAAU,GAAG,EAAnB;AACA,IAAMC,WAAW,GAAG,EAApB;AAEA;AACA;AACA;;AACO,SAASC,iBAAT,GAA6B;EAClCD,WAAW,CAACpa,MAAZ,GAAqB,CAArB;EACA,CAACka,mBAAD,EAAsBC,UAAtB,EAAkCnU,OAAlC,CAA0C,UAACsU,EAAD;IAAA,OAAQhW,MAAM,CAAC0J,IAAP,CAAYsM,EAAZ,EAAgBtU,OAAhB,CAAwB,UAACuU,CAAD,EAAO;MAAE,OAAOD,EAAE,CAACC,CAAD,CAAT;IAAc,CAA/C,CAAR;EAAA,CAA1C;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASC,UAAT,OAA6G;EAAA,IAAxF7Z,OAAwF,QAAxFA,OAAwF;EAAA,IAA/E8Z,WAA+E,QAA/EA,WAA+E;EAAA,IAAlEzc,QAAkE,QAAlEA,QAAkE;EAAA,IAAxD0J,SAAwD,QAAxDA,SAAwD;EAAA,IAA7Cf,MAA6C,QAA7CA,MAA6C;EAAA,IAArC7C,SAAqC,QAArCA,SAAqC;EAAA,IAA1B6D,cAA0B,QAA1BA,cAA0B;EAAA,IAAV1D,OAAU,QAAVA,OAAU;EAClHA,OAAO,GAAG4D,iEAAU,CAAC5D,OAAD,CAApB;EACA,IAAIyW,QAAQ,GAAG/Z,OAAf;EACA,IAAIga,OAAO,GAAGhU,MAAd;EACA,IAAIiU,YAAY,GAAGH,WAAnB;EACA,IAAII,eAAe,GAAG,EAAtB;EACA,IAAIC,aAAa,GAAG,EAApB;EACA,IAAIC,OAAO,GAAG,EAAd;;EACA,IAAIC,aAAJ;;EACA,IAAIC,WAAJ;;EACA,IAAIC,UAAU,GAAGpX,SAAS,IAAIiF,uDAAY,EAA1C;;EACA,IAAIoS,cAAJ;;EACA,IAAIC,SAAS,GAAGpd,QAAhB;;EACA,IAAIqd,MAAJ;;EACA,IAAIC,QAAQ,GAAG5T,SAAf;EACA,IAAI6T,YAAY,GAAG,EAAnB;;EACA,IAAIC,cAAc,GAAG,IAAI1U,GAAJ,EAArB;;EAEA,SAAS2U,cAAT,CAAwBC,cAAxB,EAAwC;IAAEb,eAAe,GAAGA,eAAe,CAACc,MAAhB,CAAuBD,cAAvB,CAAlB;EAA2D;;EACrG,SAASE,cAAT,CAAwBC,YAAxB,EAAsC;IAAEf,aAAa,GAAGA,aAAa,CAACa,MAAd,CAAqBE,YAArB,CAAhB;EAAqD;;EAC7F,SAASC,QAAT,CAAkBC,KAAlB,EAAyB;IAAEhB,OAAO,GAAGA,OAAO,CAACY,MAAR,CAAeI,KAAf,CAAV;EAAkC;;EAE7D,SAASC,aAAT,GAAyB;IACvB,OAAO;MACLlY,SAAS,EAAEoX,UADN;MAEL7P,SAAS,EAAE2P,aAFN;MAGLiB,UAAU,EAAEhB,WAHP;MAILiB,aAAa,EAAEf,cAJV;MAKLxa,OAAO,EAAE+Z,QALJ;MAMLD,WAAW,EAAEG,YANR;MAOLjU,MAAM,EAAEgU,OAPH;MAQLe,cAAc,EAAEb,eARX;MASLsB,MAAM,EAAEpB,OATH;MAULc,YAAY,EAAEf,aAVT;MAWLsB,WAAW,EAAEb,YAXR;MAYLtS,OAAO,EAAEqS,QAZJ;MAaLrX,OAAO,EAAEA;IAbJ,CAAP;EAeD;;EAED,SAASoY,iBAAT,GAA6B;IAC3B,IAAMC,QAAQ,GAAG,IAAjB;IACA,IAAMC,eAAe,GAAGC,eAAe,CAACld,IAAhB,CAAqB,IAArB,EAA2Bgd,QAA3B,CAAxB;IACA,IAAIG,KAAK,GAAGC,UAAU,CAACH,eAAD,EAAkBjB,QAAlB,CAAtB;IACAD,MAAM,GAAGoB,KAAT;EACD;;EAED,SAASD,eAAT,CAAyBF,QAAzB,EAAmCK,UAAnC,EAA+C;IAC7C;IACA,IAAIA,UAAJ,EAAgB;MACdC,YAAY,CAACvB,MAAD,CAAZ;IACD;;IAED,IAAIJ,WAAW,KAAK1R,SAApB,EAA+B;MAC7B,IAAIoE,eAAe,GAAG,EAAtB;;MACA,IAAI2O,QAAJ,EAAc;QACZvc,qDAAU,mBAAYmb,UAAZ,eAAV;QACAvN,eAAe,GAAGkP,eAAe,CAAChC,eAAD,EAAkBW,cAAlB,CAAjC;;QACA,IAAI7N,eAAe,CAAC3N,MAApB,EAA4B;UAC1B6B,4CAAA,CAAYR,+DAAZ,EAA0CsM,eAA1C;QACD;MACF;;MAEDwN,cAAc,GAAGpB,iBAAjB;MACAkB,WAAW,GAAG6B,IAAI,CAACC,GAAL,EAAd;MACA9Y,OAAO,CAACkL,UAAR,CAAmB,YAAnB;MACAlL,OAAO,CAAC+Y,WAAR,CAAoB,aAApB,EAAmC,YAAnC,EAAiD,mBAAjD;MACA/Y,OAAO,CAAC+Y,WAAR,CAAoB,UAApB,EAAgC,YAAhC,EAA8C,sBAA9C;MAEAnb,4CAAA,CAAYR,+DAAZ,EAA0C2a,aAAa,EAAvD;MACAiB,gBAAgB,CAACvC,QAAD,EAAW,YAAY;QACrC,IAAI;UACF,IAAIU,SAAS,IAAI,IAAjB,EAAuB;YACrB,IAAMX,aAAW,GAAGG,YAApB;;YACA,IAAMxW,IAAI,GAAG0W,aAAa,CACvBzW,MADU,CACH/E,gDAAA,CAAU4d,oDAAV,EAAyB,IAAzB,EAA+BzC,aAA/B,CADG,EAEVvW,MAFU,CAEHiZ,gBAFG,EAEe,EAFf,CAAb;;YAGA/B,SAAS,CAACpc,KAAV,OAAmC,CAACoF,IAAD,EAAOkY,QAAP,EAAiBpB,UAAjB,CAAnC;;YACAE,SAAS,GAAG,IAAZ;UACD;QACF,CATD,CASE,OAAOzP,CAAP,EAAU;UACVnN,mDAAQ,CAAC,iCAAD,EAAoC,IAApC,EAA0CmN,CAA1C,CAAR;QACD,CAXD,SAWU;UACR;UACA,IAAIgC,eAAe,CAAC3N,MAApB,EAA4B;YAC1BoD,8EAAA,CAAmCzC,OAAnC,EAA4CgN,eAA5C,EAA6D2N,QAA7D;UACD,CAJO,CAKR;;;UACA,IAAI8B,cAAc,GAAGtf,wDAAA,CAAiB,UAAjB,KAAgC,EAArD;;UACA,IAAI,CAACsf,cAAc,CAACC,cAApB,EAAoC;YAClC;YACAzD,SAAS,CAACwD,cAAc,CAACE,SAAhB,CAAT;UACD;QACF;MACF,CAxBe,CAAhB;IAyBD;EACF;;EAED,SAASC,WAAT,GAAuB;IACrBzf,0DAAA,GADqB,CAErB;;IACA2P,kDAAO,8CAAuCyN,UAAvC,GAAqDJ,aAArD,CAAP;IACAK,cAAc,GAAGpB,iBAAjB;IACAyC,eAAe,CAAC,KAAD,EAAQ,IAAR,CAAf;EACD;;EAED,SAAStS,gBAAT,CAA0BjI,UAA1B,EAAsC;IACpCuZ,cAAc,CAACtU,GAAf,CAAmBjF,UAAnB;EACD;;EAED,SAASe,QAAT,GAAoB;IAClBmY,cAAc,GAAGtB,eAAjB;IACAmB,aAAa,GAAG8B,IAAI,CAACC,GAAL,EAAhB;IAEA,IAAI3U,WAAW,GAAGnE,OAAO,CAACmL,WAAR,CAAoB,0BAApB,EAChB;MAAA,OAAMhM,0EAAA,CAA+BsX,QAA/B,EAAyCM,aAAzC,EAAwDE,UAAxD,EAAoEI,QAApE,EAA8EX,OAA9E,EAAuFhT,cAAvF,EAAuG1D,OAAvG,CAAN;IAAA,CADgB,CAAlB;IAEAwJ,kDAAO,+CAAwCyN,UAAxC,GAAsD9S,WAAtD,CAAP;IAEAnE,OAAO,CAACkL,UAAR,CAAmB,UAAnB;;IAEA,IAAI/G,WAAW,CAACpI,MAAZ,GAAqB,CAAzB,EAA4B;MAC1Bf,kDAAO,CAAC,4CAAD,CAAP;MACAse,WAAW;IACZ,CAHD,MAGO;MACLC,iBAAiB,CAAC/e,IAAlB,CAAuB;QACrBgf,QAAQ,EAAEC,yBADW;QAErBC,OAAO,EAAE;MAFY,CAAvB,EAGGvV,WAHH;IAID;EACF;EAED;AACF;AACA;AACA;;;EACE,SAASsV,yBAAT,CAAmCtV,WAAnC,EAAgD;IAAA;;IAC9CA,WAAW,CAACpC,OAAZ,CAAoB,UAAA0D,UAAU,EAAI;MAChC+R,cAAc,CAAC/R,UAAD,CAAd;IACD,CAFD;IAIA,IAAI4I,QAAQ,GAAG,EAAf;IACA,IAAI7T,IAAI,GAAG;MACT2J,WAAW,EAAXA,WADS;MAETwV,GAAG,EAAE,eAAM;QACTvB,iBAAiB;QAEjBlB,cAAc,GAAGrB,mBAAjB;QAEAjY,4CAAA,CAAYR,gEAAZ,EAA2C2a,aAAa,EAAxD;QAEA,IAAIxE,SAAS,GAAGqG,gBAAgB,CAACN,WAAD,EAAc,KAAd,CAAhC;QACAna,mEAAA,CAAwBsX,QAAxB,EAAkCtS,WAAlC,EAA+CoP,SAAS,CAAC1N,cAAzD,EAAyE0N,SAAS,CAAC9L,WAAnF,EAAgG;UAC9FrC,OAD8F,mBACtFyU,MADsF,EAC9EjF,MAD8E,EACtE;YACtBkF,SAAS,CAAC7D,mBAAD,EAAsBrB,MAAtB,CAAT;YACAkF,SAAS,CAACzL,QAAD,EAAWwL,MAAX,CAAT;;YAEA,IAAI,CAAC3D,UAAU,CAAC2D,MAAD,CAAf,EAAyB;cACvB3D,UAAU,CAAC2D,MAAD,CAAV,GAAqB;gBACnBE,GAAG,EAAE,IADc;gBAEnBnF,MAAM,EAANA;cAFmB,CAArB;YAID;;YACD,IAAIvG,QAAQ,CAACwL,MAAD,CAAR,GAAmB,CAAvB,EAA0B;cACxB3D,UAAU,CAAC2D,MAAD,CAAV,CAAmBE,GAAnB,GAAyB,KAAzB;YACD;UACF,CAd6F;UAe9FnT,IAf8F,gBAezFgO,MAfyF,EAejF;YACXqB,mBAAmB,CAACrB,MAAD,CAAnB;;YACA,IAAIuB,WAAW,CAAC,CAAD,CAAf,EAAoB;cAClB,IAAI6D,sBAAsB,CAAC7D,WAAW,CAAC,CAAD,CAAZ,CAA1B,EAA4C;gBAC1CA,WAAW,CAACna,KAAZ;cACD;YACF;UACF;QAtB6F,CAAhG,EAuBGqb,QAvBH,EAuBapR,gBAvBb,EAuB+BvC,cAvB/B;MAwBD;IAlCQ,CAAX;;IAqCA,IAAI,CAACsW,sBAAsB,CAACxf,IAAD,CAA3B,EAAmC;MACjCQ,kDAAO,CAAC,mDAAD,CAAP;MACAmb,WAAW,CAAC9b,IAAZ,CAAiBG,IAAjB;IACD;;IAED,SAASwf,sBAAT,CAAgCxf,IAAhC,EAAsC;MACpC,IAAIyf,WAAW,GAAG,IAAlB;MAEA,IAAIC,WAAW,GAAGrgB,wDAAA,CAAiB,sBAAjB,KAA4Cmc,uBAA9D;MAEAxb,IAAI,CAAC2J,WAAL,CAAiBgW,IAAjB,CAAsB,UAAA1U,UAAU,EAAI;QAClC,IAAI4I,QAAQ,GAAG,CAAf;QACA,IAAIwL,MAAM,GAAI,OAAOpU,UAAU,CAAC1F,GAAlB,KAA0B,WAA1B,IAAyC0F,UAAU,CAAC1F,GAAX,KAAmB3C,oDAA7D,GAAkF,KAAlF,GACTqI,UAAU,CAACzH,UADf,CAFkC,CAIlC;;QACA,IAAIkY,UAAU,CAAC2D,MAAD,CAAd,EAAwB;UACtB,IAAI3D,UAAU,CAAC2D,MAAD,CAAV,CAAmBE,GAAnB,KAA2B,KAA/B,EAAsC;YACpC;YACA;YACA;YACA1L,QAAQ,GAAG+L,IAAI,CAACC,GAAL,CAAS5U,UAAU,CAACtF,IAAX,CAAgBpE,MAAzB,EAAiCme,WAAjC,CAAX;UACD;;UACD,IAAIjE,mBAAmB,CAACC,UAAU,CAAC2D,MAAD,CAAV,CAAmBjF,MAApB,CAAnB,GAAiDvG,QAAjD,GAA4D6L,WAAhE,EAA6E;YAC3ED,WAAW,GAAG,KAAd;UACD;QACF,CAfiC,CAgBlC;;;QACA,OAAO,CAACA,WAAR;MACD,CAlBD;;MAoBA,IAAIA,WAAJ,EAAiB;QACfzf,IAAI,CAACmf,GAAL;MACD;;MAED,OAAOM,WAAP;IACD;;IAED,SAASH,SAAT,CAAmBQ,GAAnB,EAAwBC,IAAxB,EAA8B;MAC5B,IAAI,OAAOD,GAAG,CAACC,IAAD,CAAV,KAAqB,WAAzB,EAAsC;QACpCD,GAAG,CAACC,IAAD,CAAH,GAAY,CAAZ;MACD,CAFD,MAEO;QACLD,GAAG,CAACC,IAAD,CAAH;MACD;IACF;EACF;;EAED,SAASC,aAAT,CAAuBC,UAAvB,EAAmC;IACjCnD,YAAY,GAAGA,YAAY,CAACI,MAAb,CAAoB+C,UAApB,CAAf;IACAtb,2EAAA,CAAgCsb,UAAU,CAAC7N,WAAX,IAA0B6N,UAAU,CAAChc,MAArE,EAA6Egc,UAA7E,EAAyF/d,OAAzF;EACD;;EAED,SAASge,eAAT,CAAyBre,GAAzB,EAA8B;IAC5B8C,iFAAA,CAAsC9C,GAAG,CAACuQ,WAAJ,IAAmBvQ,GAAG,CAACoC,MAA7D,EAAqEpC,GAArE;EACD;;EAED,OAAO;IACLsb,cAAc,EAAdA,cADK;IAELE,QAAQ,EAARA,QAFK;IAGLU,eAAe,EAAfA,eAHK;IAILxZ,QAAQ,EAARA,QAJK;IAKLyb,aAAa,EAAbA,aALK;IAMLE,eAAe,EAAfA,eANK;IAOLC,cAAc,EAAE;MAAA,OAAMrD,YAAN;IAAA,CAPX;IAQLsD,eAAe,EAAE;MAAA,OAAM7D,aAAN;IAAA,CARZ;IASL8D,UAAU,EAAE;MAAA,OAAMxD,QAAN;IAAA,CATP;IAULyD,YAAY,EAAE;MAAA,OAAM7D,UAAN;IAAA,CAVT;IAWL8D,gBAAgB,EAAE;MAAA,OAAM7D,cAAN;IAAA,CAXb;IAYL8D,UAAU,EAAE;MAAA,OAAMvE,QAAN;IAAA,CAZP;IAaLwE,cAAc,EAAE;MAAA,OAAMtE,YAAN;IAAA,CAbX;IAcLuE,cAAc,EAAE;MAAA,OAAMtE,eAAN;IAAA,CAdX;IAeLuE,eAAe,EAAE;MAAA,OAAMtE,aAAN;IAAA,CAfZ;IAgBLuE,SAAS,EAAE;MAAA,OAAMtE,OAAN;IAAA,CAhBN;IAiBLuE,MAAM,EAAE;MAAA,OAAM3X,cAAN;IAAA,CAjBH;IAkBL4X,UAAU,EAAE;MAAA,OAAMtb,OAAN;IAAA;EAlBP,CAAP;AAoBD;;AAEM,IAAM6F,eAAc,GAAGxE,8CAAI,CAAC,MAAD,EAAS,UAASpH,UAAT,EAAqBoC,GAArB,EAA0B;EACnE,KAAKmd,QAAL,CAAchf,IAAd,CAAmB,IAAnB,EAAyBP,UAAzB,EAAqCoC,GAArC;AACD,CAFiC,EAE/B,gBAF+B,CAA3B;;;AAIA,IAAMkd,iBAAiB,GAAGlY,8CAAI,CAAC,MAAD,EAAS,UAASoW,cAAT,EAAyB;EACrE,KAAK+B,QAAL,CAAchf,IAAd,CAAmB,KAAKkf,OAAxB,EAAiCjC,cAAjC;AACD,CAFoC,EAElC,mBAFkC,CAA9B;AAIA,IAAMuB,gBAAgB,GAAG3X,8CAAI,CAAC,OAAD,EAAU,UAAU3E,OAAV,EAAmB3C,QAAnB,EAA6B;EACzE,IAAIA,QAAJ,EAAc;IACZA,QAAQ;EACT;AACF,CAJmC,EAIjC,kBAJiC,CAA7B;AAMA,SAAS6f,gBAAT,CAA0BN,WAA1B,EAAuCiC,eAAvC,EAA6F;EAAA,gFAAJ,EAAI;EAAA,wBAApC/U,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,oEAA4B;;EAClG,IAAIyJ,oBAAoB,GAAG,CAA3B;EACA,IAAIC,oBAAoB,GAAG,KAA3B;EACA,IAAIC,kBAAkB,GAAG,IAAI7Y,GAAJ,EAAzB;EACA,IAAI8Y,cAAc,GAAG,EAArB;EACA,IAAMC,KAAK,GAAG,EAAd;;EAEA,SAASC,OAAT,CAAiBlP,SAAjB,EAA4BzM,MAA5B,EAAoC;IAClC,IAAI0b,KAAK,CAACjP,SAAD,CAAL,IAAoB,IAAxB,EAA8B;MAC5BiP,KAAK,CAACjP,SAAD,CAAL,GAAmBmP,oEAAA,EAAnB;IACD;;IACDF,KAAK,CAACjP,SAAD,CAAL,GAAmBiP,KAAK,CAACjP,SAAD,CAAL,CAAiBoP,IAAjB,CAAsB;MAAA,OAAMD,oEAAA,CAAsB5b,MAAtB,EAA8B8b,KAA9B,CAAoC,YAAM,CAAE,CAA5C,CAAN;IAAA,CAAtB,CAAnB;EACD;;EAED,SAASC,KAAT,CAAezX,aAAf,EAA8B9I,EAA9B,EAAkC;IAChC,IAAIsJ,OAAO,GAAGR,aAAa,CAACQ,OAA5B;;IACA,IAAIA,OAAO,IAAI,IAAX,IAAmBA,OAAO,GAAGuW,eAAe,CAACV,UAAhB,EAAjC,EAA+D;MAC7D7V,OAAO,GAAGuW,eAAe,CAACV,UAAhB,EAAV;IACD;;IACD,IAAMqB,aAAa,GAAGX,eAAe,CAACX,eAAhB,KAAoC5V,OAApC,GAA8C6T,IAAI,CAACC,GAAL,EAApE;IACA,IAAMqD,IAAI,GAAGP,KAAK,CAACpX,aAAa,CAAC1E,eAAf,CAAlB;IACA,IAAMsc,UAAU,GAAGR,KAAK,CAAC,EAAD,CAAxB,CAPgC,CAOF;;IAC9B,IAAI,CAACO,IAAI,IAAI,IAAR,IAAgBC,UAAU,IAAI,IAA/B,KAAwCF,aAAa,GAAG,CAA5D,EAA+D;MAC7DJ,iEAAA,CAAmB,CACjBA,oEAAA,CAAsBI,aAAtB,CADiB,EAEjBJ,oEAAA,CAAsBM,UAAtB,EAAkCL,IAAlC,CAAuC;QAAA,OAAMI,IAAN;MAAA,CAAvC,CAFiB,CAAnB,EAGGJ,IAHH,CAGQrgB,EAHR;IAID,CALD,MAKO;MACLA,EAAE;IACH;EACF;;EAED,SAAS2gB,aAAT,GAAyB;IACvBb,oBAAoB;;IACpB,IAAIC,oBAAoB,IAAID,oBAAoB,KAAK,CAArD,EAAwD;MACtDlC,WAAW;IACZ;EACF;;EAED,SAASgD,iBAAT,CAA2BriB,UAA3B,EAAuCoC,GAAvC,EAA4C;IAC1Csf,cAAc,CAACtf,GAAG,CAACsQ,SAAL,CAAd,GAAgC,IAAhC;IAEA6O,oBAAoB;IACpB,IAAI3b,SAAS,GAAG0b,eAAe,CAACT,YAAhB,EAAhB;IAEA,IAAIyB,WAAW,GAAGC,wBAAwB,CAAC;MAACviB,UAAU,EAAVA,UAAD;MAAaoC,GAAG,EAAHA,GAAb;MAAkBwD,SAAS,EAATA;IAAlB,CAAD,CAA1C;;IAEA,IAAI0c,WAAW,CAAC1J,SAAZ,KAA0B,OAA9B,EAAuC;MACrC4J,cAAc,CAAClB,eAAD,EAAkBgB,WAAlB,EAA+BF,aAA/B,CAAd;IACD,CAFD,MAEO;MACLK,eAAe,CAACnB,eAAD,EAAkBgB,WAAlB,CAAf;MACAF,aAAa;IACd;EACF;;EAED,SAAS5U,YAAT,GAAuB;IACrB,IAAIjD,aAAa,GAAG,IAApB;IACA,IAAIiT,cAAc,GAAG8D,eAAe,CAACL,cAAhB,EAArB;IACA,IAAMyB,oBAAoB,GAAG9iB,wDAAA,CAAiB,gBAAjB,CAA7B;IAEA6hB,kBAAkB,CAACzY,GAAnB,CAAuBuB,aAAvB;;IAEA,IAAImY,oBAAoB,IAAI,CAACC,kDAAO,CAACD,oBAAD,CAApC,EAA4D;MAC1D,IAAME,gBAAgB,GAAGF,oBAAoB,CAACE,gBAA9C;;MACA,IAAIA,gBAAgB,IAAI,CAACpF,cAAc,CAAC9E,KAAf,CAAqB,UAAAlU,MAAM;QAAA,OAAI4I,uDAAQ,CAACwV,gBAAD,EAAmBpe,MAAM,CAACT,UAA1B,CAAZ;MAAA,CAA3B,CAAzB,EAAwG;QACtGyZ,cAAc,GAAGA,cAAc,CAACrX,MAAf,CAAsB,UAAAgF,OAAO;UAAA,OAAI,CAACiC,uDAAQ,CAACwV,gBAAD,EAAmBzX,OAAO,CAACpH,UAA3B,CAAb;QAAA,CAA7B,CAAjB;MACD;IACF;;IAEDyd,oBAAoB,GAAGhE,cAAc,CAAC9E,KAAf,CAAqB,UAAAnO,aAAa;MAAA,OAAIkX,kBAAkB,CAACha,GAAnB,CAAuB8C,aAAvB,CAAJ;IAAA,CAAlC,CAAvB;IAEAA,aAAa,CAACrE,IAAd,CAAmB4B,OAAnB,CAA2B,UAAA1F,GAAG,EAAI;MAChC,IAAI,CAACsf,cAAc,CAACtf,GAAG,CAACuE,KAAL,CAAnB,EAAgC;QAC9B2a,eAAe,CAAC1D,QAAhB,CAAyBxb,GAAzB;QACAuB,4CAAA,CAAYR,0DAAZ,EAAqCf,GAArC;MACD;IACF,CALD;;IAOA,IAAIof,oBAAoB,IAAID,oBAAoB,KAAK,CAArD,EAAwD;MACtDlC,WAAW;IACZ;EACF;;EAED,OAAO;IACLzT,cAAc,EAAE,wBAAUlJ,MAAV,EAAkBN,GAAlB,EAAuB;MACrC,IAAMmI,aAAa,GAAGgC,KAAK,CAACsW,gBAAN,CAAuBzgB,GAAvB,CAAtB;MACAwf,OAAO,CAAErX,aAAa,IAAIA,aAAa,CAAC1E,eAAhC,IAAoD,EAArD,EAAyD+F,eAAc,CAACrL,IAAf,CAAoB;QAClFgf,QAAQ,EAAE8C;MADwE,CAApB,EAE7D3f,MAF6D,EAErDN,GAFqD,CAAzD,CAAP;IAGD,CANI;IAOLoL,WAAW,EAAE,uBAAY;MACvBwU,KAAK,CAAC,IAAD,EAAOxU,YAAW,CAACpM,IAAZ,CAAiB,IAAjB,CAAP,CAAL;IACD;EATI,CAAP;AAWD;AAEM,SAAS0hB,qBAAT,CAA+BxB,eAA/B,EAAgDgB,WAAhD,EAA6D;EAClE,IAAIA,WAAW,CAACS,aAAZ,GAA4BzB,eAAe,CAACV,UAAhB,KAA+BhhB,wDAAA,CAAiB,eAAjB,CAA/D,EAAkG;IAChG0hB,eAAe,CAAChD,eAAhB,CAAgC,IAAhC;EACD;AACF,EAED;;AACO,SAASmE,eAAT,CAAyBnB,eAAzB,EAA0CgB,WAA1C,EAAuD;EAC5DU,iBAAiB,CAACV,WAAD,CAAjB;EAEA,IAAMvc,OAAO,GAAG4D,iEAAU,CAAC2Y,WAAW,CAACvc,OAAb,CAA1B;EACAA,OAAO,CAACkd,SAAR,CAAkB,gBAAlB,EAAoC,sBAApC;EAEAtf,4CAAA,CAAYR,gEAAZ,EAA2Cmf,WAA3C;EACAhB,eAAe,CAAC5D,cAAhB,CAA+B4E,WAA/B;EAEAQ,qBAAqB,CAACxB,eAAD,EAAkBgB,WAAlB,CAArB;AACD,EAED;;AACA,SAASE,cAAT,CAAwBlB,eAAxB,EAAyCgB,WAAzC,EAAsDF,aAAtD,EAA0G;EAAA,gFAAJ,EAAI;EAAA,wBAApC7V,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,oEAA4B;;EACxG,IAAIrD,MAAM,GAAG,IAAb;EAEA,IAAMyO,cAAc,GAAGpgB,sDAAU,CAC/ByJ,KAAK,CAAC4L,aAAN,CAAoB;IAClBzF,SAAS,EAAE4P,WAAW,CAACa,iBAAZ,IAAiCb,WAAW,CAAC5P,SADtC;IAElBjM,aAAa,EAAE6b,WAAW,CAAC7b;EAFT,CAApB,CAD+B,EAI3B,OAJ2B,CAAjC;EAKA,IAAMgZ,OAAO,GAAGyD,cAAc,IAAIpgB,sDAAU,CAACogB,cAAD,EAAiB,SAAjB,CAA5C;EACA,IAAME,WAAW,GAAGF,cAAc,IAAIpgB,sDAAU,CAACogB,cAAD,EAAiB,aAAjB,CAAhD;;EAEA,IAAItjB,wDAAA,CAAiB,WAAjB,MAAkCwjB,WAAW,IAAI3D,OAAO,KAAK4D,iDAA7D,CAAJ,EAA6E;IAC3E,IAAI,CAACf,WAAW,CAACgB,aAAb,IAA8B1jB,wDAAA,CAAiB,4BAAjB,CAAlC,EAAkF;MAChF6U,MAAM,GAAG,KAAT;MACA8O,eAAe,CAACjC,eAAD,EAAkBgB,WAAlB,EAA+BF,aAA/B,EAA8Cc,cAA9C,CAAf;IACD,CAHD,MAGO,IAAI,CAACZ,WAAW,CAACkB,OAAjB,EAA0B;MAC/BljB,mDAAQ,CAAC,gEAAD,CAAR;MACAmU,MAAM,GAAG,KAAT;IACD;EACF;;EACD,IAAIA,MAAJ,EAAY;IACVgO,eAAe,CAACnB,eAAD,EAAkBgB,WAAlB,CAAf;IACAF,aAAa;EACd;AACF;;AAED,IAAMqB,YAAY,GAAG,SAAfA,YAAe,CAACC,KAAD,EAAW;EAC9BC,sDAAK,CAACD,KAAK,CAAC3b,GAAN,CAAU,UAAAiH,KAAK;IAAA,OAAIA,KAAK,CAACsT,WAAV;EAAA,CAAf,CAAD,EAAwC,UAAUtgB,KAAV,EAAiB4hB,QAAjB,EAA2B;IACtEA,QAAQ,CAAC9b,OAAT,CAAiB,UAAC+b,OAAD,EAAUrX,CAAV,EAAgB;MAC/B,eAAwDkX,KAAK,CAAClX,CAAD,CAA7D;MAAA,IAAQ8U,eAAR,YAAQA,eAAR;MAAA,IAAyBgB,WAAzB,YAAyBA,WAAzB;MAAA,IAAsCF,aAAtC,YAAsCA,aAAtC;;MACA,IAAIpgB,KAAJ,EAAW;QACTjB,kDAAO,8CAAuCiB,KAAvC,oCAAP;QAEA8gB,qBAAqB,CAACxB,eAAD,EAAkBgB,WAAlB,CAArB;MACD,CAJD,MAIO;QACL,IAAIuB,OAAO,CAACC,IAAR,KAAiB,EAArB,EAAyB;UACvB/iB,kDAAO,2HAAP;UAEA+hB,qBAAqB,CAACxB,eAAD,EAAkBgB,WAAlB,CAArB;QACD,CAJD,MAIO;UACLA,WAAW,CAACgB,aAAZ,GAA4BO,OAAO,CAACC,IAApC;;UAEA,IAAI,CAACxB,WAAW,CAACkB,OAAjB,EAA0B;YACxBlB,WAAW,CAACkB,OAAZ,GAAsBO,4DAAW,CAACzB,WAAW,CAACgB,aAAb,CAAjC;UACD;;UACDb,eAAe,CAACnB,eAAD,EAAkBgB,WAAlB,CAAf;UACAF,aAAa;QACd;MACF;IACF,CArBD;EAsBD,CAvBI,CAAL;AAwBD,CAzBD;;AA2BA,IAAI4B,SAAJ,EAAeC,YAAf;AACArkB,wDAAA,CAAiB,OAAjB,EAA0B,UAACskB,WAAD,EAAiB;EACzCF,SAAS,GAAG,OAAOE,WAAW,CAACC,KAAZ,CAAkBH,SAAzB,KAAuC,QAAvC,IAAmDE,WAAW,CAACC,KAAZ,CAAkBH,SAAlB,GAA8B,CAAjF,GACRE,WAAW,CAACC,KAAZ,CAAkBH,SADV,GAER,CAFJ;EAGAC,YAAY,GAAG,OAAOC,WAAW,CAACC,KAAZ,CAAkBF,YAAzB,KAA0C,QAA1C,IAAsDC,WAAW,CAACC,KAAZ,CAAkBF,YAAlB,GAAiC,CAAvF,GACXC,WAAW,CAACC,KAAZ,CAAkBF,YADP,GAEX,CAFJ;AAGD,CAPD;AASO,IAAMG,aAAa,GAAG,SAAhBA,aAAgB,GAAgD;EAAA,IAA/CrZ,OAA+C,uEAArCyT,UAAqC;EAAA,IAAzB2F,KAAyB,uEAAjBV,YAAiB;EAC3E,IAAIY,OAAO,GAAG,CAAC,EAAD,CAAd;EACA,IAAIC,UAAU,GAAG,KAAjB;;EACA,IAAMC,SAAS,GAAG,SAAZA,SAAY,CAAAC,EAAE;IAAA,OAAIA,EAAE,EAAN;EAAA,CAApB;;EAEA,OAAO,UAASlD,eAAT,EAA0BgB,WAA1B,EAAuCF,aAAvC,EAAsD;IAC3D,IAAMqC,SAAS,GAAGR,YAAY,GAAG,CAAf,GAAmBlZ,OAAnB,GAA6BwZ,SAA/C;;IACA,IAAIF,OAAO,CAACA,OAAO,CAACviB,MAAR,GAAiB,CAAlB,CAAP,CAA4BA,MAA5B,IAAsCkiB,SAA1C,EAAqD;MACnDK,OAAO,CAACjkB,IAAR,CAAa,EAAb;IACD;;IAEDikB,OAAO,CAACA,OAAO,CAACviB,MAAR,GAAiB,CAAlB,CAAP,CAA4B1B,IAA5B,CAAiC;MAACkhB,eAAe,EAAfA,eAAD;MAAkBgB,WAAW,EAAXA,WAAlB;MAA+BF,aAAa,EAAbA;IAA/B,CAAjC;;IAEA,IAAI,CAACkC,UAAL,EAAiB;MACfA,UAAU,GAAG,IAAb;MACAG,SAAS,CAAC,YAAM;QACdJ,OAAO,CAACvc,OAAR,CAAgBqc,KAAhB;QACAE,OAAO,GAAG,CAAC,EAAD,CAAV;QACAC,UAAU,GAAG,KAAb;MACD,CAJQ,EAINL,YAJM,CAAT;IAKD;EACF,CAhBD;AAiBD,CAtBM;AAwBP,IAAMS,aAAa,GAAGN,aAAa,EAAnC;AAEO,IAAMb,eAAe,GAAGnc,8CAAI,CAAC,OAAD,EAAU,UAASka,eAAT,EAA0BgB,WAA1B,EAAuCF,aAAvC,EAAsDc,cAAtD,EAAsE;EACjHwB,aAAa,CAACpD,eAAD,EAAkBgB,WAAlB,EAA+BF,aAA/B,CAAb;AACD,CAFkC,EAEhC,iBAFgC,CAA5B,EAIP;AACA;;AACA,SAASG,wBAAT,QAAqG;EAAA,IAAlEviB,UAAkE,SAAlEA,UAAkE;EAAA,IAAtDoC,GAAsD,SAAtDA,GAAsD;EAAA,IAAjDwD,SAAiD,SAAjDA,SAAiD;;EAAA,gFAAJ,EAAI;EAAA,wBAApC2G,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,oEAA4B;;EACnG,IAAMvN,aAAa,GAAGgC,KAAK,CAACsW,gBAAN,CAAuBzgB,GAAvB,CAAtB;EACA,IAAM8K,KAAK,GAAI3C,aAAa,IAAIA,aAAa,CAAC2C,KAAhC,IAA0C9K,GAAG,CAACuiB,gBAA5D;EAEA,IAAIC,SAAS,GAAGxe,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,EAAuB;IACrCwD,SAAS,EAATA,SADqC;IAErCif,iBAAiB,EAAE1X,oDAAS,EAFS;IAGrCwX,gBAAgB,EAAEzX,KAHmB;IAIrC4F,GAAG,EAAEgS,UAAU,CAAC1iB,GAAG,CAAC0Q,GAAL,CAAV,IAAuB,CAJS;IAKrCtO,MAAM,EAAEpC,GAAG,CAAC2B,UALyB;IAMrC/D,UAAU,EAAVA;EANqC,CAAvB,CAAhB;EASA4kB,SAAS,CAAC7B,aAAV,GAA0B6B,SAAS,CAACC,iBAAV,GAA8BD,SAAS,CAACD,gBAAlE,CAbmG,CAenG;EACA;EACA;EACA;;EACAhhB,4CAAA,CAAYR,kEAAZ,EAA6CyhB,SAA7C,EAnBmG,CAqBnG;;EACA,IAAM/hB,cAAc,GAAG0J,KAAK,CAACwY,SAAN,CAAgBH,SAAhB,EAA2B1iB,QAAlD,CAtBmG,CAwBnG;;EACA,IAAM8iB,kBAAkB,GAAGJ,SAAS,CAAChM,SAArC;EACA,IAAMrS,UAAU,GAAGgG,KAAK,CAAC4L,aAAN,CAAoByM,SAApB,CAAnB;EACA,IAAMK,YAAY,GAAG1e,UAAU,IAAIA,UAAU,CAACye,kBAAD,CAA7C;EAEA,IAAIhiB,iBAAiB,GAAGiiB,YAAY,IAAIA,YAAY,CAAC/iB,QAArD;EAEA,IAAIA,QAAQ,GAAG,IAAf,CA/BmG,CAiCnG;;EACA,IAAIc,iBAAiB,IAAIA,iBAAiB,CAACrD,GAAvC,IAA8CqD,iBAAiB,CAACvC,MAAhE,IAA0E,EAAEuC,iBAAiB,CAACE,UAAlB,KAAiC,IAAjC,IAAyCd,GAAG,CAACF,QAA/C,CAA9E,EAAwI;IACtIA,QAAQ,GAAGc,iBAAX;EACD,CAFD,MAEO,IAAIH,cAAc,IAAIA,cAAc,CAAClD,GAAjC,IAAwCkD,cAAc,CAACpC,MAAvD,IAAiE,EAAEoC,cAAc,CAACK,UAAf,KAA8B,IAA9B,IAAsCd,GAAG,CAACF,QAA5C,CAArE,EAA4H;IACjIA,QAAQ,GAAGW,cAAX;EACD;;EAED,IAAIX,QAAJ,EAAc;IACZ;IACA0iB,SAAS,CAAC1iB,QAAV,GAAqBzC,2DAAA,CAAiB;MAAEE,GAAG,EAAEuC,QAAQ,CAACvC,GAAhB;MAAqBC,MAAM,EAAEsC,QAAQ,CAACxC;IAAtC,CAAjB,CAArB,CAFY,CAE2E;;IACvFklB,SAAS,CAAC1iB,QAAV,CAAmBV,SAAnB,CAA6BU,QAAQ,CAACzB,MAAtC;EACD,CA5CkG,CA8CnG;;;EACA,IAAMykB,oBAAoB,GAAGC,uBAAuB,CAAC/iB,GAAG,CAACwW,SAAL,EAAgBrS,UAAhB,EAA4B3G,wDAAA,CAAiB,2BAAjB,CAA5B,CAApD;EACA,IAAMwlB,eAAe,GAAGC,2EAAoB,CAC1CT,SAAS,CAAC9R,GADgC,EAEzC,2EAAOoS,oBAAP,MAAgC,QAAjC,GAA6CA,oBAA7C,GAAoEtlB,wDAAA,CAAiB,mBAAjB,CAF1B,EAG1CA,wDAAA,CAAiB,gCAAjB,CAH0C,CAA5C;EAKAglB,SAAS,CAACU,IAAV,GAAiBF,eAAe,CAACG,GAAjC;EACAX,SAAS,CAACY,IAAV,GAAiBJ,eAAe,CAACK,GAAjC;EACAb,SAAS,CAACc,IAAV,GAAiBN,eAAe,CAACO,IAAjC;EACAf,SAAS,CAACgB,IAAV,GAAiBR,eAAe,CAACS,IAAjC;EACAjB,SAAS,CAACkB,IAAV,GAAiBV,eAAe,CAACW,KAAjC;EACAnB,SAAS,CAACoB,IAAV,GAAiBZ,eAAe,CAACa,MAAjC;EAEA,OAAOrB,SAAP;AACD;;AAED,SAAS5B,iBAAT,CAA2B4B,SAA3B,EAAsC;EACpC,IAAIsB,SAAJ;EACA,IAAMC,QAAQ,GAAI3S,mEAAA,CAAmBoR,SAAS,CAAC7gB,UAA7B,EAAyC,kBAAzC,MAAiE,IAAlE,GAA0E6gB,SAAS,CAAC9R,GAAV,IAAiB,CAA3F,GAA+F8R,SAAS,CAAC9R,GAAV,GAAgB,CAAhI;;EACA,IAAI8R,SAAS,CAAC7gB,UAAV,KAAyBoiB,QAAQ,IAAIvB,SAAS,CAACwB,MAA/C,CAAJ,EAA4D;IAC1DF,SAAS,GAAGG,yBAAyB,CAACzB,SAAS,CAAC7gB,UAAX,EAAuB6gB,SAAvB,CAArC;EACD,CALmC,CAOpC;;;EACAA,SAAS,CAAC0B,iBAAV,GAA8BlgB,MAAM,CAACC,MAAP,CAAcue,SAAS,CAAC0B,iBAAV,IAA+B,EAA7C,EAAiDJ,SAAjD,CAA9B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASf,uBAAT,CAAiCvM,SAAjC,EAA4CrS,UAA5C,EAAwDggB,yBAAxD,EAAmF;EACxF,IAAI3N,SAAS,IAAI2N,yBAAjB,EAA4C;IAC1C,IAAI3N,SAAS,KAAK4N,kDAAlB,EAAyB;MACvB,IAAM/G,OAAO,GAAG3c,sDAAU,CAACyD,UAAD,YAAgBigB,kDAAhB,eAAiC,UAAjC,CAA1B;;MACA,IAAID,yBAAyB,WAAIC,kDAAJ,cAAa/G,OAAb,EAA7B,EAAsD;QACpD,OAAO8G,yBAAyB,WAAIC,kDAAJ,cAAa/G,OAAb,EAAhC;MACD;IACF;;IACD,OAAO8G,yBAAyB,CAAC3N,SAAD,CAAhC;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM6N,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACrkB,GAAD,EAA8C;EAAA,gFAAP,EAAO;EAAA,wBAAvCmK,KAAuC;EAAA,IAAvCA,KAAuC,4BAA/BuL,oEAA+B;;EAC/E;EACA,IAAMoN,oBAAoB,GAAGC,uBAAuB,CAAC/iB,GAAG,CAACwW,SAAL,EAAgBrM,KAAK,CAAC4L,aAAN,CAAoB/V,GAApB,CAAhB,EAA0CxC,wDAAA,CAAiB,2BAAjB,CAA1C,CAApD;EACA,IAAM8mB,WAAW,GAAI,OAAOtkB,GAAG,CAACwW,SAAX,KAAyB,QAAzB,IAAqCsM,oBAAtC,GAAgE,OAAOA,oBAAP,KAAgC,QAAjC,GAA6CA,oBAA7C,GAAoE,QAAnI,GAA+ItlB,wDAAA,CAAiB,kBAAjB,CAAnK;EACA,OAAO8mB,WAAP;AACD,CALM;AAOP;AACA;AACA;AACA;AACA;;AACO,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACD,WAAD,EAAiB;EACpD,OAAO,UAACtkB,GAAD,EAAS;IACd,IAAMwkB,cAAc,GAAGF,WAAW,IAAID,mBAAmB,CAACrkB,GAAD,CAAzD;;IACA,IAAIwkB,cAAc,KAAKzjB,qEAAvB,EAA2D;MACzD,OAAOf,GAAG,CAACwjB,IAAX;IACD,CAFD,MAEO,IAAIgB,cAAc,KAAKzjB,sEAAvB,EAA4D;MACjE,OAAOf,GAAG,CAAC0jB,IAAX;IACD,CAFM,MAEA,IAAIc,cAAc,KAAKzjB,oEAAvB,EAA0D;MAC/D,OAAOf,GAAG,CAACkjB,IAAX;IACD,CAFM,MAEA,IAAIsB,cAAc,KAAKzjB,uEAAvB,EAA6D;MAClE,OAAOf,GAAG,CAACojB,IAAX;IACD,CAFM,MAEA,IAAIoB,cAAc,KAAKzjB,qEAAvB,EAA2D;MAChE,OAAOf,GAAG,CAACsjB,IAAX;IACD,CAFM,MAEA,IAAIkB,cAAc,KAAKzjB,uEAAvB,EAA6D;MAClE,OAAOf,GAAG,CAAC4jB,IAAX;IACD;EACF,CAfD;AAgBD,CAjBM;AAmBP;AACA;AACA;AACA;;AACO,IAAMa,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;EACvC,OAAO,UAACzkB,GAAD,EAAS;IACd,OAAQA,GAAG,CAAC6Q,IAAJ,IAAY7Q,GAAG,CAAC6Q,IAAJ,CAAS6T,iBAArB,IAA0C1kB,GAAG,CAAC6Q,IAAJ,CAAS6T,iBAAT,CAA2BhlB,MAA3B,GAAoC,CAA/E,GAAoFM,GAAG,CAAC6Q,IAAJ,CAAS6T,iBAAT,CAA2B,CAA3B,CAApF,GAAoH,EAA3H;EACD,CAFD;AAGD,CAJM,EAMP;;AACA,SAASC,YAAT,CAAsB7P,GAAtB,EAA2BmE,KAA3B,EAAkC;EAChC,OAAO;IACLnE,GAAG,EAAHA,GADK;IAELhQ,GAAG,EAAG,OAAOmU,KAAP,KAAiB,UAAlB,GACD,UAAUiH,WAAV,EAAuB0E,MAAvB,EAA+B;MAC/B,OAAO3L,KAAK,CAACiH,WAAD,EAAc0E,MAAd,CAAZ;IACD,CAHE,GAID,UAAU1E,WAAV,EAAuB;MACvB,OAAO2E,mDAAQ,CAAC3E,WAAD,EAAcjH,KAAd,CAAf;IACD;EARE,CAAP;AAUD;;AAED,SAAS6L,wBAAT,GAAoC;EAClC,IAAMC,cAAc,GAAGhkB,2DAAvB;EACA,OAAO,CACL4jB,YAAY,CAACI,cAAc,CAACC,MAAhB,EAAwB,YAAxB,CADP,EAELL,YAAY,CAACI,cAAc,CAACE,KAAhB,EAAuB,MAAvB,CAFP,EAGLN,YAAY,CAACI,cAAc,CAACG,YAAhB,EAA8BX,qBAAqB,EAAnD,CAHP,EAILI,YAAY,CAACI,cAAc,CAACI,IAAhB,EAAsB,MAAtB,CAJP,EAKLR,YAAY,CAACI,cAAc,CAACK,IAAhB,EAAsB,QAAtB,CALP,EAMLT,YAAY,CAACI,cAAc,CAACM,MAAhB,EAAwB,QAAxB,CANP,EAOLV,YAAY,CAACI,cAAc,CAACO,MAAhB,EAAwB,WAAxB,CAPP,EAQLX,YAAY,CAACI,cAAc,CAACQ,OAAhB,EAAyBd,mBAAmB,EAA5C,CARP,CAAP;AAUD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASe,yBAAT,CAAmChP,SAAnC,EAA8C7U,UAA9C,EAA0D;EAC/D,IAAMojB,cAAc,GAAGhkB,2DAAvB;EACA,IAAM0kB,gBAAgB,GAAGzhB,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBmN,2EAAA,CAA2B,IAA3B,CAAlB,CAAzB;;EAEA,IAAI,CAACqU,gBAAgB,CAAC1kB,4EAAD,CAArB,EAAkE;IAChE0kB,gBAAgB,CAAC1kB,4EAAD,CAAhB,GAA8D+jB,wBAAwB,EAAtF;EACD;;EAED,IAAItO,SAAS,KAAK,OAAlB,EAA2B;IACzB,IAAM0N,iBAAiB,GAAGuB,gBAAgB,CAAC1kB,4EAAD,CAAhB,CAA4D2kB,KAA5D,EAA1B;IACAD,gBAAgB,CAAC1kB,4EAAD,CAAhB,GAA8DmjB,iBAA9D,CAFyB,CAIzB;;IACA,CAACa,cAAc,CAACY,IAAhB,EAAsBZ,cAAc,CAACa,QAArC,EAA+ClgB,OAA/C,CAAuD,UAAAmgB,eAAe,EAAI;MACxE,IAAI,OAAOtlB,mDAAI,CAAC2jB,iBAAD,EAAoB,UAAA4B,MAAM;QAAA,OAAIA,MAAM,CAAChR,GAAP,KAAe+Q,eAAnB;MAAA,CAA1B,CAAX,KAA6E,WAAjF,EAA8F;QAC5F3B,iBAAiB,CAAClmB,IAAlB,CAAuB2mB,YAAY,CAACkB,eAAD,EAAkB,eAAlB,CAAnC;MACD;IACF,CAJD,EALyB,CAWzB;;IACA,IAAIroB,wDAAA,CAAiB,WAAjB,MAAkC,CAACmE,UAAD,IAAeyP,mEAAA,CAAmBzP,UAAnB,EAA+B,uBAA/B,MAA4D,KAA7G,CAAJ,EAAyH;MACvH,IAAMgX,OAAO,GAAGC,mDAAQ,CAACpb,wDAAA,CAAiB,WAAjB,CAAD,CAAxB;;MAEA,IAAI,OAAO+C,mDAAI,CAAC2jB,iBAAD,EAAoB,UAAA2B,eAAe;QAAA,OAAIA,eAAe,CAAC/Q,GAAhB,KAAwBiQ,cAAc,CAACgB,UAA3C;MAAA,CAAnC,CAAX,KAAyG,WAA7G,EAA0H;QACxH7B,iBAAiB,CAAClmB,IAAlB,CAAuB2mB,YAAY,CAACI,cAAc,CAACgB,UAAhB,EAA4B,UAAS7F,WAAT,EAAsB;UACnF,OAAOxf,sDAAU,CAACwf,WAAD,8BAAmC6E,cAAc,CAACgB,UAAlD,EAAV,GACH7F,WAAW,CAACgE,iBAAZ,CAA8Ba,cAAc,CAACgB,UAA7C,CADG,GACwDpN,OAAO,CAACqN,QADvE;QAED,CAHkC,CAAnC;MAID;IACF;EACF;;EACD,OAAOP,gBAAP;AACD;AAEM,SAASxB,yBAAT,CAAmCtiB,UAAnC,EAA+CskB,UAA/C,EAAgG;EAAA,gFAAJ,EAAI;EAAA,wBAApC9b,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,oEAA4B;;EACrG,IAAI,CAACuQ,UAAL,EAAiB;IACf,OAAO,EAAP;EACD;;EACD,IAAM7c,UAAU,GAAGe,KAAK,CAAC2L,aAAN,CAAoBmQ,UAApB,CAAnB;EACA,IAAInC,SAAS,GAAG,EAAhB,CALqG,CAOrG;EACA;;EACA,IAAM2B,gBAAgB,GAAGD,yBAAyB,CAACS,UAAU,CAACzP,SAAZ,EAAuB7U,UAAvB,CAAlD;EACAukB,OAAO,CAACpC,SAAD,EAAY2B,gBAAZ,EAA8BQ,UAA9B,EAA0C7c,UAA1C,CAAP,CAVqG,CAYrG;;EACA,IAAIzH,UAAU,IAAIyP,sEAAA,CAAsBzP,UAAtB,EAAkCZ,4EAAlC,CAAlB,EAAgG;IAC9FmlB,OAAO,CAACpC,SAAD,EAAY1S,8EAAA,CAA8BzP,UAA9B,CAAZ,EAAuDskB,UAAvD,EAAmE7c,UAAnE,CAAP;IACA6c,UAAU,CAACE,qBAAX,GAAmC/U,mEAAA,CAAmBzP,UAAnB,EAA+B,uBAA/B,CAAnC;EACD,CAhBoG,CAkBrG;;;EACA,IAAI,SAAmBskB,UAAU,CAAC,QAAD,CAAjC,EAA6C;IAC3CnC,SAAS,GAAG9f,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB6f,SAAlB,EAA6BsC,+DAAkB,CAACH,UAAD,CAA/C,CAAZ;EACD;;EAED,OAAOnC,SAAP;AACD;;AAED,SAASoC,OAAT,CAAiBpC,SAAjB,EAA4B1S,cAA5B,EAA4C6U,UAA5C,EAAwDrB,MAAxD,EAAgE;EAC9D,IAAIyB,SAAS,GAAGjV,cAAc,CAACrQ,4EAAD,CAA9B;EACAklB,UAAU,CAACK,IAAX,GAAkBL,UAAU,CAACM,OAAX,EAAlB;;EAEA7Z,gDAAK,CAAC2Z,SAAD,EAAY,UAAUP,MAAV,EAAkB;IACjC,IAAIhR,GAAG,GAAGgR,MAAM,CAAChR,GAAjB;IACA,IAAImE,KAAK,GAAG6M,MAAM,CAAChhB,GAAnB;;IAEA,IAAIgf,SAAS,CAAChP,GAAD,CAAb,EAAoB;MAClBnW,kDAAO,CAAC,cAAcmW,GAAd,GAAoB,uBAArB,CAAP;IACD;;IAED,IAAI0R,+CAAI,CAACvN,KAAD,CAAR,EAAiB;MACf,IAAI;QACFA,KAAK,GAAGA,KAAK,CAACgN,UAAD,EAAarB,MAAb,CAAb;MACD,CAFD,CAEE,OAAOvZ,CAAP,EAAU;QACVnN,mDAAQ,CAAC,YAAD,EAAe,OAAf,EAAwBmN,CAAxB,CAAR;MACD;IACF;;IAED,IACE,CAAE,OAAO+F,cAAc,CAACqV,iBAAtB,KAA4C,WAA5C,IAA2DrV,cAAc,CAACqV,iBAAf,KAAqC,IAAjG,IACD3R,GAAG,KAAK/T,gEADR,OAC0C;IAExC2lB,qDAAU,CAACzN,KAAD,CAAV,IACAA,KAAK,KAAK,IADV,IAEAA,KAAK,KAAKhQ,SALZ,CADF,EAQE;MACAkE,kDAAO,CAAC,4BAA4B2H,GAA5B,GAAkC,2BAAnC,CAAP;IACD,CAVD,MAUO;MACLgP,SAAS,CAAChP,GAAD,CAAT,GAAiBmE,KAAjB;IACD;EACF,CA7BI,CAAL;;EA+BA,OAAO6K,SAAP;AACD;;AAEM,SAASpK,UAAT,CAAoB1Z,GAApB,EAAyB;EAC9B,IAAIQ,IAAI,GAAGR,GAAG,CAAC2B,UAAf;EACA,IAAIglB,gBAAgB,GAAG3mB,GAAG,CAAC0Q,GAA3B;EACA,IAAMkW,gBAAgB,GAAGxV,mEAAA,CAAmB5Q,IAAI,IAAI,IAA3B,EAAiC,kBAAjC,CAAzB;;EAEA,IAAIomB,gBAAgB,IAAI,OAAOA,gBAAP,KAA4B,UAApD,EAAgE;IAC9D,IAAI;MACFD,gBAAgB,GAAGC,gBAAgB,CAAC5mB,GAAG,CAAC0Q,GAAL,EAAU1M,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,CAAV,CAAnC;IACD,CAFD,CAEE,OAAOqL,CAAP,EAAU;MACVnN,mDAAQ,CAAC,6BAAD,EAAgC,eAAhC,EAAiDmN,CAAjD,CAAR;IACD;EACF;;EAED,IAAIsb,gBAAgB,IAAI,CAAxB,EAA2B;IACzB3mB,GAAG,CAAC0Q,GAAJ,GAAUiW,gBAAV;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,SAAS9J,gBAAT,CAA0BgK,eAA1B,EAA2C7mB,GAA3C,EAAgD;EAC9C,IAAI,CAAC6mB,eAAe,CAAC7mB,GAAG,CAACpC,UAAL,CAApB,EAAsC;IAAEipB,eAAe,CAAC7mB,GAAG,CAACpC,UAAL,CAAf,GAAkC;MAAEkG,IAAI,EAAE;IAAR,CAAlC;EAAiD;;EACzF+iB,eAAe,CAAC7mB,GAAG,CAACpC,UAAL,CAAf,CAAgCkG,IAAhC,CAAqC9F,IAArC,CAA0CgC,GAA1C;EACA,OAAO6mB,eAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAStK,eAAT,CAAyBnB,cAAzB,EAAyC0L,aAAzC,EAAwD;EACtD,IAAMC,YAAY,GAAG3L,cAAc,CAChCzV,GADkB,CACd,UAAA3F,GAAG;IAAA,OAAI,CAACA,GAAG,CAAC8D,IAAJ,IAAY,EAAb,EAAiBC,MAAjB,CAAwB,UAAA/D,GAAG;MAAA,OAAI,CAAC8mB,aAAa,CAACzhB,GAAd,CAAkBrF,GAAG,CAACoC,MAAtB,CAAL;IAAA,CAA3B,CAAJ;EAAA,CADW,EAElBwB,MAFkB,CAEXiB,8CAFW,EAEF,EAFE,CAArB;EAIA,OAAOkiB,YAAP;AACD;;;;;;;;;;;;;;ACv5BD;AACA;AACA;AACA;AACO,SAASC,YAAT,CAAsBC,WAAtB,EAAmC;EACxCjjB,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoB;IAClB;AACJ;AACA;AACA;IACIijB,UALkB,4BAKM;MAAA,IAAZ1jB,SAAY,QAAZA,SAAY;;MACtB,IAAIA,SAAS,IAAI,IAAjB,EAAuB;QACrB,OAAOyjB,WAAW,GACf1mB,IADI,CACC,UAAA4mB,OAAO;UAAA,OAAIA,OAAO,CAAC1I,YAAR,OAA2Bjb,SAA/B;QAAA,CADR,CAAP;MAED;IACF,CAViB;;IAWlB;AACJ;AACA;AACA;AACA;IACImf,SAhBkB,4BAgBS;MAAA,IAAhBte,aAAgB,SAAhBA,aAAgB;;MACzB,IAAIA,aAAa,IAAI,IAArB,EAA2B;QACzB,OAAO4iB,WAAW,GACftgB,OADI,CACI,UAAAygB,CAAC;UAAA,OAAIA,CAAC,CAACzI,UAAF,EAAJ;QAAA,CADL,EAEJpe,IAFI,CAEC,UAAA8mB,EAAE;UAAA,OAAIA,EAAE,CAAChjB,aAAH,KAAqBA,aAAzB;QAAA,CAFH,CAAP;MAGD;IACF,CAtBiB;;IAuBlB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;IACI0R,aA/BkB,gCA+BwB;MAAA,IAA3B1R,aAA2B,SAA3BA,aAA2B;MAAA,IAAZiM,SAAY,SAAZA,SAAY;;MACxC,IAAIA,SAAS,IAAI,IAAjB,EAAuB;QACrB,IAAMgX,GAAG,GAAG,KAAKxR,aAAL,CAAmB;UAACxF,SAAS,EAATA;QAAD,CAAnB,CAAZ;;QACA,IAAIgX,GAAG,IAAI,IAAP,KAAgBjjB,aAAa,IAAI,IAAjB,IAAyBijB,GAAG,CAACjjB,aAAJ,KAAsBA,aAA/D,CAAJ,EAAmF;UACjF,OAAOijB,GAAG,CAACnjB,UAAX;QACD;MACF,CALD,MAKO,IAAIE,aAAa,IAAI,IAArB,EAA2B;QAChC,IAAMgjB,EAAE,GAAG,KAAK1E,SAAL,CAAe;UAACte,aAAa,EAAbA;QAAD,CAAf,CAAX;;QACA,IAAIgjB,EAAE,IAAI,IAAV,EAAgB;UACd,OAAOA,EAAE,CAACljB,UAAV;QACD;MACF;IACF,CA3CiB;;IA4ClB;AACJ;AACA;AACA;AACA;AACA;AACA;IACIsc,gBAnDkB,mCAmD6B;MAAA,IAA7BnQ,SAA6B,SAA7BA,SAA6B;MAAA,IAAlB7M,eAAkB,SAAlBA,eAAkB;;MAC7C,IAAI6M,SAAS,IAAI,IAAb,IAAqB7M,eAAe,IAAI,IAA5C,EAAkD;QAChD,IAAI8jB,IAAI,GAAGN,WAAW,GAAGtgB,OAAd,CAAsB,UAAAygB,CAAC;UAAA,OAAIA,CAAC,CAACvI,cAAF,EAAJ;QAAA,CAAvB,CAAX;;QACA,IAAIpb,eAAe,IAAI,IAAvB,EAA6B;UAC3B8jB,IAAI,GAAGA,IAAI,CAACxjB,MAAL,CAAY,UAAAyjB,GAAG;YAAA,OAAIA,GAAG,CAAC/jB,eAAJ,KAAwBA,eAA5B;UAAA,CAAf,CAAP;QACD;;QACD,IAAI6M,SAAS,IAAI,IAAjB,EAAuB;UACrB,OAAOiX,IAAI,CAAC,CAAD,CAAX;QACD,CAFD,MAEO;UACL,OAAOA,IAAI,CAAChnB,IAAL,CAAU,UAAAinB,GAAG;YAAA,OAAIA,GAAG,CAAC1jB,IAAJ,IAAY0jB,GAAG,CAAC1jB,IAAJ,CAASvD,IAAT,CAAc,UAAAknB,EAAE;cAAA,OAAIA,EAAE,CAACljB,KAAH,KAAa+L,SAAjB;YAAA,CAAhB,KAA+C,IAA/D;UAAA,CAAb,CAAP;QACD;MACF;IACF,CA/DiB;;IAgElB;AACJ;AACA;AACA;AACA;AACA;IACIwF,aAtEkB,gCAsES;MAAA,IAAZxF,SAAY,SAAZA,SAAY;;MACzB,IAAIA,SAAS,IAAI,IAAjB,EAAuB;QACrB,OAAO2W,WAAW,GACftgB,OADI,CACI,UAAAygB,CAAC;UAAA,OAAIA,CAAC,CAACvI,cAAF,EAAJ;QAAA,CADL,EAEJlY,OAFI,CAEI,UAAA6gB,GAAG;UAAA,OAAIA,GAAG,CAAC1jB,IAAR;QAAA,CAFP,EAGJvD,IAHI,CAGC,UAAAknB,EAAE;UAAA,OAAIA,EAAE,IAAIA,EAAE,CAACljB,KAAH,KAAa+L,SAAvB;QAAA,CAHH,CAAP;MAID;IACF;EA7EiB,CAApB;AA+ED;;;;;;;;;;;;;;;;;;;;;ACpFD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASoX,iBAAT,GAA6B;EAClC,IAAMC,SAAS,GAAG,EAAlB;EACA,IAAMjS,cAAc,GAAG,EAAvB;;EAEAA,cAAc,CAACyI,aAAf,GAA+B,UAASne,GAAT,EAAc;IAC3C,IAAM2D,OAAO,GAAG4D,iEAAU,CAACvH,GAAG,CAAC2D,OAAL,CAA1B;IACAA,OAAO,CAACkL,UAAR,CAAmB,QAAnB;IACAlL,OAAO,CAAC+Y,WAAR,CAAoB,YAApB,EAAkC,QAAlC,EAA4C,gBAA5C;IACA/Y,OAAO,CAAC+Y,WAAR,CAAoB,aAApB,EAAmC,QAAnC,EAA6C,YAA7C;IACA,IAAMyK,OAAO,GAAG5mB,kDAAI,CAAConB,SAAD,EAAY,UAAAR,OAAO;MAAA,OAAIA,OAAO,CAAC1I,YAAR,OAA2Bze,GAAG,CAACwD,SAAnC;IAAA,CAAnB,CAApB;;IACA,IAAI2jB,OAAJ,EAAa;MACXnnB,GAAG,CAACoQ,MAAJ,GAAarP,gEAAb;MACAomB,OAAO,CAAChJ,aAAR,CAAsBne,GAAtB;IACD,CAHD,MAGO;MACLrB,kDAAO,6CAAP;IACD;EACF,CAZD;;EAcA+W,cAAc,CAACkS,iBAAf,GAAmC,YAAW;IAC5C,OAAOD,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAAC7I,cAAR,EAAJ;IAAA,CAArB,EACJ1a,MADI,CACGiB,8CADH,EACY,EADZ,CAAP;EAED,CAHD;;EAKA6Q,cAAc,CAACmS,gBAAf,GAAkC,YAAW;IAC3C,OAAOF,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAACtI,cAAR,EAAJ;IAAA,CAArB,EACJjb,MADI,CACGiB,8CADH,EACY,EADZ,CAAP;EAED,CAHD;;EAKA6Q,cAAc,CAACqJ,SAAf,GAA2B,YAAW;IACpC,OAAO4I,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAACpI,SAAR,EAAJ;IAAA,CAArB,EACJnb,MADI,CACGiB,8CADH,EACY,EADZ,CAAP;EAED,CAHD;;EAKA6Q,cAAc,CAACoJ,eAAf,GAAiC,YAAW;IAC1C,OAAO6I,SAAS,CAAChiB,GAAV,CAAc,UAACwhB,OAAD,EAAa;MAChC,IAAIA,OAAO,CAACzI,gBAAR,OAA+BjF,0DAAnC,EAAsD;QACpD,OAAO0N,OAAO,CAACrI,eAAR,EAAP;MACD;IACF,CAJM,EAIJlb,MAJI,CAIGiB,8CAJH,EAIY,EAJZ,EAKJd,MALI,CAKG,UAAA/D,GAAG;MAAA,OAAIA,GAAJ;IAAA,CALN,CAAP;EAMD,CAPD;;EASA0V,cAAc,CAACoS,uBAAf,GAAyC,UAASlqB,UAAT,EAAqB;IAC5D,OAAO+pB,SAAS,CAAChiB,GAAV,CAAc,UAACwhB,OAAD,EAAa;MAChC,OAAOA,OAAO,CAACrI,eAAR,EAAP;IACD,CAFM,EAEJlb,MAFI,CAEGiB,8CAFH,EAEY,EAFZ,EAGJd,MAHI,CAGG,UAAA/D,GAAG;MAAA,OAAIA,GAAG,IAAIA,GAAG,CAACpC,UAAJ,KAAmBA,UAA9B;IAAA,CAHN,CAAP;EAID,CALD;;EAOA8X,cAAc,CAACiJ,UAAf,GAA4B,YAAW;IACrC,OAAOgJ,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAACxI,UAAR,EAAJ;IAAA,CAArB,EACJ/a,MADI,CACGiB,8CADH,EACY,EADZ,CAAP;EAED,CAHD;;EAKA6Q,cAAc,CAACkJ,cAAf,GAAgC,YAAW;IACzC,OAAO+I,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAACvI,cAAR,EAAJ;IAAA,CAArB,EACJhb,MADI,CACGiB,8CADH,EACY,EADZ,EAEJd,MAFI,CAEGyN,8CAFH,CAAP;EAGD,CAJD;;EAMAkE,cAAc,CAACqS,aAAf,GAA+B,UAASC,IAAT,EAAe;IAC5C,IAAMb,OAAO,GAAGjN,uDAAU,CAAC8N,IAAD,CAA1B;;IACAC,WAAW,CAACd,OAAD,CAAX;;IACA,OAAOA,OAAP;EACD,CAJD;;EAMAzR,cAAc,CAACwS,aAAf,GAA+B,UAAS5mB,IAAT,EAAe;IAC5C,OAAOf,kDAAI,CAAConB,SAAS,CAAChiB,GAAV,CAAc,UAAAwhB,OAAO;MAAA,OAAIA,OAAO,CAACrI,eAAR,EAAJ;IAAA,CAArB,EAAoDlb,MAApD,CAA2DiB,8CAA3D,EAAoE,EAApE,CAAD,EAA0E,UAAA7E,GAAG;MAAA,OAAIA,GAAG,CAACsB,IAAJ,KAAaA,IAAjB;IAAA,CAA7E,CAAX;EACD,CAFD;;EAIAoU,cAAc,CAACyS,kCAAf,GAAoD,YAAW;IAC7D,OAAO3C,sEAAyB,GAAGzkB,4EAAH,CAAhC;EACD,CAFD;;EAIA2U,cAAc,CAAC0S,gBAAf,GAAkC,UAAS9mB,IAAT,EAAe8O,MAAf,EAAuB;IACvD,IAAIpQ,GAAG,GAAG0V,cAAc,CAACwS,aAAf,CAA6B5mB,IAA7B,CAAV;IACA,IAAItB,GAAJ,EAASA,GAAG,CAACoQ,MAAJ,GAAaA,MAAb;;IAET,IAAIpQ,GAAG,IAAIoQ,MAAM,KAAKrP,yEAAtB,EAA8D;MAC5D,IAAMomB,OAAO,GAAG5mB,kDAAI,CAAConB,SAAD,EAAY,UAAAR,OAAO;QAAA,OAAIA,OAAO,CAAC1I,YAAR,OAA2Bze,GAAG,CAACwD,SAAnC;MAAA,CAAnB,CAApB;MACA,IAAI2jB,OAAJ,EAAaA,OAAO,CAAC9I,eAAR,CAAwBre,GAAxB;IACd;EACF,CARD;;EAUA0V,cAAc,CAAC2S,gBAAf,GAAkC,YAAW;IAC3C,OAAOV,SAAS,CAACjoB,MAAV,IAAoBioB,SAAS,CAACA,SAAS,CAACjoB,MAAV,GAAmB,CAApB,CAAT,CAAgC+e,YAAhC,EAA3B;EACD,CAFD;;EAIA/I,cAAc,CAAC4S,gBAAf,GAAkC,YAAW;IAC3CX,SAAS,CAACjoB,MAAV,GAAmB,CAAnB;EACD,CAFD;;EAIA,SAASuoB,WAAT,CAAqBd,OAArB,EAA8B;IAC5BQ,SAAS,CAAC3pB,IAAV,CAAempB,OAAf;EACD;;EAEDzR,cAAc,CAACvL,KAAf,GAAuB,IAAI6c,0DAAJ,CAAiB;IAAA,OAAMW,SAAN;EAAA,CAAjB,CAAvB;EAEA,OAAOjS,cAAP;AACD;AAEM,IAAMA,cAAc,GAAGgS,iBAAiB,EAAxC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvIP;AACA;AACA;;;;AAEO,IAAMa,cAAb;EACE,wBAAYC,WAAZ,EAAyBC,YAAzB,EAAuC;IAAA;;IAAA;;IACrC,KAAKD,WAAL,GAAmBA,WAAnB;IACA,KAAKC,YAAL,GAAoBA,YAApB;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;;;EAZA;IAAA;IAAA,OAaE,aAAIC,KAAJ,EAAWC,IAAX,EAAiB;MACf,IAAI1P,KAAK,GAAG,KAAK2P,MAAL,CAAYF,KAAZ,EAAmBC,IAAnB,CAAZ;;MACA,IAAI,OAAO1P,KAAP,KAAiB,WAArB,EAAkC;QAChCA,KAAK,GAAG,KAAK2P,MAAL,CAAY,IAAZ,EAAkBD,IAAlB,CAAR;MACD;;MACD,OAAO1P,KAAP;IACD;IAED;AACF;AACA;AACA;AACA;AACA;;EA1BA;IAAA;IAAA,OA2BE,gBAAOyP,KAAP,EAAcC,IAAd,EAAoB;MAClBD,KAAK,0BAAG,IAAH,sCAAG,IAAH,EAAsBA,KAAtB,CAAL;MACA,OAAOhoB,qDAAU,CAAC,KAAK8nB,WAAL,EAAD,YAAwBE,KAAxB,cAAiCC,IAAjC,EAAjB;IACD;IAED;AACF;AACA;;EAlCA;IAAA;IAAA,OAmCE,qBAAY;MAAA;;MACV,OAAO3kB,MAAM,CAAC0J,IAAP,CAAY,KAAK8a,WAAL,EAAZ,EAAgCzkB,MAAhC,CAAuC,UAAC2kB,KAAD;QAAA,OAAWA,KAAK,KAAK,KAAI,CAACD,YAA1B;MAAA,CAAvC,CAAP;IACD;IAED;AACF;AACA;;EAzCA;IAAA;IAAA,OA0CE,qBAAYC,KAAZ,EAAmB;MACjB,OAAOpgB,oDAAS,CAAC,EAAD,EAAK,KAAKugB,cAAL,CAAoB,IAApB,CAAL,EAAgC,KAAKA,cAAL,CAAoBH,KAApB,CAAhC,CAAhB;IACD;IAED;AACF;AACA;;EAhDA;IAAA;IAAA,OAiDE,wBAAeA,KAAf,EAAsB;MACpBA,KAAK,0BAAG,IAAH,sCAAG,IAAH,EAAsBA,KAAtB,CAAL;MACA,OAAO,KAAKF,WAAL,GAAmBE,KAAnB,KAA6B,EAApC;IACD;EApDH;;EAAA;AAAA;;wBAsDgBA,OAAO;EACnB,IAAIA,KAAK,IAAI,IAAb,EAAmB;IACjB,OAAO,KAAKD,YAAZ;EACD,CAFD,MAEO;IACL,OAAOC,KAAP;EACD;AACF;;AAGI,IAAMtX,cAAc,GAAG,IAAImX,cAAJ,CAAmB;EAAA,OAAMO,2DAAS,GAAG1X,cAAZ,IAA8B,EAApC;AAAA,CAAnB,EAA2DrQ,6EAA3D,CAAvB;;;;;;;;;;;;;;;ACnEP;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASgoB,GAAT,CAAaC,UAAb,EAA8F;EAAA,+EAAJ,EAAI;EAAA,oBAApEtlB,GAAoE;EAAA,IAApEA,GAAoE,yBAA9D,QAA8D;EAAA,uBAApDtB,MAAoD;EAAA,IAApDA,MAAoD,4BAA3C,EAA2C;EAAA,IAAvCmC,KAAuC,QAAvCA,KAAuC;EAAA,IAAhCF,aAAgC,QAAhCA,aAAgC;EAAA,IAAjBb,SAAiB,QAAjBA,SAAiB;;EAC5F,IAAIylB,OAAO,GAAGvlB,GAAd;;EACA,IAAIwlB,WAAW,GAAGF,UAAU,IAAI,CAAhC;;EAEA,KAAKrnB,UAAL,GAAkBS,MAAlB;EACA,KAAKuT,KAAL,GAAa,CAAb;EACA,KAAKE,MAAL,GAAc,CAAd;EACA,KAAKsT,aAAL,GAAqBC,UAAU,EAA/B;EACA,KAAK9nB,IAAL,GAAYmD,iEAAsB,EAAlC;EACA,KAAK6L,SAAL,GAAiB/L,KAAjB;EACA,KAAKF,aAAL,GAAqBA,aAArB;EACA,KAAKb,SAAL,GAAiBA,SAAjB;EACA,KAAKgT,SAAL,GAAiB,QAAjB;EACA,KAAKgH,MAAL,GAAcyL,OAAd;;EAEA,SAASG,UAAT,GAAsB;IACpB,QAAQF,WAAR;MACE,KAAK,CAAL;QACE,OAAO,SAAP;;MACF,KAAK,CAAL;QACE,OAAO,eAAP;;MACF,KAAK,CAAL;QACE,OAAO,sCAAP;;MACF,KAAK,CAAL;QACE,OAAO,eAAP;IARJ;EAUD;;EAED,KAAKG,aAAL,GAAqB,YAAY;IAC/B,OAAOH,WAAP;EACD,CAFD,CA5B4F,CAgC5F;;;EACA,KAAK3C,OAAL,GAAe,YAAY;IACzB,OAAO,KAAK5Q,KAAL,GAAa,GAAb,GAAmB,KAAKE,MAA/B;EACD,CAFD;;EAIA,KAAKyT,cAAL,GAAsB,YAAY;IAChC,OAAO;MACL5lB,GAAG,EAAE,KAAK8Z,MADL;MAELpb,MAAM,EAAE,KAAKT,UAFR;MAGL4C,KAAK,EAAE,KAAK+L,SAHP;MAILjM,aAAa,EAAE,KAAKA,aAJf;MAKLb,SAAS,EAAE,KAAKA;IALX,CAAP;EAOD,CARD;AASD,EAED;;;AACO,SAASuN,SAAT,CAAmBiY,UAAnB,EAA+BO,WAA/B,EAA4C;EACjD,OAAO,IAAIR,GAAJ,CAAQC,UAAR,EAAoBO,WAApB,CAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AAEA,IAAMC,aAAa,GAAGC,6DAAkB,CAAC1oB,uDAAD,CAAlB,CAAyC2oB,WAAzC,OAA2D,MAAjF;AACA,IAAMC,sBAAsB,GAAG,IAA/B;AACA,IAAMC,4BAA4B,GAAG,IAArC;AACA,IAAMC,4BAA4B,GAAG,KAArC;AACA,IAAMC,iBAAiB,GAAG,KAA1B;AACA,IAAMC,qBAAqB,GAAG,IAA9B;AACA,IAAMC,0BAA0B,GAAG,EAAnC;AAEA,IAAMC,qBAAqB,GAAG,GAA9B;AAEO,IAAMviB,MAAM,GAAG,QAAf;AACP,IAAMwiB,KAAK,GAAG,OAAd;AAEA,IAAMC,YAAY,GAAG,EAArB;AACAA,YAAY,CAACziB,MAAD,CAAZ,GAAuB,IAAvB;AACAyiB,YAAY,CAACD,KAAD,CAAZ,GAAsB,IAAtB;AAEA,IAAME,uBAAuB,GAAG1iB,MAAhC;AAEA,IAAM2iB,mBAAmB,GAAG;EAC1BC,GAAG,EAAE,KADqB;EAE1BC,MAAM,EAAE,QAFkB;EAG1BC,IAAI,EAAE,MAHoB;EAI1BC,IAAI,EAAE,MAJoB;EAK1BC,KAAK,EAAE,OALmB;EAM1BC,MAAM,EAAE;AANkB,CAA5B;AASA,IAAMC,UAAU,GAAG,GAAnB;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEO,SAASC,SAAT,GAAqB;EAC1B,IAAIC,SAAS,GAAG,EAAhB;EACA,IAAIC,QAAJ;EACA,IAAIvtB,MAAJ;EACA,IAAIwtB,YAAJ;EACA,IAAIC,UAAU,GAAG,IAAjB;;EAEA,SAASC,WAAT,GAAuB;IACrBH,QAAQ,GAAG,EAAX;IACA,IAAIF,SAAS,GAAG;MACd;MACAM,MAAM,EAAE3B,aAFM;;MAGd,IAAI4B,KAAJ,GAAY;QACV,OAAO,KAAKD,MAAZ;MACD,CALa;;MAMd,IAAIC,KAAJ,CAAUtmB,GAAV,EAAe;QACb,KAAKqmB,MAAL,GAAcrmB,GAAd;MACD,CARa;;MAUd;MACAumB,cAAc,EAAE1B,sBAXF;;MAYd,IAAI2B,aAAJ,GAAoB;QAClB,OAAO,KAAKD,cAAZ;MACD,CAda;;MAed,IAAIC,aAAJ,CAAkBxmB,GAAlB,EAAuB;QACrB,KAAKumB,cAAL,GAAsBvmB,GAAtB;MACD,CAjBa;;MAmBdymB,gBAAgB,EAAE,IAnBJ;;MAoBd,IAAIC,eAAJ,GAAsB;QACpB,OAAO,KAAKD,gBAAZ;MACD,CAtBa;;MAuBd,IAAIC,eAAJ,CAAoB1mB,GAApB,EAAyB;QACvBnG,kDAAO,CAAC,gFAAD,CAAP;QACA,KAAK4sB,gBAAL,GAAwBzmB,GAAxB;MACD,CA1Ba;;MA4Bd;MACA2mB,iBAAiB,EAAEpB,mBAAmB,CAACE,MA7BzB;;MA8Bd,IAAImB,gBAAJ,CAAqB5mB,GAArB,EAA0B;QACxB,IAAI6mB,wBAAwB,CAAC7mB,GAAD,CAA5B,EAAmC;UACjC,IAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;YAC3B,KAAK2mB,iBAAL,GAA0BG,cAAc,CAAC9mB,GAAD,CAAf,GAAwBA,GAAxB,GAA8BulB,mBAAmB,CAACE,MAA3E;UACD,CAFD,MAEO,IAAI/b,wDAAa,CAAC1J,GAAD,CAAjB,EAAwB;YAC7B,KAAK+mB,kBAAL,GAA0B/mB,GAA1B;YACA,KAAK2mB,iBAAL,GAAyBpB,mBAAmB,CAACM,MAA7C;YACAlrB,qDAAU,CAAC,gCAAD,CAAV;UACD;QACF;MACF,CAxCa;;MAyCd,IAAIisB,gBAAJ,GAAuB;QACrB,OAAO,KAAKD,iBAAZ;MACD,CA3Ca;;MA6CdI,kBAAkB,EAAE,EA7CN;;MA8Cd,IAAIC,iBAAJ,GAAwB;QACtB,OAAO,KAAKD,kBAAZ;MACD,CAhDa;;MAkDd;AACN;AACA;AACA;MACME,0BAA0B,EAAE,EAtDd;;MAwDd,IAAI5H,yBAAJ,GAAgC;QAC9B,OAAO,KAAK4H,0BAAZ;MACD,CA1Da;;MA2Dd,IAAI5H,yBAAJ,CAA8Brf,GAA9B,EAAmC;QAAA;;QACjC,KAAKinB,0BAAL,GAAkC/nB,MAAM,CAAC0J,IAAP,CAAY5I,GAAZ,EAAiBlB,MAAjB,CAAwB,UAACooB,SAAD,EAAYC,IAAZ,EAAqB;UAC7E,IAAIN,wBAAwB,CAAC7mB,GAAG,CAACmnB,IAAD,CAAJ,CAA5B,EAAyC;YACvC,IAAI,OAAOnnB,GAAP,KAAe,QAAnB,EAA6B;cAC3BknB,SAAS,CAACC,IAAD,CAAT,GAAmBL,cAAc,CAAC9mB,GAAG,CAACmnB,IAAD,CAAJ,CAAf,GAA8BnnB,GAAG,CAACmnB,IAAD,CAAjC,GAA0C,KAAI,CAACR,iBAAjE;YACD,CAFD,MAEO,IAAIjd,wDAAa,CAAC1J,GAAD,CAAjB,EAAwB;cAC7BknB,SAAS,CAACC,IAAD,CAAT,GAAkBnnB,GAAG,CAACmnB,IAAD,CAArB;cACAxsB,qDAAU,8CAAuCwsB,IAAvC,EAAV;YACD;UACF,CAPD,MAOO;YACLttB,kDAAO,qDAA8CstB,IAA9C,EAAP;UACD;;UACD,OAAOD,SAAP;QACD,CAZiC,EAY/B,EAZ+B,CAAlC;MAaD,CAzEa;;MA2EdE,YAAY,EAAEtC,4BA3EA;;MA4Ed,IAAIuC,iBAAJ,GAAwB;QACtB,OAAO,KAAKD,YAAZ;MACD,CA9Ea;;MA+Ed,IAAIC,iBAAJ,CAAsBrnB,GAAtB,EAA2B;QACzB,KAAKonB,YAAL,GAAoBpnB,GAApB;MACD,CAjFa;;MAmFdsnB,YAAY,EAAEtC,iBAnFA;;MAoFd,IAAIuC,WAAJ,GAAkB;QAChB,OAAO,KAAKD,YAAZ;MACD,CAtFa;;MAuFd,IAAIC,WAAJ,CAAgBvnB,GAAhB,EAAqB;QACnB,KAAKsnB,YAAL,GAAoBtnB,GAApB;MACD,CAzFa;;MA2Fd;AACN;AACA;AACA;MACMwnB,aAAa,EAAEvC,qBA/FD;;MAgGd,IAAIwC,YAAJ,GAAmB;QACjB,OAAO,KAAKD,aAAZ;MACD,CAlGa;;MAmGd,IAAIC,YAAJ,CAAiBznB,GAAjB,EAAsB;QACpB,KAAKwnB,aAAL,GAAqBxnB,GAArB;MACD,CArGa;;MAuGd0nB,eAAe,EAAEpC,uBAvGH;;MAwGd,IAAIqC,cAAJ,GAAqB;QACnB,OAAO,KAAKD,eAAZ;MACD,CA1Ga;;MA2Gd,IAAIC,cAAJ,CAAmB3nB,GAAnB,EAAwB;QACtB,IAAIqlB,YAAY,CAACrlB,GAAD,CAAhB,EAAuB;UACrB,KAAK0nB,eAAL,GAAuB1nB,GAAvB;QACD,CAFD,MAEO;UACLnG,kDAAO,0BAAmBmG,GAAnB,oCAAP;QACD;MACF,CAjHa;;MAmHd;MACA4nB,cAAc,EAAEzC,qBApHF;;MAqHd,IAAI0C,aAAJ,GAAoB;QAClB,OAAO,KAAKD,cAAZ;MACD,CAvHa;;MAwHd,IAAIC,aAAJ,CAAkB7nB,GAAlB,EAAuB;QACrB,KAAK4nB,cAAL,GAAsB5nB,GAAtB;MACD,CA1Ha;;MA4Hd8nB,mBAAmB,EAAE/C,4BA5HP;;MA6Hd,IAAIgD,kBAAJ,GAAyB;QACvB,OAAO,KAAKD,mBAAZ;MACD,CA/Ha;;MAgId,IAAIC,kBAAJ,CAAuB/nB,GAAvB,EAA4B;QAC1B,KAAK8nB,mBAAL,GAA2B9nB,GAA3B;MACD,CAlIa;;MAoId;MACAgoB,iBAAiB,EAAE9C,0BArIL;;MAsId,IAAI+C,gBAAJ,GAAuB;QACrB,OAAO,KAAKD,iBAAZ;MACD,CAxIa;;MAyId,IAAIC,gBAAJ,CAAqBjoB,GAArB,EAA0B;QACxB,KAAKgoB,iBAAL,GAAyBhoB,GAAzB;MACD,CA3Ia;;MA6IdkoB,eAAe,EAAE,EA7IH;;MA8Id,IAAIC,cAAJ,GAAqB;QACnB,OAAO,KAAKD,eAAZ;MACD,CAhJa;;MAiJd,IAAIC,cAAJ,CAAmBnoB,GAAnB,EAAwB;QACtB,IAAIooB,sBAAsB,CAACpoB,GAAD,CAA1B,EAAiC;UAC/B,KAAKkoB,eAAL,GAAuBloB,GAAvB;QACD;MACF;;IArJa,CAAhB;;IAwJA,IAAItH,MAAJ,EAAY;MACV2vB,eAAe,CACbnpB,MAAM,CAAC0J,IAAP,CAAYlQ,MAAZ,EAAoBoG,MAApB,CAA2B,UAACmD,IAAD,EAAOqmB,KAAP,EAAiB;QAC1C,IAAI5vB,MAAM,CAAC4vB,KAAD,CAAN,KAAkBvC,SAAS,CAACuC,KAAD,CAA/B,EAAwC;UACtCrmB,IAAI,CAACqmB,KAAD,CAAJ,GAAcvC,SAAS,CAACuC,KAAD,CAAT,IAAoB,EAAlC;QACD;;QACD,OAAOrmB,IAAP;MACD,CALD,EAMA,EANA,CADa,CAAf;IASD;;IAEDvJ,MAAM,GAAGqtB,SAAT;IACAG,YAAY,GAAG,EAAf;;IAEA,SAASY,cAAT,CAAwB9mB,GAAxB,EAA6B;MAC3B,OAAOvE,kDAAI,CAACyD,MAAM,CAAC0J,IAAP,CAAY2c,mBAAZ,CAAD,EAAmC,UAAAgD,MAAM;QAAA,OAAIvoB,GAAG,KAAKulB,mBAAmB,CAACgD,MAAD,CAA/B;MAAA,CAAzC,CAAX;IACD;;IAED,SAAS1B,wBAAT,CAAkC7mB,GAAlC,EAAuC;MACrC,IAAI,CAACA,GAAL,EAAU;QACR5G,mDAAQ,CAAC,0DAAD,CAAR;QACA,OAAO,KAAP;MACD;;MACD,IAAI,OAAO4G,GAAP,KAAe,QAAnB,EAA6B;QAC3B,IAAI,CAAC8mB,cAAc,CAAC9mB,GAAD,CAAnB,EAA0B;UACxBnG,kDAAO,CAAC,iGAAD,CAAP;QACD;MACF,CAJD,MAIO,IAAI6P,wDAAa,CAAC1J,GAAD,CAAjB,EAAwB;QAC7B,IAAI,CAACwoB,wEAAkB,CAACxoB,GAAD,CAAvB,EAA8B;UAC5B5G,mDAAQ,CAAC,8DAAD,CAAR;UACA,OAAO,KAAP;QACD;MACF;;MACD,OAAO,IAAP;IACD;;IAED,SAASgvB,sBAAT,CAAgCpoB,GAAhC,EAAqC;MACnC,IAAI,CAAC0J,wDAAa,CAAC1J,GAAD,CAAlB,EAAyB;QACvBnG,kDAAO,CAAC,mCAAD,CAAP;QACA,OAAO,KAAP;MACD;;MAED,gCAAcqF,MAAM,CAAC0J,IAAP,CAAY5I,GAAZ,CAAd,kCAAgC;QAA3B,IAAImV,CAAC,mBAAL;;QACH,IAAIA,CAAC,KAAK,kBAAN,IAA4BA,CAAC,KAAK,qBAAtC,EAA6D;UAC3Dtb,kDAAO,qDAA8Csb,CAA9C,EAAP;UACA,OAAO,KAAP;QACD;;QACD,IAAIA,CAAC,KAAK,kBAAV,EAA8B;UAC5B,IAAI,CAAC5W,kDAAO,CAACyB,GAAG,CAACmV,CAAD,CAAJ,CAAZ,EAAsB;YACpBtb,kDAAO,2BAAoBsb,CAApB,4BAAP;YACA,OAAO,KAAP;UACD,CAHD,MAGO,IAAI,CAACnV,GAAG,CAACmV,CAAD,CAAH,CAAO3D,KAAP,CAAaiX,4CAAb,CAAL,EAA0B;YAC/B5uB,kDAAO,2BAAoBsb,CAApB,0BAAP;YACA,OAAO,KAAP;UACD;QACF,CARD,MAQO,IAAIA,CAAC,KAAK,qBAAV,EAAiC;UACtC,IAAI,CAACuT,oDAAS,CAAC1oB,GAAG,CAACmV,CAAD,CAAJ,CAAd,EAAwB;YACtBtb,kDAAO,2BAAoBsb,CAApB,8BAAP;YACA,OAAO,KAAP;UACD;QACF;MACF;;MACD,OAAO,IAAP;IACD;EACF;EAED;AACF;AACA;AACA;;;EACE,SAASwT,UAAT,GAAsB;IACpB,IAAIxC,UAAU,IAAID,YAAd,IAA8Bxc,wDAAa,CAACwc,YAAY,CAACC,UAAD,CAAb,CAA/C,EAA2E;MACzE,IAAIyC,gBAAgB,GAAG1C,YAAY,CAACC,UAAD,CAAnC;MACA,IAAM0C,cAAc,GAAG,IAAInnB,GAAJ,CAAQxC,MAAM,CAAC0J,IAAP,CAAYlQ,MAAZ,EAAoB6d,MAApB,CAA2BrX,MAAM,CAAC0J,IAAP,CAAYggB,gBAAZ,CAA3B,CAAR,CAAvB;MAEA,OAAOE,uDAAI,CAACD,cAAD,CAAJ,CAAqB/pB,MAArB,CAA4B,UAACmD,IAAD,EAAOqmB,KAAP,EAAiB;QAClD,IAAI,OAAOM,gBAAgB,CAACN,KAAD,CAAvB,KAAmC,WAAvC,EAAoD;UAClDrmB,IAAI,CAACqmB,KAAD,CAAJ,GAAc5vB,MAAM,CAAC4vB,KAAD,CAApB;QACD,CAFD,MAEO,IAAI,OAAO5vB,MAAM,CAAC4vB,KAAD,CAAb,KAAyB,WAA7B,EAA0C;UAC/CrmB,IAAI,CAACqmB,KAAD,CAAJ,GAAcM,gBAAgB,CAACN,KAAD,CAA9B;QACD,CAFM,MAEA;UACL,IAAI5e,wDAAa,CAACkf,gBAAgB,CAACN,KAAD,CAAjB,CAAjB,EAA4C;YAC1CrmB,IAAI,CAACqmB,KAAD,CAAJ,GAAc9kB,oDAAS,CAAC,EAAD,EAAK9K,MAAM,CAAC4vB,KAAD,CAAX,EAAoBM,gBAAgB,CAACN,KAAD,CAApC,CAAvB;UACD,CAFD,MAEO;YACLrmB,IAAI,CAACqmB,KAAD,CAAJ,GAAcM,gBAAgB,CAACN,KAAD,CAA9B;UACD;QACF;;QACD,OAAOrmB,IAAP;MACD,CAbM,EAaJ,EAbI,CAAP;IAcD;;IACD,OAAO/C,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBzG,MAAlB,CAAP;EACD;;EAED,SAASqwB,oBAAT,GAAgC;IAC9B;IACA;IACA;IACA;IACA;IACA,IAAMC,IAAI,GAAGL,UAAU,EAAvB;;IACAzpB,MAAM,CAAC+pB,cAAP,CAAsBD,IAAtB,EAA4B,OAA5B,EAAqC;MACnC5a,GAAG,EAAE,eAAY;QACf,MAAM,IAAI8a,KAAJ,CAAU,qEAAV,CAAN;MACD;IAHkC,CAArC;IAKA,OAAOF,IAAP;EACD;;EAED,WAAkC,CAACL,UAAD,EAAaI,oBAAb,EAAmCloB,GAAnC,CAAuC,UAAAsoB,QAAQ,EAAI;IACnF;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;IACI,OAAO,SAAS9uB,SAAT,GAA4B;MACjC,IAAI,UAAKO,MAAL,IAAe,CAAf,IAAoB,8DAAmB,UAA3C,EAAuD;QACrD,IAAM2tB,MAAM,mDAAZ;QACA,OAAOA,MAAM,GAAG3sB,qDAAU,CAACutB,QAAQ,EAAT,EAAaZ,MAAb,CAAb,GAAoCI,UAAU,EAA3D;MACD;;MAED,OAAOS,SAAS,MAAT,mBAAP;IACD,CAPD;EAQD,CAjBiC,CAAlC;EAAA;EAAA,IAAOC,YAAP;EAAA,IAAqBhvB,SAArB;;EAmBA,YAAoC,CAACA,SAAD,EAAYgvB,YAAZ,EAA0BxoB,GAA1B,CAA8B,UAAAyoB,MAAM,EAAI;IAC1E;AACJ;AACA;IACI,OAAO,SAASC,UAAT,GAA6B;MAClC,IAAIC,GAAG,GAAGF,MAAM,MAAN,mBAAV;;MACA,IAAIE,GAAG,IAAI,0EAAOA,GAAP,MAAe,QAA1B,EAAoC;QAClCA,GAAG,GAAG7oB,oDAAS,CAAC6oB,GAAD,CAAf;MACD;;MACD,OAAOA,GAAP;IACD,CAND;EAOD,CAXmC,CAApC;EAAA;EAAA,IAAOD,UAAP;EAAA,IAAmBE,aAAnB;EAaA;AACF;AACA;;;EACE,SAASC,eAAT,GAA2B;IACzB,OAAOxD,YAAP;EACD;EAED;AACF;AACA;AACA;;;EACE,SAASyD,SAAT,CAAmBnxB,OAAnB,EAA4B;IAC1B,IAAI,CAACkR,wDAAa,CAAClR,OAAD,CAAlB,EAA6B;MAC3BY,mDAAQ,CAAC,qCAAD,CAAR;MACA;IACD;;IAED,IAAIwwB,MAAM,GAAG1qB,MAAM,CAAC0J,IAAP,CAAYpQ,OAAZ,CAAb;IACA,IAAIqxB,aAAa,GAAG,EAApB;IAEAD,MAAM,CAAChpB,OAAP,CAAe,UAAA0nB,KAAK,EAAI;MACtB,IAAIC,MAAM,GAAG/vB,OAAO,CAAC8vB,KAAD,CAApB;;MAEA,IAAI5e,wDAAa,CAACuc,QAAQ,CAACqC,KAAD,CAAT,CAAb,IAAkC5e,wDAAa,CAAC6e,MAAD,CAAnD,EAA6D;QAC3DA,MAAM,GAAGrpB,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB8mB,QAAQ,CAACqC,KAAD,CAA1B,EAAmCC,MAAnC,CAAT;MACD;;MAED,IAAI;QACFsB,aAAa,CAACvB,KAAD,CAAb,GAAuB5vB,MAAM,CAAC4vB,KAAD,CAAN,GAAgBC,MAAvC;MACD,CAFD,CAEE,OAAOhiB,CAAP,EAAU;QACV1M,kDAAO,0CAAmCyuB,KAAnC,UAA+C/hB,CAA/C,CAAP;MACD;IACF,CAZD;IAcA8hB,eAAe,CAACwB,aAAD,CAAf;EACD;EAED;AACF;AACA;AACA;;;EACE,SAASC,WAAT,CAAqBtxB,OAArB,EAA8B;IAC5B,IAAI,CAACkR,wDAAa,CAACuc,QAAD,CAAlB,EAA8B;MAC5B7sB,mDAAQ,CAAC,4BAAD,CAAR;MACA;IACD;;IAED8F,MAAM,CAACC,MAAP,CAAc8mB,QAAd,EAAwBztB,OAAxB,EAN4B,CAO5B;;IACA0G,MAAM,CAACC,MAAP,CAAczG,MAAd,EAAsBF,OAAtB;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAAS4wB,SAAT,CAAmBd,KAAnB,EAA0ByB,QAA1B,EAAkD;IAAA,IAAdvxB,OAAc,uEAAJ,EAAI;IAChD,IAAII,QAAQ,GAAGmxB,QAAf;;IAEA,IAAI,OAAOzB,KAAP,KAAiB,QAArB,EAA+B;MAC7B;MACA;MACA1vB,QAAQ,GAAG0vB,KAAX;MACAA,KAAK,GAAGxC,UAAR;MACAttB,OAAO,GAAGuxB,QAAQ,IAAI,EAAtB;IACD;;IAED,IAAI,OAAOnxB,QAAP,KAAoB,UAAxB,EAAoC;MAClCQ,mDAAQ,CAAC,6BAAD,CAAR;MACA;IACD;;IAED,IAAM4wB,EAAE,GAAG;MAAE1B,KAAK,EAALA,KAAF;MAAS1vB,QAAQ,EAARA;IAAT,CAAX;IACAotB,SAAS,CAAC9sB,IAAV,CAAe8wB,EAAf;;IAEA,IAAIxxB,OAAO,CAACyxB,IAAZ,EAAkB;MAChB,IAAI3B,KAAK,KAAKxC,UAAd,EAA0B;QACxBltB,QAAQ,CAACyB,SAAS,EAAV,CAAR;MACD,CAFD,MAEO;QACL;QACAzB,QAAQ,CAAC,sFAAE0vB,KAAH,EAAWjuB,SAAS,CAACiuB,KAAD,CAApB,EAAR;MACD;IACF,CA1B+C,CA4BhD;;;IACA,OAAO,SAAS4B,WAAT,GAAuB;MAC5BlE,SAAS,CAACmE,MAAV,CAAiBnE,SAAS,CAACoE,OAAV,CAAkBJ,EAAlB,CAAjB,EAAwC,CAAxC;IACD,CAFD;EAGD;EAED;AACF;AACA;;;EACE,SAAS3B,eAAT,CAAyB7vB,OAAzB,EAAkC;IAChC,IAAM6xB,MAAM,GAAGnrB,MAAM,CAAC0J,IAAP,CAAYpQ,OAAZ,CAAf,CADgC,CAGhC;;IACAwtB,SAAS,CACN/mB,MADH,CACU,UAAA8qB,QAAQ;MAAA,OAAI7jB,sDAAQ,CAACmkB,MAAD,EAASN,QAAQ,CAACzB,KAAlB,CAAZ;IAAA,CADlB,EAEG1nB,OAFH,CAEW,UAAAmpB,QAAQ,EAAI;MACnBA,QAAQ,CAACnxB,QAAT,uFAAqBmxB,QAAQ,CAACzB,KAA9B,EAAsC9vB,OAAO,CAACuxB,QAAQ,CAACzB,KAAV,CAA7C;IACD,CAJH,EAJgC,CAUhC;;IACAtC,SAAS,CACN/mB,MADH,CACU,UAAA8qB,QAAQ;MAAA,OAAIA,QAAQ,CAACzB,KAAT,KAAmBxC,UAAvB;IAAA,CADlB,EAEGllB,OAFH,CAEW,UAAAmpB,QAAQ;MAAA,OAAIA,QAAQ,CAACnxB,QAAT,CAAkBJ,OAAlB,CAAJ;IAAA,CAFnB;EAGD;;EAED,SAAS8xB,eAAT,CAAyB5xB,MAAzB,EAAoD;IAAA,IAAnB6xB,SAAmB,uEAAP,KAAO;;IAClD,IAAI;MACFC,KAAK,CAAC9xB,MAAD,CAAL;MACAA,MAAM,CAACoE,OAAP,CAAe8D,OAAf,CAAuB,UAAAtD,MAAM,EAAI;QAC/B,IAAI,CAAC4oB,YAAY,CAAC5oB,MAAD,CAAjB,EAA2B;UACzB4oB,YAAY,CAAC5oB,MAAD,CAAZ,GAAuB,EAAvB;QACD;;QACD4B,MAAM,CAAC0J,IAAP,CAAYlQ,MAAM,CAACA,MAAnB,EAA2BkI,OAA3B,CAAmC,UAAA0nB,KAAK,EAAI;UAC1C,IAAIC,MAAM,GAAG7vB,MAAM,CAACA,MAAP,CAAc4vB,KAAd,CAAb;;UAEA,IAAI5e,wDAAa,CAAC6e,MAAD,CAAjB,EAA2B;YACzB,IAAMpvB,IAAI,GAAGoxB,SAAS,GAAG/mB,gDAAH,GAAetE,MAAM,CAACC,MAA5C;YACA+mB,YAAY,CAAC5oB,MAAD,CAAZ,CAAqBgrB,KAArB,IAA8BnvB,IAAI,CAAC,EAAD,EAAK+sB,YAAY,CAAC5oB,MAAD,CAAZ,CAAqBgrB,KAArB,KAA+B,EAApC,EAAwCC,MAAxC,CAAlC;UACD,CAHD,MAGO;YACLrC,YAAY,CAAC5oB,MAAD,CAAZ,CAAqBgrB,KAArB,IAA8BC,MAA9B;UACD;QACF,CATD;MAUD,CAdD;IAeD,CAjBD,CAiBE,OAAOhiB,CAAP,EAAU;MACVnN,mDAAQ,CAACmN,CAAD,CAAR;IACD;;IAED,SAASikB,KAAT,CAAerR,GAAf,EAAoB;MAClB,IAAI,CAACzP,wDAAa,CAACyP,GAAD,CAAlB,EAAyB;QACvB,MAAM,kDAAN;MACD;;MACD,IAAI,EAAE7P,KAAK,CAAC/K,OAAN,CAAc4a,GAAG,CAACrc,OAAlB,KAA8Bqc,GAAG,CAACrc,OAAJ,CAAYlC,MAA5C,CAAJ,EAAyD;QACvD,MAAM,mFAAN;MACD;;MACD,IAAI,CAAC8O,wDAAa,CAACyP,GAAG,CAACzgB,MAAL,CAAlB,EAAgC;QAC9B,MAAM,6DAAN;MACD;IACF;EACF;;EAED,SAAS+xB,WAAT,CAAqBtR,GAArB,EAA0B;IACxB,IAAI,CAACzP,wDAAa,CAACyP,GAAD,CAAlB,EAAyB;MACvB/f,mDAAQ,CAAC,qCAAD,CAAR;MACA;IACD;;IAED,IAAMsxB,YAAY,GAAGlnB,oDAAS,CAACmlB,UAAU,EAAX,EAAexP,GAAf,CAA9B;IAEAwQ,SAAS,mBAAMe,YAAN,EAAT;IACA,OAAOA,YAAP;EACD;;EAED,SAASC,iBAAT,CAA2BxR,GAA3B,EAAgC;IAC9B,OAAOmR,eAAe,CAACnR,GAAD,EAAM,IAAN,CAAtB;EACD;EAED;AACF;AACA;;;EACE,SAASyR,aAAT,CAAuBttB,MAAvB,EAA+B/C,EAA/B,EAAmC;IACjC4rB,UAAU,GAAG7oB,MAAb;;IACA,IAAI;MACF,OAAO/C,EAAE,EAAT;IACD,CAFD,SAEU;MACRswB,WAAW;IACZ;EACF;;EACD,SAASC,kBAAT,CAA4BxtB,MAA5B,EAAoC;IAClC,OAAO,UAASggB,EAAT,EAAa;MAClB,OAAO,YAAkB;QACvB,IAAI,OAAOA,EAAP,KAAc,UAAlB,EAA8B;UAAA,kCADbyN,IACa;YADbA,IACa;UAAA;;UAC5B,OAAOH,aAAa,CAACttB,MAAD,EAASpD,sDAAA,CAAAA,2CAAI,GAAMojB,EAAN,EAAU,IAAV,SAAmByN,IAAnB,EAAb,CAApB;QACD,CAFD,MAEO;UACLlxB,kDAAO,CAAC,sDAAD,CAAP;QACD;MACF,CAND;IAOD,CARD;EASD;;EAED,SAASmxB,gBAAT,GAA4B;IAC1B,OAAO7E,UAAP;EACD;;EAED,SAAS0E,WAAT,GAAuB;IACrB1E,UAAU,GAAG,IAAb;EACD;;EAEDC,WAAW;EAEX,OAAO;IACL4E,gBAAgB,EAAhBA,gBADK;IAELH,WAAW,EAAXA,WAFK;IAGLxwB,SAAS,EAATA,SAHK;IAILgvB,YAAY,EAAZA,YAJK;IAKLE,UAAU,EAAVA,UALK;IAMLE,aAAa,EAAbA,aANK;IAOLE,SAAS,EAATA,SAPK;IAQLc,WAAW,EAAXA,WARK;IASLX,WAAW,EAAXA,WATK;IAUL1D,WAAW,EAAXA,WAVK;IAWLwE,aAAa,EAAbA,aAXK;IAYLE,kBAAkB,EAAlBA,kBAZK;IAaLR,eAAe,EAAfA,eAbK;IAcLZ,eAAe,EAAfA,eAdK;IAeLiB,iBAAiB,EAAjBA;EAfK,CAAP;AAiBD;AAEM,IAAMjyB,MAAM,GAAGqtB,SAAS,EAAxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjlBP;AACA;;;;;;;;;;;;AAEO,IAAMkF,cAAb;EAOE,0BAAc;IAAA;;IAAA;;IAAA;MAAA;MAAA;IAAA;;IAAA;MAAA;MAAA;IAAA;;IAAA;MAAA;MAAA;IAAA;;IAAA;MAAA;MAAA;IAAA;;IAAA;;IACZ,KAAKC,KAAL;EACD;;EATH;IAAA;IAAA;IAiBE;AACF;AACA;IACE,iBAAQ;MACN,sGAAcC,wDAAK,EAAnB;;MACA,wGAAgB,KAAhB;;MACA,qGAAa,IAAb;;MACA,sGAAc,KAAd;;MACA,KAAKC,aAAL,GAAqB,IAArB;IACD;IAED;AACF;AACA;AACA;;EA/BA;IAAA;IAAA,OAgCE,kBAAS;MACP,wGAAgB,IAAhB;IACD;IAED;AACF;AACA;;EAtCA;IAAA;IAAA,KAuCE,eAAc;MACZ,OAAO,4FAAP;IACD;IAED;AACF;AACA;;EA7CA;IAAA;IAAA,KA8CE,eAAY;MACV,OAAO,4FAAP;IACD;IAED;AACF;AACA;;EApDA;IAAA;IAAA,KAqDE,eAAc;MACZ,IAAI,4FAAJ,WAAiB;QACf,OAAOzQ,oEAAA,yFAAsB,IAAtB,SAAP;MACD;;MACD,IAAI,CAAC,4FAAD,WAAJ,EAAoB;QAClB,6DAAc,IAAd;MACD;;MACD,OAAO,sGAAY0Q,OAAnB;IACD;EA7DH;IAAA;IAAA,OA+DE,wBAAe9uB,IAAf,EAAyC;MAAA,IAApB+uB,IAAoB,uEAAbrlB,oDAAS,EAAI;MACvC,KAAKmlB,aAAL,GAAqBE,IAArB;;MACA,6DAAc/uB,IAAd;IACD;EAlEH;IAAA;IAAA,OAoEE,0BAAiB;MACf,OAAO,4FAAP;IACD;EAtEH;;EAAA;AAAA;;mBAWWA,MAAM;EACb,sGAAc,IAAd;;EACA,qGAAaA,IAAb;;EACA,sGAAYgvB,OAAZ,CAAoBhvB,IAApB;AACD;;AA0DI,IAAM4E,iBAAb;EAAA;;EAAA;;EAAA;IAAA;;IAAA;EAAA;;EAAA;IAAA;IAAA,OACE,0BAAiB;MACf,IAAMqqB,WAAW,GAAG,KAAKnnB,cAAL,EAApB;;MACA,IAAImnB,WAAW,IAAI,KAAKJ,aAAxB,EAAuC;QACrC,OAAO;UACLK,GAAG,EAAED,WADA;UAELE,WAAW,EAAE,KAAKN;QAFb,CAAP;MAID;IACF;EATH;;EAAA;AAAA,EAAuCH,cAAvC;AAYO,IAAMhqB,kBAAb;EAAA;;EAAA;;EAAA;IAAA;;IAAA;EAAA;;EAAA;IAAA;IAAA,OACE,0BAAiB;MACf,IAAMuqB,WAAW,GAAG,KAAKnnB,cAAL,EAApB;;MACA,IAAImnB,WAAW,IAAIA,WAAW,CAACG,UAA3B,IAAyC,KAAKP,aAAlD,EAAiE;QAC/D,OAAO;UACLQ,WAAW,EAAEJ,WAAW,CAACI,WADpB;UAELC,iBAAiB,EAAGpD,gDAAK,CAAC+C,WAAW,CAACG,UAAZ,CAAuBG,QAAxB,CAAN,GAA2CN,WAAW,CAACG,UAAZ,CAAuBG,QAAvB,CAAgClxB,MAA3E,GAAoF,CAFlG;UAGL8wB,WAAW,EAAE,KAAKN,aAHb;UAILW,UAAU,EAAEP,WAAW,CAACO;QAJnB,CAAP;MAMD;IACF;EAXH;;EAAA;AAAA,EAAwCd,cAAxC;;;;;;;;;;;;;;;;;;ACxFA;AACA;AACA;AAEA,IAAMe,iBAAiB,GAAG,CAA1B;AACA,IAAMC,cAAc,GAAG;EACrB,WAAW,CAAC;IACV,OAAO,CADG;IAEV,aAAa;EAFH,CAAD;AADU,CAAvB;AAMA,IAAMC,cAAc,GAAG;EACrB,WAAW,CAAC;IACV,OAAO,EADG;IAEV,aAAa;EAFH,CAAD;AADU,CAAvB;AAMA,IAAMC,cAAc,GAAG;EACrB,WAAW,CAAC;IACV,OAAO,EADG;IAEV,aAAa;EAFH,CAAD;AADU,CAAvB;AAMA,IAAMC,iBAAiB,GAAG;EACxB,WAAW,CAAC;IACV,OAAO,CADG;IAEV,aAAa;EAFH,CAAD,EAIX;IACE,OAAO,CADT;IAEE,aAAa;EAFf,CAJW,EAQX;IACE,OAAO,EADT;IAEE,aAAa;EAFf,CARW;AADa,CAA1B;AAcA,IAAMC,gBAAgB,GAAG;EACvB,WAAW,CAAC;IACV,OAAO,CADG;IAEV,aAAa;EAFH,CAAD,EAIX;IACE,OAAO,EADT;IAEE,aAAa;EAFf,CAJW,EAQX;IACE,OAAO,EADT;IAEE,aAAa;EAFf,CARW;AADY,CAAzB;;AAeA,SAASlO,oBAAT,CAA8BvS,GAA9B,EAAmC0gB,YAAnC,EAA4E;EAAA,IAA3BC,qBAA2B,uEAAH,CAAG;EAC1E,IAAIC,QAAQ,GAAG5O,UAAU,CAAChS,GAAD,CAAzB;;EACA,IAAI6gB,KAAK,CAACD,QAAD,CAAT,EAAqB;IACnBA,QAAQ,GAAG,EAAX;EACD;;EAED,OAAO;IACLnO,GAAG,EAAGmO,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAMqgB,cAAN,EAAsBM,qBAAtB,CAD1C;IAELhO,GAAG,EAAGiO,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAMsgB,cAAN,EAAsBK,qBAAtB,CAF1C;IAGL9N,IAAI,EAAG+N,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAMugB,cAAN,EAAsBI,qBAAtB,CAH3C;IAIL5N,IAAI,EAAG6N,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAMygB,gBAAN,EAAwBE,qBAAxB,CAJ3C;IAKL1N,KAAK,EAAG2N,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAMwgB,iBAAN,EAAyBG,qBAAzB,CAL5C;IAMLxN,MAAM,EAAGyN,QAAQ,KAAK,EAAd,GAAoB,EAApB,GAAyBE,iBAAiB,CAAC9gB,GAAD,EAAM0gB,YAAN,EAAoBC,qBAApB;EAN7C,CAAP;AAQD;;AAED,SAASG,iBAAT,CAA2B9gB,GAA3B,EAAgClT,MAAhC,EAAwC6zB,qBAAxC,EAA+D;EAC7D,IAAII,MAAM,GAAG,EAAb;;EACA,IAAI,CAACnE,kBAAkB,CAAC9vB,MAAD,CAAvB,EAAiC;IAC/B,OAAOi0B,MAAP;EACD;;EACD,IAAMC,GAAG,GAAGl0B,MAAM,CAACm0B,OAAP,CAAe/tB,MAAf,CAAsB,UAACguB,IAAD,EAAOC,IAAP,EAAgB;IAChD,IAAID,IAAI,CAACE,GAAL,GAAWD,IAAI,CAACC,GAApB,EAAyB;MACvB,OAAOF,IAAP;IACD;;IACD,OAAOC,IAAP;EACD,CALW,EAKT;IACD,OAAO;EADN,CALS,CAAZ;EASA,IAAIE,WAAW,GAAG,CAAlB;EACA,IAAIC,MAAM,GAAGzxB,kDAAI,CAAC/C,MAAM,CAACm0B,OAAR,EAAiB,UAAAK,MAAM,EAAI;IAC1C,IAAIthB,GAAG,GAAGghB,GAAG,CAACI,GAAJ,GAAUT,qBAApB,EAA2C;MACzC;MACA,IAAIY,SAAS,GAAGD,MAAM,CAACC,SAAvB;;MACA,IAAI,OAAOA,SAAP,KAAqB,WAAzB,EAAsC;QACpCA,SAAS,GAAGnB,iBAAZ;MACD;;MACDW,MAAM,GAAG,CAACO,MAAM,CAACF,GAAP,GAAaT,qBAAd,EAAqCa,OAArC,CAA6CD,SAA7C,CAAT;IACD,CAPD,MAOO,IAAIvhB,GAAG,IAAIshB,MAAM,CAACF,GAAP,GAAaT,qBAApB,IAA6C3gB,GAAG,IAAIqhB,WAAW,GAAGV,qBAAtE,EAA6F;MAClGW,MAAM,CAAChU,GAAP,GAAa+T,WAAb;MACA,OAAOC,MAAP;IACD,CAHM,MAGA;MACLD,WAAW,GAAGC,MAAM,CAACF,GAArB;IACD;EACF,CAdgB,CAAjB;;EAeA,IAAIE,MAAJ,EAAY;IACVP,MAAM,GAAGU,YAAY,CAACzhB,GAAD,EAAMshB,MAAN,EAAcX,qBAAd,CAArB;EACD;;EACD,OAAOI,MAAP;AACD;;AAED,SAASnE,kBAAT,CAA4B9vB,MAA5B,EAAoC;EAClC,IAAI+iB,kDAAO,CAAC/iB,MAAD,CAAP,IAAmB,CAACA,MAAM,CAACm0B,OAA3B,IAAsC,CAACvjB,KAAK,CAAC/K,OAAN,CAAc7F,MAAM,CAACm0B,OAArB,CAA3C,EAA0E;IACxE,OAAO,KAAP;EACD;;EACD,IAAI5iB,OAAO,GAAG,IAAd;EACAvR,MAAM,CAACm0B,OAAP,CAAejsB,OAAf,CAAuB,UAAAssB,MAAM,EAAI;IAC/B,IAAI,CAACA,MAAM,CAACF,GAAR,IAAe,CAACE,MAAM,CAACvU,SAA3B,EAAsC;MACpC1O,OAAO,GAAG,KAAV;IACD;EACF,CAJD;EAKA,OAAOA,OAAP;AACD;;AAED,SAASojB,YAAT,CAAsBzhB,GAAtB,EAA2BshB,MAA3B,EAAmCX,qBAAnC,EAA0D;EACxD,IAAMY,SAAS,GAAG,OAAOD,MAAM,CAACC,SAAd,KAA4B,WAA5B,GAA0CD,MAAM,CAACC,SAAjD,GAA6DnB,iBAA/E;EACA,IAAMrT,SAAS,GAAGuU,MAAM,CAACvU,SAAP,GAAmB4T,qBAArC;EACA,IAAMe,SAAS,GAAGJ,MAAM,CAAChU,GAAP,GAAaqT,qBAA/B;EACA,IAAIgB,gBAAgB,GAAGtU,IAAI,CAACuU,KAA5B;EACA,IAAIC,sBAAsB,GAAG/0B,wDAAA,CAAiB,qBAAjB,CAA7B;;EACA,IAAI,OAAO+0B,sBAAP,KAAkC,UAAtC,EAAkD;IAChDF,gBAAgB,GAAGE,sBAAnB;EACD,CARuD,CAUxD;EACA;EACA;EACA;EACA;;;EACA,IAAIC,GAAG,GAAGzU,IAAI,CAACyU,GAAL,CAAS,EAAT,EAAaP,SAAS,GAAG,CAAzB,CAAV;EACA,IAAIQ,UAAU,GAAG,CAAE/hB,GAAG,GAAG8hB,GAAP,GAAeJ,SAAS,GAAGI,GAA5B,KAAqC/U,SAAS,GAAG+U,GAAjD,CAAjB;EACA,IAAIE,SAAJ;EACA,IAAIC,eAAJ,CAlBwD,CAmBxD;EACA;;EACA,IAAI;IACFD,SAAS,GAAIL,gBAAgB,CAACI,UAAD,CAAhB,GAA+BhV,SAAhC,GAA6C2U,SAAzD;EACD,CAFD,CAEE,OAAOpf,GAAP,EAAY;IACZ2f,eAAe,GAAG,IAAlB;EACD;;EACD,IAAIA,eAAe,IAAI,OAAOD,SAAP,KAAqB,QAA5C,EAAsD;IACpD/zB,kDAAO,CAAC,4CAAD,CAAP;IACA+zB,SAAS,GAAI3U,IAAI,CAACuU,KAAL,CAAWG,UAAX,IAAyBhV,SAA1B,GAAuC2U,SAAnD;EACD,CA7BuD,CA8BxD;EACA;;;EAEAM,SAAS,GAAG5oB,MAAM,CAAC4oB,SAAS,CAACR,OAAV,CAAkB,EAAlB,CAAD,CAAlB;EACA,OAAOQ,SAAS,CAACR,OAAV,CAAkBD,SAAlB,CAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;ACxJD;AACA;AACA;AACA;AACA;AACA;AACA;AAEO,IAAMW,SAAS,GAAG,oBAAlB;;AAEP,SAASC,oBAAT,GAAgC;EAC9B,OAAO/J,2DAAS,GAAGgK,gBAAZ,CAA6B9nB,QAA7B,CAAsC,WAAtC,CAAP;AACD;;AAED,SAAS+nB,UAAT,CAAoBx1B,GAApB,EAAyB;EACvB,OAAO,IAAIkiB,4DAAJ,CAAkB,UAAC4Q,OAAD,EAAa;IACpCvxB,gEAAkB,CAACvB,GAAD,EAAM,WAAN,EAAmB8yB,OAAnB,CAAlB;EACD,CAFM,CAAP;AAGD;;AAEM,SAAS2C,qBAAT,GAAoG;EAAA,+EAAJ,EAAI;EAAA,iCAApEC,gBAAoE;EAAA,IAApEA,gBAAoE,sCAAjDJ,oBAAiD;EAAA,uBAA3BK,MAA2B;EAAA,IAA3BA,MAA2B,4BAAlBH,UAAkB;;EACzG,IAAII,OAAO,GAAG,IAAd;EACA,OAAO,YAAY;IACjB,IAAIA,OAAO,IAAI,IAAf,EAAqB;MACnBA,OAAO,GAAG,IAAI1T,4DAAJ,CAAkB,UAAC4Q,OAAD,EAAU+C,MAAV,EAAqB;QAC/C;QACAhX,UAAU,CAAC,YAAM;UACf,IAAI6W,gBAAgB,EAApB,EAAwB;YACtB5C,OAAO;UACR,CAFD,MAEO;YACL,IAAM9yB,GAAG,GAAG,oCAAZ;YACAkC,qDAAU,6DAAqDlC,GAArD,WAAV;YACAurB,2DAAS,GAAGuK,iBAAZ,GAAgC,IAAhC;YACAH,MAAM,CAAC31B,GAAD,CAAN,CAAYmiB,IAAZ,CAAiB,YAAM;cACrBoJ,2DAAS,GAAGuK,iBAAZ,CAA8B;gBAACT,SAAS,EAATA,SAAD;gBAAY5tB,IAAI,EAAJA,0CAAZ;gBAAkBxH,MAAM,EAANA,8CAAlB;gBAA0BuT,SAAS,EAATA,qDAA1B;gBAAqCuiB,MAAM,EAAEC,oDAAS,CAAC,QAAD;cAAtD,CAA9B;YACD,CAFD,EAEG7T,IAFH,CAEQ2Q,OAFR,EAEiB+C,MAFjB;UAGD;QACF,CAXS,CAAV;MAYD,CAdS,CAAV;IAeD;;IACD,OAAOD,OAAP;EACD,CAnBD;AAoBD;AAEM,SAASK,iBAAT,GAAiG;EAAA,gFAAJ,EAAI;EAAA,uBAArEC,IAAqE;EAAA,IAArEA,IAAqE,2BAA9DT,qBAAqB,EAAyC;EAAA,uBAArChuB,IAAqC;EAAA,IAArCA,IAAqC,2BAA9BqQ,iDAAO,CAAC,aAAD,CAAuB;;EACtG,IAAI8a,OAAO,GAAG,IAAd;EACA,IAAIzpB,OAAO,GAAG,KAAd;;EACA,SAASgtB,gBAAT,CAA0BC,IAA1B,EAAyC;IAAA;;IAAA,kCAAN9D,IAAM;MAANA,IAAM;IAAA;;IACvC,OAAO,CAACM,OAAO,IAAI1Q,oEAAA,EAAZ,EAAqCC,IAArC,CAA0C;MAAA,OAAMiU,IAAI,CAACj1B,KAAL,CAAW,KAAX,EAAiBmxB,IAAjB,CAAN;IAAA,CAA1C,CAAP;EACD;;EACD,SAAS+D,MAAT,GAAkB;IAChB,IAAI,CAACltB,OAAL,EAAc;MACZypB,OAAO,GAAGsD,IAAI,EAAd,CADY,CAEZ;;MACAzuB,IAAI,CAACsQ,MAAL,CAAYoe,gBAAZ,EAA8B,EAA9B;MACAhtB,OAAO,GAAG,IAAV;IACD;EACF;;EACD,SAASmtB,OAAT,GAAmB;IACjB7uB,IAAI,CAAC8uB,QAAL,CAAc;MAAC9uB,IAAI,EAAE0uB;IAAP,CAAd,EAAwCK,MAAxC;IACArtB,OAAO,GAAG,KAAV;EACD;;EACD,SAASspB,KAAT,GAAiB;IACfG,OAAO,GAAG,IAAV;IACA0D,OAAO;EACR;;EACD,OAAO;IAACD,MAAM,EAANA,MAAD;IAASC,OAAO,EAAPA,OAAT;IAAkB7D,KAAK,EAALA;EAAlB,CAAP;AACD;AAED,IAAMgE,GAAG,GAAGR,iBAAiB,EAA7B;AACO,IAAMxD,KAAK,GAAGgE,GAAG,CAAChE,KAAlB;AAEA,SAASiE,WAAT,GAAuB;EAC5B,IAAIlmB,OAAO,GAAG,IAAd;;EACA,IAAI;IACFA,OAAO,GAAGsK,MAAM,CAAC6b,cAAjB;EACD,CAFD,CAEE,OAAO7oB,CAAP,EAAU,CAAE;;EAEd,IAAI0C,OAAO,KAAK,IAAhB,EAAsB;IACpB,IAAIomB,SAAS,GAAGH,GAAhB;IACA,IAAIx2B,OAAM,GAAG,IAAb;;IACA,IAAI;MACFA,OAAM,GAAGuQ,OAAO,CAACqmB,OAAR,CAAgBxB,SAAhB,CAAT;IACD,CAFD,CAEE,OAAOvnB,CAAP,EAAU,CAAE;;IACd,IAAI7N,OAAM,KAAK,IAAf,EAAqB;MACnB;MACA22B,SAAS,CAACP,MAAV;IACD;EACF;AACF;AAEDp2B,wDAAA,CAAiB,WAAjB,EAA8B,iBAAuB;EAAA,IAAZ22B,SAAY,SAAZA,SAAY;EACnDA,SAAS,SAAT,IAAAA,SAAS,WAAT,IAAAA,SAAS,CAAEztB,OAAX,GAAqBstB,GAAG,CAACJ,MAAJ,EAArB,GAAoCI,GAAG,CAACH,OAAJ,EAApC;AACD,CAFD;;;;;;;;;;;;;;;;;;;;AC3FA;AACA;AACA;AACA;AACA;AAEA,IAAInO,KAAK,GAAGtX,KAAK,CAAClP,SAAN,CAAgBwmB,KAA5B;AACA,IAAI1nB,IAAI,GAAGoQ,KAAK,CAAClP,SAAN,CAAgBlB,IAA3B,EAEA;AACA;;AACA,IAAIq2B,SAAS,GAAGC,2CAAA,CAAWvzB,mDAAX,EAA6B,UAAUwzB,CAAV,EAAa;EACxD,OAAOA,CAAP;AACD,CAFe,CAAhB;;AAIA,IAAIC,OAAO,GAAGzzB,2DAAd,EAEA;;AACA,IAAI0zB,WAAW,GAAG,EAAlB;;AACA,IAAMC,OAAO,GAAI,YAAY;EAC3B,IAAIC,SAAS,GAAG,EAAhB;EACA,IAAID,OAAO,GAAG,EAAd;EAEA;AACF;AACA;AACA;AACA;AACA;;EACE,SAASE,SAAT,CAAmBC,WAAnB,EAAgChF,IAAhC,EAAsC;IACpCyE,iDAAA,CAAiB,yBAAyBO,WAA1C;IAEA,IAAIC,YAAY,GAAGjF,IAAI,CAAC,CAAD,CAAJ,IAAW,EAA9B;IACA,IAAIkF,MAAM,GAAGP,OAAO,CAACK,WAAD,CAApB;IACA,IAAI/f,GAAG,GAAGggB,YAAY,CAACC,MAAD,CAAtB;IACA,IAAIC,KAAK,GAAGL,SAAS,CAACE,WAAD,CAAT,IAA0B;MAAEI,GAAG,EAAE;IAAP,CAAtC;;IACA,IAAIC,SAAS,GAAGZ,2CAAA,CAAWU,KAAX,EAAkB,UAAUT,CAAV,EAAata,CAAb,EAAgB;MAChD,OAAOA,CAAP;IACD,CAFe,CAAhB;;IAIA,IAAI/C,SAAS,GAAG,EAAhB,CAXoC,CAapC;;IACAud,WAAW,CAACz2B,IAAZ,CAAiB;MACfm3B,SAAS,EAAEN,WADI;MAEfhF,IAAI,EAAEiF,YAFS;MAGfr3B,EAAE,EAAEqX,GAHW;MAIfsgB,WAAW,EAAEd,wDAAA;IAJE,CAAjB;IAOA;AACJ;AACA;AACA;AACA;AACA;;IACI,IAAIxf,GAAG,IAAIwf,+CAAA,CAAeY,SAAf,EAA0BpgB,GAA1B,CAAX,EAA2C;MACzC9W,IAAI,CAACU,KAAL,CAAWwY,SAAX,EAAsB8d,KAAK,CAAClgB,GAAD,CAAL,CAAWmgB,GAAjC;IACD;IAED;;;IACAj3B,IAAI,CAACU,KAAL,CAAWwY,SAAX,EAAsB8d,KAAK,CAACC,GAA5B;IAEA;;IACAX,4CAAA,CAAYpd,SAAZ,EAAuB,UAAU7X,EAAV,EAAc;MACnC,IAAI,CAACA,EAAL,EAAS;;MACT,IAAI;QACFA,EAAE,CAACX,KAAH,CAAS,IAAT,EAAemxB,IAAf;MACD,CAFD,CAEE,OAAOxkB,CAAP,EAAU;QACVipB,+CAAA,CAAe,0BAAf,EAA2C,WAA3C,EAAwDjpB,CAAxD;MACD;IACF,CAPD;EAQD;;EAED,SAASgqB,oBAAT,CAA8BL,KAA9B,EAAqC;IACnC,OAAOV,+CAAA,CAAeD,SAAf,EAA0BW,KAA1B,CAAP;EACD;;EAEDN,OAAO,CAACY,EAAR,GAAa,UAAUT,WAAV,EAAuBU,OAAvB,EAAgC93B,EAAhC,EAAoC;IAC/C;IACA,IAAI43B,oBAAoB,CAACR,WAAD,CAAxB,EAAuC;MACrC,IAAIG,KAAK,GAAGL,SAAS,CAACE,WAAD,CAAT,IAA0B;QAAEI,GAAG,EAAE;MAAP,CAAtC;;MAEA,IAAIx3B,EAAJ,EAAQ;QACNu3B,KAAK,CAACv3B,EAAD,CAAL,GAAYu3B,KAAK,CAACv3B,EAAD,CAAL,IAAa;UAAEw3B,GAAG,EAAE;QAAP,CAAzB;QACAD,KAAK,CAACv3B,EAAD,CAAL,CAAUw3B,GAAV,CAAcj3B,IAAd,CAAmBu3B,OAAnB;MACD,CAHD,MAGO;QACLP,KAAK,CAACC,GAAN,CAAUj3B,IAAV,CAAeu3B,OAAf;MACD;;MAEDZ,SAAS,CAACE,WAAD,CAAT,GAAyBG,KAAzB;IACD,CAXD,MAWO;MACLV,+CAAA,CAAe,wBAAwBO,WAAxB,GAAsC,sBAAtC,GAA+DR,SAA9E;IACD;EACF,CAhBD;;EAkBAK,OAAO,CAACc,IAAR,GAAe,UAAUR,KAAV,EAAiB;IAC9B,IAAInF,IAAI,GAAGnK,KAAK,CAACvnB,IAAN,CAAWI,SAAX,EAAsB,CAAtB,CAAX;;IACAq2B,SAAS,CAACI,KAAD,EAAQnF,IAAR,CAAT;EACD,CAHD;;EAKA6E,OAAO,CAACe,GAAR,GAAc,UAAUZ,WAAV,EAAuBU,OAAvB,EAAgC93B,EAAhC,EAAoC;IAChD,IAAIu3B,KAAK,GAAGL,SAAS,CAACE,WAAD,CAArB;;IAEA,IAAIP,8CAAA,CAAcU,KAAd,KAAyBV,8CAAA,CAAcU,KAAK,CAACC,GAApB,KAA4BX,8CAAA,CAAcU,KAAK,CAACv3B,EAAD,CAAnB,CAAzD,EAAoF;MAClF;IACD;;IAED,IAAIA,EAAE,KAAK62B,8CAAA,CAAcU,KAAK,CAACv3B,EAAD,CAAnB,KAA4B62B,8CAAA,CAAcU,KAAK,CAACv3B,EAAD,CAAL,CAAUw3B,GAAxB,CAAjC,CAAN,EAAsE;MACpE;IACD;;IAED,IAAIx3B,EAAJ,EAAQ;MACN62B,4CAAA,CAAYU,KAAK,CAACv3B,EAAD,CAAL,CAAUw3B,GAAtB,EAA2B,UAAUS,QAAV,EAAoB;QAC7C,IAAIT,GAAG,GAAGD,KAAK,CAACv3B,EAAD,CAAL,CAAUw3B,GAApB;;QACA,IAAIS,QAAQ,KAAKH,OAAjB,EAA0B;UACxBN,GAAG,CAAChG,MAAJ,CAAWgG,GAAG,CAAC/F,OAAJ,CAAYwG,QAAZ,CAAX,EAAkC,CAAlC;QACD;MACF,CALD;IAMD,CAPD,MAOO;MACLpB,4CAAA,CAAYU,KAAK,CAACC,GAAlB,EAAuB,UAAUS,QAAV,EAAoB;QACzC,IAAIT,GAAG,GAAGD,KAAK,CAACC,GAAhB;;QACA,IAAIS,QAAQ,KAAKH,OAAjB,EAA0B;UACxBN,GAAG,CAAChG,MAAJ,CAAWgG,GAAG,CAAC/F,OAAJ,CAAYwG,QAAZ,CAAX,EAAkC,CAAlC;QACD;MACF,CALD;IAMD;;IAEDf,SAAS,CAACE,WAAD,CAAT,GAAyBG,KAAzB;EACD,CA5BD;;EA8BAN,OAAO,CAACxhB,GAAR,GAAc,YAAY;IACxB,OAAOyhB,SAAP;EACD,CAFD;EAIA;AACF;AACA;AACA;;;EACED,OAAO,CAACiB,SAAR,GAAoB,YAAY;IAC9B,IAAIC,SAAS,GAAG,EAAhB;;IACAtB,4CAAA,CAAYG,WAAZ,EAAyB,UAAUxb,KAAV,EAAiB;MACxC,IAAI4c,OAAO,GAAG7xB,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBgV,KAAlB,CAAd;MACA2c,SAAS,CAAC53B,IAAV,CAAe63B,OAAf;IACD,CAHD;;IAKA,OAAOD,SAAP;EACD,CARD;;EAUA,OAAOlB,OAAP;AACD,CAnIgB,EAAjB;;AAqIAJ,uDAAA,CAAuBI,OAAO,CAACc,IAAR,CAAax2B,IAAb,CAAkB01B,OAAlB,CAAvB;;AAEO,IAAOY,EAAP,GAAwCZ,OAAxC,CAAOY,EAAP;AAAA,IAAWG,GAAX,GAAwCf,OAAxC,CAAWe,GAAX;AAAA,IAAgBviB,GAAhB,GAAwCwhB,OAAxC,CAAgBxhB,GAAhB;AAAA,IAAqByiB,SAArB,GAAwCjB,OAAxC,CAAqBiB,SAArB;AAAA,IAAgCH,IAAhC,GAAwCd,OAAxC,CAAgCc,IAAhC;;;;;;;;;;;;;;;;;;;;;;;;;;AC1JP;AACA;AAEO,IAAIxwB,IAAI,GAAG8wB,iEAAQ,CAAC;EACzBvW,KAAK,EAAEuW,wEAAA,GAAgBA,yEAAhB,GAAiCA,yEAAcC;AAD7B,CAAD,CAAnB;AAIP,IAAMC,QAAQ,GAAG/F,wDAAK,EAAtB;;AACAjrB,IAAI,CAACua,KAAL,GAAc,YAAM;EAClB,IAAMA,KAAK,GAAGva,IAAI,CAACua,KAAnB;EACA,OAAO,YAAY;IACjB,IAAI;MACF,OAAOA,KAAK,CAAC7gB,KAAN,CAAYsG,IAAZ,EAAkBzG,SAAlB,CAAP;IACD,CAFD,SAEU;MACRy3B,QAAQ,CAAC3F,OAAT;IACD;EACF,CAND;AAOD,CATY,EAAb;AAWA;AACA;AACA;AACA;;;AACO,IAAM9Q,KAAK,GAAGyW,QAAQ,CAAC7F,OAAvB;AAEA,IAAM9a,OAAO,GAAGrQ,IAAI,CAACkO,GAArB;AAEA,SAAS+iB,qBAAT,CAA+BC,MAA/B,EAAuCC,MAAvC,EAA8D;EAAA,IAAfC,QAAe,uEAAJ,EAAI;EACnE,IAAIvyB,MAAM,GAAGqyB,MAAM,CAACpC,QAAP,CAAgB;IAAC9uB,IAAI,EAAEmxB;EAAP,CAAhB,CAAb;;EACA,IAAItyB,MAAM,CAACnE,MAAP,KAAkB,CAAtB,EAAyB;IACvBw2B,MAAM,CAAC5gB,MAAP,CAAc6gB,MAAd,EAAsBC,QAAtB;EACD;AACF;AACD,IAAMC,mBAAmB,GAAG,EAA5B;AAEO,SAASC,MAAT,CAAgBC,IAAhB,EAAsBt3B,OAAtB,EAAkE;EAAA,+EAAJ,EAAI;EAAA,iCAAlCu3B,kBAAkC;EAAA,IAAlCA,kBAAkC,sCAAb,KAAa;;EACvExxB,IAAI,CAAC,OAAD,EAAU,UAAUyxB,UAAV,EAAsB;IAClCA,UAAU,CAAC/wB,OAAX,CAAmB,UAAAmqB,IAAI;MAAA,OAAI5wB,OAAO,MAAP,8FAAW4wB,IAAX,EAAJ;IAAA,CAAvB;IACA,IAAI2G,kBAAJ,EAAwBH,mBAAmB,CAACE,IAAD,CAAnB,GAA4Bt3B,OAA5B;EACzB,CAHG,EAGDs3B,IAHC,CAAJ,CAGS,EAHT,EADuE,CAIzD;AACf;AAEM,SAASG,SAAT,CAAmBH,IAAnB,EAAkC;EAAA,kCAAN1G,IAAM;IAANA,IAAM;EAAA;;EACvC,IAAM5wB,OAAO,GAAGo3B,mBAAmB,CAACE,IAAD,CAAnC;EACA,IAAIt3B,OAAJ,EAAa,OAAOA,OAAO,MAAP,SAAW4wB,IAAX,CAAP;EACbxa,OAAO,CAACkhB,IAAD,CAAP,CAAcjhB,MAAd,CAAqB,UAACqe,IAAD,EAAOgD,OAAP,EAAmB;IACtCA,OAAO,CAAC34B,IAAR,CAAa6xB,IAAb;IACA8D,IAAI,CAACgD,OAAD,CAAJ;EACD,CAHD;AAID;AAED;AACA;AACA;;AACO,SAASC,QAAT,CAAkB5xB,IAAlB,EAAwB6xB,OAAxB,EAAiC;EACtC7yB,MAAM,CAAC8yB,gBAAP,CACED,OADF,EAEE7yB,MAAM,CAAC+yB,WAAP,CAAmB,CAAC,QAAD,EAAW,OAAX,EAAoB,UAApB,EAAgC,WAAhC,EAA6CpxB,GAA7C,CAAiD,UAACqxB,CAAD;IAAA,OAAO,CAACA,CAAD,EAAI;MAAC9jB,GAAG,EAAE;QAAA,OAAMlO,IAAI,CAACgyB,CAAD,CAAV;MAAA;IAAN,CAAJ,CAAP;EAAA,CAAjD,CAAnB,CAFF;EAIA,OAAOH,OAAP;AACD;;;;;;;;;;;;;;;;;AC5DD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACO,IAAMI,MAAM,GAAG,QAAf;AACP;;AACO,IAAM7S,KAAK,GAAG,OAAd;AACP;;AACO,IAAM8S,MAAM,GAAG,QAAf;AACP;;AACO,IAAMziB,KAAK,GAAG,OAAd;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnBP;AAcA;AACA;AACA;AACA;AAEO,IAAMhJ,cAAc,GAAG,EAAvB;AAEA,IAAM0rB,qBAAqB,GAAGnzB,MAAM,CAAC0J,IAAP,CAAY3M,wDAAZ,EAAmC4E,GAAnC,CACnC,UAAAmP,GAAG;EAAA,OAAI/T,wDAAA,CAAsB+T,GAAtB,CAAJ;AAAA,CADgC,CAA9B;AAIP,IAAMsiB,KAAK,GAAG;EACZC,IAAI,EAAE;IACJC,GAAG,EAAE,KADD;IAEJC,MAAM,EAAE,CACN;MACEC,QAAQ,EAAE,CADZ;MAEE/5B,EAAE,EAAE,CAFN;MAGEg6B,GAAG,EAAE;QACHhkB,IAAI,EAAE,CADH;QAEHikB,IAAI,EAAE,GAFH;QAGHC,IAAI,EAAE;MAHH;IAHP,CADM,EAUN;MACEH,QAAQ,EAAE,CADZ;MAEE/5B,EAAE,EAAE,CAFN;MAGEm6B,KAAK,EAAE;QACLC,GAAG,EAAE;MADA;IAHT,CAVM,EAiBN;MACEL,QAAQ,EAAE,CADZ;MAEE/5B,EAAE,EAAE,CAFN;MAGE4D,IAAI,EAAE;QACJoS,IAAI,EAAE;MADF;IAHR,CAjBM,EAwBN;MACE+jB,QAAQ,EAAE,CADZ;MAEE/5B,EAAE,EAAE,CAFN;MAGE4D,IAAI,EAAE;QACJoS,IAAI,EAAE;MADF;IAHR,CAxBM,EA+BN;MACE+jB,QAAQ,EAAE,CADZ;MAEE/5B,EAAE,EAAE,CAFN;MAGEg6B,GAAG,EAAE;QACHhkB,IAAI,EAAE,CADH;QAEHikB,IAAI,EAAE,EAFH;QAGHC,IAAI,EAAE;MAHH;IAHP,CA/BM;EAFJ,CADM;EA6CZxjB,KAAK,EAAE;IAAEqjB,QAAQ,EAAE;EAAZ,CA7CK;EA8CZI,KAAK,EAAE;IAAEJ,QAAQ,EAAE;EAAZ,CA9CK;EA+CZM,WAAW,EAAE;IAAEN,QAAQ,EAAE;EAAZ,CA/CD;EAgDZO,QAAQ,EAAE;IAAEP,QAAQ,EAAE;EAAZ,CAhDE;EAiDZ5kB,IAAI,EAAE;IAAE4kB,QAAQ,EAAE;EAAZ,CAjDM;EAkDZQ,IAAI,EAAE;IAAER,QAAQ,EAAE;EAAZ;AAlDM,CAAd;AAqDA,IAAMS,eAAe,GAAG;EACtB9jB,KAAK,EAAEijB;AADe,CAAxB;AAIA,IAAQc,kBAAR,GAAkIn3B,+DAAlI;AAAA,IAA4Bo3B,kBAA5B,GAAkIp3B,+DAAlI;AAAA,IAAgDq3B,+BAAhD,GAAkIr3B,4EAAlI;AAAA,IAAiFs3B,+BAAjF,GAAkIt3B,4EAAlI;AAAA,IAAkHu3B,WAAlH,GAAkIv3B,wDAAlI,EAEA;;AACA,IAAMw3B,uCAAuC,GAAGC,OAAO,CAACJ,+BAAD,CAAvD;AACA,IAAMK,0BAA0B,GAAGD,OAAO,CAACN,kBAAD,CAA1C;AAEA,IAAMQ,eAAe,GAAG;EACtBjB,GAAG,EAAE,CADiB;EAEtBkB,EAAE,EAAE,CAFkB;EAGtB,GAAG,KAHmB;EAItB,GAAG;AAJmB,CAAxB;AAOA,IAAMC,cAAc,GAAG;EACrBC,UAAU,EAAE,CADS;EAErB,kBAAkB,CAFG;EAGrB,mBAAmB,CAHE;EAIrB,oBAAoB;AAJC,CAAvB;AAOA;AACA;AACA;AACA;AACA;;AACO,SAASC,yBAAT,CAAmCvrB,MAAnC,EAA2C;EAChD,IAAIA,MAAM,IAAIA,MAAM,CAACkG,IAAjB,IAAyBslB,eAAe,CAACxrB,MAAM,CAACkG,IAAR,CAA5C,EAA2D;IACzDlG,MAAM,GAAG0qB,eAAe,CAAC1qB,MAAM,CAACkG,IAAR,CAAxB;EACD;;EAED,IAAIlG,MAAM,IAAIA,MAAM,CAAC8pB,IAAjB,IAAyB,CAAC2B,wBAAwB,CAACzrB,MAAM,CAAC8pB,IAAR,CAAtD,EAAqE;IACnE;EACD;;EACD,OAAO9pB,MAAP;AACD;AAEM,SAAS/F,+BAAT,CAAyCnH,OAAzC,EAAkD;EACvDA,OAAO,CAACqF,OAAR,CAAgB,UAAApF,MAAM,EAAI;IACxB,IAAM24B,YAAY,GAChB34B,MAAM,CAAC24B,YAAP,IAAuBv4B,qDAAU,CAACJ,MAAD,EAAS,mBAAT,CADnC;;IAEA,IAAI24B,YAAJ,EAAkB;MAChB34B,MAAM,CAAC24B,YAAP,GAAsBH,yBAAyB,CAACG,YAAD,CAA/C;IACD;;IACD,IAAI34B,MAAM,CAAC24B,YAAX,EAAyB;MACvB34B,MAAM,CAAC44B,iBAAP,GAA2B54B,MAAM,CAAC24B,YAAP,CAAoB5B,IAApB,IAA4B8B,mBAAmB,CAAC74B,MAAM,CAAC24B,YAAR,CAA1E;IACD;EACF,CATD;AAUD;AACM,SAASD,wBAAT,CAAkC3B,IAAlC,EAAwC;EAC7C,IAAME,MAAM,GAAGF,IAAI,CAACE,MAApB;;EACA,IAAI,CAACnpB,KAAK,CAAC/K,OAAN,CAAck0B,MAAd,CAAD,IAA0BA,MAAM,CAAC73B,MAAP,KAAkB,CAAhD,EAAmD;IACjDxB,mDAAQ,8EAA8Eq5B,MAA9E,CAAR;IACA,OAAO,KAAP;EACD,CAL4C,CAO7C;;;EACA,IAAM6B,GAAG,GAAG7B,MAAM,CAAC5xB,GAAP,CAAW,UAAA0zB,KAAK;IAAA,OAAIA,KAAK,CAAC57B,EAAV;EAAA,CAAhB,CAAZ;;EACA,IAAI85B,MAAM,CAAC73B,MAAP,KAAkB,IAAI8G,GAAJ,CAAQ4yB,GAAR,EAAa9S,IAA/B,IAAuC8S,GAAG,CAACtb,IAAJ,CAAS,UAAArgB,EAAE;IAAA,OAAIA,EAAE,KAAKmY,QAAQ,CAACnY,EAAD,EAAK,EAAL,CAAnB;EAAA,CAAX,CAA3C,EAAoF;IAClFS,mDAAQ,0FAAR;IACA,OAAO,KAAP;EACD;;EAED,IAAIm5B,IAAI,CAACiC,cAAL,CAAoB,eAApB,KAAwC,CAAClrB,KAAK,CAAC/K,OAAN,CAAcg0B,IAAI,CAACkC,aAAnB,CAA7C,EAAgF;IAC9Er7B,mDAAQ,CAAC,qDAAD,EAAwDm5B,IAAI,CAACkC,aAA7D,CAAR;IACA,OAAO,KAAP;EACD;;EAED,OAAOhC,MAAM,CAACjhB,KAAP,CAAa,UAAA+iB,KAAK;IAAA,OAAIG,mBAAmB,CAACH,KAAD,CAAvB;EAAA,CAAlB,CAAP;AACD;;AAED,SAASG,mBAAT,CAA6BH,KAA7B,EAAoC;EAClC,IAAI,CAAC7qB,wDAAa,CAAC6qB,KAAD,CAAlB,EAA2B;IACzBn7B,mDAAQ,8CAA8Cm7B,KAA9C,CAAR;IACA,OAAO,KAAP;EACD;;EACD,IAAIA,KAAK,CAAC5B,GAAV,EAAe;IACb,IAAI,CAACgC,mDAAQ,CAACJ,KAAK,CAAC5B,GAAN,CAAUiC,CAAX,CAAT,IAA0B,CAACD,mDAAQ,CAACJ,KAAK,CAAC5B,GAAN,CAAUC,IAAX,CAAvC,EAAyD;MACvDx5B,mDAAQ,sDAAR;MACA,OAAO,KAAP;IACD;;IACD,IAAI,CAACu7B,mDAAQ,CAACJ,KAAK,CAAC5B,GAAN,CAAUkC,CAAX,CAAT,IAA0B,CAACF,mDAAQ,CAACJ,KAAK,CAAC5B,GAAN,CAAUE,IAAX,CAAvC,EAAyD;MACvDz5B,mDAAQ,sDAAR;MACA,OAAO,KAAP;IACD;EACF,CATD,MASO,IAAIm7B,KAAK,CAACzB,KAAV,EAAiB;IACtB,IAAI,CAAC6B,mDAAQ,CAACJ,KAAK,CAACzB,KAAN,CAAYC,GAAb,CAAb,EAAgC;MAC9B35B,mDAAQ,wDAAR;MACA,OAAO,KAAP;IACD;EACF,CALM,MAKA,IAAIm7B,KAAK,CAACh4B,IAAV,EAAgB;IACrB,IAAI,CAACo4B,mDAAQ,CAACJ,KAAK,CAACh4B,IAAN,CAAWoS,IAAZ,CAAb,EAAgC;MAC9BvV,mDAAQ,mDAAR;MACA,OAAO,KAAP;IACD;EACF,CALM,MAKA,IAAIm7B,KAAK,CAACO,KAAV,EAAiB;IACtB,IAAI,CAACxrB,KAAK,CAAC/K,OAAN,CAAcg2B,KAAK,CAACO,KAAN,CAAYC,KAA1B,CAAD,IAAqC,CAACzrB,KAAK,CAAC/K,OAAN,CAAcg2B,KAAK,CAACO,KAAN,CAAYE,SAA1B,CAAtC,IACF,CAACL,mDAAQ,CAACJ,KAAK,CAACO,KAAN,CAAYG,WAAb,CADP,IACoC,CAACN,mDAAQ,CAACJ,KAAK,CAACO,KAAN,CAAYI,WAAb,CADjD,EAC4E;MAC1E97B,mDAAQ,CAAC,wCAAD,CAAR;MACA,OAAO,KAAP;IACD;EACF;;EACD,OAAO,IAAP;AACD;AAED;AACA;AACA;;;AACA,SAAS66B,eAAT,CAAyBtlB,IAAzB,EAA+B;EAC7B,IAAI,EAAEA,IAAI,IAAIzI,sDAAQ,CAAChH,MAAM,CAAC0J,IAAP,CAAYuqB,eAAZ,CAAD,EAA+BxkB,IAA/B,CAAlB,CAAJ,EAA6D;IAC3DvV,mDAAQ,WAAIuV,IAAJ,mCAAR;IACA,OAAO,KAAP;EACD;;EAED,OAAO,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACO,IAAMwmB,YAAY,GAAG,SAAfA,YAAe,CAAA35B,MAAM,EAAI;EACpC,IAAMkW,SAAS,GAAGlW,MAAM,CAACkW,SAAP,KAAqB,QAAvC;EACA,IAAMrS,UAAU,GAAGzD,qDAAU,CAACJ,MAAD,EAAS,mBAAT,CAA7B;EACA,OAAOkW,SAAS,IAAIrS,UAApB;AACD,CAJM;AAKA,IAAM+1B,YAAY,GAAG,SAAfA,YAAe,CAAAl6B,GAAG;EAAA,OAAIgL,sDAAQ,CAACS,cAAD,EAAiBzL,GAAG,CAACoC,MAArB,CAAZ;AAAA,CAAxB;AACA,IAAM+3B,kBAAkB,GAAG,SAArBA,kBAAqB,CAAA75B,MAAM;EAAA,OACtCA,MAAM,CAACwD,IAAP,CAAYC,MAAZ,CAAmB,UAAA/D,GAAG;IAAA,OAAI,CAACk6B,YAAY,CAACl6B,GAAD,CAAjB;EAAA,CAAtB,EAA8CN,MADR;AAAA,CAAjC;AAGP;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS+W,gBAAT,CAA0BzW,GAA1B,EAAoE;EAAA;;EAAA,+EAAJ,EAAI;EAAA,sBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,2BAA5BuL,oEAA4B;;EACzE,IAAMpV,MAAM,GAAG6J,KAAK,CAACwY,SAAN,CAAgB3iB,GAAhB,CAAf;;EACA,IAAI,CAACM,MAAL,EAAa;IAAE,OAAO,KAAP;EAAe;;EAC9B,IAAI85B,WAAW,GAAG95B,MAAM,CAAC44B,iBAAzB;EACA,IAAImB,YAAY,GAAG,gBAAAr6B,GAAG,CAACs6B,MAAJ,4DAAYjD,IAAZ,KAAoBkD,oBAAoB,CAACv6B,GAAG,CAACs6B,MAAL,EAAaF,WAAb,CAA3D;EACA,OAAOI,uBAAuB,CAACH,YAAD,EAAeD,WAAf,CAA9B;AACD;AAEM,SAASI,uBAAT,CAAiCC,OAAjC,EAA0CC,cAA1C,EAA0D;EAC/D,IAAI,CAACh6B,qDAAU,CAAC+5B,OAAD,EAAU,UAAV,CAAf,EAAsC;IACpCv8B,mDAAQ,kEAAkEu8B,OAAlE,CAAR;IACA,OAAO,KAAP;EACD;;EAED,IAAIE,gBAAgB,GAAGD,cAAc,CAACnD,MAAf,CAAsBxzB,MAAtB,CAA6B,UAAAs1B,KAAK;IAAA,OAAIA,KAAK,CAAC7B,QAAN,KAAmB,CAAvB;EAAA,CAAlC,EAA4D7xB,GAA5D,CAAgE,UAAAyhB,CAAC;IAAA,OAAIA,CAAC,CAAC3pB,EAAN;EAAA,CAAjE,CAAvB;EACA,IAAIm9B,gBAAgB,GAAGH,OAAO,CAAClD,MAAR,CAAe5xB,GAAf,CAAmB,UAAA0zB,KAAK;IAAA,OAAIA,KAAK,CAAC57B,EAAV;EAAA,CAAxB,CAAvB;EAEA,IAAMo9B,KAAK,GAAGF,gBAAgB,CAACrkB,KAAjB,CAAuB,UAAAwkB,OAAO;IAAA,OAAI9vB,sDAAQ,CAAC4vB,gBAAD,EAAmBE,OAAnB,CAAZ;EAAA,CAA9B,CAAd;;EACA,IAAI,CAACD,KAAL,EAAY;IACV38B,mDAAQ,wEAAiEy8B,gBAAjE,6CAAoHC,gBAApH,EAAR;EACD;;EAED,OAAOC,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,kBAAT,CAA4B35B,OAA5B,EAAqC8e,WAArC,EAAkD;EACvD,IAAM8a,cAAc,GAAG9a,WAAW,CAACoa,MAAZ,CAAmBjD,IAAnB,IAA2B4D,4BAA4B,CAAC/a,WAAW,CAACoa,MAAb,CAA9E;;EAEA,IAAIl5B,OAAO,CAAC85B,MAAR,KAAmB,OAAvB,EAAgC;IAC9BC,iBAAiB,CAACH,cAAD,EAAiB55B,OAAjB,aAAiBA,OAAjB,uBAAiBA,OAAO,CAAE05B,OAA1B,CAAjB;EACD,CAFD,MAEO;IACLM,sBAAsB,CAACJ,cAAD,CAAtB;EACD;;EACD,OAAO55B,OAAO,CAAC85B,MAAf;AACD;AAEM,SAASE,sBAAT,CAAgCJ,cAAhC,EAAkI;EAAA,gFAAJ,EAAI;EAAA,4BAAjFK,SAAiF;EAAA,IAAjFA,SAAiF,gCAArE,UAACC,IAAD;IAAA,OAAUC,+DAAoB,CAACD,IAAD,CAA9B;EAAA,CAAqE;EAAA,2BAA/BE,QAA+B;EAAA,IAA/BA,QAA+B,+BAApBC,mDAAoB;;EACvI,IAAMC,WAAW,GAAG,CAACV,cAAc,CAACzB,aAAf,IAAgC,EAAjC,EACjBx1B,MADiB,CACV,UAAA43B,OAAO;IAAA,OAAIA,OAAO,CAAC3G,KAAR,KAAkB4D,cAAc,CAACC,UAArC;EAAA,CADG,CAApB;;EAGA,0BAAgB6C,WAAW,CAAC93B,MAAZ,CAAmB,UAACg4B,KAAD,EAAQD,OAAR,EAAoB;IACrD,IAAIjD,eAAe,CAACY,cAAhB,CAA+BqC,OAAO,CAAC1uB,MAAvC,CAAJ,EAAoD;MAClD2uB,KAAK,CAAClD,eAAe,CAACiD,OAAO,CAAC1uB,MAAT,CAAhB,CAAL,CAAuCjP,IAAvC,CAA4C29B,OAAO,CAACp+B,GAApD;IACD;;IACD,OAAOq+B,KAAP;EACD,CALe,EAKb;IAACnE,GAAG,EAAE,EAAN;IAAUkB,EAAE,EAAE;EAAd,CALa,CAAhB;EAAA,IAAKlB,GAAL,uBAAKA,GAAL;EAAA,IAAUkB,EAAV,uBAAUA,EAAV;;EAOA,IAAIqC,cAAc,CAACa,WAAnB,EAAgC;IAC9BpE,GAAG,GAAGA,GAAG,CAACpc,MAAJ,CAAW2f,cAAc,CAACa,WAA1B,CAAN;EACD;;EACDpE,GAAG,CAAC/xB,OAAJ,CAAY,UAAAnI,GAAG;IAAA,OAAIi+B,QAAQ,CAACj+B,GAAD,CAAZ;EAAA,CAAf;EAEAo7B,EAAE,GAAGA,EAAE,CAAChzB,GAAH,CAAO,UAAApI,GAAG;IAAA,qCAA0BA,GAA1B;EAAA,CAAV,CAAL;;EACA,IAAIy9B,cAAc,CAACc,SAAnB,EAA8B;IAC5B;IACAnD,EAAE,GAAGA,EAAE,CAACtd,MAAH,CAAU,CAAC2f,cAAc,CAACc,SAAhB,CAAV,CAAL;EACD;;EACD,IAAInD,EAAE,CAACj5B,MAAP,EAAe;IACb27B,SAAS,CAAC1C,EAAE,CAAC1tB,IAAH,CAAQ,IAAR,CAAD,CAAT;EACD;AACF;AAEM,SAASkwB,iBAAT,CAA2BH,cAA3B,EAA2F;EAAA,IAAhDF,OAAgD,uEAAtC,IAAsC;;EAAA,gFAAJ,EAAI;EAAA,2BAA/BU,QAA+B;EAAA,IAA/BA,QAA+B,+BAApBC,mDAAoB;;EAChG;EACA,IAAI,CAACX,OAAL,EAAc;IAAA;;IACZ,CAAC,yBAAAE,cAAc,CAACe,IAAf,8EAAqBC,aAArB,KAAsC,EAAvC,EAA2Ct2B,OAA3C,CAAmD,UAAAnI,GAAG;MAAA,OAAIi+B,QAAQ,CAACj+B,GAAD,CAAZ;IAAA,CAAtD;EACD,CAFD,MAEO;IAAA;;IACL;IACA;IACA,IAAM0+B,cAAc,GAAG,CAACjB,cAAc,CAACzD,MAAf,IAAyB,EAA1B,EACpBxzB,MADoB,CACb,UAAAqjB,CAAC;MAAA,OAAIA,CAAC,CAAC2U,IAAN;IAAA,CADY,EAEpBn4B,MAFoB,CAEb,UAAC+B,GAAD,EAAM0zB,KAAN,EAAgB;MACtB1zB,GAAG,CAAC0zB,KAAK,CAAC57B,EAAP,CAAH,GAAgB47B,KAAK,CAAC0C,IAAtB;MACA,OAAOp2B,GAAP;IACD,CALoB,EAKlB,EALkB,CAAvB;IAMA,IAAMu2B,mBAAmB,GAAG,0BAAAlB,cAAc,CAACe,IAAf,gFAAqBC,aAArB,KAAsC,EAAlE;IACA,IAAIG,SAAS,GAAGF,cAAc,CAACnB,OAAD,CAA9B;IACA,IAAIsB,aAAa,GAAGF,mBAApB;;IACA,IAAIC,SAAJ,EAAe;MACbC,aAAa,GAAGD,SAAS,CAACH,aAAV,IAA2B,EAA3C;IACD;;IACDI,aAAa,CAAC12B,OAAd,CAAsB,UAAAnI,GAAG;MAAA,OAAIi+B,QAAQ,CAACj+B,GAAD,CAAZ;IAAA,CAAzB;EACD;AACF;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS6oB,kBAAT,CAA4BpmB,GAA5B,EAAsE;EAAA,gFAAJ,EAAI;EAAA,wBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,4BAA5BuL,oEAA4B;;EAC3E,IAAIoO,SAAS,GAAG,EAAhB;EACA,IAAMxjB,MAAM,GAAG6J,KAAK,CAACwY,SAAN,CAAgB3iB,GAAhB,CAAf;;EACA,IAAIU,qDAAU,CAACJ,MAAD,EAAS,0BAAT,CAAd,EAAoD;IAClDN,GAAG,CAAC,QAAD,CAAH,CAAc,aAAd,IAA+Bq8B,aAAa,CAAC/7B,MAAM,CAAC24B,YAAP,CAAoB,aAApB,CAAD,CAA5C;EACD,CAFD,MAEO,IAAIv4B,qDAAU,CAACJ,MAAD,EAAS,yBAAT,CAAd,EAAmD;IACxDN,GAAG,CAAC,QAAD,CAAH,CAAc,YAAd,IAA8Bq8B,aAAa,CAAC/7B,MAAM,CAAC24B,YAAP,CAAoB,YAApB,CAAD,CAA3C;EACD;;EAED,IAAMqD,uBAAuB,GAAG57B,qDAAU,CACxCJ,MADwC,mCAAV,KAG1B,KAHN;EAKA,IAAMi8B,UAAU,GAAGC,aAAa,CAACl8B,MAAD,CAAhC;;EAEA,IAAMm8B,iBAAiB,mCAAQz8B,GAAG,CAACs6B,MAAZ,GAAuBt6B,GAAG,CAACs6B,MAAJ,CAAWoC,GAAlC,CAAvB;;EACA,OAAOD,iBAAiB,CAACC,GAAzB;EAEA14B,MAAM,CAAC0J,IAAP,CAAY+uB,iBAAZ,EAA+B/2B,OAA/B,CAAuC,UAAA2zB,KAAK,EAAI;IAC9C,IAAMvkB,GAAG,GAAGynB,UAAU,CAAClD,KAAD,CAAtB;IACA,IAAIpgB,KAAK,GAAGojB,aAAa,CAACr8B,GAAG,CAACs6B,MAAJ,CAAWjB,KAAX,CAAD,CAAb,IAAoCgD,aAAa,CAAC37B,qDAAU,CAACV,GAAD,uBAAoBq5B,KAApB,EAAX,CAA7D;;IAEA,IAAIA,KAAK,KAAK,YAAV,IAA0B,CAACvkB,GAA3B,IAAkC,CAACmE,KAAvC,EAA8C;MAC5C;IACD;;IAED,IAAI0jB,eAAe,GAAGj8B,qDAAU,CAACJ,MAAD,yBAAyB+4B,KAAzB,aAAhC;;IACA,IAAI,OAAOsD,eAAP,KAA2B,SAA/B,EAA0C;MACxCA,eAAe,GAAGj8B,qDAAU,CAACJ,MAAD,6BAA6B+4B,KAA7B,aAA5B;IACD;;IAED,IAAIsD,eAAJ,EAAqB;MACnB,IAAMC,WAAW,aAAM9nB,GAAN,cAAa9U,GAAG,CAACsB,IAAjB,CAAjB;MACA2X,KAAK,GAAG2jB,WAAR;IACD;;IAED,IAAIC,sBAAsB,GAAGn8B,qDAAU,CAACJ,MAAD,yBAAyB+4B,KAAzB,wBAAvC;;IACA,IAAI,OAAOwD,sBAAP,KAAkC,SAAtC,EAAiD;MAC/CA,sBAAsB,GAAGn8B,qDAAU,CAACJ,MAAD,6BAA6B+4B,KAA7B,wBAAnC;IACD;;IAED,IAAMyD,aAAa,GAAG,OAAOD,sBAAP,KAAkC,SAAlC,GAA8CA,sBAA9C,GAAuEP,uBAA7F;;IAEA,IAAIQ,aAAJ,EAAmB;MACjBhZ,SAAS,CAAChP,GAAD,CAAT,GAAiBmE,KAAjB;IACD;EACF,CA5BD;EA8BA,OAAO6K,SAAP;AACD;;AAED,IAAMiZ,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAC7c,WAAD;EAAA;;EAAA,gCAAiBxK,8EAAA,CAA+BwK,WAA/B,CAAjB,0DAAiB,sBAA6CgZ,iBAA9D;AAAA,CAAzB;;AAEA,SAAS8D,aAAT,CAAuB37B,IAAvB,EAA6B47B,QAA7B,EAAuCvvB,IAAvC,EAAqF;EAAA;;EAAA,gFAAJ,EAAI;EAAA,+BAAvCwvB,YAAuC;EAAA,IAAvCA,YAAuC,mCAAxBH,gBAAwB;;EACnF,IAAM37B,OAAO,GAAG;IACdA,OAAO,EAAE,eADK;IAEdE,IAAI,EAAED,IAAI,CAACC;EAFG,CAAhB,CADmF,CAMnF;;EACA,IAAM84B,WAAW,GAAG8C,YAAY,CAACD,QAAD,CAAhC;EACA,IAAIE,UAAU,GAAGF,QAAQ,CAAC3C,MAA1B;EACA,IAAMD,YAAY,uBAAG4C,QAAQ,CAAC3C,MAAZ,qDAAG,iBAAiBjD,IAAtC;EACA,IAAI+F,cAAc,GAAG,EAArB;;EACA,IAAIhD,WAAW,IAAIC,YAAnB,EAAiC;IAC/B+C,cAAc,GAAGC,gBAAgB,CAAChD,YAAD,EAAeD,WAAf,CAAjC;IACA+C,UAAU,mCACLF,QAAQ,CAAC3C,MADJ,GAEL8C,cAFK,CAAV;EAID;;EACD,IAAIH,QAAQ,CAAC3C,MAAT,CAAgBjD,IAApB,EAA0B;IACxBj2B,OAAO,CAACi2B,IAAR,GAAe4F,QAAQ,CAAC3C,MAAT,CAAgBjD,IAA/B;EACD;;EACDj2B,OAAO,CAACm2B,MAAR,GAAiB,EAAjB;EAEA,CAAC7pB,IAAI,IAAI,IAAR,GAAe1J,MAAM,CAAC0J,IAAP,CAAYyvB,UAAZ,CAAf,GAAyCzvB,IAA1C,EAAgDhI,OAAhD,CAAwD,UAASoP,GAAT,EAAc;IACpE,IAAIA,GAAG,KAAK,YAAR,IAAwBqoB,UAAU,CAACroB,GAAD,CAAtC,EAA6C;MAC3C1T,OAAO,CAACk8B,UAAR,GAAqBjB,aAAa,CAACc,UAAU,CAACroB,GAAD,CAAX,CAAlC;IACD,CAFD,MAEO,IAAIA,GAAG,KAAK,aAAR,IAAyBqoB,UAAU,CAACroB,GAAD,CAAvC,EAA8C;MACnD1T,OAAO,CAACm8B,WAAR,GAAsBlB,aAAa,CAACc,UAAU,CAACroB,GAAD,CAAX,CAAnC;IACD,CAFM,MAEA,IAAIA,GAAG,KAAK,KAAZ,EAAmB;MACxB9Q,MAAM,CAAC0J,IAAP,CAAYyvB,UAAU,CAACroB,GAAD,CAAtB,EAA6BpP,OAA7B,CAAqC,UAAA83B,MAAM,EAAI;QAC7C,IAAIL,UAAU,CAACroB,GAAD,CAAV,CAAgB0oB,MAAhB,CAAJ,EAA6B;UAC3B,IAAMvkB,KAAK,GAAGojB,aAAa,CAACc,UAAU,CAACroB,GAAD,CAAV,CAAgB0oB,MAAhB,CAAD,CAA3B;UACAp8B,OAAO,CAACm2B,MAAR,CAAev5B,IAAf,CAAoB;YAAE8W,GAAG,EAAE0oB,MAAP;YAAevkB,KAAK,EAALA;UAAf,CAApB;QACD;MACF,CALD;IAMD,CAPM,MAOA,IAAIkkB,UAAU,CAACroB,GAAD,CAAV,IAAmB/T,uEAAA,CAAqC+T,GAArC,CAAvB,EAAkE;MACvE,IAAMmE,KAAK,GAAGojB,aAAa,CAACc,UAAU,CAACroB,GAAD,CAAX,CAA3B;MAEA1T,OAAO,CAACm2B,MAAR,CAAev5B,IAAf,CAAoB;QAAE8W,GAAG,EAAHA,GAAF;QAAOmE,KAAK,EAALA;MAAP,CAApB;IACD;EACF,CAjBD;EAkBA,OAAO7X,OAAP;AACD;AAED;AACA;AACA;AACA;;;AACO,SAASq8B,eAAT,CAAyBp8B,IAAzB,EAA+B47B,QAA/B,EAAiF;EAAA,gFAAJ,EAAI;EAAA,+BAAvCC,YAAuC;EAAA,IAAvCA,YAAuC,mCAAxBH,gBAAwB;;EACtF,IAAMrvB,IAAI,GAAGrM,IAAI,CAACk2B,MAAL,CAAY5xB,GAAZ,CAAgB,UAACsU,CAAD;IAAA,OAAOyjB,wDAAa,CAAC38B,wDAAD,EAAwBkZ,CAAxB,CAApB;EAAA,CAAhB,CAAb;EACA,OAAO+iB,aAAa,CAAC37B,IAAD,EAAO47B,QAAP,EAAiBvvB,IAAjB,EAAuB;IAACwvB,YAAY,EAAZA;EAAD,CAAvB,CAApB;AACD;AAEM,SAASS,mBAAT,CAA6Bt8B,IAA7B,EAAmC47B,QAAnC,EAAqF;EAAA,gFAAJ,EAAI;EAAA,+BAAvCC,YAAuC;EAAA,IAAvCA,YAAuC,mCAAxBH,gBAAwB;;EAC1F,OAAOC,aAAa,CAAC37B,IAAD,EAAO47B,QAAP,EAAiB,IAAjB,EAAuB;IAACC,YAAY,EAAZA;EAAD,CAAvB,CAApB;AACD;AAED;AACA;AACA;AACA;;AACA,SAASb,aAAT,CAAuBpjB,KAAvB,EAA8B;EAC5B,OAAO,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,YAAAA,KAAK,CAAE1b,GAAP,KAAc0b,KAArB;AACD;;AAED,SAASujB,aAAT,CAAuBl8B,MAAvB,EAA+B;EAC7B,IAAMs9B,eAAe,GAAG,EAAxB;;EAEA,IAAIl9B,qDAAU,CAACJ,MAAD,EAAS,kBAAT,CAAd,EAA4C;IAC1C0D,MAAM,CAAC0J,IAAP,CAAYpN,MAAM,CAAC24B,YAAP,CAAoByD,GAAhC,EAAqCh3B,OAArC,CAA6C,UAAA83B,MAAM,EAAI;MACrDI,eAAe,CAACJ,MAAD,CAAf,uBAAuCA,MAAvC;IACD,CAFD;EAGD;;EAED,uCACKz8B,wDADL,GAEK68B,eAFL;AAID;AAED;AACA;AACA;AACA;AACA;;;AACO,SAASzE,mBAAT,CAA6B0E,kBAA7B,EAAiD;EACtD,IAAI,CAACA,kBAAD,IAAuB,CAACrvB,wDAAa,CAACqvB,kBAAD,CAAzC,EAA+D;IAC7D3/B,mDAAQ,CAAC,kDAAD,EAAqD2/B,kBAArD,CAAR;IACA;EACD;;EACD,IAAMxG,IAAI,GAAG;IACXC,GAAG,EAAE,KADM;IAEXC,MAAM,EAAE;EAFG,CAAb;;EAIA,KAAK,IAAIziB,GAAT,IAAgB+oB,kBAAhB,EAAoC;IAClC;IACA,IAAIxF,+BAA+B,CAACrtB,QAAhC,CAAyC8J,GAAzC,CAAJ,EAAmD;;IACnD,IAAI,CAACwjB,WAAW,CAACgB,cAAZ,CAA2BxkB,GAA3B,CAAL,EAAsC;MACpC5W,mDAAQ,2CAAoC4W,GAApC,8BAAR;MACA;IACD;;IAED,IAAMukB,KAAK,GAAGwE,kBAAkB,CAAC/oB,GAAD,CAAhC;IACA,IAAI0iB,QAAQ,GAAG,CAAf;;IACA,IAAI6B,KAAK,CAAC7B,QAAN,IAAkBhK,oDAAS,CAAC6L,KAAK,CAAC7B,QAAP,CAA/B,EAAiD;MAC/CA,QAAQ,GAAG1tB,MAAM,CAACuvB,KAAK,CAAC7B,QAAP,CAAjB;IACD;;IACD,IAAMsG,SAAS,GAAG;MAChBrgC,EAAE,EAAE45B,IAAI,CAACE,MAAL,CAAY73B,MADA;MAEhB83B,QAAQ,EAARA;IAFgB,CAAlB,CAbkC,CAiBlC;;IACA,IAAI1iB,GAAG,IAAIsjB,+BAAX,EAA4C;MAC1C0F,SAAS,CAACz8B,IAAV,GAAiB;QACfoS,IAAI,EAAEykB,kBAAkB,CAACE,+BAA+B,CAACtjB,GAAD,CAAhC;MADT,CAAjB;;MAGA,IAAIukB,KAAK,CAACxB,GAAV,EAAe;QACbiG,SAAS,CAACz8B,IAAV,CAAew2B,GAAf,GAAqBwB,KAAK,CAACxB,GAA3B;MACD,CANyC,CAO5C;;IACC,CARD,MAQO,IAAI/iB,GAAG,KAAK,MAAR,IAAkBA,GAAG,KAAK,OAA9B,EAAuC;MAC5CgpB,SAAS,CAACrG,GAAV,GAAgB;QACdhkB,IAAI,EAAEqB,GAAG,KAAK,MAAR,GAAiBqjB,kBAAkB,CAAC4F,IAApC,GAA2C5F,kBAAkB,CAAC6F;MADtD,CAAhB,CAD4C,CAI5C;;MACA,IAAI3E,KAAK,CAAC4E,aAAV,EAAyB;QACvB,IAAI,CAAC56B,kDAAO,CAACg2B,KAAK,CAAC4E,aAAP,CAAZ,EAAmC;UACjC//B,mDAAQ,CAAC,0DAAD,EAA6Dm7B,KAAK,CAAC4E,aAAnE,CAAR;QACD,CAFD,MAEO,IAAI,CAAC5E,KAAK,CAAC4E,aAAN,CAAoBv+B,MAAzB,EAAiC;UACtCxB,mDAAQ,CAAC,iDAAD,EAAoDm7B,KAAK,CAAC4E,aAA1D,CAAR;QACD,CAFM,MAEA;UACL,4BAAuD5E,KAAK,CAAC4E,aAAN,CAAoB,CAApB,CAAvD;UAAA,IAAmBC,QAAnB,yBAAQC,SAAR;UAAA,IAAyCC,SAAzC,yBAA6BC,UAA7B;;UACA,IAAI,CAACC,oDAAS,CAACJ,QAAD,CAAV,IAAwB,CAACI,oDAAS,CAACF,SAAD,CAAtC,EAAmD;YACjDlgC,mDAAQ,CAAC,2DAAD,EAA8DggC,QAA9D,EAAwEE,SAAxE,CAAR;UACD,CAFD,MAEO;YACLN,SAAS,CAACrG,GAAV,CAAcC,IAAd,GAAqBwG,QAArB;YACAJ,SAAS,CAACrG,GAAV,CAAcE,IAAd,GAAqByG,SAArB;UACD;;UACD,IAAMG,YAAY,GAAGlF,KAAK,CAAC4E,aAAN,CAClBl6B,MADkB,CACX,UAACy6B,EAAD;YAAA,OAAQA,EAAE,CAACC,WAAH,IAAkBD,EAAE,CAACE,YAA7B;UAAA,CADW,EAElB/4B,GAFkB,CAEd,UAAAg5B,KAAK;YAAA,iBAAOA,KAAK,CAACF,WAAb,cAA4BE,KAAK,CAACD,YAAlC;UAAA,CAFS,CAArB;;UAGA,IAAIH,YAAY,CAAC7+B,MAAb,GAAsB,CAA1B,EAA6B;YAC3Bo+B,SAAS,CAACrG,GAAV,CAAciF,GAAd,GAAoB;cAClBkC,YAAY,EAAEL;YADI,CAApB;UAGD;QACF;MACF,CA3B2C,CA6B5C;;;MACA,IAAIlF,KAAK,CAAC/0B,KAAV,EAAiB;QACf,IAAI+0B,KAAK,CAAC/0B,KAAN,CAAY5E,MAAZ,KAAuB,CAAvB,IAA4B,CAAC4+B,oDAAS,CAACjF,KAAK,CAAC/0B,KAAN,CAAY,CAAZ,CAAD,CAAtC,IAA0D,CAACg6B,oDAAS,CAACjF,KAAK,CAAC/0B,KAAN,CAAY,CAAZ,CAAD,CAAxE,EAA0F;UACxFpG,mDAAQ,CAAC,oEAAD,EAAuEm7B,KAAK,CAAC/0B,KAA7E,CAAR;QACD,CAFD,MAEO;UACLw5B,SAAS,CAACrG,GAAV,CAAciC,CAAd,GAAkBL,KAAK,CAAC/0B,KAAN,CAAY,CAAZ,CAAlB;UACAw5B,SAAS,CAACrG,GAAV,CAAckC,CAAd,GAAkBN,KAAK,CAAC/0B,KAAN,CAAY,CAAZ,CAAlB;UACA,OAAOw5B,SAAS,CAACrG,GAAV,CAAcE,IAArB;UACA,OAAOmG,SAAS,CAACrG,GAAV,CAAcC,IAArB;QACD;MACF,CAvC2C,CAwC9C;;IACC,CAzCM,MAyCA,IAAI5iB,GAAG,KAAK,OAAZ,EAAqB;MAC1BgpB,SAAS,CAAClG,KAAV,GAAkB;QAChB;QACA;QACAC,GAAG,EAAEwB,KAAK,CAACxB,GAAN,IAAa;MAHF,CAAlB,CAD0B,CAM5B;IACC,CAPM,MAOA,IAAI/iB,GAAG,KAAK,KAAZ,EAAmB;MACxBgpB,SAAS,CAACpB,GAAV,GAAgBrD,KAAhB,CADwB,CAExB;;MACA,OAAOyE,SAAS,CAACtG,QAAjB;IACD;;IACDH,IAAI,CAACE,MAAL,CAAYv5B,IAAZ,CAAiB8/B,SAAjB;EACD;;EACD,OAAOzG,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwH,qBAAT,CAA+BC,cAA/B,EAA+C;EACpD,IAAI,CAAC9F,wBAAwB,CAAC8F,cAAD,CAA7B,EAA+C;IAC7C;EACD;;EAED,IAAMC,eAAe,GAAG,EAAxB;;EALoD,2CAMhCD,cAAc,CAACvH,MANiB;EAAA;;EAAA;IAAA;MAAA,IAMzC8B,KANyC;;MAOlD,IAAIA,KAAK,CAACzB,KAAV,EAAiB;QACf,IAAMA,KAAK,GAAG;UACZJ,QAAQ,EAAE6B,KAAK,CAAC7B,QAAN,GAAiBwH,OAAO,CAAC3F,KAAK,CAAC7B,QAAP,CAAxB,GAA2C,KADzC;UAEZK,GAAG,EAAEwB,KAAK,CAACzB,KAAN,CAAYC;QAFL,CAAd;QAIAkH,eAAe,CAACnH,KAAhB,GAAwBA,KAAxB;MACD,CAND,MAMO,IAAIyB,KAAK,CAAC5B,GAAV,EAAe;QACpB,IAAMtjB,KAAK,GAAG;UACZqjB,QAAQ,EAAE6B,KAAK,CAAC7B,QAAN,GAAiBwH,OAAO,CAAC3F,KAAK,CAAC7B,QAAP,CAAxB,GAA2C;QADzC,CAAd;;QAGA,IAAI6B,KAAK,CAAC5B,GAAN,CAAUiC,CAAV,IAAeL,KAAK,CAAC5B,GAAN,CAAUkC,CAA7B,EAAgC;UAC9BxlB,KAAK,CAAC7P,KAAN,GAAc,CAAC+0B,KAAK,CAAC5B,GAAN,CAAUiC,CAAX,EAAcL,KAAK,CAAC5B,GAAN,CAAUkC,CAAxB,CAAd;QACD,CAFD,MAEO,IAAIN,KAAK,CAAC5B,GAAN,CAAUC,IAAV,IAAkB2B,KAAK,CAAC5B,GAAN,CAAUE,IAAhC,EAAsC;UAC3CxjB,KAAK,CAAC8pB,aAAN,GAAsB;YACpBE,SAAS,EAAE9E,KAAK,CAAC5B,GAAN,CAAUC,IADD;YAEpB2G,UAAU,EAAEhF,KAAK,CAAC5B,GAAN,CAAUE,IAFF;YAGpB8G,WAAW,EAAEpF,KAAK,CAAC5B,GAAN,CAAUC,IAHH;YAIpBgH,YAAY,EAAErF,KAAK,CAAC5B,GAAN,CAAUE;UAJJ,CAAtB;QAMD;;QAED,IAAI0B,KAAK,CAAC5B,GAAN,CAAUhkB,IAAV,KAAmB0kB,kBAAkB,CAAC6F,IAA1C,EAAgD;UAC9Ce,eAAe,CAAC5qB,KAAhB,GAAwBA,KAAxB;QACD,CAFD,MAEO;UACL4qB,eAAe,CAAC/G,IAAhB,GAAuB7jB,KAAvB;QACD;MACF,CApBM,MAoBA,IAAIklB,KAAK,CAACh4B,IAAV,EAAgB;QACrB,IAAI49B,SAAS,GAAGj7B,MAAM,CAAC0J,IAAP,CAAYwqB,kBAAZ,EAAgC33B,IAAhC,CAAqC,UAAA0Z,CAAC;UAAA,OAAIie,kBAAkB,CAACje,CAAD,CAAlB,KAA0Bof,KAAK,CAACh4B,IAAN,CAAWoS,IAAzC;QAAA,CAAtC,CAAhB;QACA,IAAIyrB,eAAe,GAAGl7B,MAAM,CAAC0J,IAAP,CAAY0qB,+BAAZ,EAA6C73B,IAA7C,CAAkD,UAAA0Z,CAAC;UAAA,OAAIme,+BAA+B,CAACne,CAAD,CAA/B,KAAuCglB,SAA3C;QAAA,CAAnD,CAAtB;QACAF,eAAe,CAACG,eAAD,CAAf,GAAmC;UACjC1H,QAAQ,EAAE6B,KAAK,CAAC7B,QAAN,GAAiBwH,OAAO,CAAC3F,KAAK,CAAC7B,QAAP,CAAxB,GAA2C;QADpB,CAAnC;;QAGA,IAAI6B,KAAK,CAACh4B,IAAN,CAAWw2B,GAAf,EAAoB;UAClBkH,eAAe,CAACG,eAAD,CAAf,CAAiCrH,GAAjC,GAAuCwB,KAAK,CAACh4B,IAAN,CAAWw2B,GAAlD;QACD;MACF,CA1CiD,CA2ClD;;IA3CkD;;IAMpD,oDAA2C;MAAA;IAsC1C;EA5CmD;IAAA;EAAA;IAAA;EAAA;;EA6CpD,OAAOkH,eAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASI,qCAAT,CAA+Cr3B,WAA/C,EAA4D;EACjE,IAAI,MAAiB;IACnB,IAAI,CAACA,WAAD,IAAgB,CAACzE,kDAAO,CAACyE,WAAD,CAA5B,EAA2C,OAAOA,WAAP,CADxB,CAEnB;;IACA,IAAI,CAACA,WAAW,CAACgW,IAAZ,CAAiB,UAAA1U,UAAU;MAAA;;MAAA,kBAAI,CAAC,CAAAA,UAAU,SAAV,IAAAA,UAAU,WAAV,YAAAA,UAAU,CAAEjF,UAAZ,KAA0B,EAA3B,EAA+B8yB,kDAA/B,CAAJ,4CAAI,QAAwCI,IAA5C;IAAA,CAA3B,CAAL,EAAmF;MACjF,OAAOvvB,WAAP;IACD;;IACD,IAAIs3B,eAAe,GAAG35B,oDAAS,CAACqC,WAAD,CAA/B,CANmB,CAOnB;;IAPmB,4CAQMs3B,eARN;IAAA;;IAAA;MAQnB,uDAA0C;QAAA,IAA/Bh2B,UAA+B;;QACxC,IAAIA,UAAU,CAACjF,UAAX,IAAyBiF,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,CAAzB,IAA0D7tB,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,EAA8BI,IAA5F,EAAkG;UAChGjuB,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,IAAgCjzB,MAAM,CAACC,MAAP,CAC9Bo7B,+CAAI,CAACj2B,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,CAAD,EAAgCoB,+BAAhC,CAD0B,EAE9BwG,qBAAqB,CAACz1B,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,EAA8BI,IAA/B,CAFS,CAAhC;UAIAjuB,UAAU,CAAC6vB,YAAX,GAA0BH,yBAAyB,CAAC1vB,UAAU,CAACjF,UAAX,CAAsB8yB,kDAAtB,CAAD,CAAnD;QACD;MACF;IAhBkB;MAAA;IAAA;MAAA;IAAA;;IAiBnB,OAAOmI,eAAP;EACD;;EACD,OAAOt3B,WAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASmzB,4BAAT,CAAsCqE,YAAtC,EAAoD;EACzD,IAAM9sB,QAAQ,GAAG;IACfupB,IAAI,EAAE,EADS;IAEfxC,aAAa,EAAE;EAFA,CAAjB;EAIAv1B,MAAM,CAACu7B,OAAP,CAAeD,YAAf,EAA6B55B,OAA7B,CAAqC,iBAAkB;IAAA;IAAA,IAAhBoP,GAAgB;IAAA,IAAXmE,KAAW;;IACrD,QAAQnE,GAAR;MACE,KAAK,UAAL;QACEtC,QAAQ,CAACupB,IAAT,CAAcx+B,GAAd,GAAoB0b,KAApB;QACA;;MACF,KAAK,eAAL;QACEzG,QAAQ,CAACupB,IAAT,CAAcC,aAAd,GAA8B5tB,KAAK,CAAC/K,OAAN,CAAc4V,KAAd,IAAuBA,KAAvB,GAA+B,CAACA,KAAD,CAA7D;QACA;;MACF,KAAK,oBAAL;QACE,CAAC7K,KAAK,CAAC/K,OAAN,CAAc4V,KAAd,IAAuBA,KAAvB,GAA+B,CAACA,KAAD,CAAhC,EAAyCvT,OAAzC,CAAiD,UAAAnI,GAAG,EAAI;UACtDiV,QAAQ,CAAC+mB,aAAT,CAAuBv7B,IAAvB,CAA4B;YAC1Bg3B,KAAK,EAAE4D,cAAc,CAACC,UADI;YAE1B5rB,MAAM,EAAEyrB,eAAe,CAACjB,GAFE;YAG1Bl6B,GAAG,EAAHA;UAH0B,CAA5B;QAKD,CAND;QAOA;;MACF,KAAK,oBAAL;QACE;QACA;QACA;QACA;QACAiV,QAAQ,CAACspB,SAAT,GAAqB1tB,KAAK,CAAC/K,OAAN,CAAc4V,KAAd,IAAuBA,KAAK,CAAChO,IAAN,CAAW,EAAX,CAAvB,GAAwCgO,KAA7D;QACA;IAtBJ;EAwBD,CAzBD;EA0BA,OAAOzG,QAAP;AACD;AAEM,SAAS+nB,oBAAT,CAA8B6C,cAA9B,EAA8ChD,WAA9C,EAA2D;EAChE,IAAMC,YAAY,mCACbY,4BAA4B,CAACmC,cAAD,CADf;IAEhB7F,MAAM,EAAE;EAFQ,EAAlB;;EAKA,SAASiI,eAAT,CAAyBC,SAAzB,EAAoCpgC,EAApC,EAAwC;IACtC,IAAIg6B,KAAK,GAAGe,WAAW,CAAC7C,MAAZ,CAAmBh3B,IAAnB,CAAwBk/B,SAAxB,CAAZ;;IACA,IAAIpG,KAAK,IAAI,IAAb,EAAmB;MACjBA,KAAK,GAAG5zB,oDAAS,CAAC4zB,KAAD,CAAjB;MACAh6B,EAAE,CAACg6B,KAAD,CAAF;MACAgB,YAAY,CAAC9C,MAAb,CAAoBv5B,IAApB,CAAyBq7B,KAAzB;IACD;EACF;;EAEDr1B,MAAM,CAAC0J,IAAP,CAAY0vB,cAAZ,EAA4Br5B,MAA5B,CAAmC,UAAA+Q,GAAG;IAAA,OAAI,CAAC,CAACsoB,cAAc,CAACtoB,GAAD,CAApB;EAAA,CAAtC,EAAiEpP,OAAjE,CAAyE,UAAAoP,GAAG,EAAI;IAC9E,IAAMmE,KAAK,GAAGmkB,cAAc,CAACtoB,GAAD,CAA5B;;IACA,QAAQA,GAAR;MACE;MACA,KAAK,OAAL;QACE0qB,eAAe,CAAC,UAAAnG,KAAK;UAAA,OAAIA,KAAK,CAACzB,KAAN,IAAe,IAAnB;QAAA,CAAN,EAA+B,UAAA8H,UAAU,EAAI;UAC1DA,UAAU,CAAC9H,KAAX,GAAmB;YACjB+H,IAAI,EAAE1mB;UADW,CAAnB;QAGD,CAJc,CAAf;QAKA;;MACF,KAAK,OAAL;MACA,KAAK,MAAL;QACE,IAAM2mB,SAAS,GAAG9qB,GAAG,KAAK,OAAR,GAAkBqjB,kBAAkB,CAAC6F,IAArC,GAA4C7F,kBAAkB,CAAC4F,IAAjF;QACAyB,eAAe,CAAC,UAAAnG,KAAK;UAAA,OAAIA,KAAK,CAAC5B,GAAN,IAAa,IAAb,IAAqB4B,KAAK,CAAC5B,GAAN,CAAUhkB,IAAV,KAAmBmsB,SAA5C;QAAA,CAAN,EAA6D,UAAAC,UAAU,EAAI;UACxFA,UAAU,CAACpI,GAAX,GAAiB;YACfl6B,GAAG,EAAE0b;UADU,CAAjB;QAGD,CAJc,CAAf;QAKA;;MACF;QACE,IAAInE,GAAG,IAAIsjB,+BAAX,EAA4C;UAC1CoH,eAAe,CAAC,UAAAnG,KAAK;YAAA,OAAIA,KAAK,CAACh4B,IAAN,IAAc,IAAd,IAAsBg4B,KAAK,CAACh4B,IAAN,CAAWoS,IAAX,KAAoBykB,kBAAkB,CAACE,+BAA+B,CAACtjB,GAAD,CAAhC,CAAhE;UAAA,CAAN,EAA8G,UAAAgrB,SAAS,EAAI;YACxIA,SAAS,CAACz+B,IAAV,GAAiB;cACf4X,KAAK,EAALA;YADe,CAAjB;UAGD,CAJc,CAAf;QAKD;;QACD;IA1BJ;EA4BD,CA9BD;EA+BA,OAAOohB,YAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACA,SAASgD,gBAAT,CAA0BhD,YAA1B,EAAwCD,WAAxC,EAAqD;EACnD,IAAMgD,cAAc,GAAG,EAAvB;EACA,IAAM2C,aAAa,GAAG,CAAA3F,WAAW,SAAX,IAAAA,WAAW,WAAX,YAAAA,WAAW,CAAE7C,MAAb,KAAuB,EAA7C;EACA6F,cAAc,CAACrF,QAAf,GAA0BsC,YAAY,CAAC0B,IAAb,CAAkBx+B,GAA5C;EACA6/B,cAAc,CAAC4C,WAAf,GAA6B3F,YAAY,CAAC4F,OAA1C;;EAJmD,4CAK/B,CAAA5F,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAE9C,MAAd,KAAwB,EALO;EAAA;;EAAA;IAAA;MAAA,IAKxC8B,KALwC;MAMjD,IAAM6G,YAAY,GAAGH,aAAa,CAACx/B,IAAd,CAAmB,UAAA4/B,QAAQ;QAAA,OAAI9G,KAAK,CAAC57B,EAAN,KAAa0iC,QAAQ,CAAC1iC,EAA1B;MAAA,CAA3B,CAArB;;MACA,IAAI47B,KAAK,CAACzB,KAAV,EAAiB;QACfwF,cAAc,CAACxF,KAAf,GAAuByB,KAAK,CAACzB,KAAN,CAAY+H,IAAnC;MACD,CAFD,MAEO,IAAItG,KAAK,CAAC5B,GAAV,EAAe;QACpB2F,cAAc,CAAC8C,YAAY,CAACzI,GAAb,CAAiBhkB,IAAjB,KAA0B0kB,kBAAkB,CAAC6F,IAA7C,GAAoD,OAApD,GAA8D,MAA/D,CAAd,GAAuF3E,KAAK,CAAC5B,GAAN,CAAUl6B,GAAjG;MACD,CAFM,MAEA,IAAI87B,KAAK,CAACh4B,IAAV,EAAgB;QACrB+7B,cAAc,CAAC7E,uCAAuC,CAACE,0BAA0B,CAACyH,YAAY,CAAC7+B,IAAb,CAAkBoS,IAAnB,CAA3B,CAAxC,CAAd,GAA8G4lB,KAAK,CAACh4B,IAAN,CAAW4X,KAAzH;MACD;IAbgD;;IAKnD,uDAAgD;MAAA;IAS/C;EAdkD;IAAA;EAAA;IAAA;EAAA;;EAenD,OAAOmkB,cAAP;AACD;AAED;AACA;AACA;;;AACA,SAAS5E,OAAT,CAAiBva,GAAjB,EAAsB;EACpB,IAAImiB,MAAM,GAAG,EAAb;;EACA,KAAK,IAAItrB,GAAT,IAAgBmJ,GAAhB,EAAqB;IACnBmiB,MAAM,CAACniB,GAAG,CAACnJ,GAAD,CAAJ,CAAN,GAAmBA,GAAnB;EACD;;EACD,OAAOsrB,MAAP;AACD;;;;;;;;;;;;;;;;;AC1wBD;AACA;AAEO,SAASp1B,QAAT,CAAkBq1B,MAAlB,EAA0BC,IAA1B,EAAgCx1B,KAAhC,EAAuC;EAC5C,OAAQu1B,MAAM,IAAIA,MAAM,CAACr1B,QAAP,CAAgBs1B,IAAhB,EAAsBx1B,KAAtB,CAAX,IAA4C,KAAnD;AACD;AAEM,SAASy1B,SAAT,GAAqB;EAC1B,OAAOnyB,KAAK,CAACwf,IAAN,CAAWlvB,KAAX,CAAiB0P,KAAjB,EAAwB7P,SAAxB,CAAP;AACD;AAEM,SAASgC,IAAT,CAAcigC,GAAd,EAAmBC,IAAnB,EAAyBC,OAAzB,EAAkC;EACvC,OAAOF,GAAG,IAAIA,GAAG,CAACjgC,IAAJ,CAASkgC,IAAT,EAAeC,OAAf,CAAd;AACD;AAEM,SAASC,SAAT,CAAmBH,GAAnB,EAAwBC,IAAxB,EAA8BC,OAA9B,EAAuC;EAC5C,OAAOF,GAAG,IAAIA,GAAG,CAACG,SAAJ,CAAcF,IAAd,EAAoBC,OAApB,CAAd;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjBD;AAEA;AACA;AA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAM,OAAoB5X,2DAAS,EAAnC;AACA,IAAQ8X,gBAAR,GAA6BvsB,mEAA7B;AAEA;;AACA,wBAA6EtT,mDAA7E;AAAA,IAAQ8/B,YAAR,qBAAQA,YAAR;AAAA,IAAsBC,OAAtB,qBAAsBA,OAAtB;AAAA,IAA+BC,YAA/B,qBAA+BA,YAA/B;AAAA,IAA6CC,aAA7C,qBAA6CA,aAA7C;AAAA,IAA4DC,YAA5D,qBAA4DA,YAA5D;AACA,4BAAoGlgC,oEAApG;AAAA,IAAQmgC,gCAAR,yBAAQA,gCAAR;AAAA,IAA0CC,KAA1C,yBAA0CA,KAA1C;AAAA,IAAiDC,SAAjD,yBAAiDA,SAAjD;AAAA,IAA4DC,cAA5D,yBAA4DA,cAA5D;AAAA,IAA4EC,mBAA5E,yBAA4EA,mBAA5E;AAEA,IAAMC,eAAe,GAAG;EACtBC,MAAM,EAAEC;AADc,CAAxB,EAIA;;AACAxN,0DAAW;AAEX;;AACA,KAAkB7iB,cAAlB,GAAmC,KAAkBA,cAAlB,IAAoC,EAAvE,EAEA;;AACA,KAAkBswB,SAAlB,GAA8B,IAA9B,EAEA;;AACA,KAAkBC,OAAlB,GAA4B,aAA5B;AACAx0B,kDAAO,CAAC,8BAAD,CAAP;AAEA,KAAkB2lB,gBAAlB,GAAqC,KAAkBA,gBAAlB,IAAsC,EAA3E,EAEA;;AACA,KAAkBzyB,OAAlB,GAA4B,KAAkBA,OAAlB,IAA6B,EAAzD,EAEA;;AACA,KAAkBugC,gBAAlB,GAAqCA,gBAArC;;AAEA,SAASa,qBAAT,CAA+BhkC,EAA/B,EAAmC;EACjC,IAAI0c,WAAW,GAAGzE,+EAAA,GAAkC/P,GAAlC,CAAsC,UAAAi8B,MAAM;IAAA,OAAIA,MAAM,CAAC99B,IAAP,CAAY6B,GAAZ,CAAgB,UAAA3F,GAAG;MAAA,OAAIA,GAAG,CAACpC,UAAR;IAAA,CAAnB,CAAJ;EAAA,CAA5C,EACfgG,MADe,CACRiB,8CADQ,EAEfd,MAFe,CAERyN,8CAFQ,CAAlB;;EAIA,IAAI,CAACqwB,mDAAQ,CAAC1nB,WAAD,EAAc1c,EAAd,CAAb,EAAgC;IAC9BS,mDAAQ,CAAC,UAAUT,EAAV,GAAe,6BAAhB,CAAR;IACA;EACD;;EAED,OAAO,IAAP;AACD;;AAED,SAASqkC,aAAT,CAAuB7hC,GAAvB,EAA4B0V,KAA5B,EAAmCE,MAAnC,EAA2C;EACzC,IAAI5V,GAAG,CAAC8hC,WAAJ,IAAmB9hC,GAAG,CAAC8hC,WAAJ,CAAgBC,YAAvC,EAAqD;IACnD/hC,GAAG,CAAC8hC,WAAJ,CAAgBC,YAAhB,CAA6BrsB,KAA7B,GAAqCA,KAArC;IACA1V,GAAG,CAAC8hC,WAAJ,CAAgBC,YAAhB,CAA6BnsB,MAA7B,GAAsCA,MAAtC;EACD;AACF;;AAED,SAASosB,aAAT,CAAuB39B,KAAvB,EAA8B49B,UAA9B,EAA0C;EACxC,IAAIC,UAAU,GAAG,EAAjB;;EACA,IAAI9+B,kDAAO,CAACiB,KAAD,CAAP,KAAoB49B,UAAD,GAAe59B,KAAK,CAAC5E,MAAN,KAAiBwiC,UAAhC,GAA6C59B,KAAK,CAAC5E,MAAN,GAAe,CAA/E,CAAJ,EAAuF;IACrF;IACA,IAAI4E,KAAK,CAACgS,KAAN,CAAY,UAAA8rB,EAAE;MAAA,OAAIC,wDAAa,CAACD,EAAD,EAAK,CAAL,CAAjB;IAAA,CAAd,CAAJ,EAA6C;MAC3CD,UAAU,GAAG79B,KAAb;IACD,CAFD,MAEO,IAAI+9B,wDAAa,CAAC/9B,KAAD,EAAQ,CAAR,CAAjB,EAA6B;MAClC69B,UAAU,CAACnkC,IAAX,CAAgBsG,KAAhB;IACD;EACF;;EACD,OAAO69B,UAAP;AACD;;AAED,SAASG,uBAAT,CAAiChiC,MAAjC,EAAyC;EACvC,IAAMiiC,eAAe,GAAG98B,oDAAS,CAACnF,MAAD,CAAjC;EACA,IAAM0V,MAAM,GAAGusB,eAAe,CAACp+B,UAAhB,CAA2B6R,MAA1C;EACA,IAAMwsB,WAAW,GAAGP,aAAa,CAACjsB,MAAM,CAAC1R,KAAR,CAAjC;;EACA,IAAIk+B,WAAW,CAAC9iC,MAAZ,GAAqB,CAAzB,EAA4B;IAC1BsW,MAAM,CAAC1R,KAAP,GAAek+B,WAAf,CAD0B,CAE1B;;IACAD,eAAe,CAACj+B,KAAhB,GAAwBk+B,WAAxB;EACD,CAJD,MAIO;IACLtkC,mDAAQ,CAAC,yLAAD,CAAR;IACA,OAAOqkC,eAAe,CAACp+B,UAAhB,CAA2B6R,MAAlC;EACD;;EACD,OAAOusB,eAAP;AACD;;AAED,SAASE,sBAAT,CAAgCniC,MAAhC,EAAwC;EACtC,IAAMiiC,eAAe,GAAG98B,oDAAS,CAACnF,MAAD,CAAjC;EACA,IAAMs5B,KAAK,GAAG2I,eAAe,CAACp+B,UAAhB,CAA2By1B,KAAzC;;EACA,IAAIA,KAAK,CAAC8I,UAAV,EAAsB;IACpB,IAAIC,gBAAgB,GAAI,OAAO/I,KAAK,CAAC8I,UAAN,CAAiB,CAAjB,CAAP,KAA+B,QAAhC,GAA4C,CAA5C,GAAgD,CAAvE;IAEA,IAAME,UAAU,GAAGX,aAAa,CAACrI,KAAK,CAAC8I,UAAP,EAAmBC,gBAAnB,CAAhC;;IACA,IAAIC,UAAU,CAACljC,MAAX,GAAoB,CAAxB,EAA2B;MACzB,IAAIijC,gBAAgB,KAAK,CAAzB,EAA4B;QAC1Bx1B,kDAAO,CAAC,4FAAD,CAAP;MACD;;MACDysB,KAAK,CAAC8I,UAAN,GAAmBE,UAAnB,CAJyB,CAKzB;;MACAL,eAAe,CAACj+B,KAAhB,GAAwBs+B,UAAxB;IACD,CAPD,MAOO;MACL1kC,mDAAQ,CAAC,iNAAD,CAAR;MACA,OAAOqkC,eAAe,CAACp+B,UAAhB,CAA2By1B,KAA3B,CAAiC8I,UAAxC;IACD;EACF;;EACD,OAAOH,eAAP;AACD;;AAED,SAASM,uBAAT,CAAiCviC,MAAjC,EAAyC;EACvC,IAAMiiC,eAAe,GAAG98B,oDAAS,CAACnF,MAAD,CAAjC;EACA,IAAMg6B,MAAM,GAAGiI,eAAe,CAACp+B,UAAhB,CAA2Bm2B,MAA1C,CAFuC,CAGvC;;EACA,IAAIA,MAAM,CAACjD,IAAX,EAAiB;IACf,IAAMyL,gBAAgB,GAAG9+B,MAAM,CAAC0J,IAAP,CAAY3M,wDAAZ,EAAmCgD,MAAnC,CAA0C,UAAA+Q,GAAG;MAAA,OAAI/T,wDAAA,CAAsB+T,GAAtB,EAA2B9J,QAA3B,CAAoC,YAApC,CAAJ;IAAA,CAA7C,CAAzB;IACA,IAAMuxB,UAAU,GAAGv4B,MAAM,CAAC0J,IAAP,CAAY4sB,MAAZ,CAAnB;IACA,IAAMyI,YAAY,GAAGxG,UAAU,CAACx4B,MAAX,CAAkB,UAAAi/B,SAAS;MAAA,OAAIF,gBAAgB,CAAC93B,QAAjB,CAA0Bg4B,SAA1B,CAAJ;IAAA,CAA3B,CAArB;;IACA,IAAID,YAAY,CAACrjC,MAAb,GAAsB,CAA1B,EAA6B;MAC3BxB,mDAAQ,+FAAwF6kC,YAAxF,yBAAR;MACAA,YAAY,CAACr9B,OAAb,CAAqB,UAAAu9B,SAAS;QAAA,OAAI,OAAOV,eAAe,CAACp+B,UAAhB,CAA2Bm2B,MAA3B,CAAkC2I,SAAlC,CAAX;MAAA,CAA9B;IACD;EACF;;EACD,IAAI3I,MAAM,CAACnmB,KAAP,IAAgBmmB,MAAM,CAACnmB,KAAP,CAAa7P,KAA7B,IAAsC,CAAC8J,KAAK,CAAC/K,OAAN,CAAci3B,MAAM,CAACnmB,KAAP,CAAa7P,KAA3B,CAA3C,EAA8E;IAC5EpG,mDAAQ,CAAC,mIAAD,CAAR;IACA,OAAOqkC,eAAe,CAACp+B,UAAhB,CAA2Bm2B,MAA3B,CAAkCnmB,KAAlC,CAAwC7P,KAA/C;EACD;;EACD,IAAIg2B,MAAM,CAACnmB,KAAP,IAAgBmmB,MAAM,CAACnmB,KAAP,CAAa8pB,aAA7B,IAA8C,CAAC7vB,KAAK,CAAC/K,OAAN,CAAci3B,MAAM,CAACnmB,KAAP,CAAa8pB,aAA3B,CAAnD,EAA8F;IAC5F//B,mDAAQ,CAAC,mJAAD,CAAR;IACA,OAAOqkC,eAAe,CAACp+B,UAAhB,CAA2Bm2B,MAA3B,CAAkCnmB,KAAlC,CAAwC8pB,aAA/C;EACD;;EACD,IAAI3D,MAAM,CAACtC,IAAP,IAAesC,MAAM,CAACtC,IAAP,CAAY1zB,KAA3B,IAAoC,CAAC8J,KAAK,CAAC/K,OAAN,CAAci3B,MAAM,CAACtC,IAAP,CAAY1zB,KAA1B,CAAzC,EAA2E;IACzEpG,mDAAQ,CAAC,iIAAD,CAAR;IACA,OAAOqkC,eAAe,CAACp+B,UAAhB,CAA2Bm2B,MAA3B,CAAkCtC,IAAlC,CAAuC1zB,KAA9C;EACD;;EACD,OAAOi+B,eAAP;AACD;;AAED,SAASW,iBAAT,CAA2B5iC,MAA3B,EAAmCkW,SAAnC,EAA8C;EAC5C,IAAI2sB,GAAG,GAAGziC,qDAAU,CAACJ,MAAD,uBAAuBkW,SAAvB,UAApB;;EAEA,IAAI,CAACijB,mDAAQ,CAAC0J,GAAD,CAAT,IAAkB5R,KAAK,CAAC4R,GAAD,CAAvB,IAAgC,CAACC,QAAQ,CAACD,GAAD,CAA7C,EAAoD;IAClD,IAAIE,OAAO,gDAAyC/iC,MAAM,CAACE,IAAhD,+BAAX;IAEA7B,kDAAO,CAAC0kC,OAAD,CAAP;IACA9hC,4CAAA,CAAYR,iEAAZ,EAA4C;MAAC0S,IAAI,EAAE,SAAP;MAAkBlV,SAAS,EAAE8kC;IAA7B,CAA5C;IACA,OAAO/iC,MAAM,CAAC6D,UAAP,CAAkBqS,SAAlB,EAA6B2sB,GAApC;EACD;;EAED,OAAO7iC,MAAP;AACD;;AAED,SAASgjC,cAAT,CAAwBhjC,MAAxB,EAAgC;EAC9B,IAAMiW,GAAG,GAAG,aAACA,IAAD;IAAA,8BAAyBjW,MAAM,CAACE,IAAhC,eAAyC+V,IAAzC;EAAA,CAAZ;;EAEA,IAAMpS,UAAU,GAAG7D,MAAM,CAAC6D,UAA1B;EACA,IAAML,IAAI,GAAGxD,MAAM,CAACwD,IAApB;;EAEA,IAAIA,IAAI,IAAI,IAAR,IAAgB,CAACT,kDAAO,CAACS,IAAD,CAA5B,EAAoC;IAClC5F,mDAAQ,CAACqY,GAAG,4EAAJ,CAAR;IACA,OAAO,IAAP;EACD;;EACD,IAAIzS,IAAI,IAAI,IAAR,IAAgBxD,MAAM,CAACijC,QAAP,IAAmB,IAAvC,EAA6C;IAC3CrlC,mDAAQ,CAACqY,GAAG,+EAAJ,CAAR;IACA,OAAO,IAAP;EACD;;EACD,IAAI,CAACpS,UAAD,IAAeH,MAAM,CAAC0J,IAAP,CAAYvJ,UAAZ,EAAwBzE,MAAxB,KAAmC,CAAtD,EAAyD;IACvDxB,mDAAQ,CAACqY,GAAG,sHAAJ,CAAR;IACA,OAAO,IAAP;EACD;;EACD,IAAIjW,MAAM,CAACijC,QAAP,IAAmB,IAAnB,KAA4Bz/B,IAAI,IAAI,IAAR,IAAgBA,IAAI,CAACpE,MAAL,KAAgB,CAA5D,CAAJ,EAAoE;IAClEY,MAAM,CAACwD,IAAP,GAAc,CAAC;MAAC1B,MAAM,EAAE;IAAT,CAAD,CAAd,CADkE,CAClC;;IAChC3C,qDAAU,CAAC8W,GAAG,yFAAJ,CAAV;EACD;;EAED,OAAOjW,MAAP;AACD;;AAEM,IAAMkjC,iBAAiB,GAAG;EAC/BF,cAAc,EAAdA,cAD+B;EAE/BhB,uBAAuB,EAAvBA,uBAF+B;EAG/BG,sBAAsB,EAAtBA,sBAH+B;EAI/BR,aAAa,EAAbA;AAJ+B,CAA1B;;AAOP,IAAI,MAAiB;EACnBj+B,MAAM,CAACC,MAAP,CAAcu/B,iBAAd,EAAiC;IAACX,uBAAuB,EAAvBA;EAAD,CAAjC;AACD;;AAEM,IAAMY,gBAAgB,GAAGz+B,8CAAI,CAAC,MAAD,EAAS,UAAU3E,OAAV,EAAmB;EAC9D,IAAMqjC,gBAAgB,GAAG,EAAzB;EAEArjC,OAAO,CAACqF,OAAR,CAAgB,UAAApF,MAAM,EAAI;IACxBA,MAAM,GAAGgjC,cAAc,CAAChjC,MAAD,CAAvB;IACA,IAAIA,MAAM,IAAI,IAAd,EAAoB;IAEpB,IAAM6D,UAAU,GAAG7D,MAAM,CAAC6D,UAA1B;IACA,IAAIw/B,eAAJ,EAAqBC,cAArB,EAAqCC,eAArC;;IAEA,IAAI1/B,UAAU,CAAC6R,MAAf,EAAuB;MACrB2tB,eAAe,GAAGrB,uBAAuB,CAAChiC,MAAD,CAAzC;MACA,IAAI6D,UAAU,CAAC6R,MAAX,CAAkBsjB,cAAlB,CAAiC,KAAjC,CAAJ,EAA6CqK,eAAe,GAAGT,iBAAiB,CAACS,eAAD,EAAkB,QAAlB,CAAnC;IAC9C;;IAED,IAAIx/B,UAAU,CAACy1B,KAAf,EAAsB;MACpBgK,cAAc,GAAGD,eAAe,GAAGlB,sBAAsB,CAACkB,eAAD,CAAzB,GAA6ClB,sBAAsB,CAACniC,MAAD,CAAnG;MACA,IAAI6D,UAAU,CAACy1B,KAAX,CAAiBN,cAAjB,CAAgC,KAAhC,CAAJ,EAA4CsK,cAAc,GAAGV,iBAAiB,CAACU,cAAD,EAAiB,OAAjB,CAAlC;IAC7C;;IAED,IAAI,SAAmBz/B,UAAU,CAACm2B,MAAlC,EAA0C;MACxCuJ,eAAe,GAAGD,cAAc,GAAGf,uBAAuB,CAACe,cAAD,CAA1B,GAA6CD,eAAe,GAAGd,uBAAuB,CAACc,eAAD,CAA1B,GAA8Cd,uBAAuB,CAACviC,MAAD,CAAjK;IACD;;IAED,IAAMiiC,eAAe,GAAGv+B,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB0/B,eAAlB,EAAmCC,cAAnC,EAAmDC,eAAnD,CAAxB;IAEAH,gBAAgB,CAAC1lC,IAAjB,CAAsBukC,eAAtB;EACD,CAxBD;EA0BA,OAAOmB,gBAAP;AACD,CA9BmC,EA8BjC,kBA9BiC,CAA7B,EAgCP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,KAAkBI,oCAAlB,GAAyD,UAAUC,UAAV,EAAsB;EAC7E52B,kDAAO,CAAC,oDAAD,EAAoE5O,SAApE,CAAP,CAD6E,CAG7E;;EACA,IAAIwlC,UAAJ,EAAgB;IACd,IAAIzV,GAAG,GAAG,KAAkB0V,iCAAlB,CAAoDD,UAApD,CAAV;IACA,OAAOE,wEAA6B,CAAC3V,GAAD,CAApC;EACD,CAHD,MAGO;IACL7uB,qDAAU,CAAC,mEAAD,CAAV;EACD;AACF,CAVD;AAYA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBykC,wCAAlB,GAA6D,UAAUH,UAAV,EAAsB;EACjF,IAAIA,UAAJ,EAAgB;IACd,IAAM/jC,GAAG,GAAG0V,sFAAA,CAAuCquB,UAAvC,EACThgC,MADS,CACFogC,8DADE,EAETpgC,MAFS,CAEFogC,kEAFE,CAAZ;IAIA,OAAOnkC,GAAG,CAACN,MAAJ,GAAaM,GAAG,CAAC4D,MAAJ,CAAWwgC,oDAAX,CAAb,GAAyC,EAAhD;EACD,CAND,MAMO;IACL3kC,qDAAU,CAAC,uEAAD,CAAV;EACD;AACF,CAVD;AAYA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBukC,iCAAlB,GAAsD,UAAUpmC,UAAV,EAAsB;EAC1E,OAAO,KAAkBymC,oBAAlB,CAAuCzmC,UAAvC,EAAmDA,UAAnD,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AAEA,KAAkBymC,oBAAlB,GAAyC,UAAUzmC,UAAV,EAAsB;EAC7DuP,kDAAO,CAAC,oCAAD,EAAoD5O,SAApD,CAAP;EACA,OAAO8nB,oEAAA,CAA0BzoB,UAA1B,CAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;;;AACA,SAAS0mC,kBAAT,GAA8B;EAC5B,OAAO;IACLC,IAAI,EAAEz+B,+EAAA,EADD;IAELyqB,GAAG,EAAEvqB,8EAAA,EAFA;IAGLw+B,KAAK,EAAE,CAAC,CAAEhnC,yDAAA,CAAiB,OAAjB;EAHL,CAAP;AAKD;;AAED,KAAkB8mC,kBAAlB,GAAuC,YAAY;EACjDn3B,kDAAO,CAAC,kCAAD,CAAP;EACA,OAAOm3B,kBAAkB,EAAzB;AACD,CAHD;;AAKA,SAAS/gC,OAAT,CAAiBkQ,IAAjB,EAAuB;EACrB,IAAMzE,SAAS,GAAG0G,8DAAc,CAACjC,IAAD,CAAd,GACf1P,MADe,CACR/E,gDAAA,CAAU4d,oDAAV,EAAyB,IAAzB,EAA+BlH,6EAAA,EAA/B,CADQ,CAAlB,CADqB,CAIrB;;EACA,IAAM+uB,gBAAgB,GAAG/uB,+EAAA,EAAzB;EAEA,OAAO1G,SAAS,CACbrJ,GADI,CACA,UAAA3F,GAAG;IAAA,OAAIA,GAAG,CAACpC,UAAR;EAAA,CADH,EAEJmG,MAFI,CAEGyN,8CAFH,EAEY7L,GAFZ,CAEgB,UAAA/H,UAAU;IAAA,OAAIoR,SAAS,CACzCjL,MADgC,CACzB,UAAA/D,GAAG;MAAA,OAAIA,GAAG,CAACwD,SAAJ,KAAkBihC,gBAAlB,IAAsCzkC,GAAG,CAACpC,UAAJ,KAAmBA,UAA7D;IAAA,CADsB,CAAJ;EAAA,CAF1B,EAIJmG,MAJI,CAIG,UAAAD,IAAI;IAAA,OAAIA,IAAI,IAAIA,IAAI,CAAC,CAAD,CAAZ,IAAmBA,IAAI,CAAC,CAAD,CAAJ,CAAQlG,UAA/B;EAAA,CAJP,EAKJ+H,GALI,CAKA,UAAA7B,IAAI,EAAI;IACX,OAAO,uFACJA,IAAI,CAAC,CAAD,CAAJ,CAAQlG,UADX,EACwB;MAAEkG,IAAI,EAAJA;IAAF,CADxB;EAGD,CATI,EAUJF,MAVI,CAUG,UAACwjB,CAAD,EAAIsd,CAAJ;IAAA,OAAU1gC,MAAM,CAACC,MAAP,CAAcmjB,CAAd,EAAiBsd,CAAjB,CAAV;EAAA,CAVH,EAUkC,EAVlC,CAAP;AAWD;AAED;AACA;AACA;AACA;AACA;;;AAEA,KAAkB3lB,SAAlB,GAA8B,YAAY;EACxC5R,kDAAO,CAAC,yBAAD,EAAyC5O,SAAzC,CAAP;EACA,OAAOgF,OAAO,CAAC,WAAD,CAAd;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AAEA,KAAkBohC,sBAAlB,GAA2C,UAAU/mC,UAAV,EAAsB;EAC/D,IAAMkG,IAAI,GAAG4R,wEAAA,GAA2B3R,MAA3B,CAAkC,UAAA/D,GAAG;IAAA,OAAIA,GAAG,CAACpC,UAAJ,KAAmBA,UAAvB;EAAA,CAArC,CAAb;EACA,OAAO;IAAEkG,IAAI,EAAJA;EAAF,CAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;;;AAEA,KAAkB8gC,eAAlB,GAAoC,YAAY;EAC9Cz3B,kDAAO,CAAC,+BAAD,EAA+C5O,SAA/C,CAAP;EACA,OAAOgF,OAAO,CAAC,iBAAD,CAAd;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AAEA,KAAkBshC,4BAAlB,GAAiD,UAAUjnC,UAAV,EAAsB;EACrE,IAAMkG,IAAI,GAAG4R,8EAAA,GAAiC3R,MAAjC,CAAwC,UAAA/D,GAAG;IAAA,OAAIA,GAAG,CAACpC,UAAJ,KAAmBA,UAAvB;EAAA,CAA3C,CAAb;EACA,OAAO;IAAEkG,IAAI,EAAJA;EAAF,CAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBghC,uBAAlB,GAA4C,UAAUxkC,MAAV,EAAkBykC,kBAAlB,EAAsC;EAChF53B,kDAAO,CAAC,uCAAD,EAAuD5O,SAAvD,CAAP;;EACA,IAAI,CAACymC,6DAAkB,EAAvB,EAA2B;IACzB9mC,mDAAQ,CAAC,6CAAD,CAAR;IACA;EACD,CAL+E,CAOhF;;;EACA,IAAI+mC,YAAY,GAAG5e,oEAAA,CAA0B/lB,MAA1B,CAAnB,CARgF,CAUhF;;EACA+lB,yEAAA,CAA+B/lB,MAA/B,EAAuCykC,kBAAvC,EAXgF,CAahF;;EACA1e,uEAAA,CAA6B4e,YAA7B,EAA2CF,kBAA3C;EAEA/gC,MAAM,CAAC0J,IAAP,CAAYu3B,YAAZ,EAA0Bv/B,OAA1B,CAAkC,UAAC9H,UAAD,EAAgB;IAChDoG,MAAM,CAAC0J,IAAP,CAAYu3B,YAAY,CAACrnC,UAAD,CAAxB,EAAsC8H,OAAtC,CAA8C,UAACw/B,YAAD,EAAkB;MAC9D,IAAIA,YAAY,KAAK,SAArB,EAAgC;QAC9BxvB,+EAAA,CAAgCuvB,YAAY,CAACrnC,UAAD,CAAZ,CAAyBsnC,YAAzB,CAAhC,EAAwEnkC,yEAAxE;MACD;IACF,CAJD;EAKD,CAND,EAhBgF,CAwBhF;;EACAQ,4CAAA,CAAYy/B,aAAZ,EAA2BiE,YAA3B;AACD,CA1BD;AA4BA;AACA;AACA;AACA;AACA;;;AACA,KAAkBE,kBAAlB,GAAuC,UAAUhrB,WAAV,EAAuB;EAC5DhN,kDAAO,CAAC,iCAAD,EAAiD5O,SAAjD,CAAP;;EACA,IAAI,CAAC8nB,oEAAA,EAAL,EAAkC;IAChCnoB,mDAAQ,CAAC,0CAAD,CAAR;IACA;EACD;;EAEDmoB,uEAAA,CAA6BlM,WAA7B,EAP4D,CAS5D;;EACA5Y,4CAAA,CAAYy/B,aAAZ,EAA2B3a,oEAAA,EAA3B;AACD,CAXD;AAaA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAS+e,qBAAT,CAA+BC,IAA/B,EAAqCplC,GAArC,EAA0CqlC,OAA1C,EAAmD;EACjD,IAAMC,aAAa,GAAGtlC,GAAG,CAACulC,aAAJ,CAAkBF,OAAlB,CAAtB;;EACA,IAAI,CAACD,IAAI,CAACI,UAAN,IAAoBJ,IAAI,CAACI,UAAL,KAAoBF,aAA5C,EAA2D;IACzDvtB,wDAAa,CAACqtB,IAAD,EAAOplC,GAAP,EAAYqlC,OAAZ,CAAb;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBI,QAAlB,GAA6B1gC,8CAAI,CAAC,OAAD,EAAU,UAAU/E,GAAV,EAAexC,EAAf,EAAmBH,OAAnB,EAA4B;EACrE6P,kDAAO,CAAC,wBAAD,EAAwC5O,SAAxC,CAAP;EACAkB,qDAAU,CAAC,iCAAiChC,EAAlC,CAAV;;EAEA,IAAIwC,GAAG,IAAIxC,EAAX,EAAe;IACb,IAAI;MACF;MACA,IAAMuC,GAAG,GAAG0V,4EAAA,CAA6BjY,EAA7B,CAAZ;;MAEA,IAAIuC,GAAJ,EAAS;QACP,IAAI2lC,YAAY,GAAG,IAAnB;;QACA,IAAI3lC,GAAG,IAAIA,GAAG,CAACoQ,MAAJ,KAAerP,gEAA1B,EAAyD;UACvDpC,kDAAO,iBAAUqB,GAAG,CAACsB,IAAd,+BAAP;UACAC,4CAAA,CAAY0/B,YAAZ,EAA0BjhC,GAA1B;;UACA,IAAIU,qDAAU,CAAClD,yDAAA,CAAiB,gBAAjB,CAAD,EAAqC,qBAArC,CAAd,EAA2E;YACzEmoC,YAAY,GAAG,KAAf;UACD;QACF;;QAED,IAAIA,YAAJ,EAAkB;UAChB;UACA3lC,GAAG,CAAC4lC,EAAJ,GAASC,8DAAmB,CAAC7lC,GAAG,CAAC4lC,EAAL,EAAS5lC,GAAG,CAACyQ,WAAJ,IAAmBzQ,GAAG,CAAC0Q,GAAhC,CAA5B;UACA1Q,GAAG,CAAC8lC,KAAJ,GAAYD,8DAAmB,CAAC7lC,GAAG,CAAC8lC,KAAL,EAAY9lC,GAAG,CAACyQ,WAAJ,IAAmBzQ,GAAG,CAAC0Q,GAAnC,CAA/B,CAHgB,CAIhB;;UACA,IAAIpT,OAAO,IAAIA,OAAO,CAACyoC,YAAvB,EAAqC;YACnC,IAAOA,YAAP,GAAuBzoC,OAAvB,CAAOyoC,YAAP;YACA/lC,GAAG,CAAC4lC,EAAJ,GAASI,8DAAmB,CAAChmC,GAAG,CAAC4lC,EAAL,EAASG,YAAT,CAA5B;YACA/lC,GAAG,CAAC8lC,KAAJ,GAAYE,8DAAmB,CAAChmC,GAAG,CAAC8lC,KAAL,EAAYC,YAAZ,CAA/B;UACD,CATe,CAWhB;;;UACArwB,4EAAA,CAA6B1V,GAA7B,EAZgB,CAchB;;UACAuB,4CAAA,CAAYu/B,OAAZ,EAAqB9gC,GAArB;UAEA,IAAO6V,MAAP,GAAwD7V,GAAxD,CAAO6V,MAAP;UAAA,IAAeF,KAAf,GAAwD3V,GAAxD,CAAe2V,KAAf;UAAA,IAAsBiwB,EAAtB,GAAwD5lC,GAAxD,CAAsB4lC,EAAtB;UAAA,IAA0BpvB,SAA1B,GAAwDxW,GAAxD,CAA0BwW,SAA1B;UAAA,IAAqCsvB,KAArC,GAAwD9lC,GAAxD,CAAqC8lC,KAArC;UAAA,IAA4ChmC,QAA5C,GAAwDE,GAAxD,CAA4CF,QAA5C;UAEA,IAAMmmC,eAAe,GAAG7lC,QAAQ,CAAC8lC,aAAT,oBAAmClmC,GAAG,CAACmmC,UAAvC,wBAA+DnmC,GAAG,CAACoC,MAAnE,+BAAxB;UACA4V,wDAAa,CAACiuB,eAAD,EAAkBhmC,GAAlB,EAAuB,MAAvB,CAAb;;UAEA,IAAIJ,iEAAkB,CAACC,QAAD,CAAtB,EAAkC;YAChCC,8DAAe,CAACD,QAAD,EAAWE,GAAX,EAAgBC,GAAhB,CAAf;YACAmlC,qBAAqB,CAACa,eAAD,EAAkBhmC,GAAlB,EAAuB,MAAvB,CAArB;YACAuB,uEAAqB,CAAC;cAAEvB,GAAG,EAAHA,GAAF;cAAOD,GAAG,EAAHA,GAAP;cAAYvC,EAAE,EAAFA;YAAZ,CAAD,CAArB;UACD,CAJD,MAIO,IAAKwC,GAAG,KAAKG,QAAR,IAAoB,CAACgmC,mDAAQ,EAA9B,IAAqC5vB,SAAS,KAAK,OAAvD,EAAgE;YACrE,IAAMpV,OAAO,4DAAqD3D,EAArD,sDAAb;YACAyD,kEAAgB,CAAC;cAACC,MAAM,EAAE+/B,gCAAT;cAA2C9/B,OAAO,EAAPA,OAA3C;cAAoDpB,GAAG,EAAHA,GAApD;cAAyDvC,EAAE,EAAFA;YAAzD,CAAD,CAAhB;UACD,CAHM,MAGA,IAAImoC,EAAJ,EAAQ;YACb3lC,GAAG,CAAComC,KAAJ,CAAUT,EAAV;YACA3lC,GAAG,CAACqmC,KAAJ;YACAxE,aAAa,CAAC7hC,GAAD,EAAM0V,KAAN,EAAaE,MAAb,CAAb;YACAuvB,qBAAqB,CAACa,eAAD,EAAkBhmC,GAAlB,EAAuB,MAAvB,CAArB;YACAsmC,mDAAQ,CAACvmC,GAAD,CAAR;YACAwB,uEAAqB,CAAC;cAAEvB,GAAG,EAAHA,GAAF;cAAOD,GAAG,EAAHA,GAAP;cAAYvC,EAAE,EAAFA;YAAZ,CAAD,CAArB;UACD,CAPM,MAOA,IAAIqoC,KAAJ,EAAW;YAChB,IAAM9xB,MAAM,GAAGwyB,gEAAqB,EAApC;YACAxyB,MAAM,CAAC6B,MAAP,GAAgBA,MAAhB;YACA7B,MAAM,CAAC2B,KAAP,GAAeA,KAAf;YACA3B,MAAM,CAACyyB,KAAP,CAAaC,OAAb,GAAuB,QAAvB;YACA1yB,MAAM,CAACyyB,KAAP,CAAaE,QAAb,GAAwB,QAAxB;YACA3yB,MAAM,CAACtQ,GAAP,GAAaoiC,KAAb;YAEA9tB,wDAAa,CAAChE,MAAD,EAAS/T,GAAT,EAAc,MAAd,CAAb;YACA6hC,aAAa,CAAC7hC,GAAD,EAAM0V,KAAN,EAAaE,MAAb,CAAb;YACAuvB,qBAAqB,CAACa,eAAD,EAAkBhmC,GAAlB,EAAuB,MAAvB,CAArB;YACAsmC,mDAAQ,CAACvmC,GAAD,CAAR;YACAwB,uEAAqB,CAAC;cAAEvB,GAAG,EAAHA,GAAF;cAAOD,GAAG,EAAHA,GAAP;cAAYvC,EAAE,EAAFA;YAAZ,CAAD,CAArB;UACD,CAbM,MAaA;YACL,IAAM2D,QAAO,kEAA2D3D,EAA3D,CAAb;;YACAyD,kEAAgB,CAAC;cAACC,MAAM,EAAEggC,KAAT;cAAgB//B,OAAO,EAAPA,QAAhB;cAAyBpB,GAAG,EAAHA,GAAzB;cAA8BvC,EAAE,EAAFA;YAA9B,CAAD,CAAhB;UACD;QACF;MACF,CAhED,MAgEO;QACL,IAAM2D,SAAO,oEAA6D3D,EAA7D,CAAb;;QACAyD,kEAAgB,CAAC;UAAEC,MAAM,EAAEkgC,cAAV;UAA0BjgC,OAAO,EAAPA,SAA1B;UAAmC3D,EAAE,EAAFA;QAAnC,CAAD,CAAhB;MACD;IACF,CAxED,CAwEE,OAAO4N,CAAP,EAAU;MACV,IAAMjK,SAAO,0CAAmC3D,EAAnC,0BAAqD4N,CAAC,CAACjK,OAAvD,CAAb;;MACAF,kEAAgB,CAAC;QAAEC,MAAM,EAAEigC,SAAV;QAAqBhgC,OAAO,EAAPA,SAArB;QAA8B3D,EAAE,EAAFA;MAA9B,CAAD,CAAhB;IACD;EACF,CA7ED,MA6EO;IACL,IAAM2D,SAAO,0CAAmC3D,EAAnC,2CAAb;;IACAyD,kEAAgB,CAAC;MAAEC,MAAM,EAAEmgC,mBAAV;MAA+BlgC,OAAO,EAAPA,SAA/B;MAAwC3D,EAAE,EAAFA;IAAxC,CAAD,CAAhB;EACD;AACF,CArFgC,CAAjC;AAuFA;AACA;AACA;AACA;AACA;;AACA,KAAkBmpC,YAAlB,GAAiC,UAAUhpC,UAAV,EAAsB;EACrDuP,kDAAO,CAAC,4BAAD,EAA4C5O,SAA5C,CAAP;;EAEA,IAAI,CAACX,UAAL,EAAiB;IACf,KAAkByC,OAAlB,GAA4B,EAA5B;IACA;EACD;;EAED,IAAI8Z,WAAJ;;EAEA,IAAI9W,kDAAO,CAACzF,UAAD,CAAX,EAAyB;IACvBuc,WAAW,GAAGvc,UAAd;EACD,CAFD,MAEO;IACLuc,WAAW,GAAG,CAACvc,UAAD,CAAd;EACD;;EAEDuc,WAAW,CAACzU,OAAZ,CAAoB,UAAC9H,UAAD,EAAgB;IAClC,KAAK,IAAIwM,CAAC,GAAG,KAAkB/J,OAAlB,CAA0BX,MAA1B,GAAmC,CAAhD,EAAmD0K,CAAC,IAAI,CAAxD,EAA2DA,CAAC,EAA5D,EAAgE;MAC9D,IAAI,KAAkB/J,OAAlB,CAA0B+J,CAA1B,EAA6B5J,IAA7B,KAAsC5C,UAA1C,EAAsD;QACpD,KAAkByC,OAAlB,CAA0B4uB,MAA1B,CAAiC7kB,CAAjC,EAAoC,CAApC;MACD;IACF;EACF,CAND;AAOD,CAvBD;AAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBy8B,WAAlB,GAAiC,YAAW;EAC1C,IAAMC,QAAQ,GAAG9hC,8CAAI,CAAC,OAAD,EAAU,YAAsG;IAAA,gFAAJ,EAAI;IAAA,IAA1F+hC,eAA0F,SAA1FA,eAA0F;IAAA,IAAzEp+B,OAAyE,SAAzEA,OAAyE;IAAA,IAAhEtI,OAAgE,SAAhEA,OAAgE;IAAA,IAAvD8Z,WAAuD,SAAvDA,WAAuD;IAAA,IAA1C9T,MAA0C,SAA1CA,MAA0C;IAAA,IAAlC7C,SAAkC,SAAlCA,SAAkC;IAAA,IAAvBuE,KAAuB,SAAvBA,KAAuB;IAAA,IAAhBpE,OAAgB,SAAhBA,OAAgB;;IACnIpC,4CAAA,CAAYw/B,YAAZ;IACA,IAAM35B,SAAS,GAAGuB,OAAO,IAAInL,yDAAA,CAAiB,eAAjB,CAA7B;IACA2P,kDAAO,CAAC,2BAAD,EAA2C5O,SAA3C,CAAP;IACA,IAAM8I,cAAc,GAAG;MACrBW,MAAM,EAAEM,oDAAS,CAAC,EAAD,EAAK9K,4DAAA,CAAoB,OAApB,KAAgC,EAArC,EAAyCuK,KAAK,IAAI,EAAlD,CADI;MAErB3F,MAAM,EAAE4B,MAAM,CAAC+yB,WAAP,CAAmB/yB,MAAM,CAACu7B,OAAP,CAAe/hC,+DAAA,EAAf,EAAyCmI,GAAzC,CAA6C;QAAA;QAAA,IAAEvD,MAAF;QAAA,IAAU4kC,GAAV;;QAAA,OAAmB,CAAC5kC,MAAD,EAAS4kC,GAAG,CAACj/B,KAAb,CAAnB;MAAA,CAA7C,EAAqFhE,MAArF,CAA4F;QAAA;QAAA,IAAEkjC,CAAF;QAAA,IAAKl/B,KAAL;;QAAA,OAAgBA,KAAK,IAAI,IAAzB;MAAA,CAA5F,CAAnB;IAFa,CAAvB;IAIA,OAAOm/B,YAAY,CAAC;MAACH,eAAe,EAAfA,eAAD;MAAkBp+B,OAAO,EAAEvB,SAA3B;MAAsC/G,OAAO,EAAPA,OAAtC;MAA+C8Z,WAAW,EAAXA,WAA/C;MAA4D9T,MAAM,EAANA,MAA5D;MAAoE7C,SAAS,EAATA,SAApE;MAA+E6D,cAAc,EAAdA,cAA/E;MAA+F1D,OAAO,EAAPA;IAA/F,CAAD,CAAnB;EACD,CAToB,EASlB,aATkB,CAArB;EAWA,OAAOizB,kDAAQ,CAACkQ,QAAD,EAAW,SAASD,WAAT,GAA+B;IAAA,IAAVvf,GAAU,uEAAJ,EAAI;IACvD;IACA;IACA;IACA;IACAA,GAAG,CAAC3jB,OAAJ,GAAcwjC,kEAAU,EAAxB;IACA7f,GAAG,CAAC3jB,OAAJ,CAAYkL,UAAZ,CAAuB,aAAvB;IACA,IAAIxO,OAAO,GAAGinB,GAAG,CAACjnB,OAAJ,IAAe,KAAkBA,OAA/C;IACAinB,GAAG,CAACjnB,OAAJ,GAAegD,kDAAO,CAAChD,OAAD,CAAP,GAAmBA,OAAO,CAACqlB,KAAR,EAAnB,GAAqC,CAACrlB,OAAD,CAApD;IACA,OAAOymC,QAAQ,CAAC3oC,IAAT,CAAc,IAAd,EAAoBmpB,GAApB,CAAP;EACD,CAVc,CAAf;AAWD,CAvB+B,EAAhC;;AAyBO,IAAM4f,YAAY,GAAGliC,8CAAI,CAAC,OAAD,EAAU,YAA0H;EAAA,gFAAJ,EAAI;EAAA,IAA9G+hC,eAA8G,SAA9GA,eAA8G;EAAA,IAApF3/B,SAAoF,SAA7FuB,OAA6F;EAAA,IAAzEtI,OAAyE,SAAzEA,OAAyE;EAAA,IAAhE8Z,WAAgE,SAAhEA,WAAgE;EAAA,IAAnD9T,MAAmD,SAAnDA,MAAmD;EAAA,IAA3C7C,SAA2C,SAA3CA,SAA2C;EAAA,IAAhC6D,cAAgC,SAAhCA,cAAgC;EAAA,IAAhB1D,OAAgB,SAAhBA,OAAgB;;EAClK,IAAMqI,UAAU,GAAG7G,oEAAe,CAAC3H,yDAAA,CAAiB,WAAjB,KAAiC,EAAlC,CAAlC;EACA6C,OAAO,GAAGkH,kEAAU,CAAC5D,OAAD,CAAV,CAAoBmL,WAApB,CAAgC,sBAAhC,EAAwD;IAAA,OAAM20B,gBAAgB,CAACpjC,OAAD,CAAtB;EAAA,CAAxD,CAAV;;EAEA,IAAI8Z,WAAW,IAAIA,WAAW,CAACza,MAA/B,EAAuC;IACrC;IACAW,OAAO,GAAGA,OAAO,CAAC0D,MAAR,CAAe,UAAAqjC,IAAI;MAAA,OAAIp8B,uDAAQ,CAACmP,WAAD,EAAcitB,IAAI,CAAC5mC,IAAnB,CAAZ;IAAA,CAAnB,CAAV;EACD,CAHD,MAGO;IACL;IACA2Z,WAAW,GAAG9Z,OAAO,IAAIA,OAAO,CAACsF,GAAR,CAAY,UAAAyhC,IAAI;MAAA,OAAIA,IAAI,CAAC5mC,IAAT;IAAA,CAAhB,CAAzB;EACD;EAED;AACF;AACA;AACA;AACA;AACA;;;EACEH,OAAO,CAACqF,OAAR,CAAgB,UAAApF,MAAM,EAAI;IAAA;;IACxB;IACA,IAAM+mC,gBAAgB,GAAGrjC,MAAM,CAAC0J,IAAP,CAAYpN,MAAM,CAAC6D,UAAP,IAAqB;MAAE,UAAU;IAAZ,CAAjC,CAAzB,CAFwB,CAIxB;;IACA,IAAMmjC,UAAU,GAAGhnC,MAAM,CAACwD,IAAP,CAAY6B,GAAZ,CAAgB,UAAA3F,GAAG;MAAA,OAAIA,GAAG,CAACoC,MAAR;IAAA,CAAnB,CAAnB;IACA,IAAMY,cAAc,GAAGF,0EAAvB;IAEA,IAAMlB,OAAO,GAAG0lC,UAAU,CAACvjC,MAAX,CAAkB,UAAA3B,MAAM;MAAA,OAAI,CAAC4J,UAAU,CAAC3G,GAAX,CAAejD,MAAf,CAAL;IAAA,CAAxB,CAAhB;IAEA,IAAM8I,GAAG,GAAG,qBAAA5K,MAAM,CAACijC,QAAP,8FAAiB7G,GAAjB,8EAAsBxxB,GAAtB,KAA6BzC,uDAAY,EAArD;IACAnI,MAAM,CAAC+D,aAAP,GAAuB6G,GAAvB,CAXwB,CAYxB;;IACAq8B,gDAAY,CAACjnC,MAAD,EAAS,kBAAT,EAA6B4K,GAA7B,CAAZ;IAEAtJ,OAAO,CAAC8D,OAAR,CAAgB,UAAAtD,MAAM,EAAI;MACxB,IAAM8G,OAAO,GAAGlG,cAAc,CAACZ,MAAD,CAA9B;MACA,IAAM+J,IAAI,GAAGjD,OAAO,IAAIA,OAAO,CAACkD,OAAnB,IAA8BlD,OAAO,CAACkD,OAAR,EAA3C,CAFwB,CAGxB;;MACA,IAAMo7B,gBAAgB,GAAIr7B,IAAI,IAAIA,IAAI,CAACZ,mBAAd,IAAsC,CAAC,QAAD,CAA/D,CAJwB,CAMxB;;MACA,IAAMk8B,cAAc,GAAGJ,gBAAgB,CAACvpB,IAAjB,CAAsB,UAAArK,IAAI;QAAA,OAAIzI,uDAAQ,CAACw8B,gBAAD,EAAmB/zB,IAAnB,CAAZ;MAAA,CAA1B,CAAvB;;MACA,IAAI,CAACg0B,cAAL,EAAqB;QACnB;QACA9oC,kDAAO,CAAC+oC,mEAAwB,CAACpnC,MAAD,EAAS8B,MAAT,CAAzB,CAAP;QACA9B,MAAM,CAACwD,IAAP,GAAcxD,MAAM,CAACwD,IAAP,CAAYC,MAAZ,CAAmB,UAAA/D,GAAG;UAAA,OAAIA,GAAG,CAACoC,MAAJ,KAAeA,MAAnB;QAAA,CAAtB,CAAd;MACD,CAJD,MAIO;QACLE,sFAAA,CAA6ChC,MAAM,CAACE,IAApD,EAA0D4B,MAA1D;MACD;IACF,CAfD;IAgBAE,gFAAA,CAAuChC,MAAM,CAACE,IAA9C;EACD,CAhCD;;EAkCA,IAAI,CAACH,OAAD,IAAYA,OAAO,CAACX,MAAR,KAAmB,CAAnC,EAAsC;IACpCD,qDAAU,CAAC,2CAAD,CAAV;;IACA,IAAI,OAAOsnC,eAAP,KAA2B,UAA/B,EAA2C;MACzC;MACA,IAAI;QACFA,eAAe;MAChB,CAFD,CAEE,OAAO17B,CAAP,EAAU;QACVnN,mDAAQ,CAAC,iCAAD,EAAoC,IAApC,EAA0CmN,CAA1C,CAAR;MACD;IACF;;IACD;EACD;;EAED,IAAM8b,OAAO,GAAGzR,4EAAA,CAA6B;IAC3CrV,OAAO,EAAPA,OAD2C;IAE3C8Z,WAAW,EAAXA,WAF2C;IAG3Czc,QAAQ,EAAEqpC,eAHiC;IAI3C3/B,SAAS,EAATA,SAJ2C;IAK3Cf,MAAM,EAANA,MAL2C;IAM3C7C,SAAS,EAATA,SAN2C;IAO3C6D,cAAc,EAAdA,cAP2C;IAQ3C1D,OAAO,EAAPA;EAR2C,CAA7B,CAAhB;EAWA,IAAIgkC,UAAU,GAAGtnC,OAAO,CAACX,MAAzB;;EACA,IAAIioC,UAAU,GAAG,EAAjB,EAAqB;IACnBx6B,kDAAO,2BAAoBga,OAAO,CAAC1I,YAAR,EAApB,uBAAuDkpB,UAAvD,gBAA8EtnC,OAA9E,CAAP;EACD;;EAED8Z,WAAW,CAACzU,OAAZ,CAAoB,UAAAlF,IAAI;IAAA,OAAI6lB,8EAAA,CAAoC7lB,IAApC,EAA0C2mB,OAAO,CAAC1I,YAAR,EAA1C,CAAJ;EAAA,CAAxB;EACA0I,OAAO,CAACzkB,QAAR;AACD,CAnF+B,EAmF7B,cAnF6B,CAAzB;AAqFA,SAASklC,gBAAT,CAA0BvoC,EAA1B,EAA8BwoC,gBAA9B,EAAgD;EACrDC,MAAM,CAACC,iEAAD,CAAN;EACAD,MAAM,CAACE,wBAAD,CAAN;EACA3oC,EAAE,CAAClB,IAAH,CAAQ,IAAR,EAAc0pC,gBAAd;;EAEA,SAASC,MAAT,CAAgBG,KAAhB,EAAuB;IACrB,IAAIC,MAAJ;;IACA,OAAQA,MAAM,GAAGD,KAAK,CAACtoC,KAAN,EAAjB,EAAiC;MAC/BuoC,MAAM;IACP;EACF;AACF,EAED;;AACA,KAAkBrB,WAAlB,CAA8BvxB,MAA9B,CAAqCsyB,gBAArC,EAAuD,EAAvD;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,KAAkBO,UAAlB,GAA+B,UAAUC,SAAV,EAAqB;EAClDj7B,kDAAO,CAAC,0BAAD,EAA0C5O,SAA1C,CAAP;EACA,KAAkB8B,OAAlB,CAA0BrC,IAA1B,CAA+BU,KAA/B,CAAqC,KAAkB2B,OAAvD,EAAgEgD,kDAAO,CAAC+kC,SAAD,CAAP,GAAqBA,SAArB,GAAiC,CAACA,SAAD,CAAjG,EAFkD,CAGlD;;EACA7mC,4CAAA,CAAYs/B,YAAZ;AACD,CALD;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBwH,OAAlB,GAA4B,UAAUrT,KAAV,EAAiBO,OAAjB,EAA0B93B,EAA1B,EAA8B;EACxD0P,kDAAO,CAAC,uBAAD,EAAuC5O,SAAvC,CAAP;;EACA,IAAI,CAACioB,+CAAI,CAAC+O,OAAD,CAAT,EAAoB;IAClBr3B,mDAAQ,CAAC,4EAA4E82B,KAA5E,GAAoF,IAArF,CAAR;IACA;EACD;;EAED,IAAIv3B,EAAE,IAAI,CAAC8jC,eAAe,CAACvM,KAAD,CAAf,CAAuB72B,IAAvB,CAA4B,IAA5B,EAAkCV,EAAlC,CAAX,EAAkD;IAChDS,mDAAQ,CAAC,6CAA6C82B,KAA7C,GAAqD,2BAAtD,CAAR;IACA;EACD;;EAEDzzB,0CAAA,CAAUyzB,KAAV,EAAiBO,OAAjB,EAA0B93B,EAA1B;AACD,CAbD;AAeA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkB6qC,QAAlB,GAA6B,UAAUtT,KAAV,EAAiBO,OAAjB,EAA0B93B,EAA1B,EAA8B;EACzD0P,kDAAO,CAAC,wBAAD,EAAwC5O,SAAxC,CAAP;;EACA,IAAId,EAAE,IAAI,CAAC8jC,eAAe,CAACvM,KAAD,CAAf,CAAuB72B,IAAvB,CAA4B,IAA5B,EAAkCV,EAAlC,CAAX,EAAkD;IAChD;EACD;;EAED8D,2CAAA,CAAWyzB,KAAX,EAAkBO,OAAlB,EAA2B93B,EAA3B;AACD,CAPD;AASA;AACA;AACA;AACA;AACA;;;AACA,KAAkBk4B,SAAlB,GAA8B,YAAY;EACxCxoB,kDAAO,CAAC,yBAAD,CAAP;EACA,OAAO5L,iDAAA,EAAP;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBmK,kBAAlB,GAAuC,UAAU68B,aAAV,EAAyB5mC,UAAzB,EAAqC;EAC1EwL,kDAAO,CAAC,kCAAD,EAAkD5O,SAAlD,CAAP;;EACA,IAAI;IACFuE,8EAAA,CAAkCylC,aAAa,EAA/C,EAAmD5mC,UAAnD;EACD,CAFD,CAEE,OAAO0J,CAAP,EAAU;IACVnN,mDAAQ,CAAC,wCAAwCmN,CAAC,CAACjK,OAA3C,CAAR;EACD;AACF,CAPD;AASA;AACA;AACA;AACA;AACA;;;AACA,KAAkBoL,wBAAlB,GAA6C,UAAUlP,OAAV,EAAmB;EAC9D6P,kDAAO,CAAC,wCAAD,EAAwD5O,SAAxD,CAAP;;EACA,IAAI;IACFuE,oFAAA,CAAwCxF,OAAxC;EACD,CAFD,CAEE,OAAO+N,CAAP,EAAU;IACVnN,mDAAQ,CAAC,2CAA2CmN,CAAC,CAACjK,OAA9C,CAAR;EACD;AACF,CAPD;AASA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkB2P,SAAlB,GAA8B,UAAUiY,UAAV,EAAsB;EAClD7b,kDAAO,CAAC,yBAAD,EAAyC5O,SAAzC,CAAP;EACA,OAAOwS,0DAAS,CAACiY,UAAD,CAAhB;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;AACA,IAAMgf,wBAAwB,GAAG,EAAjC;AAEA,IAAMQ,iBAAiB,GAAGxjC,8CAAI,CAAC,OAAD,EAAU,UAAUxH,MAAV,EAAkB;EACxD,IAAIA,MAAM,IAAI,CAAC+iB,kDAAO,CAAC/iB,MAAD,CAAtB,EAAgC;IAC9B2P,kDAAO,CAAC,qCAAD,EAAqD3P,MAArD,CAAP;IACAsF,2EAAA,CAA+BtF,MAA/B;EACD,CAHD,MAGO;IACLU,mDAAQ,CAAC,sDAAD,CAAR;EACD;AACF,CAP6B,EAO3B,mBAP2B,CAA9B;;AASA,KAAkBuO,eAAlB,GAAoC,UAAUjP,MAAV,EAAkB;EACpDwqC,wBAAwB,CAAChqC,IAAzB,CAA8BwqC,iBAAiB,CAACxpC,IAAlB,CAAuB,IAAvB,EAA6BxB,MAA7B,CAA9B;AACD,CAFD;AAIA;AACA;AACA;;;AACA,KAAkBirC,WAAlB,GAAgC,UAAU9mC,UAAV,EAAsBkK,KAAtB,EAA6BvO,OAA7B,EAAsC;EACpE6P,kDAAO,CAAC,2BAAD,EAA2C5O,SAA3C,CAAP;;EACA,IAAIoD,UAAU,IAAIkK,KAAlB,EAAyB;IACvB/I,2EAAA,CAA+BnB,UAA/B,EAA2CkK,KAA3C,EAAkDvO,OAAlD;EACD,CAFD,MAEO;IACLY,mDAAQ,CAAC,kDAAD,EAAqD,kBAArD,CAAR;EACD;AACF,CAPD;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AACA,KAAkB0pB,iBAAlB,GAAsC,YAAY;EAChD,OAAOlS,gFAAA,EAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;;;AACA,KAAkBgzB,uBAAlB,GAA4C,YAAY;EACtD,OAAOhzB,8EAAA,GACJ3R,MADI,CACG,UAAA/D,GAAG;IAAA,OAAIA,GAAG,CAACoQ,MAAJ,KAAerP,yEAAnB;EAAA,CADN,CAAP;AAED,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkB4nC,iBAAlB,GAAsC,UAAU/qC,UAAV,EAAsB;EAC1D,OAAOyoB,mEAAA,CAAyBzoB,UAAzB,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,KAAkBgrC,oBAAlB,GAAyC,UAAUC,cAAV,EAA0B;EACjE,IAAI/kC,IAAI,GAAG,EAAX;;EAEA,IAAI+kC,cAAc,CAACjrC,UAAf,IAA6BirC,cAAc,CAACvnC,IAAhD,EAAsD;IACpDwC,IAAI,GAAG4R,8EAAA,GACJ3R,MADI,CACG,UAAA/D,GAAG;MAAA,OAAIA,GAAG,CAACsB,IAAJ,KAAaunC,cAAc,CAACvnC,IAA5B,IAAoCtB,GAAG,CAACpC,UAAJ,KAAmBirC,cAAc,CAACjrC,UAA1E;IAAA,CADN,CAAP;EAED,CAHD,MAGO,IAAIirC,cAAc,CAACjrC,UAAnB,EAA+B;IACpCkG,IAAI,GAAGuiB,mEAAA,CAAyBwiB,cAAc,CAACjrC,UAAxC,CAAP;EACD,CAFM,MAEA,IAAIirC,cAAc,CAACvnC,IAAnB,EAAyB;IAC9BwC,IAAI,GAAG4R,8EAAA,GAAiC3R,MAAjC,CAAwC,UAAA/D,GAAG;MAAA,OAAIA,GAAG,CAACsB,IAAJ,KAAaunC,cAAc,CAACvnC,IAAhC;IAAA,CAA3C,CAAP;EACD,CAFM,MAEA;IACL3C,kDAAO,CAAC,sFAAD,CAAP;EACD;;EAED,IAAImF,IAAI,CAACpE,MAAL,GAAc,CAAlB,EAAqB;IACnBoE,IAAI,CAAC,CAAD,CAAJ,CAAQsM,MAAR,GAAiBrP,gEAAjB;EACD;AACF,CAjBD;AAmBA;AACA;AACA;AACA;AACA;;;AACA,KAAkB5B,SAAlB,GAA8B3B,4DAA9B;AACA,KAAkB6wB,UAAlB,GAA+B7wB,6DAA/B;AACA,KAAkB+xB,WAAlB,GAAgC/xB,2DAAhC;AACA,KAAkBiyB,iBAAlB,GAAsCjyB,iEAAtC;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,KAAkBixB,SAAlB,GAA8BjxB,yDAA9B;AACA,KAAkB4xB,eAAlB,GAAoC5xB,+DAApC;AAEA,KAAkBy3B,GAAlB,CAAsBj3B,IAAtB,CAA2B;EAAA,OAAM8qC,gFAA0B,EAAhC;AAAA,CAA3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,KAAkB/qC,GAAlB,CAAsBC,IAAtB,GAA6B,UAAU+qC,OAAV,EAAmB;EAC9C,IAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;IACjC,IAAI;MACFA,OAAO,CAAC5qC,IAAR;IACD,CAFD,CAEE,OAAOkN,CAAP,EAAU;MACVnN,mDAAQ,CAAC,4BAAD,EAA+BmN,CAAC,CAACjK,OAAjC,EAA0CiK,CAAC,CAAC29B,KAA5C,CAAR;IACD;EACF,CAND,MAMO;IACL9qC,mDAAQ,CAAC,mEAAD,CAAR;EACD;AACF,CAVD;;AAYA,KAAkB+2B,GAAlB,CAAsBj3B,IAAtB,GAA6B,KAAkBD,GAAlB,CAAsBC,IAAnD;;AAEA,SAASirC,YAAT,CAAsBhB,KAAtB,EAA6B;EAC3BA,KAAK,CAACviC,OAAN,CAAc,UAAU3H,GAAV,EAAe;IAC3B,IAAI,OAAOA,GAAG,CAACmrC,MAAX,KAAsB,WAA1B,EAAuC;MACrC,IAAI;QACFnrC,GAAG,CAACI,IAAJ;QACAJ,GAAG,CAACmrC,MAAJ,GAAa,IAAb;MACD,CAHD,CAGE,OAAO79B,CAAP,EAAU;QACVnN,mDAAQ,CAAC,4BAAD,EAA+B,WAA/B,EAA4CmN,CAA5C,CAAR;MACD;IACF;EACF,CATD;AAUD;AAED;AACA;AACA;;;AACA,KAAkB49B,YAAlB,GAAiC,YAAY;EAC3CjkC,gDAAA;EACAikC,YAAY,CAAC,KAAkBhU,GAAnB,CAAZ;EACAgU,YAAY,CAAC,KAAkBlrC,GAAnB,CAAZ;AACD,CAJD;;AAMA,sEAAe;;;;;;;;;;;;;;AChiCf;AACA;AACAsa,MAAM,KAAN,GAA4BA,MAAM,KAAN,IAA4B,EAAxD;AACAA,MAAM,KAAN,CAAyBta,GAAzB,GAA+Bsa,MAAM,KAAN,CAAyBta,GAAzB,IAAgC,EAA/D;AACAsa,MAAM,KAAN,CAAyB4c,GAAzB,GAA+B5c,MAAM,KAAN,CAAyB4c,GAAzB,IAAgC,EAA/D,EAEA;;AACA5c,MAAM,CAAC8wB,YAAP,GAAsB9wB,MAAM,CAAC8wB,YAAP,IAAuB,EAA7C;;AACA9wB,MAAM,CAAC8wB,YAAP,CAAoBnrC,IAApB,CAAyB,MAAzB;;AAEO,SAAS8qB,SAAT,GAAqB;EAC1B,OAAOzQ,MAAM,KAAb;AACD;;;;;;;;;;;;;;;;;ACZD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;AACO,SAAS+wB,cAAT,CAAwB7rC,GAAxB,EAA2C;EAAA,IAAd8rC,GAAc,uEAARhxB,MAAQ;EAChD,IAAI,CAAC9a,GAAL,EAAU,OAAOA,GAAP;;EACV,IAAI,WAAW+rC,IAAX,CAAgB/rC,GAAhB,CAAJ,EAA0B;IACxB;IACA,OAAOA,GAAP;EACD;;EACD,IAAIgsC,WAAW,GAAGF,GAAG,CAACG,QAAJ,CAAaC,QAA/B;;EACA,IAAI;IACFF,WAAW,GAAGF,GAAG,CAACK,GAAJ,CAAQF,QAAR,CAAiBC,QAA/B;EACD,CAFD,CAEE,OAAOp+B,CAAP,EAAU,CAAE;;EACd,IAAI,QAAQi+B,IAAR,CAAa/rC,GAAb,CAAJ,EAAuB;IACrB;IACA,OAAOgsC,WAAW,GAAGhsC,GAArB;EACD,CAHD,MAGO;IACL,iBAAUgsC,WAAV,eAA0BhsC,GAA1B;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASosC,WAAT,CAAqBpsC,GAArB,EAAuE;EAAA,+EAAJ,EAAI;EAAA,6BAA5CqsC,YAA4C;EAAA,IAA5CA,YAA4C,kCAA7B,KAA6B;EAAA,uBAAtBC,MAAsB;EAAA,IAAtBA,MAAsB,4BAAb,KAAa;;EAC5E,IAAI;IACFtsC,GAAG,GAAG,IAAIusC,GAAJ,CAAQV,cAAc,CAAC7rC,GAAD,CAAtB,CAAN;EACD,CAFD,CAEE,OAAO8N,CAAP,EAAU;IACV;EACD;;EACD9N,GAAG,GAAGssC,MAAM,GAAGtsC,GAAG,CAACyoB,QAAP,GAAkBzoB,GAAG,CAACwsC,IAAlC;;EACA,IAAIH,YAAY,IAAIrsC,GAAG,CAACysC,UAAJ,CAAe,MAAf,CAApB,EAA4C;IAC1CzsC,GAAG,GAAGA,GAAG,CAAC0sC,SAAJ,CAAc,CAAd,CAAN;EACD;;EACD,OAAO1sC,GAAP;AACD;AAED;AACA;AACA;AACA;;AACO,SAAS2sC,aAAT,CAAuBb,GAAvB,EAA4B;EACjC;AACF;AACA;AACA;AACA;AACA;AACA;EACE,SAASc,kBAAT,CAA4Bd,GAA5B,EAAiC;IAC/B,IAAI;MACF,IAAI,CAACA,GAAG,CAACG,QAAJ,CAAaY,eAAlB,EAAmC;QACjC;MACD;;MAED,OAAOf,GAAG,CAACG,QAAJ,CAAaY,eAApB;IACD,CAND,CAME,OAAO/+B,CAAP,EAAU,CACV;IACD;EACF;EAED;AACF;AACA;AACA;AACA;AACA;;;EACE,SAASg/B,eAAT,CAAyBpqC,GAAzB,EAA8B;IAC5B,IAAI;MACF,IAAMqqC,OAAO,GAAGrqC,GAAG,CAACulC,aAAJ,CAAkB,uBAAlB,CAAhB;;MAEA,IAAI8E,OAAO,KAAK,IAAhB,EAAsB;QACpB,OAAOA,OAAO,CAAClyB,IAAf;MACD;IACF,CAND,CAME,OAAO/M,CAAP,EAAU,CACV;IACD;;IAED,OAAO,IAAP;EACD,CAtCgC,CAwCjC;EACA;EACA;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;EAEE;AACF;AACA;AACA;AACA;;;EACE,SAASzD,WAAT,GAAuB;IACrB,IAAMohC,KAAK,GAAG,EAAd;IACA,IAAMuB,SAAS,GAAGJ,kBAAkB,CAACd,GAAD,CAApC;IACA,IAAMtc,gBAAgB,GAAGvvB,wDAAA,CAAiB,kBAAjB,CAAzB;IACA,IAAIgtC,aAAJ;IACA,IAAIC,YAAJ;IACA,IAAIC,gBAAJ;IACA,IAAIC,UAAU,GAAG,KAAjB;IACA,IAAIC,KAAK,GAAG,CAAZ;IACA,IAAIC,aAAa,GAAG,KAApB;IACA,IAAIC,UAAU,GAAG,KAAjB;IACA,IAAIC,cAAc,GAAG,KAArB;;IAEA,GAAG;MACD,IAAMC,cAAc,GAAGR,aAAvB;MACA,IAAMS,aAAa,GAAGH,UAAtB;MACA,IAAII,eAAe,SAAnB;MACA,IAAIC,WAAW,GAAG,KAAlB;MACA,IAAIC,aAAa,GAAG,IAApB;MAEAN,UAAU,GAAG,KAAb;MACAN,aAAa,GAAGA,aAAa,GAAGA,aAAa,CAACa,MAAjB,GAA0BhC,GAAvD;;MAEA,IAAI;QACF6B,eAAe,GAAGV,aAAa,CAAChB,QAAd,CAAuBpxB,IAAvB,IAA+B,IAAjD;MACD,CAFD,CAEE,OAAO/M,CAAP,EAAU;QACV8/B,WAAW,GAAG,IAAd;MACD;;MAED,IAAIA,WAAJ,EAAiB;QACf,IAAIF,aAAJ,EAAmB;UACjB,IAAM5tB,OAAO,GAAG2tB,cAAc,CAAC3tB,OAA/B;;UAEA,IAAI;YACF+tB,aAAa,GAAG/tB,OAAO,CAACiuB,SAAxB;YACAb,YAAY,GAAGW,aAAf;YACAL,cAAc,GAAG,IAAjB;YAEAF,aAAa,GAAG,IAAhB;;YAEA,IAAIL,aAAa,KAAKnB,GAAG,CAACK,GAA1B,EAA+B;cAC7BiB,UAAU,GAAG,IAAb;YACD;;YAED,IAAIttB,OAAO,CAACkuB,YAAZ,EAA0B;cACxBb,gBAAgB,GAAGrtB,OAAO,CAACkuB,YAA3B;YACD;UACF,CAdD,CAcE,OAAOlgC,CAAP,EAAU;YAAE;UAAkB;QACjC,CAlBD,MAkBO;UACL1M,kDAAO,CAAC,gFAAD,CAAP;;UAEA,IAAI;YACF;YACA,IAAM6sC,QAAQ,GAAGR,cAAc,CAAC5qC,QAAf,CAAwBorC,QAAzC;;YAEA,IAAIA,QAAJ,EAAc;cACZJ,aAAa,GAAGI,QAAhB;;cAEA,IAAIhB,aAAa,KAAKnB,GAAG,CAACK,GAA1B,EAA+B;gBAC7BiB,UAAU,GAAG,IAAb;cACD;YACF;UACF,CAXD,CAWE,OAAOt/B,CAAP,EAAU;YAAE;UAAkB;;UAEhC,IAAI,CAAC+/B,aAAD,IAAkBb,SAAlB,IAA+BA,SAAS,CAACK,KAAK,GAAG,CAAT,CAA5C,EAAyD;YACvDQ,aAAa,GAAGb,SAAS,CAACK,KAAK,GAAG,CAAT,CAAzB;;YACA,IAAIJ,aAAa,KAAKnB,GAAG,CAACK,GAA1B,EAA+B;cAC7BqB,cAAc,GAAG,IAAjB;YACD;UACF;;UAED,IAAIK,aAAa,IAAI,CAACP,aAAtB,EAAqC;YACnCJ,YAAY,GAAGW,aAAf;UACD;QACF;MACF,CA9CD,MA8CO;QACL,IAAIF,eAAJ,EAAqB;UACnBE,aAAa,GAAGF,eAAhB;UACAT,YAAY,GAAGW,aAAf;UACAP,aAAa,GAAG,KAAhB;;UAEA,IAAIL,aAAa,KAAKnB,GAAG,CAACK,GAA1B,EAA+B;YAC7BiB,UAAU,GAAG,IAAb;;YAEA,IAAMY,aAAY,GAAGlB,eAAe,CAACG,aAAa,CAACpqC,QAAf,CAApC;;YAEA,IAAImrC,aAAJ,EAAkB;cAChBb,gBAAgB,GAAGa,aAAnB;YACD;UACF;QACF;;QAED,IAAIf,aAAa,CAACntB,OAAd,IAAyBmtB,aAAa,CAACntB,OAAd,CAAsBiuB,SAAnD,EAA8D;UAC5DR,UAAU,GAAG,IAAb;QACD;MACF;;MAED9B,KAAK,CAAChrC,IAAN,CAAWotC,aAAX;MACAR,KAAK;IACN,CAtFD,QAsFSJ,aAAa,KAAKnB,GAAG,CAACK,GAAtB,IAA6BkB,KAAK,GAAG7d,gBAtF9C;;IAwFAic,KAAK,CAACyC,OAAN;IAEA,IAAIC,GAAJ;;IACA,IAAI;MACFA,GAAG,GAAGrC,GAAG,CAACK,GAAJ,CAAQtpC,QAAR,CAAiBorC,QAAvB;IACD,CAFD,CAEE,OAAOngC,CAAP,EAAU,CAAE;;IAEd,IAAMm+B,QAAQ,GAAGmB,UAAU,IAAII,cAAd,GAA+BN,YAA/B,GAA8C,IAA/D;IACA,IAAMc,YAAY,GAAG/tC,wDAAA,CAAiB,SAAjB,KAA+BktC,gBAA/B,IAAmD,IAAxE;IACA,IAAMiB,IAAI,GAAGvC,cAAc,CAACmC,YAAD,EAAelC,GAAf,CAAd,IAAqCG,QAAlD;IAEA,OAAO;MACLmB,UAAU,EAAVA,UADK;MAELiB,KAAK,EAAEf,aAFF;MAGLgB,UAAU,EAAEjB,KAAK,GAAG,CAHf;MAIL5B,KAAK,EAALA,KAJK;MAKL8C,eAAe,EAAErB,YAAY,IAAI,IAL5B;MAMLjB,QAAQ,EAARA,QANK;MAOL+B,YAAY,EAAZA,YAPK;MAQLI,IAAI,EAAJA,IARK;MASLI,MAAM,EAAEpC,WAAW,CAACgC,IAAD,CAAX,IAAqB,IATxB;MAULD,GAAG,EAAEA,GAAG,IAAI,IAVP;MAWL;MACA;MACAM,MAAM,EAAE;QACNrB,UAAU,EAAVA,UADM;QAENiB,KAAK,EAAEf,aAFD;QAGNgB,UAAU,EAAEjB,KAAK,GAAG,CAHd;QAIN5B,KAAK,EAALA,KAJM;QAKNiD,OAAO,EAAExB,YAAY,IAAI,IALnB;QAMNc,YAAY,EAAZA;MANM;IAbH,CAAP;EAsBD;;EAED,OAAO3jC,WAAP;AACD;AAED;AACA;AACA;;AACO,IAAMC,cAAc,GAAGqiC,aAAa,CAAC7xB,MAAD,CAApC;;;;;;;;;;;;;;;;;;;;;;;;;ACpQP;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAMyoB,OAAO,GAAGoL,2DAAhB;AACA,IAAMjL,YAAY,GAAGiL,gEAArB;AACA,IAAMC,UAAU,GAAG,IAAIC,OAAJ,EAAnB;AAEA,IAAMC,WAAW,GAAG;EAClB,kBAAkBC,mBADA;EAElB,gBAAgBC;AAFE,CAApB;;AAKA,IAAI,MAAiB;EACnBvoC,MAAM,CAACC,MAAP,CAAcooC,WAAd,EAA2B;IACzB,iBAAiBG;EADQ,CAA3B;AAGD;;AAEM,SAAS1D,0BAAT,GAAsC;EAC3CzwB,MAAM,CAACo0B,gBAAP,CAAwB,SAAxB,EAAmCC,cAAnC,EAAmD,KAAnD;AACD;AAEM,SAASC,UAAT,CAAoBC,EAApB,EAAwB;EAC7B,IAAIA,EAAE,CAACr0B,MAAH,IAAa,IAAb,IAAqBq0B,EAAE,CAACC,KAAH,CAASntC,MAAT,KAAoB,CAA7C,EAAgD;IAC9C,OAAO,YAAY;MACjB,IAAM6W,GAAG,GAAG,qJAAZ;MACArY,mDAAQ,CAACqY,GAAD,CAAR;MACA,MAAM,IAAIyX,KAAJ,CAAUzX,GAAV,CAAN;IACD,CAJD;EAKD,CAND,MAMO,IAAIq2B,EAAE,CAACC,KAAH,CAASntC,MAAT,GAAkB,CAAtB,EAAyB;IAC9B,OAAO,UAAU0B,OAAV,EAAmB;MACxBwrC,EAAE,CAACC,KAAH,CAAS,CAAT,EAAYC,WAAZ,CAAwBn7B,IAAI,CAACC,SAAL,CAAexQ,OAAf,CAAxB;IACD,CAFD;EAGD,CAJM,MAIA;IACL,OAAO,UAAUA,OAAV,EAAmB;MACxBwrC,EAAE,CAACpvB,MAAH,CAAUsvB,WAAV,CAAsBn7B,IAAI,CAACC,SAAL,CAAexQ,OAAf,CAAtB,EAA+CwrC,EAAE,CAACr0B,MAAlD;IACD,CAFD;EAGD;AACF;AAEM,SAASm0B,cAAT,CAAwBE,EAAxB,EAA4B;EACjC,IAAI93B,GAAG,GAAG83B,EAAE,CAACxrC,OAAH,GAAa,SAAb,GAAyB,MAAnC;EACA,IAAIC,IAAI,GAAG,EAAX;;EACA,IAAI;IACFA,IAAI,GAAGsQ,IAAI,CAACgB,KAAL,CAAWi6B,EAAE,CAAC93B,GAAD,CAAb,CAAP;EACD,CAFD,CAEE,OAAOzJ,CAAP,EAAU;IACV;EACD;;EAED,IAAIhK,IAAI,IAAIA,IAAI,CAACC,IAAb,IAAqBD,IAAI,CAACD,OAA9B,EAAuC;IACrC,IAAM67B,QAAQ,GAAG18B,kDAAI,CAACmV,8EAAA,EAAD,EAAmC,UAAU1V,GAAV,EAAe;MACrE,OAAOA,GAAG,CAACsB,IAAJ,KAAaD,IAAI,CAACC,IAAzB;IACD,CAFoB,CAArB;;IAGA,IAAI+qC,WAAW,CAAC/S,cAAZ,CAA2Bj4B,IAAI,CAACD,OAAhC,CAAJ,EAA8C;MAC5CirC,WAAW,CAAChrC,IAAI,CAACD,OAAN,CAAX,CAA0BurC,UAAU,CAACC,EAAD,CAApC,EAA0CvrC,IAA1C,EAAgD47B,QAAhD;IACD;EACF;AACF;;AAED,SAASqP,mBAAT,CAA6BS,KAA7B,EAAoC1rC,IAApC,EAA0C47B,QAA1C,EAAoD;EAClD,IAAIA,QAAQ,IAAI,IAAhB,EAAsB;IACpB/7B,iEAAgB,CAAC;MACfC,MAAM,EAAE+qC,mFADO;MAEf9qC,OAAO,4BAAqBC,IAAI,CAACC,IAA1B,sCAFQ;MAGf7D,EAAE,EAAE4D,IAAI,CAACC;IAHM,CAAD,CAAhB;IAKA;EACD;;EACD,IAAI27B,QAAQ,CAAC7sB,MAAT,KAAoB87B,gEAAxB,EAAuD;IACrDvtC,kDAAO,iBAAUs+B,QAAQ,CAAC37B,IAAnB,+BAAP;IACAC,4CAAA,CAAY0/B,YAAZ,EAA0BhE,QAA1B;;IACA,IAAIv8B,qDAAU,CAAClD,wDAAA,CAAiB,gBAAjB,CAAD,EAAqC,qBAArC,CAAd,EAA2E;MACzE;IACD;EACF;;EAED,IAAI;IACFwvC,iBAAiB,CAAC/P,QAAD,EAAW8P,KAAX,CAAjB;EACD,CAFD,CAEE,OAAO1hC,CAAP,EAAU;IACVnK,iEAAgB,CAAC;MACfC,MAAM,EAAE+qC,8EADO;MAEf9qC,OAAO,EAAEiK,CAAC,CAACjK,OAFI;MAGf3D,EAAE,EAAE4D,IAAI,CAACC,IAHM;MAIftB,GAAG,EAAEi9B;IAJU,CAAD,CAAhB;IAMA;EACD,CA3BiD,CA6BlD;;;EACAvnB,4EAAA,CAA6BunB,QAA7B;EAEA17B,4CAAA,CAAYu/B,OAAZ,EAAqB7D,QAArB;AACD;;AAED,SAASuP,mBAAT,CAA6BO,KAA7B,EAAoC1rC,IAApC,EAA0C47B,QAA1C,EAAoD;EAClD;EACA;EACA;EACA;EACA;EACA,IAAIA,QAAQ,IAAI,IAAhB,EAAsB;IACpB/+B,mDAAQ,2BAAoBmD,IAAI,CAACC,IAAzB,kCAAR;IACA;EACD;;EAED,IAAI,CAAC6qC,UAAU,CAAC9mC,GAAX,CAAe43B,QAAf,CAAL,EAA+B;IAC7BkP,UAAU,CAACvlC,GAAX,CAAeq2B,QAAf;IACAvnB,4EAAA,CAA6BunB,QAA7B;IACA17B,4CAAA,CAAYu/B,OAAZ,EAAqB7D,QAArB;EACD;;EAED,QAAQ57B,IAAI,CAAC65B,MAAb;IACE,KAAK,cAAL;MACE6R,KAAK,CAACtP,2DAAe,CAACp8B,IAAD,EAAO47B,QAAP,CAAhB,CAAL;MACA;;IACF,KAAK,iBAAL;MACE8P,KAAK,CAACpP,+DAAmB,CAACt8B,IAAD,EAAO47B,QAAP,CAApB,CAAL;MACA;;IACF,KAAK,oBAAL;MACEA,QAAQ,CAACpnB,MAAT,GAAkBxU,IAAI,CAACwU,MAAvB;MACAonB,QAAQ,CAACtnB,KAAT,GAAiBtU,IAAI,CAACsU,KAAtB;MACAs3B,oBAAoB,CAAChQ,QAAD,CAApB;MACA;;IACF;MACElC,8DAAkB,CAAC15B,IAAD,EAAO47B,QAAP,CAAlB;EAbJ;AAeD;;AAED,SAASsP,kBAAT,CAA4BQ,KAA5B,EAAmC1rC,IAAnC,EAAyC47B,QAAzC,EAAmD;EACjD,IAAIA,QAAQ,IAAI,IAAhB,EAAsB;IACpB/+B,mDAAQ,2BAAoBmD,IAAI,CAACC,IAAzB,kCAAR;IACA;EACD;;EACD,IAAI27B,QAAQ,CAAC7sB,MAAT,KAAoB87B,gEAAxB,EAAuD;IACrDvtC,kDAAO,wFAAiF0C,IAAI,CAACC,IAAtF,OAAP;IACA;EACD;;EACD,QAAQD,IAAI,CAAC2zB,KAAb;IACE,KAAKkX,oEAAL;MACEhrC,iEAAgB,CAAC;QACflB,GAAG,EAAEi9B,QADU;QAEfx/B,EAAE,EAAE4D,IAAI,CAACC,IAFM;QAGfH,MAAM,EAAEE,IAAI,CAACuT,IAAL,CAAUzT,MAHH;QAIfC,OAAO,EAAEC,IAAI,CAACuT,IAAL,CAAUxT;MAJJ,CAAD,CAAhB;MAMA;;IACF,KAAK8qC,uEAAL;MACE1qC,sEAAqB,CAAC;QACpBvB,GAAG,EAAE,IADe;QAEpBD,GAAG,EAAEi9B,QAFe;QAGpBx/B,EAAE,EAAE4D,IAAI,CAACC;MAHW,CAAD,CAArB;MAKA;;IACF;MACEpD,mDAAQ,mEAA4DmD,IAAI,CAAC2zB,KAAjE,uBAAmF3zB,IAAI,CAACC,IAAxF,QAAR;EAjBJ;AAmBD;;AAEM,SAAS0rC,iBAAT,CAA2B/P,QAA3B,EAAqC8P,KAArC,EAA4C;EACjD,IAAQzrC,IAAR,GAAuE27B,QAAvE,CAAQ37B,IAAR;EAAA,IAAcskC,EAAd,GAAuE3I,QAAvE,CAAc2I,EAAd;EAAA,IAAkBE,KAAlB,GAAuE7I,QAAvE,CAAkB6I,KAAlB;EAAA,IAAyBnwB,KAAzB,GAAuEsnB,QAAvE,CAAyBtnB,KAAzB;EAAA,IAAgCE,MAAhC,GAAuEonB,QAAvE,CAAgCpnB,MAAhC;EAAA,IAAwC/V,QAAxC,GAAuEm9B,QAAvE,CAAwCn9B,QAAxC;EAAA,IAAkD4Q,GAAlD,GAAuEusB,QAAvE,CAAkDvsB,GAAlD;EAAA,IAAuDD,WAAvD,GAAuEwsB,QAAvE,CAAuDxsB,WAAvD,CADiD,CAEjD;;EACA,IAAI5Q,gEAAkB,CAACC,QAAD,CAAtB,EAAkC;IAChCC,6DAAe,CAACD,QAAD,EAAWm9B,QAAX,CAAf;EACD,CAFD,MAEO,IAAI37B,IAAJ,EAAU;IACf2rC,oBAAoB,CAAChQ,QAAD,CAApB;IACA8P,KAAK,CAAC;MACJ3rC,OAAO,EAAE,iBADL;MAEJwkC,EAAE,EAAEC,8DAAmB,CAACD,EAAD,EAAKn1B,WAAW,IAAIC,GAApB,CAFnB;MAGJo1B,KAAK,EAAED,8DAAmB,CAACC,KAAD,EAAQr1B,WAAW,IAAIC,GAAvB,CAHtB;MAIJpP,IAAI,EAAJA,IAJI;MAKJqU,KAAK,EAALA,KALI;MAMJE,MAAM,EAANA;IANI,CAAD,CAAL;EAQD;AACF;;AAED,SAASo3B,oBAAT,OAAmE;EAAA,IAAnC3rC,IAAmC,QAAnCA,IAAmC;EAAA,IAA7B1D,UAA6B,QAA7BA,UAA6B;EAAA,IAAjB+X,KAAiB,QAAjBA,KAAiB;EAAA,IAAVE,MAAU,QAAVA,MAAU;EACjE;EACA,CAAC,KAAD,EAAQ,QAAR,EAAkBnQ,OAAlB,CAA0B,UAAAwnC,OAAO,EAAI;IACnC;IACA,IAAI5C,OAAO,GAAG6C,kBAAkB,CAACD,OAAO,GAAG,gCAAX,CAAhC;;IACA,IAAI5C,OAAJ,EAAa;MACX,IAAI8C,YAAY,GAAG9C,OAAO,CAAC7D,KAA3B;MACA2G,YAAY,CAACz3B,KAAb,GAAqBA,KAAK,GAAGA,KAAK,GAAG,IAAX,GAAkB,MAA5C;MACAy3B,YAAY,CAACv3B,MAAb,GAAsBA,MAAM,GAAG,IAA/B;IACD,CAJD,MAIO;MACLlX,kDAAO,iEAA0Df,UAA1D,kEAAP;IACD;EACF,CAVD;;EAYA,SAASuvC,kBAAT,CAA4BD,OAA5B,EAAqC;IACnC,IAAIzvC,EAAE,GAAG4vC,2BAA2B,CAAC/rC,IAAD,EAAO1D,UAAP,CAApC;IACA,IAAI0vC,YAAY,GAAGltC,QAAQ,CAACmtC,cAAT,CAAwB9vC,EAAxB,CAAnB;IACA,OAAO6vC,YAAY,IAAIA,YAAY,CAAC9H,aAAb,CAA2B0H,OAA3B,CAAvB;EACD;;EAED,SAASG,2BAAT,CAAqC/rC,IAArC,EAA2C1D,UAA3C,EAAuD;IACrD,IAAIonC,6DAAkB,EAAtB,EAA0B;MACxB,OAAOwI,eAAe,CAAClsC,IAAD,CAAtB;IACD,CAFD,MAEO,IAAImsC,6DAAkB,EAAtB,EAA0B;MAC/B,OAAOC,eAAe,CAAC9vC,UAAD,CAAtB;IACD,CAFM,MAEA;MACL,OAAOA,UAAP;IACD;EACF;;EAED,SAAS4vC,eAAT,CAAyBlsC,IAAzB,EAA+B;IAC7B,IAAMqsC,IAAI,GAAGptC,kDAAI,CAAC8X,MAAM,CAACu1B,SAAP,CAAiBC,MAAjB,GAA0BC,QAA1B,EAAD,EAAuC,UAAAH,IAAI,EAAI;MAC9D,OAAOptC,kDAAI,CAACotC,IAAI,CAACI,gBAAL,EAAD,EAA0B,UAAAj5B,GAAG,EAAI;QAC1C,OAAO9J,sDAAQ,CAAC2iC,IAAI,CAACK,YAAL,CAAkBl5B,GAAlB,CAAD,EAAyBxT,IAAzB,CAAf;MACD,CAFU,CAAX;IAGD,CAJgB,CAAjB;IAKA,OAAOqsC,IAAI,GAAGA,IAAI,CAACM,gBAAL,EAAH,GAA6B,IAAxC;EACD;;EAED,SAASP,eAAT,CAAyB9vC,UAAzB,EAAqC;IACnC,IAAIswC,MAAM,GAAG71B,MAAM,CAAC81B,MAAP,CAAcC,MAAd,CAAqBxwC,UAArB,CAAb;IACA,OAAOswC,MAAM,IAAIA,MAAM,CAACG,QAAxB;EACD;AACF;;;;;;;;;;;;;;;;;;;;;;;ACvOD;AACA;AACA;AACA;AAEA,IAAIC,UAAU,GAAG,EAAjB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AACO,SAASC,aAAT,CAAuB/wC,MAAvB,EAA+B;EACpC8wC,UAAU,GAAG9wC,MAAb;AACD;AACDA,wDAAA,CAAiB,YAAjB,EAA+B,UAAAA,MAAM;EAAA,OAAI+wC,aAAa,CAAC/wC,MAAM,CAAC8wC,UAAR,CAAjB;AAAA,CAArC;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,SAAT,CAAmBC,WAAnB,EAAgCC,YAAhC,EAA8C;EACnD,IAAID,WAAW,CAACE,QAAhB,EAA0B;IACxB,OAAO;MAACA,QAAQ,EAAE,IAAX;MAAiBtoC,MAAM,EAAEooC,WAAW,CAACE,QAArC;MAA+CD,YAAY,EAAZA;IAA/C,CAAP;EACD;;EACD,OAAO;IAACC,QAAQ,EAAE,KAAX;IAAkBtoC,MAAM,EAAEooC,WAAW,CAACG,QAAtC;IAAgDF,YAAY,EAAZA;EAAhD,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASG,aAAT,CAAuBvoB,IAAvB,EAAmD;EAAA,IAAtBwoB,OAAsB,uEAAZR,UAAY;EACxD,IAAIS,IAAI,GAAGC,kBAAkB,CAACF,OAAD,CAA7B;;EACA,IAAI,CAACC,IAAI,CAACE,YAAV,EAAwB;IACtB,OAAO,IAAP;EACD;;EACD,OAAO,CAAC,CAACF,IAAI,CAACG,cAAL,CAAoB5oB,IAApB,CAAT;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS6oB,aAAT,GAAyH;EAAA,+EAA7C,EAA6C;EAAA,uBAAjG9oC,MAAiG;EAAA,IAAjGA,MAAiG,4BAAxF,EAAwF;EAAA,yBAApFsoC,QAAoF;EAAA,IAApFA,QAAoF,8BAAzE,KAAyE;EAAA,6BAAlED,YAAkE;EAAA,IAAlEA,YAAkE,kCAAnD,EAAmD;;EAAA,IAAzCvqC,UAAyC;EAAA,IAA7BG,KAA6B;EAAA,IAAtBwqC,OAAsB,uEAAZR,UAAY;EAC9H,IAAIS,IAAI,GAAGC,kBAAkB,CAACF,OAAD,CAA7B;;EAEA,IAAI,CAACtgC,wDAAa,CAACrK,UAAD,CAAlB,EAAgC;IAC9B;IACA,IAAIG,KAAJ,EAAW;MACTH,UAAU,GAAG;QACX6R,MAAM,EAAE;UACN1R,KAAK,EAALA;QADM;MADG,CAAb;IAKD,CAND,MAMO;MACLH,UAAU,GAAG,EAAb;IACD;EACF;;EAED,IAAIirC,QAAQ,GAAG1uC,qDAAU,CAACyD,UAAD,EAAa,cAAb,CAAzB;;EACA,IAAI4qC,IAAI,CAACE,YAAL,IAAqBG,QAAzB,EAAmC;IACjCjrC,UAAU,GAAGsB,oDAAS,CAACtB,UAAD,CAAtB;IACAA,UAAU,CAAC6R,MAAX,CAAkB1R,KAAlB,GAA0B8qC,QAAQ,CAACrrC,MAAT,CAAgB,UAAAuiB,IAAI;MAAA,OAAIyoB,IAAI,CAACG,cAAL,CAAoB5oB,IAApB,CAAJ;IAAA,CAApB,CAA1B;EACD;;EAED,IAAI+oB,OAAO,GAAG;IACZC,MAAM,EACJ,CAACnrC,UAAU,CAACm1B,cAAX,CAA0BpC,kDAA1B,CADK,IAGNx2B,qDAAU,CAACyD,UAAD,EAAa,qBAAb,CAAV,GAAgD,CAAhD,KACEkC,MAAM,CAAC3G,MAAP,KAAkB,CAAlB,IACG,CAACivC,QAAD,KACCtoC,MAAM,CAACyX,IAAP,CAAY,UAAAyxB,KAAK;MAAA,OAAIR,IAAI,CAAC1oC,MAAL,CAAYkpC,KAAZ,CAAJ;IAAA,CAAjB,KACAlpC,MAAM,CAACyX,IAAP,CAAY,UAAAyxB,KAAK;MAAA,OAAIvkC,sDAAQ,CAAC0jC,YAAD,EAAea,KAAf,CAAZ;IAAA,CAAjB,CAFD,CAAD,IAICZ,QAAQ,IACPtoC,MAAM,CAACzC,MAAP,CAAc,UAACC,MAAD,EAAS0rC,KAAT;MAAA,OAAmB,CAAC1rC,MAAD,GAAUA,MAAV,GAC/BkrC,IAAI,CAAC1oC,MAAL,CAAYkpC,KAAZ,KAAsBvkC,sDAAQ,CAAC0jC,YAAD,EAAea,KAAf,CADlB;IAAA,CAAd,EAEG,IAFH,CAPN,CAJU;IAkBZprC,UAAU,EAAVA;EAlBY,CAAd;;EAqBA,IAAIirC,QAAQ,IAAIA,QAAQ,CAAC1vC,MAAT,KAAoByE,UAAU,CAAC6R,MAAX,CAAkB1R,KAAlB,CAAwB5E,MAA5D,EAAoE;IAClE2vC,OAAO,CAACG,aAAR,GAAwB;MACtBl6B,MAAM,EAAE85B,QADc;MAEtBK,KAAK,EAAEtrC,UAAU,CAAC6R,MAAX,CAAkB1R;IAFH,CAAxB;EAID;;EAED,OAAO+qC,OAAP;AACD;;AAED,SAASL,kBAAT,CAA4BF,OAA5B,EAAqC;EACnC,OAAOA,OAAO,CAAClrC,MAAR,CAAe,UAACyrC,OAAD,EAAU7xC,MAAV,EAAqB;IACzC,IACE,0EAAOA,MAAP,MAAkB,QAAlB,IACA,OAAOA,MAAM,CAACkyC,UAAd,KAA6B,QAD7B,IAEAlyC,MAAM,CAACkyC,UAAP,CAAkBhwC,MAAlB,GAA2B,CAH7B,EAIE;MACA,IAAIiwC,SAAS,GAAG,KAAhB;;MAEA,IAAI;QACFA,SAAS,GAAGC,uDAAY,GAAGC,UAAf,CAA0BryC,MAAM,CAACkyC,UAAjC,EAA6CI,OAAzD;MACD,CAFD,CAEE,OAAOzkC,CAAP,EAAU;QACV1M,kDAAO,CAAC,oEAAD,CAAP;QAEAgxC,SAAS,GAAGE,UAAU,CAACryC,MAAM,CAACkyC,UAAR,CAAV,CAA8BI,OAA1C;MACD;;MAED,IAAIH,SAAJ,EAAe;QACb,IAAIvhC,KAAK,CAAC/K,OAAN,CAAc7F,MAAM,CAAC0xC,cAArB,CAAJ,EAA0C;UACxCG,OAAO,CAACJ,YAAR,GAAuB,IAAvB;QACD;;QACD,CAAC,QAAD,EAAW,gBAAX,EAA6BvpC,OAA7B,CACE,UAAA+N,IAAI;UAAA,OAAI,CAACjW,MAAM,CAACiW,IAAD,CAAN,IAAgB,EAAjB,EAAqB/N,OAArB,CACN,UAAAqqC,KAAK;YAAA,OAAIV,OAAO,CAAC57B,IAAD,CAAP,CAAcs8B,KAAd,IAAuB,IAA3B;UAAA,CADC,CAAJ;QAAA,CADN;MAKD;IACF,CAzBD,MAyBO;MACLpxC,kDAAO,CAAC,wDAAD,CAAP;IACD;;IACD,OAAO0wC,OAAP;EACD,CA9BM,EA8BJ;IACDhpC,MAAM,EAAE,EADP;IAED6oC,cAAc,EAAE,EAFf;IAGDD,YAAY,EAAE;EAHb,CA9BI,CAAP;AAmCD;;AAEM,SAAS3oC,uBAAT,CAAiCjG,OAAjC,EAA0CquC,YAA1C,EAAwD;EAC7D,OAAOruC,OAAO,CAACuD,MAAR,CAAe,UAACvD,OAAD,EAAUC,MAAV,EAAqB;IACzC,qBAII6uC,aAAa,CACfX,SAAS,CAACluC,MAAD,EAASouC,YAAT,CADM,EAEfpuC,MAAM,CAAC6D,UAFQ,EAGf7D,MAAM,CAACgE,KAHQ,CAJjB;IAAA,IACEgrC,MADF,kBACEA,MADF;IAAA,IAEEnrC,UAFF,kBAEEA,UAFF;IAAA,IAGEqrC,aAHF,kBAGEA,aAHF;;IAUA,IAAI,CAACF,MAAL,EAAa;MACXniC,kDAAO,0CAAkC7M,MAAM,CAACE,IAAzC,QAAP;IACD,CAFD,MAEO;MACL,IAAIgvC,aAAJ,EAAmB;QACjBriC,kDAAO,0CAAkC7M,MAAM,CAACE,IAAzC,4BAAqEgvC,aAAa,CAACl6B,MAAnF,EAA2F,KAA3F,EAAkGk6B,aAAa,CAACC,KAAhH,CAAP;MACD;;MAEDnvC,MAAM,CAAC6D,UAAP,GAAoBA,UAApB;MAEA7D,MAAM,CAACwD,IAAP,GAAcxD,MAAM,CAACwD,IAAP,CAAYF,MAAZ,CAAmB,UAACE,IAAD,EAAO9D,GAAP,EAAe;QAC9C,sBAIImvC,aAAa,CAACX,SAAS,CAACxuC,GAAD,EAAM0uC,YAAN,CAAV,EAA+BpuC,MAAM,CAAC6D,UAAtC,CAJjB;QAAA,IACEmrC,MADF,mBACEA,MADF;QAAA,IAEEnrC,UAFF,mBAEEA,UAFF;QAAA,IAGEqrC,aAHF,mBAGEA,aAHF;;QAMA,IAAI,CAACF,MAAL,EAAa;UACXniC,kDAAO,6CAAqC7M,MAAM,CAACE,IAA5C,yBAA6DR,GAAG,CAACoC,MAAjE,QAAP;QACD,CAFD,MAEO;UACL,IAAIotC,aAAJ,EAAmB;YACjBriC,kDAAO,0CAAkC7M,MAAM,CAACE,IAAzC,yBAA0DR,GAAG,CAACoC,MAA9D,4BAA4FotC,aAAa,CAACl6B,MAA1G,EAAkH,KAAlH,EAAyHk6B,aAAa,CAACC,KAAvI,CAAP;YACAzvC,GAAG,CAACmE,UAAJ,GAAiBA,UAAjB;UACD;;UACDL,IAAI,CAAC9F,IAAL,CAAUgC,GAAV;QACD;;QACD,OAAO8D,IAAP;MACD,CAjBa,EAiBX,EAjBW,CAAd;MAkBAzD,OAAO,CAACrC,IAAR,CAAasC,MAAb;IACD;;IACD,OAAOD,OAAP;EACD,CAzCM,EAyCJ,EAzCI,CAAP;AA0CD;;;;;;;;;;;;;;;;;;;;ACtMD;AACA;AACA;AAEA,IAAM2vC,mBAAmB,GAAG,CAAC,MAAD,EAAS,eAAT,CAA5B;AAEO,IAAIjI,gBAAgB,GAAG,EAAvB;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASkI,iBAAT,GAA4H;EAAA,+EAAnD,EAAmD;EAAA,IAAhG5jC,KAAgG,QAAhGA,KAAgG;EAAA,IAAzF6jC,UAAyF,QAAzFA,UAAyF;EAAA,IAA7EvuC,UAA6E,QAA7EA,UAA6E;EAAA,IAAjEwuC,UAAiE,QAAjEA,UAAiE;;EAAA,gFAAJ,EAAI;EAAA,iCAA9C/+B,cAA8C;EAAA,IAA9CA,cAA8C,qCAA7Bg/B,8DAA6B;;EACjI,SAASC,eAAT,GAA2B;IACzB,IAAI1uC,UAAU,IAAI,IAAlB,EAAwB;MACtB,OAAO,IAAP;IACD;;IACD,IAAM2uC,cAAc,GAAGl/B,cAAc,CAAC8B,GAAf,CAAmBvR,UAAnB,EAA+B,gBAA/B,CAAvB;IACA,OAAO2uC,cAAc,IAAI,IAAlB,GAAyB,KAAzB,GAAiCA,cAAxC;EACD;;EAED,IAAMC,YAAY,GAAGP,mBAAmB,CAAChlC,QAApB,CAA6BmlC,UAA7B,CAArB;;EAEA,SAASphC,OAAT,CAAiBqT,EAAjB,EAAqB;IACnB,IAAI,CAACiuB,eAAe,EAApB,EAAwB;MACtBljC,kDAAO,sEAA+DxL,UAA/D,OAAP;MACA,IAAMkC,MAAM,GAAG;QAAC2sC,KAAK,EAAE;MAAR,CAAf;MACA,OAAOpuB,EAAE,CAACve,MAAD,CAAT;IACD,CAJD,MAIO;MACL,IAAIoV,KAAJ;MACA,IAAIw3B,WAAW,GAAG;QAChBC,kBAAkB,EAAE;MADJ,CAAlB;MAGAC,0BAA0B,CAACJ,YAAD,EAAelkC,KAAf,EAAsB1K,UAAU,IAAIuuC,UAApC,EAAgDO,WAAhD,EAA6D,UAAS5sC,MAAT,EAAiB;QACtG,IAAIA,MAAM,IAAIA,MAAM,CAAC6sC,kBAArB,EAAyC;UACvCz3B,KAAK,GAAGmJ,EAAE,CAACve,MAAD,CAAV;QACD,CAFD,MAEO;UACL,IAAIA,OAAM,GAAG;YACX6sC,kBAAkB,EAAE,KADT;YAEXF,KAAK,EAAEI,0DAAe;UAFX,CAAb;UAIA33B,KAAK,GAAGmJ,EAAE,CAACve,OAAD,CAAV;QACD;MACF,CAVyB,CAA1B;MAWA,OAAOoV,KAAP;IACD;EACF;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,IAAM43B,SAAS,GAAG,SAAZA,SAAY,CAAU/7B,GAAV,EAAemE,KAAf,EAAsB63B,OAAtB,EAA+BC,QAA/B,EAAyChF,MAAzC,EAAiDxhC,IAAjD,EAAuD;IACvE,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,IAAMQ,aAAa,GAAIjF,MAAM,IAAIA,MAAM,KAAK,EAAtB,sBAAwCkF,kBAAkB,CAAClF,MAAD,CAA1D,IAAuE,EAA7F;QACA,IAAMmF,cAAc,GAAIJ,OAAO,IAAIA,OAAO,KAAK,EAAxB,uBAA2CA,OAA3C,IAAuD,EAA9E;QACA,IAAMK,MAAM,GAAIJ,QAAQ,IAAI,IAAZ,IAAoBA,QAAQ,CAACx/B,WAAT,MAA0B,MAA9D;QACA,IAAM6/B,MAAM,GAAID,MAAD,GAAW,UAAX,GAAwB,EAAvC;QACA/wC,QAAQ,CAACixC,MAAT,aAAqBv8B,GAArB,cAA4Bm8B,kBAAkB,CAACh4B,KAAD,CAA9C,SAAwDi4B,cAAxD,qBAAiFF,aAAjF,SAAiGD,QAAQ,wBAAiBA,QAAjB,IAA8B,EAAvI,SAA4IK,MAA5I;MACD;IACF,CARD;;IASA,IAAI7mC,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAlBD;EAoBA;AACF;AACA;AACA;;;EACE,IAAMkvB,SAAS,GAAG,SAAZA,SAAY,CAAS/a,IAAT,EAAehsB,IAAf,EAAqB;IACrC,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,IAAIxZ,CAAC,GAAG3e,MAAM,CAACjY,QAAP,CAAgBixC,MAAhB,CAAuBxW,KAAvB,CAA6B,cAActE,IAAd,GAAqB,2BAAlD,CAAR;QACA,OAAOS,CAAC,GAAGua,kBAAkB,CAACva,CAAC,CAAC,CAAD,CAAF,CAArB,GAA8B,IAAtC;MACD;;MACD,OAAO,IAAP;IACD,CAND;;IAOA,IAAIzsB,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAhBD;EAkBA;AACF;AACA;;;EACE,IAAMovB,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAUjnC,IAAV,EAAgB;IAC5C,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,IAAI;UACFiB,YAAY,CAACC,OAAb,CAAqB,mBAArB,EAA0C,GAA1C;UACA,OAAOD,YAAY,CAACrd,OAAb,CAAqB,mBAArB,MAA8C,GAArD;QACD,CAHD,CAGE,OAAOx0B,KAAP,EAAc,CACf,CAJD,SAIU;UACR,IAAI;YACF6xC,YAAY,CAACE,UAAb,CAAwB,mBAAxB;UACD,CAFD,CAEE,OAAO/xC,KAAP,EAAc,CAAE;QACnB;MACF;;MACD,OAAO,KAAP;IACD,CAbD;;IAcA,IAAI2K,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAvBD;EAyBA;AACF;AACA;;;EACE,IAAMwvB,iBAAiB,GAAG,SAApBA,iBAAoB,CAAUrnC,IAAV,EAAgB;IACxC,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,OAAOqB,6DAAkB,EAAzB;MACD;;MACD,OAAO,KAAP;IACD,CALD;;IAMA,IAAItnC,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAfD;EAiBA;AACF;AACA;AACA;;;EACE,IAAMhN,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAUN,GAAV,EAAemE,KAAf,EAAsB1O,IAAtB,EAA4B;IACxD,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAAjB,IAA0BsB,eAAe,EAA7C,EAAiD;QAC/Cz5B,MAAM,CAACo5B,YAAP,CAAoBC,OAApB,CAA4B58B,GAA5B,EAAiCmE,KAAjC;MACD;IACF,CAJD;;IAKA,IAAI1O,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAdD;EAgBA;AACF;AACA;AACA;;;EACE,IAAMnN,uBAAuB,GAAG,SAA1BA,uBAA0B,CAAUH,GAAV,EAAevK,IAAf,EAAqB;IACnD,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAAjB,IAA0BsB,eAAe,EAA7C,EAAiD;QAC/C,OAAOz5B,MAAM,CAACo5B,YAAP,CAAoBrd,OAApB,CAA4Btf,GAA5B,CAAP;MACD;;MACD,OAAO,IAAP;IACD,CALD;;IAMA,IAAIvK,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAfD;EAiBA;AACF;AACA;;;EACE,IAAM2vB,0BAA0B,GAAG,SAA7BA,0BAA6B,CAAUj9B,GAAV,EAAevK,IAAf,EAAqB;IACtD,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAAjB,IAA0BsB,eAAe,EAA7C,EAAiD;QAC/Cz5B,MAAM,CAACo5B,YAAP,CAAoBE,UAApB,CAA+B78B,GAA/B;MACD;IACF,CAJD;;IAKA,IAAIvK,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAdD;EAgBA;AACF;AACA;;;EACE,IAAM0vB,eAAe,GAAG,SAAlBA,eAAkB,CAAUvnC,IAAV,EAAgB;IACtC,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,IAAI;UACF,OAAO,CAAC,CAACn4B,MAAM,CAACo5B,YAAhB;QACD,CAFD,CAEE,OAAOpmC,CAAP,EAAU;UACVnN,mDAAQ,CAAC,4BAAD,CAAR;QACD;MACF;;MACD,OAAO,KAAP;IACD,CATD;;IAUA,IAAIqM,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CAnBD;EAqBA;AACF;AACA;AACA;AACA;AACA;;;EACE,IAAM4vB,kBAAkB,GAAG,SAArBA,kBAAqB,CAASC,OAAT,EAAkB1nC,IAAlB,EAAwB;IACjD,IAAI6X,EAAE,GAAG,SAALA,EAAK,CAAUve,MAAV,EAAkB;MACzB,IAAIA,MAAM,IAAIA,MAAM,CAAC2sC,KAArB,EAA4B;QAC1B,IAAMv8B,GAAG,GAAG,EAAZ;;QACA,IAAI28B,0DAAe,EAAnB,EAAuB;UACrB,IAAMsB,OAAO,GAAG9xC,QAAQ,CAACixC,MAAT,CAAgBl7B,KAAhB,CAAsB,GAAtB,CAAhB;;UACA,OAAO+7B,OAAO,CAACxyC,MAAf,EAAuB;YACrB,IAAM2xC,MAAM,GAAGa,OAAO,CAACC,GAAR,EAAf;YACA,IAAIC,cAAc,GAAGf,MAAM,CAACniB,OAAP,CAAe,GAAf,CAArB;YACAkjB,cAAc,GAAGA,cAAc,GAAG,CAAjB,GAAqBf,MAAM,CAAC3xC,MAA5B,GAAqC0yC,cAAtD;YACA,IAAMC,UAAU,GAAGd,kBAAkB,CAACF,MAAM,CAAC3rB,KAAP,CAAa,CAAb,EAAgB0sB,cAAhB,EAAgCE,OAAhC,CAAwC,MAAxC,EAAgD,EAAhD,CAAD,CAArC;;YACA,IAAID,UAAU,CAACnjB,OAAX,CAAmB+iB,OAAnB,KAA+B,CAAnC,EAAsC;cACpCh+B,GAAG,CAACjW,IAAJ,CAASuzC,kBAAkB,CAACF,MAAM,CAAC3rB,KAAP,CAAa0sB,cAAc,GAAG,CAA9B,CAAD,CAA3B;YACD;UACF;QACF;;QACD,OAAOn+B,GAAP;MACD;IACF,CAjBD;;IAmBA,IAAI1J,IAAI,IAAI,OAAOA,IAAP,KAAgB,UAA5B,EAAwC;MACtCw9B,gBAAgB,CAAC/pC,IAAjB,CAAsB,YAAW;QAC/B,IAAI6F,MAAM,GAAGkL,OAAO,CAACqT,EAAD,CAApB;QACA7X,IAAI,CAAC1G,MAAD,CAAJ;MACD,CAHD;IAID,CALD,MAKO;MACL,OAAOkL,OAAO,CAACqT,EAAD,CAAd;IACD;EACF,CA5BD;;EA8BA,OAAO;IACLyuB,SAAS,EAATA,SADK;IAELS,SAAS,EAATA,SAFK;IAGLE,qBAAqB,EAArBA,qBAHK;IAILI,iBAAiB,EAAjBA,iBAJK;IAKLx8B,qBAAqB,EAArBA,qBALK;IAMLH,uBAAuB,EAAvBA,uBANK;IAOL88B,0BAA0B,EAA1BA,0BAPK;IAQLD,eAAe,EAAfA,eARK;IASLE,kBAAkB,EAAlBA;EATK,CAAP;AAWD;AAED;AACA;AACA;;AACO,IAAMrB,0BAA0B,GAAG3rC,8CAAI,CAAC,OAAD,EAAU,UAASurC,YAAT,EAAuBlkC,KAAvB,EAA8B6jC,UAA9B,EAA0CO,WAA1C,EAAuD/yC,QAAvD,EAAiE;EACvHA,QAAQ,CAAC+yC,WAAD,CAAR;AACD,CAF6C,EAE3C,4BAF2C,CAAvC;AAIP;AACA;AACA;AACA;;AACO,SAASziC,qBAAT,CAA+BkiC,UAA/B,EAA2C;EAChD,OAAOD,iBAAiB,CAAC;IAACC,UAAU,EAAEA,UAAb;IAAyBC,UAAU,EAAE;EAArC,CAAD,CAAxB;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASoC,iBAAT,GAAiE;EAAA,gFAAJ,EAAI;EAAA,IAArClmC,KAAqC,SAArCA,KAAqC;EAAA,IAA9B6jC,UAA8B,SAA9BA,UAA8B;EAAA,IAAlBvuC,UAAkB,SAAlBA,UAAkB;;EACtE,IAAIpD,SAAS,CAACmB,MAAV,GAAmB,CAAnB,IAAyBnB,SAAS,CAACmB,MAAV,GAAmB,CAAnB,IAAwB,CAAC8O,wDAAa,CAACjQ,SAAS,CAAC,CAAD,CAAV,CAAnE,EAAoF;IAClF,MAAM,IAAIyvB,KAAJ,CAAU,0CAAV,CAAN;EACD;;EACD,OAAOiiB,iBAAiB,CAAC;IAAC5jC,KAAK,EAALA,KAAD;IAAQ6jC,UAAU,EAAVA,UAAR;IAAoBvuC,UAAU,EAAVA;EAApB,CAAD,CAAxB;AACD;AAEM,SAAS6wC,SAAT,GAAqB;EAC1BzK,gBAAgB,GAAG,EAAnB;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvUD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAI0K,eAAe,GAAG,EAAtB;AAEA,IAAMC,iBAAiB,GAAG,EAA1B;AACA,IAAMC,UAAU,GAAG,IAAnB;AAEA,IAAMC,wBAAwB,yCAA9B;AACA,IAAMC,sBAAsB,uCAA5B;AACA,IAAMC,qCAAqC,2BAAmBF,wBAAnB,qBAAoDC,sBAApD,kBAA3C;AAEO,IAAM9tB,cAAc,GAAG/gB,MAAM,CAAC0J,IAAP,CAAY3M,2DAAZ,EAAsC4E,GAAtC,CAC5B,UAAAmP,GAAG;EAAA,OAAI/T,2DAAA,CAAyB+T,GAAzB,CAAJ;AAAA,CADyB,CAAvB,EAIP;;AACA,IAAMi+B,eAAe,GAAG,SAAlBA,eAAkB,CAAC/yC,GAAD;EAAA,OAAUA,GAAG,CAACyiB,iBAAJ,GAAwBziB,GAAG,CAACgzC,GAAJ,GAAU,IAAlC,GAAyCL,UAA1C,GAAwD5nC,oDAAS,EAA1E;AAAA,CAAxB,EAEA;;;AACA,IAAMkoC,WAAW,GAAG,SAAdA,WAAc,CAACjzC,GAAD;EAAA,OAASA,GAAG,KAAMA,GAAG,CAACoQ,MAAJ,IAAc,CAACpF,sDAAQ,CAAC,CAACjK,gEAAD,CAAD,EAAkCf,GAAG,CAACoQ,MAAtC,CAAxB,IAA0E,CAACpQ,GAAG,CAACoQ,MAApF,CAAZ;AAAA,CAApB;;AAEO,IAAI+zB,OAAO,GAAG;EACnB4O,eAAe,EAAfA,eADmB;EAEnBE,WAAW,EAAXA;AAFmB,CAAd,EAKP;AACA;AACA;;AACO,IAAMC,4BAA4B,GAAGluC,8CAAI,CAAC,MAAD,EAAS,UAASuW,YAAT,EAAuB43B,kBAAvB,EAAoF;EAAA,IAAzCC,cAAyC,uEAAxB,CAAwB;EAAA,IAArBC,WAAqB,uEAAP,KAAO;;EAC3I,IAAI,CAACA,WAAL,EAAkB;IAChB,IAAMvvC,IAAI,GAAG,EAAb;IACA,IAAMwvC,kBAAkB,GAAG91C,wDAAA,CAAiB,oCAAjB,CAA3B,CAFgB,CAGhB;;IACA,IAAIm0B,OAAO,GAAGlkB,kDAAO,CAAC8N,YAAD,EAAe,YAAf,CAArB,CAJgB,CAKhB;;IACAvX,MAAM,CAAC0J,IAAP,CAAYikB,OAAZ,EAAqBjsB,OAArB,CAA6B,UAAA6tC,SAAS,EAAI;MACxC,IAAIC,UAAU,GAAG,EAAjB;MACA,IAAIC,YAAY,GAAGhmC,kDAAO,CAACkkB,OAAO,CAAC4hB,SAAD,CAAR,EAAqB,YAArB,CAA1B;MACAvvC,MAAM,CAAC0J,IAAP,CAAY+lC,YAAZ,EAA0B/tC,OAA1B,CAAkC,UAAAoP,GAAG;QAAA,OAAI0+B,UAAU,CAACx1C,IAAX,CAAgBy1C,YAAY,CAAC3+B,GAAD,CAAZ,CAAkBlR,MAAlB,CAAyBuvC,kBAAzB,CAAhB,CAAJ;MAAA,CAArC,EAHwC,CAIxC;;MACA,IAAIC,cAAc,GAAG,CAArB,EAAwB;QACtBI,UAAU,GAAGF,kBAAkB,GAAGE,UAAU,CAACE,IAAX,CAAgBC,6BAA6B,CAAC,IAAD,CAA7C,CAAH,GAA0DH,UAAU,CAACE,IAAX,CAAgB,UAACtsB,CAAD,EAAIsd,CAAJ;UAAA,OAAUA,CAAC,CAACh0B,GAAF,GAAQ0W,CAAC,CAAC1W,GAApB;QAAA,CAAhB,CAAzF;QACA5M,IAAI,CAAC9F,IAAL,OAAA8F,IAAI,uFAAS0vC,UAAU,CAAC9tB,KAAX,CAAiB,CAAjB,EAAoB0tB,cAApB,CAAT,EAAJ;MACD,CAHD,MAGO;QACLtvC,IAAI,CAAC9F,IAAL,OAAA8F,IAAI,uFAAS0vC,UAAT,EAAJ;MACD;IACF,CAXD;IAaA,OAAO1vC,IAAP;EACD;;EAED,OAAOyX,YAAP;AACD,CAxB+C,CAAzC;AA0BP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASo4B,6BAAT,GAAuD;EAAA,IAAhBC,MAAgB,uEAAP,KAAO;EAC5D,OAAO,UAASxsB,CAAT,EAAYsd,CAAZ,EAAe;IACpB,IAAItd,CAAC,CAAClD,iBAAF,CAAoB2vB,OAApB,KAAgC5qC,SAAhC,IAA6Cy7B,CAAC,CAACxgB,iBAAF,CAAoB2vB,OAApB,KAAgC5qC,SAAjF,EAA4F;MAC1F,OAAO,CAAC,CAAR;IACD;;IAED,IAAKme,CAAC,CAAClD,iBAAF,CAAoB2vB,OAApB,KAAgC5qC,SAAhC,IAA6Cy7B,CAAC,CAACxgB,iBAAF,CAAoB2vB,OAApB,KAAgC5qC,SAAlF,EAA8F;MAC5F,OAAO,CAAP;IACD,CAPmB,CASpB;;;IACA,IAAI2qC,MAAJ,EAAY;MACV,OAAOlP,CAAC,CAACh0B,GAAF,GAAQ0W,CAAC,CAAC1W,GAAjB;IACD;;IAED,OAAOg0B,CAAC,CAACxgB,iBAAF,CAAoB4vB,KAApB,GAA4B1sB,CAAC,CAAClD,iBAAF,CAAoB4vB,KAAvD;EACD,CAfD;AAgBD;AAED;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEO,SAASC,YAAT,CAAsBr+B,cAAtB,EAAsC;EAC3C,IAAI2Q,SAAS,GAAG,EAAhB;EACA,IAAI2tB,sBAAsB,GAAG,EAA7B;;EAEA3tB,SAAS,CAAC4tB,yBAAV,GAAsC,UAASr2C,UAAT,EAAqB4F,SAArB,EAAgC;IACpEwwC,sBAAsB,CAACp2C,UAAD,CAAtB,GAAqC4F,SAArC;EACD,CAFD;;EAIA6iB,SAAS,CAAC6tB,oBAAV,GAAiC,UAASt2C,UAAT,EAAqBmnC,kBAArB,EAAyC;IACxE,IAAIC,6DAAkB,EAAtB,EAA0B;MACxB,IAAM7qB,WAAW,GAAGyE,cAAc,CAAChhB,UAAD,CAAlC;MACA,IAAMyC,OAAO,GAAGqV,cAAc,CAACiJ,UAAf,GAA4B5a,MAA5B,CAAmC,UAAAzD,MAAM;QAAA,OAAI0K,sDAAQ,CAACmP,WAAD,EAAc7Z,MAAM,CAACE,IAArB,CAAZ;MAAA,CAAzC,CAAhB;MACA,IAAI2zC,SAAS,GAAG1B,eAAe,CAAC7uC,MAAhB,CAAuB,UAACwwC,OAAD,EAAUt/B,GAAV,EAAkB;QACvDs/B,OAAO,CAACt/B,GAAD,CAAP,GAAe,IAAf;QACA,OAAOs/B,OAAP;MACD,CAHe,EAGb,EAHa,CAAhB;MAIA/7B,MAAM,CAACu1B,SAAP,CAAiBC,MAAjB,GAA0BC,QAA1B,GAAqCpoC,OAArC,CAA6C,UAAAioC,IAAI,EAAI;QACnD,IAAI0G,sBAAsB,GAAG7tB,+CAAI,CAACue,kBAAD,CAAJ,IAA4BA,kBAAkB,CAAC4I,IAAD,CAA3E,CADmD,CAEnD;;QACAttC,OAAO,CAACqF,OAAR,CAAgB,UAAA0hC,IAAI,EAAI;UACtB,IAAIA,IAAI,CAAC5mC,IAAL,KAAcmtC,IAAI,CAAC2G,aAAL,EAAd,IACAlN,IAAI,CAAC5mC,IAAL,KAAcmtC,IAAI,CAACM,gBAAL,EADd,IAECznB,+CAAI,CAAC6tB,sBAAD,CAAJ,IAAgCA,sBAAsB,CAACjN,IAAI,CAAC5mC,IAAN,CAF3D,EAEyE;YACvEmtC,IAAI,CAAC4G,sBAAL,CAA4BJ,SAA5B;UACD;QACF,CAND;MAOD,CAVD;IAWD;EACF,CApBD;;EAsBA9tB,SAAS,CAACmuB,uBAAV,GAAoC,UAAS52C,UAAT,EAAqB;IACvD,IAAMuc,WAAW,GAAGyE,cAAc,CAAChhB,UAAD,CAAlC;IACAuc,WAAW,CAACzU,OAAZ,CAAoB,UAAS0hC,IAAT,EAAe;MACjC,IAAM8G,MAAM,GAAG71B,MAAM,CAAC81B,MAAP,CAAcC,MAAd,CAAqBhH,IAArB,CAAf;;MACA,IAAI8G,MAAM,IAAIA,MAAM,CAACuG,QAArB,EAA+B;QAC7B,IAAMC,eAAe,GAAG1wC,MAAM,CAAC0J,IAAP,CAAYwgC,MAAM,CAACuG,QAAnB,CAAxB;QACA,IAAME,WAAW,GAAG,EAApB;QACAD,eAAe,CAAChvC,OAAhB,CAAwB,UAACoP,GAAD,EAAS;UAC/B,IAAI,CAAC9J,sDAAQ,CAACynC,eAAD,EAAkB39B,GAAG,CAACvD,WAAJ,EAAlB,CAAb,EAAmD;YACjDojC,WAAW,CAAC7/B,GAAD,CAAX,GAAmBo5B,MAAM,CAACuG,QAAP,CAAgB3/B,GAAhB,CAAnB;UACD;QACF,CAJD;QAKAuD,MAAM,CAAC81B,MAAP,CAAcyG,SAAd,CAAwBxN,IAAxB,EAA8B;UAAEqN,QAAQ,EAAEE;QAAZ,CAA9B;MACD;IACF,CAZD;EAaD,CAfD;EAiBA;AACF;AACA;AACA;;;EACE,SAASE,2BAAT,CAAqC70C,GAArC,EAA0Cma,WAA1C,EAAuD;IACrD,OAAOna,GAAG,CAACkkB,iBAAJ,IAAyB/J,WAAzB,KACH9W,kDAAO,CAAC8W,WAAD,CAAP,IAAwBnP,sDAAQ,CAACmP,WAAD,EAAcna,GAAG,CAACpC,UAAlB,CAAjC,IACA,OAAOuc,WAAP,KAAuB,QAAvB,IAAmCna,GAAG,CAACpC,UAAJ,KAAmBuc,WAFlD,CAAP;EAGD;;EAAA;EAED;AACF;AACA;;EACE,SAAS26B,WAAT,CAAqB36B,WAArB,EAAkCoB,YAAlC,EAAgD;IAC9C,IAAI/d,wDAAA,CAAiB,sCAAjB,MAA6D,IAAjE,EAAuE;MACrE,IAAMu3C,YAAY,GAAG,QAAkBhwB,cAAc,CAAC1J,MAAf,CAAsB8b,6DAAtB,CAAlB,GAAiEpS,CAAtF,CADqE,CAGrE;;MACA,IAAMjhB,IAAI,GAAGovC,4BAA4B,CAAC33B,YAAD,EAAe6oB,oDAAf,CAAzC,CAJqE,CAMrE;;MACA,OAAOtgC,IAAI,CAAC6B,GAAL,CAAS,UAAA3F,GAAG,EAAI;QACrB,IAAIA,GAAG,CAACgkB,MAAJ,IAAc6wB,2BAA2B,CAAC70C,GAAD,EAAMma,WAAN,CAA7C,EAAiE;UAC/D,OAAO,sFACJna,GAAG,CAACpC,UADP,EACoBo3C,eAAe,CAACh1C,GAAD,EAAM+0C,YAAY,CAAChxC,MAAb,CACrC,UAAA+Q,GAAG;YAAA,OAAI,OAAO9U,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAP,KAAsC,WAA1C;UAAA,CADkC,CAAN,CADnC;QAKD;MACF,CARM,EAQJ/Q,MARI,CAQG,UAAA/D,GAAG;QAAA,OAAIA,GAAJ;MAAA,CARN,CAAP,CAPqE,CAe9C;IACxB;;IACD,OAAO,EAAP;EACD;;EAAA;EAED;AACF;AACA;AACA;AACA;AACA;;EACE,SAASi1C,4BAAT,CAAsC5uB,SAAtC,EAAiD6uB,WAAjD,EAA8D;IAC5D,IAAMC,cAAc,GAAGnxC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBlD,2DAAlB,EAA4CA,wDAA5C,CAAvB;IACA,IAAMq0C,WAAW,GAAGpxC,MAAM,CAAC0J,IAAP,CAAYynC,cAAZ,CAApB;IACA,IAAME,eAAe,GAAG,EAAxB;IACAloC,kDAAO,+CAAwC+nC,WAAW,CAACvvC,GAAZ,CAAgB,UAAAsU,CAAC;MAAA,OAAIk7B,cAAc,CAACl7B,CAAD,CAAlB;IAAA,CAAjB,EAAwChP,IAAxC,CAA6C,IAA7C,CAAxC,QAAP;IACAob,SAAS,CAAC1gB,GAAV,CAAc,UAAArF,MAAM,EAAI;MACtB,IAAM1C,UAAU,GAAGoG,MAAM,CAAC0J,IAAP,CAAYpN,MAAZ,EAAoB,CAApB,CAAnB;MACA,IAAMg1C,OAAO,GAAGh1C,MAAM,CAAC1C,UAAD,CAAtB;MACA,IAAM8P,IAAI,GAAG4nC,OAAO,CAACvxC,MAAR,CAAe,UAAA+hB,MAAM,EAAI;QACpC,IAAMhR,GAAG,GAAG9Q,MAAM,CAAC0J,IAAP,CAAYoY,MAAZ,EAAoB,CAApB,CAAZ,CADoC,CAEpC;;QACA,IAAMyvB,QAAQ,GAAGH,WAAW,CAACrxC,MAAZ,CAAmB,UAAAyxC,UAAU;UAAA,OAAI1gC,GAAG,CAACoa,OAAJ,CAAYimB,cAAc,CAACK,UAAD,CAA1B,MAA4C,CAAhD;QAAA,CAA7B,EAAgF91C,MAAhF,KAA2F,CAA5G,CAHoC,CAIpC;;QACA,IAAM+1C,KAAK,GAAGF,QAAQ,IAAIh1C,kDAAI,CAAC20C,WAAD,EAAc,UAAAQ,UAAU,EAAI;UACxD,IAAMC,cAAc,GAAGR,cAAc,CAACO,UAAD,CAArC,CADwD,CAExD;UACA;;UACA,IAAMD,KAAK,GAAG3gC,GAAG,CAACoa,OAAJ,CAAYymB,cAAZ,MAAgC,CAA9C;UACA,OAAOF,KAAP;QACD,CAN6B,CAA9B;QAOAJ,eAAe,CAACvgC,GAAD,CAAf,GAAuB,CAAC2gC,KAAxB;QACA,OAAOA,KAAP;MACD,CAdY,CAAb;MAeAn1C,MAAM,CAAC1C,UAAD,CAAN,GAAqB8P,IAArB;IACD,CAnBD;IAoBA,IAAMkoC,WAAW,GAAG5xC,MAAM,CAAC0J,IAAP,CAAY2nC,eAAZ,EAA6BtxC,MAA7B,CAAoC,UAAA8xC,CAAC;MAAA,OAAIR,eAAe,CAACQ,CAAD,CAAnB;IAAA,CAArC,CAApB;IACA1oC,kDAAO,+CAAwCyoC,WAAW,CAAC3qC,IAAZ,CAAiB,IAAjB,CAAxC,QAAP,CA1B4D,CA2B5D;;IACA,IAAM6qC,iBAAiB,GAAGzvB,SAAS,CAACtiB,MAAV,CAAiB,UAAAzD,MAAM,EAAI;MACnD,IAAM1C,UAAU,GAAGoG,MAAM,CAAC0J,IAAP,CAAYpN,MAAZ,EAAoB,CAApB,CAAnB;MACA,IAAMg1C,OAAO,GAAGh1C,MAAM,CAAC1C,UAAD,CAAtB;MACA,OAAO03C,OAAO,CAAC51C,MAAR,GAAiB,CAAxB;IACD,CAJyB,CAA1B;IAKA,OAAOo2C,iBAAP;EACD;EAED;AACF;AACA;AACA;AACA;;;EACEzvB,SAAS,CAAC0vB,eAAV,GAA4B,UAASn4C,UAAT,EAAuD;IAAA,IAAlC2d,YAAkC,uEAAnBuD,eAAe,EAAI;IACjF,IAAM3E,WAAW,GAAGyE,cAAc,CAAChhB,UAAD,CAAlC,CADiF,CAGjF;IACA;;IACA,IAAIyoB,SAAS,GAAG2vB,sBAAsB,CAAC77B,WAAD,EAAcoB,YAAd,CAAtB,CACbF,MADa,CACN46B,qBAAqB,CAAC97B,WAAD,EAAcoB,YAAd,CADf,EAEbF,MAFa,CAEN7d,wDAAA,CAAiB,mBAAjB,IAAwC04C,wBAAwB,CAAC/7B,WAAD,EAAcoB,YAAd,CAAhE,GAA8Fu5B,WAAW,CAAC36B,WAAD,EAAcoB,YAAd,CAFnG,EAGbF,MAHa,CAGN86B,kBAAkB,CAACh8B,WAAD,CAHZ,CAAhB,CALiF,CAUjF;;IACAkM,SAAS,CAAC1gB,GAAV,CAAc,UAAA/H,UAAU,EAAI;MAC1BoG,MAAM,CAAC0J,IAAP,CAAY9P,UAAZ,EAAwB+H,GAAxB,CAA4B,UAAAmP,GAAG,EAAI;QACjClX,UAAU,CAACkX,GAAD,CAAV,CAAgBnP,GAAhB,CAAoB,UAAAywC,SAAS,EAAI;UAC/B,IAAI3D,eAAe,CAACvjB,OAAhB,CAAwBlrB,MAAM,CAAC0J,IAAP,CAAY0oC,SAAZ,EAAuB,CAAvB,CAAxB,MAAuD,CAAC,CAA5D,EAA+D;YAC7D3D,eAAe,GAAGzuC,MAAM,CAAC0J,IAAP,CAAY0oC,SAAZ,EAAuB/6B,MAAvB,CAA8Bo3B,eAA9B,CAAlB;UACD;QACF,CAJD;MAKD,CAND;IAOD,CARD;IAUA,IAAM2C,WAAW,GAAGpxC,MAAM,CAAC0J,IAAP,CAAY1J,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBlD,mEAAlB,EAAoDA,wDAApD,CAAZ,CAApB;IACA,IAAIm0C,WAAW,GAAG13C,wDAAA,CAAiBo1C,wBAAjB,CAAlB;IACA,IAAMyD,SAAS,GAAG74C,wDAAA,CAAiBq1C,sBAAjB,CAAlB;;IAEA,IAAIwD,SAAS,IAAI,IAAb,IAAqBnB,WAAW,IAAI,IAAxC,EAA8C;MAC5C,MAAM,IAAIlnB,KAAJ,CAAU8kB,qCAAV,CAAN;IACD,CAFD,MAEO,IAAIuD,SAAS,IAAI,IAAjB,EAAuB;MAC5BnB,WAAW,GAAGE,WAAW,CAAC/5B,MAAZ,CAAmBg7B,SAAnB,CAAd;IACD,CAFM,MAEA;MACLnB,WAAW,GAAGA,WAAW,IAAIE,WAA7B;IACD;;IAED,IAAIhnC,KAAK,CAAC/K,OAAN,CAAc6xC,WAAd,KAA8BA,WAAW,CAACx1C,MAAZ,GAAqB,CAAvD,EAA0D;MACxD2mB,SAAS,GAAG4uB,4BAA4B,CAAC5uB,SAAD,EAAY6uB,WAAZ,CAAxC;IACD;;IAED7uB,SAAS,GAAGiwB,gBAAgB,CAACjwB,SAAD,CAA5B;IAEA,IAAMkwB,oBAAoB,GAAG/4C,wDAAA,CAAiB,sCAAjB,CAA7B;;IACA,IAAI+4C,oBAAJ,EAA0B;MACxBppC,kDAAO,4GAAqGopC,oBAArG,qDAAP;MACAlwB,SAAS,GAAGmwB,mBAAmB,CAACnwB,SAAD,EAAYkwB,oBAAZ,CAA/B;IACD,CA3CgF,CA6CjF;;;IACAp8B,WAAW,CAACzU,OAAZ,CAAoB,UAAAlF,IAAI,EAAI;MAC1B,IAAI,CAAC6lB,SAAS,CAAC7lB,IAAD,CAAd,EAAsB;QACpB6lB,SAAS,CAAC7lB,IAAD,CAAT,GAAkB,EAAlB;MACD;IACF,CAJD;IAMA,OAAO6lB,SAAP;EACD,CArDD,CAhI2C,CAuL3C;;;EACA7oB,wDAAA,CAAiB,mBAAjB,EAAsC,UAAUA,MAAV,EAAkB;IACtD,IAAIkD,qDAAU,CAAClD,MAAD,EAASo1C,wBAAT,CAAV,IAAgD,IAAhD,IAAwDlyC,qDAAU,CAAClD,MAAD,EAASq1C,sBAAT,CAAV,IAA8C,IAA1G,EAAgH;MAC9G30C,mDAAQ,CAAC40C,qCAAD,CAAR;IACD;EACF,CAJD,EAxL2C,CA8L3C;EACA;;EACA,SAAS2D,sBAAT,CAAgCC,MAAhC,EAAwC;IACtC,OAAO1yC,MAAM,CAAC0J,IAAP,CAAYgpC,MAAZ,EAAoB9yC,MAApB,CAA2B,UAAU+yC,WAAV,EAAuB7hC,GAAvB,EAA4B;MAC5D,IAAI8hC,cAAc,aAAM9hC,GAAN,gBAAem8B,kBAAkB,CAACyF,MAAM,CAAC5hC,GAAD,CAAP,CAAjC,QAAlB;MACA,OAAO6hC,WAAW,IAAIC,cAAtB;IACD,CAHM,EAGJ,EAHI,CAAP;EAID;;EAED,SAASJ,mBAAT,CAA6BnwB,SAA7B,EAAwCkwB,oBAAxC,EAA8D;IAC5D;IACA,IAAIM,aAAa,GAAGpxC,oDAAS,CAAC4gB,SAAD,CAA7B;IAEA,IAAIywB,YAAY,GAAG9yC,MAAM,CAAC0J,IAAP,CAAYmpC,aAAZ,EAA2BlxC,GAA3B,CAA+B,UAAA/H,UAAU,EAAI;MAC9D,OAAO;QACLA,UAAU,EAAVA,UADK;QAELsmB,iBAAiB,EAAE2yB,aAAa,CAACj5C,UAAD;MAF3B,CAAP;IAID,CALkB,EAKhB81C,IALgB,CAKXC,6BAA6B,EALlB,CAAnB,CAJ4D,CAW5D;;IACA,OAAOmD,YAAY,CAAClzC,MAAb,CAAoB,UAAUmzC,MAAV,EAAkBC,OAAlB,EAA2B7sC,KAA3B,EAAkCq2B,GAAlC,EAAuC;MAChE,IAAIyW,iBAAiB,GAAGR,sBAAsB,CAACO,OAAO,CAAC9yB,iBAAT,CAA9C,CADgE,CAGhE;;MACA,IAAK/Z,KAAK,GAAG,CAAT,KAAgBq2B,GAAG,CAAC9gC,MAAxB,EAAgC;QAC9Bu3C,iBAAiB,GAAGA,iBAAiB,CAACvxB,KAAlB,CAAwB,CAAxB,EAA2B,CAAC,CAA5B,CAApB;MACD,CAN+D,CAQhE;;;MACA,IAAIllB,IAAI,GAAGw2C,OAAO,CAACp5C,UAAnB;MACA,IAAIs5C,SAAS,GAAGD,iBAAiB,CAACv3C,MAAlC;;MACA,IAAIw3C,SAAS,IAAIX,oBAAjB,EAAuC;QACrCA,oBAAoB,IAAIW,SAAxB;QACA/pC,kDAAO,mBAAY3M,IAAZ,yCAA+C02C,SAA/C,yEAAuHX,oBAAvH,GAA+IM,aAAa,CAACr2C,IAAD,CAA5J,CAAP;QAEAu2C,MAAM,CAACv2C,IAAD,CAAN,GAAeq2C,aAAa,CAACr2C,IAAD,CAA5B;MACD,CALD,MAKO;QACL7B,kDAAO,8CAAuC6B,IAAvC,qGAAsI02C,SAAtI,+CAAoLX,oBAApL,UAA+MM,aAAa,CAACr2C,IAAD,CAA5N,CAAP;MACD;;MAED,IAAK2J,KAAK,GAAG,CAAT,KAAgBq2B,GAAG,CAAC9gC,MAApB,IAA8BsE,MAAM,CAAC0J,IAAP,CAAYqpC,MAAZ,EAAoBr3C,MAApB,KAA+B,CAAjE,EAAoE;QAClExB,mDAAQ,CAAC,8JAAD,CAAR;MACD;;MACD,OAAO64C,MAAP;IACD,CAxBM,EAwBJ,EAxBI,CAAP;EAyBD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAAST,gBAAT,CAA0BjwB,SAA1B,EAAqC;IACnC,IAAI8wB,YAAY,GAAG9wB,SAAS,CAAC1gB,GAAV,CAAc,UAAA0gB,SAAS,EAAI;MAC5C,OAAO,sFACJriB,MAAM,CAAC0J,IAAP,CAAY2Y,SAAZ,EAAuB,CAAvB,CADH,EAC+BA,SAAS,CAACriB,MAAM,CAAC0J,IAAP,CAAY2Y,SAAZ,EAAuB,CAAvB,CAAD,CAAT,CAC1B1gB,GAD0B,CACtB,UAAA06B,MAAM,EAAI;QACb,OAAO,sFACJr8B,MAAM,CAAC0J,IAAP,CAAY2yB,MAAZ,EAAoB,CAApB,CADH,EAC4BA,MAAM,CAACr8B,MAAM,CAAC0J,IAAP,CAAY2yB,MAAZ,EAAoB,CAApB,CAAD,CAAN,CAA+Bp1B,IAA/B,CAAoC,GAApC,CAD5B;MAGD,CAL0B,EAKxBrH,MALwB,CAKjB,UAACwzC,CAAD,EAAIC,CAAJ;QAAA,OAAUrzC,MAAM,CAACC,MAAP,CAAcozC,CAAd,EAAiBD,CAAjB,CAAV;MAAA,CALiB,EAKc,EALd,CAD/B;IAQD,CATkB,EAShBxzC,MATgB,CAST,UAAU0zC,WAAV,EAAuBjxB,SAAvB,EAAkC;MAC1C,IAAIvR,GAAG,GAAG9Q,MAAM,CAAC0J,IAAP,CAAY2Y,SAAZ,EAAuB,CAAvB,CAAV;MACAixB,WAAW,CAACxiC,GAAD,CAAX,GAAmB9Q,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBqzC,WAAW,CAACxiC,GAAD,CAA7B,EAAoCuR,SAAS,CAACvR,GAAD,CAA7C,CAAnB;MACA,OAAOwiC,WAAP;IACD,CAbkB,EAahB,EAbgB,CAAnB;IAcA,OAAOH,YAAP;EACD;EAED;AACF;AACA;AACA;;;EACE9wB,SAAS,CAACkxB,kBAAV,GAA+B,UAASC,eAAT,EAA0BzS,kBAA1B,EAA8C;IAC3E1sB,MAAM,CAACu1B,SAAP,CAAiBC,MAAjB,GAA0BC,QAA1B,GAAqCpoC,OAArC,CAA6C,UAAAioC,IAAI,EAAI;MACnD3pC,MAAM,CAAC0J,IAAP,CAAY8pC,eAAZ,EAA6BzzC,MAA7B,CAAoCghC,kBAAkB,GAAGA,kBAAkB,CAAC4I,IAAD,CAArB,GAA8B8J,mEAAwB,CAAC9J,IAAD,CAA5G,EACGjoC,OADH,CACW,UAAA2oC,QAAQ,EAAI;QACnBrqC,MAAM,CAAC0J,IAAP,CAAY8pC,eAAe,CAACnJ,QAAD,CAA3B,EAAuC3oC,OAAvC,CAA+C,UAAAoP,GAAG,EAAI;UACpD,IAAImE,KAAK,GAAGu+B,eAAe,CAACnJ,QAAD,CAAf,CAA0Bv5B,GAA1B,CAAZ;;UACA,IAAI,OAAOmE,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,CAACiW,OAAN,CAAc,GAAd,MAAuB,CAAC,CAAzD,EAA4D;YAC1D;YACAjW,KAAK,GAAGA,KAAK,CAAC9C,KAAN,CAAY,GAAZ,CAAR;UACD;;UACDqhC,eAAe,CAACnJ,QAAD,CAAf,CAA0Bv5B,GAA1B,IAAiCmE,KAAjC;QACD,CAPD;QAQAxZ,qDAAU,qDAA8CkuC,IAAI,CAACM,gBAAL,EAA9C,2BAA6FuJ,eAAe,CAACnJ,QAAD,CAA5G,CAAV;QACAV,IAAI,CAAC4G,sBAAL,CAA4BiD,eAAe,CAACnJ,QAAD,CAA3C;MACD,CAZH;IAaD,CAdD;EAeD,CAhBD;EAkBA;AACF;AACA;AACA;AACA;;;EACE,SAASzvB,cAAT,CAAwBhhB,UAAxB,EAAoC;IAClC,IAAI,OAAOA,UAAP,KAAsB,QAA1B,EAAoC;MAClC,OAAO,CAACA,UAAD,CAAP;IACD,CAFD,MAEO,IAAIyF,kDAAO,CAACzF,UAAD,CAAX,EAAyB;MAC9B,OAAOA,UAAP;IACD;;IACD,OAAO8X,cAAc,CAACkJ,cAAf,MAAmC,EAA1C;EACD;;EAED,SAASE,eAAT,GAA2B;IACzB,IAAIvD,YAAY,GAAG7F,cAAc,CAACoJ,eAAf,EAAnB;;IAEA,IAAI,CAACthB,wDAAA,CAAiB,aAAjB,CAAL,EAAsC;MACpC;MACA+d,YAAY,GAAGA,YAAY,CAACxX,MAAb,CAAoB,UAAA/D,GAAG;QAAA,OAAIg0C,sBAAsB,CAACh0C,GAAG,CAACpC,UAAL,CAAtB,KAA2CoC,GAAG,CAACwD,SAAnD;MAAA,CAAvB,CAAf;IACD,CAHD,MAGO;MACL;MACA;MACA,IAAMk0C,cAAc,GAAGl6C,wDAAA,CAAiB,wBAAjB,CAAvB;;MACA,IAAI,OAAOk6C,cAAP,KAA0B,UAA9B,EAA0C;QACxCn8B,YAAY,GAAGA,YAAY,CAACxX,MAAb,CAAoB,UAAA/D,GAAG;UAAA,OAAIg0C,sBAAsB,CAACh0C,GAAG,CAACpC,UAAL,CAAtB,KAA2CoC,GAAG,CAACwD,SAA/C,IAA4D,CAAC,CAACk0C,cAAc,CAAC13C,GAAD,CAAhF;QAAA,CAAvB,CAAf;MACD;IACF;;IAEDub,YAAY,GAAGA,YAAY,CACxBxX,MADY,CACL,UAAA/D,GAAG;MAAA,OAAIU,qDAAU,CAACV,GAAD,EAAM,eAAN,CAAV,KAAqCyU,iDAAzC;IAAA,CADE,EAEZ1Q,MAFY,CAEL,UAAA/D,GAAG;MAAA,OAAIA,GAAG,CAACwW,SAAJ,KAAkB,QAAlB,IAA8Bq4B,+DAAa,CAAC,CAAC7uC,GAAG,CAAC2V,KAAL,EAAY3V,GAAG,CAAC6V,MAAhB,CAAD,CAA/C;IAAA,CAFE,EAGZ9R,MAHY,CAGLogC,OAAO,CAAC8O,WAHH,EAIZlvC,MAJY,CAILogC,OAAO,CAAC4O,eAJH,CAAf;IAOA,OAAOG,4BAA4B,CAAC33B,YAAD,EAAeo8B,6DAAf,CAAnC;EACD;EAED;AACF;AACA;AACA;AACA;;;EACEtxB,SAAS,CAAC/H,cAAV,GAA2B,UAAS1gB,UAAT,EAAuD;IAAA,IAAlC2d,YAAkC,uEAAnBuD,eAAe,EAAI;IAChF,IAAM3E,WAAW,GAAGyE,cAAc,CAAChhB,UAAD,CAAlC;IACA,OAAO2d,YAAY,CAChBxX,MADI,CACG,UAAA/D,GAAG;MAAA,OAAIgL,sDAAQ,CAACmP,WAAD,EAAcna,GAAG,CAACpC,UAAlB,CAAZ;IAAA,CADN,EAEJmG,MAFI,CAEG,UAAA/D,GAAG;MAAA,OAAKoR,mEAAA,CAAmBpR,GAAG,CAAC2B,UAAvB,EAAmC,kBAAnC,MAA2D,IAA5D,GAAoE3B,GAAG,CAAC0Q,GAAJ,IAAW,CAA/E,GAAmF1Q,GAAG,CAAC0Q,GAAJ,GAAU,CAAjG;IAAA,CAFN,EAGJ/K,GAHI,CAGA,UAAA3F,GAAG;MAAA,OAAIA,GAAG,CAACpC,UAAR;IAAA,CAHH,EAIJmG,MAJI,CAIGyN,8CAJH,EAKJ7L,GALI,CAKA,UAAA/H,UAAU;MAAA,OAAI2d,YAAY,CAC5BxX,MADgB,CACT,UAAA/D,GAAG;QAAA,OAAIA,GAAG,CAACpC,UAAJ,KAAmBA,UAAnB,GAAgCoC,GAAhC,GAAsC,IAA1C;MAAA,CADM,EAEhB4D,MAFgB,CAETwgC,oDAFS,CAAJ;IAAA,CALV,CAAP;EAQD,CAVD;EAYA;AACF;AACA;AACA;;;EACE/d,SAAS,CAAC8e,kBAAV,GAA+B,UAAShrB,WAAT,EAAsB;IACnD,IAAIy9B,YAAY,GAAGvxB,SAAS,CAAC0vB,eAAV,CAA0B57B,WAA1B,CAAnB;;IAEA,IAAI;MACFkM,SAAS,CAACmuB,uBAAV,CAAkCr6B,WAAlC;IACD,CAFD,CAEE,OAAO9O,CAAP,EAAU;MACVnN,mDAAQ,CAAC,sCAAsCmN,CAAvC,CAAR;IACD;;IAEDrH,MAAM,CAAC0J,IAAP,CAAYkqC,YAAZ,EAA0BlyC,OAA1B,CAAkC,UAAA2oC,QAAQ;MAAA,OACxCrqC,MAAM,CAAC0J,IAAP,CAAYkqC,YAAY,CAACvJ,QAAD,CAAxB,EAAoC3oC,OAApC,CAA4C,UAAAoP,GAAG,EAAI;QACjDrV,qDAAU,qDAA8C4uC,QAA9C,mBAA+Dv5B,GAA/D,qBAA6E8iC,YAAY,CAACvJ,QAAD,CAAZ,CAAuBv5B,GAAvB,CAA7E,EAAV,CADiD,CAEjD;;QACA,IAAIyY,gDAAK,CAACqqB,YAAY,CAACvJ,QAAD,CAAZ,CAAuBv5B,GAAvB,CAAD,CAAL,IAAsCzR,kDAAO,CAACu0C,YAAY,CAACvJ,QAAD,CAAZ,CAAuBv5B,GAAvB,CAAD,CAAjD,EAAgF;UAC9E,IAAI+iC,WAAW,GAAG,EAAlB;UACA,IAAIC,KAAK,GAAG,SAAZ;;UACA,IAAIhjC,GAAG,CAAC+D,MAAJ,CAAWi/B,KAAX,IAAoB,CAAxB,EAA2B;YACzBD,WAAW,CAAC/iC,GAAG,CAAC4U,WAAJ,EAAD,CAAX,GAAiCkuB,YAAY,CAACvJ,QAAD,CAAZ,CAAuBv5B,GAAvB,CAAjC;UACD,CAFD,MAEO;YACL;YACA+iC,WAAW,CAAC/iC,GAAD,CAAX,GAAmB8iC,YAAY,CAACvJ,QAAD,CAAZ,CAAuBv5B,GAAvB,CAAnB;UACD;;UACDuD,MAAM,CAAC81B,MAAP,CAAc4J,WAAd,CAA0B1J,QAA1B,EAAoCwJ,WAApC,EAAiD;YAAEG,gBAAgB,EAAE;UAApB,CAAjD;QACD;MACF,CAdD,CADwC;IAAA,CAA1C;EAiBD,CA1BD;EA4BA;AACF;AACA;AACA;AACA;;;EACE,SAAShC,sBAAT,CAAgC77B,WAAhC,EAA6CoB,YAA7C,EAA2D;IACzD,IAAI08B,OAAO,GAAG5xB,SAAS,CAAC/H,cAAV,CAAyBnE,WAAzB,EAAsCoB,YAAtC,CAAd;IACA,IAAIw5B,YAAY,GAAGmD,eAAe,EAAlC;IAEAD,OAAO,GAAGA,OAAO,CAACtyC,GAAR,CAAY,UAAAwyC,MAAM,EAAI;MAC9B,OAAO,sFACJA,MAAM,CAACv6C,UADV,EACuBoG,MAAM,CAAC0J,IAAP,CAAYyqC,MAAM,CAACj0B,iBAAnB,EAClBngB,MADkB,CACX,UAAA+Q,GAAG;QAAA,OACT,OAAOqjC,MAAM,CAAChyB,qBAAd,KAAwC,WAAxC,IACAgyB,MAAM,CAAChyB,qBADP,IAEA4uB,YAAY,CAAC7lB,OAAb,CAAqBpa,GAArB,MAA8B,CAAC,CAHtB;MAAA,CADQ,EAKlBlR,MALkB,CAKX,UAACw0C,GAAD,EAAMtjC,GAAN,EAAc;QACpB,IAAMujC,cAAc,GAAG,CAACF,MAAM,CAACj0B,iBAAP,CAAyBpP,GAAzB,CAAD,CAAvB;;QACA,IAAMuR,SAAS,GAAG,sFAAGvR,GAAG,CAACm1B,SAAJ,CAAc,CAAd,EAAiByI,iBAAjB,CAAN,EAA4C2F,cAA5C,CAAf;;QACA,IAAIvjC,GAAG,KAAK/T,gEAAZ,EAA2C;UACzC,IAAMu3C,sBAAsB,GAAG,UAAGxjC,GAAH,cAAUqjC,MAAM,CAACx2C,UAAjB,EAA8BsoC,SAA9B,CAAwC,CAAxC,EAA2CyI,iBAA3C,CAA/B;;UACA,IAAM6F,mBAAmB,GAAG,sFAAGD,sBAAN,EAA+BD,cAA/B,CAAzB;;UACA,sGAAWD,GAAX,IAAgB/xB,SAAhB,EAA2BkyB,mBAA3B;QACD;;QACD,sGAAWH,GAAX,IAAgB/xB,SAAhB;MACD,CAdkB,EAchB,EAdgB,CADvB;IAiBD,CAlBS,CAAV;IAoBA,OAAO4xB,OAAP;EACD;;EAED,SAASC,eAAT,GAA2B;IACzB,OAAOxiC,cAAc,CAACyS,kCAAf,GAAoD;IAApD,CACJxiB,GADI,CACA,UAAA0gB,SAAS;MAAA,OAAIA,SAAS,CAACvR,GAAd;IAAA,CADT,EAEJuG,MAFI,CAEG0J,cAFH,EAEmBhhB,MAFnB,CAE0ByN,8CAF1B,CAAP,CADyB,CAGkB;EAC5C;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAASgnC,sBAAT,CAAgCJ,GAAhC,EAAqCp4C,GAArC,EAA0CmK,KAA1C,EAAiDq2B,GAAjD,EAAsD;IACpD,SAASiY,oBAAT,CAA8B3jC,GAA9B,EAAmC;MACjC,OAAO,UAAS4jC,iBAAT,EAA4B;QACjC,IAAI,CAACr1C,kDAAO,CAACq1C,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,CAAD,CAAZ,EAAwD;UACtD4jC,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,IAA2C,CAAC4jC,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,CAAD,CAA3C;QACD;;QACD4jC,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,IAA2C4jC,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,EAAyCuG,MAAzC,CAAgDrb,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAhD,EAA4E/Q,MAA5E,CAAmFyN,8CAAnF,CAA3C;QACA,OAAOxR,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAP;MACD,CAND;IAOD;;IAED,SAAS6jC,uBAAT,CAAiC7jC,GAAjC,EAAsC;MACpC,OAAO,UAAS4jC,iBAAT,EAA4B;QACjC,OAAOA,iBAAiB,CAAC96C,UAAlB,KAAiCoC,GAAG,CAACpC,UAArC,IAAmD86C,iBAAiB,CAACx0B,iBAAlB,CAAoCpP,GAApC,CAA1D;MACD,CAFD;IAGD;;IAED9Q,MAAM,CAAC0J,IAAP,CAAY1N,GAAG,CAACkkB,iBAAhB,EACGngB,MADH,CACU60C,aAAa,EADvB,EAEGlzC,OAFH,CAEW,UAAAoP,GAAG,EAAI;MACd,IAAIsjC,GAAG,CAAC14C,MAAR,EAAgB;QACd04C,GAAG,CAACr0C,MAAJ,CAAW40C,uBAAuB,CAAC7jC,GAAD,CAAlC,EACGpP,OADH,CACW+yC,oBAAoB,CAAC3jC,GAAD,CAD/B;MAED;IACF,CAPH;IAQAsjC,GAAG,CAACp6C,IAAJ,CAASgC,GAAT;IACA,OAAOo4C,GAAP;EACD;;EAED,SAASQ,aAAT,GAAyB;IACvB,IAAI7D,YAAY,GAAGmD,eAAe,EAAlC;;IACA,IAAI,MAAiB;MACnBnD,YAAY,GAAGA,YAAY,CAAC15B,MAAb,CAAoB8b,6DAApB,CAAf;IACD;;IACD,OAAO,UAASriB,GAAT,EAAc;MACnB,OAAOigC,YAAY,CAAC7lB,OAAb,CAAqBpa,GAArB,MAA8B,CAAC,CAAtC;IACD,CAFD;EAGD;;EAED,SAAS+jC,kBAAT,CAA4B74C,GAA5B,EAAiC;IAC/B,OAAO,sFACJA,GAAG,CAACpC,UADP,EACoBoG,MAAM,CAAC0J,IAAP,CAAY1N,GAAG,CAACkkB,iBAAhB,EAChB;IACA;IAFgB,CAGfngB,MAHe,CAGR60C,aAAa,EAHL,EAIfjzC,GAJe,CAIX,UAAAmP,GAAG,EAAI;MACV,OAAO,sFACJA,GAAG,CAACm1B,SAAJ,CAAc,CAAd,EAAiByI,iBAAjB,CADH,EACyC,CAAC1yC,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAD,CADzC;IAGD,CARe,CADpB;EAWD;EAED;AACF;AACA;AACA;AACA;;;EACE,SAASmhC,qBAAT,CAA+B97B,WAA/B,EAA4CoB,YAA5C,EAA0D;IACxD,OAAOA,YAAY,CAChBxX,MADI,CACG,UAAA/D,GAAG;MAAA,OAAIgL,sDAAQ,CAACmP,WAAD,EAAcna,GAAG,CAACpC,UAAlB,CAAZ;IAAA,CADN,EAEJ+H,GAFI,CAEA,UAAA3F,GAAG;MAAA,OAAIgE,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBjE,GAAlB,CAAJ;IAAA,CAFH,EAGJ4D,MAHI,CAGG40C,sBAHH,EAG2B,EAH3B,EAIJ7yC,GAJI,CAIAkzC,kBAJA,EAKJ90C,MALI,CAKG,UAAA/D,GAAG;MAAA,OAAIA,GAAJ;IAAA,CALN,CAAP,CADwD,CAMjC;EACxB;EAED;AACF;AACA;AACA;AACA;;;EACE,SAASk2C,wBAAT,CAAkC/7B,WAAlC,EAA+CoB,YAA/C,EAA6D;IAC3D,IAAMw5B,YAAY,GAAG,QAAkBhwB,cAAc,CAAC1J,MAAf,CAAsB8b,6DAAtB,CAAlB,GAAiEpS,CAAtF;IACA,IAAMquB,cAAc,GAAG51C,wDAAA,CAAiB,0BAAjB,CAAvB;IACA,IAAMsG,IAAI,GAAGovC,4BAA4B,CAAC33B,YAAD,EAAe6oB,oDAAf,EAA8BgP,cAA9B,CAAzC;IACA,IAAM0F,6BAA6B,GAAGt7C,wDAAA,CAAiB,iDAAjB,CAAtC;IAEA,IAAMu7C,0BAA0B,GAAGD,6BAA6B,GAC5DA,6BAA6B,CAACnzC,GAA9B,CAAkC,UAACmP,GAAD;MAAA,OAAS/T,2DAAA,CAAyB+T,GAAzB,CAAT;IAAA,CAAlC,CAD4D,GAE5DigC,YAFJ,CAN2D,CAU3D;;IACA,OAAOjxC,IAAI,CAAC6B,GAAL,CAAS,UAAA3F,GAAG,EAAI;MACrB,IAAI60C,2BAA2B,CAAC70C,GAAD,EAAMma,WAAN,CAA/B,EAAmD;QACjD,OAAO,sFACJna,GAAG,CAACpC,UADP,EACoBo3C,eAAe,CAACh1C,GAAD,EAAM+0C,YAAY,CAAChxC,MAAb,CACrC,UAAA+Q,GAAG;UAAA,OAAI,OAAO9U,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAP,KAAsC,WAAtC,IACPikC,0BAA0B,CAAC7pB,OAA3B,CAAmCpa,GAAnC,MAA4C,CAAC,CAD1C;QAAA,CADkC,CAAN,CADnC;MAMD;IACF,CATM,EASJ/Q,MATI,CASG,UAAA/D,GAAG;MAAA,OAAIA,GAAJ;IAAA,CATN,CAAP,CAX2D,CAoBpC;EACxB;;EAED,SAASg1C,eAAT,CAAyBh1C,GAAzB,EAA8B0N,IAA9B,EAAoC;IAClC,OAAOA,IAAI,CAAC/H,GAAL,CAAS,UAAAmP,GAAG,EAAI;MACrB,OAAO,sFACJ,UAAGA,GAAH,cAAU9U,GAAG,CAAC2B,UAAd,EAA2BsoC,SAA3B,CAAqC,CAArC,EAAwCyI,iBAAxC,CADH,EACgE,CAAC1yC,GAAG,CAACkkB,iBAAJ,CAAsBpP,GAAtB,CAAD,CADhE;IAGD,CAJM,CAAP;EAKD;;EAED,SAASqhC,kBAAT,CAA4Bh8B,WAA5B,EAAyC;IACvC,SAAS6+B,eAAT,CAAyB14C,MAAzB,EAAiC;MAC/B,OAAOI,qDAAU,CAACJ,MAAD,EAASS,4EAAT,CAAjB;IACD;;IAED,SAASk4C,kBAAT,CAA4B34C,MAA5B,EAAoC;MAClC,IAAM44C,GAAG,GAAGF,eAAe,CAAC14C,MAAD,CAA3B;MAEA,OAAO0D,MAAM,CAAC0J,IAAP,CAAYwrC,GAAZ,EACJvzC,GADI,CACA,UAASmP,GAAT,EAAc;QACjB,IAAIyY,gDAAK,CAAC2rB,GAAG,CAACpkC,GAAD,CAAJ,CAAT,EAAqBokC,GAAG,CAACpkC,GAAD,CAAH,GAAWokC,GAAG,CAACpkC,GAAD,CAAH,CAASqB,KAAT,CAAe,GAAf,EAAoBxQ,GAApB,CAAwB,UAAAwzC,CAAC;UAAA,OAAIA,CAAC,CAAC7nC,IAAF,EAAJ;QAAA,CAAzB,CAAX;QACrB,IAAI,CAACjO,kDAAO,CAAC61C,GAAG,CAACpkC,GAAD,CAAJ,CAAZ,EAAwBokC,GAAG,CAACpkC,GAAD,CAAH,GAAW,CAAEokC,GAAG,CAACpkC,GAAD,CAAL,CAAX;QACxB,OAAO,sFAAGA,GAAV,EAAgBokC,GAAG,CAACpkC,GAAD,CAAnB;MACD,CALI,CAAP;IAMD;;IAED,OAAOY,cAAc,CAACiJ,UAAf,GACJ5a,MADI,CACG,UAAAzD,MAAM;MAAA,OAAI0K,sDAAQ,CAACmP,WAAD,EAAc7Z,MAAM,CAACE,IAArB,CAAR,IAAsCw4C,eAAe,CAAC14C,MAAD,CAAzD;IAAA,CADT,EAEJqF,GAFI,CAEA,UAAArF,MAAM,EAAI;MACb,OAAO,sFAAEA,MAAM,CAACE,IAAhB,EAAuBy4C,kBAAkB,CAAC34C,MAAD,CAAzC;IACD,CAJI,CAAP;EAKD;;EAED+lB,SAAS,CAAC+yB,eAAV,GAA4B,YAAW;IACrC,IAAI/gC,MAAM,CAAC81B,MAAP,IAAiB3nB,+CAAI,CAACnO,MAAM,CAAC81B,MAAP,CAAc4J,WAAf,CAAzB,EAAsD;MACpD,OAAO,IAAP;IACD;EACF,CAJD;;EAMA,OAAO1xB,SAAP;AACD;AAEM,IAAMA,SAAS,GAAG0tB,YAAY,CAACr+B,+DAAD,CAA9B;;;;;;;;;;;;;;;;;;;;;AClrBP;AAIA;AACA;AACA;AAEO,IAAM2jC,uBAAuB,GAAG;EACrCC,WAAW,EAAE,IADwB;EAErCC,cAAc,EAAE;IACdplC,KAAK,EAAE;MACLvS,OAAO,EAAE,GADJ;MAELmC,MAAM,EAAE;IAFH;EADO,CAFqB;EAQrCy1C,cAAc,EAAE,CARqB;EASrCx8B,SAAS,EAAE,IAT0B;EAUrCy8B,YAAY,EAAE;AAVuB,CAAhC,EAaP;;AACAj8C,0DAAA,CAAmB;EACjB,YAAYiI,oDAAS,CAAC4zC,uBAAD;AADJ,CAAnB;AAIA,IAAMtrC,OAAO,GAAGC,yEAAqB,CAAC,UAAD,CAArC;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS0rC,WAAT,CAAqBC,oBAArB,EAA2C;EAChD,IAAIC,SAAS,GAAG,EAAhB,CADgD,CAEhD;EACA;;EACA,IAAI3R,KAAK,GAAG4R,eAAe,EAA3B,CAJgD,CAMhD;;EACA,IAAIC,cAAc,GAAG,IAAItzC,GAAJ,EAArB,CAPgD,CAQhD;;EACA,IAAIuzC,cAAc,GAAG,EAArB,CATgD,CAWhD;;EACA,IAAIC,eAAe,GAAG;IACpB7lC,KAAK,EAAE,IADa;IAEpBH,MAAM,EAAE;EAFY,CAAtB,CAZgD,CAiBhD;;EACA,IAAIimC,QAAQ,GAAGN,oBAAoB,CAACn8C,MAApC,CAlBgD,CAmBhD;;EACAA,wDAAA,CAAiB,UAAjB,EAA6B,UAACswB,IAAD,EAAU;IACrC;IACA;IACA,IAAIA,IAAI,CAACzZ,QAAT,EAAmB;MACjB,IAAI6lC,EAAE,GAAGpsB,IAAI,CAACzZ,QAAL,CAAcklC,cAAvB;;MACA,IAAI/qC,wDAAa,CAAC0rC,EAAD,CAAjB,EAAuB;QACrB,IAAI,CAACA,EAAE,CAAC/lC,KAAJ,IAAa,CAAC+lC,EAAE,CAACjmC,GAArB,EAA0B;UACxB6Z,IAAI,CAACzZ,QAAL,CAAcklC,cAAd,CAA6BplC,KAA7B,GAAqC;YACnCvS,OAAO,EAAE,GAD0B;YAEnCmC,MAAM,EAAE;UAF2B,CAArC;QAID;MACF;IACF;;IAEDk2C,QAAQ,GAAGj2C,MAAM,CAACC,MAAP,CAAcg2C,QAAd,EAAwBnsB,IAAI,CAACzZ,QAA7B,CAAX;EACD,CAhBD;EAkBA;AACF;AACA;AACA;AACA;AACA;;EACE,SAASwlC,eAAT,GAA2B;IACzB,OAAO;MACL1lC,KAAK,EAAE,EADF;MAELH,MAAM,EAAE;IAFH,CAAP;EAID;EAED;AACF;AACA;AACA;AACA;;;EACE,SAASmmC,SAAT,GAAqB;IACnB,IAAI,CAACF,QAAQ,CAACX,WAAV,IAAyB,CAACK,oBAAoB,CAACS,sBAAnD,EAA2E;MACzE;IACD;;IAED,IAAI;MACF;MACAC,WAAW,GAFT,CAGF;;MACAC,eAAe;IAChB,CALD,CAKE,OAAOjvC,CAAP,EAAU;MACV,OAAOnN,mDAAQ,CAAC,yBAAD,EAA4BmN,CAA5B,CAAf;IACD,CAZkB,CAanB;;;IACA48B,KAAK,GAAG4R,eAAe,EAAvB;EACD;;EAED,SAASU,WAAT,CAAqBtS,KAArB,EAA4B5oC,EAA5B,EAAgC;IAC9B;IACA;IACA;IACAsI,kDAAO,CAACsgC,KAAD,CAAP,CAAeviC,OAAf,CAAuB,UAAC0O,IAAD,EAAU;MAC/B/U,EAAE,CAAC+U,IAAD,CAAF;MACA0lC,cAAc,CAAClzC,GAAf,CAAmBwN,IAAI,CAAC,CAAD,CAAvB;IACD,CAHD;EAID;EAED;AACF;AACA;AACA;AACA;;;EACE,SAASkmC,eAAT,GAA2B;IACzB,IAAI,CAACN,eAAe,CAAC7lC,KAArB,EAA4B;MAC1B;IACD;;IACDomC,WAAW,CAACtS,KAAK,CAAC9zB,KAAP,EAAc,UAACC,IAAD,EAAU;MACjC,6FAAqCA,IAArC;MAAA,IAAKomC,UAAL;MAAA,IAAiBC,gBAAjB;;MACAh7C,qDAAU,sDAA+C+6C,UAA/C,EAAV,CAFiC,CAGjC;;MACA/e,uDAAY,CAACgf,gBAAD,CAAZ;IACD,CALU,CAAX;EAMD;EAED;AACF;AACA;AACA;AACA;;;EACE,SAASJ,WAAT,GAAuB;IACrB,IAAI,CAAEL,eAAe,CAAChmC,MAAtB,EAA+B;MAC7B;IACD;;IAEDumC,WAAW,CAACtS,KAAK,CAACj0B,MAAP,EAAe,UAACI,IAAD,EAAU;MAClC,8FAA8BA,IAA9B;MAAA,IAAKomC,UAAL;MAAA,IAAiBE,SAAjB;;MACAj7C,qDAAU,iDAA0C+6C,UAA1C,EAAV,CAFkC,CAGlC;;MACAG,+DAAoB,CAACD,SAAD,CAApB,CAJkC,CAKlC;;MACAE,0BAA0B,CAAC3S,KAAD,EAAQuS,UAAR,CAA1B;IACD,CAPU,CAAX;EAQD;;EAED,SAASI,0BAAT,CAAoC3S,KAApC,EAA2C4S,oBAA3C,EAAiE;IAC/D5S,KAAK,CAAC9zB,KAAN,GAAc8zB,KAAK,CAAC9zB,KAAN,CAAYpQ,MAAZ,CAAmB,UAAA+2C,SAAS,EAAI;MAC5C,IAAIC,mBAAmB,GAAGD,SAAS,CAAC,CAAD,CAAnC;MACA,OAAOC,mBAAmB,KAAKF,oBAA/B;IACD,CAHa,CAAd;EAID;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAASG,oBAAT,CAA8BjB,cAA9B,EAA8C33C,MAA9C,EAAsD;IACpD,IAAI,CAAC23C,cAAc,CAAC33C,MAAD,CAAnB,EAA6B;MAC3B23C,cAAc,CAAC33C,MAAD,CAAd,GAAyB,CAAzB;IACD,CAFD,MAEO;MACL23C,cAAc,CAAC33C,MAAD,CAAd,IAA0B,CAA1B;IACD;;IACD,OAAO23C,cAAP;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EAEEH,SAAS,CAACqB,YAAV,GAAyB,UAACxnC,IAAD,EAAOrR,MAAP,EAAe7E,GAAf,EAAuB;IAC9C,IAAIu8C,cAAc,CAACz0C,GAAf,CAAmBjD,MAAnB,CAAJ,EAAgC;MAC9B,OAAO3C,qDAAU,qCAA6B2C,MAA7B,oCAAjB;IACD;;IACD,IAAI,CAAC63C,QAAQ,CAACX,WAAV,IAAyB,CAACj2C,kDAAO,CAAC4kC,KAAK,CAACx0B,IAAD,CAAN,CAArC,EAAoD;MAClD,OAAO9U,kDAAO,4BAAoB8U,IAApB,sBAAd;IACD;;IACD,IAAI,CAACrR,MAAL,EAAa;MACX,OAAOzD,kDAAO,2CAAd;IACD;;IACD,IAAIs7C,QAAQ,CAACT,cAAT,KAA4B,CAA5B,IAAiC1vC,MAAM,CAACiwC,cAAc,CAAC33C,MAAD,CAAf,CAAN,IAAkC63C,QAAQ,CAACT,cAAhF,EAAgG;MAC9F,OAAO76C,kDAAO,+CAAuCyD,MAAvC,QAAd;IACD;;IAED,IAAM84C,qBAAqB,GAAGtB,SAAS,CAACsB,qBAAV,CAAgCznC,IAAhC,EAAsCrR,MAAtC,CAA9B;;IACA,IAAI,CAAC84C,qBAAL,EAA4B;MAC1B,OAAOv8C,kDAAO,oBAAYyD,MAAZ,kDAAwDqR,IAAxD,yBAAd;IACD,CAjB6C,CAmB9C;;;IACAw0B,KAAK,CAACx0B,IAAD,CAAL,CAAYzV,IAAZ,CAAiB,CAACoE,MAAD,EAAS7E,GAAT,CAAjB;IACAw8C,cAAc,GAAGiB,oBAAoB,CAACjB,cAAD,EAAiB33C,MAAjB,CAArC;EACD,CAtBD;EAwBA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAAS+4C,qBAAT,CAA+B1nC,IAA/B,EAAqCrR,MAArC,EAA6C;IAC3C,IAAIyR,YAAY,GAAGomC,QAAQ,CAACV,cAA5B,CAD2C,CAG3C;;IACA,IAAI6B,mBAAmB,CAACvnC,YAAD,EAAeJ,IAAf,CAAvB,EAA6C;MAC3CumC,eAAe,CAACvmC,IAAD,CAAf,GAAwB,IAAxB;MAEA,IAAI4nC,YAAY,GAAIxnC,YAAY,CAACI,GAAd,GAAqBJ,YAAY,CAACI,GAAlC,GAAwCJ,YAAY,CAACJ,IAAD,CAAvE;MACA,IAAI6nC,eAAe,GAAID,YAAY,CAACz5C,OAAb,KAAyB,GAA1B,GAAiC,CAACQ,MAAD,CAAjC,GAA4Ci5C,YAAY,CAACz5C,OAA/E;MACA,IAAI25C,UAAU,GAAGF,YAAY,CAACt3C,MAAb,IAAuB,SAAxC,CAL2C,CAKQ;MAEnD;;MACA,IAAMy3C,iBAAiB,GAAG;QACxB,WAAW,iBAAC55C,OAAD,EAAUQ,MAAV;UAAA,OAAqB,CAAC4I,sDAAQ,CAACpJ,OAAD,EAAUQ,MAAV,CAA9B;QAAA,CADa;QAExB,WAAW,iBAACR,OAAD,EAAUQ,MAAV;UAAA,OAAqB4I,sDAAQ,CAACpJ,OAAD,EAAUQ,MAAV,CAA7B;QAAA;MAFa,CAA1B;MAIA,OAAOo5C,iBAAiB,CAACD,UAAD,CAAjB,CAA8BD,eAA9B,EAA+Cl5C,MAA/C,CAAP;IACD;;IACD,OAAO,CAAC43C,eAAe,CAACvmC,IAAD,CAAvB;EACD;EAED;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;EACE,SAAS2nC,mBAAT,CAA6BvnC,YAA7B,EAA2CJ,IAA3C,EAAiD;IAC/C,IAAII,YAAY,CAACI,GAAb,IAAoBJ,YAAY,CAACJ,IAAD,CAApC,EAA4C;MAC1C9U,kDAAO,gFAAsE8U,IAAtE,gHAAP;MACA,OAAO,KAAP;IACD;;IAED,IAAI4nC,YAAY,GAAIxnC,YAAY,CAACI,GAAd,GAAqBJ,YAAY,CAACI,GAAlC,GAAwCJ,YAAY,CAACJ,IAAD,CAAvE;IACA,IAAIgoC,gBAAgB,GAAI5nC,YAAY,CAACI,GAAd,GAAqB,KAArB,GAA6BR,IAApD,CAP+C,CAS/C;IACA;;IACA,IAAI,CAAC4nC,YAAL,EAAmB;MACjB,OAAO,KAAP;IACD;;IAED,IAAIK,WAAW,GAAGL,YAAY,CAACt3C,MAA/B;IACA,IAAI43C,YAAY,GAAGN,YAAY,CAACz5C,OAAhC;;IAEA,IAAI85C,WAAW,IAAIA,WAAW,KAAK,SAA/B,IAA4CA,WAAW,KAAK,SAAhE,EAA2E;MACzE/8C,kDAAO,qCAA6B88C,gBAA7B,gCAAkEC,WAAlE,iEAAP;MACA,OAAO,KAAP;IACD;;IAED,IAAIC,YAAY,KAAK,GAAjB,IAAwB,EAAEvtC,KAAK,CAAC/K,OAAN,CAAcs4C,YAAd,KAA+BA,YAAY,CAACj8C,MAAb,GAAsB,CAArD,IAA0Di8C,YAAY,CAACrlC,KAAb,CAAmB,UAAAslC,YAAY;MAAA,OAAIruB,gDAAK,CAACquB,YAAD,CAAL,IAAuBA,YAAY,KAAK,GAA5C;IAAA,CAA/B,CAA5D,CAA5B,EAA0K;MACxKj9C,kDAAO,kEAA0D88C,gBAA1D,mFAAP;MACA,OAAO,KAAP;IACD;;IAED,OAAO,IAAP;EACD;EAED;AACF;AACA;AACA;AACA;AACA;;;EACE7B,SAAS,CAACtgC,SAAV,GAAsB,YAAiB;IAAA,IAAhB3Q,OAAgB,uEAAN,CAAM;;IACrC,IAAIA,OAAJ,EAAa;MACX,OAAOyT,UAAU,CAAC+9B,SAAD,EAAYrwC,MAAM,CAACnB,OAAD,CAAlB,CAAjB;IACD;;IACDwxC,SAAS;EACV,CALD;EAOA;AACF;AACA;AACA;AACA;;;EACEP,SAAS,CAAChZ,gBAAV,GAA6B,YAAM;IACjC,IAAIqZ,QAAQ,CAACl9B,cAAb,EAA6B;MAC3B68B,SAAS,CAACtgC,SAAV;IACD;EACF,CAJD;;EAMAsgC,SAAS,CAACsB,qBAAV,GAAkC,UAACznC,IAAD,EAAOrR,MAAP,EAAkB;IAClD,IAAI63C,QAAQ,CAACV,cAAb,EAA6B;MAC3B,IAAI4B,qBAAqB,CAAC1nC,IAAD,EAAOrR,MAAP,CAAzB,EAAyC;QACvC,OAAO,KAAP;MACD;IACF;;IACD,OAAO,IAAP;EACD,CAPD;;EAQA,OAAOw3C,SAAP;AACD;AAEM,IAAMvlC,QAAQ,GAAGqlC,WAAW,CAAC11C,MAAM,CAAC8yB,gBAAP,CAAwB;EAC1Dt5B,MAAM,EAAEA,wDAAA,CAAiB,UAAjB;AADkD,CAAxB,EAEjC;EACD48C,sBAAsB,EAAE;IACtBlnC,GAAG,EAAE,eAAW;MACd;MACA,OAAO,CAAC2oC,0DAAe,EAAhB,IAAsB9tC,OAAO,CAAC6jC,iBAAR,EAA7B;IACD;EAJqB;AADvB,CAFiC,CAAD,CAA5B;AAWP;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvVA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAIkK,IAAI,GAAG,OAAX;AACA,IAAIC,IAAI,GAAG,QAAX;AACA,IAAIC,GAAG,GAAG,UAAV;AACA,IAAIC,KAAK,GAAG,QAAZ;AACA,IAAIC,OAAO,GAAG,QAAd;AACA,IAAIC,QAAQ,GAAG,SAAf;AACA,IAAIC,QAAQ,GAAGp4C,MAAM,CAAC9E,SAAP,CAAiBk9C,QAAhC;AACA,IAAIC,aAAa,GAAGrd,OAAO,CAAC3mB,MAAM,CAACikC,OAAR,CAA3B;AACA,IAAIC,gBAAgB,GAAGvd,OAAO,CAACqd,aAAa,IAAIhkC,MAAM,CAACikC,OAAP,CAAeE,GAAjC,CAA9B;AACA,IAAIC,iBAAiB,GAAGzd,OAAO,CAACqd,aAAa,IAAIhkC,MAAM,CAACikC,OAAP,CAAe1nC,IAAjC,CAA/B;AACA,IAAI8nC,iBAAiB,GAAG1d,OAAO,CAACqd,aAAa,IAAIhkC,MAAM,CAACikC,OAAP,CAAeK,IAAjC,CAA/B;AACA,IAAIC,kBAAkB,GAAG5d,OAAO,CAACqd,aAAa,IAAIhkC,MAAM,CAACikC,OAAP,CAAe18C,KAAjC,CAAhC;AAEA,IAAIi9C,YAAJ;AAEO,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;EACvC;EACAF,YAAY,GAAGE,MAAf;AACD;;AAED,SAASC,SAAT,GAA4B;EAC1B,IAAIH,YAAY,IAAI,IAApB,EAA0B;IACxBA,YAAY,MAAZ;EACD;AACF,EAED;;;AACO,IAAMI,QAAQ,GAAG;EACtBpL,kBAAkB,EAAlBA,kBADsB;EAEtBqL,0BAA0B,EAA1BA,0BAFsB;EAGtBC,aAAa,EAAbA,aAHsB;EAItBvN,YAAY,EAAZA,YAJsB;EAKtBwN,iBAAiB,EAAjBA,iBALsB;EAMtBzC,oBAAoB,EAApBA,oBANsB;EAOtB3iC,aAAa,EAAbA,aAPsB;EAQtBwO,IAAI,EAAJA,IARsB;EAStBiV,YAAY,EAAZA,YATsB;EAUtBv9B,QAAQ,EAARA,QAVsB;EAWtBS,OAAO,EAAPA,OAXsB;EAYtBc,UAAU,EAAVA,UAZsB;EAatB0N,OAAO,EAAPA,OAbsB;EActBkwC,OAAO,EAAPA,OAdsB;EAetBC,QAAQ,EAARA,QAfsB;EAgBtBC,SAAS,EAATA;AAhBsB,CAAjB;AAmBP,IAAIC,cAAc,GAAG,EAArB;AACA;AACA;AACA;;AACO,SAASC,iBAAT,GAA6B;EAClC,OAAOD,cAAP;AACD;AAED,IAAIE,SAAS,GAAG,EAAhB;AACO,IAAI1+C,IAAI,GAAG,UAASooB,CAAT,EAAYsd,CAAZ,EAAe;EAAE,OAAOA,CAAP;AAAW,CAA5B,CAA6B1lC,IAA7B,CAAkC,IAAlC,EAAwC,CAAxC,EAA2C0+C,SAA3C,QAA4DA,SAA5D,GACdC,QAAQ,CAACz+C,SAAT,CAAmBF,IADL,GAEd,UAASA,IAAT,EAAe;EACf,IAAI4+C,IAAI,GAAG,IAAX;EACA,IAAI/tB,IAAI,GAAGzhB,KAAK,CAAClP,SAAN,CAAgBwmB,KAAhB,CAAsBvnB,IAAtB,CAA2BI,SAA3B,EAAsC,CAAtC,CAAX;EACA,OAAO,YAAW;IAChB,OAAOq/C,IAAI,CAACl/C,KAAL,CAAWM,IAAX,EAAiB6wB,IAAI,CAACxU,MAAL,CAAYjN,KAAK,CAAClP,SAAN,CAAgBwmB,KAAhB,CAAsBvnB,IAAtB,CAA2BI,SAA3B,CAAZ,CAAjB,CAAP;EACD,CAFD;AAGD,CARI;AAUP;;AACA,IAAIs/C,qBAAqB,GAAI,YAAY;EACvC,IAAIC,KAAK,GAAG,CAAZ;EACA,OAAO,YAAY;IACjBA,KAAK;IACL,OAAOA,KAAP;EACD,CAHD;AAID,CAN2B,EAA5B,EAQA;;;AACO,SAASr5C,sBAAT,GAAkC;EACvC,OAAOo5C,qBAAqB,KAAK9/B,IAAI,CAACggC,MAAL,GAAc3B,QAAd,CAAuB,EAAvB,EAA2B4B,MAA3B,CAAkC,CAAlC,CAAjC;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASv1C,YAAT,CAAsBm0B,WAAtB,EAAmC;EACxC,OAAOA,WAAW,GACd,CAACA,WAAW,GAAGqhB,cAAc,MAAMrhB,WAAW,GAAG,CAAjD,EAAoDwf,QAApD,CAA6D,EAA7D,CADc,GAEd,CAAC,CAAC,GAAD,IAAQ,CAAC,GAAT,GAAe,CAAC,GAAhB,GAAsB,CAAC,GAAvB,GAA6B,CAAC,IAA/B,EAAqC9J,OAArC,CAA6C,QAA7C,EAAuD7pC,YAAvD,CAFJ;AAGD;AAED;AACA;AACA;AACA;;AACA,SAASw1C,cAAT,GAA0B;EACxB,IAAI5lC,MAAM,IAAIA,MAAM,CAAC6lC,MAAjB,IAA2B7lC,MAAM,CAAC6lC,MAAP,CAAcC,eAA7C,EAA8D;IAC5D,OAAOD,MAAM,CAACC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,CAAf,CAAvB,EAA0C,CAA1C,IAA+C,EAAtD;EACD,CAFD,MAEO;IACL,OAAOrgC,IAAI,CAACggC,MAAL,KAAgB,EAAvB;EACD;AACF;;AAEM,SAASM,iBAAT,CAA2BvpC,GAA3B,EAAgCwpC,SAAhC,EAA2C;EAChD,IAAIA,SAAS,IAAIA,SAAS,CAACxpC,GAAD,CAA1B,EAAiC;IAC/B,OAAOwpC,SAAS,CAACxpC,GAAD,CAAhB;EACD;;EAED,OAAO,EAAP;AACD;AAEM,SAASypC,oBAAT,CAA8BC,WAA9B,EAA2C1pC,GAA3C,EAAgDmE,KAAhD,EAAuD;EAC5D,IAAIA,KAAJ,EAAW;IACT,OAAOulC,WAAW,GAAG1pC,GAAd,GAAoB,GAApB,GAA0Bm8B,kBAAkB,CAACh4B,KAAD,CAA5C,GAAsD,GAA7D;EACD;;EAED,OAAOulC,WAAP;AACD,EAED;AACA;AACA;;AACO,SAAS9qC,0BAAT,CAAoC+qC,QAApC,EAA8C;EACnD,IAAI56C,MAAM,GAAG,EAAb;;EACA,KAAK,IAAIoW,CAAT,IAAcwkC,QAAd,EAAwB;IACtB,IAAIA,QAAQ,CAACnlB,cAAT,CAAwBrf,CAAxB,CAAJ,EAAgC;MAAEpW,MAAM,IAAIoW,CAAC,GAAG,GAAJ,GAAUg3B,kBAAkB,CAACwN,QAAQ,CAACxkC,CAAD,CAAT,CAA5B,GAA4C,GAAtD;IAA4D;EAC/F;;EACDpW,MAAM,GAAGA,MAAM,CAACyuC,OAAP,CAAe,IAAf,EAAqB,EAArB,CAAT;EACA,OAAOzuC,MAAP;AACD,EAED;;AACO,SAASogC,6BAAT,CAAuC5d,SAAvC,EAAkD;EACvD;EACA,IAAIA,SAAS,IAAIriB,MAAM,CAAC06C,mBAAP,CAA2Br4B,SAA3B,EAAsC3mB,MAAtC,GAA+C,CAAhE,EAAmE;IACjE,OAAOi/C,OAAO,CAACt4B,SAAD,CAAP,CACJ1gB,GADI,CACA,UAAAmP,GAAG;MAAA,iBAAOA,GAAP,cAAcm8B,kBAAkB,CAACpsB,QAAQ,CAACwB,SAAD,EAAYvR,GAAZ,CAAT,CAAhC;IAAA,CADH,EACiE7J,IADjE,CACsE,GADtE,CAAP;EAED,CAHD,MAGO;IACL,OAAO,EAAP;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS2zC,cAAT,CAAwBt+C,MAAxB,EAAgC;EACrC,IAAI,CAACA,MAAL,EAAa;IACX;EACD;;EAED,IAAIgE,KAAK,GAAG,EAAZ;;EACA,IAAIhE,MAAM,CAAC6D,UAAP,IAAqB7D,MAAM,CAAC6D,UAAP,CAAkB6R,MAAvC,IAAiD5H,KAAK,CAAC/K,OAAN,CAAc/C,MAAM,CAAC6D,UAAP,CAAkB6R,MAAlB,CAAyB1R,KAAvC,CAArD,EAAoG;IAClG,IAAIk+B,WAAW,GAAGliC,MAAM,CAAC6D,UAAP,CAAkB6R,MAAlB,CAAyB1R,KAA3C;;IACA,IAAI8J,KAAK,CAAC/K,OAAN,CAAcm/B,WAAW,CAAC,CAAD,CAAzB,CAAJ,EAAmC;MACjCl+B,KAAK,GAAGk+B,WAAR;IACD,CAFD,MAEO;MACLl+B,KAAK,CAACtG,IAAN,CAAWwkC,WAAX;IACD,CANiG,CAOpG;;EACC,CARD,MAQO,IAAIp0B,KAAK,CAAC/K,OAAN,CAAc/C,MAAM,CAACgE,KAArB,CAAJ,EAAiC;IACtC,IAAI8J,KAAK,CAAC/K,OAAN,CAAc/C,MAAM,CAACgE,KAAP,CAAa,CAAb,CAAd,CAAJ,EAAoC;MAClCA,KAAK,GAAGhE,MAAM,CAACgE,KAAf;IACD,CAFD,MAEO;MACLA,KAAK,CAACtG,IAAN,CAAWsC,MAAM,CAACgE,KAAlB;IACD;EACF;;EACD,OAAOA,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS4R,eAAT,CAAyB2oC,OAAzB,EAAkC;EACvC,IAAI5oC,WAAW,GAAG,EAAlB,CADuC,CAGvC;;EACA,IAAI,OAAO4oC,OAAP,KAAmB,QAAvB,EAAiC;IAC/B;IACA,IAAIv6C,KAAK,GAAGu6C,OAAO,CAAC1oC,KAAR,CAAc,GAAd,CAAZ,CAF+B,CAI/B;IACA;;IACA,IAAI2oC,SAAS,GAAG,gBAAhB;;IACA,IAAIx6C,KAAJ,EAAW;MACT,KAAK,IAAIy6C,UAAT,IAAuBz6C,KAAvB,EAA8B;QAC5B,IAAI06C,MAAM,CAAC16C,KAAD,EAAQy6C,UAAR,CAAN,IAA6Bz6C,KAAK,CAACy6C,UAAD,CAAL,CAAkBlkB,KAAlB,CAAwBikB,SAAxB,CAAjC,EAAqE;UACnE7oC,WAAW,CAACjY,IAAZ,CAAiBsG,KAAK,CAACy6C,UAAD,CAAtB;QACD;MACF;IACF;EACF,CAdD,MAcO,IAAI,0EAAOF,OAAP,MAAmB,QAAvB,EAAiC;IACtC,IAAII,eAAe,GAAGJ,OAAO,CAACn/C,MAA9B,CADsC,CAGtC;;IACA,IAAIu/C,eAAe,GAAG,CAAtB,EAAyB;MACvB;MACA,IAAIA,eAAe,KAAK,CAApB,IAAyB,OAAOJ,OAAO,CAAC,CAAD,CAAd,KAAsB,QAA/C,IAA2D,OAAOA,OAAO,CAAC,CAAD,CAAd,KAAsB,QAArF,EAA+F;QAC7F5oC,WAAW,CAACjY,IAAZ,CAAiBkhD,uBAAuB,CAACL,OAAD,CAAxC;MACD,CAFD,MAEO;QACL;QACA,KAAK,IAAIz0C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG60C,eAApB,EAAqC70C,CAAC,EAAtC,EAA0C;UACxC6L,WAAW,CAACjY,IAAZ,CAAiBkhD,uBAAuB,CAACL,OAAO,CAACz0C,CAAD,CAAR,CAAxC;QACD;MACF;IACF;EACF;;EAED,OAAO6L,WAAP;AACD,EAED;AACA;;AACO,SAASipC,uBAAT,CAAiCC,UAAjC,EAA6C;EAClD,IAAIC,oBAAoB,CAACD,UAAD,CAAxB,EAAsC;IACpC,OAAOA,UAAU,CAAC,CAAD,CAAV,GAAgB,GAAhB,GAAsBA,UAAU,CAAC,CAAD,CAAvC;EACD;AACF,EAED;AACA;;AACO,SAASE,gCAAT,CAA0CF,UAA1C,EAAsD;EAC3D,IAAIC,oBAAoB,CAACD,UAAD,CAAxB,EAAsC;IACpC,OAAO;MAACzlB,CAAC,EAAEylB,UAAU,CAAC,CAAD,CAAd;MAAmBxlB,CAAC,EAAEwlB,UAAU,CAAC,CAAD;IAAhC,CAAP;EACD;AACF;;AAED,SAASC,oBAAT,CAA8BD,UAA9B,EAA0C;EACxC;EACA,OAAO97C,OAAO,CAAC87C,UAAD,CAAP,IAAuBA,UAAU,CAACz/C,MAAX,KAAsB,CAA7C,IAAmD,CAAC6xB,KAAK,CAAC4tB,UAAU,CAAC,CAAD,CAAX,CAAN,IAAyB,CAAC5tB,KAAK,CAAC4tB,UAAU,CAAC,CAAD,CAAX,CAAzF;AACD;;AAEM,SAASvP,YAAT,GAAwB;EAC7B,OAAOv3B,MAAM,CAACqxB,GAAd;AACD;AAEM,SAASyT,aAAT,GAAyB;EAC9B,OAAO9kC,MAAM,CAACulC,IAAd;AACD;AAEM,SAASR,iBAAT,GAA6B;EAClC,OAAO/kC,MAAM,CAACmxB,QAAd;AACD;AAED;AACA;AACA;;AACO,SAAS/pC,UAAT,GAAsB;EAC3B,IAAI6/C,aAAa,MAAM/C,gBAAvB,EAAyC;IACvC;IACAD,OAAO,CAACE,GAAR,CAAY99C,KAAZ,CAAkB49C,OAAlB,EAA2BiD,WAAW,CAAChhD,SAAD,EAAY,UAAZ,CAAtC;EACD;AACF;AAEM,SAAS4O,OAAT,GAAmB;EACxB,IAAImyC,aAAa,MAAM7C,iBAAvB,EAA0C;IACxC;IACAH,OAAO,CAAC1nC,IAAR,CAAalW,KAAb,CAAmB49C,OAAnB,EAA4BiD,WAAW,CAAChhD,SAAD,EAAY,OAAZ,CAAvC;EACD;AACF;AAEM,SAASI,OAAT,GAAmB;EACxB,IAAI2gD,aAAa,MAAM5C,iBAAvB,EAA0C;IACxC;IACAJ,OAAO,CAACK,IAAR,CAAaj+C,KAAb,CAAmB49C,OAAnB,EAA4BiD,WAAW,CAAChhD,SAAD,EAAY,UAAZ,CAAvC;EACD;;EACDy+C,SAAS,CAACj8C,iEAAD,EAAiC;IAAC0S,IAAI,EAAE,SAAP;IAAkBlV,SAAS,EAAEA;EAA7B,CAAjC,CAAT;AACD;AAEM,SAASL,QAAT,GAAoB;EACzB,IAAIohD,aAAa,MAAM1C,kBAAvB,EAA2C;IACzC;IACAN,OAAO,CAAC18C,KAAR,CAAclB,KAAd,CAAoB49C,OAApB,EAA6BiD,WAAW,CAAChhD,SAAD,EAAY,QAAZ,CAAxC;EACD;;EACDy+C,SAAS,CAACj8C,iEAAD,EAAiC;IAAC0S,IAAI,EAAE,OAAP;IAAgBlV,SAAS,EAAEA;EAA3B,CAAjC,CAAT;AACD;AAEM,SAASg1B,SAAT,CAAmBisB,MAAnB,EAA2B;EAChC,SAASC,QAAT,CAAkBpgD,EAAlB,EAAsB;IACpB,OAAO,YAAmB;MAAA,kCAANwwB,IAAM;QAANA,IAAM;MAAA;;MACxBxwB,EAAE,MAAF,UAAGmgD,MAAH,SAAc3vB,IAAd;IACD,CAFD;EAGD;;EACD,OAAO;IACL3xB,QAAQ,EAAEuhD,QAAQ,CAACvhD,QAAD,CADb;IAELS,OAAO,EAAE8gD,QAAQ,CAAC9gD,OAAD,CAFZ;IAGLc,UAAU,EAAEggD,QAAQ,CAAChgD,UAAD,CAHf;IAIL0N,OAAO,EAAEsyC,QAAQ,CAACtyC,OAAD;EAJZ,CAAP;AAMD;;AAED,SAASoyC,WAAT,CAAqB1vB,IAArB,EAA2B2vB,MAA3B,EAAmC;EACjC3vB,IAAI,GAAG,GAAGnK,KAAH,CAASvnB,IAAT,CAAc0xB,IAAd,CAAP;EACA,IAAIztB,MAAM,GAAG5E,+DAAA,EAAb;EAEAgiD,MAAM,IAAI3vB,IAAI,CAAChxB,OAAL,CAAa2gD,MAAb,CAAV;;EACA,IAAIp9C,MAAJ,EAAY;IACVytB,IAAI,CAAChxB,OAAL,CAAa0wC,KAAK,CAAC,MAAD,CAAlB;EACD;;EACD1f,IAAI,CAAChxB,OAAL,CAAa0wC,KAAK,CAAC,SAAD,CAAlB;EACA1f,IAAI,CAAChxB,OAAL,CAAa,cAAcuD,MAAM,eAAQA,MAAR,IAAmB,EAAvC,CAAb;EACA,OAAOytB,IAAP;;EAEA,SAAS0f,KAAT,CAAemQ,KAAf,EAAsB;IACpB,iEAA0DA,KAA1D;EACD;AACF;;AAEM,SAASC,gBAAT,GAA4B;EACjC,OAAOpD,gBAAP;AACD;AAEM,SAAS+C,aAAT,GAAyB;EAC9B,OAAO,CAAC,CAAC9hD,wDAAA,CAAiB,OAAjB,CAAT;AACD;AAEM,SAASgpC,qBAAT,GAAiC;EACtC,IAAIoZ,CAAC,GAAGx/C,QAAQ,CAACsX,aAAT,CAAuB,QAAvB,CAAR;EACAkoC,CAAC,CAACniD,EAAF,GAAOgH,sBAAsB,EAA7B;EACAm7C,CAAC,CAAC/pC,MAAF,GAAW,CAAX;EACA+pC,CAAC,CAACjqC,KAAF,GAAU,CAAV;EACAiqC,CAAC,CAACC,MAAF,GAAW,KAAX;EACAD,CAAC,CAACE,MAAF,GAAW,GAAX;EACAF,CAAC,CAACG,MAAF,GAAW,GAAX;EACAH,CAAC,CAACI,WAAF,GAAgB,GAAhB;EACAJ,CAAC,CAACK,YAAF,GAAiB,GAAjB;EACAL,CAAC,CAACnZ,KAAF,CAAQoZ,MAAR,GAAiB,GAAjB;EACAD,CAAC,CAACM,SAAF,GAAc,IAAd;EACAN,CAAC,CAACO,WAAF,GAAgB,GAAhB;EACAP,CAAC,CAACl8C,GAAF,GAAQ,aAAR;EACAk8C,CAAC,CAACnZ,KAAF,CAAQC,OAAR,GAAkB,MAAlB;EACA,OAAOkZ,CAAP;AACD;AAED;AACA;AACA;AACA;;AACO,SAASn2B,kBAAT,CAA4B8M,IAA5B,EAAkC;EACvC,OAAO8mB,OAAO,CAACD,iBAAiB,GAAGvkC,MAArB,CAAP,CAAoC0d,IAApC,KAA6C,EAApD;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS6pB,GAAT,CAAaC,MAAb,EAAqBC,EAArB,EAAyB;EAC9B,OAAOlE,QAAQ,CAACj+C,IAAT,CAAckiD,MAAd,MAA0B,aAAaC,EAAb,GAAkB,GAAnD;AACD;AAEM,SAAS95B,IAAT,CAAc65B,MAAd,EAAsB;EAC3B,OAAOD,GAAG,CAACC,MAAD,EAASrE,GAAT,CAAV;AACD;AAEM,SAASzuB,KAAT,CAAe8yB,MAAf,EAAuB;EAC5B,OAAOD,GAAG,CAACC,MAAD,EAAStE,IAAT,CAAV;AACD;AAEM,SAAS14C,OAAT,CAAiBg9C,MAAjB,EAAyB;EAC9B,OAAOD,GAAG,CAACC,MAAD,EAASvE,IAAT,CAAV;AACD;AAEM,SAASriB,QAAT,CAAkB4mB,MAAlB,EAA0B;EAC/B,OAAOD,GAAG,CAACC,MAAD,EAASpE,KAAT,CAAV;AACD;AAEM,SAASztC,aAAT,CAAuB6xC,MAAvB,EAA+B;EACpC,OAAOD,GAAG,CAACC,MAAD,EAASnE,OAAT,CAAV;AACD;AAEM,SAAS1uB,SAAT,CAAmB6yB,MAAnB,EAA2B;EAChC,OAAOD,GAAG,CAACC,MAAD,EAASlE,QAAT,CAAV;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS57B,OAAT,CAAiB8/B,MAAjB,EAAyB;EAC9B,IAAI,CAACA,MAAL,EAAa,OAAO,IAAP;;EACb,IAAIh9C,OAAO,CAACg9C,MAAD,CAAP,IAAmB9yB,KAAK,CAAC8yB,MAAD,CAA5B,EAAsC;IACpC,OAAO,EAAEA,MAAM,CAAC3gD,MAAP,GAAgB,CAAlB,CAAP;EACD;;EAED,KAAK,IAAIua,CAAT,IAAcomC,MAAd,EAAsB;IACpB,IAAI/mB,cAAc,CAACn7B,IAAf,CAAoBkiD,MAApB,EAA4BpmC,CAA5B,CAAJ,EAAoC,OAAO,KAAP;EACrC;;EAED,OAAO,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASyM,UAAT,CAAoB65B,GAApB,EAAyB;EAC9B,OAAOhzB,KAAK,CAACgzB,GAAD,CAAL,KAAe,CAACA,GAAD,IAAQA,GAAG,CAAC7gD,MAAJ,KAAe,CAAtC,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASgN,KAAT,CAAe2zC,MAAf,EAAuBhhD,EAAvB,EAA2B;EAChC,IAAIkhB,OAAO,CAAC8/B,MAAD,CAAX,EAAqB;EACrB,IAAI75B,IAAI,CAAC65B,MAAM,CAAC36C,OAAR,CAAR,EAA0B,OAAO26C,MAAM,CAAC36C,OAAP,CAAerG,EAAf,EAAmB,IAAnB,CAAP;EAE1B,IAAI4a,CAAC,GAAG,CAAR;EACA,IAAIumC,CAAC,GAAGH,MAAM,CAAC3gD,MAAf;;EAEA,IAAI8gD,CAAC,GAAG,CAAR,EAAW;IACT,OAAOvmC,CAAC,GAAGumC,CAAX,EAAcvmC,CAAC,EAAf;MAAmB5a,EAAE,CAACghD,MAAM,CAACpmC,CAAD,CAAP,EAAYA,CAAZ,EAAeomC,MAAf,CAAF;IAAnB;EACD,CAFD,MAEO;IACL,KAAKpmC,CAAL,IAAUomC,MAAV,EAAkB;MAChB,IAAI/mB,cAAc,CAACn7B,IAAf,CAAoBkiD,MAApB,EAA4BpmC,CAA5B,CAAJ,EAAoC5a,EAAE,CAAClB,IAAH,CAAQ,IAAR,EAAckiD,MAAM,CAACpmC,CAAD,CAApB,EAAyBA,CAAzB;IACrC;EACF;AACF;AAEM,SAAS4nB,QAAT,CAAkBza,CAAlB,EAAqBnJ,GAArB,EAA0B;EAC/B,IAAIsC,OAAO,CAAC6G,CAAD,CAAX,EAAgB;IACd,OAAO,KAAP;EACD;;EAED,IAAIZ,IAAI,CAACY,CAAC,CAAC8H,OAAH,CAAR,EAAqB;IACnB,OAAO9H,CAAC,CAAC8H,OAAF,CAAUjR,GAAV,MAAmB,CAAC,CAA3B;EACD;;EAED,IAAI7T,CAAC,GAAGgd,CAAC,CAAC1nB,MAAV;;EACA,OAAO0K,CAAC,EAAR,EAAY;IACV,IAAIgd,CAAC,CAAChd,CAAD,CAAD,KAAS6T,GAAb,EAAkB;MAChB,OAAO,IAAP;IACD;EACF;;EAED,OAAO,KAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASwiC,IAAT,CAAcJ,MAAd,EAAsB3iD,QAAtB,EAAgC;EACrC,IAAI6iB,OAAO,CAAC8/B,MAAD,CAAX,EAAqB,OAAO,EAAP;EACrB,IAAI75B,IAAI,CAAC65B,MAAM,CAAC16C,GAAR,CAAR,EAAsB,OAAO06C,MAAM,CAAC16C,GAAP,CAAWjI,QAAX,CAAP;EACtB,IAAIgjD,MAAM,GAAG,EAAb;;EACAh0C,KAAK,CAAC2zC,MAAD,EAAS,UAAUpnC,KAAV,EAAiBnE,GAAjB,EAAsB;IAClC4rC,MAAM,CAAC1iD,IAAP,CAAYN,QAAQ,CAACub,KAAD,EAAQnE,GAAR,EAAaurC,MAAb,CAApB;EACD,CAFI,CAAL;;EAIA,OAAOK,MAAP;AACD;AAEM,SAAS1B,MAAT,CAAgB2B,aAAhB,EAA+BC,kBAA/B,EAAmD;EACxD,IAAID,aAAa,CAACrnB,cAAlB,EAAkC;IAChC,OAAOqnB,aAAa,CAACrnB,cAAd,CAA6BsnB,kBAA7B,CAAP;EACD,CAFD,MAEO;IACL,OAAQ,OAAOD,aAAa,CAACC,kBAAD,CAApB,KAA6C,WAA9C,IAA+DD,aAAa,CAACz0C,WAAd,CAA0BhN,SAA1B,CAAoC0hD,kBAApC,MAA4DD,aAAa,CAACC,kBAAD,CAA/I;EACD;AACF;AAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS5oC,aAAT,CAAuB6oC,GAAvB,EAA4B5gD,GAA5B,EAAiCogC,MAAjC,EAAyCygB,gBAAzC,EAA2D;EAChE7gD,GAAG,GAAGA,GAAG,IAAIG,QAAb;EACA,IAAI2gD,QAAJ;;EACA,IAAI1gB,MAAJ,EAAY;IACV0gB,QAAQ,GAAG9gD,GAAG,CAAC+gD,oBAAJ,CAAyB3gB,MAAzB,CAAX;EACD,CAFD,MAEO;IACL0gB,QAAQ,GAAG9gD,GAAG,CAAC+gD,oBAAJ,CAAyB,MAAzB,CAAX;EACD;;EACD,IAAI;IACFD,QAAQ,GAAGA,QAAQ,CAACrhD,MAAT,GAAkBqhD,QAAlB,GAA6B9gD,GAAG,CAAC+gD,oBAAJ,CAAyB,MAAzB,CAAxC;;IACA,IAAID,QAAQ,CAACrhD,MAAb,EAAqB;MACnBqhD,QAAQ,GAAGA,QAAQ,CAAC,CAAD,CAAnB;MACA,IAAIE,cAAc,GAAGH,gBAAgB,GAAG,IAAH,GAAUC,QAAQ,CAACG,UAAxD;MACA,OAAOH,QAAQ,CAACI,YAAT,CAAsBN,GAAtB,EAA2BI,cAA3B,CAAP;IACD;EACF,CAPD,CAOE,OAAO51C,CAAP,EAAU,CAAE;AACf;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS+1C,oBAAT,CAA8B9W,OAA9B,EAAuC3hC,OAAvC,EAAgD;EACrD,IAAIwT,KAAK,GAAG,IAAZ;EACA,OAAO,IAAIsD,4DAAJ,CAAkB,UAAC4Q,OAAD,EAAa;IACpC,IAAMgxB,MAAM,GAAG,SAATA,MAAS,GAAW;MACxB/W,OAAO,CAACgX,mBAAR,CAA4B,MAA5B,EAAoCD,MAApC;MACA/W,OAAO,CAACgX,mBAAR,CAA4B,OAA5B,EAAqCD,MAArC;;MACA,IAAIllC,KAAK,IAAI,IAAb,EAAmB;QACjB9D,MAAM,CAACiE,YAAP,CAAoBH,KAApB;MACD;;MACDkU,OAAO;IACR,CAPD;;IAQAia,OAAO,CAACmC,gBAAR,CAAyB,MAAzB,EAAiC4U,MAAjC;IACA/W,OAAO,CAACmC,gBAAR,CAAyB,OAAzB,EAAkC4U,MAAlC;;IACA,IAAI14C,OAAO,IAAI,IAAf,EAAqB;MACnBwT,KAAK,GAAG9D,MAAM,CAAC+D,UAAP,CAAkBilC,MAAlB,EAA0B14C,OAA1B,CAAR;IACD;EACF,CAdM,CAAP;AAeD;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS8yB,YAAT,CAAsBl+B,GAAtB,EAA2BgN,IAA3B,EAAiC5B,OAAjC,EAA0C;EAC/C,IAAM8uB,GAAG,GAAG,IAAI8pB,KAAJ,EAAZ;;EACA,IAAIh3C,IAAI,IAAI0yC,QAAQ,CAACz2B,IAAT,CAAcjc,IAAd,CAAZ,EAAiC;IAC/B62C,oBAAoB,CAAC3pB,GAAD,EAAM9uB,OAAN,CAApB,CAAmC+W,IAAnC,CAAwCnV,IAAxC;EACD;;EACDktB,GAAG,CAAC/zB,GAAJ,GAAUnG,GAAV;AACD;AAEM,SAASgpC,QAAT,OAAoC;EAAA,IAAhB/oB,MAAgB,QAAhBA,MAAgB;EAAA,IAARgkC,IAAQ,QAARA,IAAQ;;EACzC,IAAIhkC,MAAM,KAAKzc,oDAAX,IAAgCygD,IAApC,EAA0C;IACxCvE,QAAQ,CAACxhB,YAAT,CAAsB+lB,IAAtB;EACD;AACF;AAED;AACA;AACA;AACA;AACA;;AACO,SAASjmB,oBAAT,CAA8BkmB,QAA9B,EAAwC;EAC7C,IAAI,CAACA,QAAL,EAAe;IACb;EACD;;EAED,IAAIztC,MAAM,GAAG5T,QAAQ,CAACsX,aAAT,CAAuB,QAAvB,CAAb;EACA1D,MAAM,CAACvW,EAAP,GAAYgH,sBAAsB,EAAlC;EACAuP,MAAM,CAAC2B,KAAP,GAAe,CAAf;EACA3B,MAAM,CAAC6B,MAAP,GAAgB,CAAhB;EACA7B,MAAM,CAAC8rC,MAAP,GAAgB,GAAhB;EACA9rC,MAAM,CAAC+rC,MAAP,GAAgB,GAAhB;EACA/rC,MAAM,CAACgsC,WAAP,GAAqB,GAArB;EACAhsC,MAAM,CAACisC,YAAP,GAAsB,GAAtB;EACAjsC,MAAM,CAACyyB,KAAP,CAAaC,OAAb,GAAuB,MAAvB;EACA1yB,MAAM,CAACyyB,KAAP,CAAa5wB,MAAb,GAAsB,KAAtB;EACA7B,MAAM,CAACyyB,KAAP,CAAa9wB,KAAb,GAAqB,KAArB;EACA3B,MAAM,CAACksC,SAAP,GAAmB,IAAnB;EACAlsC,MAAM,CAACmsC,WAAP,GAAqB,GAArB;EACAnsC,MAAM,CAAC0tC,iBAAP,GAA2B,MAA3B;EAEAzE,QAAQ,CAACjlC,aAAT,CAAuBhE,MAAvB,EAA+B5T,QAA/B,EAAyC,MAAzC;EAEA4T,MAAM,CAAC2tC,aAAP,CAAqBvhD,QAArB,CAA8B2Y,IAA9B;EACA/E,MAAM,CAAC2tC,aAAP,CAAqBvhD,QAArB,CAA8BimC,KAA9B,CAAoCob,QAApC;EACAztC,MAAM,CAAC2tC,aAAP,CAAqBvhD,QAArB,CAA8BkmC,KAA9B;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASqU,oBAAT,CAA8Bp9C,GAA9B,EAAmCgN,IAAnC,EAAyC5B,OAAzC,EAAkD;EACvD,IAAIi5C,UAAU,GAAG3E,QAAQ,CAACC,0BAAT,CAAoC3/C,GAApC,EAAyC,KAAzC,EAAgD,iCAAhD,CAAjB;EACA,IAAIskD,GAAG,GAAGzhD,QAAQ,CAACsX,aAAT,CAAuB,KAAvB,CAAV;EACAmqC,GAAG,CAACC,SAAJ,GAAgBF,UAAhB;EACA,IAAI5tC,MAAM,GAAG6tC,GAAG,CAACX,UAAjB;;EACA,IAAI32C,IAAI,IAAI0yC,QAAQ,CAACz2B,IAAT,CAAcjc,IAAd,CAAZ,EAAiC;IAC/B62C,oBAAoB,CAACptC,MAAD,EAASrL,OAAT,CAApB,CAAsC+W,IAAtC,CAA2CnV,IAA3C;EACD;;EACD0yC,QAAQ,CAACjlC,aAAT,CAAuBhE,MAAvB,EAA+B5T,QAA/B,EAAyC,MAAzC,EAAiD,IAAjD;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS2hD,oBAAT,CAA8BxkD,GAA9B,EAAmC;EACxC,IAAI,CAACA,GAAL,EAAU;IACR,OAAO,EAAP;EACD;;EAED,IAAIykD,UAAU,GAAGC,SAAS,CAAC1kD,GAAD,CAA1B;EACA,IAAIk6B,GAAG,GAAG,qEAAV;EACAA,GAAG,IAAI,eAAeuqB,UAAf,GAA4B,UAAnC;EACA,OAAOvqB,GAAP;AACD;AAAA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASylB,0BAAT,CAAoC3/C,GAApC,EAAyE;EAAA,IAAhC2kD,SAAgC,uEAApB,IAAoB;EAAA,IAAdC,OAAc,uEAAJ,EAAI;;EAC9E,IAAI,CAAC5kD,GAAL,EAAU;IACR,OAAO,EAAP;EACD;;EACD,IAAI2kD,SAAJ,EAAe;IACb3kD,GAAG,GAAG0kD,SAAS,CAAC1kD,GAAD,CAAf;EACD;;EACD,IAAI4kD,OAAJ,EAAa;IACXA,OAAO,uBAAeA,OAAf,OAAP;EACD;;EAED,yBAAkBA,OAAlB,mBAAiC19C,sBAAsB,EAAvD,0QAOWlH,GAPX;AASD;AAEM,SAAS6kD,cAAT,CAAwBl1C,KAAxB,EAA+BpI,GAA/B,EAAoCu9C,YAApC,EAAkD;EACvD,IAAIv9C,GAAG,KAAKmE,SAAR,IAAqBnE,GAAG,KAAK,IAAjC,EAAuC;IACrC,OAAOu9C,YAAP;EACD;;EACD,IAAI90B,KAAK,CAACzoB,GAAD,CAAT,EAAgB;IACd,OAAOA,GAAP;EACD;;EACD,IAAI20B,QAAQ,CAAC30B,GAAD,CAAZ,EAAmB;IACjB,OAAOA,GAAG,CAACs3C,QAAJ,EAAP;EACD;;EACDa,QAAQ,CAACt+C,OAAT,CAAiB,gCAAgCuO,KAAhC,GAAwC,wBAAzD;AACD;AAEM,SAASsE,OAAT,CAAiByH,KAAjB,EAAwB9O,KAAxB,EAA+Bm4C,IAA/B,EAAqC;EAC1C,OAAOA,IAAI,CAACpzB,OAAL,CAAajW,KAAb,MAAwB9O,KAA/B;AACD;AAEM,SAAStF,OAAT,CAAiBuiB,CAAjB,EAAoBsd,CAApB,EAAuB;EAC5B,OAAOtd,CAAC,CAAC/L,MAAF,CAASqpB,CAAT,CAAP;AACD;AAEM,SAAS5uB,aAAT,CAAuBrY,EAAvB,EAA2B2d,cAA3B,EAA2C;EAChD,IAAI,CAAC3d,EAAL,EAAS;IACP;EACD;;EACD,IAAI2L,UAAJ;EACAgS,cAAc,CAAC0C,IAAf,CAAoB,UAAA3V,aAAa,EAAI;IACnC,IAAItE,MAAM,GAAGtD,kDAAI,CAAC4H,aAAa,CAACrE,IAAf,EAAqB,UAAA9D,GAAG;MAAA,OAAI,CAAC,OAAD,EAAU,MAAV,EAAkB,QAAlB,EAA4B8d,IAA5B,CAAiC,UAAArK,IAAI;QAAA,OAAIzT,GAAG,CAACyT,IAAD,CAAH,KAAchW,EAAlB;MAAA,CAArC,CAAJ;IAAA,CAAxB,CAAjB;;IACA,IAAIoG,MAAJ,EAAY;MACVuF,UAAU,GAAGvF,MAAb;IACD;;IACD,OAAOA,MAAP;EACD,CAND;EAOA,OAAOuF,UAAP;AACD;AAEM,SAASu1C,OAAT,CAAiB1gC,GAAjB,EAAsB;EAC3B,OAAOja,MAAM,CAAC0J,IAAP,CAAYuQ,GAAZ,CAAP;AACD;AAEM,SAAS4G,QAAT,CAAkB5G,GAAlB,EAAuBnJ,GAAvB,EAA4B;EACjC,OAAOmJ,GAAG,CAACnJ,GAAD,CAAV;AACD;AAED;AACA;AACA;;AACO,SAAS4oB,aAAT,CAAuBzf,GAAvB,EAA4BhF,KAA5B,EAAmC;EACxC,KAAK,IAAIiF,IAAT,IAAiBD,GAAjB,EAAsB;IACpB,IAAIA,GAAG,CAACqb,cAAJ,CAAmBpb,IAAnB,CAAJ,EAA8B;MAC5B,IAAID,GAAG,CAACC,IAAD,CAAH,KAAcjF,KAAlB,EAAyB;QACvB,OAAOiF,IAAP;MACD;IACF;EACF;AACF;AAEM,SAASpX,cAAT,GAA6D;EAAA,IAArCzG,OAAqC,uEAA3B,KAAkBA,OAAS;EAClE;EACA,OAAOA,OAAO,CAACsF,GAAR,CAAY,UAAAyhC,IAAI;IAAA,OAAIA,IAAI,CAACtjC,IAAL,CAAU6B,GAAV,CAAc,UAAA3F,GAAG;MAAA,OAAIA,GAAG,CAACoC,MAAR;IAAA,CAAjB,EACxBwB,MADwB,CACjBiB,OADiB,EACR,EADQ,CAAJ;EAAA,CAAhB,EACiBjB,MADjB,CACwBiB,OADxB,EACiC,EADjC,EACqCd,MADrC,CAC4CyN,OAD5C,CAAP;AAED;AAEM,SAASwzB,kBAAT,GAA8B;EACnC,IAAI3sB,MAAM,CAACu1B,SAAP,IAAoBpnB,IAAI,CAACnO,MAAM,CAACu1B,SAAP,CAAiBC,MAAlB,CAAxB,IAAqDrnB,IAAI,CAACnO,MAAM,CAACu1B,SAAP,CAAiBC,MAAjB,GAA0BC,QAA3B,CAA7D,EAAmG;IACjG,OAAO,IAAP;EACD;AACF;AAEM,SAASL,kBAAT,GAA8B;EACnC,IAAIp1B,MAAM,CAAC81B,MAAP,IAAiB3nB,IAAI,CAACnO,MAAM,CAAC81B,MAAP,CAAcC,MAAf,CAAzB,EAAiD;IAC/C,OAAO,IAAP;EACD;AACF,EAED;;AACO,IAAMhK,aAAa,GAAGme,qBAAqB,CAAC,eAAD,EAAkB,UAACC,QAAD,EAAWC,OAAX;EAAA,OAAuBD,QAAQ,GAAGC,OAAlC;AAAA,CAAlB,CAA3C,EAEP;AACA;;AACO,IAAM9K,sBAAsB,GAAG4K,qBAAqB,CAAC,mBAAD,EAAsB,UAACC,QAAD,EAAWC,OAAX;EAAA,OAAuBD,QAAQ,GAAGC,OAAlC;AAAA,CAAtB,CAApD,EAEP;AACA;;AACO,IAAMC,sBAAsB,GAAGH,qBAAqB,CAAC,mBAAD,EAAsB,UAACC,QAAD,EAAWC,OAAX;EAAA,OAAuBD,QAAQ,GAAGC,OAAlC;AAAA,CAAtB,CAApD;;AAEP,SAASF,qBAAT,CAA+BI,qBAA/B,EAAsDC,kBAAtD,EAA0E;EACxE,OAAO,UAACJ,QAAD,EAAWC,OAAX,EAAuB;IAC5B,IAAID,QAAQ,CAAC9xC,GAAT,KAAiB+xC,OAAO,CAAC/xC,GAA7B,EAAkC;MAChC,OAAOkyC,kBAAkB,CAACJ,QAAQ,CAACG,qBAAD,CAAT,EAAkCF,OAAO,CAACE,qBAAD,CAAzC,CAAlB,GAAsFF,OAAtF,GAAgGD,QAAvG;IACD;;IACD,OAAOA,QAAQ,CAAC9xC,GAAT,GAAe+xC,OAAO,CAAC/xC,GAAvB,GAA6B+xC,OAA7B,GAAuCD,QAA9C;EACD,CALD;AAMD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACO,SAAS76C,OAAT,CAAiBk7C,KAAjB,EAAwB;EAC7B,IAAI/gD,OAAO,GAAG+gD,KAAK,CAACnjD,MAApB,CAD6B,CAG7B;;EACA,OAAOoC,OAAO,GAAG,CAAjB,EAAoB;IAClB;IACA,IAAIqI,KAAK,GAAG4T,IAAI,CAACuU,KAAL,CAAWvU,IAAI,CAACggC,MAAL,KAAgBj8C,OAA3B,CAAZ,CAFkB,CAIlB;;IACAA,OAAO,GALW,CAOlB;;IACA,IAAIghD,IAAI,GAAGD,KAAK,CAAC/gD,OAAD,CAAhB;IACA+gD,KAAK,CAAC/gD,OAAD,CAAL,GAAiB+gD,KAAK,CAAC14C,KAAD,CAAtB;IACA04C,KAAK,CAAC14C,KAAD,CAAL,GAAe24C,IAAf;EACD;;EAED,OAAOD,KAAP;AACD;AAEM,SAASjmC,aAAT,CAAuB7Y,MAAvB,EAA+B/D,GAA/B,EAAoC;EACzC,OAAOgL,sDAAQ,CAACjH,MAAD,EAAS/D,GAAG,IAAIA,GAAG,CAACpC,UAApB,CAAf;AACD;AAEM,SAAS6H,SAAT,CAAmBwY,GAAnB,EAAwB;EAC7B,OAAO8kC,iDAAK,CAAC9kC,GAAD,CAAZ;AACD;AAEM,SAASmoB,QAAT,GAAoB;EACzB,IAAI;IACF,OAAO6W,QAAQ,CAACE,aAAT,OAA6BF,QAAQ,CAACrN,YAAT,EAApC;EACD,CAFD,CAEE,OAAOvkC,CAAP,EAAU;IACV,OAAO,IAAP;EACD;AACF;AAEM,SAASwwC,eAAT,GAA2B;EAChC,OAAO,6CAA6CmH,IAA7C,CAAkD15C,SAAS,CAAC25C,SAA5D,CAAP;AACD;AAEM,SAASpd,mBAAT,CAA6B0a,GAA7B,EAAkC7vC,GAAlC,EAAuC;EAC5C,IAAI,CAAC6vC,GAAL,EAAU;EACV,OAAOA,GAAG,CAACjO,OAAJ,CAAY,sBAAZ,EAAoC5hC,GAApC,CAAP;AACD;AAEM,SAASs1B,mBAAT,CAA6Bua,GAA7B,EAAkC2C,QAAlC,EAA4C;EACjD,IAAI,CAAC3C,GAAD,IAAQ,CAAC2C,QAAT,IAAqB,OAAOA,QAAP,KAAoB,QAA7C,EAAuD;EACvD,OAAO3C,GAAG,CAACjO,OAAJ,CAAY,mBAAZ,EAAiC4Q,QAAjC,CAAP;AACD;AAEM,SAASn4C,SAAT,GAAqB;EAC1B,OAAO,IAAIyR,IAAJ,GAAW2mC,OAAX,EAAP;AACD;AAED;AACA;AACA;AACA;;AACO,SAASC,iBAAT,GAA6B;EAClC,OAAQ/qC,MAAM,CAACgrC,WAAP,IAAsBhrC,MAAM,CAACgrC,WAAP,CAAmB5mC,GAAzC,IAAgDpE,MAAM,CAACgrC,WAAP,CAAmB5mC,GAAnB,EAAjD,IAA8E,CAArF;AACD;AAED;AACA;AACA;AACA;;AACO,SAASm0B,eAAT,GAA2B;EAChC,OAAOpzC,wDAAA,CAAiB,cAAjB,MAAqC,KAA5C;AACD;AAED;AACA;AACA;;AACO,SAASq0C,kBAAT,GAA8B;EACnC,IAAIx5B,MAAM,CAAC/O,SAAP,CAAiBg6C,aAAjB,IAAkC,CAAC,CAACljD,QAAQ,CAACixC,MAAT,CAAgB3xC,MAAxD,EAAgE;IAC9D,OAAO,IAAP;EACD;AACF;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASyS,cAAT,CAAwBlU,IAAxB,EAA8BslD,gBAA9B,EAAgD;EACrD,IAAIA,gBAAgB,GAAG,CAAvB,EAA0B;IACxB,MAAM,IAAIv1B,KAAJ,2DAA6Du1B,gBAA7D,EAAN;EACD;;EACD,IAAIC,QAAQ,GAAG,CAAf;EACA,OAAO,YAAY;IACjBA,QAAQ;;IACR,IAAIA,QAAQ,KAAKD,gBAAjB,EAAmC;MACjCtlD,IAAI,CAACS,KAAL,CAAW,IAAX,EAAiBH,SAAjB;IACD;EACF,CALD;AAMD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASkP,OAAT,CAAiBg2C,EAAjB,EAAqB3uC,GAArB,EAA0B;EAC/B,OAAO2uC,EAAE,CAAC7/C,MAAH,CAAU,UAAS8/C,EAAT,EAAaxrC,CAAb,EAAgB;IAC/B,CAACwrC,EAAE,CAACxrC,CAAC,CAACpD,GAAD,CAAF,CAAF,GAAa4uC,EAAE,CAACxrC,CAAC,CAACpD,GAAD,CAAF,CAAF,IAAc,EAA5B,EAAgC9W,IAAhC,CAAqCka,CAArC;IACA,OAAOwrC,EAAP;EACD,CAHM,EAGJ,EAHI,CAAP;AAID;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASx/C,gBAAT,CAA0Bm8C,MAA1B,EAAkC9yC,MAAlC,EAA0C;EAC/C,OAAOA,MAAM,CACVxJ,MADI,CACG,UAAAmJ,KAAK;IAAA,OAAImzC,MAAM,CAACnzC,KAAD,CAAV;EAAA,CADR,EAEJtJ,MAFI,CAEG,UAAC5D,GAAD,EAAMkN,KAAN;IAAA,OAAgBlJ,MAAM,CAACC,MAAP,CAAcjE,GAAd,wFAAsBkN,KAAtB,EAA8BmzC,MAAM,CAACnzC,KAAD,CAApC,EAAhB;EAAA,CAFH,EAEmE,EAFnE,CAAP;AAGD;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AACO,SAAS9I,iBAAT,CAA2BD,UAA3B,EAAuC;EAC5C,IAAMw/C,qBAAqB,GAAG,CAAC,QAAD,EAAW,QAAX,EAAqB,OAArB,CAA9B;EACA,IAAMC,sBAAsB,GAAG,CAAC,UAAD,EAAa,WAAb,EAA0B,OAA1B,CAA/B;EAEA,IAAMC,KAAK,GAAG7/C,MAAM,CAAC0J,IAAP,CAAYvJ,UAAZ,CAAd;;EAEA,IAAI,CAAC0/C,KAAK,CAACvtC,KAAN,CAAY,UAAA7C,IAAI;IAAA,OAAIzI,sDAAQ,CAAC24C,qBAAD,EAAwBlwC,IAAxB,CAAZ;EAAA,CAAhB,CAAL,EAAiE;IAC/D,OAAO,KAAP;EACD;;EAED,IAAItP,UAAU,CAACy1B,KAAX,IAAoBz1B,UAAU,CAACy1B,KAAX,CAAiBvc,OAAzC,EAAkD;IAChD,OAAOrS,sDAAQ,CAAC44C,sBAAD,EAAyBz/C,UAAU,CAACy1B,KAAX,CAAiBvc,OAA1C,CAAf;EACD;;EAED,OAAO,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAAS7P,uBAAT,CAAiCnN,OAAjC,EAA0CzC,UAA1C,EAAsDwE,MAAtD,EAA8D;EACnE,OAAO/B,OAAO,CACX0D,MADI,CACG,UAAAzD,MAAM;IAAA,OAAIA,MAAM,CAACE,IAAP,KAAgB5C,UAApB;EAAA,CADT,EAEJ+H,GAFI,CAEA,UAACrF,MAAD;IAAA,OAAYA,MAAM,CAACwD,IAAnB;EAAA,CAFA,EAGJF,MAHI,CAGGiB,OAHH,EAGY,EAHZ,EAIJd,MAJI,CAIG,UAAC+/C,UAAD;IAAA,OAAgBA,UAAU,CAAC1hD,MAAX,KAAsBA,MAAtC;EAAA,CAJH,EAKJuD,GALI,CAKA,UAACm+C,UAAD;IAAA,OAAgBA,UAAU,CAACv2C,MAAX,IAAqB,EAArC;EAAA,CALA,CAAP;AAMD;AAED;AACA;AACA;;AACO,SAASw2C,MAAT,GAAkB;EACvB,OAAOz6C,SAAS,CAAC06C,UAAV,KAAyB,GAAzB,IAAgC3rC,MAAM,CAAC2rC,UAAP,KAAsB,GAAtD,IAA6D16C,SAAS,CAAC26C,YAAV,KAA2B,GAAxF,IAA+F36C,SAAS,CAAC06C,UAAV,KAAyB,KAA/H;AACD;;AAED,IAAME,kBAAkB,GAAG,SAArBA,kBAAqB,CAACvW,IAAD,EAAO/vC,UAAP;EAAA,OAAsB+vC,IAAI,CAAC2G,aAAL,OAAyB12C,UAAzB,IAAuC+vC,IAAI,CAACM,gBAAL,OAA4BrwC,UAAzF;AAAA,CAA3B;AAEA;AACA;AACA;AACA;AACA;;;AACO,SAAS65C,wBAAT,CAAkC9J,IAAlC,EAAwC;EAC7C,OAAO,UAAC/vC,UAAD;IAAA,OAAgBsmD,kBAAkB,CAACvW,IAAD,EAAO/vC,UAAP,CAAlC;EAAA,CAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASumD,wBAAT,CAAkCvmD,UAAlC,EAA8C;EACnD,OAAO,UAAC+vC,IAAD;IAAA,OAAUuW,kBAAkB,CAACvW,IAAD,EAAO/vC,UAAP,CAA5B;EAAA,CAAP;AACD;AAED;AACA;AACA;;AACO,SAASwmD,uBAAT,CAAiCxmD,UAAjC,EAA6C;EAClD,IAAIymD,YAAJ;;EACA,IAAIrf,kBAAkB,EAAtB,EAA0B;IACxB;IACAqf,YAAY,GAAG9jD,kDAAI,CAAC8X,MAAM,CAACu1B,SAAP,CAAiBC,MAAjB,GAA0BC,QAA1B,EAAD,EAAuCqW,wBAAwB,CAACvmD,UAAD,CAA/D,CAAnB;EACD;;EACD,OAAOymD,YAAP;AACD;AAAA;AAED;AACA;AACA;;AACO,SAASC,2BAAT,CAAqC1mD,UAArC,EAAiD;EACtD,IAAMymD,YAAY,GAAGD,uBAAuB,CAACxmD,UAAD,CAA5C;;EACA,IAAIymD,YAAJ,EAAkB;IAChB,OAAO;MACLE,OAAO,EAAEF,YAAY,CAAC/P,aAAb,EADJ;MAELkQ,KAAK,EAAEH,YAAY,CAACpW,gBAAb;IAFF,CAAP;EAID;;EACD,OAAO,EAAP;AACD;AAAA;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,SAASvG,wBAAT,CAAkCpnC,MAAlC,EAA0C8B,MAA1C,EAAkD;EACvD,IAAMoU,SAAS,GAAGxS,MAAM,CAAC0J,IAAP,CAAYpN,MAAM,CAAC6D,UAAP,IAAqB;IAAC,UAAU;EAAX,CAAjC,EAAuD8G,IAAvD,CAA4D,IAA5D,CAAlB;EAEA,uBACI3K,MAAM,CAACE,IADX,mBACwBgW,SADxB,iEAE0CA,SAF1C,eAEwDpU,MAFxD;AAKD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASk8B,SAAT,CAAmBrlB,KAAnB,EAA0B;EAC/B,IAAInP,MAAM,CAACw0B,SAAX,EAAsB;IACpB,OAAOx0B,MAAM,CAACw0B,SAAP,CAAiBrlB,KAAjB,CAAP;EACD,CAFD,MAEO;IACL,OAAO,OAAOA,KAAP,KAAiB,QAAjB,IAA6BmqB,QAAQ,CAACnqB,KAAD,CAArC,IAAgD8E,IAAI,CAACuU,KAAL,CAAWrZ,KAAX,MAAsBA,KAA7E;EACD;AACF;AAED;AACA;AACA;AACA;;AACO,SAASwrC,wBAAT,CAAkCxrC,KAAlC,EAAyC;EAC9C,OAAOA,KAAK,CAACq5B,OAAN,CAAc,mBAAd,EAAmC,UAAUp6B,CAAV,EAAawsC,CAAb,EAAgB;IAAE,OAAO,MAAMA,CAAC,CAACnzC,WAAF,EAAb;EAA8B,CAAnF,EAAqF+gC,OAArF,CAA6F,IAA7F,EAAmG,EAAnG,CAAP;AACD;AAED;AACA;AACA;AACA;;AACO,SAASqS,QAAT,CAAkB1mC,GAAlB,EAAuB;EAC5B,OAAOja,MAAM,CAAC0J,IAAP,CAAYuQ,GAAZ,EAAiBra,MAAjB,CAAwB,UAACghD,MAAD,EAAS9vC,GAAT,EAAiB;IAC9C,IAAI,OAAOmJ,GAAG,CAACnJ,GAAD,CAAV,KAAoB,WAAxB,EAAqC;MACnC8vC,MAAM,CAAC9vC,GAAD,CAAN,GAAcmJ,GAAG,CAACnJ,GAAD,CAAjB;IACD;;IACD,OAAO8vC,MAAP;EACD,CALM,EAKJ,EALI,CAAP;AAMD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASvlB,IAAT,CAAcphB,GAAd,EAAmB4mC,UAAnB,EAA+B;EACpC,IAAI,0EAAO5mC,GAAP,MAAe,QAAnB,EAA6B;IAC3B,OAAO,EAAP;EACD;;EACD,OAAO4mC,UAAU,CAACjhD,MAAX,CAAkB,UAACghD,MAAD,EAAS1mC,IAAT,EAAe9T,CAAf,EAAqB;IAC5C,IAAI,OAAO8T,IAAP,KAAgB,UAApB,EAAgC;MAC9B,OAAO0mC,MAAP;IACD;;IAED,IAAI/uB,OAAO,GAAG3X,IAAd;IACA,IAAI2c,KAAK,GAAG3c,IAAI,CAAC2c,KAAL,CAAW,qBAAX,CAAZ;;IAEA,IAAIA,KAAJ,EAAW;MACT3c,IAAI,GAAG2c,KAAK,CAAC,CAAD,CAAZ;MACAhF,OAAO,GAAGgF,KAAK,CAAC,CAAD,CAAf;IACD;;IAED,IAAI5hB,KAAK,GAAGgF,GAAG,CAACC,IAAD,CAAf;;IACA,IAAI,OAAO2mC,UAAU,CAACz6C,CAAC,GAAG,CAAL,CAAjB,KAA6B,UAAjC,EAA6C;MAC3C6O,KAAK,GAAG4rC,UAAU,CAACz6C,CAAC,GAAG,CAAL,CAAV,CAAkB6O,KAAlB,EAAyB2rC,MAAzB,CAAR;IACD;;IACD,IAAI,OAAO3rC,KAAP,KAAiB,WAArB,EAAkC;MAChC2rC,MAAM,CAAC/uB,OAAD,CAAN,GAAkB5c,KAAlB;IACD;;IAED,OAAO2rC,MAAP;EACD,CAtBM,EAsBJ,EAtBI,CAAP;AAuBD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,4BAAT,CAAsCrQ,QAAtC,EAAwE;EAAA,IAAxBsQ,SAAwB,uEAAZ,UAAY;EAC7E,IAAIC,IAAI,GAAG,EAAX;;EAEAt4C,KAAK,CAAC+nC,QAAD,EAAW,UAAClgB,CAAD,EAAIta,CAAJ,EAAU;IACxB,IAAI5W,OAAO,CAACkxB,CAAD,CAAX,EAAgB;MACd,IAAI0wB,MAAM,GAAG,EAAb;;MACAv4C,KAAK,CAAC6nB,CAAD,EAAI,UAACzvB,GAAD,EAAS;QAChBA,GAAG,GAAGs9C,cAAc,CAAC2C,SAAS,GAAG,GAAZ,GAAkB9qC,CAAnB,EAAsBnV,GAAtB,CAApB;;QACA,IAAIA,GAAG,IAAIA,GAAG,KAAK,EAAnB,EAAuB;UAAEmgD,MAAM,CAACjnD,IAAP,CAAY8G,GAAZ;QAAmB;MAC7C,CAHI,CAAL;;MAIAyvB,CAAC,GAAG0wB,MAAJ;IACD,CAPD,MAOO;MACL1wB,CAAC,GAAG6tB,cAAc,CAAC2C,SAAS,GAAG,GAAZ,GAAkB9qC,CAAnB,EAAsBsa,CAAtB,CAAlB;;MACA,IAAIhH,KAAK,CAACgH,CAAD,CAAT,EAAc;QACZA,CAAC,GAAG,CAACA,CAAD,CAAJ;MACD,CAFD,MAEO;QACL;MACD,CANI,CAMH;;IACH;;IACDywB,IAAI,CAAChnD,IAAL,CAAU;MAAC8W,GAAG,EAAEmF,CAAN;MAAShB,KAAK,EAAEsb;IAAhB,CAAV;EACD,CAjBI,CAAL;;EAmBA,OAAOywB,IAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASE,cAAT,CAAwBC,aAAxB,EAAuClsC,KAAvC,EAA8C;EAC5C,IAAIksC,aAAa,KAAK,QAAtB,EAAgC;IAC9B,OAAOlsC,KAAK,IAAIA,KAAK,CAACmjC,QAAN,EAAhB;EACD,CAFD,MAEO,IAAI+I,aAAa,KAAK,QAAtB,EAAgC;IACrC,OAAOr7C,MAAM,CAACmP,KAAD,CAAb;EACD,CAFM,MAEA;IACL,OAAOA,KAAP;EACD;AACF;;AAEM,SAASmsC,YAAT,CAAsBvB,KAAtB,EAA6Bt2C,MAA7B,EAAqC;EAC1CvJ,MAAM,CAAC0J,IAAP,CAAYm2C,KAAZ,EAAmBn+C,OAAnB,CAA2B,UAAAoP,GAAG,EAAI;IAChC,IAAIvH,MAAM,CAACuH,GAAD,CAAV,EAAiB;MACf,IAAI0R,IAAI,CAACq9B,KAAK,CAAC/uC,GAAD,CAAN,CAAR,EAAsB;QACpBvH,MAAM,CAACuH,GAAD,CAAN,GAAc+uC,KAAK,CAAC/uC,GAAD,CAAL,CAAWvH,MAAM,CAACuH,GAAD,CAAjB,CAAd;MACD,CAFD,MAEO;QACLvH,MAAM,CAACuH,GAAD,CAAN,GAAcowC,cAAc,CAACrB,KAAK,CAAC/uC,GAAD,CAAN,EAAavH,MAAM,CAACuH,GAAD,CAAnB,CAA5B;MACD,CALc,CAOf;;;MACA,IAAIyc,KAAK,CAAChkB,MAAM,CAACuH,GAAD,CAAP,CAAT,EAAwB;QACtB,OAAOvH,MAAM,CAACuH,GAAd;MACD;IACF;EACF,CAbD;EAcA,OAAOvH,MAAP;AACD;AAEM,SAAS80B,aAAT,CAAuBv9B,GAAvB,EAA4BwhB,IAA5B,EAAkC;EACvC,OAAQjjB,OAAO,CAACyB,GAAD,CAAR,KAAoBwhB,IAAD,GAASxhB,GAAG,CAACpF,MAAJ,KAAe4mB,IAAxB,GAA+B,IAAlD,KAA4DxhB,GAAG,CAACwR,KAAJ,CAAU,UAAAie,CAAC;IAAA,OAAI+J,SAAS,CAAC/J,CAAD,CAAb;EAAA,CAAX,CAAnE;AACD;AAED;AACA;AACA;;AACO,SAAS8wB,IAAT,CAAcpsC,KAAd,EAAqBvZ,MAArB,EAA6B;EAClC,IAAI4lD,QAAQ,GAAG,EAAf;;EAEA,KAAK,IAAIl7C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1K,MAApB,EAA4B0K,CAAC,EAA7B,EAAiC;IAC/B,IAAIm7C,WAAW,GAAG/2C,aAAa,CAACyK,KAAD,CAAb,GAAuBxT,SAAS,CAACwT,KAAD,CAAhC,GAA0CA,KAA5D;IACAqsC,QAAQ,CAACtnD,IAAT,CAAcunD,WAAd;EACD;;EAED,OAAOD,QAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,KAAT,CAAe3C,KAAf,EAAsBv8B,IAAtB,EAA4B;EACjC,IAAIg/B,QAAQ,GAAG,EAAf;;EAEA,KAAK,IAAIl7C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2T,IAAI,CAAC0nC,IAAL,CAAU5C,KAAK,CAACnjD,MAAN,GAAe4mB,IAAzB,CAApB,EAAoDlc,CAAC,EAArD,EAAyD;IACvD,IAAIU,KAAK,GAAGV,CAAC,GAAGkc,IAAhB;IACA,IAAIo/B,GAAG,GAAG56C,KAAK,GAAGwb,IAAlB;IACAg/B,QAAQ,CAACtnD,IAAT,CAAc6kD,KAAK,CAACn9B,KAAN,CAAY5a,KAAZ,EAAmB46C,GAAnB,CAAd;EACD;;EAED,OAAOJ,QAAP;AACD;AAEM,SAASK,oBAAT,CAA8B9C,KAA9B,EAAqC;EAC1C,OAAO9kC,IAAI,CAACC,GAAL,OAAAD,IAAI,uFAAQ8kC,KAAR,EAAX;AACD;AAEM,SAAS+C,oBAAT,CAA8B/C,KAA9B,EAAqC;EAC1C,OAAO9kC,IAAI,CAAC+T,GAAL,OAAA/T,IAAI,uFAAQ8kC,KAAR,EAAX;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASgD,SAAT,CAAmBC,QAAnB,EAA6B;EAClC,OAAO,SAASC,OAAT,CAAiB3+B,CAAjB,EAAoBsd,CAApB,EAAuB;IAC5B,IAAItd,CAAC,CAAC0+B,QAAD,CAAD,GAAcphB,CAAC,CAACohB,QAAD,CAAnB,EAA+B;MAC7B,OAAO,CAAP;IACD;;IACD,IAAI1+B,CAAC,CAAC0+B,QAAD,CAAD,GAAcphB,CAAC,CAACohB,QAAD,CAAnB,EAA+B;MAC7B,OAAO,CAAC,CAAR;IACD;;IACD,OAAO,CAAP;EACD,CARD;AASD;AAEM,SAASzI,OAAT,CAAiB2I,KAAjB,EAAwB;EAC7B,OAAO,CAACA,KAAD,GAAS,EAAT,GAAcA,KAAK,CACvB1T,OADkB,CACV,KADU,EACH,EADG,EAElBn8B,KAFkB,CAEZ,GAFY,EAGlBvS,MAHkB,CAGX,UAACw0C,GAAD,EAAM6N,QAAN,EAAmB;IACzB,sBAAaA,QAAQ,CAAC9vC,KAAT,CAAe,GAAf,CAAb;IAAA;IAAA,IAAK8D,CAAL;IAAA,IAAQsa,CAAR;;IACA,IAAI,QAAQyuB,IAAR,CAAa/oC,CAAb,CAAJ,EAAqB;MACnBA,CAAC,GAAGA,CAAC,CAACq4B,OAAF,CAAU,IAAV,EAAgB,EAAhB,CAAJ;MACA8F,GAAG,CAACn+B,CAAD,CAAH,GAASm+B,GAAG,CAACn+B,CAAD,CAAH,IAAU,EAAnB;MACAm+B,GAAG,CAACn+B,CAAD,CAAH,CAAOjc,IAAP,CAAYu2B,CAAZ;IACD,CAJD,MAIO;MACL6jB,GAAG,CAACn+B,CAAD,CAAH,GAASsa,CAAC,IAAI,EAAd;IACD;;IACD,OAAO6jB,GAAP;EACD,CAbkB,EAahB,EAbgB,CAArB;AAcD;AAEM,SAASkF,QAAT,CAAkB0I,KAAlB,EAAyB;EAC9B,OAAOhiD,MAAM,CACV0J,IADI,CACCs4C,KADD,EAEJrgD,GAFI,CAEA,UAAAsU,CAAC;IAAA,OAAI7L,KAAK,CAAC/K,OAAN,CAAc2iD,KAAK,CAAC/rC,CAAD,CAAnB,IACN+rC,KAAK,CAAC/rC,CAAD,CAAL,CAAStU,GAAT,CAAa,UAAA4uB,CAAC;MAAA,iBAAOta,CAAP,gBAAcsa,CAAd;IAAA,CAAd,EAAiCtpB,IAAjC,CAAsC,GAAtC,CADM,aAEHgP,CAFG,cAEE+rC,KAAK,CAAC/rC,CAAD,CAFP,CAAJ;EAAA,CAFD,EAKJhP,IALI,CAKC,GALD,CAAP;AAMD;AAEM,SAAS2N,QAAT,CAAkBrb,GAAlB,EAAuBD,OAAvB,EAAgC;EACrC,IAAI4oD,MAAM,GAAG9lD,QAAQ,CAACsX,aAAT,CAAuB,GAAvB,CAAb;;EACA,IAAIpa,OAAO,IAAI,sBAAsBA,OAAjC,IAA4CA,OAAO,CAAC6oD,gBAAxD,EAA0E;IACxED,MAAM,CAAC9tC,IAAP,GAAc7a,GAAd;EACD,CAFD,MAEO;IACL2oD,MAAM,CAAC9tC,IAAP,GAAcm5B,kBAAkB,CAACh0C,GAAD,CAAhC;EACD,CANoC,CAOrC;;;EACA,IAAI6oD,UAAU,GAAI9oD,OAAO,IAAI,0BAA0BA,OAArC,IAAgDA,OAAO,CAAC+oD,oBAA1E;EACA,OAAO;IACLjuC,IAAI,EAAE8tC,MAAM,CAAC9tC,IADR;IAELqxB,QAAQ,EAAE,CAACyc,MAAM,CAACzc,QAAP,IAAmB,EAApB,EAAwB6I,OAAxB,CAAgC,IAAhC,EAAsC,EAAtC,CAFL;IAGLtsB,QAAQ,EAAEkgC,MAAM,CAAClgC,QAHZ;IAILsgC,IAAI,EAAE,CAACJ,MAAM,CAACI,IAJT;IAKLC,QAAQ,EAAEL,MAAM,CAACK,QAAP,CAAgBjU,OAAhB,CAAwB,SAAxB,EAAmC,GAAnC,CALL;IAMLz5B,MAAM,EAAGutC,UAAD,GAAeF,MAAM,CAACrtC,MAAtB,GAA+BokC,QAAQ,CAACI,OAAT,CAAiB6I,MAAM,CAACrtC,MAAP,IAAiB,EAAlC,CANlC;IAOL2tC,IAAI,EAAE,CAACN,MAAM,CAACM,IAAP,IAAe,EAAhB,EAAoBlU,OAApB,CAA4B,IAA5B,EAAkC,EAAlC,CAPD;IAQLvI,IAAI,EAAEmc,MAAM,CAACnc,IAAP,IAAe1xB,MAAM,CAACmxB,QAAP,CAAgBO;EARhC,CAAP;AAUD;AAEM,SAASjxB,QAAT,CAAkBmF,GAAlB,EAAuB;EAC5B,OAAO,CAACA,GAAG,CAACwrB,QAAJ,IAAgB,MAAjB,IAA2B,KAA3B,IACJxrB,GAAG,CAAC8rB,IAAJ,IACC9rB,GAAG,CAAC+H,QAAJ,IAAgB/H,GAAG,CAACqoC,IAAJ,cAAeroC,GAAG,CAACqoC,IAAnB,IAA4B,EAA5C,CAFG,KAGJroC,GAAG,CAACsoC,QAAJ,IAAgB,EAHZ,KAIJtoC,GAAG,CAACpF,MAAJ,cAAiBokC,QAAQ,CAACK,QAAT,CAAkBr/B,GAAG,CAACpF,MAAJ,IAAc,EAAhC,CAAjB,IAAyD,EAJrD,KAKJoF,GAAG,CAACuoC,IAAJ,cAAevoC,GAAG,CAACuoC,IAAnB,IAA4B,EALxB,CAAP;AAMD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASjJ,SAAT,CAAmBkJ,IAAnB,EAAyBC,IAAzB,EAA0D;EAAA,gFAAJ,EAAI;EAAA,6BAA1BC,UAA0B;EAAA,IAA1BA,UAA0B,iCAAb,KAAa;;EAC/D,IAAIF,IAAI,KAAKC,IAAb,EAAmB,OAAO,IAAP,CAAnB,KACK,IACF,0EAAOD,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAAtC,IACC,0EAAOC,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,IADtC,KAEC,CAACC,UAAD,IAAgBF,IAAI,CAACv6C,WAAL,KAAqBw6C,IAAI,CAACx6C,WAF3C,CADG,EAIH;IACA,IAAIlI,MAAM,CAAC0J,IAAP,CAAY+4C,IAAZ,EAAkB/mD,MAAlB,KAA6BsE,MAAM,CAAC0J,IAAP,CAAYg5C,IAAZ,EAAkBhnD,MAAnD,EAA2D,OAAO,KAAP;;IAC3D,KAAK,IAAIwe,IAAT,IAAiBuoC,IAAjB,EAAuB;MACrB,IAAIC,IAAI,CAACptB,cAAL,CAAoBpb,IAApB,CAAJ,EAA+B;QAC7B,IAAI,CAACq/B,SAAS,CAACkJ,IAAI,CAACvoC,IAAD,CAAL,EAAawoC,IAAI,CAACxoC,IAAD,CAAjB,EAAyB;UAACyoC,UAAU,EAAVA;QAAD,CAAzB,CAAd,EAAsD;UACpD,OAAO,KAAP;QACD;MACF,CAJD,MAIO;QACL,OAAO,KAAP;MACD;IACF;;IACD,OAAO,IAAP;EACD,CAhBI,MAgBE;IACL,OAAO,KAAP;EACD;AACF;AAEM,SAASr+C,SAAT,CAAmB+3B,MAAnB,EAAuC;EAAA,mCAATumB,OAAS;IAATA,OAAS;EAAA;;EAC5C,IAAI,CAACA,OAAO,CAAClnD,MAAb,EAAqB,OAAO2gC,MAAP;EACrB,IAAM7iB,MAAM,GAAGopC,OAAO,CAACjnD,KAAR,EAAf;;EAEA,IAAI6O,aAAa,CAAC6xB,MAAD,CAAb,IAAyB7xB,aAAa,CAACgP,MAAD,CAA1C,EAAoD;IAAA,2BACvC1I,GADuC;MAEhD,IAAItG,aAAa,CAACgP,MAAM,CAAC1I,GAAD,CAAP,CAAjB,EAAgC;QAC9B,IAAI,CAACurB,MAAM,CAACvrB,GAAD,CAAX,EAAkB9Q,MAAM,CAACC,MAAP,CAAco8B,MAAd,wFAAyBvrB,GAAzB,EAA+B,EAA/B;QAClBxM,SAAS,CAAC+3B,MAAM,CAACvrB,GAAD,CAAP,EAAc0I,MAAM,CAAC1I,GAAD,CAApB,CAAT;MACD,CAHD,MAGO,IAAIzR,OAAO,CAACma,MAAM,CAAC1I,GAAD,CAAP,CAAX,EAA0B;QAC/B,IAAI,CAACurB,MAAM,CAACvrB,GAAD,CAAX,EAAkB;UAChB9Q,MAAM,CAACC,MAAP,CAAco8B,MAAd,wFAAyBvrB,GAAzB,uFAAmC0I,MAAM,CAAC1I,GAAD,CAAzC;QACD,CAFD,MAEO,IAAIzR,OAAO,CAACg9B,MAAM,CAACvrB,GAAD,CAAP,CAAX,EAA0B;UAC/B0I,MAAM,CAAC1I,GAAD,CAAN,CAAYpP,OAAZ,CAAoB,UAAAuY,GAAG,EAAI;YACzB,IAAI4oC,SAAS,GAAG,CAAhB;;YACA,KAAK,IAAIz8C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGi2B,MAAM,CAACvrB,GAAD,CAAN,CAAYpV,MAAhC,EAAwC0K,CAAC,EAAzC,EAA6C;cAC3C,IAAImzC,SAAS,CAACld,MAAM,CAACvrB,GAAD,CAAN,CAAY1K,CAAZ,CAAD,EAAiB6T,GAAjB,CAAb,EAAoC;gBAClC4oC,SAAS,GAAG,CAAZ;gBACA;cACD;YACF;;YACD,IAAIA,SAAJ,EAAe;cACbxmB,MAAM,CAACvrB,GAAD,CAAN,CAAY9W,IAAZ,CAAiBigB,GAAjB;YACD;UACF,CAXD;QAYD;MACF,CAjBM,MAiBA;QACLja,MAAM,CAACC,MAAP,CAAco8B,MAAd,wFAAyBvrB,GAAzB,EAA+B0I,MAAM,CAAC1I,GAAD,CAArC;MACD;IAxB+C;;IAClD,KAAK,IAAMA,GAAX,IAAkB0I,MAAlB,EAA0B;MAAA,MAAf1I,GAAe;IAwBzB;EACF;;EAED,OAAOxM,SAAS,MAAT,UAAU+3B,MAAV,SAAqBumB,OAArB,EAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASE,UAAT,CAAoBvG,GAApB,EAAmC;EAAA,IAAVwG,IAAU,uEAAH,CAAG;;EACxC;EACA;EACA,IAAIC,IAAI,GAAG,SAAPA,IAAO,CAASC,GAAT,EAAcC,GAAd,EAAmB;IAC5B,IAAI1gC,IAAI,CAACzI,IAAI,CAACipC,IAAN,CAAR,EAAqB;MACnB,OAAOjpC,IAAI,CAACipC,IAAL,CAAUC,GAAV,EAAeC,GAAf,CAAP;IACD,CAFD,MAEO;MACLA,GAAG,IAAI,CAAP,CADK,CACK;MACV;MACA;MACA;MACA;;MACA,IAAIrjD,MAAM,GAAG,CAACojD,GAAG,GAAG,UAAP,IAAqBC,GAAlC,CANK,CAOL;MACA;MACA;;MACA,IAAID,GAAG,GAAG,UAAV,EAAsBpjD,MAAM,IAAI,CAACojD,GAAG,GAAG,UAAP,IAAqBC,GAArB,GAA2B,CAArC;MACtB,OAAOrjD,MAAM,GAAG,CAAhB;IACD;EACF,CAhBD;;EAkBA,IAAIsjD,EAAE,GAAG,aAAaJ,IAAtB;EACA,IAAIK,EAAE,GAAG,aAAaL,IAAtB;;EACA,KAAK,IAAI38C,CAAC,GAAG,CAAR,EAAWi9C,EAAhB,EAAoBj9C,CAAC,GAAGm2C,GAAG,CAAC7gD,MAA5B,EAAoC0K,CAAC,EAArC,EAAyC;IACvCi9C,EAAE,GAAG9G,GAAG,CAAC+G,UAAJ,CAAel9C,CAAf,CAAL;IACA+8C,EAAE,GAAGH,IAAI,CAACG,EAAE,GAAGE,EAAN,EAAU,UAAV,CAAT;IACAD,EAAE,GAAGJ,IAAI,CAACI,EAAE,GAAGC,EAAN,EAAU,UAAV,CAAT;EACD;;EACDF,EAAE,GAAGH,IAAI,CAACG,EAAE,GAAIA,EAAE,KAAK,EAAd,EAAmB,UAAnB,CAAJ,GAAqCH,IAAI,CAACI,EAAE,GAAIA,EAAE,KAAK,EAAd,EAAmB,UAAnB,CAA9C;EACAA,EAAE,GAAGJ,IAAI,CAACI,EAAE,GAAIA,EAAE,KAAK,EAAd,EAAmB,UAAnB,CAAJ,GAAqCJ,IAAI,CAACG,EAAE,GAAIA,EAAE,KAAK,EAAd,EAAmB,UAAnB,CAA9C;EACA,OAAO,CAAC,cAAc,UAAUC,EAAxB,KAA+BD,EAAE,KAAK,CAAtC,CAAD,EAA2C/K,QAA3C,EAAP;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASmL,qBAAT,CAA+BtnD,GAA/B,EAAoC;EACzC,OAAQA,GAAD,GAAQA,GAAG,CAAC8hC,WAAZ,GAA0B,IAAjC;AACD;AAED;AACA;AACA;AACA;AACA;;AACO,SAASylB,aAAT,CAAuBnmD,IAAvB,EAA6B;EAClC,IAAI;IACF,OAAOsQ,IAAI,CAACgB,KAAL,CAAWtR,IAAX,CAAP;EACD,CAFD,CAEE,OAAOgK,CAAP,EAAU,CAAE;AACf;AAED;AACA;AACA;AACA;AACA;;AACO,SAAS0M,mBAAT,CAA6Bmb,MAA7B,EAAqCnc,UAArC,EAAiD;EACtD,KAAK,IAAIjC,GAAT,IAAgBiC,UAAhB,EAA4B;IAC1B,IAAIA,UAAU,CAACuiB,cAAX,CAA0BxkB,GAA1B,CAAJ,EAAoC;MAClCoe,MAAM,CAACu0B,YAAP,CAAoB3yC,GAApB,EAAyBiC,UAAU,CAACjC,GAAD,CAAnC;IACD;EACF;AACF;AAED;AACA;AACA;AACA;AACA;AACA;;AACO,IAAM4yC,iBAAiB,GAAI,YAAM;EACtC,IAAMC,OAAO,GAAG;IACd,KAAK,SADS;IAEd,KAAK,SAFS;IAGd,KAAK,SAHS;IAId,MAAM,MAJQ;IAKd,MAAM,KALQ;IAMd,MAAM,KANQ;IAOd,MAAM,KAPQ;IAQd,MAAM,KARQ;IASd,MAAM,KATQ;IAUd,MAAM,KAVQ;IAWd,UAAU,SAXI;IAYd,UAAU;EAZI,CAAhB;EAeA,OAAO,UAASpH,GAAT,EAAc;IACnB,OAAOA,GAAG,CAACjO,OAAJ,CAAY,iCAAZ,EAA+C,UAAAp6B,CAAC;MAAA,OAAIyvC,OAAO,CAACzvC,CAAD,CAAX;IAAA,CAAhD,CAAP;EACD,CAFD;AAGD,CAnBgC,EAA1B;;;;;;;;;;;;;;;;;;;;;;;;;;;ACt3CP;AACO,IAAM0vC,aAAa,GAAG,oBAAtB;AACP,IAAMzE,OAAO,GAAG9qC,MAAM,CAACgrC,WAAP,IAAsBhrC,MAAM,CAACgrC,WAAP,CAAmB5mC,GAAzC,GAA+C;EAAA,OAAMpE,MAAM,CAACgrC,WAAP,CAAmB5mC,GAAnB,EAAN;AAAA,CAA/C,GAAgF;EAAA,OAAMD,IAAI,CAACC,GAAL,EAAN;AAAA,CAAhG;AACA,IAAMorC,KAAK,GAAG,IAAIhxC,OAAJ,EAAd;AAEO,SAASixC,cAAT,GAAqI;EAAA,+EAAJ,EAAI;EAAA,oBAA5GrrC,GAA4G;EAAA,IAA5GA,GAA4G,yBAAtG0mC,OAAsG;EAAA,uBAA7F4E,MAA6F;EAAA,IAA7FA,MAA6F,4BAApFC,QAAoF;EAAA,wBAA1EC,OAA0E;EAAA,IAA1EA,OAA0E,6BAAhEC,SAAgE;EAAA,0BAArDC,SAAqD;EAAA,IAArDA,SAAqD,+BAAzC,UAACC,MAAD;IAAA,OAAYA,MAAZ;EAAA,CAAyC;EAAA,sBAArBC,KAAqB;EAAA,IAArBA,KAAqB,2BAAbR,KAAa;;EAC1I,OAAO,SAAS1gB,UAAT,GAAsB;IAC3B,SAASmhB,WAAT,CAAqB1K,IAArB,EAAuE;MAAA,IAA5CwK,MAA4C,uEAAnC,UAACzxC,CAAD;QAAA,OAAQ;UAACjR,OAAD,mBAASrG,EAAT,EAAa;YAAEA,EAAE,CAACsX,CAAD,CAAF;UAAQ;QAAvB,CAAR;MAAA,CAAmC;MACrEyxC,MAAM,GAAGD,SAAS,CAACC,MAAD,CAAlB;;MAEA,SAASn6B,QAAT,CAAkB0f,IAAlB,EAAwB;QACtB,OAAO,UAAUpX,IAAV,EAAgB;UACrB,OAAOqnB,IAAI,CAAC2K,MAAL,CAAY;YACjBC,KADiB,iBACXC,IADW,EACLpjB,IADK,EACC;cAChB,IAAMpnB,GAAG,GAAGonB,IAAI,CAACsI,IAAD,CAAhB;;cACA,IAAI1vB,GAAG,CAACqb,cAAJ,CAAmB/C,IAAnB,CAAJ,EAA8B;gBAC5B,OAAOtY,GAAG,CAACsY,IAAD,CAAV;cACD;YACF;UANgB,CAAZ,CAAP;QAQD,CATD;MAUD;;MAED,IAAMmyB,YAAY,GAAGz6B,QAAQ,CAAC,YAAD,CAA7B;MAEA;AACN;AACA;AACA;AACA;AACA;;MACM,SAAS06B,SAAT,CAAmBpyB,IAAnB,EAAyBtd,KAAzB,EAAgC;QAC9B,IAAM2vC,KAAK,GAAGR,MAAM,CAAC7xB,IAAD,CAApB;QACAqnB,IAAI,CAAC2K,MAAL,CAAY;UACVM,MADU,kBACHC,MADG,EACKC,OADL,EACc;YACtB,OAAOA,OAAO,CAACC,SAAR,KAAsB,CAACF,MAAD,IAAW,CAACA,MAAM,CAACG,eAAzC,CAAP;UACD,CAHS;UAIVT,KAJU,iBAIJC,IAJI,EAIEpjB,IAJF,EAIQ;YAChBujB,KAAK,CAACljD,OAAN,CAAc,UAAA6wB,IAAI,EAAI;cACpB,IAAIkyB,IAAI,IAAI,IAAZ,EAAkB;gBAChBpjB,IAAI,CAAC1hC,OAAL,CAAa4yB,IAAb,IAAqBtd,KAArB;cACD,CAFD,MAEO;gBACL,IAAI,CAACosB,IAAI,CAAC6jB,MAAL,CAAY5vB,cAAZ,CAA2B/C,IAA3B,CAAL,EAAuC;kBACrC8O,IAAI,CAAC6jB,MAAL,CAAY3yB,IAAZ,IAAoB,EAApB;gBACD;;gBACD8O,IAAI,CAAC6jB,MAAL,CAAY3yB,IAAZ,EAAkBv4B,IAAlB,CAAuBib,KAAvB;cACD;YACF,CATD;UAUD;QAfS,CAAZ;MAiBD;MAED;AACN;AACA;AACA;AACA;AACA;;;MACM,SAASpK,UAAT,CAAoB0nB,IAApB,EAA0B;QACxBqnB,IAAI,CAACuL,UAAL,CAAgB5yB,IAAhB,IAAwB9Z,GAAG,EAA3B;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;;;MACM,SAASoE,SAAT,CAAmBhS,UAAnB,EAA+Bu6C,MAA/B,EAAuC;QACrC,IAAMC,EAAE,GAAGX,YAAY,CAAC75C,UAAD,CAAvB;QACA,IAAMy6C,OAAO,GAAGD,EAAE,IAAI,IAAN,GAAa5sC,GAAG,KAAK4sC,EAArB,GAA0B,IAA1C;;QACA,IAAID,MAAM,IAAI,IAAd,EAAoB;UAClBT,SAAS,CAACS,MAAD,EAASE,OAAT,CAAT;QACD;;QACD,OAAOA,OAAP;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;;MACM,SAAS5sC,WAAT,CAAqB6sC,eAArB,EAAsCC,aAAtC,EAAqDJ,MAArD,EAA6D;QAC3D,IAAMt+C,KAAK,GAAG49C,YAAY,CAACa,eAAD,CAA1B;QACA,IAAM7D,GAAG,GAAGgD,YAAY,CAACc,aAAD,CAAxB;QACA,IAAMF,OAAO,GAAGx+C,KAAK,IAAI,IAAT,IAAiB46C,GAAG,IAAI,IAAxB,GAA+BA,GAAG,GAAG56C,KAArC,GAA6C,IAA7D;;QACA,IAAIs+C,MAAM,IAAI,IAAd,EAAoB;UAClBT,SAAS,CAACS,MAAD,EAASE,OAAT,CAAT;QACD;;QACD,OAAOA,OAAP;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MAEM;AACN;AACA;AACA;AACA;AACA;;;MACM,SAASx3C,WAAT,CAAqBykB,IAArB,EAA2B;QACzB,OAAO0xB,OAAO,CAACxrC,GAAD,EAAM,UAAC3X,GAAD;UAAA,OAAS6jD,SAAS,CAACpyB,IAAD,EAAOzxB,GAAP,CAAlB;QAAA,CAAN,CAAd;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;;MACM,SAASgK,WAAT,CAAqBynB,IAArB,EAA2Bl3B,EAA3B,EAA+B;QAC7B,OAAOyS,WAAW,CAACykB,IAAD,CAAX,CAAkBkzB,SAAlB,CAA4BpqD,EAA5B,GAAP;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;MAEM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;MACM,SAASqqD,eAAT,CAAyBnzB,IAAzB,EAA+B5C,IAA/B,EAAqCt0B,EAArC,EAAyC;QACvC,IAAMsqD,UAAU,GAAG73C,WAAW,CAACykB,IAAD,CAA9B;QACA,OAAOl3B,EAAE,CAAE,UAAUuqD,IAAV,EAAgB;UACzB,IAAMj2B,IAAI,GAAGg2B,UAAU,CAAC53C,UAAX,CAAsB63C,IAAtB,CAAb;UACAj2B,IAAI,CAACk2B,IAAL,GAAYD,IAAI,CAACC,IAAL,IAAaF,UAAU,CAAC53C,UAAX,CAAsB63C,IAAI,CAACC,IAA3B,CAAzB;UACAl2B,IAAI,CAACg2B,UAAL,GAAkBA,UAAlB;UACAh2B,IAAI,CAACm2B,OAAL,GAAeF,IAAf;UACA,OAAOj2B,IAAP;QACD,CANS,CAMPA,IANO,CAAD,CAAT;MAOD;MAED;AACN;AACA;AACA;;;MACM,SAAS1U,UAAT,GAAsB;QACpB,IAAIpb,MAAM,GAAG,EAAb;QACA+5C,IAAI,CAAC2K,MAAL,CAAY;UACVC,KADU,iBACJC,IADI,EACEpjB,IADF,EACQ;YAChBxhC,MAAM,GAAGG,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,CAACwkD,IAAD,IAASA,IAAI,CAACsB,aAAd,GAA8B1kB,IAAI,CAAC6jB,MAAnC,GAA4C,IAA9D,EAAoE7jB,IAAI,CAAC1hC,OAAzE,EAAkFE,MAAlF,CAAT;UACD;QAHS,CAAZ;QAKA,OAAOA,MAAP;MACD;MAED;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;MACM,SAAS6E,IAAT,GAAuF;QAAA,gFAAJ,EAAI;QAAA,4BAAxEsgD,SAAwE;QAAA,IAAxEA,SAAwE,gCAA5D,IAA4D;QAAA,kCAAtDC,eAAsD;QAAA,IAAtDA,eAAsD,sCAApC,KAAoC;QAAA,gCAA7Bc,aAA6B;QAAA,IAA7BA,aAA6B,oCAAb,KAAa;;QACrF,OAAOzB,WAAW,CAACP,MAAM,CAAC,CAAC,CAACnK,IAAD,EAAO;UAACoL,SAAS,EAATA,SAAD;UAAYC,eAAe,EAAfA,eAAZ;UAA6Bc,aAAa,EAAbA;QAA7B,CAAP,CAAD,CAAD,CAAP,EAAgE3B,MAAhE,CAAlB;MACD;MAED;AACN;AACA;AACA;AACA;AACA;;;MACM,SAASn9C,IAAT,CAAc++C,YAAd,EAAqG;QAAA,gFAAJ,EAAI;QAAA,4BAAxEhB,SAAwE;QAAA,IAAxEA,SAAwE,gCAA5D,IAA4D;QAAA,kCAAtDC,eAAsD;QAAA,IAAtDA,eAAsD,sCAApC,KAAoC;QAAA,gCAA7Bc,aAA6B;QAAA,IAA7BA,aAA6B,oCAAb,KAAa;;QACnG,IAAME,KAAK,GAAG5B,KAAK,CAACn1C,GAAN,CAAU82C,YAAV,CAAd;;QACA,IAAIC,KAAK,IAAI,IAAb,EAAmB;UACjBA,KAAK,CAACC,SAAN,CAAgBtM,IAAhB,EAAsB;YAACoL,SAAS,EAATA,SAAD;YAAYC,eAAe,EAAfA,eAAZ;YAA6Bc,aAAa,EAAbA;UAA7B,CAAtB;QACD;MACF;MAED;AACN;AACA;AACA;AACA;;;MACM,SAASz3C,UAAT,CAAoB63C,QAApB,EAA8B;QAC5B,OAAO7B,WAAW,CAAC1K,IAAD,EAAOuM,QAAP,CAAlB;MACD;MAED;AACN;AACA;;;MACM,SAAShjB,UAAT,GAAsB;QACpB,OAAOmhB,WAAW,CAAC1K,IAAI,CAACwM,UAAL,EAAD,EAAoBhC,MAApB,CAAlB;MACD;;MAED,IAAMzkD,OAAO,GAAG;QACdmO,WAAW,EAAXA,WADc;QAEdhD,WAAW,EAAXA,WAFc;QAGd46C,eAAe,EAAfA,eAHc;QAId76C,UAAU,EAAVA,UAJc;QAKdgS,SAAS,EAATA,SALc;QAMdnE,WAAW,EAAXA,WANc;QAOdisC,SAAS,EAATA,SAPc;QAQd1pC,UAAU,EAAVA,UARc;QASdvW,IAAI,EAAJA,IATc;QAUduC,IAAI,EAAJA,IAVc;QAWdk8B,UAAU,EAAVA,UAXc;QAYd70B,UAAU,EAAVA,UAZc;QAad+3C,MAbc,oBAaL;UACP,OAAOprC,UAAU,EAAjB;QACD;MAfa,CAAhB;MAiBAopC,KAAK,CAAC/wC,GAAN,CAAU3T,OAAV,EAAmBi6C,IAAnB;MACA,OAAOj6C,OAAP;IACD;;IAED,OAAO2kD,WAAW,CAACP,MAAM,CAAC,EAAD,CAAP,CAAlB;EACD,CAlRD;AAmRD;;AAED,SAASuC,MAAT,CAAgBjrD,EAAhB,EAAoBiW,MAApB,EAA4Bm6B,KAA5B,EAAmC;EACjC,OAAO,YAAY;IACjBn6B,MAAM,IAAIA,MAAM,EAAhB;;IACA,IAAI;MACF,OAAOjW,EAAE,CAACX,KAAH,CAAS,IAAT,EAAeH,SAAf,CAAP;IACD,CAFD,SAEU;MACRkxC,KAAK,IAAIA,KAAK,EAAd;IACD;EACF,CAPD;AAQD;;AAED,SAASyY,SAAT,CAAmBzrC,GAAnB,EAAwB2F,EAAxB,EAA4B;EAC1B,IAAMtX,KAAK,GAAG2R,GAAG,EAAjB;EACA,IAAIlS,IAAI,GAAG,KAAX;;EACA,SAASo/C,UAAT,GAAsB;IACpB,IAAI,CAACp/C,IAAL,EAAW;MACT;MACA6X,EAAE,CAAC3F,GAAG,KAAK3R,KAAT,CAAF;MACAP,IAAI,GAAG,IAAP;IACD;EACF;;EACDo/C,UAAU,CAAC53C,UAAX,GAAwB,UAAC1S,EAAD;IAAA,OAAQirD,MAAM,CAACjrD,EAAD,EAAKsqD,UAAL,CAAd;EAAA,CAAxB;;EACAA,UAAU,CAACF,SAAX,GAAuB,UAACpqD,EAAD;IAAA,OAAQirD,MAAM,CAACjrD,EAAD,EAAK,IAAL,EAAWsqD,UAAX,CAAd;EAAA,CAAvB;;EACA,OAAOA,UAAP;AACD;;AAED,SAAS3B,QAAT,CAAkBuC,OAAlB,EAA2B;EACzB,OAAO;IACL5mD,OAAO,EAAE,EADJ;IAELwlD,UAAU,EAAE,EAFP;IAGLD,MAAM,EAAE,EAHH;IAILgB,SAJK,qBAIK7kB,IAJL,EAIWojB,IAJX,EAIiB;MACpB8B,OAAO,CAACvsD,IAAR,CAAa,CAACqnC,IAAD,EAAOojB,IAAP,CAAb;IACD,CANI;IAOL2B,UAPK,wBAOQ;MACX,OAAOpC,QAAQ,CAACuC,OAAO,CAAC7kC,KAAR,EAAD,CAAf;IACD,CATI;IAUL6iC,MAVK,oBAUkE;MAAA,gFAAJ,EAAI;MAAA,IAA/DC,KAA+D,SAA/DA,KAA+D;MAAA,yBAAxDK,MAAwD;MAAA,IAAxDA,MAAwD,6BAA/C;QAAA,OAAM,IAAN;MAAA,CAA+C;MAAA,0BAAnC2B,OAAmC;MAAA,IAAnCA,OAAmC,8BAAzB,IAAIhkD,GAAJ,EAAyB;MAAA,IAAdsiD,MAAc,SAAdA,MAAc;;MACrE,IAAIx6B,GAAJ;;MACA,IAAI,CAACk8B,OAAO,CAACnlD,GAAR,CAAY,IAAZ,CAAL,EAAwB;QACtBmlD,OAAO,CAAC5jD,GAAR,CAAY,IAAZ;QACA0nB,GAAG,GAAGk6B,KAAK,CAACM,MAAD,EAAS,IAAT,CAAX;QACA,IAAIx6B,GAAG,IAAI,IAAX,EAAiB,OAAOA,GAAP;;QAHK,2CAIUi8B,OAJV;QAAA;;QAAA;UAItB,oDAAyC;YAAA;YAAA,IAA7Blf,MAA6B;YAAA,IAArB0d,OAAqB;;YACvC,IAAIF,MAAM,CAACC,MAAD,EAASC,OAAT,CAAV,EAA6B;cAC3Bz6B,GAAG,GAAG+c,MAAM,CAACkd,MAAP,CAAc;gBAACC,KAAK,EAALA,KAAD;gBAAQK,MAAM,EAANA,MAAR;gBAAgB2B,OAAO,EAAPA,OAAhB;gBAAyB1B,MAAM,EAAEC;cAAjC,CAAd,CAAN;cACA,IAAIz6B,GAAG,IAAI,IAAX,EAAiB,OAAOA,GAAP;YAClB;UACF;QATqB;UAAA;QAAA;UAAA;QAAA;MAUvB;IACF;EAvBI,CAAP;AAyBD;;AAED,IAAMm8B,WAAW,GAAI,YAAM;EACzB,IAAMC,GAAG,GAAG,SAANA,GAAM,GAAY,CAAE,CAA1B;;EACA,IAAMC,KAAK,GAAG,SAARA,KAAQ;IAAA,OAAO,EAAP;EAAA,CAAd;;EACA,IAAMC,IAAI,GAAG;IAACllD,OAAO,EAAEglD;EAAV,CAAb;;EACA,IAAMG,SAAS,GAAG,SAAZA,SAAY;IAAA,OAAM,IAAN;EAAA,CAAlB;;EACAA,SAAS,CAAC94C,UAAV,GAAuB,UAAC1S,EAAD;IAAA,OAAQA,EAAR;EAAA,CAAvB;;EACAwrD,SAAS,CAACpB,SAAV,GAAsB,UAACpqD,EAAD;IAAA,OAAQA,EAAR;EAAA,CAAtB;;EACA,IAAMyrD,QAAQ,GAAG9mD,MAAM,CAAC8yB,gBAAP,CACf;IAACyxB,MAAM,EAAEmC,GAAT;IAAcN,UAAU,EAAE;MAAA,OAAMU,QAAN;IAAA,CAA1B;IAA0CZ,SAAS,EAAEQ;EAArD,CADe,EAEf1mD,MAAM,CAAC+yB,WAAP,CAAmB,CAAC,SAAD,EAAY,YAAZ,EAA0B,QAA1B,EAAoCpxB,GAApC,CAAwC,UAAAuY,IAAI;IAAA,OAAI,CAACA,IAAD,EAAO;MAAChL,GAAG,EAAEy3C;IAAN,CAAP,CAAJ;EAAA,CAA5C,CAAnB,CAFe,CAAjB;EAGA,OAAO7C,cAAc,CAAC;IACpBrrC,GAAG,EAAE;MAAA,OAAM,CAAN;IAAA,CADe;IAEpBsrC,MAAM,EAAE;MAAA,OAAM+C,QAAN;IAAA,CAFY;IAGpB3C,SAAS,EAAE;MAAA,OAAM;QAAA,OAAMyC,IAAN;MAAA,CAAN;IAAA,CAHS;IAIpB3C,OAAO,EAAE;MAAA,OAAM4C,SAAN;IAAA,CAJW;IAKpBxC,KAAK,EAAE;MAACn1C,GAAG,EAAEw3C,GAAN;MAAWpzC,GAAG,EAAEozC;IAAhB;EALa,CAAD,CAAd,EAAP;AAOD,CAjBmB,EAApB;;AAmBA,IAAIhkD,OAAO,GAAG,IAAd;AACAlJ,wDAAA,CAAiBoqD,aAAjB,EAAgC,UAAC5gB,GAAD,EAAS;EAAEtgC,OAAO,GAAG,CAAC,CAACsgC,GAAG,CAAC4gB,aAAD,CAAf;AAAgC,CAA3E;AAEA;AACA;AACA;;AACO,SAASrgD,UAAT,CAAoB5D,OAApB,EAA6B;EAClC,OAAQ+C,OAAO,IAAI/C,OAAZ,IAAwB8mD,WAA/B;AACD;AAEM,IAAMtjB,UAAU,GAAI,YAAM;EAC/B,IAAMmhB,WAAW,GAAGR,cAAc,EAAlC;EACA,OAAO,YAAY;IACjB,OAAOphD,OAAO,GAAG4hD,WAAW,EAAd,GAAmBmC,WAAjC;EACD,CAFD;AAGD,CALyB,EAAnB;AAOA,SAASM,SAAT,CAAmBvL,MAAnB,EAA2BvgC,UAA3B,EAAuC;EAC5C,OAAO,UAASsX,IAAT,EAAeJ,MAAf,EAAuB;IAC5B,OAAO,UAAUxC,IAAV,EAAyB;MAAA,kCAAN9D,IAAM;QAANA,IAAM;MAAA;;MAC9B,IAAMm7B,IAAI,GAAG,IAAb;MACA,OAAOzjD,UAAU,CAAC0X,UAAU,CAACvgB,KAAX,CAAiBssD,IAAjB,EAAuBn7B,IAAvB,CAAD,CAAV,CAAyC65B,eAAzC,CAAyDlK,MAAM,GAAGjpB,IAAlE,EAAwE5C,IAAxE,EAA8E,UAAUA,IAAV,EAAgB;QACnG,OAAOwC,MAAM,CAACh4B,IAAP,OAAAg4B,MAAM,GAAM60B,IAAN,EAAYr3B,IAAZ,SAAqB9D,IAArB,EAAb;MACD,CAFM,CAAP;IAGD,CALD;EAMD,CAPD;AAQD;AAEM,IAAMo7B,gBAAgB,GAAGF,SAAS,CAAC,cAAD,EAAiB,UAACzjC,GAAD;EAAA,OAASA,GAAG,CAAC3jB,OAAb;AAAA,CAAjB,CAAlC;AACA,IAAMunD,oBAAoB,GAAGH,SAAS,CAAC,iBAAD,EAAoB,UAAC9jB,CAAD,EAAIjnC,GAAJ;EAAA,OAAYA,GAAG,CAAC2D,OAAhB;AAAA,CAApB,CAAtC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjYP;AAEA,IAAMwnD,OAAO,GAAG,CAAhB;AACA,IAAMC,IAAI,GAAG,CAAb;AAEA;AACA;AACA;;;;;;;;AACO,IAAM3rC,aAAb;EAAA;;EAAA;;EAiBE,uBAAY4rC,QAAZ,EAAsB;IAAA;;IAAA;;IACpB,IAAMxnD,MAAM,GAAG,EAAf;IACA,IAAMqT,SAAS,GAAG,EAAlB;;IACA,SAASqe,OAAT,CAAiB9hB,IAAjB,EAAuB63C,SAAvB,EAAkC;MAChC,OAAO,UAAUryC,KAAV,EAAiB;QACtB,IAAI,CAACpV,MAAM,CAACnE,MAAZ,EAAoB;UAClBmE,MAAM,CAAC7F,IAAP,CAAYyV,IAAZ,EAAkBwF,KAAlB;;UACA,OAAO/B,SAAS,CAACxX,MAAjB;YAAyBwX,SAAS,CAACvX,KAAV;UAAzB;;UACA2rD,SAAS,CAACryC,KAAD,CAAT;QACD;MACF,CAND;IAOD;;IACD,0BACE,OAAOoyC,QAAP,KAAoB,UAApB,GACIA,QADJ,CACa;IADb,EAEI,UAACh7B,OAAD,EAAU+C,MAAV,EAAqB;MACrB,IAAMm4B,aAAa,GAAGh2B,OAAO,CAAC61B,IAAD,EAAOh4B,MAAP,CAA7B;;MACA,IAAMo4B,cAAc,GAAI,YAAM;QAC5B,IAAMjhD,IAAI,GAAGgrB,OAAO,CAAC41B,OAAD,EAAU96B,OAAV,CAApB;QACA,OAAO,UAAApX,KAAK;UAAA,OACV,QAAOA,KAAP,aAAOA,KAAP,uBAAOA,KAAK,CAAEyG,IAAd,MAAuB,UAAvB,GAAoCzG,KAAK,CAACyG,IAAN,CAAWnV,IAAX,EAAiBghD,aAAjB,CAApC,GAAsEhhD,IAAI,CAAC0O,KAAD,CADhE;QAAA,CAAZ;MAED,CAJsB,EAAvB;;MAKA,IAAI;QACFoyC,QAAQ,CAACG,cAAD,EAAiBD,aAAjB,CAAR;MACD,CAFD,CAEE,OAAOlgD,CAAP,EAAU;QACVkgD,aAAa,CAAClgD,CAAD,CAAb;MACD;IACF,CAfL;;IAZoB;MAAA;MAAA;IAAA;;IAAA;MAAA;MAAA;IAAA;;IAAA;MAAA;MAAA,OAdZ;IAcY;;IA6BpB,kMAAexH,MAAf;;IACA,qMAAkBqT,SAAlB;;IA9BoB;EA+BrB;;EAhDH;IAAA;IAAA,OAiDE,cAAK3E,SAAL,EAAgBrC,OAAhB,EAAyB;MAAA;;MACvB,IAAI,OAAOA,OAAP,KAAmB,UAAvB,EAAmC;QACjC;QACA;QACA;QACA;QACA,IAAIm1B,IAAI,GAAG,IAAX;;QACA,OAAOA,IAAP,EAAa;UACX,iMAAWlnC,IAAX,CAAgBknC,IAAhB,EAAsB,IAAtB,EAA4B;YAAA,OAAM,IAAN;UAAA,CAA5B;;UACA,IAAM1R,IAAI,GAAG,wFAAA0R,IAAH,UAAV;;UACA,wFAAAA,IAAI,WAAW,IAAX,CAAJ,CAHW,CAGU;;;UACrBA,IAAI,GAAG1R,IAAP;QACD;MACF;;MACD,IAAM9vB,MAAM,GAAG,4FAAH,UAAZ;;MACA,IAAMyqB,GAAG,GAAG,IAAI7O,aAAJ,CAAkB,UAAC4Q,OAAD,EAAU+C,MAAV,EAAqB;QACjD,IAAMq4B,YAAY,GAAG,SAAfA,YAAe,GAAM;UACzB,IAAIxyC,KAAK,GAAGpV,MAAM,CAAC,CAAD,CAAlB;;UACA,YAA2BA,MAAM,CAAC,CAAD,CAAN,KAAcsnD,OAAd,GAAwB,CAAC54C,SAAD,EAAY8d,OAAZ,CAAxB,GAA+C,CAACngB,OAAD,EAAUkjB,MAAV,CAA1E;UAAA;UAAA,IAAKmC,OAAL;UAAA,IAAc+1B,SAAd;;UACA,IAAI,OAAO/1B,OAAP,KAAmB,UAAvB,EAAmC;YACjC,IAAI;cACFtc,KAAK,GAAGsc,OAAO,CAACtc,KAAD,CAAf;YACD,CAFD,CAEE,OAAO5N,CAAP,EAAU;cACV+nB,MAAM,CAAC/nB,CAAD,CAAN;cACA;YACD;;YACDigD,SAAS,GAAGj7B,OAAZ;UACD;;UACDi7B,SAAS,CAACryC,KAAD,CAAT;QACD,CAbD;;QAcApV,MAAM,CAACnE,MAAP,GAAgB+rD,YAAY,EAA5B,GAAiC,8FAAI,aAAJ,CAAgBztD,IAAhB,CAAqBytD,YAArB,CAAjC;MACD,CAhBW,CAAZ;;MAiBA,wFAAAn9B,GAAG,WAAW,IAAX,CAAH;;MACA,OAAOA,GAAP;IACD;EAnFH;IAAA;IAAA;IAKE;AACF;AACA;AACA;AACA;AACA;IACE,mBAA4B;MAAA,IAAbo9B,OAAa,uEAAH,CAAG;MAC1B,OAAO,IAAIjsC,aAAJ,CAAkB,UAAC4Q,OAAD,EAAa;QACpCq7B,OAAO,KAAK,CAAZ,GAAgBr7B,OAAO,EAAvB,GAA4BjU,UAAU,CAACiU,OAAD,EAAUq7B,OAAV,CAAtC;MACD,CAFM,CAAP;IAGD;EAfH;;EAAA;AAAA,EAAoC5iC,4DAAS,GAAG6iC,OAAZ,IAAuBA,OAA3D;AAsFA;AACA;AACA;;AACO,SAAS17B,KAAT,GAAkF;EAAA,gFAAJ,EAAI;EAAA,iCAAlE27B,cAAkE;EAAA,IAAlEA,cAAkE,qCAAjD,UAACP,QAAD;IAAA,OAAc,IAAI5rC,aAAJ,CAAkB4rC,QAAlB,CAAd;EAAA,CAAiD;;EACvF,SAASQ,OAAT,CAAiB/kB,QAAjB,EAA2B;IACzB,OAAO,UAAChiC,GAAD;MAAA,OAASgiC,QAAQ,CAAChiC,GAAD,CAAjB;IAAA,CAAP;EACD;;EAED,IAAIwmD,SAAJ,EAAeQ,QAAf;EAEA,OAAO;IACL37B,OAAO,EAAEy7B,cAAc,CAAC,UAACv7B,OAAD,EAAU+C,MAAV,EAAqB;MAC3Ck4B,SAAS,GAAGj7B,OAAZ;MACAy7B,QAAQ,GAAG14B,MAAX;IACD,CAHsB,CADlB;IAKL/C,OAAO,EAAEw7B,OAAO,CAACP,SAAD,CALX;IAMLl4B,MAAM,EAAEy4B,OAAO,CAACC,QAAD;EANV,CAAP;AAQD;;;;;;;;;;;;;;;;;;;;;;;;;AChHD;AACA;AACA;AACA;AACA;AACA;AAEA,IAAMC,gBAAgB,GAAG,OAAzB;AACO,IAAM9qC,SAAS,GAAG,WAAlB;AACA,IAAM+qC,QAAQ,GAAG,UAAjB;AAEP;AACA;AACA;;AACO,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAAA3rD,MAAM,EAAI;EACnC,IAAMkW,SAAS,GAAGlW,MAAM,CAACkW,SAAP,KAAqBu1C,gBAAvC;EACA,IAAM5nD,UAAU,GAAGzD,qDAAU,CAACJ,MAAD,EAAS,kBAAT,CAA7B;EACA,OAAOkW,SAAS,IAAIrS,UAApB;AACD,CAJM;AAKA,IAAM+nD,WAAW,GAAG,SAAdA,WAAc,CAAAlsD,GAAG;EAAA,OAAIgL,sDAAQ,CAAClI,wEAAD,EAA+B9C,GAAG,CAACoC,MAAnC,CAAZ;AAAA,CAAvB;AACA,IAAM+pD,iBAAiB,GAAG,SAApBA,iBAAoB,CAAA7rD,MAAM;EAAA,OACrCA,MAAM,CAACwD,IAAP,CAAYC,MAAZ,CAAmB,UAAA/D,GAAG;IAAA,OAAI,CAACksD,WAAW,CAAClsD,GAAD,CAAhB;EAAA,CAAtB,EAA6CN,MADR;AAAA,CAAhC;AAGP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AACO,SAASgX,eAAT,CAAyB1W,GAAzB,EAAmE;EAAA,+EAAJ,EAAI;EAAA,sBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,2BAA5BuL,oEAA4B;;EACxE,IAAMoL,cAAc,GAAGpgB,qDAAU,CAACyJ,KAAK,CAAC4L,aAAN,CAAoB/V,GAApB,CAAD,EAA2B,OAA3B,CAAjC;EACA,IAAMqd,OAAO,GAAGyD,cAAc,IAAIpgB,qDAAU,CAACogB,cAAD,EAAiB,SAAjB,CAA5C;EACA,IAAME,WAAW,GAAGF,cAAc,IAAIpgB,qDAAU,CAACogB,cAAD,EAAiB,aAAjB,CAAhD;EACA,IAAMxgB,MAAM,GAAG6J,KAAK,CAACwY,SAAN,CAAgB3iB,GAAhB,CAAf,CAJwE,CAMxE;EACA;;EACA,OAAOosD,kBAAkB,CAACpsD,GAAD,EAAMM,MAAN,EAAcwgB,cAAd,EAA8BzD,OAA9B,EAAuC2D,WAAvC,CAAzB;AACD;AAEM,IAAMorC,kBAAkB,GAAGpnD,8CAAI,CAAC,MAAD,EAAS,UAAShF,GAAT,EAAcM,MAAd,EAAsBwgB,cAAtB,EAAsCzD,OAAtC,EAA+C2D,WAA/C,EAA4D;EACzG,IAAIF,cAAc,KAAKE,WAAW,IAAI3D,OAAO,KAAK4D,SAAhC,CAAlB,EAA8D;IAC5D;IACA,IAAI,CAACzjB,4DAAA,CAAiB,WAAjB,CAAD,IAAkCwC,GAAG,CAACqsD,OAAtC,IAAiD,CAACrsD,GAAG,CAACohB,OAA1D,EAAmE;MACjEljB,mDAAQ,mMAAR;MAIA,OAAO,KAAP;IACD;;IAED,OAAO,CAAC,EAAE8B,GAAG,CAACohB,OAAJ,IAAephB,GAAG,CAACqsD,OAArB,CAAR;EACD,CAZwG,CAczG;;;EACA,IAAIhvC,OAAO,KAAK4D,SAAZ,IAAyB,CAACD,WAA9B,EAA2C;IACzC,OAAO,CAAC,EAAEhhB,GAAG,CAACF,QAAJ,IAAiBQ,MAAM,IAAIA,MAAM,CAACR,QAAlC,IAA+CghB,cAAc,CAAChhB,QAAhE,CAAR;EACD;;EAED,OAAO,IAAP;AACD,CApBqC,EAoBnC,oBApBmC,CAA/B;;;;;;;;;;;;;;;;;;AC7CP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;;AACA,IAAMwsD,kBAAkB,GAAG,EAA3B;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAASC,OAAT,CAAiBC,GAAjB,EAAsBC,MAAtB,EAA8B;EAC5B;EACA;EACA;EACA,IAAIC,OAAO,GAAID,MAAD,sBAAuBA,MAAvB,aAAd;EACA,oJAI+BD,GAJ/B,qDAKoBE,OALpB;AAUD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,gBAAT,CAA0B3sD,GAA1B,EAAoE;EAAA,+EAAJ,EAAI;EAAA,sBAApCmK,KAAoC;EAAA,IAApCA,KAAoC,2BAA5BuL,oEAA4B;;EAClE,IAAMk3C,SAAS,GAAG5sD,GAAG,CAACqsD,OAAJ,GAAcrsD,GAAG,CAACqsD,OAAlB,GAA4BE,OAAO,CAACvsD,GAAG,CAACohB,OAAL,EAAcphB,GAAG,CAAC6sD,UAAlB,CAArD;EACA,IAAM1lC,OAAO,GAAGhd,KAAK,CAAC+c,UAAN,CAAiBlnB,GAAjB,CAAhB;EACA,IAAM8sD,aAAa,GAAGhjD,MAAM,CAAC9J,GAAG,CAACgzC,GAAL,CAAN,GAAkBsZ,kBAAxC;EACA,IAAIS,OAAO,GAAG;IACZt5C,IAAI,EAAE,KADM;IAEZwF,KAAK,EAAE2zC,SAFK;IAGZI,UAAU,EAAEF;EAHA,CAAd;;EAMA,IAAItvD,wDAAA,CAAiB,iBAAjB,CAAJ,EAAyC;IACvCuvD,OAAO,CAAC3qD,MAAR,GAAiBpC,GAAG,CAACoC,MAArB;IACA2qD,OAAO,CAACE,KAAR,GAAgBjtD,GAAG,CAACsQ,SAApB;IACAy8C,OAAO,CAACG,GAAR,GAAcltD,GAAG,CAACwD,SAAlB;EACD;;EAED,IAAI2jB,OAAO,IAAI,IAAf,EAAqB;IACnB4lC,OAAO,CAAChiD,SAAR,GAAoBoc,OAAO,CAAC5I,eAAR,EAApB;EACD;;EAED,IAAI,OAAOve,GAAG,CAACmtD,cAAX,KAA8B,QAA9B,IAA0CntD,GAAG,CAACmtD,cAAJ,KAAuB,EAArE,EAAyE;IACvEJ,OAAO,CAACj4C,GAAR,GAAc9U,GAAG,CAACmtD,cAAlB;EACD;;EAED,OAAOJ,OAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASK,mBAAT,CAA6B7iD,IAA7B,EAAmC;EACjC,OAAO;IACL+I,OAAO,EAAE,iBAAU+5C,YAAV,EAAwB;MAC/B,IAAIj0B,GAAJ;;MACA,IAAI;QACFA,GAAG,GAAGznB,IAAI,CAACgB,KAAL,CAAW06C,YAAX,EAAyBr+C,SAA/B;MACD,CAFD,CAEE,OAAO3D,CAAP,EAAU;QACVd,IAAI,CAACc,CAAD,EAAI,EAAJ,CAAJ;QACA;MACD;;MAED,IAAI+tB,GAAJ,EAAS;QACP7uB,IAAI,CAAC,IAAD,EAAO6uB,GAAP,CAAJ;MACD,CAFD,MAEO;QACL7uB,IAAI,CAAC,IAAIyjB,KAAJ,CAAU,4DAAV,CAAD,EAA0E,EAA1E,CAAJ;MACD;IACF,CAfI;IAgBLpuB,KAAK,EAAE,eAAU6Y,UAAV,EAAsB40C,YAAtB,EAAoC;MACzC9iD,IAAI,CAAC,IAAIyjB,KAAJ,gDAAkDvV,UAAlD,eAAiE9G,IAAI,CAACC,SAAL,CAAey7C,YAAf,CAAjE,EAAD,EAAmG,EAAnG,CAAJ;IACD;EAlBI,CAAP;AAoBD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACO,SAAS9rC,KAAT,CAAezd,IAAf,EAAqByG,IAArB,EAA2B;EAChC,IAAM+iD,WAAW,GAAG;IAClBC,IAAI,EAAEzpD,IAAI,CAAC6B,GAAL,CAASgnD,gBAAT;EADY,CAApB;EAIAxhD,8CAAI,CAAC3N,wDAAA,CAAiB,WAAjB,CAAD,EAAgC4vD,mBAAmB,CAAC7iD,IAAD,CAAnD,EAA2DoH,IAAI,CAACC,SAAL,CAAe07C,WAAf,CAA3D,EAAwF;IAC1F95C,WAAW,EAAE,YAD6E;IAE1FD,eAAe,EAAE;EAFyE,CAAxF,CAAJ;AAID;AAEM,SAASoO,WAAT,CAAqBlkB,EAArB,EAAyB;EAC9B,iBAAUD,wDAAA,CAAiB,WAAjB,CAAV,mBAAgDC,EAAhD;AACD;;;;;;;;;;;;;;AC7Jc;AACf;AACA,aAAa,gBAAgB;AAC7B;AACA;AACA;AACA;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,oBAAoB;;AAEpB;AACA;AACA;AACA,MAAM;AACN;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,MAAM;AACN;AACA;;AAEA;AACA;AACA,aAAa,0BAA0B;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,WAAW;AACX;AACA,+BAA+B;AAC/B,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA,WAAW;AACX,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;AClYA;;AAEA;AACA,oCAAoC;;AAEpC;AACA,gBAAgB;AAChB,aAAa;AACb;AACA;AACA;AACA,OAAO,IAAI,iCAAiC;AAC5C,YAAY,IAAI,8BAA8B;AAC9C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;AC3Be;AACf;;AAEA,yCAAyC,SAAS;AAClD;AACA;;AAEA;AACA;;;;;;;;;;;;;;ACRe;AACf;AACA;;;;;;;;;;;;;;;ACFqD;AACtC;AACf,iCAAiC,gEAAgB;AACjD;;;;;;;;;;;;;;ACHe;AACf;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;ACNe;AACf;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;ACNe;AACf;AACA;AACA,IAAI;AACJ;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;;ACVe;AACf;AACA;AACA;AACA;;;;;;;;;;;;;;ACJe;AACf;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;ACNmE;AACQ;AAC5D;AACf,mBAAmB,2EAA2B;AAC9C,SAAS,uEAAuB;AAChC;;;;;;;;;;;;;;;;ACLmE;AACQ;AAC5D;AACf,mBAAmB,2EAA2B;AAC9C,EAAE,uEAAuB;AACzB;AACA;;;;;;;;;;;;;;ACNA;AACA,kBAAkB,kBAAkB;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEe;AACf;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;;;;;;;;;;;;;ACjBe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI;AACJ;AACA;;AAEA;AACA;;;;;;;;;;;;;;;ACb+C;AAChC;AACf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ADF;MAMD;IACF,CAVD;EAWD,CAbH;EAcA,OAAO09E,cAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvdD;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAiBA;AACA;AACA;AACA;AAEA,IAAMnE,WAAW,GAAG,SAApB;AACA,IAAMqB,MAAM,GAAG,QAAf;AACA,IAAMC,aAAa,GAAG,OAAtB;AACA,IAAM8C,kBAAkB,GAAG,GAA3B;AACA,IAAMC,gBAAgB,GAAG,CAAzB;AACA,IAAMC,kCAAkC,GAAG;EACzClpD,IAAI,EAAE,2BADmC;EAEzCua,OAAO,EAAE,EAFgC,CAE7B;;AAF6B,CAA3C;AAIO,IAAM4uC,wBAAwB,GAAG,iBAAjC;AACA,IAAMC,WAAW,GAAG3xE,6EAAqB,CAAC,QAAD,CAAzC;AAEP;;AACA,IAAI4xE,eAAe,GAAG,KAAtB;AAEA;;AACA,IAAInpD,UAAU,GAAG,EAAjB;AAEA;;AACA,IAAIopD,qBAAJ;AAEA;;AACA,IAAIC,cAAc,GAAG,EAArB;AAEA;;AACA,IAAIC,iBAAiB,GAAG,EAAxB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","file":"prebid.js","sourcesContent":["/* prebid.js v7.20.0-pre\r\nUpdated: 2022-10-31\r\nModules: adpod, userId, conversantBidAdapter, conversantAnalyticsAdapter, appnexusBidAdapter, openxBidAdapter, publinkIdSystem, sharedIdSystem, identityLinkIdSystem, dfpAdServerVideo */\r\n\r\nif (!window.pbjs || !window.pbjs.libLoaded) {\r\n (function(){","import { loadExternalScript } from './adloader.js';\r\nimport {\r\n  logError, logWarn, logMessage, deepAccess\r\n} from './utils.js';\r\nimport {find} from './polyfill.js';\r\nconst moduleCode = 'outstream';\r\n\r\n/**\r\n * @typedef {object} Renderer\r\n *\r\n * A Renderer stores some functions which are used to render a particular Bid.\r\n * These are used in Outstream Video Bids, returned on the Bid by the adapter, and will\r\n * be used to render that bid unless the Publisher overrides them.\r\n */\r\n\r\nexport function Renderer(options) {\r\n  const { url, config, id, callback, loaded, adUnitCode, renderNow } = options;\r\n  this.url = url;\r\n  this.config = config;\r\n  this.handlers = {};\r\n  this.id = id;\r\n\r\n  // a renderer may push to the command queue to delay rendering until the\r\n  // render function is loaded by loadExternalScript, at which point the the command\r\n  // queue will be processed\r\n  this.loaded = loaded;\r\n  this.cmd = [];\r\n  this.push = func => {\r\n    if (typeof func !== 'function') {\r\n      logError('Commands given to Renderer.push must be wrapped in a function');\r\n      return;\r\n    }\r\n    this.loaded ? func.call() : this.cmd.push(func);\r\n  };\r\n\r\n  // bidders may override this with the `callback` property given to `install`\r\n  this.callback = callback || (() => {\r\n    this.loaded = true;\r\n    this.process();\r\n  });\r\n\r\n  // use a function, not an arrow, in order to be able to pass \"arguments\" through\r\n  this.render = function () {\r\n    const renderArgs = arguments\r\n    const runRender = () => {\r\n      if (this._render) {\r\n        this._render.apply(this, renderArgs)\r\n      } else {\r\n        logWarn(`No render function was provided, please use .setRender on the renderer`);\r\n      }\r\n    }\r\n\r\n    if (isRendererPreferredFromAdUnit(adUnitCode)) {\r\n      logWarn(`External Js not loaded by Renderer since renderer url and callback is already defined on adUnit ${adUnitCode}`);\r\n      runRender();\r\n    } else if (renderNow) {\r\n      runRender();\r\n    } else {\r\n      // we expect to load a renderer url once only so cache the request to load script\r\n      this.cmd.unshift(runRender) // should render run first ?\r\n      loadExternalScript(url, moduleCode, this.callback, this.documentContext);\r\n    }\r\n  }.bind(this); // bind the function to this object to avoid 'this' errors\r\n}\r\n\r\nRenderer.install = function({ url, config, id, callback, loaded, adUnitCode, renderNow }) {\r\n  return new Renderer({ url, config, id, callback, loaded, adUnitCode, renderNow });\r\n};\r\n\r\nRenderer.prototype.getConfig = function() {\r\n  return this.config;\r\n};\r\n\r\nRenderer.prototype.setRender = function(fn) {\r\n  this._render = fn;\r\n};\r\n\r\nRenderer.prototype.setEventHandlers = function(handlers) {\r\n  this.handlers = handlers;\r\n};\r\n\r\nRenderer.prototype.handleVideoEvent = function({ id, eventName }) {\r\n  if (typeof this.handlers[eventName] === 'function') {\r\n    this.handlers[eventName]();\r\n  }\r\n\r\n  logMessage(`Prebid Renderer event for id ${id} type ${eventName}`);\r\n};\r\n\r\n/*\r\n * Calls functions that were pushed to the command queue before the\r\n * renderer was loaded by `loadExternalScript`\r\n */\r\nRenderer.prototype.process = function() {\r\n  while (this.cmd.length > 0) {\r\n    try {\r\n      this.cmd.shift().call();\r\n    } catch (error) {\r\n      logError('Error processing Renderer command: ', error);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Checks whether creative rendering should be done by Renderer or not.\r\n * @param {Object} renderer Renderer object installed by adapter\r\n * @returns {Boolean}\r\n */\r\nexport function isRendererRequired(renderer) {\r\n  return !!(renderer && renderer.url);\r\n}\r\n\r\n/**\r\n * Render the bid returned by the adapter\r\n * @param {Object} renderer Renderer object installed by adapter\r\n * @param {Object} bid Bid response\r\n * @param {Document} doc context document of bid\r\n */\r\nexport function executeRenderer(renderer, bid, doc) {\r\n  let docContext = null;\r\n  if (renderer.config && renderer.config.documentResolver) {\r\n    docContext = renderer.config.documentResolver(bid, document, doc);// a user provided callback, which should return a Document, and expect the parameters; bid, sourceDocument, renderDocument\r\n  }\r\n  if (!docContext) {\r\n    docContext = document;\r\n  }\r\n  renderer.documentContext = docContext;\r\n  renderer.render(bid, renderer.documentContext);\r\n}\r\n\r\nfunction isRendererPreferredFromAdUnit(adUnitCode) {\r\n  const adUnits = $$PREBID_GLOBAL$$.adUnits;\r\n  const adUnit = find(adUnits, adUnit => {\r\n    return adUnit.code === adUnitCode;\r\n  });\r\n\r\n  if (!adUnit) {\r\n    return false\r\n  }\r\n\r\n  // renderer defined at adUnit level\r\n  const adUnitRenderer = deepAccess(adUnit, 'renderer');\r\n  const hasValidAdUnitRenderer = !!(adUnitRenderer && adUnitRenderer.url && adUnitRenderer.render);\r\n\r\n  // renderer defined at adUnit.mediaTypes level\r\n  const mediaTypeRenderer = deepAccess(adUnit, 'mediaTypes.video.renderer');\r\n  const hasValidMediaTypeRenderer = !!(mediaTypeRenderer && mediaTypeRenderer.url && mediaTypeRenderer.render)\r\n\r\n  return !!(\r\n    (hasValidAdUnitRenderer && !(adUnitRenderer.backupOnly === true)) ||\r\n    (hasValidMediaTypeRenderer && !(mediaTypeRenderer.backupOnly === true))\r\n  );\r\n}\r\n","import {logError} from './utils.js';\r\nimport * as events from './events.js';\r\nimport CONSTANTS from './constants.json';\r\n\r\nconst {AD_RENDER_FAILED, AD_RENDER_SUCCEEDED} = CONSTANTS.EVENTS;\r\n\r\n/**\r\n * Emit the AD_RENDER_FAILED event.\r\n *\r\n * @param reason one of the values in CONSTANTS.AD_RENDER_FAILED_REASON\r\n * @param message failure description\r\n * @param bid? bid response object that failed to render\r\n * @param id? adId that failed to render\r\n */\r\nexport function emitAdRenderFail({ reason, message, bid, id }) {\r\n  const data = { reason, message };\r\n  if (bid) data.bid = bid;\r\n  if (id) data.adId = id;\r\n\r\n  logError(message);\r\n  events.emit(AD_RENDER_FAILED, data);\r\n}\r\n\r\n/**\r\n * Emit the AD_RENDER_SUCCEEDED event.\r\n *\r\n * @param doc document object that was used to `.write` the ad. Should be `null` if unavailable (e.g. for documents in\r\n * a cross-origin frame).\r\n * @param bid bid response object for the ad that was rendered\r\n * @param id adId that was rendered.\r\n */\r\nexport function emitAdRenderSucceeded({ doc, bid, id }) {\r\n  const data = { doc };\r\n  if (bid) data.bid = bid;\r\n  if (id) data.adId = id;\r\n\r\n  events.emit(AD_RENDER_SUCCEEDED, data);\r\n}\r\n","import { deepAccess } from './utils.js';\r\n\r\nlet adUnits = {};\r\n\r\nfunction ensureAdUnit(adunit, bidderCode) {\r\n  let adUnit = adUnits[adunit] = adUnits[adunit] || { bidders: {} };\r\n  if (bidderCode) {\r\n    return adUnit.bidders[bidderCode] = adUnit.bidders[bidderCode] || {}\r\n  }\r\n  return adUnit;\r\n}\r\n\r\nfunction incrementAdUnitCount(adunit, counter, bidderCode) {\r\n  let adUnit = ensureAdUnit(adunit, bidderCode);\r\n  adUnit[counter] = (adUnit[counter] || 0) + 1;\r\n  return adUnit[counter];\r\n}\r\n\r\n/**\r\n * Increments and returns current Adunit counter\r\n * @param {string} adunit id\r\n * @returns {number} current adunit count\r\n */\r\nfunction incrementRequestsCounter(adunit) {\r\n  return incrementAdUnitCount(adunit, 'requestsCounter');\r\n}\r\n\r\n/**\r\n * Increments and returns current Adunit requests counter for a bidder\r\n * @param {string} adunit id\r\n * @param {string} bidderCode code\r\n * @returns {number} current adunit bidder requests count\r\n */\r\nfunction incrementBidderRequestsCounter(adunit, bidderCode) {\r\n  return incrementAdUnitCount(adunit, 'requestsCounter', bidderCode);\r\n}\r\n\r\n/**\r\n * Increments and returns current Adunit wins counter for a bidder\r\n * @param {string} adunit id\r\n * @param {string} bidderCode code\r\n * @returns {number} current adunit bidder requests count\r\n */\r\nfunction incrementBidderWinsCounter(adunit, bidderCode) {\r\n  return incrementAdUnitCount(adunit, 'winsCounter', bidderCode);\r\n}\r\n\r\n/**\r\n * Returns current Adunit counter\r\n * @param {string} adunit id\r\n * @returns {number} current adunit count\r\n */\r\nfunction getRequestsCounter(adunit) {\r\n  return deepAccess(adUnits, `${adunit}.requestsCounter`) || 0;\r\n}\r\n\r\n/**\r\n * Returns current Adunit requests counter for a specific bidder code\r\n * @param {string} adunit id\r\n * @param {string} bidder code\r\n * @returns {number} current adunit bidder requests count\r\n */\r\nfunction getBidderRequestsCounter(adunit, bidder) {\r\n  return deepAccess(adUnits, `${adunit}.bidders.${bidder}.requestsCounter`) || 0;\r\n}\r\n\r\n/**\r\n * Returns current Adunit requests counter for a specific bidder code\r\n * @param {string} adunit id\r\n * @param {string} bidder code\r\n * @returns {number} current adunit bidder requests count\r\n */\r\nfunction getBidderWinsCounter(adunit, bidder) {\r\n  return deepAccess(adUnits, `${adunit}.bidders.${bidder}.winsCounter`) || 0;\r\n}\r\n\r\n/**\r\n * A module which counts how many times an adunit was called\r\n * @module adunitCounter\r\n */\r\nlet adunitCounter = {\r\n  incrementRequestsCounter,\r\n  incrementBidderRequestsCounter,\r\n  incrementBidderWinsCounter,\r\n  getRequestsCounter,\r\n  getBidderRequestsCounter,\r\n  getBidderWinsCounter\r\n}\r\n\r\nexport { adunitCounter };\r\n","export default function Adapter(code) {\r\n  var bidderCode = code;\r\n\r\n  function setBidderCode(code) {\r\n    bidderCode = code;\r\n  }\r\n\r\n  function getBidderCode() {\r\n    return bidderCode;\r\n  }\r\n\r\n  function callBids() {\r\n  }\r\n\r\n  return {\r\n    callBids: callBids,\r\n    setBidderCode: setBidderCode,\r\n    getBidderCode: getBidderCode\r\n  };\r\n}\r\n","/** @module adaptermanger */\r\n\r\nimport {\r\n  _each,\r\n  bind,\r\n  deepAccess,\r\n  deepClone,\r\n  flatten,\r\n  generateUUID,\r\n  getBidderCodes,\r\n  getDefinedParams,\r\n  getUniqueIdentifierStr,\r\n  getUserConfiguredParams,\r\n  groupBy,\r\n  isArray,\r\n  isValidMediaTypes,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep,\r\n  shuffle,\r\n  timestamp,\r\n} from './utils.js';\r\nimport {processAdUnitsForLabels} from './sizeMapping.js';\r\nimport {decorateAdUnitsWithNativeParams, nativeAdapters} from './native.js';\r\nimport {newBidder} from './adapters/bidderFactory.js';\r\nimport {ajaxBuilder} from './ajax.js';\r\nimport {config, RANDOM} from './config.js';\r\nimport {hook} from './hook.js';\r\nimport {find, includes} from './polyfill.js';\r\nimport {adunitCounter} from './adUnits.js';\r\nimport {getRefererInfo} from './refererDetection.js';\r\nimport {GdprConsentHandler, UspConsentHandler} from './consentHandler.js';\r\nimport * as events from './events.js';\r\nimport CONSTANTS from './constants.json';\r\nimport {useMetrics} from './utils/perfMetrics.js';\r\n\r\nexport const PARTITIONS = {\r\n  CLIENT: 'client',\r\n  SERVER: 'server'\r\n}\r\n\r\nlet adapterManager = {};\r\n\r\nlet _bidderRegistry = adapterManager.bidderRegistry = {};\r\nlet _aliasRegistry = adapterManager.aliasRegistry = {};\r\n\r\nlet _s2sConfigs = [];\r\nconfig.getConfig('s2sConfig', config => {\r\n  if (config && config.s2sConfig) {\r\n    _s2sConfigs = isArray(config.s2sConfig) ? config.s2sConfig : [config.s2sConfig];\r\n  }\r\n});\r\n\r\nvar _analyticsRegistry = {};\r\n\r\n/**\r\n * @typedef {object} LabelDescriptor\r\n * @property {boolean} labelAll describes whether or not this object expects all labels to match, or any label to match\r\n * @property {Array<string>} labels the labels listed on the bidder or adUnit\r\n * @property {Array<string>} activeLabels the labels specified as being active by requestBids\r\n */\r\n\r\nfunction getBids({bidderCode, auctionId, bidderRequestId, adUnits, src, metrics}) {\r\n  return adUnits.reduce((result, adUnit) => {\r\n    result.push(adUnit.bids.filter(bid => bid.bidder === bidderCode)\r\n      .reduce((bids, bid) => {\r\n        bid = Object.assign({}, bid, getDefinedParams(adUnit, [\r\n          'nativeParams',\r\n          'nativeOrtbRequest',\r\n          'ortb2Imp',\r\n          'mediaType',\r\n          'renderer'\r\n        ]));\r\n\r\n        const mediaTypes = bid.mediaTypes == null ? adUnit.mediaTypes : bid.mediaTypes\r\n\r\n        if (isValidMediaTypes(mediaTypes)) {\r\n          bid = Object.assign({}, bid, {\r\n            mediaTypes\r\n          });\r\n        } else {\r\n          logError(\r\n            `mediaTypes is not correctly configured for adunit ${adUnit.code}`\r\n          );\r\n        }\r\n\r\n        bids.push(Object.assign({}, bid, {\r\n          adUnitCode: adUnit.code,\r\n          transactionId: adUnit.transactionId,\r\n          sizes: deepAccess(mediaTypes, 'banner.sizes') || deepAccess(mediaTypes, 'video.playerSize') || [],\r\n          bidId: bid.bid_id || getUniqueIdentifierStr(),\r\n          bidderRequestId,\r\n          auctionId,\r\n          src,\r\n          metrics,\r\n          bidRequestsCount: adunitCounter.getRequestsCounter(adUnit.code),\r\n          bidderRequestsCount: adunitCounter.getBidderRequestsCounter(adUnit.code, bid.bidder),\r\n          bidderWinsCount: adunitCounter.getBidderWinsCounter(adUnit.code, bid.bidder),\r\n        }));\r\n        return bids;\r\n      }, [])\r\n    );\r\n    return result;\r\n  }, []).reduce(flatten, []).filter(val => val !== '');\r\n}\r\n\r\nconst hookedGetBids = hook('sync', getBids, 'getBids');\r\n\r\n/**\r\n * Filter an adUnit's  bids for building client and/or server requests\r\n *\r\n * @param bids an array of bids as defined in an adUnit\r\n * @param s2sConfig null if the adUnit is being routed to a client adapter; otherwise the s2s adapter's config\r\n * @returns the subset of `bids` that are pertinent for the given `s2sConfig`\r\n */\r\nexport function _filterBidsForAdUnit(bids, s2sConfig, {getS2SBidders = getS2SBidderSet} = {}) {\r\n  if (s2sConfig == null) {\r\n    return bids;\r\n  } else {\r\n    const serverBidders = getS2SBidders(s2sConfig);\r\n    return bids.filter((bid) => serverBidders.has(bid.bidder))\r\n  }\r\n}\r\nexport const filterBidsForAdUnit = hook('sync', _filterBidsForAdUnit, 'filterBidsForAdUnit');\r\n\r\nfunction getAdUnitCopyForPrebidServer(adUnits, s2sConfig) {\r\n  let adUnitsCopy = deepClone(adUnits);\r\n\r\n  adUnitsCopy.forEach((adUnit) => {\r\n    // filter out client side bids\r\n    adUnit.bids = filterBidsForAdUnit(adUnit.bids, s2sConfig)\r\n      .map((bid) => {\r\n        bid.bid_id = getUniqueIdentifierStr();\r\n        return bid;\r\n      });\r\n  });\r\n\r\n  // don't send empty requests\r\n  adUnitsCopy = adUnitsCopy.filter(adUnit => {\r\n    return adUnit.bids.length !== 0;\r\n  });\r\n  return adUnitsCopy;\r\n}\r\n\r\nfunction getAdUnitCopyForClientAdapters(adUnits) {\r\n  let adUnitsClientCopy = deepClone(adUnits);\r\n  adUnitsClientCopy.forEach((adUnit) => {\r\n    adUnit.bids = filterBidsForAdUnit(adUnit.bids, null);\r\n  });\r\n\r\n  // don't send empty requests\r\n  adUnitsClientCopy = adUnitsClientCopy.filter(adUnit => {\r\n    return adUnit.bids.length !== 0;\r\n  });\r\n\r\n  return adUnitsClientCopy;\r\n}\r\n\r\nexport let gdprDataHandler = new GdprConsentHandler();\r\nexport let uspDataHandler = new UspConsentHandler();\r\n\r\nexport let coppaDataHandler = {\r\n  getCoppa: function() {\r\n    return !!(config.getConfig('coppa'))\r\n  }\r\n};\r\n\r\n/**\r\n * Filter and/or modify media types for ad units based on the given labels.\r\n *\r\n * This should return adUnits that are active for the given labels, modified to have their `mediaTypes`\r\n * conform to size mapping configuration. If different bids for the same adUnit should use different `mediaTypes`,\r\n * they should be exposed under `adUnit.bids[].mediaTypes`.\r\n */\r\nexport const setupAdUnitMediaTypes = hook('sync', (adUnits, labels) => {\r\n  return processAdUnitsForLabels(adUnits, labels);\r\n}, 'setupAdUnitMediaTypes')\r\n\r\n/**\r\n * @param {{}|Array<{}>} s2sConfigs\r\n * @returns {Set<String>} a set of all the bidder codes that should be routed through the S2S adapter(s)\r\n *                        as defined in `s2sConfigs`\r\n */\r\nexport function getS2SBidderSet(s2sConfigs) {\r\n  if (!isArray(s2sConfigs)) s2sConfigs = [s2sConfigs];\r\n  // `null` represents the \"no bid bidder\" - when an ad unit is meant only for S2S adapters, like stored impressions\r\n  const serverBidders = new Set([null]);\r\n  s2sConfigs.filter((s2s) => s2s && s2s.enabled)\r\n    .flatMap((s2s) => s2s.bidders)\r\n    .forEach((bidder) => serverBidders.add(bidder));\r\n  return serverBidders;\r\n}\r\n\r\n/**\r\n * @returns {{[PARTITIONS.CLIENT]: Array<String>, [PARTITIONS.SERVER]: Array<String>}}\r\n *           All the bidder codes in the given `adUnits`, divided in two arrays -\r\n *           those that should be routed to client, and server adapters (according to the configuration in `s2sConfigs`).\r\n */\r\nexport function _partitionBidders (adUnits, s2sConfigs, {getS2SBidders = getS2SBidderSet} = {}) {\r\n  const serverBidders = getS2SBidders(s2sConfigs);\r\n  return getBidderCodes(adUnits).reduce((memo, bidder) => {\r\n    const partition = serverBidders.has(bidder) ? PARTITIONS.SERVER : PARTITIONS.CLIENT;\r\n    memo[partition].push(bidder);\r\n    return memo;\r\n  }, {[PARTITIONS.CLIENT]: [], [PARTITIONS.SERVER]: []})\r\n}\r\n\r\nexport const partitionBidders = hook('sync', _partitionBidders, 'partitionBidders');\r\n\r\nadapterManager.makeBidRequests = hook('sync', function (adUnits, auctionStart, auctionId, cbTimeout, labels, ortb2Fragments = {}, auctionMetrics) {\r\n  auctionMetrics = useMetrics(auctionMetrics);\r\n  /**\r\n   * emit and pass adunits for external modification\r\n   * @see {@link https://github.com/prebid/Prebid.js/issues/4149|Issue}\r\n   */\r\n  events.emit(CONSTANTS.EVENTS.BEFORE_REQUEST_BIDS, adUnits);\r\n  if (FEATURES.NATIVE) {\r\n    decorateAdUnitsWithNativeParams(adUnits);\r\n  }\r\n  adUnits = setupAdUnitMediaTypes(adUnits, labels);\r\n\r\n  let {[PARTITIONS.CLIENT]: clientBidders, [PARTITIONS.SERVER]: serverBidders} = partitionBidders(adUnits, _s2sConfigs);\r\n\r\n  if (config.getConfig('bidderSequence') === RANDOM) {\r\n    clientBidders = shuffle(clientBidders);\r\n  }\r\n  const refererInfo = getRefererInfo();\r\n\r\n  let bidRequests = [];\r\n\r\n  const ortb2 = ortb2Fragments.global || {};\r\n  const bidderOrtb2 = ortb2Fragments.bidder || {};\r\n\r\n  function addOrtb2(bidderRequest) {\r\n    const fpd = Object.freeze(mergeDeep({}, ortb2, bidderOrtb2[bidderRequest.bidderCode]));\r\n    bidderRequest.ortb2 = fpd;\r\n    bidderRequest.bids.forEach((bid) => bid.ortb2 = fpd);\r\n    return bidderRequest;\r\n  }\r\n\r\n  _s2sConfigs.forEach(s2sConfig => {\r\n    if (s2sConfig && s2sConfig.enabled) {\r\n      let adUnitsS2SCopy = getAdUnitCopyForPrebidServer(adUnits, s2sConfig);\r\n\r\n      // uniquePbsTid is so we know which server to send which bids to during the callBids function\r\n      let uniquePbsTid = generateUUID();\r\n      serverBidders.forEach(bidderCode => {\r\n        const bidderRequestId = getUniqueIdentifierStr();\r\n        const metrics = auctionMetrics.fork();\r\n        const bidderRequest = addOrtb2({\r\n          bidderCode,\r\n          auctionId,\r\n          bidderRequestId,\r\n          uniquePbsTid,\r\n          bids: hookedGetBids({bidderCode, auctionId, bidderRequestId, 'adUnits': deepClone(adUnitsS2SCopy), src: CONSTANTS.S2S.SRC, metrics}),\r\n          auctionStart: auctionStart,\r\n          timeout: s2sConfig.timeout,\r\n          src: CONSTANTS.S2S.SRC,\r\n          refererInfo,\r\n          metrics,\r\n        });\r\n        if (bidderRequest.bids.length !== 0) {\r\n          bidRequests.push(bidderRequest);\r\n        }\r\n      });\r\n\r\n      // update the s2sAdUnits object and remove all bids that didn't pass sizeConfig/label checks from getBids()\r\n      // this is to keep consistency and only allow bids/adunits that passed the checks to go to pbs\r\n      adUnitsS2SCopy.forEach((adUnitCopy) => {\r\n        let validBids = adUnitCopy.bids.filter((adUnitBid) =>\r\n          find(bidRequests, request =>\r\n            find(request.bids, (reqBid) => reqBid.bidId === adUnitBid.bid_id)));\r\n        adUnitCopy.bids = validBids;\r\n      });\r\n\r\n      bidRequests.forEach(request => {\r\n        if (request.adUnitsS2SCopy === undefined) {\r\n          request.adUnitsS2SCopy = adUnitsS2SCopy.filter(adUnitCopy => adUnitCopy.bids.length > 0);\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  // client adapters\r\n  let adUnitsClientCopy = getAdUnitCopyForClientAdapters(adUnits);\r\n  clientBidders.forEach(bidderCode => {\r\n    const bidderRequestId = getUniqueIdentifierStr();\r\n    const metrics = auctionMetrics.fork();\r\n    const bidderRequest = addOrtb2({\r\n      bidderCode,\r\n      auctionId,\r\n      bidderRequestId,\r\n      bids: hookedGetBids({bidderCode, auctionId, bidderRequestId, 'adUnits': deepClone(adUnitsClientCopy), labels, src: 'client', metrics}),\r\n      auctionStart: auctionStart,\r\n      timeout: cbTimeout,\r\n      refererInfo,\r\n      metrics,\r\n    });\r\n    const adapter = _bidderRegistry[bidderCode];\r\n    if (!adapter) {\r\n      logError(`Trying to make a request for bidder that does not exist: ${bidderCode}`);\r\n    }\r\n\r\n    if (adapter && bidderRequest.bids && bidderRequest.bids.length !== 0) {\r\n      bidRequests.push(bidderRequest);\r\n    }\r\n  });\r\n\r\n  if (gdprDataHandler.getConsentData()) {\r\n    bidRequests.forEach(bidRequest => {\r\n      bidRequest['gdprConsent'] = gdprDataHandler.getConsentData();\r\n    });\r\n  }\r\n\r\n  if (uspDataHandler.getConsentData()) {\r\n    bidRequests.forEach(bidRequest => {\r\n      bidRequest['uspConsent'] = uspDataHandler.getConsentData();\r\n    });\r\n  }\r\n\r\n  bidRequests.forEach(bidRequest => {\r\n    config.runWithBidder(bidRequest.bidderCode, () => {\r\n      const fledgeEnabledFromConfig = config.getConfig('fledgeEnabled');\r\n      bidRequest['fledgeEnabled'] = navigator.runAdAuction && fledgeEnabledFromConfig\r\n    });\r\n  });\r\n\r\n  return bidRequests;\r\n}, 'makeBidRequests');\r\n\r\nadapterManager.callBids = (adUnits, bidRequests, addBidResponse, doneCb, requestCallbacks, requestBidsTimeout, onTimelyResponse, ortb2Fragments = {}) => {\r\n  if (!bidRequests.length) {\r\n    logWarn('callBids executed with no bidRequests.  Were they filtered by labels or sizing?');\r\n    return;\r\n  }\r\n\r\n  let [clientBidRequests, serverBidRequests] = bidRequests.reduce((partitions, bidRequest) => {\r\n    partitions[Number(typeof bidRequest.src !== 'undefined' && bidRequest.src === CONSTANTS.S2S.SRC)].push(bidRequest);\r\n    return partitions;\r\n  }, [[], []]);\r\n\r\n  var uniqueServerBidRequests = [];\r\n  serverBidRequests.forEach(serverBidRequest => {\r\n    var index = -1;\r\n    for (var i = 0; i < uniqueServerBidRequests.length; ++i) {\r\n      if (serverBidRequest.uniquePbsTid === uniqueServerBidRequests[i].uniquePbsTid) {\r\n        index = i;\r\n        break;\r\n      }\r\n    }\r\n    if (index <= -1) {\r\n      uniqueServerBidRequests.push(serverBidRequest);\r\n    }\r\n  });\r\n\r\n  let counter = 0;\r\n\r\n  _s2sConfigs.forEach((s2sConfig) => {\r\n    if (s2sConfig && uniqueServerBidRequests[counter] && getS2SBidderSet(s2sConfig).has(uniqueServerBidRequests[counter].bidderCode)) {\r\n      // s2s should get the same client side timeout as other client side requests.\r\n      const s2sAjax = ajaxBuilder(requestBidsTimeout, requestCallbacks ? {\r\n        request: requestCallbacks.request.bind(null, 's2s'),\r\n        done: requestCallbacks.done\r\n      } : undefined);\r\n      let adaptersServerSide = s2sConfig.bidders;\r\n      const s2sAdapter = _bidderRegistry[s2sConfig.adapter];\r\n      let uniquePbsTid = uniqueServerBidRequests[counter].uniquePbsTid;\r\n      let adUnitsS2SCopy = uniqueServerBidRequests[counter].adUnitsS2SCopy;\r\n\r\n      let uniqueServerRequests = serverBidRequests.filter(serverBidRequest => serverBidRequest.uniquePbsTid === uniquePbsTid);\r\n\r\n      if (s2sAdapter) {\r\n        let s2sBidRequest = {'ad_units': adUnitsS2SCopy, s2sConfig, ortb2Fragments};\r\n        if (s2sBidRequest.ad_units.length) {\r\n          let doneCbs = uniqueServerRequests.map(bidRequest => {\r\n            bidRequest.start = timestamp();\r\n            return doneCb.bind(bidRequest);\r\n          });\r\n\r\n          const bidders = getBidderCodes(s2sBidRequest.ad_units).filter((bidder) => adaptersServerSide.includes(bidder));\r\n          logMessage(`CALLING S2S HEADER BIDDERS ==== ${bidders.length > 0 ? bidders.join(', ') : 'No bidder specified, using \"ortb2Imp\" definition(s) only'}`);\r\n\r\n          // fire BID_REQUESTED event for each s2s bidRequest\r\n          uniqueServerRequests.forEach(bidRequest => {\r\n            // add the new sourceTid\r\n            events.emit(CONSTANTS.EVENTS.BID_REQUESTED, {...bidRequest, tid: bidRequest.auctionId});\r\n          });\r\n\r\n          // make bid requests\r\n          s2sAdapter.callBids(\r\n            s2sBidRequest,\r\n            serverBidRequests,\r\n            addBidResponse,\r\n            () => doneCbs.forEach(done => done()),\r\n            s2sAjax\r\n          );\r\n        }\r\n      } else {\r\n        logError('missing ' + s2sConfig.adapter);\r\n      }\r\n      counter++;\r\n    }\r\n  });\r\n\r\n  // handle client adapter requests\r\n  clientBidRequests.forEach(bidRequest => {\r\n    bidRequest.start = timestamp();\r\n    // TODO : Do we check for bid in pool from here and skip calling adapter again ?\r\n    const adapter = _bidderRegistry[bidRequest.bidderCode];\r\n    config.runWithBidder(bidRequest.bidderCode, () => {\r\n      logMessage(`CALLING BIDDER`);\r\n      events.emit(CONSTANTS.EVENTS.BID_REQUESTED, bidRequest);\r\n    });\r\n    let ajax = ajaxBuilder(requestBidsTimeout, requestCallbacks ? {\r\n      request: requestCallbacks.request.bind(null, bidRequest.bidderCode),\r\n      done: requestCallbacks.done\r\n    } : undefined);\r\n    const adapterDone = doneCb.bind(bidRequest);\r\n    try {\r\n      config.runWithBidder(\r\n        bidRequest.bidderCode,\r\n        bind.call(\r\n          adapter.callBids,\r\n          adapter,\r\n          bidRequest,\r\n          addBidResponse,\r\n          adapterDone,\r\n          ajax,\r\n          onTimelyResponse,\r\n          config.callbackWithBidder(bidRequest.bidderCode)\r\n        )\r\n      );\r\n    } catch (e) {\r\n      logError(`${bidRequest.bidderCode} Bid Adapter emitted an uncaught error when parsing their bidRequest`, {e, bidRequest});\r\n      adapterDone();\r\n    }\r\n  });\r\n};\r\n\r\nfunction getSupportedMediaTypes(bidderCode) {\r\n  let supportedMediaTypes = [];\r\n  if (includes(adapterManager.videoAdapters, bidderCode)) supportedMediaTypes.push('video');\r\n  if (FEATURES.NATIVE && includes(nativeAdapters, bidderCode)) supportedMediaTypes.push('native');\r\n  return supportedMediaTypes;\r\n}\r\n\r\nadapterManager.videoAdapters = []; // added by adapterLoader for now\r\n\r\nadapterManager.registerBidAdapter = function (bidAdapter, bidderCode, {supportedMediaTypes = []} = {}) {\r\n  if (bidAdapter && bidderCode) {\r\n    if (typeof bidAdapter.callBids === 'function') {\r\n      _bidderRegistry[bidderCode] = bidAdapter;\r\n\r\n      if (includes(supportedMediaTypes, 'video')) {\r\n        adapterManager.videoAdapters.push(bidderCode);\r\n      }\r\n      if (FEATURES.NATIVE && includes(supportedMediaTypes, 'native')) {\r\n        nativeAdapters.push(bidderCode);\r\n      }\r\n    } else {\r\n      logError('Bidder adaptor error for bidder code: ' + bidderCode + 'bidder must implement a callBids() function');\r\n    }\r\n  } else {\r\n    logError('bidAdapter or bidderCode not specified');\r\n  }\r\n};\r\n\r\nadapterManager.aliasBidAdapter = function (bidderCode, alias, options) {\r\n  let existingAlias = _bidderRegistry[alias];\r\n\r\n  if (typeof existingAlias === 'undefined') {\r\n    let bidAdapter = _bidderRegistry[bidderCode];\r\n    if (typeof bidAdapter === 'undefined') {\r\n      // check if alias is part of s2sConfig and allow them to register if so (as base bidder may be s2s-only)\r\n      const nonS2SAlias = [];\r\n      _s2sConfigs.forEach(s2sConfig => {\r\n        if (s2sConfig.bidders && s2sConfig.bidders.length) {\r\n          const s2sBidders = s2sConfig && s2sConfig.bidders;\r\n          if (!(s2sConfig && includes(s2sBidders, alias))) {\r\n            nonS2SAlias.push(bidderCode);\r\n          } else {\r\n            _aliasRegistry[alias] = bidderCode;\r\n          }\r\n        }\r\n      });\r\n      nonS2SAlias.forEach(bidderCode => {\r\n        logError('bidderCode \"' + bidderCode + '\" is not an existing bidder.', 'adapterManager.aliasBidAdapter');\r\n      });\r\n    } else {\r\n      try {\r\n        let newAdapter;\r\n        let supportedMediaTypes = getSupportedMediaTypes(bidderCode);\r\n        // Have kept old code to support backward compatibilitiy.\r\n        // Remove this if loop when all adapters are supporting bidderFactory. i.e When Prebid.js is 1.0\r\n        if (bidAdapter.constructor.prototype != Object.prototype) {\r\n          newAdapter = new bidAdapter.constructor();\r\n          newAdapter.setBidderCode(alias);\r\n        } else {\r\n          let spec = bidAdapter.getSpec();\r\n          let gvlid = options && options.gvlid;\r\n          let skipPbsAliasing = options && options.skipPbsAliasing;\r\n          newAdapter = newBidder(Object.assign({}, spec, { code: alias, gvlid, skipPbsAliasing }));\r\n          _aliasRegistry[alias] = bidderCode;\r\n        }\r\n        adapterManager.registerBidAdapter(newAdapter, alias, {\r\n          supportedMediaTypes\r\n        });\r\n      } catch (e) {\r\n        logError(bidderCode + ' bidder does not currently support aliasing.', 'adapterManager.aliasBidAdapter');\r\n      }\r\n    }\r\n  } else {\r\n    logMessage('alias name \"' + alias + '\" has been already specified.');\r\n  }\r\n};\r\n\r\nadapterManager.registerAnalyticsAdapter = function ({adapter, code, gvlid}) {\r\n  if (adapter && code) {\r\n    if (typeof adapter.enableAnalytics === 'function') {\r\n      adapter.code = code;\r\n      _analyticsRegistry[code] = { adapter, gvlid };\r\n    } else {\r\n      logError(`Prebid Error: Analytics adaptor error for analytics \"${code}\"\r\n        analytics adapter must implement an enableAnalytics() function`);\r\n    }\r\n  } else {\r\n    logError('Prebid Error: analyticsAdapter or analyticsCode not specified');\r\n  }\r\n};\r\n\r\nadapterManager.enableAnalytics = function (config) {\r\n  if (!isArray(config)) {\r\n    config = [config];\r\n  }\r\n\r\n  _each(config, adapterConfig => {\r\n    const entry = _analyticsRegistry[adapterConfig.provider];\r\n    if (entry && entry.adapter) {\r\n      entry.adapter.enableAnalytics(adapterConfig);\r\n    } else {\r\n      logError(`Prebid Error: no analytics adapter found in registry for '${adapterConfig.provider}'.`);\r\n    }\r\n  });\r\n}\r\n\r\nadapterManager.getBidAdapter = function(bidder) {\r\n  return _bidderRegistry[bidder];\r\n};\r\n\r\nadapterManager.getAnalyticsAdapter = function(code) {\r\n  return _analyticsRegistry[code];\r\n}\r\n\r\nfunction tryCallBidderMethod(bidder, method, param) {\r\n  try {\r\n    const adapter = _bidderRegistry[bidder];\r\n    const spec = adapter.getSpec();\r\n    if (spec && spec[method] && typeof spec[method] === 'function') {\r\n      logInfo(`Invoking ${bidder}.${method}`);\r\n      config.runWithBidder(bidder, bind.call(spec[method], spec, param));\r\n    }\r\n  } catch (e) {\r\n    logWarn(`Error calling ${method} of ${bidder}`);\r\n  }\r\n}\r\n\r\nadapterManager.callTimedOutBidders = function(adUnits, timedOutBidders, cbTimeout) {\r\n  timedOutBidders = timedOutBidders.map((timedOutBidder) => {\r\n    // Adding user configured params & timeout to timeout event data\r\n    timedOutBidder.params = getUserConfiguredParams(adUnits, timedOutBidder.adUnitCode, timedOutBidder.bidder);\r\n    timedOutBidder.timeout = cbTimeout;\r\n    return timedOutBidder;\r\n  });\r\n  timedOutBidders = groupBy(timedOutBidders, 'bidder');\r\n\r\n  Object.keys(timedOutBidders).forEach((bidder) => {\r\n    tryCallBidderMethod(bidder, 'onTimeout', timedOutBidders[bidder]);\r\n  });\r\n}\r\n\r\nadapterManager.callBidWonBidder = function(bidder, bid, adUnits) {\r\n  // Adding user configured params to bidWon event data\r\n  bid.params = getUserConfiguredParams(adUnits, bid.adUnitCode, bid.bidder);\r\n  adunitCounter.incrementBidderWinsCounter(bid.adUnitCode, bid.bidder);\r\n  tryCallBidderMethod(bidder, 'onBidWon', bid);\r\n};\r\n\r\nadapterManager.callSetTargetingBidder = function(bidder, bid) {\r\n  tryCallBidderMethod(bidder, 'onSetTargeting', bid);\r\n};\r\n\r\nadapterManager.callBidViewableBidder = function(bidder, bid) {\r\n  tryCallBidderMethod(bidder, 'onBidViewable', bid);\r\n};\r\n\r\nadapterManager.callBidderError = function(bidder, error, bidderRequest) {\r\n  const param = { error, bidderRequest };\r\n  tryCallBidderMethod(bidder, 'onBidderError', param);\r\n};\r\n\r\nexport default adapterManager;\r\n","import Adapter from '../adapter.js';\r\nimport adapterManager from '../adapterManager.js';\r\nimport { config } from '../config.js';\r\nimport { createBid } from '../bidfactory.js';\r\nimport { userSync } from '../userSync.js';\r\nimport { nativeBidIsValid } from '../native.js';\r\nimport { isValidVideoBid } from '../video.js';\r\nimport CONSTANTS from '../constants.json';\r\nimport * as events from '../events.js';\r\nimport {includes} from '../polyfill.js';\r\nimport { ajax } from '../ajax.js';\r\nimport { logWarn, logInfo, logError, parseQueryStringParameters, delayExecution, parseSizesInput, flatten, uniques, timestamp, deepAccess, isArray, isPlainObject } from '../utils.js';\r\nimport { ADPOD } from '../mediaTypes.js';\r\nimport { getHook, hook } from '../hook.js';\r\nimport { getCoreStorageManager } from '../storageManager.js';\r\nimport {auctionManager} from '../auctionManager.js';\r\nimport { bidderSettings } from '../bidderSettings.js';\r\nimport {useMetrics} from '../utils/perfMetrics.js';\r\n\r\nexport const storage = getCoreStorageManager('bidderFactory');\r\n\r\n/**\r\n * This file aims to support Adapters during the Prebid 0.x -> 1.x transition.\r\n *\r\n * Prebid 1.x and Prebid 0.x will be in separate branches--perhaps for a long time.\r\n * This function defines an API for adapter construction which is compatible with both versions.\r\n * Adapters which use it can maintain their code in master, and only this file will need to change\r\n * in the 1.x branch.\r\n *\r\n * Typical usage looks something like:\r\n *\r\n * const adapter = registerBidder({\r\n *   code: 'myBidderCode',\r\n *   aliases: ['alias1', 'alias2'],\r\n *   supportedMediaTypes: ['video', 'native'],\r\n *   isBidRequestValid: function(paramsObject) { return true/false },\r\n *   buildRequests: function(bidRequests, bidderRequest) { return some ServerRequest(s) },\r\n *   interpretResponse: function(oneServerResponse) { return some Bids, or throw an error. }\r\n * });\r\n *\r\n * @see BidderSpec for the full API and more thorough descriptions.\r\n *\r\n */\r\n\r\n/**\r\n * @typedef {object} BidderSpec An object containing the adapter-specific functions needed to\r\n * make a Bidder.\r\n *\r\n * @property {string} code A code which will be used to uniquely identify this bidder. This should be the same\r\n *   one as is used in the call to registerBidAdapter\r\n * @property {string[]} [aliases] A list of aliases which should also resolve to this bidder.\r\n * @property {MediaType[]} [supportedMediaTypes]: A list of Media Types which the adapter supports.\r\n * @property {function(object): boolean} isBidRequestValid Determines whether or not the given bid has all the params\r\n *   needed to make a valid request.\r\n * @property {function(BidRequest[], bidderRequest): ServerRequest|ServerRequest[]} buildRequests Build the request to the Server\r\n *   which requests Bids for the given array of Requests. Each BidRequest in the argument array is guaranteed to have\r\n *   passed the isBidRequestValid() test.\r\n * @property {function(ServerResponse, BidRequest): Bid[]} interpretResponse Given a successful response from the Server,\r\n *   interpret it and return the Bid objects. This function will be run inside a try/catch.\r\n *   If it throws any errors, your bids will be discarded.\r\n * @property {function(SyncOptions, ServerResponse[]): UserSync[]} [getUserSyncs] Given an array of all the responses\r\n *   from the server, determine which user syncs should occur. The argument array will contain every element\r\n *   which has been sent through to interpretResponse. The order of syncs in this array matters. The most\r\n *   important ones should come first, since publishers may limit how many are dropped on their page.\r\n * @property {function(object): object} transformBidParams Updates bid params before creating bid request\r\n }}\r\n */\r\n\r\n/**\r\n * @typedef {object} BidRequest\r\n *\r\n * @property {string} bidId A string which uniquely identifies this BidRequest in the current Auction.\r\n * @property {object} params Any bidder-specific params which the publisher used in their bid request.\r\n */\r\n\r\n/**\r\n * @typedef {object} BidderAuctionResponse An object encapsulating an adapter response for current Auction\r\n *\r\n * @property {Array<Bid>} bids Contextual bids returned by this adapter, if any\r\n * @property {object|null} fledgeAuctionConfigs Optional FLEDGE response, as a map of impid -> auction_config\r\n */\r\n\r\n/**\r\n * @typedef {object} ServerRequest\r\n *\r\n * @property {('GET'|'POST')} method The type of request which this is.\r\n * @property {string} url The endpoint for the request. For example, \"//bids.example.com\".\r\n * @property {string|object} data Data to be sent in the request.\r\n * @property {object} options Content-Type set in the header of the bid request, overrides default 'text/plain'.\r\n *   If this is a GET request, they'll become query params. If it's a POST request, they'll be added to the body.\r\n *   Strings will be added as-is. Objects will be unpacked into query params based on key/value mappings, or\r\n *   JSON-serialized into the Request body.\r\n */\r\n\r\n/**\r\n * @typedef {object} ServerResponse\r\n *\r\n * @property {*} body The response body. If this is legal JSON, then it will be parsed. Otherwise it'll be a\r\n *   string with the body's content.\r\n * @property {{get: function(string): string} headers The response headers.\r\n *   Call this like `ServerResponse.headers.get(\"Content-Type\")`\r\n */\r\n\r\n/**\r\n * @typedef {object} Bid\r\n *\r\n * @property {string} requestId The specific BidRequest which this bid is aimed at.\r\n *   This should match the BidRequest.bidId which this Bid targets.\r\n * @property {string} ad A URL which can be used to load this ad, if it's chosen by the publisher.\r\n * @property {string} currency The currency code for the cpm value\r\n * @property {number} cpm The bid price, in US cents per thousand impressions.\r\n * @property {number} ttl Time-to-live - how long (in seconds) Prebid can use this bid.\r\n * @property {boolean} netRevenue Boolean defining whether the bid is Net or Gross.  The default is true (Net).\r\n * @property {number} height The height of the ad, in pixels.\r\n * @property {number} width The width of the ad, in pixels.\r\n *\r\n * @property {object} [native] Object for storing native creative assets\r\n * @property {object} [video] Object for storing video response data\r\n * @property {object} [meta] Object for storing bid meta data\r\n * @property {string} [meta.primaryCatId] The IAB primary category ID\r\n * @property [Renderer] renderer A Renderer which can be used as a default for this bid,\r\n *   if the publisher doesn't override it. This is only relevant for Outstream Video bids.\r\n */\r\n\r\n/**\r\n * @typedef {Object} SyncOptions\r\n *\r\n * An object containing information about usersyncs which the adapter should obey.\r\n *\r\n * @property {boolean} iframeEnabled True if iframe usersyncs are allowed, and false otherwise\r\n * @property {boolean} pixelEnabled True if image usersyncs are allowed, and false otherwise\r\n */\r\n\r\n/**\r\n * TODO: Move this to the UserSync module after that PR is merged.\r\n *\r\n * @typedef {object} UserSync\r\n *\r\n * @property {('image'|'iframe')} type The type of user sync to be done.\r\n * @property {string} url The URL which makes the sync happen.\r\n */\r\n\r\n// common params for all mediaTypes\r\nconst COMMON_BID_RESPONSE_KEYS = ['cpm', 'ttl', 'creativeId', 'netRevenue', 'currency'];\r\n\r\nconst DEFAULT_REFRESHIN_DAYS = 1;\r\n\r\n/**\r\n * Register a bidder with prebid, using the given spec.\r\n *\r\n * If possible, Adapter modules should use this function instead of adapterManager.registerBidAdapter().\r\n *\r\n * @param {BidderSpec} spec An object containing the bare-bones functions we need to make a Bidder.\r\n */\r\nexport function registerBidder(spec) {\r\n  const mediaTypes = Array.isArray(spec.supportedMediaTypes)\r\n    ? { supportedMediaTypes: spec.supportedMediaTypes }\r\n    : undefined;\r\n  function putBidder(spec) {\r\n    const bidder = newBidder(spec);\r\n    adapterManager.registerBidAdapter(bidder, spec.code, mediaTypes);\r\n  }\r\n\r\n  putBidder(spec);\r\n  if (Array.isArray(spec.aliases)) {\r\n    spec.aliases.forEach(alias => {\r\n      let aliasCode = alias;\r\n      let gvlid;\r\n      let skipPbsAliasing;\r\n      if (isPlainObject(alias)) {\r\n        aliasCode = alias.code;\r\n        gvlid = alias.gvlid;\r\n        skipPbsAliasing = alias.skipPbsAliasing\r\n      }\r\n      adapterManager.aliasRegistry[aliasCode] = spec.code;\r\n      putBidder(Object.assign({}, spec, { code: aliasCode, gvlid, skipPbsAliasing }));\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Make a new bidder from the given spec. This is exported mainly for testing.\r\n * Adapters will probably find it more convenient to use registerBidder instead.\r\n *\r\n * @param {BidderSpec} spec\r\n */\r\nexport function newBidder(spec) {\r\n  return Object.assign(new Adapter(spec.code), {\r\n    getSpec: function() {\r\n      return Object.freeze(spec);\r\n    },\r\n    registerSyncs,\r\n    callBids: function(bidderRequest, addBidResponse, done, ajax, onTimelyResponse, configEnabledCallback) {\r\n      if (!Array.isArray(bidderRequest.bids)) {\r\n        return;\r\n      }\r\n\r\n      const adUnitCodesHandled = {};\r\n      function addBidWithCode(adUnitCode, bid) {\r\n        const metrics = useMetrics(bid.metrics);\r\n        metrics.checkpoint('addBidResponse');\r\n        adUnitCodesHandled[adUnitCode] = true;\r\n        if (metrics.measureTime('addBidResponse.validate', () => isValid(adUnitCode, bid))) {\r\n          addBidResponse(adUnitCode, bid);\r\n        }\r\n      }\r\n\r\n      // After all the responses have come back, call done() and\r\n      // register any required usersync pixels.\r\n      const responses = [];\r\n      function afterAllResponses() {\r\n        done();\r\n        config.runWithBidder(spec.code, () => {\r\n          events.emit(CONSTANTS.EVENTS.BIDDER_DONE, bidderRequest);\r\n          registerSyncs(responses, bidderRequest.gdprConsent, bidderRequest.uspConsent);\r\n        });\r\n      }\r\n\r\n      const validBidRequests = adapterMetrics(bidderRequest)\r\n        .measureTime('validate', () => bidderRequest.bids.filter(filterAndWarn));\r\n\r\n      if (validBidRequests.length === 0) {\r\n        afterAllResponses();\r\n        return;\r\n      }\r\n      const bidRequestMap = {};\r\n      validBidRequests.forEach(bid => {\r\n        bidRequestMap[bid.bidId] = bid;\r\n        // Delete this once we are 1.0\r\n        if (!bid.adUnitCode) {\r\n          bid.adUnitCode = bid.placementCode\r\n        }\r\n      });\r\n\r\n      processBidderRequests(spec, validBidRequests, bidderRequest, ajax, configEnabledCallback, {\r\n        onRequest: requestObject => events.emit(CONSTANTS.EVENTS.BEFORE_BIDDER_HTTP, bidderRequest, requestObject),\r\n        onResponse: (resp) => {\r\n          onTimelyResponse(spec.code);\r\n          responses.push(resp)\r\n        },\r\n        /** Process eventual BidderAuctionResponse.fledgeAuctionConfig field in response.\r\n         * @param {Array<FledgeAuctionConfig>} fledgeAuctionConfigs\r\n         */\r\n        onFledgeAuctionConfigs: (fledgeAuctionConfigs) => {\r\n          fledgeAuctionConfigs.forEach((fledgeAuctionConfig) => {\r\n            const bidRequest = bidRequestMap[fledgeAuctionConfig.bidId];\r\n            if (bidRequest) {\r\n              addComponentAuction(bidRequest, fledgeAuctionConfig);\r\n            }\r\n          });\r\n        },\r\n        // If the server responds with an error, there's not much we can do beside logging.\r\n        onError: (errorMessage, error) => {\r\n          onTimelyResponse(spec.code);\r\n          adapterManager.callBidderError(spec.code, error, bidderRequest)\r\n          events.emit(CONSTANTS.EVENTS.BIDDER_ERROR, { error, bidderRequest });\r\n          logError(`Server call for ${spec.code} failed: ${errorMessage} ${error.status}. Continuing without bids.`);\r\n        },\r\n        onBid: (bid) => {\r\n          const bidRequest = bidRequestMap[bid.requestId];\r\n          if (bidRequest) {\r\n            bid.adapterCode = bidRequest.bidder;\r\n            if (isInvalidAlternateBidder(bid.bidderCode, bidRequest.bidder)) {\r\n              logWarn(`${bid.bidderCode} is not a registered partner or known bidder of ${bidRequest.bidder}, hence continuing without bid. If you wish to support this bidder, please mark allowAlternateBidderCodes as true in bidderSettings.`);\r\n              return;\r\n            }\r\n            // creating a copy of original values as cpm and currency are modified later\r\n            bid.originalCpm = bid.cpm;\r\n            bid.originalCurrency = bid.currency;\r\n            bid.meta = bid.meta || Object.assign({}, bid[bidRequest.bidder]);\r\n            const prebidBid = Object.assign(createBid(CONSTANTS.STATUS.GOOD, bidRequest), bid);\r\n            addBidWithCode(bidRequest.adUnitCode, prebidBid);\r\n          } else {\r\n            logWarn(`Bidder ${spec.code} made bid for unknown request ID: ${bid.requestId}. Ignoring.`);\r\n          }\r\n        },\r\n        onCompletion: afterAllResponses,\r\n      });\r\n    }\r\n  });\r\n\r\n  function isInvalidAlternateBidder(responseBidder, requestBidder) {\r\n    let allowAlternateBidderCodes = bidderSettings.get(requestBidder, 'allowAlternateBidderCodes') || false;\r\n    let alternateBiddersList = bidderSettings.get(requestBidder, 'allowedAlternateBidderCodes');\r\n    if (!!responseBidder && !!requestBidder && requestBidder !== responseBidder) {\r\n      alternateBiddersList = isArray(alternateBiddersList) ? alternateBiddersList.map(val => val.trim().toLowerCase()).filter(val => !!val).filter(uniques) : alternateBiddersList;\r\n      if (!allowAlternateBidderCodes || (isArray(alternateBiddersList) && (alternateBiddersList[0] !== '*' && !alternateBiddersList.includes(responseBidder)))) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function registerSyncs(responses, gdprConsent, uspConsent) {\r\n    registerSyncInner(spec, responses, gdprConsent, uspConsent);\r\n  }\r\n\r\n  function filterAndWarn(bid) {\r\n    if (!spec.isBidRequestValid(bid)) {\r\n      logWarn(`Invalid bid sent to bidder ${spec.code}: ${JSON.stringify(bid)}`);\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Run a set of bid requests - that entails converting them to HTTP requests, sending\r\n * them over the network, and parsing the responses.\r\n *\r\n * @param spec bid adapter spec\r\n * @param bids bid requests to run\r\n * @param bidderRequest the bid request object that `bids` is connected to\r\n * @param ajax ajax method to use\r\n * @param wrapCallback {function(callback)} a function used to wrap every callback (for the purpose of `config.currentBidder`)\r\n * @param onRequest {function({})} invoked once for each HTTP request built by the adapter - with the raw request\r\n * @param onResponse {function({})} invoked once on each successful HTTP response - with the raw response\r\n * @param onError {function(String, {})} invoked once for each HTTP error - with status code and response\r\n * @param onBid {function({})} invoked once for each bid in the response - with the bid as returned by interpretResponse\r\n * @param onCompletion {function()} invoked once when all bid requests have been processed\r\n */\r\nexport const processBidderRequests = hook('sync', function (spec, bids, bidderRequest, ajax, wrapCallback, {onRequest, onResponse, onFledgeAuctionConfigs, onError, onBid, onCompletion}) {\r\n  const metrics = adapterMetrics(bidderRequest);\r\n  onCompletion = metrics.startTiming('total').stopBefore(onCompletion);\r\n\r\n  let requests = metrics.measureTime('buildRequests', () => spec.buildRequests(bids, bidderRequest));\r\n\r\n  if (!requests || requests.length === 0) {\r\n    onCompletion();\r\n    return;\r\n  }\r\n  if (!Array.isArray(requests)) {\r\n    requests = [requests];\r\n  }\r\n\r\n  const requestDone = delayExecution(onCompletion, requests.length);\r\n\r\n  requests.forEach((request) => {\r\n    const requestMetrics = metrics.fork();\r\n    function addBid(bid) {\r\n      if (bid != null) bid.metrics = requestMetrics.fork().renameWith();\r\n      onBid(bid);\r\n    }\r\n    // If the server responds successfully, use the adapter code to unpack the Bids from it.\r\n    // If the adapter code fails, no bids should be added. After all the bids have been added,\r\n    // make sure to call the `requestDone` function so that we're one step closer to calling onCompletion().\r\n    const onSuccess = wrapCallback(function(response, responseObj) {\r\n      networkDone();\r\n      try {\r\n        response = JSON.parse(response);\r\n      } catch (e) { /* response might not be JSON... that's ok. */ }\r\n\r\n      // Make response headers available for #1742. These are lazy-loaded because most adapters won't need them.\r\n      response = {\r\n        body: response,\r\n        headers: headerParser(responseObj)\r\n      };\r\n      onResponse(response);\r\n\r\n      try {\r\n        response = requestMetrics.measureTime('interpretResponse', () => spec.interpretResponse(response, request));\r\n      } catch (err) {\r\n        logError(`Bidder ${spec.code} failed to interpret the server's response. Continuing without bids`, null, err);\r\n        requestDone();\r\n        return;\r\n      }\r\n\r\n      let bids;\r\n      // Extract additional data from a structured {BidderAuctionResponse} response\r\n      if (response && isArray(response.fledgeAuctionConfigs)) {\r\n        onFledgeAuctionConfigs(response.fledgeAuctionConfigs);\r\n        bids = response.bids;\r\n      } else {\r\n        bids = response;\r\n      }\r\n\r\n      if (bids) {\r\n        if (isArray(bids)) {\r\n          bids.forEach(addBid);\r\n        } else {\r\n          addBid(bids);\r\n        }\r\n      }\r\n      requestDone();\r\n\r\n      function headerParser(xmlHttpResponse) {\r\n        return {\r\n          get: responseObj.getResponseHeader.bind(responseObj)\r\n        };\r\n      }\r\n    });\r\n\r\n    const onFailure = wrapCallback(function (errorMessage, error) {\r\n      networkDone();\r\n      onError(errorMessage, error);\r\n      requestDone();\r\n    });\r\n\r\n    onRequest(request);\r\n\r\n    const networkDone = requestMetrics.startTiming('net');\r\n    switch (request.method) {\r\n      case 'GET':\r\n        ajax(\r\n          `${request.url}${formatGetParameters(request.data)}`,\r\n          {\r\n            success: onSuccess,\r\n            error: onFailure\r\n          },\r\n          undefined,\r\n          Object.assign({\r\n            method: 'GET',\r\n            withCredentials: true\r\n          }, request.options)\r\n        );\r\n        break;\r\n      case 'POST':\r\n        ajax(\r\n          request.url,\r\n          {\r\n            success: onSuccess,\r\n            error: onFailure\r\n          },\r\n          typeof request.data === 'string' ? request.data : JSON.stringify(request.data),\r\n          Object.assign({\r\n            method: 'POST',\r\n            contentType: 'text/plain',\r\n            withCredentials: true\r\n          }, request.options)\r\n        );\r\n        break;\r\n      default:\r\n        logWarn(`Skipping invalid request from ${spec.code}. Request type ${request.type} must be GET or POST`);\r\n        requestDone();\r\n    }\r\n\r\n    function formatGetParameters(data) {\r\n      if (data) {\r\n        return `?${typeof data === 'object' ? parseQueryStringParameters(data) : data}`;\r\n      }\r\n\r\n      return '';\r\n    }\r\n  })\r\n}, 'processBidderRequests')\r\n\r\nexport const registerSyncInner = hook('async', function(spec, responses, gdprConsent, uspConsent) {\r\n  const aliasSyncEnabled = config.getConfig('userSync.aliasSyncEnabled');\r\n  if (spec.getUserSyncs && (aliasSyncEnabled || !adapterManager.aliasRegistry[spec.code])) {\r\n    let filterConfig = config.getConfig('userSync.filterSettings');\r\n    let syncs = spec.getUserSyncs({\r\n      iframeEnabled: !!(filterConfig && (filterConfig.iframe || filterConfig.all)),\r\n      pixelEnabled: !!(filterConfig && (filterConfig.image || filterConfig.all)),\r\n    }, responses, gdprConsent, uspConsent);\r\n    if (syncs) {\r\n      if (!Array.isArray(syncs)) {\r\n        syncs = [syncs];\r\n      }\r\n      syncs.forEach((sync) => {\r\n        userSync.registerSync(sync.type, spec.code, sync.url)\r\n      });\r\n    }\r\n  }\r\n}, 'registerSyncs')\r\n\r\nexport const addComponentAuction = hook('sync', (_bidRequest, fledgeAuctionConfig) => {\r\n  logInfo(`bidderFactory.addComponentAuction`, fledgeAuctionConfig);\r\n}, 'addComponentAuction')\r\n\r\nexport function preloadBidderMappingFile(fn, adUnits) {\r\n  if (!config.getConfig('adpod.brandCategoryExclusion')) {\r\n    return fn.call(this, adUnits);\r\n  }\r\n  let adPodBidders = adUnits\r\n    .filter((adUnit) => deepAccess(adUnit, 'mediaTypes.video.context') === ADPOD)\r\n    .map((adUnit) => adUnit.bids.map((bid) => bid.bidder))\r\n    .reduce(flatten, [])\r\n    .filter(uniques);\r\n\r\n  adPodBidders.forEach(bidder => {\r\n    let bidderSpec = adapterManager.getBidAdapter(bidder);\r\n    if (bidderSpec.getSpec().getMappingFileInfo) {\r\n      let info = bidderSpec.getSpec().getMappingFileInfo();\r\n      let refreshInDays = (info.refreshInDays) ? info.refreshInDays : DEFAULT_REFRESHIN_DAYS;\r\n      let key = (info.localStorageKey) ? info.localStorageKey : bidderSpec.getSpec().code;\r\n      let mappingData = storage.getDataFromLocalStorage(key);\r\n      try {\r\n        mappingData = mappingData ? JSON.parse(mappingData) : undefined;\r\n        if (!mappingData || timestamp() > mappingData.lastUpdated + refreshInDays * 24 * 60 * 60 * 1000) {\r\n          ajax(info.url,\r\n            {\r\n              success: (response) => {\r\n                try {\r\n                  response = JSON.parse(response);\r\n                  let mapping = {\r\n                    lastUpdated: timestamp(),\r\n                    mapping: response.mapping\r\n                  }\r\n                  storage.setDataInLocalStorage(key, JSON.stringify(mapping));\r\n                } catch (error) {\r\n                  logError(`Failed to parse ${bidder} bidder translation mapping file`);\r\n                }\r\n              },\r\n              error: () => {\r\n                logError(`Failed to load ${bidder} bidder translation file`)\r\n              }\r\n            },\r\n          );\r\n        }\r\n      } catch (error) {\r\n        logError(`Failed to parse ${bidder} bidder translation mapping file`);\r\n      }\r\n    }\r\n  });\r\n  fn.call(this, adUnits);\r\n}\r\n\r\ngetHook('checkAdUnitSetup').before(preloadBidderMappingFile);\r\n\r\n/**\r\n * Reads the data stored in localstorage and returns iab subcategory\r\n * @param {string} bidderCode bidderCode\r\n * @param {string} category bidders category\r\n */\r\nexport function getIabSubCategory(bidderCode, category) {\r\n  let bidderSpec = adapterManager.getBidAdapter(bidderCode);\r\n  if (bidderSpec.getSpec().getMappingFileInfo) {\r\n    let info = bidderSpec.getSpec().getMappingFileInfo();\r\n    let key = (info.localStorageKey) ? info.localStorageKey : bidderSpec.getBidderCode();\r\n    let data = storage.getDataFromLocalStorage(key);\r\n    if (data) {\r\n      try {\r\n        data = JSON.parse(data);\r\n      } catch (error) {\r\n        logError(`Failed to parse ${bidderCode} mapping data stored in local storage`);\r\n      }\r\n      return (data.mapping[category]) ? data.mapping[category] : null;\r\n    }\r\n  }\r\n}\r\n\r\n// check that the bid has a width and height set\r\nfunction validBidSize(adUnitCode, bid, {index = auctionManager.index} = {}) {\r\n  if ((bid.width || parseInt(bid.width, 10) === 0) && (bid.height || parseInt(bid.height, 10) === 0)) {\r\n    bid.width = parseInt(bid.width, 10);\r\n    bid.height = parseInt(bid.height, 10);\r\n    return true;\r\n  }\r\n\r\n  const bidRequest = index.getBidRequest(bid);\r\n  const mediaTypes = index.getMediaTypes(bid);\r\n\r\n  const sizes = (bidRequest && bidRequest.sizes) || (mediaTypes && mediaTypes.banner && mediaTypes.banner.sizes);\r\n  const parsedSizes = parseSizesInput(sizes);\r\n\r\n  // if a banner impression has one valid size, we assign that size to any bid\r\n  // response that does not explicitly set width or height\r\n  if (parsedSizes.length === 1) {\r\n    const [ width, height ] = parsedSizes[0].split('x');\r\n    bid.width = parseInt(width, 10);\r\n    bid.height = parseInt(height, 10);\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n// Validate the arguments sent to us by the adapter. If this returns false, the bid should be totally ignored.\r\nexport function isValid(adUnitCode, bid, {index = auctionManager.index} = {}) {\r\n  function hasValidKeys() {\r\n    let bidKeys = Object.keys(bid);\r\n    return COMMON_BID_RESPONSE_KEYS.every(key => includes(bidKeys, key) && !includes([undefined, null], bid[key]));\r\n  }\r\n\r\n  function errorMessage(msg) {\r\n    return `Invalid bid from ${bid.bidderCode}. Ignoring bid: ${msg}`;\r\n  }\r\n\r\n  if (!adUnitCode) {\r\n    logWarn('No adUnitCode was supplied to addBidResponse.');\r\n    return false;\r\n  }\r\n\r\n  if (!bid) {\r\n    logWarn(`Some adapter tried to add an undefined bid for ${adUnitCode}.`);\r\n    return false;\r\n  }\r\n\r\n  if (!hasValidKeys()) {\r\n    logError(errorMessage(`Bidder ${bid.bidderCode} is missing required params. Check http://prebid.org/dev-docs/bidder-adapter-1.html for list of params.`));\r\n    return false;\r\n  }\r\n\r\n  if (FEATURES.NATIVE && bid.mediaType === 'native' && !nativeBidIsValid(bid, {index})) {\r\n    logError(errorMessage('Native bid missing some required properties.'));\r\n    return false;\r\n  }\r\n  if (bid.mediaType === 'video' && !isValidVideoBid(bid, {index})) {\r\n    logError(errorMessage(`Video bid does not have required vastUrl or renderer property`));\r\n    return false;\r\n  }\r\n  if (bid.mediaType === 'banner' && !validBidSize(adUnitCode, bid, {index})) {\r\n    logError(errorMessage(`Banner bids require a width and height`));\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction adapterMetrics(bidderRequest) {\r\n  return useMetrics(bidderRequest.metrics).renameWith(n => [`adapter.client.${n}`, `adapters.client.${bidderRequest.bidderCode}.${n}`])\r\n}\r\n","import {includes} from './polyfill.js';\r\nimport { logError, logWarn, insertElement, setScriptAttributes } from './utils.js';\r\n\r\nconst _requestCache = new WeakMap();\r\n// The below list contains modules or vendors whom Prebid allows to load external JS.\r\nconst _approvedLoadExternalJSList = [\r\n  'debugging',\r\n  'adloox',\r\n  'criteo',\r\n  'outstream',\r\n  'adagio',\r\n  'spotx',\r\n  'browsi',\r\n  'brandmetrics',\r\n  'justtag',\r\n  'tncId',\r\n  'akamaidap',\r\n  'ftrackId',\r\n  'inskin',\r\n  'hadron',\r\n  'medianet',\r\n  'improvedigital'\r\n]\r\n\r\n/**\r\n * Loads external javascript. Can only be used if external JS is approved by Prebid. See https://github.com/prebid/prebid-js-external-js-template#policy\r\n * Each unique URL will be loaded at most 1 time.\r\n * @param {string} url the url to load\r\n * @param {string} moduleCode bidderCode or module code of the module requesting this resource\r\n * @param {function} [callback] callback function to be called after the script is loaded\r\n * @param {Document} [doc] the context document, in which the script will be loaded, defaults to loaded document\r\n * @param {object} an object of attributes to be added to the script with setAttribute by [key] and [value]; Only the attributes passed in the first request of a url will be added.\r\n */\r\nexport function loadExternalScript(url, moduleCode, callback, doc, attributes) {\r\n  if (!moduleCode || !url) {\r\n    logError('cannot load external script without url and moduleCode');\r\n    return;\r\n  }\r\n  if (!includes(_approvedLoadExternalJSList, moduleCode)) {\r\n    logError(`${moduleCode} not whitelisted for loading external JavaScript`);\r\n    return;\r\n  }\r\n  if (!doc) {\r\n    doc = document; // provide a \"valid\" key for the WeakMap\r\n  }\r\n  // only load each asset once\r\n  const storedCachedObject = getCacheObject(doc, url);\r\n  if (storedCachedObject) {\r\n    if (callback && typeof callback === 'function') {\r\n      if (storedCachedObject.loaded) {\r\n        // invokeCallbacks immediately\r\n        callback();\r\n      } else {\r\n        // queue the callback\r\n        storedCachedObject.callbacks.push(callback);\r\n      }\r\n    }\r\n    return storedCachedObject.tag;\r\n  }\r\n  const cachedDocObj = _requestCache.get(doc) || {};\r\n  const cacheObject = {\r\n    loaded: false,\r\n    tag: null,\r\n    callbacks: []\r\n  };\r\n  cachedDocObj[url] = cacheObject;\r\n  _requestCache.set(doc, cachedDocObj);\r\n\r\n  if (callback && typeof callback === 'function') {\r\n    cacheObject.callbacks.push(callback);\r\n  }\r\n\r\n  logWarn(`module ${moduleCode} is loading external JavaScript`);\r\n  return requestResource(url, function () {\r\n    cacheObject.loaded = true;\r\n    try {\r\n      for (let i = 0; i < cacheObject.callbacks.length; i++) {\r\n        cacheObject.callbacks[i]();\r\n      }\r\n    } catch (e) {\r\n      logError('Error executing callback', 'adloader.js:loadExternalScript', e);\r\n    }\r\n  }, doc, attributes);\r\n\r\n  function requestResource(tagSrc, callback, doc, attributes) {\r\n    if (!doc) {\r\n      doc = document;\r\n    }\r\n    var jptScript = doc.createElement('script');\r\n    jptScript.type = 'text/javascript';\r\n    jptScript.async = true;\r\n\r\n    const cacheObject = getCacheObject(doc, url);\r\n    if (cacheObject) {\r\n      cacheObject.tag = jptScript;\r\n    }\r\n\r\n    if (jptScript.readyState) {\r\n      jptScript.onreadystatechange = function () {\r\n        if (jptScript.readyState === 'loaded' || jptScript.readyState === 'complete') {\r\n          jptScript.onreadystatechange = null;\r\n          callback();\r\n        }\r\n      };\r\n    } else {\r\n      jptScript.onload = function () {\r\n        callback();\r\n      };\r\n    }\r\n\r\n    jptScript.src = tagSrc;\r\n\r\n    if (attributes) {\r\n      setScriptAttributes(jptScript, attributes);\r\n    }\r\n\r\n    // add the new script tag to the page\r\n    insertElement(jptScript, doc);\r\n\r\n    return jptScript;\r\n  }\r\n  function getCacheObject(doc, url) {\r\n    const cachedDocObj = _requestCache.get(doc);\r\n    if (cachedDocObj && cachedDocObj[url]) {\r\n      return cachedDocObj[url];\r\n    }\r\n    return null; // return new cache object?\r\n  }\r\n};\r\n","import { config } from './config.js';\r\nimport { logMessage, logError, parseUrl, buildUrl, _each } from './utils.js';\r\n\r\nconst XHR_DONE = 4;\r\n\r\n/**\r\n * Simple IE9+ and cross-browser ajax request function\r\n * Note: x-domain requests in IE9 do not support the use of cookies\r\n *\r\n * @param url string url\r\n * @param callback {object | function} callback\r\n * @param data mixed data\r\n * @param options object\r\n */\r\nexport const ajax = ajaxBuilder();\r\n\r\nexport function ajaxBuilder(timeout = 3000, {request, done} = {}) {\r\n  return function(url, callback, data, options = {}) {\r\n    try {\r\n      let x;\r\n      let method = options.method || (data ? 'POST' : 'GET');\r\n      let parser = document.createElement('a');\r\n      parser.href = url;\r\n\r\n      let callbacks = typeof callback === 'object' && callback !== null ? callback : {\r\n        success: function() {\r\n          logMessage('xhr success');\r\n        },\r\n        error: function(e) {\r\n          logError('xhr error', null, e);\r\n        }\r\n      };\r\n\r\n      if (typeof callback === 'function') {\r\n        callbacks.success = callback;\r\n      }\r\n\r\n      x = new window.XMLHttpRequest();\r\n\r\n      x.onreadystatechange = function () {\r\n        if (x.readyState === XHR_DONE) {\r\n          if (typeof done === 'function') {\r\n            done(parser.origin);\r\n          }\r\n          let status = x.status;\r\n          if ((status >= 200 && status < 300) || status === 304) {\r\n            callbacks.success(x.responseText, x);\r\n          } else {\r\n            callbacks.error(x.statusText, x);\r\n          }\r\n        }\r\n      };\r\n\r\n      // Disabled timeout temporarily to avoid xhr failed requests. https://github.com/prebid/Prebid.js/issues/2648\r\n      if (!config.getConfig('disableAjaxTimeout')) {\r\n        x.ontimeout = function () {\r\n          logError('  xhr timeout after ', x.timeout, 'ms');\r\n        };\r\n      }\r\n\r\n      if (method === 'GET' && data) {\r\n        let urlInfo = parseUrl(url, options);\r\n        Object.assign(urlInfo.search, data);\r\n        url = buildUrl(urlInfo);\r\n      }\r\n\r\n      x.open(method, url, true);\r\n      // IE needs timeout to be set after open - see #1410\r\n      // Disabled timeout temporarily to avoid xhr failed requests. https://github.com/prebid/Prebid.js/issues/2648\r\n      if (!config.getConfig('disableAjaxTimeout')) {\r\n        x.timeout = timeout;\r\n      }\r\n\r\n      if (options.withCredentials) {\r\n        x.withCredentials = true;\r\n      }\r\n      _each(options.customHeaders, (value, header) => {\r\n        x.setRequestHeader(header, value);\r\n      });\r\n      if (options.preflight) {\r\n        x.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n      }\r\n      x.setRequestHeader('Content-Type', options.contentType || 'text/plain');\r\n\r\n      if (typeof request === 'function') {\r\n        request(parser.origin);\r\n      }\r\n\r\n      if (method === 'POST' && data) {\r\n        x.send(data);\r\n      } else {\r\n        x.send();\r\n      }\r\n    } catch (error) {\r\n      logError('xhr construction', error);\r\n      typeof callback === 'object' && callback !== null && callback.error(error);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Module for auction instances.\r\n *\r\n * In Prebid 0.x, $$PREBID_GLOBAL$$ had _bidsRequested and _bidsReceived as public properties.\r\n * Starting 1.0, Prebid will support concurrent auctions. Each auction instance will store private properties, bidsRequested and bidsReceived.\r\n *\r\n * AuctionManager will create instance of auction and will store all the auctions.\r\n *\r\n */\r\n\r\n/**\r\n  * @typedef {Object} AdUnit An object containing the adUnit configuration.\r\n  *\r\n  * @property {string} code A code which will be used to uniquely identify this bidder. This should be the same\r\n  *   one as is used in the call to registerBidAdapter\r\n  * @property {Array.<size>} sizes A list of size for adUnit.\r\n  * @property {object} params Any bidder-specific params which the publisher used in their bid request.\r\n  *   This is guaranteed to have passed the spec.areParamsValid() test.\r\n  */\r\n\r\n/**\r\n * @typedef {Array.<number>} size\r\n */\r\n\r\n/**\r\n * @typedef {Array.<string>} AdUnitCode\r\n */\r\n\r\n/**\r\n * @typedef {Object} BidderRequest\r\n *\r\n * @property {string} bidderCode - adUnit bidder\r\n * @property {number} auctionId - random UUID\r\n * @property {string} bidderRequestId - random string, unique key set on all bidRequest.bids[]\r\n * @property {Array.<Bid>} bids\r\n * @property {number} auctionStart - Date.now() at auction start\r\n * @property {number} timeout - callback timeout\r\n * @property {refererInfo} refererInfo - referer info object\r\n * @property {string} [tid] - random UUID (used for s2s)\r\n * @property {string} [src] - s2s or client (used for s2s)\r\n */\r\n\r\n/**\r\n * @typedef {Object} BidReceived\r\n * //TODO add all properties\r\n */\r\n\r\n/**\r\n * @typedef {Object} Auction\r\n *\r\n * @property {function(): string} getAuctionStatus - returns the auction status which can be any one of 'started', 'in progress' or 'completed'\r\n * @property {function(): AdUnit[]} getAdUnits - return the adUnits for this auction instance\r\n * @property {function(): AdUnitCode[]} getAdUnitCodes - return the adUnitCodes for this auction instance\r\n * @property {function(): BidRequest[]} getBidRequests - get all bid requests for this auction instance\r\n * @property {function(): BidReceived[]} getBidsReceived - get all bid received for this auction instance\r\n * @property {function(): void} startAuctionTimer - sets the bidsBackHandler callback and starts the timer for auction\r\n * @property {function(): void} callBids - sends requests to all adapters for bids\r\n */\r\n\r\nimport {\r\n  flatten, timestamp, adUnitsFilter, deepAccess, getValue, parseUrl, generateUUID,\r\n  logMessage, bind, logError, logInfo, logWarn, isEmpty, _each, isFn, isEmptyStr\r\n} from './utils.js';\r\nimport { getPriceBucketString } from './cpmBucketManager.js';\r\nimport { getNativeTargeting } from './native.js';\r\nimport { getCacheUrl, store } from './videoCache.js';\r\nimport { Renderer } from './Renderer.js';\r\nimport { config } from './config.js';\r\nimport { userSync } from './userSync.js';\r\nimport { hook } from './hook.js';\r\nimport {find, includes} from './polyfill.js';\r\nimport { OUTSTREAM } from './video.js';\r\nimport { VIDEO } from './mediaTypes.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {bidderSettings} from './bidderSettings.js';\r\nimport * as events from './events.js'\r\nimport adapterManager from './adapterManager.js';\r\nimport CONSTANTS from './constants.json';\r\nimport {GreedyPromise} from './utils/promise.js';\r\nimport {useMetrics} from './utils/perfMetrics.js';\r\n\r\nconst { syncUsers } = userSync;\r\n\r\nexport const AUCTION_STARTED = 'started';\r\nexport const AUCTION_IN_PROGRESS = 'inProgress';\r\nexport const AUCTION_COMPLETED = 'completed';\r\n\r\n// register event for bid adjustment\r\nevents.on(CONSTANTS.EVENTS.BID_ADJUSTMENT, function (bid) {\r\n  adjustBids(bid);\r\n});\r\n\r\nconst MAX_REQUESTS_PER_ORIGIN = 4;\r\nconst outstandingRequests = {};\r\nconst sourceInfo = {};\r\nconst queuedCalls = [];\r\n\r\n/**\r\n * Clear global state for tests\r\n */\r\nexport function resetAuctionState() {\r\n  queuedCalls.length = 0;\r\n  [outstandingRequests, sourceInfo].forEach((ob) => Object.keys(ob).forEach((k) => { delete ob[k] }));\r\n}\r\n\r\n/**\r\n  * Creates new auction instance\r\n  *\r\n  * @param {Object} requestConfig\r\n  * @param {AdUnit} requestConfig.adUnits\r\n  * @param {AdUnitCode} requestConfig.adUnitCodes\r\n  * @param {function():void} requestConfig.callback\r\n  * @param {number} requestConfig.cbTimeout\r\n  * @param {Array.<string>} requestConfig.labels\r\n  * @param {string} requestConfig.auctionId\r\n  * @param {{global: {}, bidder: {}}} ortb2Fragments first party data, separated into global\r\n  *    (from getConfig('ortb2') + requestBids({ortb2})) and bidder (a map from bidderCode to ortb2)\r\n  * @returns {Auction} auction instance\r\n  */\r\nexport function newAuction({adUnits, adUnitCodes, callback, cbTimeout, labels, auctionId, ortb2Fragments, metrics}) {\r\n  metrics = useMetrics(metrics);\r\n  let _adUnits = adUnits;\r\n  let _labels = labels;\r\n  let _adUnitCodes = adUnitCodes;\r\n  let _bidderRequests = [];\r\n  let _bidsReceived = [];\r\n  let _noBids = [];\r\n  let _auctionStart;\r\n  let _auctionEnd;\r\n  let _auctionId = auctionId || generateUUID();\r\n  let _auctionStatus;\r\n  let _callback = callback;\r\n  let _timer;\r\n  let _timeout = cbTimeout;\r\n  let _winningBids = [];\r\n  let _timelyBidders = new Set();\r\n\r\n  function addBidRequests(bidderRequests) { _bidderRequests = _bidderRequests.concat(bidderRequests); }\r\n  function addBidReceived(bidsReceived) { _bidsReceived = _bidsReceived.concat(bidsReceived); }\r\n  function addNoBid(noBid) { _noBids = _noBids.concat(noBid); }\r\n\r\n  function getProperties() {\r\n    return {\r\n      auctionId: _auctionId,\r\n      timestamp: _auctionStart,\r\n      auctionEnd: _auctionEnd,\r\n      auctionStatus: _auctionStatus,\r\n      adUnits: _adUnits,\r\n      adUnitCodes: _adUnitCodes,\r\n      labels: _labels,\r\n      bidderRequests: _bidderRequests,\r\n      noBids: _noBids,\r\n      bidsReceived: _bidsReceived,\r\n      winningBids: _winningBids,\r\n      timeout: _timeout,\r\n      metrics: metrics\r\n    };\r\n  }\r\n\r\n  function startAuctionTimer() {\r\n    const timedOut = true;\r\n    const timeoutCallback = executeCallback.bind(null, timedOut);\r\n    let timer = setTimeout(timeoutCallback, _timeout);\r\n    _timer = timer;\r\n  }\r\n\r\n  function executeCallback(timedOut, cleartimer) {\r\n    // clear timer when done calls executeCallback\r\n    if (cleartimer) {\r\n      clearTimeout(_timer);\r\n    }\r\n\r\n    if (_auctionEnd === undefined) {\r\n      let timedOutBidders = [];\r\n      if (timedOut) {\r\n        logMessage(`Auction ${_auctionId} timedOut`);\r\n        timedOutBidders = getTimedOutBids(_bidderRequests, _timelyBidders);\r\n        if (timedOutBidders.length) {\r\n          events.emit(CONSTANTS.EVENTS.BID_TIMEOUT, timedOutBidders);\r\n        }\r\n      }\r\n\r\n      _auctionStatus = AUCTION_COMPLETED;\r\n      _auctionEnd = Date.now();\r\n      metrics.checkpoint('auctionEnd');\r\n      metrics.timeBetween('requestBids', 'auctionEnd', 'requestBids.total');\r\n      metrics.timeBetween('callBids', 'auctionEnd', 'requestBids.callBids');\r\n\r\n      events.emit(CONSTANTS.EVENTS.AUCTION_END, getProperties());\r\n      bidsBackCallback(_adUnits, function () {\r\n        try {\r\n          if (_callback != null) {\r\n            const adUnitCodes = _adUnitCodes;\r\n            const bids = _bidsReceived\r\n              .filter(bind.call(adUnitsFilter, this, adUnitCodes))\r\n              .reduce(groupByPlacement, {});\r\n            _callback.apply($$PREBID_GLOBAL$$, [bids, timedOut, _auctionId]);\r\n            _callback = null;\r\n          }\r\n        } catch (e) {\r\n          logError('Error executing bidsBackHandler', null, e);\r\n        } finally {\r\n          // Calling timed out bidders\r\n          if (timedOutBidders.length) {\r\n            adapterManager.callTimedOutBidders(adUnits, timedOutBidders, _timeout);\r\n          }\r\n          // Only automatically sync if the publisher has not chosen to \"enableOverride\"\r\n          let userSyncConfig = config.getConfig('userSync') || {};\r\n          if (!userSyncConfig.enableOverride) {\r\n            // Delay the auto sync by the config delay\r\n            syncUsers(userSyncConfig.syncDelay);\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  function auctionDone() {\r\n    config.resetBidder();\r\n    // when all bidders have called done callback atleast once it means auction is complete\r\n    logInfo(`Bids Received for Auction with id: ${_auctionId}`, _bidsReceived);\r\n    _auctionStatus = AUCTION_COMPLETED;\r\n    executeCallback(false, true);\r\n  }\r\n\r\n  function onTimelyResponse(bidderCode) {\r\n    _timelyBidders.add(bidderCode);\r\n  }\r\n\r\n  function callBids() {\r\n    _auctionStatus = AUCTION_STARTED;\r\n    _auctionStart = Date.now();\r\n\r\n    let bidRequests = metrics.measureTime('requestBids.makeRequests',\r\n      () => adapterManager.makeBidRequests(_adUnits, _auctionStart, _auctionId, _timeout, _labels, ortb2Fragments, metrics));\r\n    logInfo(`Bids Requested for Auction with id: ${_auctionId}`, bidRequests);\r\n\r\n    metrics.checkpoint('callBids')\r\n\r\n    if (bidRequests.length < 1) {\r\n      logWarn('No valid bid requests returned for auction');\r\n      auctionDone();\r\n    } else {\r\n      addBidderRequests.call({\r\n        dispatch: addBidderRequestsCallback,\r\n        context: this\r\n      }, bidRequests);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * callback executed after addBidderRequests completes\r\n   * @param {BidRequest[]} bidRequests\r\n   */\r\n  function addBidderRequestsCallback(bidRequests) {\r\n    bidRequests.forEach(bidRequest => {\r\n      addBidRequests(bidRequest);\r\n    });\r\n\r\n    let requests = {};\r\n    let call = {\r\n      bidRequests,\r\n      run: () => {\r\n        startAuctionTimer();\r\n\r\n        _auctionStatus = AUCTION_IN_PROGRESS;\r\n\r\n        events.emit(CONSTANTS.EVENTS.AUCTION_INIT, getProperties());\r\n\r\n        let callbacks = auctionCallbacks(auctionDone, this);\r\n        adapterManager.callBids(_adUnits, bidRequests, callbacks.addBidResponse, callbacks.adapterDone, {\r\n          request(source, origin) {\r\n            increment(outstandingRequests, origin);\r\n            increment(requests, source);\r\n\r\n            if (!sourceInfo[source]) {\r\n              sourceInfo[source] = {\r\n                SRA: true,\r\n                origin\r\n              };\r\n            }\r\n            if (requests[source] > 1) {\r\n              sourceInfo[source].SRA = false;\r\n            }\r\n          },\r\n          done(origin) {\r\n            outstandingRequests[origin]--;\r\n            if (queuedCalls[0]) {\r\n              if (runIfOriginHasCapacity(queuedCalls[0])) {\r\n                queuedCalls.shift();\r\n              }\r\n            }\r\n          }\r\n        }, _timeout, onTimelyResponse, ortb2Fragments);\r\n      }\r\n    };\r\n\r\n    if (!runIfOriginHasCapacity(call)) {\r\n      logWarn('queueing auction due to limited endpoint capacity');\r\n      queuedCalls.push(call);\r\n    }\r\n\r\n    function runIfOriginHasCapacity(call) {\r\n      let hasCapacity = true;\r\n\r\n      let maxRequests = config.getConfig('maxRequestsPerOrigin') || MAX_REQUESTS_PER_ORIGIN;\r\n\r\n      call.bidRequests.some(bidRequest => {\r\n        let requests = 1;\r\n        let source = (typeof bidRequest.src !== 'undefined' && bidRequest.src === CONSTANTS.S2S.SRC) ? 's2s'\r\n          : bidRequest.bidderCode;\r\n        // if we have no previous info on this source just let them through\r\n        if (sourceInfo[source]) {\r\n          if (sourceInfo[source].SRA === false) {\r\n            // some bidders might use more than the MAX_REQUESTS_PER_ORIGIN in a single auction.  In those cases\r\n            // set their request count to MAX_REQUESTS_PER_ORIGIN so the auction isn't permanently queued waiting\r\n            // for capacity for that bidder\r\n            requests = Math.min(bidRequest.bids.length, maxRequests);\r\n          }\r\n          if (outstandingRequests[sourceInfo[source].origin] + requests > maxRequests) {\r\n            hasCapacity = false;\r\n          }\r\n        }\r\n        // return only used for terminating this .some() iteration early if it is determined we don't have capacity\r\n        return !hasCapacity;\r\n      });\r\n\r\n      if (hasCapacity) {\r\n        call.run();\r\n      }\r\n\r\n      return hasCapacity;\r\n    }\r\n\r\n    function increment(obj, prop) {\r\n      if (typeof obj[prop] === 'undefined') {\r\n        obj[prop] = 1\r\n      } else {\r\n        obj[prop]++;\r\n      }\r\n    }\r\n  }\r\n\r\n  function addWinningBid(winningBid) {\r\n    _winningBids = _winningBids.concat(winningBid);\r\n    adapterManager.callBidWonBidder(winningBid.adapterCode || winningBid.bidder, winningBid, adUnits);\r\n  }\r\n\r\n  function setBidTargeting(bid) {\r\n    adapterManager.callSetTargetingBidder(bid.adapterCode || bid.bidder, bid);\r\n  }\r\n\r\n  return {\r\n    addBidReceived,\r\n    addNoBid,\r\n    executeCallback,\r\n    callBids,\r\n    addWinningBid,\r\n    setBidTargeting,\r\n    getWinningBids: () => _winningBids,\r\n    getAuctionStart: () => _auctionStart,\r\n    getTimeout: () => _timeout,\r\n    getAuctionId: () => _auctionId,\r\n    getAuctionStatus: () => _auctionStatus,\r\n    getAdUnits: () => _adUnits,\r\n    getAdUnitCodes: () => _adUnitCodes,\r\n    getBidRequests: () => _bidderRequests,\r\n    getBidsReceived: () => _bidsReceived,\r\n    getNoBids: () => _noBids,\r\n    getFPD: () => ortb2Fragments,\r\n    getMetrics: () => metrics,\r\n  };\r\n}\r\n\r\nexport const addBidResponse = hook('sync', function(adUnitCode, bid) {\r\n  this.dispatch.call(null, adUnitCode, bid);\r\n}, 'addBidResponse');\r\n\r\nexport const addBidderRequests = hook('sync', function(bidderRequests) {\r\n  this.dispatch.call(this.context, bidderRequests);\r\n}, 'addBidderRequests');\r\n\r\nexport const bidsBackCallback = hook('async', function (adUnits, callback) {\r\n  if (callback) {\r\n    callback();\r\n  }\r\n}, 'bidsBackCallback');\r\n\r\nexport function auctionCallbacks(auctionDone, auctionInstance, {index = auctionManager.index} = {}) {\r\n  let outstandingBidsAdded = 0;\r\n  let allAdapterCalledDone = false;\r\n  let bidderRequestsDone = new Set();\r\n  let bidResponseMap = {};\r\n  const ready = {};\r\n\r\n  function waitFor(requestId, result) {\r\n    if (ready[requestId] == null) {\r\n      ready[requestId] = GreedyPromise.resolve();\r\n    }\r\n    ready[requestId] = ready[requestId].then(() => GreedyPromise.resolve(result).catch(() => {}))\r\n  }\r\n\r\n  function guard(bidderRequest, fn) {\r\n    let timeout = bidderRequest.timeout;\r\n    if (timeout == null || timeout > auctionInstance.getTimeout()) {\r\n      timeout = auctionInstance.getTimeout();\r\n    }\r\n    const timeRemaining = auctionInstance.getAuctionStart() + timeout - Date.now();\r\n    const wait = ready[bidderRequest.bidderRequestId];\r\n    const orphanWait = ready['']; // also wait for \"orphan\" responses that are not associated with any request\r\n    if ((wait != null || orphanWait != null) && timeRemaining > 0) {\r\n      GreedyPromise.race([\r\n        GreedyPromise.timeout(timeRemaining),\r\n        GreedyPromise.resolve(orphanWait).then(() => wait)\r\n      ]).then(fn);\r\n    } else {\r\n      fn();\r\n    }\r\n  }\r\n\r\n  function afterBidAdded() {\r\n    outstandingBidsAdded--;\r\n    if (allAdapterCalledDone && outstandingBidsAdded === 0) {\r\n      auctionDone()\r\n    }\r\n  }\r\n\r\n  function handleBidResponse(adUnitCode, bid) {\r\n    bidResponseMap[bid.requestId] = true;\r\n\r\n    outstandingBidsAdded++;\r\n    let auctionId = auctionInstance.getAuctionId();\r\n\r\n    let bidResponse = getPreparedBidForAuction({adUnitCode, bid, auctionId});\r\n\r\n    if (bidResponse.mediaType === 'video') {\r\n      tryAddVideoBid(auctionInstance, bidResponse, afterBidAdded);\r\n    } else {\r\n      addBidToAuction(auctionInstance, bidResponse);\r\n      afterBidAdded();\r\n    }\r\n  }\r\n\r\n  function adapterDone() {\r\n    let bidderRequest = this;\r\n    let bidderRequests = auctionInstance.getBidRequests();\r\n    const auctionOptionsConfig = config.getConfig('auctionOptions');\r\n\r\n    bidderRequestsDone.add(bidderRequest);\r\n\r\n    if (auctionOptionsConfig && !isEmpty(auctionOptionsConfig)) {\r\n      const secondaryBidders = auctionOptionsConfig.secondaryBidders;\r\n      if (secondaryBidders && !bidderRequests.every(bidder => includes(secondaryBidders, bidder.bidderCode))) {\r\n        bidderRequests = bidderRequests.filter(request => !includes(secondaryBidders, request.bidderCode));\r\n      }\r\n    }\r\n\r\n    allAdapterCalledDone = bidderRequests.every(bidderRequest => bidderRequestsDone.has(bidderRequest));\r\n\r\n    bidderRequest.bids.forEach(bid => {\r\n      if (!bidResponseMap[bid.bidId]) {\r\n        auctionInstance.addNoBid(bid);\r\n        events.emit(CONSTANTS.EVENTS.NO_BID, bid);\r\n      }\r\n    });\r\n\r\n    if (allAdapterCalledDone && outstandingBidsAdded === 0) {\r\n      auctionDone();\r\n    }\r\n  }\r\n\r\n  return {\r\n    addBidResponse: function (adUnit, bid) {\r\n      const bidderRequest = index.getBidderRequest(bid);\r\n      waitFor((bidderRequest && bidderRequest.bidderRequestId) || '', addBidResponse.call({\r\n        dispatch: handleBidResponse,\r\n      }, adUnit, bid));\r\n    },\r\n    adapterDone: function () {\r\n      guard(this, adapterDone.bind(this))\r\n    }\r\n  }\r\n}\r\n\r\nexport function doCallbacksIfTimedout(auctionInstance, bidResponse) {\r\n  if (bidResponse.timeToRespond > auctionInstance.getTimeout() + config.getConfig('timeoutBuffer')) {\r\n    auctionInstance.executeCallback(true);\r\n  }\r\n}\r\n\r\n// Add a bid to the auction.\r\nexport function addBidToAuction(auctionInstance, bidResponse) {\r\n  setupBidTargeting(bidResponse);\r\n\r\n  const metrics = useMetrics(bidResponse.metrics);\r\n  metrics.timeSince('addBidResponse', 'addBidResponse.total');\r\n\r\n  events.emit(CONSTANTS.EVENTS.BID_RESPONSE, bidResponse);\r\n  auctionInstance.addBidReceived(bidResponse);\r\n\r\n  doCallbacksIfTimedout(auctionInstance, bidResponse);\r\n}\r\n\r\n// Video bids may fail if the cache is down, or there's trouble on the network.\r\nfunction tryAddVideoBid(auctionInstance, bidResponse, afterBidAdded, {index = auctionManager.index} = {}) {\r\n  let addBid = true;\r\n\r\n  const videoMediaType = deepAccess(\r\n    index.getMediaTypes({\r\n      requestId: bidResponse.originalRequestId || bidResponse.requestId,\r\n      transactionId: bidResponse.transactionId\r\n    }), 'video');\r\n  const context = videoMediaType && deepAccess(videoMediaType, 'context');\r\n  const useCacheKey = videoMediaType && deepAccess(videoMediaType, 'useCacheKey');\r\n\r\n  if (config.getConfig('cache.url') && (useCacheKey || context !== OUTSTREAM)) {\r\n    if (!bidResponse.videoCacheKey || config.getConfig('cache.ignoreBidderCacheKey')) {\r\n      addBid = false;\r\n      callPrebidCache(auctionInstance, bidResponse, afterBidAdded, videoMediaType);\r\n    } else if (!bidResponse.vastUrl) {\r\n      logError('videoCacheKey specified but not required vastUrl for video bid');\r\n      addBid = false;\r\n    }\r\n  }\r\n  if (addBid) {\r\n    addBidToAuction(auctionInstance, bidResponse);\r\n    afterBidAdded();\r\n  }\r\n}\r\n\r\nconst storeInCache = (batch) => {\r\n  store(batch.map(entry => entry.bidResponse), function (error, cacheIds) {\r\n    cacheIds.forEach((cacheId, i) => {\r\n      const { auctionInstance, bidResponse, afterBidAdded } = batch[i];\r\n      if (error) {\r\n        logWarn(`Failed to save to the video cache: ${error}. Video bid must be discarded.`);\r\n\r\n        doCallbacksIfTimedout(auctionInstance, bidResponse);\r\n      } else {\r\n        if (cacheId.uuid === '') {\r\n          logWarn(`Supplied video cache key was already in use by Prebid Cache; caching attempt was rejected. Video bid must be discarded.`);\r\n\r\n          doCallbacksIfTimedout(auctionInstance, bidResponse);\r\n        } else {\r\n          bidResponse.videoCacheKey = cacheId.uuid;\r\n\r\n          if (!bidResponse.vastUrl) {\r\n            bidResponse.vastUrl = getCacheUrl(bidResponse.videoCacheKey);\r\n          }\r\n          addBidToAuction(auctionInstance, bidResponse);\r\n          afterBidAdded();\r\n        }\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nlet batchSize, batchTimeout;\r\nconfig.getConfig('cache', (cacheConfig) => {\r\n  batchSize = typeof cacheConfig.cache.batchSize === 'number' && cacheConfig.cache.batchSize > 0\r\n    ? cacheConfig.cache.batchSize\r\n    : 1;\r\n  batchTimeout = typeof cacheConfig.cache.batchTimeout === 'number' && cacheConfig.cache.batchTimeout > 0\r\n    ? cacheConfig.cache.batchTimeout\r\n    : 0;\r\n});\r\n\r\nexport const batchingCache = (timeout = setTimeout, cache = storeInCache) => {\r\n  let batches = [[]];\r\n  let debouncing = false;\r\n  const noTimeout = cb => cb();\r\n\r\n  return function(auctionInstance, bidResponse, afterBidAdded) {\r\n    const batchFunc = batchTimeout > 0 ? timeout : noTimeout;\r\n    if (batches[batches.length - 1].length >= batchSize) {\r\n      batches.push([]);\r\n    }\r\n\r\n    batches[batches.length - 1].push({auctionInstance, bidResponse, afterBidAdded});\r\n\r\n    if (!debouncing) {\r\n      debouncing = true;\r\n      batchFunc(() => {\r\n        batches.forEach(cache);\r\n        batches = [[]];\r\n        debouncing = false;\r\n      }, batchTimeout);\r\n    }\r\n  }\r\n};\r\n\r\nconst batchAndStore = batchingCache();\r\n\r\nexport const callPrebidCache = hook('async', function(auctionInstance, bidResponse, afterBidAdded, videoMediaType) {\r\n  batchAndStore(auctionInstance, bidResponse, afterBidAdded);\r\n}, 'callPrebidCache');\r\n\r\n// Postprocess the bids so that all the universal properties exist, no matter which bidder they came from.\r\n// This should be called before addBidToAuction().\r\nfunction getPreparedBidForAuction({adUnitCode, bid, auctionId}, {index = auctionManager.index} = {}) {\r\n  const bidderRequest = index.getBidderRequest(bid);\r\n  const start = (bidderRequest && bidderRequest.start) || bid.requestTimestamp;\r\n\r\n  let bidObject = Object.assign({}, bid, {\r\n    auctionId,\r\n    responseTimestamp: timestamp(),\r\n    requestTimestamp: start,\r\n    cpm: parseFloat(bid.cpm) || 0,\r\n    bidder: bid.bidderCode,\r\n    adUnitCode\r\n  });\r\n\r\n  bidObject.timeToRespond = bidObject.responseTimestamp - bidObject.requestTimestamp;\r\n\r\n  // Let listeners know that now is the time to adjust the bid, if they want to.\r\n  //\r\n  // CAREFUL: Publishers rely on certain bid properties to be available (like cpm),\r\n  // but others to not be set yet (like priceStrings). See #1372 and #1389.\r\n  events.emit(CONSTANTS.EVENTS.BID_ADJUSTMENT, bidObject);\r\n\r\n  // a publisher-defined renderer can be used to render bids\r\n  const adUnitRenderer = index.getAdUnit(bidObject).renderer;\r\n\r\n  // a publisher can also define a renderer for a mediaType\r\n  const bidObjectMediaType = bidObject.mediaType;\r\n  const mediaTypes = index.getMediaTypes(bidObject);\r\n  const bidMediaType = mediaTypes && mediaTypes[bidObjectMediaType];\r\n\r\n  var mediaTypeRenderer = bidMediaType && bidMediaType.renderer;\r\n\r\n  var renderer = null;\r\n\r\n  // the renderer for the mediaType takes precendence\r\n  if (mediaTypeRenderer && mediaTypeRenderer.url && mediaTypeRenderer.render && !(mediaTypeRenderer.backupOnly === true && bid.renderer)) {\r\n    renderer = mediaTypeRenderer;\r\n  } else if (adUnitRenderer && adUnitRenderer.url && adUnitRenderer.render && !(adUnitRenderer.backupOnly === true && bid.renderer)) {\r\n    renderer = adUnitRenderer;\r\n  }\r\n\r\n  if (renderer) {\r\n    // be aware, an adapter could already have installed the bidder, in which case this overwrite's the existing adapter\r\n    bidObject.renderer = Renderer.install({ url: renderer.url, config: renderer.options });// rename options to config, to make it consistent?\r\n    bidObject.renderer.setRender(renderer.render);\r\n  }\r\n\r\n  // Use the config value 'mediaTypeGranularity' if it has been defined for mediaType, else use 'customPriceBucket'\r\n  const mediaTypeGranularity = getMediaTypeGranularity(bid.mediaType, mediaTypes, config.getConfig('mediaTypePriceGranularity'));\r\n  const priceStringsObj = getPriceBucketString(\r\n    bidObject.cpm,\r\n    (typeof mediaTypeGranularity === 'object') ? mediaTypeGranularity : config.getConfig('customPriceBucket'),\r\n    config.getConfig('currency.granularityMultiplier')\r\n  );\r\n  bidObject.pbLg = priceStringsObj.low;\r\n  bidObject.pbMg = priceStringsObj.med;\r\n  bidObject.pbHg = priceStringsObj.high;\r\n  bidObject.pbAg = priceStringsObj.auto;\r\n  bidObject.pbDg = priceStringsObj.dense;\r\n  bidObject.pbCg = priceStringsObj.custom;\r\n\r\n  return bidObject;\r\n}\r\n\r\nfunction setupBidTargeting(bidObject) {\r\n  let keyValues;\r\n  const cpmCheck = (bidderSettings.get(bidObject.bidderCode, 'allowZeroCpmBids') === true) ? bidObject.cpm >= 0 : bidObject.cpm > 0;\r\n  if (bidObject.bidderCode && (cpmCheck || bidObject.dealId)) {\r\n    keyValues = getKeyValueTargetingPairs(bidObject.bidderCode, bidObject);\r\n  }\r\n\r\n  // use any targeting provided as defaults, otherwise just set from getKeyValueTargetingPairs\r\n  bidObject.adserverTargeting = Object.assign(bidObject.adserverTargeting || {}, keyValues);\r\n}\r\n\r\n/**\r\n * @param {MediaType} mediaType\r\n * @param mediaTypes media types map from adUnit\r\n * @param {MediaTypePriceGranularity} [mediaTypePriceGranularity]\r\n * @returns {(Object|string|undefined)}\r\n */\r\nexport function getMediaTypeGranularity(mediaType, mediaTypes, mediaTypePriceGranularity) {\r\n  if (mediaType && mediaTypePriceGranularity) {\r\n    if (mediaType === VIDEO) {\r\n      const context = deepAccess(mediaTypes, `${VIDEO}.context`, 'instream');\r\n      if (mediaTypePriceGranularity[`${VIDEO}-${context}`]) {\r\n        return mediaTypePriceGranularity[`${VIDEO}-${context}`];\r\n      }\r\n    }\r\n    return mediaTypePriceGranularity[mediaType];\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns the price granularity defined. It can be either publisher defined or default value\r\n * @param bid bid response object\r\n * @param index\r\n * @returns {string} granularity\r\n */\r\nexport const getPriceGranularity = (bid, {index = auctionManager.index} = {}) => {\r\n  // Use the config value 'mediaTypeGranularity' if it has been set for mediaType, else use 'priceGranularity'\r\n  const mediaTypeGranularity = getMediaTypeGranularity(bid.mediaType, index.getMediaTypes(bid), config.getConfig('mediaTypePriceGranularity'));\r\n  const granularity = (typeof bid.mediaType === 'string' && mediaTypeGranularity) ? ((typeof mediaTypeGranularity === 'string') ? mediaTypeGranularity : 'custom') : config.getConfig('priceGranularity');\r\n  return granularity;\r\n}\r\n\r\n/**\r\n * This function returns a function to get bid price by price granularity\r\n * @param {string} granularity\r\n * @returns {function}\r\n */\r\nexport const getPriceByGranularity = (granularity) => {\r\n  return (bid) => {\r\n    const bidGranularity = granularity || getPriceGranularity(bid);\r\n    if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.AUTO) {\r\n      return bid.pbAg;\r\n    } else if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.DENSE) {\r\n      return bid.pbDg;\r\n    } else if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.LOW) {\r\n      return bid.pbLg;\r\n    } else if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.MEDIUM) {\r\n      return bid.pbMg;\r\n    } else if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.HIGH) {\r\n      return bid.pbHg;\r\n    } else if (bidGranularity === CONSTANTS.GRANULARITY_OPTIONS.CUSTOM) {\r\n      return bid.pbCg;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * This function returns a function to get first advertiser domain from bid response meta\r\n * @returns {function}\r\n */\r\nexport const getAdvertiserDomain = () => {\r\n  return (bid) => {\r\n    return (bid.meta && bid.meta.advertiserDomains && bid.meta.advertiserDomains.length > 0) ? bid.meta.advertiserDomains[0] : '';\r\n  }\r\n}\r\n\r\n// factory for key value objs\r\nfunction createKeyVal(key, value) {\r\n  return {\r\n    key,\r\n    val: (typeof value === 'function')\r\n      ? function (bidResponse, bidReq) {\r\n        return value(bidResponse, bidReq);\r\n      }\r\n      : function (bidResponse) {\r\n        return getValue(bidResponse, value);\r\n      }\r\n  };\r\n}\r\n\r\nfunction defaultAdserverTargeting() {\r\n  const TARGETING_KEYS = CONSTANTS.TARGETING_KEYS;\r\n  return [\r\n    createKeyVal(TARGETING_KEYS.BIDDER, 'bidderCode'),\r\n    createKeyVal(TARGETING_KEYS.AD_ID, 'adId'),\r\n    createKeyVal(TARGETING_KEYS.PRICE_BUCKET, getPriceByGranularity()),\r\n    createKeyVal(TARGETING_KEYS.SIZE, 'size'),\r\n    createKeyVal(TARGETING_KEYS.DEAL, 'dealId'),\r\n    createKeyVal(TARGETING_KEYS.SOURCE, 'source'),\r\n    createKeyVal(TARGETING_KEYS.FORMAT, 'mediaType'),\r\n    createKeyVal(TARGETING_KEYS.ADOMAIN, getAdvertiserDomain()),\r\n  ]\r\n}\r\n\r\n/**\r\n * @param {string} mediaType\r\n * @param {string} bidderCode\r\n * @param {BidRequest} bidReq\r\n * @returns {*}\r\n */\r\nexport function getStandardBidderSettings(mediaType, bidderCode) {\r\n  const TARGETING_KEYS = CONSTANTS.TARGETING_KEYS;\r\n  const standardSettings = Object.assign({}, bidderSettings.settingsFor(null));\r\n\r\n  if (!standardSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING]) {\r\n    standardSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING] = defaultAdserverTargeting();\r\n  }\r\n\r\n  if (mediaType === 'video') {\r\n    const adserverTargeting = standardSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING].slice();\r\n    standardSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING] = adserverTargeting;\r\n\r\n    // Adding hb_uuid + hb_cache_id\r\n    [TARGETING_KEYS.UUID, TARGETING_KEYS.CACHE_ID].forEach(targetingKeyVal => {\r\n      if (typeof find(adserverTargeting, kvPair => kvPair.key === targetingKeyVal) === 'undefined') {\r\n        adserverTargeting.push(createKeyVal(targetingKeyVal, 'videoCacheKey'));\r\n      }\r\n    });\r\n\r\n    // Adding hb_cache_host\r\n    if (config.getConfig('cache.url') && (!bidderCode || bidderSettings.get(bidderCode, 'sendStandardTargeting') !== false)) {\r\n      const urlInfo = parseUrl(config.getConfig('cache.url'));\r\n\r\n      if (typeof find(adserverTargeting, targetingKeyVal => targetingKeyVal.key === TARGETING_KEYS.CACHE_HOST) === 'undefined') {\r\n        adserverTargeting.push(createKeyVal(TARGETING_KEYS.CACHE_HOST, function(bidResponse) {\r\n          return deepAccess(bidResponse, `adserverTargeting.${TARGETING_KEYS.CACHE_HOST}`)\r\n            ? bidResponse.adserverTargeting[TARGETING_KEYS.CACHE_HOST] : urlInfo.hostname;\r\n        }));\r\n      }\r\n    }\r\n  }\r\n  return standardSettings;\r\n}\r\n\r\nexport function getKeyValueTargetingPairs(bidderCode, custBidObj, {index = auctionManager.index} = {}) {\r\n  if (!custBidObj) {\r\n    return {};\r\n  }\r\n  const bidRequest = index.getBidRequest(custBidObj);\r\n  var keyValues = {};\r\n\r\n  // 1) set the keys from \"standard\" setting or from prebid defaults\r\n  // initialize default if not set\r\n  const standardSettings = getStandardBidderSettings(custBidObj.mediaType, bidderCode);\r\n  setKeys(keyValues, standardSettings, custBidObj, bidRequest);\r\n\r\n  // 2) set keys from specific bidder setting override if they exist\r\n  if (bidderCode && bidderSettings.getOwn(bidderCode, CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING)) {\r\n    setKeys(keyValues, bidderSettings.ownSettingsFor(bidderCode), custBidObj, bidRequest);\r\n    custBidObj.sendStandardTargeting = bidderSettings.get(bidderCode, 'sendStandardTargeting');\r\n  }\r\n\r\n  // set native key value targeting\r\n  if (FEATURES.NATIVE && custBidObj['native']) {\r\n    keyValues = Object.assign({}, keyValues, getNativeTargeting(custBidObj));\r\n  }\r\n\r\n  return keyValues;\r\n}\r\n\r\nfunction setKeys(keyValues, bidderSettings, custBidObj, bidReq) {\r\n  var targeting = bidderSettings[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING];\r\n  custBidObj.size = custBidObj.getSize();\r\n\r\n  _each(targeting, function (kvPair) {\r\n    var key = kvPair.key;\r\n    var value = kvPair.val;\r\n\r\n    if (keyValues[key]) {\r\n      logWarn('The key: ' + key + ' is being overwritten');\r\n    }\r\n\r\n    if (isFn(value)) {\r\n      try {\r\n        value = value(custBidObj, bidReq);\r\n      } catch (e) {\r\n        logError('bidmanager', 'ERROR', e);\r\n      }\r\n    }\r\n\r\n    if (\r\n      ((typeof bidderSettings.suppressEmptyKeys !== 'undefined' && bidderSettings.suppressEmptyKeys === true) ||\r\n      key === CONSTANTS.TARGETING_KEYS.DEAL) && // hb_deal is suppressed automatically if not set\r\n      (\r\n        isEmptyStr(value) ||\r\n        value === null ||\r\n        value === undefined\r\n      )\r\n    ) {\r\n      logInfo(\"suppressing empty key '\" + key + \"' from adserver targeting\");\r\n    } else {\r\n      keyValues[key] = value;\r\n    }\r\n  });\r\n\r\n  return keyValues;\r\n}\r\n\r\nexport function adjustBids(bid) {\r\n  let code = bid.bidderCode;\r\n  let bidPriceAdjusted = bid.cpm;\r\n  const bidCpmAdjustment = bidderSettings.get(code || null, 'bidCpmAdjustment');\r\n\r\n  if (bidCpmAdjustment && typeof bidCpmAdjustment === 'function') {\r\n    try {\r\n      bidPriceAdjusted = bidCpmAdjustment(bid.cpm, Object.assign({}, bid));\r\n    } catch (e) {\r\n      logError('Error during bid adjustment', 'bidmanager.js', e);\r\n    }\r\n  }\r\n\r\n  if (bidPriceAdjusted >= 0) {\r\n    bid.cpm = bidPriceAdjusted;\r\n  }\r\n}\r\n\r\n/**\r\n * groupByPlacement is a reduce function that converts an array of Bid objects\r\n * to an object with placement codes as keys, with each key representing an object\r\n * with an array of `Bid` objects for that placement\r\n * @returns {*} as { [adUnitCode]: { bids: [Bid, Bid, Bid] } }\r\n */\r\nfunction groupByPlacement(bidsByPlacement, bid) {\r\n  if (!bidsByPlacement[bid.adUnitCode]) { bidsByPlacement[bid.adUnitCode] = { bids: [] }; }\r\n  bidsByPlacement[bid.adUnitCode].bids.push(bid);\r\n  return bidsByPlacement;\r\n}\r\n\r\n/**\r\n * Returns a list of bids that we haven't received a response yet where the bidder did not call done\r\n * @param {BidRequest[]} bidderRequests List of bids requested for auction instance\r\n * @param {Set} timelyBidders Set of bidders which responded in time\r\n *\r\n * @typedef {Object} TimedOutBid\r\n * @property {string} bidId The id representing the bid\r\n * @property {string} bidder The string name of the bidder\r\n * @property {string} adUnitCode The code used to uniquely identify the ad unit on the publisher's page\r\n * @property {string} auctionId The id representing the auction\r\n *\r\n * @return {Array<TimedOutBid>} List of bids that Prebid hasn't received a response for\r\n */\r\nfunction getTimedOutBids(bidderRequests, timelyBidders) {\r\n  const timedOutBids = bidderRequests\r\n    .map(bid => (bid.bids || []).filter(bid => !timelyBidders.has(bid.bidder)))\r\n    .reduce(flatten, []);\r\n\r\n  return timedOutBids;\r\n}\r\n","/**\r\n * Retrieves request-related bid data.\r\n * All methods are designed to work with Bid (response) objects returned by bid adapters.\r\n */\r\nexport function AuctionIndex(getAuctions) {\r\n  Object.assign(this, {\r\n    /**\r\n     * @param auctionId\r\n     * @returns {*} Auction instance for `auctionId`\r\n     */\r\n    getAuction({auctionId}) {\r\n      if (auctionId != null) {\r\n        return getAuctions()\r\n          .find(auction => auction.getAuctionId() === auctionId);\r\n      }\r\n    },\r\n    /**\r\n     * NOTE: you should prefer {@link #getMediaTypes} for looking up bid media types.\r\n     * @param transactionId\r\n     * @returns adUnit object for `transactionId`\r\n     */\r\n    getAdUnit({transactionId}) {\r\n      if (transactionId != null) {\r\n        return getAuctions()\r\n          .flatMap(a => a.getAdUnits())\r\n          .find(au => au.transactionId === transactionId);\r\n      }\r\n    },\r\n    /**\r\n     * @param transactionId\r\n     * @param requestId?\r\n     * @returns {*} mediaTypes object from bidRequest (through requestId) falling back to the adUnit (through transactionId).\r\n     *\r\n     * The bidRequest is given precedence because its mediaTypes can differ from the adUnit's (if bidder-specific labels are in use).\r\n     * Bids that have no associated request do not have labels either, and use the adUnit's mediaTypes.\r\n     */\r\n    getMediaTypes({transactionId, requestId}) {\r\n      if (requestId != null) {\r\n        const req = this.getBidRequest({requestId});\r\n        if (req != null && (transactionId == null || req.transactionId === transactionId)) {\r\n          return req.mediaTypes;\r\n        }\r\n      } else if (transactionId != null) {\r\n        const au = this.getAdUnit({transactionId});\r\n        if (au != null) {\r\n          return au.mediaTypes;\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @param requestId?\r\n     * @param bidderRequestId?\r\n     * @returns {*} bidderRequest that matches both requestId and bidderRequestId (if either or both are provided).\r\n     *\r\n     * NOTE: Bid responses are not guaranteed to have a corresponding request.\r\n     */\r\n    getBidderRequest({requestId, bidderRequestId}) {\r\n      if (requestId != null || bidderRequestId != null) {\r\n        let bers = getAuctions().flatMap(a => a.getBidRequests());\r\n        if (bidderRequestId != null) {\r\n          bers = bers.filter(ber => ber.bidderRequestId === bidderRequestId);\r\n        }\r\n        if (requestId == null) {\r\n          return bers[0];\r\n        } else {\r\n          return bers.find(ber => ber.bids && ber.bids.find(br => br.bidId === requestId) != null)\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * @param requestId\r\n     * @returns {*} bidRequest object for requestId\r\n     *\r\n     * NOTE: Bid responses are not guaranteed to have a corresponding request.\r\n     */\r\n    getBidRequest({requestId}) {\r\n      if (requestId != null) {\r\n        return getAuctions()\r\n          .flatMap(a => a.getBidRequests())\r\n          .flatMap(ber => ber.bids)\r\n          .find(br => br && br.bidId === requestId);\r\n      }\r\n    }\r\n  });\r\n}\r\n","/**\r\n * AuctionManager modules is responsible for creating auction instances.\r\n * This module is the gateway for Prebid core to access auctions.\r\n * It stores all created instances of auction and can be used to get consolidated values from auction.\r\n */\r\n\r\n/**\r\n * @typedef {Object} AuctionManager\r\n *\r\n * @property {function(): Array} getBidsRequested - returns consolidated bid requests\r\n * @property {function(): Array} getBidsReceived - returns consolidated bid received\r\n * @property {function(): Array} getAllBidsForAdUnitCode - returns consolidated bid received for a given adUnit\r\n * @property {function(): Array} getAdUnits - returns consolidated adUnits\r\n * @property {function(): Array} getAdUnitCodes - returns consolidated adUnitCodes\r\n * @property {function(): Object} createAuction - creates auction instance and stores it for future reference\r\n * @property {function(): Object} findBidByAdId - find bid received by adId. This function will be called by $$PREBID_GLOBAL$$.renderAd\r\n * @property {function(): Object} getStandardBidderAdServerTargeting - returns standard bidder targeting for all the adapters. Refer http://prebid.org/dev-docs/publisher-api-reference.html#module_pbjs.bidderSettings for more details\r\n * @property {function(Object): void} addWinningBid - add a winning bid to an auction based on auctionId\r\n * @property {function(): void} clearAllAuctions - clear all auctions for testing\r\n */\r\n\r\nimport { uniques, flatten, logWarn } from './utils.js';\r\nimport { newAuction, getStandardBidderSettings, AUCTION_COMPLETED } from './auction.js';\r\nimport {find} from './polyfill.js';\r\nimport {AuctionIndex} from './auctionIndex.js';\r\nimport CONSTANTS from './constants.json';\r\nimport {useMetrics} from './utils/perfMetrics.js';\r\n\r\n/**\r\n * Creates new instance of auctionManager. There will only be one instance of auctionManager but\r\n * a factory is created to assist in testing.\r\n *\r\n * @returns {AuctionManager} auctionManagerInstance\r\n */\r\nexport function newAuctionManager() {\r\n  const _auctions = [];\r\n  const auctionManager = {};\r\n\r\n  auctionManager.addWinningBid = function(bid) {\r\n    const metrics = useMetrics(bid.metrics);\r\n    metrics.checkpoint('bidWon');\r\n    metrics.timeBetween('auctionEnd', 'bidWon', 'render.pending');\r\n    metrics.timeBetween('requestBids', 'bidWon', 'render.e2e');\r\n    const auction = find(_auctions, auction => auction.getAuctionId() === bid.auctionId);\r\n    if (auction) {\r\n      bid.status = CONSTANTS.BID_STATUS.RENDERED;\r\n      auction.addWinningBid(bid);\r\n    } else {\r\n      logWarn(`Auction not found when adding winning bid`);\r\n    }\r\n  };\r\n\r\n  auctionManager.getAllWinningBids = function() {\r\n    return _auctions.map(auction => auction.getWinningBids())\r\n      .reduce(flatten, []);\r\n  };\r\n\r\n  auctionManager.getBidsRequested = function() {\r\n    return _auctions.map(auction => auction.getBidRequests())\r\n      .reduce(flatten, []);\r\n  };\r\n\r\n  auctionManager.getNoBids = function() {\r\n    return _auctions.map(auction => auction.getNoBids())\r\n      .reduce(flatten, []);\r\n  };\r\n\r\n  auctionManager.getBidsReceived = function() {\r\n    return _auctions.map((auction) => {\r\n      if (auction.getAuctionStatus() === AUCTION_COMPLETED) {\r\n        return auction.getBidsReceived();\r\n      }\r\n    }).reduce(flatten, [])\r\n      .filter(bid => bid);\r\n  };\r\n\r\n  auctionManager.getAllBidsForAdUnitCode = function(adUnitCode) {\r\n    return _auctions.map((auction) => {\r\n      return auction.getBidsReceived();\r\n    }).reduce(flatten, [])\r\n      .filter(bid => bid && bid.adUnitCode === adUnitCode)\r\n  };\r\n\r\n  auctionManager.getAdUnits = function() {\r\n    return _auctions.map(auction => auction.getAdUnits())\r\n      .reduce(flatten, []);\r\n  };\r\n\r\n  auctionManager.getAdUnitCodes = function() {\r\n    return _auctions.map(auction => auction.getAdUnitCodes())\r\n      .reduce(flatten, [])\r\n      .filter(uniques);\r\n  };\r\n\r\n  auctionManager.createAuction = function(opts) {\r\n    const auction = newAuction(opts);\r\n    _addAuction(auction);\r\n    return auction;\r\n  };\r\n\r\n  auctionManager.findBidByAdId = function(adId) {\r\n    return find(_auctions.map(auction => auction.getBidsReceived()).reduce(flatten, []), bid => bid.adId === adId);\r\n  };\r\n\r\n  auctionManager.getStandardBidderAdServerTargeting = function() {\r\n    return getStandardBidderSettings()[CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING];\r\n  };\r\n\r\n  auctionManager.setStatusForBids = function(adId, status) {\r\n    let bid = auctionManager.findBidByAdId(adId);\r\n    if (bid) bid.status = status;\r\n\r\n    if (bid && status === CONSTANTS.BID_STATUS.BID_TARGETING_SET) {\r\n      const auction = find(_auctions, auction => auction.getAuctionId() === bid.auctionId);\r\n      if (auction) auction.setBidTargeting(bid);\r\n    }\r\n  }\r\n\r\n  auctionManager.getLastAuctionId = function() {\r\n    return _auctions.length && _auctions[_auctions.length - 1].getAuctionId()\r\n  };\r\n\r\n  auctionManager.clearAllAuctions = function() {\r\n    _auctions.length = 0;\r\n  }\r\n\r\n  function _addAuction(auction) {\r\n    _auctions.push(auction);\r\n  }\r\n\r\n  auctionManager.index = new AuctionIndex(() => _auctions);\r\n\r\n  return auctionManager;\r\n}\r\n\r\nexport const auctionManager = newAuctionManager();\r\n","import {deepAccess, mergeDeep} from './utils.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport CONSTANTS from './constants.json';\r\n\r\nexport class ScopedSettings {\r\n  constructor(getSettings, defaultScope) {\r\n    this.getSettings = getSettings;\r\n    this.defaultScope = defaultScope;\r\n  }\r\n\r\n  /**\r\n   * Get setting value at `path` under the given scope, falling back to the default scope if needed.\r\n   * If `scope` is `null`, get the setting's default value.\r\n   * @param scope {String|null}\r\n   * @param path {String}\r\n   * @returns {*}\r\n   */\r\n  get(scope, path) {\r\n    let value = this.getOwn(scope, path);\r\n    if (typeof value === 'undefined') {\r\n      value = this.getOwn(null, path);\r\n    }\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Get the setting value at `path` *without* falling back to the default value.\r\n   * @param scope {String}\r\n   * @param path {String}\r\n   * @returns {*}\r\n   */\r\n  getOwn(scope, path) {\r\n    scope = this.#resolveScope(scope);\r\n    return deepAccess(this.getSettings(), `${scope}.${path}`)\r\n  }\r\n\r\n  /**\r\n   * @returns {string[]} all existing scopes except the default one.\r\n   */\r\n  getScopes() {\r\n    return Object.keys(this.getSettings()).filter((scope) => scope !== this.defaultScope);\r\n  }\r\n\r\n  /**\r\n   * @returns all settings in the given scope, merged with the settings for the default scope.\r\n   */\r\n  settingsFor(scope) {\r\n    return mergeDeep({}, this.ownSettingsFor(null), this.ownSettingsFor(scope));\r\n  }\r\n\r\n  /**\r\n   * @returns all settings in the given scope, *without* any of the default settings.\r\n   */\r\n  ownSettingsFor(scope) {\r\n    scope = this.#resolveScope(scope);\r\n    return this.getSettings()[scope] || {};\r\n  }\r\n\r\n  #resolveScope(scope) {\r\n    if (scope == null) {\r\n      return this.defaultScope;\r\n    } else {\r\n      return scope;\r\n    }\r\n  }\r\n}\r\n\r\nexport const bidderSettings = new ScopedSettings(() => getGlobal().bidderSettings || {}, CONSTANTS.JSON_MAPPING.BD_SETTING_STANDARD);\r\n","import { getUniqueIdentifierStr } from './utils.js';\r\n\r\n/**\r\n Required paramaters\r\n bidderCode,\r\n height,\r\n width,\r\n statusCode\r\n Optional paramaters\r\n adId,\r\n cpm,\r\n ad,\r\n adUrl,\r\n dealId,\r\n priceKeyString;\r\n */\r\nfunction Bid(statusCode, {src = 'client', bidder = '', bidId, transactionId, auctionId} = {}) {\r\n  var _bidSrc = src;\r\n  var _statusCode = statusCode || 0;\r\n\r\n  this.bidderCode = bidder;\r\n  this.width = 0;\r\n  this.height = 0;\r\n  this.statusMessage = _getStatus();\r\n  this.adId = getUniqueIdentifierStr();\r\n  this.requestId = bidId;\r\n  this.transactionId = transactionId;\r\n  this.auctionId = auctionId;\r\n  this.mediaType = 'banner';\r\n  this.source = _bidSrc;\r\n\r\n  function _getStatus() {\r\n    switch (_statusCode) {\r\n      case 0:\r\n        return 'Pending';\r\n      case 1:\r\n        return 'Bid available';\r\n      case 2:\r\n        return 'Bid returned empty or error response';\r\n      case 3:\r\n        return 'Bid timed out';\r\n    }\r\n  }\r\n\r\n  this.getStatusCode = function () {\r\n    return _statusCode;\r\n  };\r\n\r\n  // returns the size of the bid creative. Concatenation of width and height by x.\r\n  this.getSize = function () {\r\n    return this.width + 'x' + this.height;\r\n  };\r\n\r\n  this.getIdentifiers = function () {\r\n    return {\r\n      src: this.source,\r\n      bidder: this.bidderCode,\r\n      bidId: this.requestId,\r\n      transactionId: this.transactionId,\r\n      auctionId: this.auctionId\r\n    }\r\n  };\r\n}\r\n\r\n// Bid factory function.\r\nexport function createBid(statusCode, identifiers) {\r\n  return new Bid(statusCode, identifiers);\r\n}\r\n","/*\r\n * Module for getting and setting Prebid configuration.\r\n*/\r\n\r\n/**\r\n * @typedef {Object} MediaTypePriceGranularity\r\n *\r\n * @property {(string|Object)} [banner]\r\n * @property {(string|Object)} [native]\r\n * @property {(string|Object)} [video]\r\n * @property {(string|Object)} [video-instream]\r\n * @property {(string|Object)} [video-outstream]\r\n */\r\n\r\nimport { isValidPriceConfig } from './cpmBucketManager.js';\r\nimport {find, includes, arrayFrom as from} from './polyfill.js';\r\nimport {\r\n  mergeDeep, deepClone, getParameterByName, isPlainObject, logMessage, logWarn, logError,\r\n  isArray, isStr, isBoolean, deepAccess, bind\r\n} from './utils.js';\r\nimport CONSTANTS from './constants.json';\r\n\r\nconst DEFAULT_DEBUG = getParameterByName(CONSTANTS.DEBUG_MODE).toUpperCase() === 'TRUE';\r\nconst DEFAULT_BIDDER_TIMEOUT = 3000;\r\nconst DEFAULT_ENABLE_SEND_ALL_BIDS = true;\r\nconst DEFAULT_DISABLE_AJAX_TIMEOUT = false;\r\nconst DEFAULT_BID_CACHE = false;\r\nconst DEFAULT_DEVICE_ACCESS = true;\r\nconst DEFAULT_MAX_NESTED_IFRAMES = 10;\r\n\r\nconst DEFAULT_TIMEOUTBUFFER = 400;\r\n\r\nexport const RANDOM = 'random';\r\nconst FIXED = 'fixed';\r\n\r\nconst VALID_ORDERS = {};\r\nVALID_ORDERS[RANDOM] = true;\r\nVALID_ORDERS[FIXED] = true;\r\n\r\nconst DEFAULT_BIDDER_SEQUENCE = RANDOM;\r\n\r\nconst GRANULARITY_OPTIONS = {\r\n  LOW: 'low',\r\n  MEDIUM: 'medium',\r\n  HIGH: 'high',\r\n  AUTO: 'auto',\r\n  DENSE: 'dense',\r\n  CUSTOM: 'custom'\r\n};\r\n\r\nconst ALL_TOPICS = '*';\r\n\r\n/**\r\n * @typedef {object} PrebidConfig\r\n *\r\n * @property {string} cache.url Set a url if we should use prebid-cache to store video bids before adding\r\n *   bids to the auction. **NOTE** This must be set if you want to use the dfpAdServerVideo module.\r\n */\r\n\r\nexport function newConfig() {\r\n  let listeners = [];\r\n  let defaults;\r\n  let config;\r\n  let bidderConfig;\r\n  let currBidder = null;\r\n\r\n  function resetConfig() {\r\n    defaults = {};\r\n    let newConfig = {\r\n      // `debug` is equivalent to legacy `pbjs.logging` property\r\n      _debug: DEFAULT_DEBUG,\r\n      get debug() {\r\n        return this._debug;\r\n      },\r\n      set debug(val) {\r\n        this._debug = val;\r\n      },\r\n\r\n      // default timeout for all bids\r\n      _bidderTimeout: DEFAULT_BIDDER_TIMEOUT,\r\n      get bidderTimeout() {\r\n        return this._bidderTimeout;\r\n      },\r\n      set bidderTimeout(val) {\r\n        this._bidderTimeout = val;\r\n      },\r\n\r\n      _publisherDomain: null,\r\n      get publisherDomain() {\r\n        return this._publisherDomain;\r\n      },\r\n      set publisherDomain(val) {\r\n        logWarn('publisherDomain is deprecated and has no effect since v7 - use pageUrl instead')\r\n        this._publisherDomain = val;\r\n      },\r\n\r\n      // calls existing function which may be moved after deprecation\r\n      _priceGranularity: GRANULARITY_OPTIONS.MEDIUM,\r\n      set priceGranularity(val) {\r\n        if (validatePriceGranularity(val)) {\r\n          if (typeof val === 'string') {\r\n            this._priceGranularity = (hasGranularity(val)) ? val : GRANULARITY_OPTIONS.MEDIUM;\r\n          } else if (isPlainObject(val)) {\r\n            this._customPriceBucket = val;\r\n            this._priceGranularity = GRANULARITY_OPTIONS.CUSTOM;\r\n            logMessage('Using custom price granularity');\r\n          }\r\n        }\r\n      },\r\n      get priceGranularity() {\r\n        return this._priceGranularity;\r\n      },\r\n\r\n      _customPriceBucket: {},\r\n      get customPriceBucket() {\r\n        return this._customPriceBucket;\r\n      },\r\n\r\n      /**\r\n       * mediaTypePriceGranularity\r\n       * @type {MediaTypePriceGranularity}\r\n       */\r\n      _mediaTypePriceGranularity: {},\r\n\r\n      get mediaTypePriceGranularity() {\r\n        return this._mediaTypePriceGranularity;\r\n      },\r\n      set mediaTypePriceGranularity(val) {\r\n        this._mediaTypePriceGranularity = Object.keys(val).reduce((aggregate, item) => {\r\n          if (validatePriceGranularity(val[item])) {\r\n            if (typeof val === 'string') {\r\n              aggregate[item] = (hasGranularity(val[item])) ? val[item] : this._priceGranularity;\r\n            } else if (isPlainObject(val)) {\r\n              aggregate[item] = val[item];\r\n              logMessage(`Using custom price granularity for ${item}`);\r\n            }\r\n          } else {\r\n            logWarn(`Invalid price granularity for media type: ${item}`);\r\n          }\r\n          return aggregate;\r\n        }, {});\r\n      },\r\n\r\n      _sendAllBids: DEFAULT_ENABLE_SEND_ALL_BIDS,\r\n      get enableSendAllBids() {\r\n        return this._sendAllBids;\r\n      },\r\n      set enableSendAllBids(val) {\r\n        this._sendAllBids = val;\r\n      },\r\n\r\n      _useBidCache: DEFAULT_BID_CACHE,\r\n      get useBidCache() {\r\n        return this._useBidCache;\r\n      },\r\n      set useBidCache(val) {\r\n        this._useBidCache = val;\r\n      },\r\n\r\n      /**\r\n       * deviceAccess set to false will disable setCookie, getCookie, hasLocalStorage\r\n       * @type {boolean}\r\n       */\r\n      _deviceAccess: DEFAULT_DEVICE_ACCESS,\r\n      get deviceAccess() {\r\n        return this._deviceAccess;\r\n      },\r\n      set deviceAccess(val) {\r\n        this._deviceAccess = val;\r\n      },\r\n\r\n      _bidderSequence: DEFAULT_BIDDER_SEQUENCE,\r\n      get bidderSequence() {\r\n        return this._bidderSequence;\r\n      },\r\n      set bidderSequence(val) {\r\n        if (VALID_ORDERS[val]) {\r\n          this._bidderSequence = val;\r\n        } else {\r\n          logWarn(`Invalid order: ${val}. Bidder Sequence was not set.`);\r\n        }\r\n      },\r\n\r\n      // timeout buffer to adjust for bidder CDN latency\r\n      _timeoutBuffer: DEFAULT_TIMEOUTBUFFER,\r\n      get timeoutBuffer() {\r\n        return this._timeoutBuffer;\r\n      },\r\n      set timeoutBuffer(val) {\r\n        this._timeoutBuffer = val;\r\n      },\r\n\r\n      _disableAjaxTimeout: DEFAULT_DISABLE_AJAX_TIMEOUT,\r\n      get disableAjaxTimeout() {\r\n        return this._disableAjaxTimeout;\r\n      },\r\n      set disableAjaxTimeout(val) {\r\n        this._disableAjaxTimeout = val;\r\n      },\r\n\r\n      // default max nested iframes for referer detection\r\n      _maxNestedIframes: DEFAULT_MAX_NESTED_IFRAMES,\r\n      get maxNestedIframes() {\r\n        return this._maxNestedIframes;\r\n      },\r\n      set maxNestedIframes(val) {\r\n        this._maxNestedIframes = val;\r\n      },\r\n\r\n      _auctionOptions: {},\r\n      get auctionOptions() {\r\n        return this._auctionOptions;\r\n      },\r\n      set auctionOptions(val) {\r\n        if (validateauctionOptions(val)) {\r\n          this._auctionOptions = val;\r\n        }\r\n      },\r\n    };\r\n\r\n    if (config) {\r\n      callSubscribers(\r\n        Object.keys(config).reduce((memo, topic) => {\r\n          if (config[topic] !== newConfig[topic]) {\r\n            memo[topic] = newConfig[topic] || {};\r\n          }\r\n          return memo;\r\n        },\r\n        {})\r\n      );\r\n    }\r\n\r\n    config = newConfig;\r\n    bidderConfig = {};\r\n\r\n    function hasGranularity(val) {\r\n      return find(Object.keys(GRANULARITY_OPTIONS), option => val === GRANULARITY_OPTIONS[option]);\r\n    }\r\n\r\n    function validatePriceGranularity(val) {\r\n      if (!val) {\r\n        logError('Prebid Error: no value passed to `setPriceGranularity()`');\r\n        return false;\r\n      }\r\n      if (typeof val === 'string') {\r\n        if (!hasGranularity(val)) {\r\n          logWarn('Prebid Warning: setPriceGranularity was called with invalid setting, using `medium` as default.');\r\n        }\r\n      } else if (isPlainObject(val)) {\r\n        if (!isValidPriceConfig(val)) {\r\n          logError('Invalid custom price value passed to `setPriceGranularity()`');\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n\r\n    function validateauctionOptions(val) {\r\n      if (!isPlainObject(val)) {\r\n        logWarn('Auction Options must be an object')\r\n        return false\r\n      }\r\n\r\n      for (let k of Object.keys(val)) {\r\n        if (k !== 'secondaryBidders' && k !== 'suppressStaleRender') {\r\n          logWarn(`Auction Options given an incorrect param: ${k}`)\r\n          return false\r\n        }\r\n        if (k === 'secondaryBidders') {\r\n          if (!isArray(val[k])) {\r\n            logWarn(`Auction Options ${k} must be of type Array`);\r\n            return false\r\n          } else if (!val[k].every(isStr)) {\r\n            logWarn(`Auction Options ${k} must be only string`);\r\n            return false\r\n          }\r\n        } else if (k === 'suppressStaleRender') {\r\n          if (!isBoolean(val[k])) {\r\n            logWarn(`Auction Options ${k} must be of type boolean`);\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns base config with bidder overrides (if there is currently a bidder)\r\n   * @private\r\n   */\r\n  function _getConfig() {\r\n    if (currBidder && bidderConfig && isPlainObject(bidderConfig[currBidder])) {\r\n      let currBidderConfig = bidderConfig[currBidder];\r\n      const configTopicSet = new Set(Object.keys(config).concat(Object.keys(currBidderConfig)));\r\n\r\n      return from(configTopicSet).reduce((memo, topic) => {\r\n        if (typeof currBidderConfig[topic] === 'undefined') {\r\n          memo[topic] = config[topic];\r\n        } else if (typeof config[topic] === 'undefined') {\r\n          memo[topic] = currBidderConfig[topic];\r\n        } else {\r\n          if (isPlainObject(currBidderConfig[topic])) {\r\n            memo[topic] = mergeDeep({}, config[topic], currBidderConfig[topic]);\r\n          } else {\r\n            memo[topic] = currBidderConfig[topic];\r\n          }\r\n        }\r\n        return memo;\r\n      }, {});\r\n    }\r\n    return Object.assign({}, config);\r\n  }\r\n\r\n  function _getRestrictedConfig() {\r\n    // This causes reading 'ortb2' to throw an error; with prebid 7, that will almost\r\n    // always be the incorrect way to access FPD configuration (https://github.com/prebid/Prebid.js/issues/7651)\r\n    // code that needs the ortb2 config should explicitly use `getAnyConfig`\r\n    // TODO: this is meant as a temporary tripwire to catch inadvertent use of `getConfig('ortb')` as we transition.\r\n    // It should be removed once the risk of that happening is low enough.\r\n    const conf = _getConfig();\r\n    Object.defineProperty(conf, 'ortb2', {\r\n      get: function () {\r\n        throw new Error('invalid access to \\'orbt2\\' config - use request parameters instead');\r\n      }\r\n    });\r\n    return conf;\r\n  }\r\n\r\n  const [getAnyConfig, getConfig] = [_getConfig, _getRestrictedConfig].map(accessor => {\r\n    /*\r\n     * Returns configuration object if called without parameters,\r\n     * or single configuration property if given a string matching a configuration\r\n     * property name.  Allows deep access e.g. getConfig('currency.adServerCurrency')\r\n     *\r\n     * If called with callback parameter, or a string and a callback parameter,\r\n     * subscribes to configuration updates. See `subscribe` function for usage.\r\n     */\r\n    return function getConfig(...args) {\r\n      if (args.length <= 1 && typeof args[0] !== 'function') {\r\n        const option = args[0];\r\n        return option ? deepAccess(accessor(), option) : _getConfig();\r\n      }\r\n\r\n      return subscribe(...args);\r\n    }\r\n  })\r\n\r\n  const [readConfig, readAnyConfig] = [getConfig, getAnyConfig].map(wrapee => {\r\n    /*\r\n     * Like getConfig, except that it returns a deepClone of the result.\r\n     */\r\n    return function readConfig(...args) {\r\n      let res = wrapee(...args);\r\n      if (res && typeof res === 'object') {\r\n        res = deepClone(res);\r\n      }\r\n      return res;\r\n    }\r\n  })\r\n\r\n  /**\r\n   * Internal API for modules (such as prebid-server) that might need access to all bidder config\r\n   */\r\n  function getBidderConfig() {\r\n    return bidderConfig;\r\n  }\r\n\r\n  /*\r\n   * Sets configuration given an object containing key-value pairs and calls\r\n   * listeners that were added by the `subscribe` function\r\n   */\r\n  function setConfig(options) {\r\n    if (!isPlainObject(options)) {\r\n      logError('setConfig options must be an object');\r\n      return;\r\n    }\r\n\r\n    let topics = Object.keys(options);\r\n    let topicalConfig = {};\r\n\r\n    topics.forEach(topic => {\r\n      let option = options[topic];\r\n\r\n      if (isPlainObject(defaults[topic]) && isPlainObject(option)) {\r\n        option = Object.assign({}, defaults[topic], option);\r\n      }\r\n\r\n      try {\r\n        topicalConfig[topic] = config[topic] = option;\r\n      } catch (e) {\r\n        logWarn(`Cannot set config for property ${topic} : `, e)\r\n      }\r\n    });\r\n\r\n    callSubscribers(topicalConfig);\r\n  }\r\n\r\n  /**\r\n   * Sets configuration defaults which setConfig values can be applied on top of\r\n   * @param {object} options\r\n   */\r\n  function setDefaults(options) {\r\n    if (!isPlainObject(defaults)) {\r\n      logError('defaults must be an object');\r\n      return;\r\n    }\r\n\r\n    Object.assign(defaults, options);\r\n    // Add default values to config as well\r\n    Object.assign(config, options);\r\n  }\r\n\r\n  /*\r\n   * Adds a function to a set of listeners that are invoked whenever `setConfig`\r\n   * is called. The subscribed function will be passed the options object that\r\n   * was used in the `setConfig` call. Topics can be subscribed to to only get\r\n   * updates when specific properties are updated by passing a topic string as\r\n   * the first parameter.\r\n   *\r\n   * If `options.init` is true, the listener will be immediately called with the current options.\r\n   *\r\n   * Returns an `unsubscribe` function for removing the subscriber from the\r\n   * set of listeners\r\n   *\r\n   * Example use:\r\n   * // subscribe to all configuration changes\r\n   * subscribe((config) => console.log('config set:', config));\r\n   *\r\n   * // subscribe to only 'logging' changes\r\n   * subscribe('logging', (config) => console.log('logging set:', config));\r\n   *\r\n   * // unsubscribe\r\n   * const unsubscribe = subscribe(...);\r\n   * unsubscribe(); // no longer listening\r\n   *\r\n   */\r\n  function subscribe(topic, listener, options = {}) {\r\n    let callback = listener;\r\n\r\n    if (typeof topic !== 'string') {\r\n      // first param should be callback function in this case,\r\n      // meaning it gets called for any config change\r\n      callback = topic;\r\n      topic = ALL_TOPICS;\r\n      options = listener || {};\r\n    }\r\n\r\n    if (typeof callback !== 'function') {\r\n      logError('listener must be a function');\r\n      return;\r\n    }\r\n\r\n    const nl = { topic, callback };\r\n    listeners.push(nl);\r\n\r\n    if (options.init) {\r\n      if (topic === ALL_TOPICS) {\r\n        callback(getConfig());\r\n      } else {\r\n        // eslint-disable-next-line standard/no-callback-literal\r\n        callback({[topic]: getConfig(topic)});\r\n      }\r\n    }\r\n\r\n    // save and call this function to remove the listener\r\n    return function unsubscribe() {\r\n      listeners.splice(listeners.indexOf(nl), 1);\r\n    };\r\n  }\r\n\r\n  /*\r\n   * Calls listeners that were added by the `subscribe` function\r\n   */\r\n  function callSubscribers(options) {\r\n    const TOPICS = Object.keys(options);\r\n\r\n    // call subscribers of a specific topic, passing only that configuration\r\n    listeners\r\n      .filter(listener => includes(TOPICS, listener.topic))\r\n      .forEach(listener => {\r\n        listener.callback({ [listener.topic]: options[listener.topic] });\r\n      });\r\n\r\n    // call subscribers that didn't give a topic, passing everything that was set\r\n    listeners\r\n      .filter(listener => listener.topic === ALL_TOPICS)\r\n      .forEach(listener => listener.callback(options));\r\n  }\r\n\r\n  function setBidderConfig(config, mergeFlag = false) {\r\n    try {\r\n      check(config);\r\n      config.bidders.forEach(bidder => {\r\n        if (!bidderConfig[bidder]) {\r\n          bidderConfig[bidder] = {};\r\n        }\r\n        Object.keys(config.config).forEach(topic => {\r\n          let option = config.config[topic];\r\n\r\n          if (isPlainObject(option)) {\r\n            const func = mergeFlag ? mergeDeep : Object.assign;\r\n            bidderConfig[bidder][topic] = func({}, bidderConfig[bidder][topic] || {}, option);\r\n          } else {\r\n            bidderConfig[bidder][topic] = option;\r\n          }\r\n        });\r\n      });\r\n    } catch (e) {\r\n      logError(e);\r\n    }\r\n\r\n    function check(obj) {\r\n      if (!isPlainObject(obj)) {\r\n        throw 'setBidderConfig bidder options must be an object';\r\n      }\r\n      if (!(Array.isArray(obj.bidders) && obj.bidders.length)) {\r\n        throw 'setBidderConfig bidder options must contain a bidders list with at least 1 bidder';\r\n      }\r\n      if (!isPlainObject(obj.config)) {\r\n        throw 'setBidderConfig bidder options must contain a config object';\r\n      }\r\n    }\r\n  }\r\n\r\n  function mergeConfig(obj) {\r\n    if (!isPlainObject(obj)) {\r\n      logError('mergeConfig input must be an object');\r\n      return;\r\n    }\r\n\r\n    const mergedConfig = mergeDeep(_getConfig(), obj);\r\n\r\n    setConfig({ ...mergedConfig });\r\n    return mergedConfig;\r\n  }\r\n\r\n  function mergeBidderConfig(obj) {\r\n    return setBidderConfig(obj, true);\r\n  }\r\n\r\n  /**\r\n   * Internal functions for core to execute some synchronous code while having an active bidder set.\r\n   */\r\n  function runWithBidder(bidder, fn) {\r\n    currBidder = bidder;\r\n    try {\r\n      return fn();\r\n    } finally {\r\n      resetBidder();\r\n    }\r\n  }\r\n  function callbackWithBidder(bidder) {\r\n    return function(cb) {\r\n      return function(...args) {\r\n        if (typeof cb === 'function') {\r\n          return runWithBidder(bidder, bind.call(cb, this, ...args))\r\n        } else {\r\n          logWarn('config.callbackWithBidder callback is not a function');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function getCurrentBidder() {\r\n    return currBidder;\r\n  }\r\n\r\n  function resetBidder() {\r\n    currBidder = null;\r\n  }\r\n\r\n  resetConfig();\r\n\r\n  return {\r\n    getCurrentBidder,\r\n    resetBidder,\r\n    getConfig,\r\n    getAnyConfig,\r\n    readConfig,\r\n    readAnyConfig,\r\n    setConfig,\r\n    mergeConfig,\r\n    setDefaults,\r\n    resetConfig,\r\n    runWithBidder,\r\n    callbackWithBidder,\r\n    setBidderConfig,\r\n    getBidderConfig,\r\n    mergeBidderConfig,\r\n  };\r\n}\r\n\r\nexport const config = newConfig();\r\n","import {isStr, timestamp} from './utils.js';\r\nimport {defer, GreedyPromise} from './utils/promise.js';\r\n\r\nexport class ConsentHandler {\r\n  #enabled;\r\n  #data;\r\n  #defer;\r\n  #ready;\r\n  generatedTime;\r\n\r\n  constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  #resolve(data) {\r\n    this.#ready = true;\r\n    this.#data = data;\r\n    this.#defer.resolve(data);\r\n  }\r\n\r\n  /**\r\n   * reset this handler (mainly for tests)\r\n   */\r\n  reset() {\r\n    this.#defer = defer();\r\n    this.#enabled = false;\r\n    this.#data = null;\r\n    this.#ready = false;\r\n    this.generatedTime = null;\r\n  }\r\n\r\n  /**\r\n   * Enable this consent handler. This should be called by the relevant consent management module\r\n   * on initialization.\r\n   */\r\n  enable() {\r\n    this.#enabled = true;\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean} true if the related consent management module is enabled.\r\n   */\r\n  get enabled() {\r\n    return this.#enabled;\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean} true if consent data has been resolved (it may be `null` if the resolution failed).\r\n   */\r\n  get ready() {\r\n    return this.#ready;\r\n  }\r\n\r\n  /**\r\n   * @returns a promise than resolves to the consent data, or null if no consent data is available\r\n   */\r\n  get promise() {\r\n    if (this.#ready) {\r\n      return GreedyPromise.resolve(this.#data);\r\n    }\r\n    if (!this.#enabled) {\r\n      this.#resolve(null);\r\n    }\r\n    return this.#defer.promise;\r\n  }\r\n\r\n  setConsentData(data, time = timestamp()) {\r\n    this.generatedTime = time;\r\n    this.#resolve(data);\r\n  }\r\n\r\n  getConsentData() {\r\n    return this.#data;\r\n  }\r\n}\r\n\r\nexport class UspConsentHandler extends ConsentHandler {\r\n  getConsentMeta() {\r\n    const consentData = this.getConsentData();\r\n    if (consentData && this.generatedTime) {\r\n      return {\r\n        usp: consentData,\r\n        generatedAt: this.generatedTime\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport class GdprConsentHandler extends ConsentHandler {\r\n  getConsentMeta() {\r\n    const consentData = this.getConsentData();\r\n    if (consentData && consentData.vendorData && this.generatedTime) {\r\n      return {\r\n        gdprApplies: consentData.gdprApplies,\r\n        consentStringSize: (isStr(consentData.vendorData.tcString)) ? consentData.vendorData.tcString.length : 0,\r\n        generatedAt: this.generatedTime,\r\n        apiVersion: consentData.apiVersion\r\n      }\r\n    }\r\n  }\r\n}\r\n","import {find} from './polyfill.js';\r\nimport { isEmpty, logWarn } from './utils.js';\r\nimport { config } from './config.js';\r\n\r\nconst _defaultPrecision = 2;\r\nconst _lgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 5,\r\n    'increment': 0.5\r\n  }]\r\n};\r\nconst _mgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 20,\r\n    'increment': 0.1\r\n  }]\r\n};\r\nconst _hgPriceConfig = {\r\n  'buckets': [{\r\n    'max': 20,\r\n    'increment': 0.01\r\n  }]\r\n};\r\nconst _densePriceConfig = {\r\n  'buckets': [{\r\n    'max': 3,\r\n    'increment': 0.01\r\n  },\r\n  {\r\n    'max': 8,\r\n    'increment': 0.05\r\n  },\r\n  {\r\n    'max': 20,\r\n    'increment': 0.5\r\n  }]\r\n};\r\nconst _autoPriceConfig = {\r\n  'buckets': [{\r\n    'max': 5,\r\n    'increment': 0.05\r\n  },\r\n  {\r\n    'max': 10,\r\n    'increment': 0.1\r\n  },\r\n  {\r\n    'max': 20,\r\n    'increment': 0.5\r\n  }]\r\n};\r\n\r\nfunction getPriceBucketString(cpm, customConfig, granularityMultiplier = 1) {\r\n  let cpmFloat = parseFloat(cpm);\r\n  if (isNaN(cpmFloat)) {\r\n    cpmFloat = '';\r\n  }\r\n\r\n  return {\r\n    low: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _lgPriceConfig, granularityMultiplier),\r\n    med: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _mgPriceConfig, granularityMultiplier),\r\n    high: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _hgPriceConfig, granularityMultiplier),\r\n    auto: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _autoPriceConfig, granularityMultiplier),\r\n    dense: (cpmFloat === '') ? '' : getCpmStringValue(cpm, _densePriceConfig, granularityMultiplier),\r\n    custom: (cpmFloat === '') ? '' : getCpmStringValue(cpm, customConfig, granularityMultiplier)\r\n  };\r\n}\r\n\r\nfunction getCpmStringValue(cpm, config, granularityMultiplier) {\r\n  let cpmStr = '';\r\n  if (!isValidPriceConfig(config)) {\r\n    return cpmStr;\r\n  }\r\n  const cap = config.buckets.reduce((prev, curr) => {\r\n    if (prev.max > curr.max) {\r\n      return prev;\r\n    }\r\n    return curr;\r\n  }, {\r\n    'max': 0,\r\n  });\r\n\r\n  let bucketFloor = 0;\r\n  let bucket = find(config.buckets, bucket => {\r\n    if (cpm > cap.max * granularityMultiplier) {\r\n      // cpm exceeds cap, just return the cap.\r\n      let precision = bucket.precision;\r\n      if (typeof precision === 'undefined') {\r\n        precision = _defaultPrecision;\r\n      }\r\n      cpmStr = (bucket.max * granularityMultiplier).toFixed(precision);\r\n    } else if (cpm <= bucket.max * granularityMultiplier && cpm >= bucketFloor * granularityMultiplier) {\r\n      bucket.min = bucketFloor;\r\n      return bucket;\r\n    } else {\r\n      bucketFloor = bucket.max;\r\n    }\r\n  });\r\n  if (bucket) {\r\n    cpmStr = getCpmTarget(cpm, bucket, granularityMultiplier);\r\n  }\r\n  return cpmStr;\r\n}\r\n\r\nfunction isValidPriceConfig(config) {\r\n  if (isEmpty(config) || !config.buckets || !Array.isArray(config.buckets)) {\r\n    return false;\r\n  }\r\n  let isValid = true;\r\n  config.buckets.forEach(bucket => {\r\n    if (!bucket.max || !bucket.increment) {\r\n      isValid = false;\r\n    }\r\n  });\r\n  return isValid;\r\n}\r\n\r\nfunction getCpmTarget(cpm, bucket, granularityMultiplier) {\r\n  const precision = typeof bucket.precision !== 'undefined' ? bucket.precision : _defaultPrecision;\r\n  const increment = bucket.increment * granularityMultiplier;\r\n  const bucketMin = bucket.min * granularityMultiplier;\r\n  let roundingFunction = Math.floor;\r\n  let customRoundingFunction = config.getConfig('cpmRoundingFunction');\r\n  if (typeof customRoundingFunction === 'function') {\r\n    roundingFunction = customRoundingFunction;\r\n  }\r\n\r\n  // start increments at the bucket min and then add bucket min back to arrive at the correct rounding\r\n  // note - we're padding the values to avoid using decimals in the math prior to flooring\r\n  // this is done as JS can return values slightly below the expected mark which would skew the price bucket target\r\n  //   (eg 4.01 / 0.01 = 400.99999999999994)\r\n  // min precison should be 2 to move decimal place over.\r\n  let pow = Math.pow(10, precision + 2);\r\n  let cpmToRound = ((cpm * pow) - (bucketMin * pow)) / (increment * pow);\r\n  let cpmTarget;\r\n  let invalidRounding;\r\n  // It is likely that we will be passed {cpmRoundingFunction: roundingFunction()}\r\n  // rather than the expected {cpmRoundingFunction: roundingFunction}. Default back to floor in that case\r\n  try {\r\n    cpmTarget = (roundingFunction(cpmToRound) * increment) + bucketMin;\r\n  } catch (err) {\r\n    invalidRounding = true;\r\n  }\r\n  if (invalidRounding || typeof cpmTarget !== 'number') {\r\n    logWarn('Invalid rounding function passed in config');\r\n    cpmTarget = (Math.floor(cpmToRound) * increment) + bucketMin;\r\n  }\r\n  // force to 10 decimal places to deal with imprecise decimal/binary conversions\r\n  //    (for example 0.1 * 3 = 0.30000000000000004)\r\n\r\n  cpmTarget = Number(cpmTarget.toFixed(10));\r\n  return cpmTarget.toFixed(precision);\r\n}\r\n\r\nexport { getPriceBucketString, isValidPriceConfig };\r\n","import {config} from './config.js';\r\nimport {getHook, hook} from './hook.js';\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport {logMessage, prefixLog} from './utils.js';\r\nimport {createBid} from './bidfactory.js';\r\nimport {loadExternalScript} from './adloader.js';\r\nimport {GreedyPromise} from './utils/promise.js';\r\n\r\nexport const DEBUG_KEY = '__$$PREBID_GLOBAL$$_debugging__';\r\n\r\nfunction isDebuggingInstalled() {\r\n  return getGlobal().installedModules.includes('debugging');\r\n}\r\n\r\nfunction loadScript(url) {\r\n  return new GreedyPromise((resolve) => {\r\n    loadExternalScript(url, 'debugging', resolve);\r\n  });\r\n}\r\n\r\nexport function debuggingModuleLoader({alreadyInstalled = isDebuggingInstalled, script = loadScript} = {}) {\r\n  let loading = null;\r\n  return function () {\r\n    if (loading == null) {\r\n      loading = new GreedyPromise((resolve, reject) => {\r\n        // run this in a 0-delay timeout to give installedModules time to be populated\r\n        setTimeout(() => {\r\n          if (alreadyInstalled()) {\r\n            resolve();\r\n          } else {\r\n            const url = '$$PREBID_DIST_URL_BASE$$debugging-standalone.js';\r\n            logMessage(`Debugging module not installed, loading it from \"${url}\"...`);\r\n            getGlobal()._installDebugging = true;\r\n            script(url).then(() => {\r\n              getGlobal()._installDebugging({DEBUG_KEY, hook, config, createBid, logger: prefixLog('DEBUG:')});\r\n            }).then(resolve, reject);\r\n          }\r\n        });\r\n      })\r\n    }\r\n    return loading;\r\n  }\r\n}\r\n\r\nexport function debuggingControls({load = debuggingModuleLoader(), hook = getHook('requestBids')} = {}) {\r\n  let promise = null;\r\n  let enabled = false;\r\n  function waitForDebugging(next, ...args) {\r\n    return (promise || GreedyPromise.resolve()).then(() => next.apply(this, args))\r\n  }\r\n  function enable() {\r\n    if (!enabled) {\r\n      promise = load();\r\n      // set debugging to high priority so that it has the opportunity to mess with most things\r\n      hook.before(waitForDebugging, 99);\r\n      enabled = true;\r\n    }\r\n  }\r\n  function disable() {\r\n    hook.getHooks({hook: waitForDebugging}).remove();\r\n    enabled = false;\r\n  }\r\n  function reset() {\r\n    promise = null;\r\n    disable();\r\n  }\r\n  return {enable, disable, reset};\r\n}\r\n\r\nconst ctl = debuggingControls();\r\nexport const reset = ctl.reset;\r\n\r\nexport function loadSession() {\r\n  let storage = null;\r\n  try {\r\n    storage = window.sessionStorage;\r\n  } catch (e) {}\r\n\r\n  if (storage !== null) {\r\n    let debugging = ctl;\r\n    let config = null;\r\n    try {\r\n      config = storage.getItem(DEBUG_KEY);\r\n    } catch (e) {}\r\n    if (config !== null) {\r\n      // just make sure the module runs; it will take care of parsing the config (and disabling itself if necessary)\r\n      debugging.enable();\r\n    }\r\n  }\r\n}\r\n\r\nconfig.getConfig('debugging', function ({debugging}) {\r\n  debugging?.enabled ? ctl.enable() : ctl.disable();\r\n});\r\n","/**\r\n * events.js\r\n */\r\nimport * as utils from './utils.js'\r\nimport CONSTANTS from './constants.json';\r\n\r\nvar slice = Array.prototype.slice;\r\nvar push = Array.prototype.push;\r\n\r\n// define entire events\r\n// var allEvents = ['bidRequested','bidResponse','bidWon','bidTimeout'];\r\nvar allEvents = utils._map(CONSTANTS.EVENTS, function (v) {\r\n  return v;\r\n});\r\n\r\nvar idPaths = CONSTANTS.EVENT_ID_PATHS;\r\n\r\n// keep a record of all events fired\r\nvar eventsFired = [];\r\nconst _public = (function () {\r\n  var _handlers = {};\r\n  var _public = {};\r\n\r\n  /**\r\n   *\r\n   * @param {String} eventString  The name of the event.\r\n   * @param {Array} args  The payload emitted with the event.\r\n   * @private\r\n   */\r\n  function _dispatch(eventString, args) {\r\n    utils.logMessage('Emitting event for: ' + eventString);\r\n\r\n    var eventPayload = args[0] || {};\r\n    var idPath = idPaths[eventString];\r\n    var key = eventPayload[idPath];\r\n    var event = _handlers[eventString] || { que: [] };\r\n    var eventKeys = utils._map(event, function (v, k) {\r\n      return k;\r\n    });\r\n\r\n    var callbacks = [];\r\n\r\n    // record the event:\r\n    eventsFired.push({\r\n      eventType: eventString,\r\n      args: eventPayload,\r\n      id: key,\r\n      elapsedTime: utils.getPerformanceNow(),\r\n    });\r\n\r\n    /** Push each specific callback to the `callbacks` array.\r\n     * If the `event` map has a key that matches the value of the\r\n     * event payload id path, e.g. `eventPayload[idPath]`, then apply\r\n     * each function in the `que` array as an argument to push to the\r\n     * `callbacks` array\r\n     * */\r\n    if (key && utils.contains(eventKeys, key)) {\r\n      push.apply(callbacks, event[key].que);\r\n    }\r\n\r\n    /** Push each general callback to the `callbacks` array. */\r\n    push.apply(callbacks, event.que);\r\n\r\n    /** call each of the callbacks */\r\n    utils._each(callbacks, function (fn) {\r\n      if (!fn) return;\r\n      try {\r\n        fn.apply(null, args);\r\n      } catch (e) {\r\n        utils.logError('Error executing handler:', 'events.js', e);\r\n      }\r\n    });\r\n  }\r\n\r\n  function _checkAvailableEvent(event) {\r\n    return utils.contains(allEvents, event);\r\n  }\r\n\r\n  _public.on = function (eventString, handler, id) {\r\n    // check whether available event or not\r\n    if (_checkAvailableEvent(eventString)) {\r\n      var event = _handlers[eventString] || { que: [] };\r\n\r\n      if (id) {\r\n        event[id] = event[id] || { que: [] };\r\n        event[id].que.push(handler);\r\n      } else {\r\n        event.que.push(handler);\r\n      }\r\n\r\n      _handlers[eventString] = event;\r\n    } else {\r\n      utils.logError('Wrong event name : ' + eventString + ' Valid event names :' + allEvents);\r\n    }\r\n  };\r\n\r\n  _public.emit = function (event) {\r\n    var args = slice.call(arguments, 1);\r\n    _dispatch(event, args);\r\n  };\r\n\r\n  _public.off = function (eventString, handler, id) {\r\n    var event = _handlers[eventString];\r\n\r\n    if (utils.isEmpty(event) || (utils.isEmpty(event.que) && utils.isEmpty(event[id]))) {\r\n      return;\r\n    }\r\n\r\n    if (id && (utils.isEmpty(event[id]) || utils.isEmpty(event[id].que))) {\r\n      return;\r\n    }\r\n\r\n    if (id) {\r\n      utils._each(event[id].que, function (_handler) {\r\n        var que = event[id].que;\r\n        if (_handler === handler) {\r\n          que.splice(que.indexOf(_handler), 1);\r\n        }\r\n      });\r\n    } else {\r\n      utils._each(event.que, function (_handler) {\r\n        var que = event.que;\r\n        if (_handler === handler) {\r\n          que.splice(que.indexOf(_handler), 1);\r\n        }\r\n      });\r\n    }\r\n\r\n    _handlers[eventString] = event;\r\n  };\r\n\r\n  _public.get = function () {\r\n    return _handlers;\r\n  };\r\n\r\n  /**\r\n   * This method can return a copy of all the events fired\r\n   * @return {Array} array of events fired\r\n   */\r\n  _public.getEvents = function () {\r\n    var arrayCopy = [];\r\n    utils._each(eventsFired, function (value) {\r\n      var newProp = Object.assign({}, value);\r\n      arrayCopy.push(newProp);\r\n    });\r\n\r\n    return arrayCopy;\r\n  };\r\n\r\n  return _public;\r\n}());\r\n\r\nutils._setEventEmitter(_public.emit.bind(_public));\r\n\r\nexport const {on, off, get, getEvents, emit} = _public;\r\n","import funHooks from 'fun-hooks/no-eval/index.js';\r\nimport {defer} from './utils/promise.js';\r\n\r\nexport let hook = funHooks({\r\n  ready: funHooks.SYNC | funHooks.ASYNC | funHooks.QUEUE\r\n});\r\n\r\nconst readyCtl = defer();\r\nhook.ready = (() => {\r\n  const ready = hook.ready;\r\n  return function () {\r\n    try {\r\n      return ready.apply(hook, arguments);\r\n    } finally {\r\n      readyCtl.resolve();\r\n    }\r\n  }\r\n})();\r\n\r\n/**\r\n * A promise that resolves when hooks are ready.\r\n * @type {Promise}\r\n */\r\nexport const ready = readyCtl.promise;\r\n\r\nexport const getHook = hook.get;\r\n\r\nexport function setupBeforeHookFnOnce(baseFn, hookFn, priority = 15) {\r\n  let result = baseFn.getHooks({hook: hookFn});\r\n  if (result.length === 0) {\r\n    baseFn.before(hookFn, priority);\r\n  }\r\n}\r\nconst submoduleInstallMap = {};\r\n\r\nexport function module(name, install, {postInstallAllowed = false} = {}) {\r\n  hook('async', function (submodules) {\r\n    submodules.forEach(args => install(...args));\r\n    if (postInstallAllowed) submoduleInstallMap[name] = install;\r\n  }, name)([]); // will be queued until hook.ready() called in pbjs.processQueue();\r\n}\r\n\r\nexport function submodule(name, ...args) {\r\n  const install = submoduleInstallMap[name];\r\n  if (install) return install(...args);\r\n  getHook(name).before((next, modules) => {\r\n    modules.push(args);\r\n    next(modules);\r\n  });\r\n}\r\n\r\n/**\r\n * Copy hook methods (.before, .after, etc) from a given hook to a given wrapper object.\r\n */\r\nexport function wrapHook(hook, wrapper) {\r\n  Object.defineProperties(\r\n    wrapper,\r\n    Object.fromEntries(['before', 'after', 'getHooks', 'removeAll'].map((m) => [m, {get: () => hook[m]}]))\r\n  );\r\n  return wrapper;\r\n}\r\n","/**\r\n * This file contains the valid Media Types in Prebid.\r\n *\r\n * All adapters are assumed to support banner ads. Other media types are specified by Adapters when they\r\n * register themselves with prebid-core.\r\n */\r\n\r\n/**\r\n * @typedef {('native'|'video'|'banner')} MediaType\r\n * @typedef {('adpod')} VideoContext\r\n */\r\n\r\n/** @type MediaType */\r\nexport const NATIVE = 'native';\r\n/** @type MediaType */\r\nexport const VIDEO = 'video';\r\n/** @type MediaType */\r\nexport const BANNER = 'banner';\r\n/** @type VideoContext */\r\nexport const ADPOD = 'adpod';\r\n","import {\r\n  deepAccess,\r\n  deepClone,\r\n  getKeyByValue,\r\n  insertHtmlIntoIframe,\r\n  isArray,\r\n  isBoolean,\r\n  isInteger,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  triggerPixel,\r\n  pick\r\n} from './utils.js';\r\nimport {includes} from './polyfill.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport CONSTANTS from './constants.json';\r\nimport {NATIVE} from './mediaTypes.js';\r\n\r\nexport const nativeAdapters = [];\r\n\r\nexport const NATIVE_TARGETING_KEYS = Object.keys(CONSTANTS.NATIVE_KEYS).map(\r\n  key => CONSTANTS.NATIVE_KEYS[key]\r\n);\r\n\r\nconst IMAGE = {\r\n  ortb: {\r\n    ver: '1.2',\r\n    assets: [\r\n      {\r\n        required: 1,\r\n        id: 1,\r\n        img: {\r\n          type: 3,\r\n          wmin: 100,\r\n          hmin: 100,\r\n        }\r\n      },\r\n      {\r\n        required: 1,\r\n        id: 2,\r\n        title: {\r\n          len: 140,\r\n        }\r\n      },\r\n      {\r\n        required: 1,\r\n        id: 3,\r\n        data: {\r\n          type: 1,\r\n        }\r\n      },\r\n      {\r\n        required: 0,\r\n        id: 4,\r\n        data: {\r\n          type: 2,\r\n        }\r\n      },\r\n      {\r\n        required: 0,\r\n        id: 5,\r\n        img: {\r\n          type: 1,\r\n          wmin: 20,\r\n          hmin: 20,\r\n        }\r\n      },\r\n    ],\r\n  },\r\n  image: { required: true },\r\n  title: { required: true },\r\n  sponsoredBy: { required: true },\r\n  clickUrl: { required: true },\r\n  body: { required: false },\r\n  icon: { required: false },\r\n};\r\n\r\nconst SUPPORTED_TYPES = {\r\n  image: IMAGE\r\n};\r\n\r\nconst { NATIVE_ASSET_TYPES, NATIVE_IMAGE_TYPES, PREBID_NATIVE_DATA_KEYS_TO_ORTB, NATIVE_KEYS_THAT_ARE_NOT_ASSETS, NATIVE_KEYS } = CONSTANTS;\r\n\r\n// inverse native maps useful for converting to legacy\r\nconst PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE = inverse(PREBID_NATIVE_DATA_KEYS_TO_ORTB);\r\nconst NATIVE_ASSET_TYPES_INVERSE = inverse(NATIVE_ASSET_TYPES);\r\n\r\nconst TRACKER_METHODS = {\r\n  img: 1,\r\n  js: 2,\r\n  1: 'img',\r\n  2: 'js'\r\n}\r\n\r\nconst TRACKER_EVENTS = {\r\n  impression: 1,\r\n  'viewable-mrc50': 2,\r\n  'viewable-mrc100': 3,\r\n  'viewable-video50': 4,\r\n}\r\n\r\n/**\r\n * Recieves nativeParams from an adUnit. If the params were not of type 'type',\r\n * passes them on directly. If they were of type 'type', translate\r\n * them into the predefined specific asset requests for that type of native ad.\r\n */\r\nexport function processNativeAdUnitParams(params) {\r\n  if (params && params.type && typeIsSupported(params.type)) {\r\n    params = SUPPORTED_TYPES[params.type];\r\n  }\r\n\r\n  if (params && params.ortb && !isOpenRTBBidRequestValid(params.ortb)) {\r\n    return;\r\n  }\r\n  return params;\r\n}\r\n\r\nexport function decorateAdUnitsWithNativeParams(adUnits) {\r\n  adUnits.forEach(adUnit => {\r\n    const nativeParams =\r\n      adUnit.nativeParams || deepAccess(adUnit, 'mediaTypes.native');\r\n    if (nativeParams) {\r\n      adUnit.nativeParams = processNativeAdUnitParams(nativeParams);\r\n    }\r\n    if (adUnit.nativeParams) {\r\n      adUnit.nativeOrtbRequest = adUnit.nativeParams.ortb || toOrtbNativeRequest(adUnit.nativeParams);\r\n    }\r\n  });\r\n}\r\nexport function isOpenRTBBidRequestValid(ortb) {\r\n  const assets = ortb.assets;\r\n  if (!Array.isArray(assets) || assets.length === 0) {\r\n    logError(`assets in mediaTypes.native.ortb is not an array, or it's empty. Assets: `, assets);\r\n    return false;\r\n  }\r\n\r\n  // validate that ids exist, that they are unique and that they are numbers\r\n  const ids = assets.map(asset => asset.id);\r\n  if (assets.length !== new Set(ids).size || ids.some(id => id !== parseInt(id, 10))) {\r\n    logError(`each asset object must have 'id' property, it must be unique and it must be an integer`);\r\n    return false;\r\n  }\r\n\r\n  if (ortb.hasOwnProperty('eventtrackers') && !Array.isArray(ortb.eventtrackers)) {\r\n    logError('ortb.eventtrackers is not an array. Eventtrackers: ', ortb.eventtrackers);\r\n    return false;\r\n  }\r\n\r\n  return assets.every(asset => isOpenRTBAssetValid(asset))\r\n}\r\n\r\nfunction isOpenRTBAssetValid(asset) {\r\n  if (!isPlainObject(asset)) {\r\n    logError(`asset must be an object. Provided asset: `, asset);\r\n    return false;\r\n  }\r\n  if (asset.img) {\r\n    if (!isNumber(asset.img.w) && !isNumber(asset.img.wmin)) {\r\n      logError(`for img asset there must be 'w' or 'wmin' property`);\r\n      return false;\r\n    }\r\n    if (!isNumber(asset.img.h) && !isNumber(asset.img.hmin)) {\r\n      logError(`for img asset there must be 'h' or 'hmin' property`);\r\n      return false;\r\n    }\r\n  } else if (asset.title) {\r\n    if (!isNumber(asset.title.len)) {\r\n      logError(`for title asset there must be 'len' property defined`);\r\n      return false;\r\n    }\r\n  } else if (asset.data) {\r\n    if (!isNumber(asset.data.type)) {\r\n      logError(`for data asset 'type' property must be a number`);\r\n      return false;\r\n    }\r\n  } else if (asset.video) {\r\n    if (!Array.isArray(asset.video.mimes) || !Array.isArray(asset.video.protocols) ||\r\n      !isNumber(asset.video.minduration) || !isNumber(asset.video.maxduration)) {\r\n      logError('video asset is not properly configured');\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * Check if the native type specified in the adUnit is supported by Prebid.\r\n */\r\nfunction typeIsSupported(type) {\r\n  if (!(type && includes(Object.keys(SUPPORTED_TYPES), type))) {\r\n    logError(`${type} nativeParam is not supported`);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Helper functions for working with native-enabled adUnits\r\n * TODO: abstract this and the video helper functions into general\r\n * adunit validation helper functions\r\n */\r\nexport const nativeAdUnit = adUnit => {\r\n  const mediaType = adUnit.mediaType === 'native';\r\n  const mediaTypes = deepAccess(adUnit, 'mediaTypes.native');\r\n  return mediaType || mediaTypes;\r\n}\r\nexport const nativeBidder = bid => includes(nativeAdapters, bid.bidder);\r\nexport const hasNonNativeBidder = adUnit =>\r\n  adUnit.bids.filter(bid => !nativeBidder(bid)).length;\r\n\r\n/**\r\n * Validate that the native assets on this bid contain all assets that were\r\n * marked as required in the adUnit configuration.\r\n * @param {Bid} bid Native bid to validate\r\n * @param {BidRequest[]} bidRequests All bid requests for an auction\r\n * @return {Boolean} If object is valid\r\n */\r\nexport function nativeBidIsValid(bid, {index = auctionManager.index} = {}) {\r\n  const adUnit = index.getAdUnit(bid);\r\n  if (!adUnit) { return false; }\r\n  let ortbRequest = adUnit.nativeOrtbRequest\r\n  let ortbResponse = bid.native?.ortb || toOrtbNativeResponse(bid.native, ortbRequest);\r\n  return isNativeOpenRTBBidValid(ortbResponse, ortbRequest);\r\n}\r\n\r\nexport function isNativeOpenRTBBidValid(bidORTB, bidRequestORTB) {\r\n  if (!deepAccess(bidORTB, 'link.url')) {\r\n    logError(`native response doesn't have 'link' property. Ortb response: `, bidORTB);\r\n    return false;\r\n  }\r\n\r\n  let requiredAssetIds = bidRequestORTB.assets.filter(asset => asset.required === 1).map(a => a.id);\r\n  let returnedAssetIds = bidORTB.assets.map(asset => asset.id);\r\n\r\n  const match = requiredAssetIds.every(assetId => includes(returnedAssetIds, assetId));\r\n  if (!match) {\r\n    logError(`didn't receive a bid with all required assets. Required ids: ${requiredAssetIds}, but received ids in response: ${returnedAssetIds}`);\r\n  }\r\n\r\n  return match;\r\n}\r\n\r\n/*\r\n * Native responses may have associated impression or click trackers.\r\n * This retrieves the appropriate tracker urls for the given ad object and\r\n * fires them. As a native creatives may be in a cross-origin frame, it may be\r\n * necessary to invoke this function via postMessage. secureCreatives is\r\n * configured to fire this function when it receives a `message` of 'Prebid Native'\r\n * and an `adId` with the value of the `bid.adId`. When a message is posted with\r\n * these parameters, impression trackers are fired. To fire click trackers, the\r\n * message should contain an `action` set to 'click'.\r\n *\r\n * // Native creative template example usage\r\n * <a href=\"%%CLICK_URL_UNESC%%%%PATTERN:hb_native_linkurl%%\"\r\n *    target=\"_blank\"\r\n *    onclick=\"fireTrackers('click')\">\r\n *    %%PATTERN:hb_native_title%%\r\n * </a>\r\n *\r\n * <script>\r\n *   function fireTrackers(action) {\r\n *     var message = {message: 'Prebid Native', adId: '%%PATTERN:hb_adid%%'};\r\n *     if (action === 'click') {message.action = 'click';} // fires click trackers\r\n *     window.parent.postMessage(JSON.stringify(message), '*');\r\n *   }\r\n *   fireTrackers(); // fires impressions when creative is loaded\r\n * </script>\r\n */\r\nexport function fireNativeTrackers(message, bidResponse) {\r\n  const nativeResponse = bidResponse.native.ortb || legacyPropertiesToOrtbNative(bidResponse.native);\r\n\r\n  if (message.action === 'click') {\r\n    fireClickTrackers(nativeResponse, message?.assetId);\r\n  } else {\r\n    fireImpressionTrackers(nativeResponse);\r\n  }\r\n  return message.action;\r\n}\r\n\r\nexport function fireImpressionTrackers(nativeResponse, {runMarkup = (mkup) => insertHtmlIntoIframe(mkup), fetchURL = triggerPixel} = {}) {\r\n  const impTrackers = (nativeResponse.eventtrackers || [])\r\n    .filter(tracker => tracker.event === TRACKER_EVENTS.impression);\r\n\r\n  let {img, js} = impTrackers.reduce((tally, tracker) => {\r\n    if (TRACKER_METHODS.hasOwnProperty(tracker.method)) {\r\n      tally[TRACKER_METHODS[tracker.method]].push(tracker.url)\r\n    }\r\n    return tally;\r\n  }, {img: [], js: []});\r\n\r\n  if (nativeResponse.imptrackers) {\r\n    img = img.concat(nativeResponse.imptrackers);\r\n  }\r\n  img.forEach(url => fetchURL(url));\r\n\r\n  js = js.map(url => `<script async src=\"${url}\"></script>`);\r\n  if (nativeResponse.jstracker) {\r\n    // jstracker is already HTML markup\r\n    js = js.concat([nativeResponse.jstracker]);\r\n  }\r\n  if (js.length) {\r\n    runMarkup(js.join('\\n'));\r\n  }\r\n}\r\n\r\nexport function fireClickTrackers(nativeResponse, assetId = null, {fetchURL = triggerPixel} = {}) {\r\n  // legacy click tracker\r\n  if (!assetId) {\r\n    (nativeResponse.link?.clicktrackers || []).forEach(url => fetchURL(url));\r\n  } else {\r\n    // ortb click tracker. This will try to call the clicktracker associated with the asset;\r\n    // will fallback to the link if none is found.\r\n    const assetIdLinkMap = (nativeResponse.assets || [])\r\n      .filter(a => a.link)\r\n      .reduce((map, asset) => {\r\n        map[asset.id] = asset.link;\r\n        return map\r\n      }, {});\r\n    const masterClickTrackers = nativeResponse.link?.clicktrackers || [];\r\n    let assetLink = assetIdLinkMap[assetId];\r\n    let clickTrackers = masterClickTrackers;\r\n    if (assetLink) {\r\n      clickTrackers = assetLink.clicktrackers || [];\r\n    }\r\n    clickTrackers.forEach(url => fetchURL(url));\r\n  }\r\n}\r\n\r\n/**\r\n * Gets native targeting key-value pairs\r\n * @param {Object} bid\r\n * @return {Object} targeting\r\n */\r\nexport function getNativeTargeting(bid, {index = auctionManager.index} = {}) {\r\n  let keyValues = {};\r\n  const adUnit = index.getAdUnit(bid);\r\n  if (deepAccess(adUnit, 'nativeParams.rendererUrl')) {\r\n    bid['native']['rendererUrl'] = getAssetValue(adUnit.nativeParams['rendererUrl']);\r\n  } else if (deepAccess(adUnit, 'nativeParams.adTemplate')) {\r\n    bid['native']['adTemplate'] = getAssetValue(adUnit.nativeParams['adTemplate']);\r\n  }\r\n\r\n  const globalSendTargetingKeys = deepAccess(\r\n    adUnit,\r\n    `nativeParams.sendTargetingKeys`\r\n  ) !== false;\r\n\r\n  const nativeKeys = getNativeKeys(adUnit);\r\n\r\n  const flatBidNativeKeys = { ...bid.native, ...bid.native.ext };\r\n  delete flatBidNativeKeys.ext;\r\n\r\n  Object.keys(flatBidNativeKeys).forEach(asset => {\r\n    const key = nativeKeys[asset];\r\n    let value = getAssetValue(bid.native[asset]) || getAssetValue(deepAccess(bid, `native.ext.${asset}`));\r\n\r\n    if (asset === 'adTemplate' || !key || !value) {\r\n      return;\r\n    }\r\n\r\n    let sendPlaceholder = deepAccess(adUnit, `nativeParams.${asset}.sendId`);\r\n    if (typeof sendPlaceholder !== 'boolean') {\r\n      sendPlaceholder = deepAccess(adUnit, `nativeParams.ext.${asset}.sendId`);\r\n    }\r\n\r\n    if (sendPlaceholder) {\r\n      const placeholder = `${key}:${bid.adId}`;\r\n      value = placeholder;\r\n    }\r\n\r\n    let assetSendTargetingKeys = deepAccess(adUnit, `nativeParams.${asset}.sendTargetingKeys`);\r\n    if (typeof assetSendTargetingKeys !== 'boolean') {\r\n      assetSendTargetingKeys = deepAccess(adUnit, `nativeParams.ext.${asset}.sendTargetingKeys`);\r\n    }\r\n\r\n    const sendTargeting = typeof assetSendTargetingKeys === 'boolean' ? assetSendTargetingKeys : globalSendTargetingKeys;\r\n\r\n    if (sendTargeting) {\r\n      keyValues[key] = value;\r\n    }\r\n  });\r\n\r\n  return keyValues;\r\n}\r\n\r\nconst getNativeRequest = (bidResponse) => auctionManager.index.getAdUnit(bidResponse)?.nativeOrtbRequest;\r\n\r\nfunction assetsMessage(data, adObject, keys, {getNativeReq = getNativeRequest} = {}) {\r\n  const message = {\r\n    message: 'assetResponse',\r\n    adId: data.adId,\r\n  };\r\n\r\n  // Pass to Prebid Universal Creative all assets, the legacy ones + the ortb ones (under ortb property)\r\n  const ortbRequest = getNativeReq(adObject);\r\n  let nativeResp = adObject.native;\r\n  const ortbResponse = adObject.native?.ortb;\r\n  let legacyResponse = {};\r\n  if (ortbRequest && ortbResponse) {\r\n    legacyResponse = toLegacyResponse(ortbResponse, ortbRequest);\r\n    nativeResp = {\r\n      ...adObject.native,\r\n      ...legacyResponse\r\n    };\r\n  }\r\n  if (adObject.native.ortb) {\r\n    message.ortb = adObject.native.ortb;\r\n  }\r\n  message.assets = [];\r\n\r\n  (keys == null ? Object.keys(nativeResp) : keys).forEach(function(key) {\r\n    if (key === 'adTemplate' && nativeResp[key]) {\r\n      message.adTemplate = getAssetValue(nativeResp[key]);\r\n    } else if (key === 'rendererUrl' && nativeResp[key]) {\r\n      message.rendererUrl = getAssetValue(nativeResp[key]);\r\n    } else if (key === 'ext') {\r\n      Object.keys(nativeResp[key]).forEach(extKey => {\r\n        if (nativeResp[key][extKey]) {\r\n          const value = getAssetValue(nativeResp[key][extKey]);\r\n          message.assets.push({ key: extKey, value });\r\n        }\r\n      })\r\n    } else if (nativeResp[key] && CONSTANTS.NATIVE_KEYS.hasOwnProperty(key)) {\r\n      const value = getAssetValue(nativeResp[key]);\r\n\r\n      message.assets.push({ key, value });\r\n    }\r\n  });\r\n  return message;\r\n}\r\n\r\n/**\r\n * Constructs a message object containing asset values for each of the\r\n * requested data keys.\r\n */\r\nexport function getAssetMessage(data, adObject, {getNativeReq = getNativeRequest} = {}) {\r\n  const keys = data.assets.map((k) => getKeyByValue(CONSTANTS.NATIVE_KEYS, k));\r\n  return assetsMessage(data, adObject, keys, {getNativeReq});\r\n}\r\n\r\nexport function getAllAssetsMessage(data, adObject, {getNativeReq = getNativeRequest} = {}) {\r\n  return assetsMessage(data, adObject, null, {getNativeReq});\r\n}\r\n\r\n/**\r\n * Native assets can be a string or an object with a url prop. Returns the value\r\n * appropriate for sending in adserver targeting or placeholder replacement.\r\n */\r\nfunction getAssetValue(value) {\r\n  return value?.url || value;\r\n}\r\n\r\nfunction getNativeKeys(adUnit) {\r\n  const extraNativeKeys = {}\r\n\r\n  if (deepAccess(adUnit, 'nativeParams.ext')) {\r\n    Object.keys(adUnit.nativeParams.ext).forEach(extKey => {\r\n      extraNativeKeys[extKey] = `hb_native_${extKey}`;\r\n    })\r\n  }\r\n\r\n  return {\r\n    ...CONSTANTS.NATIVE_KEYS,\r\n    ...extraNativeKeys\r\n  }\r\n}\r\n\r\n/**\r\n * converts Prebid legacy native assets request to OpenRTB format\r\n * @param {object} legacyNativeAssets an object that describes a native bid request in Prebid proprietary format\r\n * @returns an OpenRTB format of the same bid request\r\n */\r\nexport function toOrtbNativeRequest(legacyNativeAssets) {\r\n  if (!legacyNativeAssets && !isPlainObject(legacyNativeAssets)) {\r\n    logError('Native assets object is empty or not an object: ', legacyNativeAssets);\r\n    return;\r\n  }\r\n  const ortb = {\r\n    ver: '1.2',\r\n    assets: []\r\n  };\r\n  for (let key in legacyNativeAssets) {\r\n    // skip conversion for non-asset keys\r\n    if (NATIVE_KEYS_THAT_ARE_NOT_ASSETS.includes(key)) continue;\r\n    if (!NATIVE_KEYS.hasOwnProperty(key)) {\r\n      logError(`Unrecognized native asset code: ${key}. Asset will be ignored.`);\r\n      continue;\r\n    }\r\n\r\n    const asset = legacyNativeAssets[key];\r\n    let required = 0;\r\n    if (asset.required && isBoolean(asset.required)) {\r\n      required = Number(asset.required);\r\n    }\r\n    const ortbAsset = {\r\n      id: ortb.assets.length,\r\n      required\r\n    };\r\n    // data cases\r\n    if (key in PREBID_NATIVE_DATA_KEYS_TO_ORTB) {\r\n      ortbAsset.data = {\r\n        type: NATIVE_ASSET_TYPES[PREBID_NATIVE_DATA_KEYS_TO_ORTB[key]]\r\n      }\r\n      if (asset.len) {\r\n        ortbAsset.data.len = asset.len;\r\n      }\r\n    // icon or image case\r\n    } else if (key === 'icon' || key === 'image') {\r\n      ortbAsset.img = {\r\n        type: key === 'icon' ? NATIVE_IMAGE_TYPES.ICON : NATIVE_IMAGE_TYPES.MAIN,\r\n      }\r\n      // if min_width and min_height are defined in aspect_ratio, they are preferred\r\n      if (asset.aspect_ratios) {\r\n        if (!isArray(asset.aspect_ratios)) {\r\n          logError(\"image.aspect_ratios was passed, but it's not a an array:\", asset.aspect_ratios);\r\n        } else if (!asset.aspect_ratios.length) {\r\n          logError(\"image.aspect_ratios was passed, but it's empty:\", asset.aspect_ratios);\r\n        } else {\r\n          const { min_width: minWidth, min_height: minHeight } = asset.aspect_ratios[0];\r\n          if (!isInteger(minWidth) || !isInteger(minHeight)) {\r\n            logError('image.aspect_ratios min_width or min_height are invalid: ', minWidth, minHeight);\r\n          } else {\r\n            ortbAsset.img.wmin = minWidth;\r\n            ortbAsset.img.hmin = minHeight;\r\n          }\r\n          const aspectRatios = asset.aspect_ratios\r\n            .filter((ar) => ar.ratio_width && ar.ratio_height)\r\n            .map(ratio => `${ratio.ratio_width}:${ratio.ratio_height}`);\r\n          if (aspectRatios.length > 0) {\r\n            ortbAsset.img.ext = {\r\n              aspectratios: aspectRatios\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // if asset.sizes exist, by OpenRTB spec we should remove wmin and hmin\r\n      if (asset.sizes) {\r\n        if (asset.sizes.length !== 2 || !isInteger(asset.sizes[0]) || !isInteger(asset.sizes[1])) {\r\n          logError('image.sizes was passed, but its value is not an array of integers:', asset.sizes);\r\n        } else {\r\n          ortbAsset.img.w = asset.sizes[0];\r\n          ortbAsset.img.h = asset.sizes[1];\r\n          delete ortbAsset.img.hmin;\r\n          delete ortbAsset.img.wmin;\r\n        }\r\n      }\r\n    // title case\r\n    } else if (key === 'title') {\r\n      ortbAsset.title = {\r\n        // in openRTB, len is required for titles, while in legacy prebid was not.\r\n        // for this reason, if len is missing in legacy prebid, we're adding a default value of 140.\r\n        len: asset.len || 140\r\n      }\r\n    // all extensions to the native bid request are passed as is\r\n    } else if (key === 'ext') {\r\n      ortbAsset.ext = asset;\r\n      // in `ext` case, required field is not needed\r\n      delete ortbAsset.required;\r\n    }\r\n    ortb.assets.push(ortbAsset);\r\n  }\r\n  return ortb;\r\n}\r\n\r\n/**\r\n * This function converts an OpenRTB native request object to Prebid proprietary\r\n * format. The purpose of this function is to help adapters to handle the\r\n * transition phase where publishers may be using OpenRTB objects but the\r\n *  bidder does not yet support it.\r\n * @param {object} openRTBRequest an OpenRTB v1.2 request object\r\n * @returns a Prebid legacy native format request\r\n */\r\nexport function fromOrtbNativeRequest(openRTBRequest) {\r\n  if (!isOpenRTBBidRequestValid(openRTBRequest)) {\r\n    return;\r\n  }\r\n\r\n  const oldNativeObject = {};\r\n  for (const asset of openRTBRequest.assets) {\r\n    if (asset.title) {\r\n      const title = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n        len: asset.title.len\r\n      }\r\n      oldNativeObject.title = title;\r\n    } else if (asset.img) {\r\n      const image = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n      }\r\n      if (asset.img.w && asset.img.h) {\r\n        image.sizes = [asset.img.w, asset.img.h];\r\n      } else if (asset.img.wmin && asset.img.hmin) {\r\n        image.aspect_ratios = {\r\n          min_width: asset.img.wmin,\r\n          min_height: asset.img.hmin,\r\n          ratio_width: asset.img.wmin,\r\n          ratio_height: asset.img.hmin\r\n        }\r\n      }\r\n\r\n      if (asset.img.type === NATIVE_IMAGE_TYPES.MAIN) {\r\n        oldNativeObject.image = image;\r\n      } else {\r\n        oldNativeObject.icon = image;\r\n      }\r\n    } else if (asset.data) {\r\n      let assetType = Object.keys(NATIVE_ASSET_TYPES).find(k => NATIVE_ASSET_TYPES[k] === asset.data.type);\r\n      let prebidAssetName = Object.keys(PREBID_NATIVE_DATA_KEYS_TO_ORTB).find(k => PREBID_NATIVE_DATA_KEYS_TO_ORTB[k] === assetType);\r\n      oldNativeObject[prebidAssetName] = {\r\n        required: asset.required ? Boolean(asset.required) : false,\r\n      }\r\n      if (asset.data.len) {\r\n        oldNativeObject[prebidAssetName].len = asset.data.len;\r\n      }\r\n    }\r\n    // video was not supported by old prebid assets\r\n  }\r\n  return oldNativeObject;\r\n}\r\n\r\n/**\r\n * Converts an OpenRTB request to a proprietary Prebid.js format.\r\n * The proprietary Prebid format has many limitations and will be dropped in\r\n * the future; adapters are encouraged to stop using it in favour of OpenRTB format.\r\n * IMPLEMENTATION DETAILS: This function returns the same exact object if no\r\n * conversion is needed. If a conversion is needed (meaning, at least one\r\n * bidRequest contains a native.ortb definition), it will return a copy.\r\n *\r\n * @param {BidRequest[]} bidRequests an array of valid bid requests\r\n * @returns an array of valid bid requests where the openRTB bids are converted to proprietary format.\r\n */\r\nexport function convertOrtbRequestToProprietaryNative(bidRequests) {\r\n  if (FEATURES.NATIVE) {\r\n    if (!bidRequests || !isArray(bidRequests)) return bidRequests;\r\n    // check if a conversion is needed\r\n    if (!bidRequests.some(bidRequest => (bidRequest?.mediaTypes || {})[NATIVE]?.ortb)) {\r\n      return bidRequests;\r\n    }\r\n    let bidRequestsCopy = deepClone(bidRequests);\r\n    // convert Native ORTB definition to old-style prebid native definition\r\n    for (const bidRequest of bidRequestsCopy) {\r\n      if (bidRequest.mediaTypes && bidRequest.mediaTypes[NATIVE] && bidRequest.mediaTypes[NATIVE].ortb) {\r\n        bidRequest.mediaTypes[NATIVE] = Object.assign(\r\n          pick(bidRequest.mediaTypes[NATIVE], NATIVE_KEYS_THAT_ARE_NOT_ASSETS),\r\n          fromOrtbNativeRequest(bidRequest.mediaTypes[NATIVE].ortb)\r\n        );\r\n        bidRequest.nativeParams = processNativeAdUnitParams(bidRequest.mediaTypes[NATIVE]);\r\n      }\r\n    }\r\n    return bidRequestsCopy;\r\n  }\r\n  return bidRequests;\r\n}\r\n\r\n/**\r\n * convert PBJS proprietary native properties that are *not* assets to the ORTB native format.\r\n *\r\n * @param legacyNative `bidResponse.native` object as returned by adapters\r\n */\r\nexport function legacyPropertiesToOrtbNative(legacyNative) {\r\n  const response = {\r\n    link: {},\r\n    eventtrackers: []\r\n  }\r\n  Object.entries(legacyNative).forEach(([key, value]) => {\r\n    switch (key) {\r\n      case 'clickUrl':\r\n        response.link.url = value;\r\n        break;\r\n      case 'clickTrackers':\r\n        response.link.clicktrackers = Array.isArray(value) ? value : [value];\r\n        break;\r\n      case 'impressionTrackers':\r\n        (Array.isArray(value) ? value : [value]).forEach(url => {\r\n          response.eventtrackers.push({\r\n            event: TRACKER_EVENTS.impression,\r\n            method: TRACKER_METHODS.img,\r\n            url\r\n          });\r\n        });\r\n        break;\r\n      case 'javascriptTrackers':\r\n        // jstracker is deprecated, but we need to use it here since 'javascriptTrackers' is markup, not an url\r\n        // TODO: at the time of writing this, core expected javascriptTrackers to be a string (despite the name),\r\n        // but many adapters are passing an array. It's possible that some of them are, in fact, passing URLs and not markup\r\n        // in general, native trackers seem to be neglected and/or broken\r\n        response.jstracker = Array.isArray(value) ? value.join('') : value;\r\n        break;\r\n    }\r\n  })\r\n  return response;\r\n}\r\n\r\nexport function toOrtbNativeResponse(legacyResponse, ortbRequest) {\r\n  const ortbResponse = {\r\n    ...legacyPropertiesToOrtbNative(legacyResponse),\r\n    assets: []\r\n  };\r\n\r\n  function useRequestAsset(predicate, fn) {\r\n    let asset = ortbRequest.assets.find(predicate);\r\n    if (asset != null) {\r\n      asset = deepClone(asset);\r\n      fn(asset);\r\n      ortbResponse.assets.push(asset);\r\n    }\r\n  }\r\n\r\n  Object.keys(legacyResponse).filter(key => !!legacyResponse[key]).forEach(key => {\r\n    const value = legacyResponse[key];\r\n    switch (key) {\r\n      // process titles\r\n      case 'title':\r\n        useRequestAsset(asset => asset.title != null, titleAsset => {\r\n          titleAsset.title = {\r\n            text: value\r\n          };\r\n        })\r\n        break;\r\n      case 'image':\r\n      case 'icon':\r\n        const imageType = key === 'image' ? NATIVE_IMAGE_TYPES.MAIN : NATIVE_IMAGE_TYPES.ICON;\r\n        useRequestAsset(asset => asset.img != null && asset.img.type === imageType, imageAsset => {\r\n          imageAsset.img = {\r\n            url: value\r\n          };\r\n        })\r\n        break;\r\n      default:\r\n        if (key in PREBID_NATIVE_DATA_KEYS_TO_ORTB) {\r\n          useRequestAsset(asset => asset.data != null && asset.data.type === NATIVE_ASSET_TYPES[PREBID_NATIVE_DATA_KEYS_TO_ORTB[key]], dataAsset => {\r\n            dataAsset.data = {\r\n              value\r\n            };\r\n          })\r\n        }\r\n        break;\r\n    }\r\n  });\r\n  return ortbResponse;\r\n}\r\n\r\n/**\r\n * Generates a legacy response from an ortb response. Useful during the transition period.\r\n * @param {*} ortbResponse a standard ortb response object\r\n * @param {*} ortbRequest the ortb request, useful to match ids.\r\n * @returns an object containing the response in legacy native format: { title: \"this is a title\", image: ... }\r\n */\r\nfunction toLegacyResponse(ortbResponse, ortbRequest) {\r\n  const legacyResponse = {};\r\n  const requestAssets = ortbRequest?.assets || [];\r\n  legacyResponse.clickUrl = ortbResponse.link.url;\r\n  legacyResponse.privacyLink = ortbResponse.privacy;\r\n  for (const asset of ortbResponse?.assets || []) {\r\n    const requestAsset = requestAssets.find(reqAsset => asset.id === reqAsset.id);\r\n    if (asset.title) {\r\n      legacyResponse.title = asset.title.text;\r\n    } else if (asset.img) {\r\n      legacyResponse[requestAsset.img.type === NATIVE_IMAGE_TYPES.MAIN ? 'image' : 'icon'] = asset.img.url;\r\n    } else if (asset.data) {\r\n      legacyResponse[PREBID_NATIVE_DATA_KEYS_TO_ORTB_INVERSE[NATIVE_ASSET_TYPES_INVERSE[requestAsset.data.type]]] = asset.data.value;\r\n    }\r\n  }\r\n  return legacyResponse;\r\n}\r\n\r\n/**\r\n * Inverts key-values of an object.\r\n */\r\nfunction inverse(obj) {\r\n  var retobj = {};\r\n  for (var key in obj) {\r\n    retobj[obj[key]] = key;\r\n  }\r\n  return retobj;\r\n}\r\n","// These stubs are here to help transition away from core-js polyfills for browsers we are no longer supporting.\r\n// You should not need these for new code; use stock JS instead!\r\n\r\nexport function includes(target, elem, start) {\r\n  return (target && target.includes(elem, start)) || false;\r\n}\r\n\r\nexport function arrayFrom() {\r\n  return Array.from.apply(Array, arguments);\r\n}\r\n\r\nexport function find(arr, pred, thisArg) {\r\n  return arr && arr.find(pred, thisArg);\r\n}\r\n\r\nexport function findIndex(arr, pred, thisArg) {\r\n  return arr && arr.findIndex(pred, thisArg);\r\n}\r\n","/** @module pbjs */\r\n\r\nimport {getGlobal} from './prebidGlobal.js';\r\nimport {\r\n  adUnitsFilter,\r\n  bind,\r\n  callBurl,\r\n  contains,\r\n  createInvisibleIframe,\r\n  deepAccess,\r\n  deepClone,\r\n  deepSetValue,\r\n  flatten,\r\n  generateUUID,\r\n  getHighestCpm,\r\n  inIframe,\r\n  insertElement,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isEmpty,\r\n  isFn,\r\n  isGptPubadsDefined,\r\n  isNumber,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep,\r\n  replaceAuctionPrice,\r\n  replaceClickThrough,\r\n  transformAdServerTargetingObj,\r\n  uniques,\r\n  unsupportedBidderMessage\r\n} from './utils.js';\r\nimport {listenMessagesFromCreative} from './secureCreatives.js';\r\nimport {userSync} from './userSync.js';\r\nimport {config} from './config.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {filters, targeting} from './targeting.js';\r\nimport {hook, wrapHook} from './hook.js';\r\nimport {loadSession} from './debugging.js';\r\nimport {includes} from './polyfill.js';\r\nimport {adunitCounter} from './adUnits.js';\r\nimport {executeRenderer, isRendererRequired} from './Renderer.js';\r\nimport {createBid} from './bidfactory.js';\r\nimport {storageCallbacks} from './storageManager.js';\r\nimport {emitAdRenderFail, emitAdRenderSucceeded} from './adRendering.js';\r\nimport {default as adapterManager, gdprDataHandler, getS2SBidderSet, uspDataHandler} from './adapterManager.js';\r\nimport CONSTANTS from './constants.json';\r\nimport * as events from './events.js';\r\nimport {newMetrics, useMetrics} from './utils/perfMetrics.js';\r\n\r\nconst $$PREBID_GLOBAL$$ = getGlobal();\r\nconst { triggerUserSyncs } = userSync;\r\n\r\n/* private variables */\r\nconst { ADD_AD_UNITS, BID_WON, REQUEST_BIDS, SET_TARGETING, STALE_RENDER } = CONSTANTS.EVENTS;\r\nconst { PREVENT_WRITING_ON_MAIN_DOCUMENT, NO_AD, EXCEPTION, CANNOT_FIND_AD, MISSING_DOC_OR_ADID } = CONSTANTS.AD_RENDER_FAILED_REASON;\r\n\r\nconst eventValidators = {\r\n  bidWon: checkDefinedPlacement\r\n};\r\n\r\n// initialize existing debugging sessions if present\r\nloadSession();\r\n\r\n/* Public vars */\r\n$$PREBID_GLOBAL$$.bidderSettings = $$PREBID_GLOBAL$$.bidderSettings || {};\r\n\r\n// let the world know we are loaded\r\n$$PREBID_GLOBAL$$.libLoaded = true;\r\n\r\n// version auto generated from build\r\n$$PREBID_GLOBAL$$.version = 'v$prebid.version$';\r\nlogInfo('Prebid.js v$prebid.version$ loaded');\r\n\r\n$$PREBID_GLOBAL$$.installedModules = $$PREBID_GLOBAL$$.installedModules || [];\r\n\r\n// create adUnit array\r\n$$PREBID_GLOBAL$$.adUnits = $$PREBID_GLOBAL$$.adUnits || [];\r\n\r\n// Allow publishers who enable user sync override to trigger their sync\r\n$$PREBID_GLOBAL$$.triggerUserSyncs = triggerUserSyncs;\r\n\r\nfunction checkDefinedPlacement(id) {\r\n  var adUnitCodes = auctionManager.getBidsRequested().map(bidSet => bidSet.bids.map(bid => bid.adUnitCode))\r\n    .reduce(flatten)\r\n    .filter(uniques);\r\n\r\n  if (!contains(adUnitCodes, id)) {\r\n    logError('The \"' + id + '\" placement is not defined.');\r\n    return;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction setRenderSize(doc, width, height) {\r\n  if (doc.defaultView && doc.defaultView.frameElement) {\r\n    doc.defaultView.frameElement.width = width;\r\n    doc.defaultView.frameElement.height = height;\r\n  }\r\n}\r\n\r\nfunction validateSizes(sizes, targLength) {\r\n  let cleanSizes = [];\r\n  if (isArray(sizes) && ((targLength) ? sizes.length === targLength : sizes.length > 0)) {\r\n    // check if an array of arrays or array of numbers\r\n    if (sizes.every(sz => isArrayOfNums(sz, 2))) {\r\n      cleanSizes = sizes;\r\n    } else if (isArrayOfNums(sizes, 2)) {\r\n      cleanSizes.push(sizes);\r\n    }\r\n  }\r\n  return cleanSizes;\r\n}\r\n\r\nfunction validateBannerMediaType(adUnit) {\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const banner = validatedAdUnit.mediaTypes.banner;\r\n  const bannerSizes = validateSizes(banner.sizes);\r\n  if (bannerSizes.length > 0) {\r\n    banner.sizes = bannerSizes;\r\n    // Deprecation Warning: This property will be deprecated in next release in favor of adUnit.mediaTypes.banner.sizes\r\n    validatedAdUnit.sizes = bannerSizes;\r\n  } else {\r\n    logError('Detected a mediaTypes.banner object without a proper sizes field.  Please ensure the sizes are listed like: [[300, 250], ...].  Removing invalid mediaTypes.banner object from request.');\r\n    delete validatedAdUnit.mediaTypes.banner\r\n  }\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateVideoMediaType(adUnit) {\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const video = validatedAdUnit.mediaTypes.video;\r\n  if (video.playerSize) {\r\n    let tarPlayerSizeLen = (typeof video.playerSize[0] === 'number') ? 2 : 1;\r\n\r\n    const videoSizes = validateSizes(video.playerSize, tarPlayerSizeLen);\r\n    if (videoSizes.length > 0) {\r\n      if (tarPlayerSizeLen === 2) {\r\n        logInfo('Transforming video.playerSize from [640,480] to [[640,480]] so it\\'s in the proper format.');\r\n      }\r\n      video.playerSize = videoSizes;\r\n      // Deprecation Warning: This property will be deprecated in next release in favor of adUnit.mediaTypes.video.playerSize\r\n      validatedAdUnit.sizes = videoSizes;\r\n    } else {\r\n      logError('Detected incorrect configuration of mediaTypes.video.playerSize.  Please specify only one set of dimensions in a format like: [[640, 480]]. Removing invalid mediaTypes.video.playerSize property from request.');\r\n      delete validatedAdUnit.mediaTypes.video.playerSize;\r\n    }\r\n  }\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateNativeMediaType(adUnit) {\r\n  const validatedAdUnit = deepClone(adUnit);\r\n  const native = validatedAdUnit.mediaTypes.native;\r\n  // if native assets are specified in OpenRTB format, remove legacy assets and print a warn.\r\n  if (native.ortb) {\r\n    const legacyNativeKeys = Object.keys(CONSTANTS.NATIVE_KEYS).filter(key => CONSTANTS.NATIVE_KEYS[key].includes('hb_native_'));\r\n    const nativeKeys = Object.keys(native);\r\n    const intersection = nativeKeys.filter(nativeKey => legacyNativeKeys.includes(nativeKey));\r\n    if (intersection.length > 0) {\r\n      logError(`when using native OpenRTB format, you cannot use legacy native properties. Deleting ${intersection} keys from request.`);\r\n      intersection.forEach(legacyKey => delete validatedAdUnit.mediaTypes.native[legacyKey]);\r\n    }\r\n  }\r\n  if (native.image && native.image.sizes && !Array.isArray(native.image.sizes)) {\r\n    logError('Please use an array of sizes for native.image.sizes field.  Removing invalid mediaTypes.native.image.sizes property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.image.sizes;\r\n  }\r\n  if (native.image && native.image.aspect_ratios && !Array.isArray(native.image.aspect_ratios)) {\r\n    logError('Please use an array of sizes for native.image.aspect_ratios field.  Removing invalid mediaTypes.native.image.aspect_ratios property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.image.aspect_ratios;\r\n  }\r\n  if (native.icon && native.icon.sizes && !Array.isArray(native.icon.sizes)) {\r\n    logError('Please use an array of sizes for native.icon.sizes field.  Removing invalid mediaTypes.native.icon.sizes property from request.');\r\n    delete validatedAdUnit.mediaTypes.native.icon.sizes;\r\n  }\r\n  return validatedAdUnit;\r\n}\r\n\r\nfunction validateAdUnitPos(adUnit, mediaType) {\r\n  let pos = deepAccess(adUnit, `mediaTypes.${mediaType}.pos`);\r\n\r\n  if (!isNumber(pos) || isNaN(pos) || !isFinite(pos)) {\r\n    let warning = `Value of property 'pos' on ad unit ${adUnit.code} should be of type: Number`;\r\n\r\n    logWarn(warning);\r\n    events.emit(CONSTANTS.EVENTS.AUCTION_DEBUG, {type: 'WARNING', arguments: warning});\r\n    delete adUnit.mediaTypes[mediaType].pos;\r\n  }\r\n\r\n  return adUnit\r\n}\r\n\r\nfunction validateAdUnit(adUnit) {\r\n  const msg = (msg) => `adUnit.code '${adUnit.code}' ${msg}`;\r\n\r\n  const mediaTypes = adUnit.mediaTypes;\r\n  const bids = adUnit.bids;\r\n\r\n  if (bids != null && !isArray(bids)) {\r\n    logError(msg(`defines 'adUnit.bids' that is not an array. Removing adUnit from auction`));\r\n    return null;\r\n  }\r\n  if (bids == null && adUnit.ortb2Imp == null) {\r\n    logError(msg(`has no 'adUnit.bids' and no 'adUnit.ortb2Imp'. Removing adUnit from auction`));\r\n    return null;\r\n  }\r\n  if (!mediaTypes || Object.keys(mediaTypes).length === 0) {\r\n    logError(msg(`does not define a 'mediaTypes' object.  This is a required field for the auction, so this adUnit has been removed.`));\r\n    return null;\r\n  }\r\n  if (adUnit.ortb2Imp != null && (bids == null || bids.length === 0)) {\r\n    adUnit.bids = [{bidder: null}]; // the 'null' bidder is treated as an s2s-only placeholder by adapterManager\r\n    logMessage(msg(`defines 'adUnit.ortb2Imp' with no 'adUnit.bids'; it will be seen only by S2S adapters`));\r\n  }\r\n\r\n  return adUnit;\r\n}\r\n\r\nexport const adUnitSetupChecks = {\r\n  validateAdUnit,\r\n  validateBannerMediaType,\r\n  validateVideoMediaType,\r\n  validateSizes\r\n};\r\n\r\nif (FEATURES.NATIVE) {\r\n  Object.assign(adUnitSetupChecks, {validateNativeMediaType});\r\n}\r\n\r\nexport const checkAdUnitSetup = hook('sync', function (adUnits) {\r\n  const validatedAdUnits = [];\r\n\r\n  adUnits.forEach(adUnit => {\r\n    adUnit = validateAdUnit(adUnit);\r\n    if (adUnit == null) return;\r\n\r\n    const mediaTypes = adUnit.mediaTypes;\r\n    let validatedBanner, validatedVideo, validatedNative;\r\n\r\n    if (mediaTypes.banner) {\r\n      validatedBanner = validateBannerMediaType(adUnit);\r\n      if (mediaTypes.banner.hasOwnProperty('pos')) validatedBanner = validateAdUnitPos(validatedBanner, 'banner');\r\n    }\r\n\r\n    if (mediaTypes.video) {\r\n      validatedVideo = validatedBanner ? validateVideoMediaType(validatedBanner) : validateVideoMediaType(adUnit);\r\n      if (mediaTypes.video.hasOwnProperty('pos')) validatedVideo = validateAdUnitPos(validatedVideo, 'video');\r\n    }\r\n\r\n    if (FEATURES.NATIVE && mediaTypes.native) {\r\n      validatedNative = validatedVideo ? validateNativeMediaType(validatedVideo) : validatedBanner ? validateNativeMediaType(validatedBanner) : validateNativeMediaType(adUnit);\r\n    }\r\n\r\n    const validatedAdUnit = Object.assign({}, validatedBanner, validatedVideo, validatedNative);\r\n\r\n    validatedAdUnits.push(validatedAdUnit);\r\n  });\r\n\r\n  return validatedAdUnits;\r\n}, 'checkAdUnitSetup');\r\n\r\n/// ///////////////////////////////\r\n//                              //\r\n//    Start Public APIs         //\r\n//                              //\r\n/// ///////////////////////////////\r\n\r\n/**\r\n * This function returns the query string targeting parameters available at this moment for a given ad unit. Note that some bidder's response may not have been received if you call this function too quickly after the requests are sent.\r\n * @param  {string} [adunitCode] adUnitCode to get the bid responses for\r\n * @alias module:pbjs.getAdserverTargetingForAdUnitCodeStr\r\n * @return {Array}  returnObj return bids array\r\n */\r\n$$PREBID_GLOBAL$$.getAdserverTargetingForAdUnitCodeStr = function (adunitCode) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getAdserverTargetingForAdUnitCodeStr', arguments);\r\n\r\n  // call to retrieve bids array\r\n  if (adunitCode) {\r\n    var res = $$PREBID_GLOBAL$$.getAdserverTargetingForAdUnitCode(adunitCode);\r\n    return transformAdServerTargetingObj(res);\r\n  } else {\r\n    logMessage('Need to call getAdserverTargetingForAdUnitCodeStr with adunitCode');\r\n  }\r\n};\r\n\r\n/**\r\n * This function returns the query string targeting parameters available at this moment for a given ad unit. Note that some bidder's response may not have been received if you call this function too quickly after the requests are sent.\r\n * @param adUnitCode {string} adUnitCode to get the bid responses for\r\n * @alias module:pbjs.getHighestUnusedBidResponseForAdUnitCode\r\n * @returns {Object}  returnObj return bid\r\n */\r\n$$PREBID_GLOBAL$$.getHighestUnusedBidResponseForAdUnitCode = function (adunitCode) {\r\n  if (adunitCode) {\r\n    const bid = auctionManager.getAllBidsForAdUnitCode(adunitCode)\r\n      .filter(filters.isUnusedBid)\r\n      .filter(filters.isBidNotExpired)\r\n\r\n    return bid.length ? bid.reduce(getHighestCpm) : {}\r\n  } else {\r\n    logMessage('Need to call getHighestUnusedBidResponseForAdUnitCode with adunitCode');\r\n  }\r\n};\r\n\r\n/**\r\n * This function returns the query string targeting parameters available at this moment for a given ad unit. Note that some bidder's response may not have been received if you call this function too quickly after the requests are sent.\r\n * @param adUnitCode {string} adUnitCode to get the bid responses for\r\n * @alias module:pbjs.getAdserverTargetingForAdUnitCode\r\n * @returns {Object}  returnObj return bids\r\n */\r\n$$PREBID_GLOBAL$$.getAdserverTargetingForAdUnitCode = function (adUnitCode) {\r\n  return $$PREBID_GLOBAL$$.getAdserverTargeting(adUnitCode)[adUnitCode];\r\n};\r\n\r\n/**\r\n * returns all ad server targeting for all ad units\r\n * @return {Object} Map of adUnitCodes and targeting values []\r\n * @alias module:pbjs.getAdserverTargeting\r\n */\r\n\r\n$$PREBID_GLOBAL$$.getAdserverTargeting = function (adUnitCode) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getAdserverTargeting', arguments);\r\n  return targeting.getAllTargeting(adUnitCode);\r\n};\r\n\r\n/**\r\n * returns all consent data\r\n * @return {Object} Map of consent types and data\r\n * @alias module:pbjs.getConsentData\r\n */\r\nfunction getConsentMetadata() {\r\n  return {\r\n    gdpr: gdprDataHandler.getConsentMeta(),\r\n    usp: uspDataHandler.getConsentMeta(),\r\n    coppa: !!(config.getConfig('coppa'))\r\n  }\r\n}\r\n\r\n$$PREBID_GLOBAL$$.getConsentMetadata = function () {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getConsentMetadata');\r\n  return getConsentMetadata();\r\n};\r\n\r\nfunction getBids(type) {\r\n  const responses = auctionManager[type]()\r\n    .filter(bind.call(adUnitsFilter, this, auctionManager.getAdUnitCodes()));\r\n\r\n  // find the last auction id to get responses for most recent auction only\r\n  const currentAuctionId = auctionManager.getLastAuctionId();\r\n\r\n  return responses\r\n    .map(bid => bid.adUnitCode)\r\n    .filter(uniques).map(adUnitCode => responses\r\n      .filter(bid => bid.auctionId === currentAuctionId && bid.adUnitCode === adUnitCode))\r\n    .filter(bids => bids && bids[0] && bids[0].adUnitCode)\r\n    .map(bids => {\r\n      return {\r\n        [bids[0].adUnitCode]: { bids }\r\n      };\r\n    })\r\n    .reduce((a, b) => Object.assign(a, b), {});\r\n}\r\n\r\n/**\r\n * This function returns the bids requests involved in an auction but not bid on\r\n * @alias module:pbjs.getNoBids\r\n * @return {Object}            map | object that contains the bidRequests\r\n */\r\n\r\n$$PREBID_GLOBAL$$.getNoBids = function () {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getNoBids', arguments);\r\n  return getBids('getNoBids');\r\n};\r\n\r\n/**\r\n * This function returns the bids requests involved in an auction but not bid on or the specified adUnitCode\r\n * @param  {string} adUnitCode adUnitCode\r\n * @alias module:pbjs.getNoBidsForAdUnitCode\r\n * @return {Object}           bidResponse object\r\n */\r\n\r\n$$PREBID_GLOBAL$$.getNoBidsForAdUnitCode = function (adUnitCode) {\r\n  const bids = auctionManager.getNoBids().filter(bid => bid.adUnitCode === adUnitCode);\r\n  return { bids };\r\n};\r\n\r\n/**\r\n * This function returns the bid responses at the given moment.\r\n * @alias module:pbjs.getBidResponses\r\n * @return {Object}            map | object that contains the bidResponses\r\n */\r\n\r\n$$PREBID_GLOBAL$$.getBidResponses = function () {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getBidResponses', arguments);\r\n  return getBids('getBidsReceived');\r\n};\r\n\r\n/**\r\n * Returns bidResponses for the specified adUnitCode\r\n * @param  {string} adUnitCode adUnitCode\r\n * @alias module:pbjs.getBidResponsesForAdUnitCode\r\n * @return {Object}            bidResponse object\r\n */\r\n\r\n$$PREBID_GLOBAL$$.getBidResponsesForAdUnitCode = function (adUnitCode) {\r\n  const bids = auctionManager.getBidsReceived().filter(bid => bid.adUnitCode === adUnitCode);\r\n  return { bids };\r\n};\r\n\r\n/**\r\n * Set query string targeting on one or more GPT ad units.\r\n * @param {(string|string[])} adUnit a single `adUnit.code` or multiple.\r\n * @param {function(object)} customSlotMatching gets a GoogleTag slot and returns a filter function for adUnitCode, so you can decide to match on either eg. return slot => { return adUnitCode => { return slot.getSlotElementId() === 'myFavoriteDivId'; } };\r\n * @alias module:pbjs.setTargetingForGPTAsync\r\n */\r\n$$PREBID_GLOBAL$$.setTargetingForGPTAsync = function (adUnit, customSlotMatching) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.setTargetingForGPTAsync', arguments);\r\n  if (!isGptPubadsDefined()) {\r\n    logError('window.googletag is not defined on the page');\r\n    return;\r\n  }\r\n\r\n  // get our ad unit codes\r\n  let targetingSet = targeting.getAllTargeting(adUnit);\r\n\r\n  // first reset any old targeting\r\n  targeting.resetPresetTargeting(adUnit, customSlotMatching);\r\n\r\n  // now set new targeting keys\r\n  targeting.setTargetingForGPT(targetingSet, customSlotMatching);\r\n\r\n  Object.keys(targetingSet).forEach((adUnitCode) => {\r\n    Object.keys(targetingSet[adUnitCode]).forEach((targetingKey) => {\r\n      if (targetingKey === 'hb_adid') {\r\n        auctionManager.setStatusForBids(targetingSet[adUnitCode][targetingKey], CONSTANTS.BID_STATUS.BID_TARGETING_SET);\r\n      }\r\n    });\r\n  });\r\n\r\n  // emit event\r\n  events.emit(SET_TARGETING, targetingSet);\r\n};\r\n\r\n/**\r\n * Set query string targeting on all AST (AppNexus Seller Tag) ad units. Note that this function has to be called after all ad units on page are defined. For working example code, see [Using Prebid.js with AppNexus Publisher Ad Server](http://prebid.org/dev-docs/examples/use-prebid-with-appnexus-ad-server.html).\r\n * @param  {(string|string[])} adUnitCode adUnitCode or array of adUnitCodes\r\n * @alias module:pbjs.setTargetingForAst\r\n */\r\n$$PREBID_GLOBAL$$.setTargetingForAst = function (adUnitCodes) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.setTargetingForAn', arguments);\r\n  if (!targeting.isApntagDefined()) {\r\n    logError('window.apntag is not defined on the page');\r\n    return;\r\n  }\r\n\r\n  targeting.setTargetingForAst(adUnitCodes);\r\n\r\n  // emit event\r\n  events.emit(SET_TARGETING, targeting.getAllTargeting());\r\n};\r\n\r\n/**\r\n * This function will check for presence of given node in given parent. If not present - will inject it.\r\n * @param {Node} node node, whose existance is in question\r\n * @param {Document} doc document element do look in\r\n * @param {string} tagName tag name to look in\r\n */\r\nfunction reinjectNodeIfRemoved(node, doc, tagName) {\r\n  const injectionNode = doc.querySelector(tagName);\r\n  if (!node.parentNode || node.parentNode !== injectionNode) {\r\n    insertElement(node, doc, tagName);\r\n  }\r\n}\r\n\r\n/**\r\n * This function will render the ad (based on params) in the given iframe document passed through.\r\n * Note that doc SHOULD NOT be the parent document page as we can't doc.write() asynchronously\r\n * @param  {Document} doc document\r\n * @param  {string} id bid id to locate the ad\r\n * @alias module:pbjs.renderAd\r\n */\r\n$$PREBID_GLOBAL$$.renderAd = hook('async', function (doc, id, options) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.renderAd', arguments);\r\n  logMessage('Calling renderAd with adId :' + id);\r\n\r\n  if (doc && id) {\r\n    try {\r\n      // lookup ad by ad Id\r\n      const bid = auctionManager.findBidByAdId(id);\r\n\r\n      if (bid) {\r\n        let shouldRender = true;\r\n        if (bid && bid.status === CONSTANTS.BID_STATUS.RENDERED) {\r\n          logWarn(`Ad id ${bid.adId} has been rendered before`);\r\n          events.emit(STALE_RENDER, bid);\r\n          if (deepAccess(config.getConfig('auctionOptions'), 'suppressStaleRender')) {\r\n            shouldRender = false;\r\n          }\r\n        }\r\n\r\n        if (shouldRender) {\r\n          // replace macros according to openRTB with price paid = bid.cpm\r\n          bid.ad = replaceAuctionPrice(bid.ad, bid.originalCpm || bid.cpm);\r\n          bid.adUrl = replaceAuctionPrice(bid.adUrl, bid.originalCpm || bid.cpm);\r\n          // replacing clickthrough if submitted\r\n          if (options && options.clickThrough) {\r\n            const {clickThrough} = options;\r\n            bid.ad = replaceClickThrough(bid.ad, clickThrough);\r\n            bid.adUrl = replaceClickThrough(bid.adUrl, clickThrough);\r\n          }\r\n\r\n          // save winning bids\r\n          auctionManager.addWinningBid(bid);\r\n\r\n          // emit 'bid won' event here\r\n          events.emit(BID_WON, bid);\r\n\r\n          const {height, width, ad, mediaType, adUrl, renderer} = bid;\r\n\r\n          const creativeComment = document.createComment(`Creative ${bid.creativeId} served by ${bid.bidder} Prebid.js Header Bidding`);\r\n          insertElement(creativeComment, doc, 'html');\r\n\r\n          if (isRendererRequired(renderer)) {\r\n            executeRenderer(renderer, bid, doc);\r\n            reinjectNodeIfRemoved(creativeComment, doc, 'html');\r\n            emitAdRenderSucceeded({ doc, bid, id });\r\n          } else if ((doc === document && !inIframe()) || mediaType === 'video') {\r\n            const message = `Error trying to write ad. Ad render call ad id ${id} was prevented from writing to the main document.`;\r\n            emitAdRenderFail({reason: PREVENT_WRITING_ON_MAIN_DOCUMENT, message, bid, id});\r\n          } else if (ad) {\r\n            doc.write(ad);\r\n            doc.close();\r\n            setRenderSize(doc, width, height);\r\n            reinjectNodeIfRemoved(creativeComment, doc, 'html');\r\n            callBurl(bid);\r\n            emitAdRenderSucceeded({ doc, bid, id });\r\n          } else if (adUrl) {\r\n            const iframe = createInvisibleIframe();\r\n            iframe.height = height;\r\n            iframe.width = width;\r\n            iframe.style.display = 'inline';\r\n            iframe.style.overflow = 'hidden';\r\n            iframe.src = adUrl;\r\n\r\n            insertElement(iframe, doc, 'body');\r\n            setRenderSize(doc, width, height);\r\n            reinjectNodeIfRemoved(creativeComment, doc, 'html');\r\n            callBurl(bid);\r\n            emitAdRenderSucceeded({ doc, bid, id });\r\n          } else {\r\n            const message = `Error trying to write ad. No ad for bid response id: ${id}`;\r\n            emitAdRenderFail({reason: NO_AD, message, bid, id});\r\n          }\r\n        }\r\n      } else {\r\n        const message = `Error trying to write ad. Cannot find ad by given id : ${id}`;\r\n        emitAdRenderFail({ reason: CANNOT_FIND_AD, message, id });\r\n      }\r\n    } catch (e) {\r\n      const message = `Error trying to write ad Id :${id} to the page:${e.message}`;\r\n      emitAdRenderFail({ reason: EXCEPTION, message, id });\r\n    }\r\n  } else {\r\n    const message = `Error trying to write ad Id :${id} to the page. Missing document or adId`;\r\n    emitAdRenderFail({ reason: MISSING_DOC_OR_ADID, message, id });\r\n  }\r\n});\r\n\r\n/**\r\n * Remove adUnit from the $$PREBID_GLOBAL$$ configuration, if there are no addUnitCode(s) it will remove all\r\n * @param  {string| Array} adUnitCode the adUnitCode(s) to remove\r\n * @alias module:pbjs.removeAdUnit\r\n */\r\n$$PREBID_GLOBAL$$.removeAdUnit = function (adUnitCode) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.removeAdUnit', arguments);\r\n\r\n  if (!adUnitCode) {\r\n    $$PREBID_GLOBAL$$.adUnits = [];\r\n    return;\r\n  }\r\n\r\n  let adUnitCodes;\r\n\r\n  if (isArray(adUnitCode)) {\r\n    adUnitCodes = adUnitCode;\r\n  } else {\r\n    adUnitCodes = [adUnitCode];\r\n  }\r\n\r\n  adUnitCodes.forEach((adUnitCode) => {\r\n    for (let i = $$PREBID_GLOBAL$$.adUnits.length - 1; i >= 0; i--) {\r\n      if ($$PREBID_GLOBAL$$.adUnits[i].code === adUnitCode) {\r\n        $$PREBID_GLOBAL$$.adUnits.splice(i, 1);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * @param {Object} requestOptions\r\n * @param {function} requestOptions.bidsBackHandler\r\n * @param {number} requestOptions.timeout\r\n * @param {Array} requestOptions.adUnits\r\n * @param {Array} requestOptions.adUnitCodes\r\n * @param {Array} requestOptions.labels\r\n * @param {String} requestOptions.auctionId\r\n * @alias module:pbjs.requestBids\r\n */\r\n$$PREBID_GLOBAL$$.requestBids = (function() {\r\n  const delegate = hook('async', function ({ bidsBackHandler, timeout, adUnits, adUnitCodes, labels, auctionId, ortb2, metrics } = {}) {\r\n    events.emit(REQUEST_BIDS);\r\n    const cbTimeout = timeout || config.getConfig('bidderTimeout');\r\n    logInfo('Invoking $$PREBID_GLOBAL$$.requestBids', arguments);\r\n    const ortb2Fragments = {\r\n      global: mergeDeep({}, config.getAnyConfig('ortb2') || {}, ortb2 || {}),\r\n      bidder: Object.fromEntries(Object.entries(config.getBidderConfig()).map(([bidder, cfg]) => [bidder, cfg.ortb2]).filter(([_, ortb2]) => ortb2 != null))\r\n    }\r\n    return startAuction({bidsBackHandler, timeout: cbTimeout, adUnits, adUnitCodes, labels, auctionId, ortb2Fragments, metrics});\r\n  }, 'requestBids');\r\n\r\n  return wrapHook(delegate, function requestBids(req = {}) {\r\n    // if the request does not specify adUnits, clone the global adUnit array - before\r\n    // any hook has a chance to run.\r\n    // otherwise, if the caller goes on to use addAdUnits/removeAdUnits, any asynchronous logic\r\n    // in any hook might see their effects.\r\n    req.metrics = newMetrics();\r\n    req.metrics.checkpoint('requestBids');\r\n    let adUnits = req.adUnits || $$PREBID_GLOBAL$$.adUnits;\r\n    req.adUnits = (isArray(adUnits) ? adUnits.slice() : [adUnits]);\r\n    return delegate.call(this, req);\r\n  });\r\n})();\r\n\r\nexport const startAuction = hook('async', function ({ bidsBackHandler, timeout: cbTimeout, adUnits, adUnitCodes, labels, auctionId, ortb2Fragments, metrics } = {}) {\r\n  const s2sBidders = getS2SBidderSet(config.getConfig('s2sConfig') || []);\r\n  adUnits = useMetrics(metrics).measureTime('requestBids.validate', () => checkAdUnitSetup(adUnits));\r\n\r\n  if (adUnitCodes && adUnitCodes.length) {\r\n    // if specific adUnitCodes supplied filter adUnits for those codes\r\n    adUnits = adUnits.filter(unit => includes(adUnitCodes, unit.code));\r\n  } else {\r\n    // otherwise derive adUnitCodes from adUnits\r\n    adUnitCodes = adUnits && adUnits.map(unit => unit.code);\r\n  }\r\n\r\n  /*\r\n   * for a given adunit which supports a set of mediaTypes\r\n   * and a given bidder which supports a set of mediaTypes\r\n   * a bidder is eligible to participate on the adunit\r\n   * if it supports at least one of the mediaTypes on the adunit\r\n   */\r\n  adUnits.forEach(adUnit => {\r\n    // get the adunit's mediaTypes, defaulting to banner if mediaTypes isn't present\r\n    const adUnitMediaTypes = Object.keys(adUnit.mediaTypes || { 'banner': 'banner' });\r\n\r\n    // get the bidder's mediaTypes\r\n    const allBidders = adUnit.bids.map(bid => bid.bidder);\r\n    const bidderRegistry = adapterManager.bidderRegistry;\r\n\r\n    const bidders = allBidders.filter(bidder => !s2sBidders.has(bidder));\r\n\r\n    const tid = adUnit.ortb2Imp?.ext?.tid || generateUUID();\r\n    adUnit.transactionId = tid;\r\n    // Populate ortb2Imp.ext.tid with transactionId. Specifying a transaction ID per item in the ortb impression array, lets multiple transaction IDs be transmitted in a single bid request.\r\n    deepSetValue(adUnit, 'ortb2Imp.ext.tid', tid);\r\n\r\n    bidders.forEach(bidder => {\r\n      const adapter = bidderRegistry[bidder];\r\n      const spec = adapter && adapter.getSpec && adapter.getSpec();\r\n      // banner is default if not specified in spec\r\n      const bidderMediaTypes = (spec && spec.supportedMediaTypes) || ['banner'];\r\n\r\n      // check if the bidder's mediaTypes are not in the adUnit's mediaTypes\r\n      const bidderEligible = adUnitMediaTypes.some(type => includes(bidderMediaTypes, type));\r\n      if (!bidderEligible) {\r\n        // drop the bidder from the ad unit if it's not compatible\r\n        logWarn(unsupportedBidderMessage(adUnit, bidder));\r\n        adUnit.bids = adUnit.bids.filter(bid => bid.bidder !== bidder);\r\n      } else {\r\n        adunitCounter.incrementBidderRequestsCounter(adUnit.code, bidder);\r\n      }\r\n    });\r\n    adunitCounter.incrementRequestsCounter(adUnit.code);\r\n  });\r\n\r\n  if (!adUnits || adUnits.length === 0) {\r\n    logMessage('No adUnits configured. No bids requested.');\r\n    if (typeof bidsBackHandler === 'function') {\r\n      // executeCallback, this will only be called in case of first request\r\n      try {\r\n        bidsBackHandler();\r\n      } catch (e) {\r\n        logError('Error executing bidsBackHandler', null, e);\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  const auction = auctionManager.createAuction({\r\n    adUnits,\r\n    adUnitCodes,\r\n    callback: bidsBackHandler,\r\n    cbTimeout,\r\n    labels,\r\n    auctionId,\r\n    ortb2Fragments,\r\n    metrics,\r\n  });\r\n\r\n  let adUnitsLen = adUnits.length;\r\n  if (adUnitsLen > 15) {\r\n    logInfo(`Current auction ${auction.getAuctionId()} contains ${adUnitsLen} adUnits.`, adUnits);\r\n  }\r\n\r\n  adUnitCodes.forEach(code => targeting.setLatestAuctionForAdUnit(code, auction.getAuctionId()));\r\n  auction.callBids();\r\n}, 'startAuction');\r\n\r\nexport function executeCallbacks(fn, reqBidsConfigObj) {\r\n  runAll(storageCallbacks);\r\n  runAll(enableAnalyticsCallbacks);\r\n  fn.call(this, reqBidsConfigObj);\r\n\r\n  function runAll(queue) {\r\n    var queued;\r\n    while ((queued = queue.shift())) {\r\n      queued();\r\n    }\r\n  }\r\n}\r\n\r\n// This hook will execute all storage callbacks which were registered before gdpr enforcement hook was added. Some bidders, user id modules use storage functions when module is parsed but gdpr enforcement hook is not added at that stage as setConfig callbacks are yet to be called. Hence for such calls we execute all the stored callbacks just before requestBids. At this hook point we will know for sure that gdprEnforcement module is added or not\r\n$$PREBID_GLOBAL$$.requestBids.before(executeCallbacks, 49);\r\n\r\n/**\r\n *\r\n * Add adunit(s)\r\n * @param {Array|Object} adUnitArr Array of adUnits or single adUnit Object.\r\n * @alias module:pbjs.addAdUnits\r\n */\r\n$$PREBID_GLOBAL$$.addAdUnits = function (adUnitArr) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.addAdUnits', arguments);\r\n  $$PREBID_GLOBAL$$.adUnits.push.apply($$PREBID_GLOBAL$$.adUnits, isArray(adUnitArr) ? adUnitArr : [adUnitArr]);\r\n  // emit event\r\n  events.emit(ADD_AD_UNITS);\r\n};\r\n\r\n/**\r\n * @param {string} event the name of the event\r\n * @param {Function} handler a callback to set on event\r\n * @param {string} id an identifier in the context of the event\r\n * @alias module:pbjs.onEvent\r\n *\r\n * This API call allows you to register a callback to handle a Prebid.js event.\r\n * An optional `id` parameter provides more finely-grained event callback registration.\r\n * This makes it possible to register callback events for a specific item in the\r\n * event context. For example, `bidWon` events will accept an `id` for ad unit code.\r\n * `bidWon` callbacks registered with an ad unit code id will be called when a bid\r\n * for that ad unit code wins the auction. Without an `id` this method registers the\r\n * callback for every `bidWon` event.\r\n *\r\n * Currently `bidWon` is the only event that accepts an `id` parameter.\r\n */\r\n$$PREBID_GLOBAL$$.onEvent = function (event, handler, id) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.onEvent', arguments);\r\n  if (!isFn(handler)) {\r\n    logError('The event handler provided is not a function and was not set on event \"' + event + '\".');\r\n    return;\r\n  }\r\n\r\n  if (id && !eventValidators[event].call(null, id)) {\r\n    logError('The id provided is not valid for event \"' + event + '\" and no handler was set.');\r\n    return;\r\n  }\r\n\r\n  events.on(event, handler, id);\r\n};\r\n\r\n/**\r\n * @param {string} event the name of the event\r\n * @param {Function} handler a callback to remove from the event\r\n * @param {string} id an identifier in the context of the event (see `$$PREBID_GLOBAL$$.onEvent`)\r\n * @alias module:pbjs.offEvent\r\n */\r\n$$PREBID_GLOBAL$$.offEvent = function (event, handler, id) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.offEvent', arguments);\r\n  if (id && !eventValidators[event].call(null, id)) {\r\n    return;\r\n  }\r\n\r\n  events.off(event, handler, id);\r\n};\r\n\r\n/**\r\n * Return a copy of all events emitted\r\n *\r\n * @alias module:pbjs.getEvents\r\n */\r\n$$PREBID_GLOBAL$$.getEvents = function () {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.getEvents');\r\n  return events.getEvents();\r\n};\r\n\r\n/*\r\n * Wrapper to register bidderAdapter externally (adapterManager.registerBidAdapter())\r\n * @param  {Function} bidderAdaptor [description]\r\n * @param  {string} bidderCode [description]\r\n * @alias module:pbjs.registerBidAdapter\r\n */\r\n$$PREBID_GLOBAL$$.registerBidAdapter = function (bidderAdaptor, bidderCode) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.registerBidAdapter', arguments);\r\n  try {\r\n    adapterManager.registerBidAdapter(bidderAdaptor(), bidderCode);\r\n  } catch (e) {\r\n    logError('Error registering bidder adapter : ' + e.message);\r\n  }\r\n};\r\n\r\n/**\r\n * Wrapper to register analyticsAdapter externally (adapterManager.registerAnalyticsAdapter())\r\n * @param  {Object} options [description]\r\n * @alias module:pbjs.registerAnalyticsAdapter\r\n */\r\n$$PREBID_GLOBAL$$.registerAnalyticsAdapter = function (options) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.registerAnalyticsAdapter', arguments);\r\n  try {\r\n    adapterManager.registerAnalyticsAdapter(options);\r\n  } catch (e) {\r\n    logError('Error registering analytics adapter : ' + e.message);\r\n  }\r\n};\r\n\r\n/**\r\n * Wrapper to bidfactory.createBid()\r\n * @param  {string} statusCode [description]\r\n * @alias module:pbjs.createBid\r\n * @return {Object} bidResponse [description]\r\n */\r\n$$PREBID_GLOBAL$$.createBid = function (statusCode) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.createBid', arguments);\r\n  return createBid(statusCode);\r\n};\r\n\r\n/**\r\n * Enable sending analytics data to the analytics provider of your\r\n * choice.\r\n *\r\n * For usage, see [Integrate with the Prebid Analytics\r\n * API](http://prebid.org/dev-docs/integrate-with-the-prebid-analytics-api.html).\r\n *\r\n * For a list of analytics adapters, see [Analytics for\r\n * Prebid](http://prebid.org/overview/analytics.html).\r\n * @param  {Object} config\r\n * @param {string} config.provider The name of the provider, e.g., `\"ga\"` for Google Analytics.\r\n * @param {Object} config.options The options for this particular analytics adapter.  This will likely vary between adapters.\r\n * @alias module:pbjs.enableAnalytics\r\n */\r\n\r\n// Stores 'enableAnalytics' callbacks for later execution.\r\nconst enableAnalyticsCallbacks = [];\r\n\r\nconst enableAnalyticsCb = hook('async', function (config) {\r\n  if (config && !isEmpty(config)) {\r\n    logInfo('Invoking $$PREBID_GLOBAL$$.enableAnalytics for: ', config);\r\n    adapterManager.enableAnalytics(config);\r\n  } else {\r\n    logError('$$PREBID_GLOBAL$$.enableAnalytics should be called with option {}');\r\n  }\r\n}, 'enableAnalyticsCb');\r\n\r\n$$PREBID_GLOBAL$$.enableAnalytics = function (config) {\r\n  enableAnalyticsCallbacks.push(enableAnalyticsCb.bind(this, config));\r\n};\r\n\r\n/**\r\n * @alias module:pbjs.aliasBidder\r\n */\r\n$$PREBID_GLOBAL$$.aliasBidder = function (bidderCode, alias, options) {\r\n  logInfo('Invoking $$PREBID_GLOBAL$$.aliasBidder', arguments);\r\n  if (bidderCode && alias) {\r\n    adapterManager.aliasBidAdapter(bidderCode, alias, options);\r\n  } else {\r\n    logError('bidderCode and alias must be passed as arguments', '$$PREBID_GLOBAL$$.aliasBidder');\r\n  }\r\n};\r\n\r\n/**\r\n * The bid response object returned by an external bidder adapter during the auction.\r\n * @typedef {Object} AdapterBidResponse\r\n * @property {string} pbAg Auto granularity price bucket; CPM <= 5 ? increment = 0.05 : CPM > 5 && CPM <= 10 ? increment = 0.10 : CPM > 10 && CPM <= 20 ? increment = 0.50 : CPM > 20 ? priceCap = 20.00.  Example: `\"0.80\"`.\r\n * @property {string} pbCg Custom price bucket.  For example setup, see {@link setPriceGranularity}.  Example: `\"0.84\"`.\r\n * @property {string} pbDg Dense granularity price bucket; CPM <= 3 ? increment = 0.01 : CPM > 3 && CPM <= 8 ? increment = 0.05 : CPM > 8 && CPM <= 20 ? increment = 0.50 : CPM > 20? priceCap = 20.00.  Example: `\"0.84\"`.\r\n * @property {string} pbLg Low granularity price bucket; $0.50 increment, capped at $5, floored to two decimal places.  Example: `\"0.50\"`.\r\n * @property {string} pbMg Medium granularity price bucket; $0.10 increment, capped at $20, floored to two decimal places.  Example: `\"0.80\"`.\r\n * @property {string} pbHg High granularity price bucket; $0.01 increment, capped at $20, floored to two decimal places.  Example: `\"0.84\"`.\r\n *\r\n * @property {string} bidder The string name of the bidder.  This *may* be the same as the `bidderCode`.  For For a list of all bidders and their codes, see [Bidders' Params](http://prebid.org/dev-docs/bidders.html).\r\n * @property {string} bidderCode The unique string that identifies this bidder.  For a list of all bidders and their codes, see [Bidders' Params](http://prebid.org/dev-docs/bidders.html).\r\n *\r\n * @property {string} requestId The [UUID](https://en.wikipedia.org/wiki/Universally_unique_identifier) representing the bid request.\r\n * @property {number} requestTimestamp The time at which the bid request was sent out, expressed in milliseconds.\r\n * @property {number} responseTimestamp The time at which the bid response was received, expressed in milliseconds.\r\n * @property {number} timeToRespond How long it took for the bidder to respond with this bid, expressed in milliseconds.\r\n *\r\n * @property {string} size The size of the ad creative, expressed in `\"AxB\"` format, where A and B are numbers of pixels.  Example: `\"320x50\"`.\r\n * @property {string} width The width of the ad creative in pixels.  Example: `\"320\"`.\r\n * @property {string} height The height of the ad creative in pixels.  Example: `\"50\"`.\r\n *\r\n * @property {string} ad The actual ad creative content, often HTML with CSS, JavaScript, and/or links to additional content.  Example: `\"<div id='beacon_-YQbipJtdxmMCgEPHExLhmqzEm' style='position: absolute; left: 0px; top: 0px; visibility: hidden;'><img src='http://aplus-...'/></div><iframe src=\\\"http://aax-us-east.amazon-adsystem.com/e/is/8dcfcd...\" width=\\\"728\\\" height=\\\"90\\\" frameborder=\\\"0\\\" ...></iframe>\",`.\r\n * @property {number} ad_id The ad ID of the creative, as understood by the bidder's system.  Used by the line item's [creative in the ad server](http://prebid.org/adops/send-all-bids-adops.html#step-3-add-a-creative).\r\n * @property {string} adUnitCode The code used to uniquely identify the ad unit on the publisher's page.\r\n *\r\n * @property {string} statusMessage The status of the bid.  Allowed values: `\"Bid available\"` or `\"Bid returned empty or error response\"`.\r\n * @property {number} cpm The exact bid price from the bidder, expressed to the thousandths place.  Example: `\"0.849\"`.\r\n *\r\n * @property {Object} adserverTargeting An object whose values represent the ad server's targeting on the bid.\r\n * @property {string} adserverTargeting.hb_adid The ad ID of the creative, as understood by the ad server.\r\n * @property {string} adserverTargeting.hb_pb The price paid to show the creative, as logged in the ad server.\r\n * @property {string} adserverTargeting.hb_bidder The winning bidder whose ad creative will be served by the ad server.\r\n */\r\n\r\n/**\r\n * Get all of the bids that have been rendered.  Useful for [troubleshooting your integration](http://prebid.org/dev-docs/prebid-troubleshooting-guide.html).\r\n * @return {Array<AdapterBidResponse>} A list of bids that have been rendered.\r\n */\r\n$$PREBID_GLOBAL$$.getAllWinningBids = function () {\r\n  return auctionManager.getAllWinningBids();\r\n};\r\n\r\n/**\r\n * Get all of the bids that have won their respective auctions.\r\n * @return {Array<AdapterBidResponse>} A list of bids that have won their respective auctions.\r\n */\r\n$$PREBID_GLOBAL$$.getAllPrebidWinningBids = function () {\r\n  return auctionManager.getBidsReceived()\r\n    .filter(bid => bid.status === CONSTANTS.BID_STATUS.BID_TARGETING_SET);\r\n};\r\n\r\n/**\r\n * Get array of highest cpm bids for all adUnits, or highest cpm bid\r\n * object for the given adUnit\r\n * @param {string} adUnitCode - optional ad unit code\r\n * @alias module:pbjs.getHighestCpmBids\r\n * @return {Array} array containing highest cpm bid object(s)\r\n */\r\n$$PREBID_GLOBAL$$.getHighestCpmBids = function (adUnitCode) {\r\n  return targeting.getWinningBids(adUnitCode);\r\n};\r\n\r\n/**\r\n * Mark the winning bid as used, should only be used in conjunction with video\r\n * @typedef {Object} MarkBidRequest\r\n * @property {string} adUnitCode The ad unit code\r\n * @property {string} adId The id representing the ad we want to mark\r\n *\r\n * @alias module:pbjs.markWinningBidAsUsed\r\n */\r\n$$PREBID_GLOBAL$$.markWinningBidAsUsed = function (markBidRequest) {\r\n  let bids = [];\r\n\r\n  if (markBidRequest.adUnitCode && markBidRequest.adId) {\r\n    bids = auctionManager.getBidsReceived()\r\n      .filter(bid => bid.adId === markBidRequest.adId && bid.adUnitCode === markBidRequest.adUnitCode);\r\n  } else if (markBidRequest.adUnitCode) {\r\n    bids = targeting.getWinningBids(markBidRequest.adUnitCode);\r\n  } else if (markBidRequest.adId) {\r\n    bids = auctionManager.getBidsReceived().filter(bid => bid.adId === markBidRequest.adId);\r\n  } else {\r\n    logWarn('Improper use of markWinningBidAsUsed. It needs an adUnitCode or an adId to function.');\r\n  }\r\n\r\n  if (bids.length > 0) {\r\n    bids[0].status = CONSTANTS.BID_STATUS.RENDERED;\r\n  }\r\n};\r\n\r\n/**\r\n * Get Prebid config options\r\n * @param {Object} options\r\n * @alias module:pbjs.getConfig\r\n */\r\n$$PREBID_GLOBAL$$.getConfig = config.getAnyConfig;\r\n$$PREBID_GLOBAL$$.readConfig = config.readAnyConfig;\r\n$$PREBID_GLOBAL$$.mergeConfig = config.mergeConfig;\r\n$$PREBID_GLOBAL$$.mergeBidderConfig = config.mergeBidderConfig;\r\n\r\n/**\r\n * Set Prebid config options.\r\n * See https://docs.prebid.org/dev-docs/publisher-api-reference/setConfig.html\r\n *\r\n * @param {Object} options Global Prebid configuration object. Must be JSON - no JavaScript functions are allowed.\r\n */\r\n$$PREBID_GLOBAL$$.setConfig = config.setConfig;\r\n$$PREBID_GLOBAL$$.setBidderConfig = config.setBidderConfig;\r\n\r\n$$PREBID_GLOBAL$$.que.push(() => listenMessagesFromCreative());\r\n\r\n/**\r\n * This queue lets users load Prebid asynchronously, but run functions the same way regardless of whether it gets loaded\r\n * before or after their script executes. For example, given the code:\r\n *\r\n * <script src=\"url/to/Prebid.js\" async></script>\r\n * <script>\r\n *   var pbjs = pbjs || {};\r\n *   pbjs.cmd = pbjs.cmd || [];\r\n *   pbjs.cmd.push(functionToExecuteOncePrebidLoads);\r\n * </script>\r\n *\r\n * If the page's script runs before prebid loads, then their function gets added to the queue, and executed\r\n * by prebid once it's done loading. If it runs after prebid loads, then this monkey-patch causes their\r\n * function to execute immediately.\r\n *\r\n * @memberof pbjs\r\n * @param  {function} command A function which takes no arguments. This is guaranteed to run exactly once, and only after\r\n *                            the Prebid script has been fully loaded.\r\n * @alias module:pbjs.cmd.push\r\n */\r\n$$PREBID_GLOBAL$$.cmd.push = function (command) {\r\n  if (typeof command === 'function') {\r\n    try {\r\n      command.call();\r\n    } catch (e) {\r\n      logError('Error processing command :', e.message, e.stack);\r\n    }\r\n  } else {\r\n    logError('Commands written into $$PREBID_GLOBAL$$.cmd.push must be wrapped in a function');\r\n  }\r\n};\r\n\r\n$$PREBID_GLOBAL$$.que.push = $$PREBID_GLOBAL$$.cmd.push;\r\n\r\nfunction processQueue(queue) {\r\n  queue.forEach(function (cmd) {\r\n    if (typeof cmd.called === 'undefined') {\r\n      try {\r\n        cmd.call();\r\n        cmd.called = true;\r\n      } catch (e) {\r\n        logError('Error processing command :', 'prebid.js', e);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * @alias module:pbjs.processQueue\r\n */\r\n$$PREBID_GLOBAL$$.processQueue = function () {\r\n  hook.ready();\r\n  processQueue($$PREBID_GLOBAL$$.que);\r\n  processQueue($$PREBID_GLOBAL$$.cmd);\r\n};\r\n\r\nexport default $$PREBID_GLOBAL$$;\r\n","// if $$PREBID_GLOBAL$$ already exists in global document scope, use it, if not, create the object\r\n// global defination should happen BEFORE imports to avoid global undefined errors.\r\nwindow.$$PREBID_GLOBAL$$ = (window.$$PREBID_GLOBAL$$ || {});\r\nwindow.$$PREBID_GLOBAL$$.cmd = window.$$PREBID_GLOBAL$$.cmd || [];\r\nwindow.$$PREBID_GLOBAL$$.que = window.$$PREBID_GLOBAL$$.que || [];\r\n\r\n// create a pbjs global pointer\r\nwindow._pbjsGlobals = window._pbjsGlobals || [];\r\nwindow._pbjsGlobals.push('$$PREBID_GLOBAL$$');\r\n\r\nexport function getGlobal() {\r\n  return window.$$PREBID_GLOBAL$$;\r\n}\r\n","/**\r\n * The referer detection module attempts to gather referer information from the current page that prebid.js resides in.\r\n * The information that it tries to collect includes:\r\n * The detected top url in the nav bar,\r\n * Whether it was able to reach the top most window (if for example it was embedded in several iframes),\r\n * The number of iframes it was embedded in if applicable (by default max ten iframes),\r\n * A list of the domains of each embedded window if applicable.\r\n * Canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\r\n */\r\n\r\nimport { config } from './config.js';\r\nimport {logWarn} from './utils.js';\r\n\r\n/**\r\n * Prepend a URL with the page's protocol (http/https), if necessary.\r\n */\r\nexport function ensureProtocol(url, win = window) {\r\n  if (!url) return url;\r\n  if (/\\w+:\\/\\//.exec(url)) {\r\n    // url already has protocol\r\n    return url;\r\n  }\r\n  let windowProto = win.location.protocol;\r\n  try {\r\n    windowProto = win.top.location.protocol;\r\n  } catch (e) {}\r\n  if (/^\\/\\//.exec(url)) {\r\n    // url uses relative protocol (\"//example.com\")\r\n    return windowProto + url;\r\n  } else {\r\n    return `${windowProto}//${url}`;\r\n  }\r\n}\r\n\r\n/**\r\n * Extract the domain portion from a URL.\r\n * @param url\r\n * @param noLeadingWww: if true, remove 'www.' appearing at the beginning of the domain.\r\n * @param noPort: if true, do not include the ':[port]' portion\r\n */\r\nexport function parseDomain(url, {noLeadingWww = false, noPort = false} = {}) {\r\n  try {\r\n    url = new URL(ensureProtocol(url));\r\n  } catch (e) {\r\n    return;\r\n  }\r\n  url = noPort ? url.hostname : url.host;\r\n  if (noLeadingWww && url.startsWith('www.')) {\r\n    url = url.substring(4);\r\n  }\r\n  return url;\r\n}\r\n\r\n/**\r\n * @param {Window} win Window\r\n * @returns {Function}\r\n */\r\nexport function detectReferer(win) {\r\n  /**\r\n   * This function would return a read-only array of hostnames for all the parent frames.\r\n   * win.location.ancestorOrigins is only supported in webkit browsers. For non-webkit browsers it will return undefined.\r\n   *\r\n   * @param {Window} win Window object\r\n   * @returns {(undefined|Array)} Ancestor origins or undefined\r\n   */\r\n  function getAncestorOrigins(win) {\r\n    try {\r\n      if (!win.location.ancestorOrigins) {\r\n        return;\r\n      }\r\n\r\n      return win.location.ancestorOrigins;\r\n    } catch (e) {\r\n      // Ignore error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This function returns canonical URL which refers to an HTML link element, with the attribute of rel=\"canonical\", found in the <head> element of your webpage\r\n   *\r\n   * @param {Object} doc document\r\n   * @returns {string|null}\r\n   */\r\n  function getCanonicalUrl(doc) {\r\n    try {\r\n      const element = doc.querySelector(\"link[rel='canonical']\");\r\n\r\n      if (element !== null) {\r\n        return element.href;\r\n      }\r\n    } catch (e) {\r\n      // Ignore error\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // TODO: the meaning of \"reachedTop\" seems to be intentionally ambiguous - best to leave them out of\r\n  // the typedef for now. (for example, unit tests enforce that \"reachedTop\" should be false in some situations where we\r\n  // happily provide a location for the top).\r\n\r\n  /**\r\n   * @typedef {Object} refererInfo\r\n   * @property {string|null} location the browser's location, or null if not available (due to cross-origin restrictions)\r\n   * @property {string|null} canonicalUrl the site's canonical URL as set by the publisher, through setConfig({pageUrl}) or <link rel=\"canonical\" />\r\n   * @property {string|null} page the best candidate for the current page URL: `canonicalUrl`, falling back to `location`\r\n   * @property {string|null} domain the domain portion of `page`\r\n   * @property {string|null} ref the referrer (document.referrer) to the current page, or null if not available (due to cross-origin restrictions)\r\n   * @property {string} topmostLocation of the top-most frame for which we could guess the location. Outside of cross-origin scenarios, this is equivalent to `location`.\r\n   * @property {number} numIframes number of steps between window.self and window.top\r\n   * @property {Array[string|null]} stack our best guess at the location for each frame, in the direction top -> self.\r\n   */\r\n\r\n  /**\r\n   * Walk up the windows to get the origin stack and best available referrer, canonical URL, etc.\r\n   *\r\n   * @returns {refererInfo}\r\n   */\r\n  function refererInfo() {\r\n    const stack = [];\r\n    const ancestors = getAncestorOrigins(win);\r\n    const maxNestedIframes = config.getConfig('maxNestedIframes');\r\n    let currentWindow;\r\n    let bestLocation;\r\n    let bestCanonicalUrl;\r\n    let reachedTop = false;\r\n    let level = 0;\r\n    let valuesFromAmp = false;\r\n    let inAmpFrame = false;\r\n    let hasTopLocation = false;\r\n\r\n    do {\r\n      const previousWindow = currentWindow;\r\n      const wasInAmpFrame = inAmpFrame;\r\n      let currentLocation;\r\n      let crossOrigin = false;\r\n      let foundLocation = null;\r\n\r\n      inAmpFrame = false;\r\n      currentWindow = currentWindow ? currentWindow.parent : win;\r\n\r\n      try {\r\n        currentLocation = currentWindow.location.href || null;\r\n      } catch (e) {\r\n        crossOrigin = true;\r\n      }\r\n\r\n      if (crossOrigin) {\r\n        if (wasInAmpFrame) {\r\n          const context = previousWindow.context;\r\n\r\n          try {\r\n            foundLocation = context.sourceUrl;\r\n            bestLocation = foundLocation;\r\n            hasTopLocation = true;\r\n\r\n            valuesFromAmp = true;\r\n\r\n            if (currentWindow === win.top) {\r\n              reachedTop = true;\r\n            }\r\n\r\n            if (context.canonicalUrl) {\r\n              bestCanonicalUrl = context.canonicalUrl;\r\n            }\r\n          } catch (e) { /* Do nothing */ }\r\n        } else {\r\n          logWarn('Trying to access cross domain iframe. Continuing without referrer and location');\r\n\r\n          try {\r\n            // the referrer to an iframe is the parent window\r\n            const referrer = previousWindow.document.referrer;\r\n\r\n            if (referrer) {\r\n              foundLocation = referrer;\r\n\r\n              if (currentWindow === win.top) {\r\n                reachedTop = true;\r\n              }\r\n            }\r\n          } catch (e) { /* Do nothing */ }\r\n\r\n          if (!foundLocation && ancestors && ancestors[level - 1]) {\r\n            foundLocation = ancestors[level - 1];\r\n            if (currentWindow === win.top) {\r\n              hasTopLocation = true;\r\n            }\r\n          }\r\n\r\n          if (foundLocation && !valuesFromAmp) {\r\n            bestLocation = foundLocation;\r\n          }\r\n        }\r\n      } else {\r\n        if (currentLocation) {\r\n          foundLocation = currentLocation;\r\n          bestLocation = foundLocation;\r\n          valuesFromAmp = false;\r\n\r\n          if (currentWindow === win.top) {\r\n            reachedTop = true;\r\n\r\n            const canonicalUrl = getCanonicalUrl(currentWindow.document);\r\n\r\n            if (canonicalUrl) {\r\n              bestCanonicalUrl = canonicalUrl;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (currentWindow.context && currentWindow.context.sourceUrl) {\r\n          inAmpFrame = true;\r\n        }\r\n      }\r\n\r\n      stack.push(foundLocation);\r\n      level++;\r\n    } while (currentWindow !== win.top && level < maxNestedIframes);\r\n\r\n    stack.reverse();\r\n\r\n    let ref;\r\n    try {\r\n      ref = win.top.document.referrer;\r\n    } catch (e) {}\r\n\r\n    const location = reachedTop || hasTopLocation ? bestLocation : null;\r\n    const canonicalUrl = config.getConfig('pageUrl') || bestCanonicalUrl || null;\r\n    const page = ensureProtocol(canonicalUrl, win) || location;\r\n\r\n    return {\r\n      reachedTop,\r\n      isAmp: valuesFromAmp,\r\n      numIframes: level - 1,\r\n      stack,\r\n      topmostLocation: bestLocation || null,\r\n      location,\r\n      canonicalUrl,\r\n      page,\r\n      domain: parseDomain(page) || null,\r\n      ref: ref || null,\r\n      // TODO: the \"legacy\" refererInfo object is provided here, for now, to accomodate\r\n      // adapters that decided to just send it verbatim to their backend.\r\n      legacy: {\r\n        reachedTop,\r\n        isAmp: valuesFromAmp,\r\n        numIframes: level - 1,\r\n        stack,\r\n        referer: bestLocation || null,\r\n        canonicalUrl\r\n      }\r\n    };\r\n  }\r\n\r\n  return refererInfo;\r\n}\r\n\r\n/**\r\n * @type {function(): refererInfo}\r\n */\r\nexport const getRefererInfo = detectReferer(window);\r\n","/* Secure Creatives\r\n  Provides support for rendering creatives into cross domain iframes such as SafeFrame to prevent\r\n   access to a publisher page from creative payloads.\r\n */\r\n\r\nimport * as events from './events.js';\r\nimport {fireNativeTrackers, getAllAssetsMessage, getAssetMessage} from './native.js';\r\nimport constants from './constants.json';\r\nimport {deepAccess, isApnGetTagDefined, isGptPubadsDefined, logError, logWarn, replaceAuctionPrice} from './utils.js';\r\nimport {auctionManager} from './auctionManager.js';\r\nimport {find, includes} from './polyfill.js';\r\nimport {executeRenderer, isRendererRequired} from './Renderer.js';\r\nimport {config} from './config.js';\r\nimport {emitAdRenderFail, emitAdRenderSucceeded} from './adRendering.js';\r\n\r\nconst BID_WON = constants.EVENTS.BID_WON;\r\nconst STALE_RENDER = constants.EVENTS.STALE_RENDER;\r\nconst WON_AD_IDS = new WeakSet();\r\n\r\nconst HANDLER_MAP = {\r\n  'Prebid Request': handleRenderRequest,\r\n  'Prebid Event': handleEventRequest,\r\n}\r\n\r\nif (FEATURES.NATIVE) {\r\n  Object.assign(HANDLER_MAP, {\r\n    'Prebid Native': handleNativeRequest,\r\n  })\r\n}\r\n\r\nexport function listenMessagesFromCreative() {\r\n  window.addEventListener('message', receiveMessage, false);\r\n}\r\n\r\nexport function getReplier(ev) {\r\n  if (ev.origin == null && ev.ports.length === 0) {\r\n    return function () {\r\n      const msg = 'Cannot post message to a frame with null origin. Please update creatives to use MessageChannel, see https://github.com/prebid/Prebid.js/issues/7870'\r\n      logError(msg)\r\n      throw new Error(msg);\r\n    }\r\n  } else if (ev.ports.length > 0) {\r\n    return function (message) {\r\n      ev.ports[0].postMessage(JSON.stringify(message));\r\n    }\r\n  } else {\r\n    return function (message) {\r\n      ev.source.postMessage(JSON.stringify(message), ev.origin);\r\n    }\r\n  }\r\n}\r\n\r\nexport function receiveMessage(ev) {\r\n  var key = ev.message ? 'message' : 'data';\r\n  var data = {};\r\n  try {\r\n    data = JSON.parse(ev[key]);\r\n  } catch (e) {\r\n    return;\r\n  }\r\n\r\n  if (data && data.adId && data.message) {\r\n    const adObject = find(auctionManager.getBidsReceived(), function (bid) {\r\n      return bid.adId === data.adId;\r\n    });\r\n    if (HANDLER_MAP.hasOwnProperty(data.message)) {\r\n      HANDLER_MAP[data.message](getReplier(ev), data, adObject);\r\n    }\r\n  }\r\n}\r\n\r\nfunction handleRenderRequest(reply, data, adObject) {\r\n  if (adObject == null) {\r\n    emitAdRenderFail({\r\n      reason: constants.AD_RENDER_FAILED_REASON.CANNOT_FIND_AD,\r\n      message: `Cannot find ad '${data.adId}' for cross-origin render request`,\r\n      id: data.adId\r\n    });\r\n    return;\r\n  }\r\n  if (adObject.status === constants.BID_STATUS.RENDERED) {\r\n    logWarn(`Ad id ${adObject.adId} has been rendered before`);\r\n    events.emit(STALE_RENDER, adObject);\r\n    if (deepAccess(config.getConfig('auctionOptions'), 'suppressStaleRender')) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  try {\r\n    _sendAdToCreative(adObject, reply);\r\n  } catch (e) {\r\n    emitAdRenderFail({\r\n      reason: constants.AD_RENDER_FAILED_REASON.EXCEPTION,\r\n      message: e.message,\r\n      id: data.adId,\r\n      bid: adObject\r\n    });\r\n    return;\r\n  }\r\n\r\n  // save winning bids\r\n  auctionManager.addWinningBid(adObject);\r\n\r\n  events.emit(BID_WON, adObject);\r\n}\r\n\r\nfunction handleNativeRequest(reply, data, adObject) {\r\n  // handle this script from native template in an ad server\r\n  // window.parent.postMessage(JSON.stringify({\r\n  //   message: 'Prebid Native',\r\n  //   adId: '%%PATTERN:hb_adid%%'\r\n  // }), '*');\r\n  if (adObject == null) {\r\n    logError(`Cannot find ad '${data.adId}' for x-origin event request`);\r\n    return;\r\n  }\r\n\r\n  if (!WON_AD_IDS.has(adObject)) {\r\n    WON_AD_IDS.add(adObject);\r\n    auctionManager.addWinningBid(adObject);\r\n    events.emit(BID_WON, adObject);\r\n  }\r\n\r\n  switch (data.action) {\r\n    case 'assetRequest':\r\n      reply(getAssetMessage(data, adObject));\r\n      break;\r\n    case 'allAssetRequest':\r\n      reply(getAllAssetsMessage(data, adObject));\r\n      break;\r\n    case 'resizeNativeHeight':\r\n      adObject.height = data.height;\r\n      adObject.width = data.width;\r\n      resizeRemoteCreative(adObject);\r\n      break;\r\n    default:\r\n      fireNativeTrackers(data, adObject);\r\n  }\r\n}\r\n\r\nfunction handleEventRequest(reply, data, adObject) {\r\n  if (adObject == null) {\r\n    logError(`Cannot find ad '${data.adId}' for x-origin event request`);\r\n    return;\r\n  }\r\n  if (adObject.status !== constants.BID_STATUS.RENDERED) {\r\n    logWarn(`Received x-origin event request without corresponding render request for ad '${data.adId}'`);\r\n    return;\r\n  }\r\n  switch (data.event) {\r\n    case constants.EVENTS.AD_RENDER_FAILED:\r\n      emitAdRenderFail({\r\n        bid: adObject,\r\n        id: data.adId,\r\n        reason: data.info.reason,\r\n        message: data.info.message\r\n      });\r\n      break;\r\n    case constants.EVENTS.AD_RENDER_SUCCEEDED:\r\n      emitAdRenderSucceeded({\r\n        doc: null,\r\n        bid: adObject,\r\n        id: data.adId\r\n      });\r\n      break;\r\n    default:\r\n      logError(`Received x-origin event request for unsupported event: '${data.event}' (adId: '${data.adId}')`)\r\n  }\r\n}\r\n\r\nexport function _sendAdToCreative(adObject, reply) {\r\n  const { adId, ad, adUrl, width, height, renderer, cpm, originalCpm } = adObject;\r\n  // rendering for outstream safeframe\r\n  if (isRendererRequired(renderer)) {\r\n    executeRenderer(renderer, adObject);\r\n  } else if (adId) {\r\n    resizeRemoteCreative(adObject);\r\n    reply({\r\n      message: 'Prebid Response',\r\n      ad: replaceAuctionPrice(ad, originalCpm || cpm),\r\n      adUrl: replaceAuctionPrice(adUrl, originalCpm || cpm),\r\n      adId,\r\n      width,\r\n      height\r\n    });\r\n  }\r\n}\r\n\r\nfunction resizeRemoteCreative({ adId, adUnitCode, width, height }) {\r\n  // resize both container div + iframe\r\n  ['div', 'iframe'].forEach(elmType => {\r\n    // not select element that gets removed after dfp render\r\n    let element = getElementByAdUnit(elmType + ':not([style*=\"display: none\"])');\r\n    if (element) {\r\n      let elementStyle = element.style;\r\n      elementStyle.width = width ? width + 'px' : '100%';\r\n      elementStyle.height = height + 'px';\r\n    } else {\r\n      logWarn(`Unable to locate matching page element for adUnitCode ${adUnitCode}.  Can't resize it to ad's dimensions.  Please review setup.`);\r\n    }\r\n  });\r\n\r\n  function getElementByAdUnit(elmType) {\r\n    let id = getElementIdBasedOnAdServer(adId, adUnitCode);\r\n    let parentDivEle = document.getElementById(id);\r\n    return parentDivEle && parentDivEle.querySelector(elmType);\r\n  }\r\n\r\n  function getElementIdBasedOnAdServer(adId, adUnitCode) {\r\n    if (isGptPubadsDefined()) {\r\n      return getDfpElementId(adId)\r\n    } else if (isApnGetTagDefined()) {\r\n      return getAstElementId(adUnitCode)\r\n    } else {\r\n      return adUnitCode;\r\n    }\r\n  }\r\n\r\n  function getDfpElementId(adId) {\r\n    const slot = find(window.googletag.pubads().getSlots(), slot => {\r\n      return find(slot.getTargetingKeys(), key => {\r\n        return includes(slot.getTargeting(key), adId);\r\n      });\r\n    });\r\n    return slot ? slot.getSlotElementId() : null;\r\n  }\r\n\r\n  function getAstElementId(adUnitCode) {\r\n    let astTag = window.apntag.getTag(adUnitCode);\r\n    return astTag && astTag.targetId;\r\n  }\r\n}\r\n","import { config } from './config.js';\r\nimport {logWarn, logInfo, isPlainObject, deepAccess, deepClone, getWindowTop} from './utils.js';\r\nimport {includes} from './polyfill.js';\r\nimport {BANNER} from './mediaTypes.js';\r\n\r\nlet sizeConfig = [];\r\n\r\n/**\r\n * @typedef {object} SizeConfig\r\n *\r\n * @property {string} [mediaQuery] A CSS media query string that will to be interpreted by window.matchMedia.  If the\r\n *  media query matches then the this config will be active and sizesSupported will filter bid and adUnit sizes.  If\r\n *  this property is not present then this SizeConfig will only be active if triggered manually by a call to\r\n *  pbjs.setConfig({labels:['label']) specifying one of the labels present on this SizeConfig.\r\n * @property {Array<Array>} sizesSupported The sizes to be accepted if this SizeConfig is enabled.\r\n * @property {Array<string>} labels The active labels to match this SizeConfig to an adUnits and/or bidders.\r\n */\r\n\r\n/**\r\n *\r\n * @param {Array<SizeConfig>} config\r\n */\r\nexport function setSizeConfig(config) {\r\n  sizeConfig = config;\r\n}\r\nconfig.getConfig('sizeConfig', config => setSizeConfig(config.sizeConfig));\r\n\r\n/**\r\n * Returns object describing the status of labels on the adUnit or bidder along with labels passed into requestBids\r\n * @param bidOrAdUnit the bidder or adUnit to get label info on\r\n * @param activeLabels the labels passed to requestBids\r\n * @returns {LabelDescriptor}\r\n */\r\nexport function getLabels(bidOrAdUnit, activeLabels) {\r\n  if (bidOrAdUnit.labelAll) {\r\n    return {labelAll: true, labels: bidOrAdUnit.labelAll, activeLabels};\r\n  }\r\n  return {labelAll: false, labels: bidOrAdUnit.labelAny, activeLabels};\r\n}\r\n\r\n/**\r\n * Determines whether a single size is valid given configured sizes\r\n * @param {Array} size [width, height]\r\n * @param {Array<SizeConfig>} configs\r\n * @returns {boolean}\r\n */\r\nexport function sizeSupported(size, configs = sizeConfig) {\r\n  let maps = evaluateSizeConfig(configs);\r\n  if (!maps.shouldFilter) {\r\n    return true;\r\n  }\r\n  return !!maps.sizesSupported[size];\r\n}\r\n\r\n/**\r\n * Resolves the unique set of the union of all sizes and labels that are active from a SizeConfig.mediaQuery match\r\n * @param {Array<string>} labels Labels specified on adUnit or bidder\r\n * @param {boolean} labelAll if true, all labels must match to be enabled\r\n * @param {Array<string>} activeLabels Labels passed in through requestBids\r\n * @param {object} mediaTypes A mediaTypes object describing the various media types (banner, video, native)\r\n * @param {Array<Array<number>>} sizes Sizes specified on adUnit (deprecated)\r\n * @param {Array<SizeConfig>} configs\r\n * @returns {{labels: Array<string>, sizes: Array<Array<number>>}}\r\n */\r\nexport function resolveStatus({labels = [], labelAll = false, activeLabels = []} = {}, mediaTypes, sizes, configs = sizeConfig) {\r\n  let maps = evaluateSizeConfig(configs);\r\n\r\n  if (!isPlainObject(mediaTypes)) {\r\n    // add support for deprecated adUnit.sizes by creating correct banner mediaTypes if they don't already exist\r\n    if (sizes) {\r\n      mediaTypes = {\r\n        banner: {\r\n          sizes\r\n        }\r\n      };\r\n    } else {\r\n      mediaTypes = {};\r\n    }\r\n  }\r\n\r\n  let oldSizes = deepAccess(mediaTypes, 'banner.sizes');\r\n  if (maps.shouldFilter && oldSizes) {\r\n    mediaTypes = deepClone(mediaTypes);\r\n    mediaTypes.banner.sizes = oldSizes.filter(size => maps.sizesSupported[size]);\r\n  }\r\n\r\n  let results = {\r\n    active: (\r\n      !mediaTypes.hasOwnProperty(BANNER)\r\n    ) || (\r\n      deepAccess(mediaTypes, 'banner.sizes.length') > 0 && (\r\n        labels.length === 0 || (\r\n          (!labelAll && (\r\n            labels.some(label => maps.labels[label]) ||\r\n            labels.some(label => includes(activeLabels, label))\r\n          )) ||\r\n          (labelAll && (\r\n            labels.reduce((result, label) => !result ? result : (\r\n              maps.labels[label] || includes(activeLabels, label)\r\n            ), true)\r\n          ))\r\n        )\r\n      )\r\n    ),\r\n    mediaTypes\r\n  };\r\n\r\n  if (oldSizes && oldSizes.length !== mediaTypes.banner.sizes.length) {\r\n    results.filterResults = {\r\n      before: oldSizes,\r\n      after: mediaTypes.banner.sizes\r\n    };\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\nfunction evaluateSizeConfig(configs) {\r\n  return configs.reduce((results, config) => {\r\n    if (\r\n      typeof config === 'object' &&\r\n      typeof config.mediaQuery === 'string' &&\r\n      config.mediaQuery.length > 0\r\n    ) {\r\n      let ruleMatch = false;\r\n\r\n      try {\r\n        ruleMatch = getWindowTop().matchMedia(config.mediaQuery).matches;\r\n      } catch (e) {\r\n        logWarn('Unfriendly iFrame blocks sizeConfig from being correctly evaluated');\r\n\r\n        ruleMatch = matchMedia(config.mediaQuery).matches;\r\n      }\r\n\r\n      if (ruleMatch) {\r\n        if (Array.isArray(config.sizesSupported)) {\r\n          results.shouldFilter = true;\r\n        }\r\n        ['labels', 'sizesSupported'].forEach(\r\n          type => (config[type] || []).forEach(\r\n            thing => results[type][thing] = true\r\n          )\r\n        );\r\n      }\r\n    } else {\r\n      logWarn('sizeConfig rule missing required property \"mediaQuery\"');\r\n    }\r\n    return results;\r\n  }, {\r\n    labels: {},\r\n    sizesSupported: {},\r\n    shouldFilter: false\r\n  });\r\n}\r\n\r\nexport function processAdUnitsForLabels(adUnits, activeLabels) {\r\n  return adUnits.reduce((adUnits, adUnit) => {\r\n    let {\r\n      active,\r\n      mediaTypes,\r\n      filterResults\r\n    } = resolveStatus(\r\n      getLabels(adUnit, activeLabels),\r\n      adUnit.mediaTypes,\r\n      adUnit.sizes\r\n    );\r\n\r\n    if (!active) {\r\n      logInfo(`Size mapping disabled adUnit \"${adUnit.code}\"`);\r\n    } else {\r\n      if (filterResults) {\r\n        logInfo(`Size mapping filtered adUnit \"${adUnit.code}\" banner sizes from `, filterResults.before, 'to ', filterResults.after);\r\n      }\r\n\r\n      adUnit.mediaTypes = mediaTypes;\r\n\r\n      adUnit.bids = adUnit.bids.reduce((bids, bid) => {\r\n        let {\r\n          active,\r\n          mediaTypes,\r\n          filterResults\r\n        } = resolveStatus(getLabels(bid, activeLabels), adUnit.mediaTypes);\r\n\r\n        if (!active) {\r\n          logInfo(`Size mapping deactivated adUnit \"${adUnit.code}\" bidder \"${bid.bidder}\"`);\r\n        } else {\r\n          if (filterResults) {\r\n            logInfo(`Size mapping filtered adUnit \"${adUnit.code}\" bidder \"${bid.bidder}\" banner sizes from `, filterResults.before, 'to ', filterResults.after);\r\n            bid.mediaTypes = mediaTypes;\r\n          }\r\n          bids.push(bid);\r\n        }\r\n        return bids;\r\n      }, []);\r\n      adUnits.push(adUnit);\r\n    }\r\n    return adUnits;\r\n  }, []);\r\n}\r\n","import {hook} from './hook.js';\r\nimport {hasDeviceAccess, checkCookieSupport, logError, logInfo, isPlainObject} from './utils.js';\r\nimport {bidderSettings as defaultBidderSettings} from './bidderSettings.js';\r\n\r\nconst moduleTypeWhiteList = ['core', 'prebid-module'];\r\n\r\nexport let storageCallbacks = [];\r\n\r\n/**\r\n * Storage options\r\n * @typedef {Object} storageOptions\r\n * @property {Number=} gvlid - Vendor id\r\n * @property {string} moduleName? - Module name\r\n * @property {string=} bidderCode? - Bidder code\r\n * @property {string=} moduleType - Module type, value can be anyone of core or prebid-module\r\n */\r\n\r\n/**\r\n * Returns list of storage related functions with gvlid, module name and module type in its scope.\r\n * All three argument are optional here. Below shows the usage of of these\r\n * - GVL Id: Pass GVL id if you are a vendor\r\n * - Bidder code: All bid adapters need to pass bidderCode\r\n * - Module name: All other modules need to pass module name\r\n * - Module type: Some modules may need these functions but are not vendor. e.g prebid core files in src and modules like currency.\r\n * @param {storageOptions} options\r\n */\r\nexport function newStorageManager({gvlid, moduleName, bidderCode, moduleType} = {}, {bidderSettings = defaultBidderSettings} = {}) {\r\n  function isBidderAllowed() {\r\n    if (bidderCode == null) {\r\n      return true;\r\n    }\r\n    const storageAllowed = bidderSettings.get(bidderCode, 'storageAllowed');\r\n    return storageAllowed == null ? false : storageAllowed;\r\n  }\r\n\r\n  const isVendorless = moduleTypeWhiteList.includes(moduleType);\r\n\r\n  function isValid(cb) {\r\n    if (!isBidderAllowed()) {\r\n      logInfo(`bidderSettings denied access to device storage for bidder '${bidderCode}'`);\r\n      const result = {valid: false};\r\n      return cb(result);\r\n    } else {\r\n      let value;\r\n      let hookDetails = {\r\n        hasEnforcementHook: false\r\n      }\r\n      validateStorageEnforcement(isVendorless, gvlid, bidderCode || moduleName, hookDetails, function(result) {\r\n        if (result && result.hasEnforcementHook) {\r\n          value = cb(result);\r\n        } else {\r\n          let result = {\r\n            hasEnforcementHook: false,\r\n            valid: hasDeviceAccess()\r\n          }\r\n          value = cb(result);\r\n        }\r\n      });\r\n      return value;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   * @param {string} value\r\n   * @param {string} [expires='']\r\n   * @param {string} [sameSite='/']\r\n   * @param {string} [domain] domain (e.g., 'example.com' or 'subdomain.example.com').\r\n   * If not specified, defaults to the host portion of the current document location.\r\n   * If a domain is specified, subdomains are always included.\r\n   * Domain must match the domain of the JavaScript origin. Setting cookies to foreign domains will be silently ignored.\r\n   */\r\n  const setCookie = function (key, value, expires, sameSite, domain, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        const domainPortion = (domain && domain !== '') ? ` ;domain=${encodeURIComponent(domain)}` : '';\r\n        const expiresPortion = (expires && expires !== '') ? ` ;expires=${expires}` : '';\r\n        const isNone = (sameSite != null && sameSite.toLowerCase() == 'none')\r\n        const secure = (isNone) ? '; Secure' : '';\r\n        document.cookie = `${key}=${encodeURIComponent(value)}${expiresPortion}; path=/${domainPortion}${sameSite ? `; SameSite=${sameSite}` : ''}${secure}`;\r\n      }\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @param {string} name\r\n   * @returns {(string|null)}\r\n   */\r\n  const getCookie = function(name, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        let m = window.document.cookie.match('(^|;)\\\\s*' + name + '\\\\s*=\\\\s*([^;]*)\\\\s*(;|$)');\r\n        return m ? decodeURIComponent(m[2]) : null;\r\n      }\r\n      return null;\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  const localStorageIsEnabled = function (done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        try {\r\n          localStorage.setItem('prebid.cookieTest', '1');\r\n          return localStorage.getItem('prebid.cookieTest') === '1';\r\n        } catch (error) {\r\n        } finally {\r\n          try {\r\n            localStorage.removeItem('prebid.cookieTest');\r\n          } catch (error) {}\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  const cookiesAreEnabled = function (done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        return checkCookieSupport();\r\n      }\r\n      return false;\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   * @param {string} value\r\n   */\r\n  const setDataInLocalStorage = function (key, value, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid && hasLocalStorage()) {\r\n        window.localStorage.setItem(key, value);\r\n      }\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   * @returns {(string|null)}\r\n   */\r\n  const getDataFromLocalStorage = function (key, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid && hasLocalStorage()) {\r\n        return window.localStorage.getItem(key);\r\n      }\r\n      return null;\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {string} key\r\n   */\r\n  const removeDataFromLocalStorage = function (key, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid && hasLocalStorage()) {\r\n        window.localStorage.removeItem(key);\r\n      }\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @returns {boolean}\r\n   */\r\n  const hasLocalStorage = function (done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        try {\r\n          return !!window.localStorage;\r\n        } catch (e) {\r\n          logError('Local storage api disabled');\r\n        }\r\n      }\r\n      return false;\r\n    }\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns all cookie values from the jar whose names contain the `keyLike`\r\n   * Needs to exist in `utils.js` as it follows the StorageHandler interface defined in live-connect-js. If that module were to be removed, this function can go as well.\r\n   * @param {string} keyLike\r\n   * @return {[]}\r\n   */\r\n  const findSimilarCookies = function(keyLike, done) {\r\n    let cb = function (result) {\r\n      if (result && result.valid) {\r\n        const all = [];\r\n        if (hasDeviceAccess()) {\r\n          const cookies = document.cookie.split(';');\r\n          while (cookies.length) {\r\n            const cookie = cookies.pop();\r\n            let separatorIndex = cookie.indexOf('=');\r\n            separatorIndex = separatorIndex < 0 ? cookie.length : separatorIndex;\r\n            const cookieName = decodeURIComponent(cookie.slice(0, separatorIndex).replace(/^\\s+/, ''));\r\n            if (cookieName.indexOf(keyLike) >= 0) {\r\n              all.push(decodeURIComponent(cookie.slice(separatorIndex + 1)));\r\n            }\r\n          }\r\n        }\r\n        return all;\r\n      }\r\n    }\r\n\r\n    if (done && typeof done === 'function') {\r\n      storageCallbacks.push(function() {\r\n        let result = isValid(cb);\r\n        done(result);\r\n      });\r\n    } else {\r\n      return isValid(cb);\r\n    }\r\n  }\r\n\r\n  return {\r\n    setCookie,\r\n    getCookie,\r\n    localStorageIsEnabled,\r\n    cookiesAreEnabled,\r\n    setDataInLocalStorage,\r\n    getDataFromLocalStorage,\r\n    removeDataFromLocalStorage,\r\n    hasLocalStorage,\r\n    findSimilarCookies\r\n  }\r\n}\r\n\r\n/**\r\n * This hook validates the storage enforcement if gdprEnforcement module is included\r\n */\r\nexport const validateStorageEnforcement = hook('async', function(isVendorless, gvlid, moduleName, hookDetails, callback) {\r\n  callback(hookDetails);\r\n}, 'validateStorageEnforcement');\r\n\r\n/**\r\n * This function returns storage functions to access cookies and localstorage. This function will bypass the gdpr enforcement requirement. Prebid as a software needs to use storage in some scenarios and is not a vendor so GDPR enforcement rules does not apply on Prebid.\r\n * @param {string} moduleName Module name\r\n */\r\nexport function getCoreStorageManager(moduleName) {\r\n  return newStorageManager({moduleName: moduleName, moduleType: 'core'});\r\n}\r\n\r\n/**\r\n * Note: Core modules or Prebid modules like Currency, SizeMapping should use getCoreStorageManager\r\n * This function returns storage functions to access cookies and localstorage. Bidders and User id modules should import this and use it in their module if needed.\r\n * Bid adapters should always provide `bidderCode`. GVL ID and Module name are optional param but gvl id is needed for when gdpr enforcement module is used.\r\n * @param {Number=} gvlid? Vendor id - required for proper GDPR integration\r\n * @param {string=} bidderCode? - required for bid adapters\r\n * @param {string=} moduleName? module name\r\n */\r\nexport function getStorageManager({gvlid, moduleName, bidderCode} = {}) {\r\n  if (arguments.length > 1 || (arguments.length > 0 && !isPlainObject(arguments[0]))) {\r\n    throw new Error('Invalid invocation for getStorageManager')\r\n  }\r\n  return newStorageManager({gvlid, moduleName, bidderCode});\r\n}\r\n\r\nexport function resetData() {\r\n  storageCallbacks = [];\r\n}\r\n","import {\r\n  uniques, isGptPubadsDefined, getHighestCpm, getOldestHighestCpmBid, groupBy, isAdUnitCodeMatchingSlot, timestamp,\r\n  deepAccess, deepClone, logError, logWarn, logInfo, isFn, isArray, logMessage, isStr,\r\n} from './utils.js';\r\nimport { config } from './config.js';\r\nimport { NATIVE_TARGETING_KEYS } from './native.js';\r\nimport { auctionManager } from './auctionManager.js';\r\nimport { sizeSupported } from './sizeMapping.js';\r\nimport { ADPOD } from './mediaTypes.js';\r\nimport { hook } from './hook.js';\r\nimport { bidderSettings } from './bidderSettings.js';\r\nimport {includes, find} from './polyfill.js';\r\nimport CONSTANTS from './constants.json';\r\n\r\nvar pbTargetingKeys = [];\r\n\r\nconst MAX_DFP_KEYLENGTH = 20;\r\nconst TTL_BUFFER = 1000;\r\n\r\nconst CFG_ALLOW_TARGETING_KEYS = `targetingControls.allowTargetingKeys`;\r\nconst CFG_ADD_TARGETING_KEYS = `targetingControls.addTargetingKeys`;\r\nconst TARGETING_KEY_CONFIGURATION_ERROR_MSG = `Only one of \"${CFG_ALLOW_TARGETING_KEYS}\" or \"${CFG_ADD_TARGETING_KEYS}\" can be set`;\r\n\r\nexport const TARGETING_KEYS = Object.keys(CONSTANTS.TARGETING_KEYS).map(\r\n  key => CONSTANTS.TARGETING_KEYS[key]\r\n);\r\n\r\n// return unexpired bids\r\nconst isBidNotExpired = (bid) => (bid.responseTimestamp + bid.ttl * 1000 - TTL_BUFFER) > timestamp();\r\n\r\n// return bids whose status is not set. Winning bids can only have a status of `rendered`.\r\nconst isUnusedBid = (bid) => bid && ((bid.status && !includes([CONSTANTS.BID_STATUS.RENDERED], bid.status)) || !bid.status);\r\n\r\nexport let filters = {\r\n  isBidNotExpired,\r\n  isUnusedBid\r\n};\r\n\r\n// If two bids are found for same adUnitCode, we will use the highest one to take part in auction\r\n// This can happen in case of concurrent auctions\r\n// If adUnitBidLimit is set above 0 return top N number of bids\r\nexport const getHighestCpmBidsFromBidPool = hook('sync', function(bidsReceived, highestCpmCallback, adUnitBidLimit = 0, hasModified = false) {\r\n  if (!hasModified) {\r\n    const bids = [];\r\n    const dealPrioritization = config.getConfig('sendBidsControl.dealPrioritization');\r\n    // bucket by adUnitcode\r\n    let buckets = groupBy(bidsReceived, 'adUnitCode');\r\n    // filter top bid for each bucket by bidder\r\n    Object.keys(buckets).forEach(bucketKey => {\r\n      let bucketBids = [];\r\n      let bidsByBidder = groupBy(buckets[bucketKey], 'bidderCode');\r\n      Object.keys(bidsByBidder).forEach(key => bucketBids.push(bidsByBidder[key].reduce(highestCpmCallback)));\r\n      // if adUnitBidLimit is set, pass top N number bids\r\n      if (adUnitBidLimit > 0) {\r\n        bucketBids = dealPrioritization ? bucketBids.sort(sortByDealAndPriceBucketOrCpm(true)) : bucketBids.sort((a, b) => b.cpm - a.cpm);\r\n        bids.push(...bucketBids.slice(0, adUnitBidLimit));\r\n      } else {\r\n        bids.push(...bucketBids);\r\n      }\r\n    });\r\n\r\n    return bids;\r\n  }\r\n\r\n  return bidsReceived;\r\n});\r\n\r\n/**\r\n* A descending sort function that will sort the list of objects based on the following two dimensions:\r\n*  - bids with a deal are sorted before bids w/o a deal\r\n*  - then sort bids in each grouping based on the hb_pb value\r\n* eg: the following list of bids would be sorted like:\r\n*  [{\r\n*    \"hb_adid\": \"vwx\",\r\n*    \"hb_pb\": \"28\",\r\n*    \"hb_deal\": \"7747\"\r\n*  }, {\r\n*    \"hb_adid\": \"jkl\",\r\n*    \"hb_pb\": \"10\",\r\n*    \"hb_deal\": \"9234\"\r\n*  }, {\r\n*    \"hb_adid\": \"stu\",\r\n*    \"hb_pb\": \"50\"\r\n*  }, {\r\n*    \"hb_adid\": \"def\",\r\n*    \"hb_pb\": \"2\"\r\n*  }]\r\n*/\r\nexport function sortByDealAndPriceBucketOrCpm(useCpm = false) {\r\n  return function(a, b) {\r\n    if (a.adserverTargeting.hb_deal !== undefined && b.adserverTargeting.hb_deal === undefined) {\r\n      return -1;\r\n    }\r\n\r\n    if ((a.adserverTargeting.hb_deal === undefined && b.adserverTargeting.hb_deal !== undefined)) {\r\n      return 1;\r\n    }\r\n\r\n    // assuming both values either have a deal or don't have a deal - sort by the hb_pb param\r\n    if (useCpm) {\r\n      return b.cpm - a.cpm;\r\n    }\r\n\r\n    return b.adserverTargeting.hb_pb - a.adserverTargeting.hb_pb;\r\n  }\r\n}\r\n\r\n/**\r\n * @typedef {Object.<string,string>} targeting\r\n * @property {string} targeting_key\r\n */\r\n\r\n/**\r\n * @typedef {Object.<string,Object.<string,string[]>[]>[]} targetingArray\r\n */\r\n\r\nexport function newTargeting(auctionManager) {\r\n  let targeting = {};\r\n  let latestAuctionForAdUnit = {};\r\n\r\n  targeting.setLatestAuctionForAdUnit = function(adUnitCode, auctionId) {\r\n    latestAuctionForAdUnit[adUnitCode] = auctionId;\r\n  };\r\n\r\n  targeting.resetPresetTargeting = function(adUnitCode, customSlotMatching) {\r\n    if (isGptPubadsDefined()) {\r\n      const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n      const adUnits = auctionManager.getAdUnits().filter(adUnit => includes(adUnitCodes, adUnit.code));\r\n      let unsetKeys = pbTargetingKeys.reduce((reducer, key) => {\r\n        reducer[key] = null;\r\n        return reducer;\r\n      }, {});\r\n      window.googletag.pubads().getSlots().forEach(slot => {\r\n        let customSlotMatchingFunc = isFn(customSlotMatching) && customSlotMatching(slot);\r\n        // reset only registered adunits\r\n        adUnits.forEach(unit => {\r\n          if (unit.code === slot.getAdUnitPath() ||\r\n              unit.code === slot.getSlotElementId() ||\r\n              (isFn(customSlotMatchingFunc) && customSlotMatchingFunc(unit.code))) {\r\n            slot.updateTargetingFromMap(unsetKeys);\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n\r\n  targeting.resetPresetTargetingAST = function(adUnitCode) {\r\n    const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n    adUnitCodes.forEach(function(unit) {\r\n      const astTag = window.apntag.getTag(unit);\r\n      if (astTag && astTag.keywords) {\r\n        const currentKeywords = Object.keys(astTag.keywords);\r\n        const newKeywords = {};\r\n        currentKeywords.forEach((key) => {\r\n          if (!includes(pbTargetingKeys, key.toLowerCase())) {\r\n            newKeywords[key] = astTag.keywords[key];\r\n          }\r\n        })\r\n        window.apntag.modifyTag(unit, { keywords: newKeywords })\r\n      }\r\n    });\r\n  };\r\n\r\n  /**\r\n   * checks if bid has targeting set and belongs based on matching ad unit codes\r\n   * @return {boolean} true or false\r\n   */\r\n  function bidShouldBeAddedToTargeting(bid, adUnitCodes) {\r\n    return bid.adserverTargeting && adUnitCodes &&\r\n      ((isArray(adUnitCodes) && includes(adUnitCodes, bid.adUnitCode)) ||\r\n      (typeof adUnitCodes === 'string' && bid.adUnitCode === adUnitCodes));\r\n  };\r\n\r\n  /**\r\n   * Returns targeting for any bids which have deals if alwaysIncludeDeals === true\r\n   */\r\n  function getDealBids(adUnitCodes, bidsReceived) {\r\n    if (config.getConfig('targetingControls.alwaysIncludeDeals') === true) {\r\n      const standardKeys = FEATURES.NATIVE ? TARGETING_KEYS.concat(NATIVE_TARGETING_KEYS) : TARGETING_KEYS.slice();\r\n\r\n      // we only want the top bid from bidders who have multiple entries per ad unit code\r\n      const bids = getHighestCpmBidsFromBidPool(bidsReceived, getHighestCpm);\r\n\r\n      // populate targeting keys for the remaining bids if they have a dealId\r\n      return bids.map(bid => {\r\n        if (bid.dealId && bidShouldBeAddedToTargeting(bid, adUnitCodes)) {\r\n          return {\r\n            [bid.adUnitCode]: getTargetingMap(bid, standardKeys.filter(\r\n              key => typeof bid.adserverTargeting[key] !== 'undefined')\r\n            )\r\n          };\r\n        }\r\n      }).filter(bid => bid); // removes empty elements in array\r\n    }\r\n    return [];\r\n  };\r\n\r\n  /**\r\n   * Returns filtered ad server targeting for custom and allowed keys.\r\n   * @param {targetingArray} targeting\r\n   * @param {string[]} allowedKeys\r\n   * @return {targetingArray} filtered targeting\r\n   */\r\n  function getAllowedTargetingKeyValues(targeting, allowedKeys) {\r\n    const defaultKeyring = Object.assign({}, CONSTANTS.TARGETING_KEYS, CONSTANTS.NATIVE_KEYS);\r\n    const defaultKeys = Object.keys(defaultKeyring);\r\n    const keyDispositions = {};\r\n    logInfo(`allowTargetingKeys - allowed keys [ ${allowedKeys.map(k => defaultKeyring[k]).join(', ')} ]`);\r\n    targeting.map(adUnit => {\r\n      const adUnitCode = Object.keys(adUnit)[0];\r\n      const keyring = adUnit[adUnitCode];\r\n      const keys = keyring.filter(kvPair => {\r\n        const key = Object.keys(kvPair)[0];\r\n        // check if key is in default keys, if not, it's custom, we won't remove it.\r\n        const isCustom = defaultKeys.filter(defaultKey => key.indexOf(defaultKeyring[defaultKey]) === 0).length === 0;\r\n        // check if key explicitly allowed, if not, we'll remove it.\r\n        const found = isCustom || find(allowedKeys, allowedKey => {\r\n          const allowedKeyName = defaultKeyring[allowedKey];\r\n          // we're looking to see if the key exactly starts with one of our default keys.\r\n          // (which hopefully means it's not custom)\r\n          const found = key.indexOf(allowedKeyName) === 0;\r\n          return found;\r\n        });\r\n        keyDispositions[key] = !found;\r\n        return found;\r\n      });\r\n      adUnit[adUnitCode] = keys;\r\n    });\r\n    const removedKeys = Object.keys(keyDispositions).filter(d => keyDispositions[d]);\r\n    logInfo(`allowTargetingKeys - removed keys [ ${removedKeys.join(', ')} ]`);\r\n    // remove any empty targeting objects, as they're unnecessary.\r\n    const filteredTargeting = targeting.filter(adUnit => {\r\n      const adUnitCode = Object.keys(adUnit)[0];\r\n      const keyring = adUnit[adUnitCode];\r\n      return keyring.length > 0;\r\n    });\r\n    return filteredTargeting\r\n  }\r\n\r\n  /**\r\n   * Returns all ad server targeting for all ad units.\r\n   * @param {string=} adUnitCode\r\n   * @return {Object.<string,targeting>} targeting\r\n   */\r\n  targeting.getAllTargeting = function(adUnitCode, bidsReceived = getBidsReceived()) {\r\n    const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n\r\n    // Get targeting for the winning bid. Add targeting for any bids that have\r\n    // `alwaysUseBid=true`. If sending all bids is enabled, add targeting for losing bids.\r\n    var targeting = getWinningBidTargeting(adUnitCodes, bidsReceived)\r\n      .concat(getCustomBidTargeting(adUnitCodes, bidsReceived))\r\n      .concat(config.getConfig('enableSendAllBids') ? getBidLandscapeTargeting(adUnitCodes, bidsReceived) : getDealBids(adUnitCodes, bidsReceived))\r\n      .concat(getAdUnitTargeting(adUnitCodes));\r\n\r\n    // store a reference of the targeting keys\r\n    targeting.map(adUnitCode => {\r\n      Object.keys(adUnitCode).map(key => {\r\n        adUnitCode[key].map(targetKey => {\r\n          if (pbTargetingKeys.indexOf(Object.keys(targetKey)[0]) === -1) {\r\n            pbTargetingKeys = Object.keys(targetKey).concat(pbTargetingKeys);\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    const defaultKeys = Object.keys(Object.assign({}, CONSTANTS.DEFAULT_TARGETING_KEYS, CONSTANTS.NATIVE_KEYS));\r\n    let allowedKeys = config.getConfig(CFG_ALLOW_TARGETING_KEYS);\r\n    const addedKeys = config.getConfig(CFG_ADD_TARGETING_KEYS);\r\n\r\n    if (addedKeys != null && allowedKeys != null) {\r\n      throw new Error(TARGETING_KEY_CONFIGURATION_ERROR_MSG);\r\n    } else if (addedKeys != null) {\r\n      allowedKeys = defaultKeys.concat(addedKeys);\r\n    } else {\r\n      allowedKeys = allowedKeys || defaultKeys;\r\n    }\r\n\r\n    if (Array.isArray(allowedKeys) && allowedKeys.length > 0) {\r\n      targeting = getAllowedTargetingKeyValues(targeting, allowedKeys);\r\n    }\r\n\r\n    targeting = flattenTargeting(targeting);\r\n\r\n    const auctionKeysThreshold = config.getConfig('targetingControls.auctionKeyMaxChars');\r\n    if (auctionKeysThreshold) {\r\n      logInfo(`Detected 'targetingControls.auctionKeyMaxChars' was active for this auction; set with a limit of ${auctionKeysThreshold} characters.  Running checks on auction keys...`);\r\n      targeting = filterTargetingKeys(targeting, auctionKeysThreshold);\r\n    }\r\n\r\n    // make sure at least there is a entry per adUnit code in the targetingSet so receivers of SET_TARGETING call's can know what ad units are being invoked\r\n    adUnitCodes.forEach(code => {\r\n      if (!targeting[code]) {\r\n        targeting[code] = {};\r\n      }\r\n    });\r\n\r\n    return targeting;\r\n  };\r\n\r\n  // warn about conflicting configuration\r\n  config.getConfig('targetingControls', function (config) {\r\n    if (deepAccess(config, CFG_ALLOW_TARGETING_KEYS) != null && deepAccess(config, CFG_ADD_TARGETING_KEYS) != null) {\r\n      logError(TARGETING_KEY_CONFIGURATION_ERROR_MSG);\r\n    }\r\n  });\r\n\r\n  // create an encoded string variant based on the keypairs of the provided object\r\n  //  - note this will encode the characters between the keys (ie = and &)\r\n  function convertKeysToQueryForm(keyMap) {\r\n    return Object.keys(keyMap).reduce(function (queryString, key) {\r\n      let encodedKeyPair = `${key}%3d${encodeURIComponent(keyMap[key])}%26`;\r\n      return queryString += encodedKeyPair;\r\n    }, '');\r\n  }\r\n\r\n  function filterTargetingKeys(targeting, auctionKeysThreshold) {\r\n    // read each targeting.adUnit object and sort the adUnits into a list of adUnitCodes based on priorization setting (eg CPM)\r\n    let targetingCopy = deepClone(targeting);\r\n\r\n    let targetingMap = Object.keys(targetingCopy).map(adUnitCode => {\r\n      return {\r\n        adUnitCode,\r\n        adserverTargeting: targetingCopy[adUnitCode]\r\n      };\r\n    }).sort(sortByDealAndPriceBucketOrCpm());\r\n\r\n    // iterate through the targeting based on above list and transform the keys into the query-equivalent and count characters\r\n    return targetingMap.reduce(function (accMap, currMap, index, arr) {\r\n      let adUnitQueryString = convertKeysToQueryForm(currMap.adserverTargeting);\r\n\r\n      // for the last adUnit - trim last encoded ampersand from the converted query string\r\n      if ((index + 1) === arr.length) {\r\n        adUnitQueryString = adUnitQueryString.slice(0, -3);\r\n      }\r\n\r\n      // if under running threshold add to result\r\n      let code = currMap.adUnitCode;\r\n      let querySize = adUnitQueryString.length;\r\n      if (querySize <= auctionKeysThreshold) {\r\n        auctionKeysThreshold -= querySize;\r\n        logInfo(`AdUnit '${code}' auction keys comprised of ${querySize} characters.  Deducted from running threshold; new limit is ${auctionKeysThreshold}`, targetingCopy[code]);\r\n\r\n        accMap[code] = targetingCopy[code];\r\n      } else {\r\n        logWarn(`The following keys for adUnitCode '${code}' exceeded the current limit of the 'auctionKeyMaxChars' setting.\\nThe key-set size was ${querySize}, the current allotted amount was ${auctionKeysThreshold}.\\n`, targetingCopy[code]);\r\n      }\r\n\r\n      if ((index + 1) === arr.length && Object.keys(accMap).length === 0) {\r\n        logError('No auction targeting keys were permitted due to the setting in setConfig(targetingControls.auctionKeyMaxChars).  Please review setup and consider adjusting.');\r\n      }\r\n      return accMap;\r\n    }, {});\r\n  }\r\n\r\n  /**\r\n   * Converts targeting array and flattens to make it easily iteratable\r\n   * e.g: Sample input to this function\r\n   * ```\r\n   * [\r\n   *    {\r\n   *      \"div-gpt-ad-1460505748561-0\": [{\"hb_bidder\": [\"appnexusAst\"]}]\r\n   *    },\r\n   *    {\r\n   *      \"div-gpt-ad-1460505748561-0\": [{\"hb_bidder_appnexusAs\": [\"appnexusAst\", \"other\"]}]\r\n   *    }\r\n   * ]\r\n   * ```\r\n   * Resulting array\r\n   * ```\r\n   * {\r\n   *  \"div-gpt-ad-1460505748561-0\": {\r\n   *    \"hb_bidder\": \"appnexusAst\",\r\n   *    \"hb_bidder_appnexusAs\": \"appnexusAst,other\"\r\n   *  }\r\n   * }\r\n   * ```\r\n   *\r\n   * @param {targetingArray}  targeting\r\n   * @return {Object.<string,targeting>}  targeting\r\n   */\r\n  function flattenTargeting(targeting) {\r\n    let targetingObj = targeting.map(targeting => {\r\n      return {\r\n        [Object.keys(targeting)[0]]: targeting[Object.keys(targeting)[0]]\r\n          .map(target => {\r\n            return {\r\n              [Object.keys(target)[0]]: target[Object.keys(target)[0]].join(',')\r\n            };\r\n          }).reduce((p, c) => Object.assign(c, p), {})\r\n      };\r\n    }).reduce(function (accumulator, targeting) {\r\n      var key = Object.keys(targeting)[0];\r\n      accumulator[key] = Object.assign({}, accumulator[key], targeting[key]);\r\n      return accumulator;\r\n    }, {});\r\n    return targetingObj;\r\n  }\r\n\r\n  /**\r\n   * Sets targeting for DFP\r\n   * @param {Object.<string,Object.<string,string>>} targetingConfig\r\n   */\r\n  targeting.setTargetingForGPT = function(targetingConfig, customSlotMatching) {\r\n    window.googletag.pubads().getSlots().forEach(slot => {\r\n      Object.keys(targetingConfig).filter(customSlotMatching ? customSlotMatching(slot) : isAdUnitCodeMatchingSlot(slot))\r\n        .forEach(targetId => {\r\n          Object.keys(targetingConfig[targetId]).forEach(key => {\r\n            let value = targetingConfig[targetId][key];\r\n            if (typeof value === 'string' && value.indexOf(',') !== -1) {\r\n              // due to the check the array will be formed only if string has ',' else plain string will be assigned as value\r\n              value = value.split(',');\r\n            }\r\n            targetingConfig[targetId][key] = value;\r\n          });\r\n          logMessage(`Attempting to set targeting-map for slot: ${slot.getSlotElementId()} with targeting-map:`, targetingConfig[targetId]);\r\n          slot.updateTargetingFromMap(targetingConfig[targetId])\r\n        })\r\n    })\r\n  };\r\n\r\n  /**\r\n   * normlizes input to a `adUnit.code` array\r\n   * @param  {(string|string[])} adUnitCode [description]\r\n   * @return {string[]}     AdUnit code array\r\n   */\r\n  function getAdUnitCodes(adUnitCode) {\r\n    if (typeof adUnitCode === 'string') {\r\n      return [adUnitCode];\r\n    } else if (isArray(adUnitCode)) {\r\n      return adUnitCode;\r\n    }\r\n    return auctionManager.getAdUnitCodes() || [];\r\n  }\r\n\r\n  function getBidsReceived() {\r\n    let bidsReceived = auctionManager.getBidsReceived();\r\n\r\n    if (!config.getConfig('useBidCache')) {\r\n      // don't use bid cache (i.e. filter out bids not in the latest auction)\r\n      bidsReceived = bidsReceived.filter(bid => latestAuctionForAdUnit[bid.adUnitCode] === bid.auctionId)\r\n    } else {\r\n      // if custom bid cache filter function exists, run for each bid from\r\n      // previous auctions. If it returns true, include bid in bid pool\r\n      const filterFunction = config.getConfig('bidCacheFilterFunction');\r\n      if (typeof filterFunction === 'function') {\r\n        bidsReceived = bidsReceived.filter(bid => latestAuctionForAdUnit[bid.adUnitCode] === bid.auctionId || !!filterFunction(bid))\r\n      }\r\n    }\r\n\r\n    bidsReceived = bidsReceived\r\n      .filter(bid => deepAccess(bid, 'video.context') !== ADPOD)\r\n      .filter(bid => bid.mediaType !== 'banner' || sizeSupported([bid.width, bid.height]))\r\n      .filter(filters.isUnusedBid)\r\n      .filter(filters.isBidNotExpired)\r\n    ;\r\n\r\n    return getHighestCpmBidsFromBidPool(bidsReceived, getOldestHighestCpmBid);\r\n  }\r\n\r\n  /**\r\n   * Returns top bids for a given adUnit or set of adUnits.\r\n   * @param  {(string|string[])} adUnitCode adUnitCode or array of adUnitCodes\r\n   * @return {[type]}            [description]\r\n   */\r\n  targeting.getWinningBids = function(adUnitCode, bidsReceived = getBidsReceived()) {\r\n    const adUnitCodes = getAdUnitCodes(adUnitCode);\r\n    return bidsReceived\r\n      .filter(bid => includes(adUnitCodes, bid.adUnitCode))\r\n      .filter(bid => (bidderSettings.get(bid.bidderCode, 'allowZeroCpmBids') === true) ? bid.cpm >= 0 : bid.cpm > 0)\r\n      .map(bid => bid.adUnitCode)\r\n      .filter(uniques)\r\n      .map(adUnitCode => bidsReceived\r\n        .filter(bid => bid.adUnitCode === adUnitCode ? bid : null)\r\n        .reduce(getHighestCpm));\r\n  };\r\n\r\n  /**\r\n   * @param  {(string|string[])} adUnitCode adUnitCode or array of adUnitCodes\r\n   * Sets targeting for AST\r\n   */\r\n  targeting.setTargetingForAst = function(adUnitCodes) {\r\n    let astTargeting = targeting.getAllTargeting(adUnitCodes);\r\n\r\n    try {\r\n      targeting.resetPresetTargetingAST(adUnitCodes);\r\n    } catch (e) {\r\n      logError('unable to reset targeting for AST' + e)\r\n    }\r\n\r\n    Object.keys(astTargeting).forEach(targetId =>\r\n      Object.keys(astTargeting[targetId]).forEach(key => {\r\n        logMessage(`Attempting to set targeting for targetId: ${targetId} key: ${key} value: ${astTargeting[targetId][key]}`);\r\n        // setKeywords supports string and array as value\r\n        if (isStr(astTargeting[targetId][key]) || isArray(astTargeting[targetId][key])) {\r\n          let keywordsObj = {};\r\n          let regex = /pt[0-9]/;\r\n          if (key.search(regex) < 0) {\r\n            keywordsObj[key.toUpperCase()] = astTargeting[targetId][key];\r\n          } else {\r\n            // pt${n} keys should not be uppercased\r\n            keywordsObj[key] = astTargeting[targetId][key];\r\n          }\r\n          window.apntag.setKeywords(targetId, keywordsObj, { overrideKeyValue: true });\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  /**\r\n   * Get targeting key value pairs for winning bid.\r\n   * @param {string[]}    AdUnit code array\r\n   * @return {targetingArray}   winning bids targeting\r\n   */\r\n  function getWinningBidTargeting(adUnitCodes, bidsReceived) {\r\n    let winners = targeting.getWinningBids(adUnitCodes, bidsReceived);\r\n    let standardKeys = getStandardKeys();\r\n\r\n    winners = winners.map(winner => {\r\n      return {\r\n        [winner.adUnitCode]: Object.keys(winner.adserverTargeting)\r\n          .filter(key =>\r\n            typeof winner.sendStandardTargeting === 'undefined' ||\r\n            winner.sendStandardTargeting ||\r\n            standardKeys.indexOf(key) === -1)\r\n          .reduce((acc, key) => {\r\n            const targetingValue = [winner.adserverTargeting[key]];\r\n            const targeting = { [key.substring(0, MAX_DFP_KEYLENGTH)]: targetingValue };\r\n            if (key === CONSTANTS.TARGETING_KEYS.DEAL) {\r\n              const bidderCodeTargetingKey = `${key}_${winner.bidderCode}`.substring(0, MAX_DFP_KEYLENGTH);\r\n              const bidderCodeTargeting = { [bidderCodeTargetingKey]: targetingValue };\r\n              return [...acc, targeting, bidderCodeTargeting];\r\n            }\r\n            return [...acc, targeting];\r\n          }, [])\r\n      };\r\n    });\r\n\r\n    return winners;\r\n  }\r\n\r\n  function getStandardKeys() {\r\n    return auctionManager.getStandardBidderAdServerTargeting() // in case using a custom standard key set\r\n      .map(targeting => targeting.key)\r\n      .concat(TARGETING_KEYS).filter(uniques); // standard keys defined in the library.\r\n  }\r\n\r\n  /**\r\n   * Merge custom adserverTargeting with same key name for same adUnitCode.\r\n   * e.g: Appnexus defining custom keyvalue pair foo:bar and Rubicon defining custom keyvalue pair foo:baz will be merged to foo: ['bar','baz']\r\n   *\r\n   * @param {Object[]} acc Accumulator for reducer. It will store updated bidResponse objects\r\n   * @param {Object} bid BidResponse\r\n   * @param {number} index current index\r\n   * @param {Array} arr original array\r\n   */\r\n  function mergeAdServerTargeting(acc, bid, index, arr) {\r\n    function concatTargetingValue(key) {\r\n      return function(currentBidElement) {\r\n        if (!isArray(currentBidElement.adserverTargeting[key])) {\r\n          currentBidElement.adserverTargeting[key] = [currentBidElement.adserverTargeting[key]];\r\n        }\r\n        currentBidElement.adserverTargeting[key] = currentBidElement.adserverTargeting[key].concat(bid.adserverTargeting[key]).filter(uniques);\r\n        delete bid.adserverTargeting[key];\r\n      }\r\n    }\r\n\r\n    function hasSameAdunitCodeAndKey(key) {\r\n      return function(currentBidElement) {\r\n        return currentBidElement.adUnitCode === bid.adUnitCode && currentBidElement.adserverTargeting[key]\r\n      }\r\n    }\r\n\r\n    Object.keys(bid.adserverTargeting)\r\n      .filter(getCustomKeys())\r\n      .forEach(key => {\r\n        if (acc.length) {\r\n          acc.filter(hasSameAdunitCodeAndKey(key))\r\n            .forEach(concatTargetingValue(key));\r\n        }\r\n      });\r\n    acc.push(bid);\r\n    return acc;\r\n  }\r\n\r\n  function getCustomKeys() {\r\n    let standardKeys = getStandardKeys();\r\n    if (FEATURES.NATIVE) {\r\n      standardKeys = standardKeys.concat(NATIVE_TARGETING_KEYS);\r\n    }\r\n    return function(key) {\r\n      return standardKeys.indexOf(key) === -1;\r\n    }\r\n  }\r\n\r\n  function truncateCustomKeys(bid) {\r\n    return {\r\n      [bid.adUnitCode]: Object.keys(bid.adserverTargeting)\r\n        // Get only the non-standard keys of the losing bids, since we\r\n        // don't want to override the standard keys of the winning bid.\r\n        .filter(getCustomKeys())\r\n        .map(key => {\r\n          return {\r\n            [key.substring(0, MAX_DFP_KEYLENGTH)]: [bid.adserverTargeting[key]]\r\n          };\r\n        })\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get custom targeting key value pairs for bids.\r\n   * @param {string[]}    AdUnit code array\r\n   * @return {targetingArray}   bids with custom targeting defined in bidderSettings\r\n   */\r\n  function getCustomBidTargeting(adUnitCodes, bidsReceived) {\r\n    return bidsReceived\r\n      .filter(bid => includes(adUnitCodes, bid.adUnitCode))\r\n      .map(bid => Object.assign({}, bid))\r\n      .reduce(mergeAdServerTargeting, [])\r\n      .map(truncateCustomKeys)\r\n      .filter(bid => bid); // removes empty elements in array;\r\n  }\r\n\r\n  /**\r\n   * Get targeting key value pairs for non-winning bids.\r\n   * @param {string[]}    AdUnit code array\r\n   * @return {targetingArray}   all non-winning bids targeting\r\n   */\r\n  function getBidLandscapeTargeting(adUnitCodes, bidsReceived) {\r\n    const standardKeys = FEATURES.NATIVE ? TARGETING_KEYS.concat(NATIVE_TARGETING_KEYS) : TARGETING_KEYS.slice();\r\n    const adUnitBidLimit = config.getConfig('sendBidsControl.bidLimit');\r\n    const bids = getHighestCpmBidsFromBidPool(bidsReceived, getHighestCpm, adUnitBidLimit);\r\n    const allowSendAllBidsTargetingKeys = config.getConfig('targetingControls.allowSendAllBidsTargetingKeys');\r\n\r\n    const allowedSendAllBidTargeting = allowSendAllBidsTargetingKeys\r\n      ? allowSendAllBidsTargetingKeys.map((key) => CONSTANTS.TARGETING_KEYS[key])\r\n      : standardKeys;\r\n\r\n    // populate targeting keys for the remaining bids\r\n    return bids.map(bid => {\r\n      if (bidShouldBeAddedToTargeting(bid, adUnitCodes)) {\r\n        return {\r\n          [bid.adUnitCode]: getTargetingMap(bid, standardKeys.filter(\r\n            key => typeof bid.adserverTargeting[key] !== 'undefined' &&\r\n            allowedSendAllBidTargeting.indexOf(key) !== -1)\r\n          )\r\n        };\r\n      }\r\n    }).filter(bid => bid); // removes empty elements in array\r\n  }\r\n\r\n  function getTargetingMap(bid, keys) {\r\n    return keys.map(key => {\r\n      return {\r\n        [`${key}_${bid.bidderCode}`.substring(0, MAX_DFP_KEYLENGTH)]: [bid.adserverTargeting[key]]\r\n      };\r\n    });\r\n  }\r\n\r\n  function getAdUnitTargeting(adUnitCodes) {\r\n    function getTargetingObj(adUnit) {\r\n      return deepAccess(adUnit, CONSTANTS.JSON_MAPPING.ADSERVER_TARGETING);\r\n    }\r\n\r\n    function getTargetingValues(adUnit) {\r\n      const aut = getTargetingObj(adUnit);\r\n\r\n      return Object.keys(aut)\r\n        .map(function(key) {\r\n          if (isStr(aut[key])) aut[key] = aut[key].split(',').map(s => s.trim());\r\n          if (!isArray(aut[key])) aut[key] = [ aut[key] ];\r\n          return { [key]: aut[key] };\r\n        });\r\n    }\r\n\r\n    return auctionManager.getAdUnits()\r\n      .filter(adUnit => includes(adUnitCodes, adUnit.code) && getTargetingObj(adUnit))\r\n      .map(adUnit => {\r\n        return {[adUnit.code]: getTargetingValues(adUnit)}\r\n      });\r\n  }\r\n\r\n  targeting.isApntagDefined = function() {\r\n    if (window.apntag && isFn(window.apntag.setKeywords)) {\r\n      return true;\r\n    }\r\n  };\r\n\r\n  return targeting;\r\n}\r\n\r\nexport const targeting = newTargeting(auctionManager);\r\n","import {\r\n  deepClone, isPlainObject, logError, shuffle, logMessage, triggerPixel, insertUserSyncIframe, isArray,\r\n  logWarn, isStr, isSafariBrowser\r\n} from './utils.js';\r\nimport { config } from './config.js';\r\nimport {includes} from './polyfill.js';\r\nimport { getCoreStorageManager } from './storageManager.js';\r\n\r\nexport const USERSYNC_DEFAULT_CONFIG = {\r\n  syncEnabled: true,\r\n  filterSettings: {\r\n    image: {\r\n      bidders: '*',\r\n      filter: 'include'\r\n    }\r\n  },\r\n  syncsPerBidder: 5,\r\n  syncDelay: 3000,\r\n  auctionDelay: 0\r\n};\r\n\r\n// Set userSync default values\r\nconfig.setDefaults({\r\n  'userSync': deepClone(USERSYNC_DEFAULT_CONFIG)\r\n});\r\n\r\nconst storage = getCoreStorageManager('usersync');\r\n\r\n/**\r\n * Factory function which creates a new UserSyncPool.\r\n *\r\n * @param {UserSyncDependencies} userSyncDependencies Configuration options and dependencies which the\r\n *   UserSync object needs in order to behave properly.\r\n */\r\nexport function newUserSync(userSyncDependencies) {\r\n  let publicApi = {};\r\n  // A queue of user syncs for each adapter\r\n  // Let getDefaultQueue() set the defaults\r\n  let queue = getDefaultQueue();\r\n\r\n  // Whether or not user syncs have been trigger on this page load for a specific bidder\r\n  let hasFiredBidder = new Set();\r\n  // How many bids for each adapter\r\n  let numAdapterBids = {};\r\n\r\n  // for now - default both to false in case filterSettings config is absent/misconfigured\r\n  let permittedPixels = {\r\n    image: true,\r\n    iframe: false\r\n  };\r\n\r\n  // Use what is in config by default\r\n  let usConfig = userSyncDependencies.config;\r\n  // Update if it's (re)set\r\n  config.getConfig('userSync', (conf) => {\r\n    // Added this logic for https://github.com/prebid/Prebid.js/issues/4864\r\n    // if userSync.filterSettings does not contain image/all configs, merge in default image config to ensure image pixels are fired\r\n    if (conf.userSync) {\r\n      let fs = conf.userSync.filterSettings;\r\n      if (isPlainObject(fs)) {\r\n        if (!fs.image && !fs.all) {\r\n          conf.userSync.filterSettings.image = {\r\n            bidders: '*',\r\n            filter: 'include'\r\n          };\r\n        }\r\n      }\r\n    }\r\n\r\n    usConfig = Object.assign(usConfig, conf.userSync);\r\n  });\r\n\r\n  /**\r\n   * @function getDefaultQueue\r\n   * @summary Returns the default empty queue\r\n   * @private\r\n   * @return {object} A queue with no syncs\r\n   */\r\n  function getDefaultQueue() {\r\n    return {\r\n      image: [],\r\n      iframe: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @function fireSyncs\r\n   * @summary Trigger all user syncs in the queue\r\n   * @private\r\n   */\r\n  function fireSyncs() {\r\n    if (!usConfig.syncEnabled || !userSyncDependencies.browserSupportsCookies) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Iframe syncs\r\n      loadIframes();\r\n      // Image pixels\r\n      fireImagePixels();\r\n    } catch (e) {\r\n      return logError('Error firing user syncs', e);\r\n    }\r\n    // Reset the user sync queue\r\n    queue = getDefaultQueue();\r\n  }\r\n\r\n  function forEachFire(queue, fn) {\r\n    // Randomize the order of the pixels before firing\r\n    // This is to avoid giving any bidder who has registered multiple syncs\r\n    // any preferential treatment and balancing them out\r\n    shuffle(queue).forEach((sync) => {\r\n      fn(sync);\r\n      hasFiredBidder.add(sync[0]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @function fireImagePixels\r\n   * @summary Loops through user sync pixels and fires each one\r\n   * @private\r\n   */\r\n  function fireImagePixels() {\r\n    if (!permittedPixels.image) {\r\n      return;\r\n    }\r\n    forEachFire(queue.image, (sync) => {\r\n      let [bidderName, trackingPixelUrl] = sync;\r\n      logMessage(`Invoking image pixel user sync for bidder: ${bidderName}`);\r\n      // Create image object and add the src url\r\n      triggerPixel(trackingPixelUrl);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @function loadIframes\r\n   * @summary Loops through iframe syncs and loads an iframe element into the page\r\n   * @private\r\n   */\r\n  function loadIframes() {\r\n    if (!(permittedPixels.iframe)) {\r\n      return;\r\n    }\r\n\r\n    forEachFire(queue.iframe, (sync) => {\r\n      let [bidderName, iframeUrl] = sync;\r\n      logMessage(`Invoking iframe user sync for bidder: ${bidderName}`);\r\n      // Insert iframe into DOM\r\n      insertUserSyncIframe(iframeUrl);\r\n      // for a bidder, if iframe sync is present then remove image pixel\r\n      removeImagePixelsForBidder(queue, bidderName);\r\n    });\r\n  }\r\n\r\n  function removeImagePixelsForBidder(queue, iframeSyncBidderName) {\r\n    queue.image = queue.image.filter(imageSync => {\r\n      let imageSyncBidderName = imageSync[0];\r\n      return imageSyncBidderName !== iframeSyncBidderName\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @function incrementAdapterBids\r\n   * @summary Increment the count of user syncs queue for the adapter\r\n   * @private\r\n   * @params {object} numAdapterBids The object contain counts for all adapters\r\n   * @params {string} bidder The name of the bidder adding a sync\r\n   * @returns {object} The updated version of numAdapterBids\r\n   */\r\n  function incrementAdapterBids(numAdapterBids, bidder) {\r\n    if (!numAdapterBids[bidder]) {\r\n      numAdapterBids[bidder] = 1;\r\n    } else {\r\n      numAdapterBids[bidder] += 1;\r\n    }\r\n    return numAdapterBids;\r\n  }\r\n\r\n  /**\r\n   * @function registerSync\r\n   * @summary Add sync for this bidder to a queue to be fired later\r\n   * @public\r\n   * @params {string} type The type of the sync including image, iframe\r\n   * @params {string} bidder The name of the adapter. e.g. \"rubicon\"\r\n   * @params {string} url Either the pixel url or iframe url depending on the type\r\n\r\n   * @example <caption>Using Image Sync</caption>\r\n   * // registerSync(type, adapter, pixelUrl)\r\n   * userSync.registerSync('image', 'rubicon', 'http://example.com/pixel')\r\n   */\r\n  publicApi.registerSync = (type, bidder, url) => {\r\n    if (hasFiredBidder.has(bidder)) {\r\n      return logMessage(`already fired syncs for \"${bidder}\", ignoring registerSync call`);\r\n    }\r\n    if (!usConfig.syncEnabled || !isArray(queue[type])) {\r\n      return logWarn(`User sync type \"${type}\" not supported`);\r\n    }\r\n    if (!bidder) {\r\n      return logWarn(`Bidder is required for registering sync`);\r\n    }\r\n    if (usConfig.syncsPerBidder !== 0 && Number(numAdapterBids[bidder]) >= usConfig.syncsPerBidder) {\r\n      return logWarn(`Number of user syncs exceeded for \"${bidder}\"`);\r\n    }\r\n\r\n    const canBidderRegisterSync = publicApi.canBidderRegisterSync(type, bidder);\r\n    if (!canBidderRegisterSync) {\r\n      return logWarn(`Bidder \"${bidder}\" not permitted to register their \"${type}\" userSync pixels.`);\r\n    }\r\n\r\n    // the bidder's pixel has passed all checks and is allowed to register\r\n    queue[type].push([bidder, url]);\r\n    numAdapterBids = incrementAdapterBids(numAdapterBids, bidder);\r\n  };\r\n\r\n  /**\r\n   * @function shouldBidderBeBlocked\r\n   * @summary Check filterSettings logic to determine if the bidder should be prevented from registering their userSync tracker\r\n   * @private\r\n   * @param {string} type The type of the sync; either image or iframe\r\n   * @param {string} bidder The name of the adapter. e.g. \"rubicon\"\r\n   * @returns {boolean} true => bidder is not allowed to register; false => bidder can register\r\n    */\r\n  function shouldBidderBeBlocked(type, bidder) {\r\n    let filterConfig = usConfig.filterSettings;\r\n\r\n    // apply the filter check if the config object is there (eg filterSettings.iframe exists) and if the config object is properly setup\r\n    if (isFilterConfigValid(filterConfig, type)) {\r\n      permittedPixels[type] = true;\r\n\r\n      let activeConfig = (filterConfig.all) ? filterConfig.all : filterConfig[type];\r\n      let biddersToFilter = (activeConfig.bidders === '*') ? [bidder] : activeConfig.bidders;\r\n      let filterType = activeConfig.filter || 'include'; // set default if undefined\r\n\r\n      // return true if the bidder is either: not part of the include (ie outside the whitelist) or part of the exclude (ie inside the blacklist)\r\n      const checkForFiltering = {\r\n        'include': (bidders, bidder) => !includes(bidders, bidder),\r\n        'exclude': (bidders, bidder) => includes(bidders, bidder)\r\n      }\r\n      return checkForFiltering[filterType](biddersToFilter, bidder);\r\n    }\r\n    return !permittedPixels[type];\r\n  }\r\n\r\n  /**\r\n   * @function isFilterConfigValid\r\n   * @summary Check if the filterSettings object in the userSync config is setup properly\r\n   * @private\r\n   * @param {object} filterConfig sub-config object taken from filterSettings\r\n   * @param {string} type The type of the sync; either image or iframe\r\n   * @returns {boolean} true => config is setup correctly, false => setup incorrectly or filterConfig[type] is not present\r\n   */\r\n  function isFilterConfigValid(filterConfig, type) {\r\n    if (filterConfig.all && filterConfig[type]) {\r\n      logWarn(`Detected presence of the \"filterSettings.all\" and \"filterSettings.${type}\" in userSync config.  You cannot mix \"all\" with \"iframe/image\" configs; they are mutually exclusive.`);\r\n      return false;\r\n    }\r\n\r\n    let activeConfig = (filterConfig.all) ? filterConfig.all : filterConfig[type];\r\n    let activeConfigName = (filterConfig.all) ? 'all' : type;\r\n\r\n    // if current pixel type isn't part of the config's logic, skip rest of the config checks...\r\n    // we return false to skip subsequent filter checks in shouldBidderBeBlocked() function\r\n    if (!activeConfig) {\r\n      return false;\r\n    }\r\n\r\n    let filterField = activeConfig.filter;\r\n    let biddersField = activeConfig.bidders;\r\n\r\n    if (filterField && filterField !== 'include' && filterField !== 'exclude') {\r\n      logWarn(`UserSync \"filterSettings.${activeConfigName}.filter\" setting '${filterField}' is not a valid option; use either 'include' or 'exclude'.`);\r\n      return false;\r\n    }\r\n\r\n    if (biddersField !== '*' && !(Array.isArray(biddersField) && biddersField.length > 0 && biddersField.every(bidderInList => isStr(bidderInList) && bidderInList !== '*'))) {\r\n      logWarn(`Detected an invalid setup in userSync \"filterSettings.${activeConfigName}.bidders\"; use either '*' (to represent all bidders) or an array of bidders.`);\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @function syncUsers\r\n   * @summary Trigger all the user syncs based on publisher-defined timeout\r\n   * @public\r\n   * @params {int} timeout The delay in ms before syncing data - default 0\r\n   */\r\n  publicApi.syncUsers = (timeout = 0) => {\r\n    if (timeout) {\r\n      return setTimeout(fireSyncs, Number(timeout));\r\n    }\r\n    fireSyncs();\r\n  };\r\n\r\n  /**\r\n   * @function triggerUserSyncs\r\n   * @summary A `syncUsers` wrapper for determining if enableOverride has been turned on\r\n   * @public\r\n   */\r\n  publicApi.triggerUserSyncs = () => {\r\n    if (usConfig.enableOverride) {\r\n      publicApi.syncUsers();\r\n    }\r\n  };\r\n\r\n  publicApi.canBidderRegisterSync = (type, bidder) => {\r\n    if (usConfig.filterSettings) {\r\n      if (shouldBidderBeBlocked(type, bidder)) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  return publicApi;\r\n}\r\n\r\nexport const userSync = newUserSync(Object.defineProperties({\r\n  config: config.getConfig('userSync'),\r\n}, {\r\n  browserSupportsCookies: {\r\n    get: function() {\r\n      // call storage lazily to give time for consent data to be available\r\n      return !isSafariBrowser() && storage.cookiesAreEnabled();\r\n    }\r\n  }\r\n}));\r\n\r\n/**\r\n * @typedef {Object} UserSyncDependencies\r\n *\r\n * @property {UserSyncConfig} config\r\n * @property {boolean} browserSupportsCookies True if the current browser supports cookies, and false otherwise.\r\n */\r\n\r\n/**\r\n * @typedef {Object} UserSyncConfig\r\n *\r\n * @property {boolean} enableOverride\r\n * @property {boolean} syncEnabled\r\n * @property {int} syncsPerBidder\r\n * @property {string[]} enabledBidders\r\n * @property {Object} filterSettings\r\n */\r\n","import { config } from './config.js';\r\nimport clone from 'just-clone';\r\nimport {find, includes} from './polyfill.js';\r\nimport CONSTANTS from './constants.json';\r\nimport {GreedyPromise} from './utils/promise.js';\r\nexport { default as deepAccess } from 'dlv/index.js';\r\nexport { dset as deepSetValue } from 'dset';\r\n\r\nvar tArr = 'Array';\r\nvar tStr = 'String';\r\nvar tFn = 'Function';\r\nvar tNumb = 'Number';\r\nvar tObject = 'Object';\r\nvar tBoolean = 'Boolean';\r\nvar toString = Object.prototype.toString;\r\nlet consoleExists = Boolean(window.console);\r\nlet consoleLogExists = Boolean(consoleExists && window.console.log);\r\nlet consoleInfoExists = Boolean(consoleExists && window.console.info);\r\nlet consoleWarnExists = Boolean(consoleExists && window.console.warn);\r\nlet consoleErrorExists = Boolean(consoleExists && window.console.error);\r\n\r\nlet eventEmitter;\r\n\r\nexport function _setEventEmitter(emitFn) {\r\n  // called from events.js - this hoop is to avoid circular imports\r\n  eventEmitter = emitFn;\r\n}\r\n\r\nfunction emitEvent(...args) {\r\n  if (eventEmitter != null) {\r\n    eventEmitter(...args);\r\n  }\r\n}\r\n\r\n// this allows stubbing of utility functions that are used internally by other utility functions\r\nexport const internal = {\r\n  checkCookieSupport,\r\n  createTrackPixelIframeHtml,\r\n  getWindowSelf,\r\n  getWindowTop,\r\n  getWindowLocation,\r\n  insertUserSyncIframe,\r\n  insertElement,\r\n  isFn,\r\n  triggerPixel,\r\n  logError,\r\n  logWarn,\r\n  logMessage,\r\n  logInfo,\r\n  parseQS,\r\n  formatQS,\r\n  deepEqual\r\n};\r\n\r\nlet prebidInternal = {};\r\n/**\r\n * Returns object that is used as internal prebid namespace\r\n */\r\nexport function getPrebidInternal() {\r\n  return prebidInternal;\r\n}\r\n\r\nvar uniqueRef = {};\r\nexport let bind = function(a, b) { return b; }.bind(null, 1, uniqueRef)() === uniqueRef\r\n  ? Function.prototype.bind\r\n  : function(bind) {\r\n    var self = this;\r\n    var args = Array.prototype.slice.call(arguments, 1);\r\n    return function() {\r\n      return self.apply(bind, args.concat(Array.prototype.slice.call(arguments)));\r\n    };\r\n  };\r\n\r\n/* utility method to get incremental integer starting from 1 */\r\nvar getIncrementalInteger = (function () {\r\n  var count = 0;\r\n  return function () {\r\n    count++;\r\n    return count;\r\n  };\r\n})();\r\n\r\n// generate a random string (to be used as a dynamic JSONP callback)\r\nexport function getUniqueIdentifierStr() {\r\n  return getIncrementalInteger() + Math.random().toString(16).substr(2);\r\n}\r\n\r\n/**\r\n * Returns a random v4 UUID of the form xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx,\r\n * where each x is replaced with a random hexadecimal digit from 0 to f,\r\n * and y is replaced with a random hexadecimal digit from 8 to b.\r\n * https://gist.github.com/jed/982883 via node-uuid\r\n */\r\nexport function generateUUID(placeholder) {\r\n  return placeholder\r\n    ? (placeholder ^ _getRandomData() >> placeholder / 4).toString(16)\r\n    : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, generateUUID);\r\n}\r\n\r\n/**\r\n * Returns random data using the Crypto API if available and Math.random if not\r\n * Method is from https://gist.github.com/jed/982883 like generateUUID, direct link https://gist.github.com/jed/982883#gistcomment-45104\r\n */\r\nfunction _getRandomData() {\r\n  if (window && window.crypto && window.crypto.getRandomValues) {\r\n    return crypto.getRandomValues(new Uint8Array(1))[0] % 16;\r\n  } else {\r\n    return Math.random() * 16;\r\n  }\r\n}\r\n\r\nexport function getBidIdParameter(key, paramsObj) {\r\n  if (paramsObj && paramsObj[key]) {\r\n    return paramsObj[key];\r\n  }\r\n\r\n  return '';\r\n}\r\n\r\nexport function tryAppendQueryString(existingUrl, key, value) {\r\n  if (value) {\r\n    return existingUrl + key + '=' + encodeURIComponent(value) + '&';\r\n  }\r\n\r\n  return existingUrl;\r\n}\r\n\r\n// parse a query string object passed in bid params\r\n// bid params should be an object such as {key: \"value\", key1 : \"value1\"}\r\n// aliases to formatQS\r\nexport function parseQueryStringParameters(queryObj) {\r\n  let result = '';\r\n  for (var k in queryObj) {\r\n    if (queryObj.hasOwnProperty(k)) { result += k + '=' + encodeURIComponent(queryObj[k]) + '&'; }\r\n  }\r\n  result = result.replace(/&$/, '');\r\n  return result;\r\n}\r\n\r\n// transform an AdServer targeting bids into a query string to send to the adserver\r\nexport function transformAdServerTargetingObj(targeting) {\r\n  // we expect to receive targeting for a single slot at a time\r\n  if (targeting && Object.getOwnPropertyNames(targeting).length > 0) {\r\n    return getKeys(targeting)\r\n      .map(key => `${key}=${encodeURIComponent(getValue(targeting, key))}`).join('&');\r\n  } else {\r\n    return '';\r\n  }\r\n}\r\n\r\n/**\r\n * Read an adUnit object and return the sizes used in an [[728, 90]] format (even if they had [728, 90] defined)\r\n * Preference is given to the `adUnit.mediaTypes.banner.sizes` object over the `adUnit.sizes`\r\n * @param {object} adUnit one adUnit object from the normal list of adUnits\r\n * @returns {Array.<number[]>} array of arrays containing numeric sizes\r\n */\r\nexport function getAdUnitSizes(adUnit) {\r\n  if (!adUnit) {\r\n    return;\r\n  }\r\n\r\n  let sizes = [];\r\n  if (adUnit.mediaTypes && adUnit.mediaTypes.banner && Array.isArray(adUnit.mediaTypes.banner.sizes)) {\r\n    let bannerSizes = adUnit.mediaTypes.banner.sizes;\r\n    if (Array.isArray(bannerSizes[0])) {\r\n      sizes = bannerSizes;\r\n    } else {\r\n      sizes.push(bannerSizes);\r\n    }\r\n  // TODO - remove this else block when we're ready to deprecate adUnit.sizes for bidders\r\n  } else if (Array.isArray(adUnit.sizes)) {\r\n    if (Array.isArray(adUnit.sizes[0])) {\r\n      sizes = adUnit.sizes;\r\n    } else {\r\n      sizes.push(adUnit.sizes);\r\n    }\r\n  }\r\n  return sizes;\r\n}\r\n\r\n/**\r\n * Parse a GPT-Style general size Array like `[[300, 250]]` or `\"300x250,970x90\"` into an array of sizes `[\"300x250\"]` or '['300x250', '970x90']'\r\n * @param  {(Array.<number[]>|Array.<number>)} sizeObj Input array or double array [300,250] or [[300,250], [728,90]]\r\n * @return {Array.<string>}  Array of strings like `[\"300x250\"]` or `[\"300x250\", \"728x90\"]`\r\n */\r\nexport function parseSizesInput(sizeObj) {\r\n  var parsedSizes = [];\r\n\r\n  // if a string for now we can assume it is a single size, like \"300x250\"\r\n  if (typeof sizeObj === 'string') {\r\n    // multiple sizes will be comma-separated\r\n    var sizes = sizeObj.split(',');\r\n\r\n    // regular expression to match strigns like 300x250\r\n    // start of line, at least 1 number, an \"x\" , then at least 1 number, and the then end of the line\r\n    var sizeRegex = /^(\\d)+x(\\d)+$/i;\r\n    if (sizes) {\r\n      for (var curSizePos in sizes) {\r\n        if (hasOwn(sizes, curSizePos) && sizes[curSizePos].match(sizeRegex)) {\r\n          parsedSizes.push(sizes[curSizePos]);\r\n        }\r\n      }\r\n    }\r\n  } else if (typeof sizeObj === 'object') {\r\n    var sizeArrayLength = sizeObj.length;\r\n\r\n    // don't process empty array\r\n    if (sizeArrayLength > 0) {\r\n      // if we are a 2 item array of 2 numbers, we must be a SingleSize array\r\n      if (sizeArrayLength === 2 && typeof sizeObj[0] === 'number' && typeof sizeObj[1] === 'number') {\r\n        parsedSizes.push(parseGPTSingleSizeArray(sizeObj));\r\n      } else {\r\n        // otherwise, we must be a MultiSize array\r\n        for (var i = 0; i < sizeArrayLength; i++) {\r\n          parsedSizes.push(parseGPTSingleSizeArray(sizeObj[i]));\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return parsedSizes;\r\n}\r\n\r\n// Parse a GPT style single size array, (i.e [300, 250])\r\n// into an AppNexus style string, (i.e. 300x250)\r\nexport function parseGPTSingleSizeArray(singleSize) {\r\n  if (isValidGPTSingleSize(singleSize)) {\r\n    return singleSize[0] + 'x' + singleSize[1];\r\n  }\r\n}\r\n\r\n// Parse a GPT style single size array, (i.e [300, 250])\r\n// into OpenRTB-compatible (imp.banner.w/h, imp.banner.format.w/h, imp.video.w/h) object(i.e. {w:300, h:250})\r\nexport function parseGPTSingleSizeArrayToRtbSize(singleSize) {\r\n  if (isValidGPTSingleSize(singleSize)) {\r\n    return {w: singleSize[0], h: singleSize[1]};\r\n  }\r\n}\r\n\r\nfunction isValidGPTSingleSize(singleSize) {\r\n  // if we aren't exactly 2 items in this array, it is invalid\r\n  return isArray(singleSize) && singleSize.length === 2 && (!isNaN(singleSize[0]) && !isNaN(singleSize[1]));\r\n}\r\n\r\nexport function getWindowTop() {\r\n  return window.top;\r\n}\r\n\r\nexport function getWindowSelf() {\r\n  return window.self;\r\n}\r\n\r\nexport function getWindowLocation() {\r\n  return window.location;\r\n}\r\n\r\n/**\r\n * Wrappers to console.(log | info | warn | error). Takes N arguments, the same as the native methods\r\n */\r\nexport function logMessage() {\r\n  if (debugTurnedOn() && consoleLogExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.log.apply(console, decorateLog(arguments, 'MESSAGE:'));\r\n  }\r\n}\r\n\r\nexport function logInfo() {\r\n  if (debugTurnedOn() && consoleInfoExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.info.apply(console, decorateLog(arguments, 'INFO:'));\r\n  }\r\n}\r\n\r\nexport function logWarn() {\r\n  if (debugTurnedOn() && consoleWarnExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.warn.apply(console, decorateLog(arguments, 'WARNING:'));\r\n  }\r\n  emitEvent(CONSTANTS.EVENTS.AUCTION_DEBUG, {type: 'WARNING', arguments: arguments});\r\n}\r\n\r\nexport function logError() {\r\n  if (debugTurnedOn() && consoleErrorExists) {\r\n    // eslint-disable-next-line no-console\r\n    console.error.apply(console, decorateLog(arguments, 'ERROR:'));\r\n  }\r\n  emitEvent(CONSTANTS.EVENTS.AUCTION_DEBUG, {type: 'ERROR', arguments: arguments});\r\n}\r\n\r\nexport function prefixLog(prefix) {\r\n  function decorate(fn) {\r\n    return function (...args) {\r\n      fn(prefix, ...args);\r\n    }\r\n  }\r\n  return {\r\n    logError: decorate(logError),\r\n    logWarn: decorate(logWarn),\r\n    logMessage: decorate(logMessage),\r\n    logInfo: decorate(logInfo),\r\n  }\r\n}\r\n\r\nfunction decorateLog(args, prefix) {\r\n  args = [].slice.call(args);\r\n  let bidder = config.getCurrentBidder();\r\n\r\n  prefix && args.unshift(prefix);\r\n  if (bidder) {\r\n    args.unshift(label('#aaa'));\r\n  }\r\n  args.unshift(label('#3b88c3'));\r\n  args.unshift('%cPrebid' + (bidder ? `%c${bidder}` : ''));\r\n  return args;\r\n\r\n  function label(color) {\r\n    return `display: inline-block; color: #fff; background: ${color}; padding: 1px 4px; border-radius: 3px;`\r\n  }\r\n}\r\n\r\nexport function hasConsoleLogger() {\r\n  return consoleLogExists;\r\n}\r\n\r\nexport function debugTurnedOn() {\r\n  return !!config.getConfig('debug');\r\n}\r\n\r\nexport function createInvisibleIframe() {\r\n  var f = document.createElement('iframe');\r\n  f.id = getUniqueIdentifierStr();\r\n  f.height = 0;\r\n  f.width = 0;\r\n  f.border = '0px';\r\n  f.hspace = '0';\r\n  f.vspace = '0';\r\n  f.marginWidth = '0';\r\n  f.marginHeight = '0';\r\n  f.style.border = '0';\r\n  f.scrolling = 'no';\r\n  f.frameBorder = '0';\r\n  f.src = 'about:blank';\r\n  f.style.display = 'none';\r\n  return f;\r\n}\r\n\r\n/*\r\n *   Check if a given parameter name exists in query string\r\n *   and if it does return the value\r\n */\r\nexport function getParameterByName(name) {\r\n  return parseQS(getWindowLocation().search)[name] || '';\r\n}\r\n\r\n/**\r\n * Return if the object is of the\r\n * given type.\r\n * @param {*} object to test\r\n * @param {String} _t type string (e.g., Array)\r\n * @return {Boolean} if object is of type _t\r\n */\r\nexport function isA(object, _t) {\r\n  return toString.call(object) === '[object ' + _t + ']';\r\n}\r\n\r\nexport function isFn(object) {\r\n  return isA(object, tFn);\r\n}\r\n\r\nexport function isStr(object) {\r\n  return isA(object, tStr);\r\n}\r\n\r\nexport function isArray(object) {\r\n  return isA(object, tArr);\r\n}\r\n\r\nexport function isNumber(object) {\r\n  return isA(object, tNumb);\r\n}\r\n\r\nexport function isPlainObject(object) {\r\n  return isA(object, tObject);\r\n}\r\n\r\nexport function isBoolean(object) {\r\n  return isA(object, tBoolean);\r\n}\r\n\r\n/**\r\n * Return if the object is \"empty\";\r\n * this includes falsey, no keys, or no items at indices\r\n * @param {*} object object to test\r\n * @return {Boolean} if object is empty\r\n */\r\nexport function isEmpty(object) {\r\n  if (!object) return true;\r\n  if (isArray(object) || isStr(object)) {\r\n    return !(object.length > 0);\r\n  }\r\n\r\n  for (var k in object) {\r\n    if (hasOwnProperty.call(object, k)) return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Return if string is empty, null, or undefined\r\n * @param str string to test\r\n * @returns {boolean} if string is empty\r\n */\r\nexport function isEmptyStr(str) {\r\n  return isStr(str) && (!str || str.length === 0);\r\n}\r\n\r\n/**\r\n * Iterate object with the function\r\n * falls back to es5 `forEach`\r\n * @param {Array|Object} object\r\n * @param {Function(value, key, object)} fn\r\n */\r\nexport function _each(object, fn) {\r\n  if (isEmpty(object)) return;\r\n  if (isFn(object.forEach)) return object.forEach(fn, this);\r\n\r\n  var k = 0;\r\n  var l = object.length;\r\n\r\n  if (l > 0) {\r\n    for (; k < l; k++) fn(object[k], k, object);\r\n  } else {\r\n    for (k in object) {\r\n      if (hasOwnProperty.call(object, k)) fn.call(this, object[k], k);\r\n    }\r\n  }\r\n}\r\n\r\nexport function contains(a, obj) {\r\n  if (isEmpty(a)) {\r\n    return false;\r\n  }\r\n\r\n  if (isFn(a.indexOf)) {\r\n    return a.indexOf(obj) !== -1;\r\n  }\r\n\r\n  var i = a.length;\r\n  while (i--) {\r\n    if (a[i] === obj) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Map an array or object into another array\r\n * given a function\r\n * @param {Array|Object} object\r\n * @param {Function(value, key, object)} callback\r\n * @return {Array}\r\n */\r\nexport function _map(object, callback) {\r\n  if (isEmpty(object)) return [];\r\n  if (isFn(object.map)) return object.map(callback);\r\n  var output = [];\r\n  _each(object, function (value, key) {\r\n    output.push(callback(value, key, object));\r\n  });\r\n\r\n  return output;\r\n}\r\n\r\nexport function hasOwn(objectToCheck, propertyToCheckFor) {\r\n  if (objectToCheck.hasOwnProperty) {\r\n    return objectToCheck.hasOwnProperty(propertyToCheckFor);\r\n  } else {\r\n    return (typeof objectToCheck[propertyToCheckFor] !== 'undefined') && (objectToCheck.constructor.prototype[propertyToCheckFor] !== objectToCheck[propertyToCheckFor]);\r\n  }\r\n};\r\n\r\n/*\r\n* Inserts an element(elm) as targets child, by default as first child\r\n* @param {HTMLElement} elm\r\n* @param {HTMLElement} [doc]\r\n* @param {HTMLElement} [target]\r\n* @param {Boolean} [asLastChildChild]\r\n* @return {HTML Element}\r\n*/\r\nexport function insertElement(elm, doc, target, asLastChildChild) {\r\n  doc = doc || document;\r\n  let parentEl;\r\n  if (target) {\r\n    parentEl = doc.getElementsByTagName(target);\r\n  } else {\r\n    parentEl = doc.getElementsByTagName('head');\r\n  }\r\n  try {\r\n    parentEl = parentEl.length ? parentEl : doc.getElementsByTagName('body');\r\n    if (parentEl.length) {\r\n      parentEl = parentEl[0];\r\n      let insertBeforeEl = asLastChildChild ? null : parentEl.firstChild;\r\n      return parentEl.insertBefore(elm, insertBeforeEl);\r\n    }\r\n  } catch (e) {}\r\n}\r\n\r\n/**\r\n * Returns a promise that completes when the given element triggers a 'load' or 'error' DOM event, or when\r\n * `timeout` milliseconds have elapsed.\r\n *\r\n * @param {HTMLElement} element\r\n * @param {Number} [timeout]\r\n * @returns {Promise}\r\n */\r\nexport function waitForElementToLoad(element, timeout) {\r\n  let timer = null;\r\n  return new GreedyPromise((resolve) => {\r\n    const onLoad = function() {\r\n      element.removeEventListener('load', onLoad);\r\n      element.removeEventListener('error', onLoad);\r\n      if (timer != null) {\r\n        window.clearTimeout(timer);\r\n      }\r\n      resolve();\r\n    };\r\n    element.addEventListener('load', onLoad);\r\n    element.addEventListener('error', onLoad);\r\n    if (timeout != null) {\r\n      timer = window.setTimeout(onLoad, timeout);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Inserts an image pixel with the specified `url` for cookie sync\r\n * @param {string} url URL string of the image pixel to load\r\n * @param  {function} [done] an optional exit callback, used when this usersync pixel is added during an async process\r\n * @param  {Number} [timeout] an optional timeout in milliseconds for the image to load before calling `done`\r\n */\r\nexport function triggerPixel(url, done, timeout) {\r\n  const img = new Image();\r\n  if (done && internal.isFn(done)) {\r\n    waitForElementToLoad(img, timeout).then(done);\r\n  }\r\n  img.src = url;\r\n}\r\n\r\nexport function callBurl({ source, burl }) {\r\n  if (source === CONSTANTS.S2S.SRC && burl) {\r\n    internal.triggerPixel(burl);\r\n  }\r\n}\r\n\r\n/**\r\n * Inserts an empty iframe with the specified `html`, primarily used for tracking purposes\r\n * (though could be for other purposes)\r\n * @param {string} htmlCode snippet of HTML code used for tracking purposes\r\n */\r\nexport function insertHtmlIntoIframe(htmlCode) {\r\n  if (!htmlCode) {\r\n    return;\r\n  }\r\n\r\n  let iframe = document.createElement('iframe');\r\n  iframe.id = getUniqueIdentifierStr();\r\n  iframe.width = 0;\r\n  iframe.height = 0;\r\n  iframe.hspace = '0';\r\n  iframe.vspace = '0';\r\n  iframe.marginWidth = '0';\r\n  iframe.marginHeight = '0';\r\n  iframe.style.display = 'none';\r\n  iframe.style.height = '0px';\r\n  iframe.style.width = '0px';\r\n  iframe.scrolling = 'no';\r\n  iframe.frameBorder = '0';\r\n  iframe.allowtransparency = 'true';\r\n\r\n  internal.insertElement(iframe, document, 'body');\r\n\r\n  iframe.contentWindow.document.open();\r\n  iframe.contentWindow.document.write(htmlCode);\r\n  iframe.contentWindow.document.close();\r\n}\r\n\r\n/**\r\n * Inserts empty iframe with the specified `url` for cookie sync\r\n * @param  {string} url URL to be requested\r\n * @param  {string} encodeUri boolean if URL should be encoded before inserted. Defaults to true\r\n * @param  {function} [done] an optional exit callback, used when this usersync pixel is added during an async process\r\n * @param  {Number} [timeout] an optional timeout in milliseconds for the iframe to load before calling `done`\r\n */\r\nexport function insertUserSyncIframe(url, done, timeout) {\r\n  let iframeHtml = internal.createTrackPixelIframeHtml(url, false, 'allow-scripts allow-same-origin');\r\n  let div = document.createElement('div');\r\n  div.innerHTML = iframeHtml;\r\n  let iframe = div.firstChild;\r\n  if (done && internal.isFn(done)) {\r\n    waitForElementToLoad(iframe, timeout).then(done);\r\n  }\r\n  internal.insertElement(iframe, document, 'html', true);\r\n}\r\n\r\n/**\r\n * Creates a snippet of HTML that retrieves the specified `url`\r\n * @param  {string} url URL to be requested\r\n * @return {string}     HTML snippet that contains the img src = set to `url`\r\n */\r\nexport function createTrackPixelHtml(url) {\r\n  if (!url) {\r\n    return '';\r\n  }\r\n\r\n  let escapedUrl = encodeURI(url);\r\n  let img = '<div style=\"position:absolute;left:0px;top:0px;visibility:hidden;\">';\r\n  img += '<img src=\"' + escapedUrl + '\"></div>';\r\n  return img;\r\n};\r\n\r\n/**\r\n * Creates a snippet of Iframe HTML that retrieves the specified `url`\r\n * @param  {string} url plain URL to be requested\r\n * @param  {string} encodeUri boolean if URL should be encoded before inserted. Defaults to true\r\n * @param  {string} sandbox string if provided the sandbox attribute will be included with the given value\r\n * @return {string}     HTML snippet that contains the iframe src = set to `url`\r\n */\r\nexport function createTrackPixelIframeHtml(url, encodeUri = true, sandbox = '') {\r\n  if (!url) {\r\n    return '';\r\n  }\r\n  if (encodeUri) {\r\n    url = encodeURI(url);\r\n  }\r\n  if (sandbox) {\r\n    sandbox = `sandbox=\"${sandbox}\"`;\r\n  }\r\n\r\n  return `<iframe ${sandbox} id=\"${getUniqueIdentifierStr()}\"\r\n      frameborder=\"0\"\r\n      allowtransparency=\"true\"\r\n      marginheight=\"0\" marginwidth=\"0\"\r\n      width=\"0\" hspace=\"0\" vspace=\"0\" height=\"0\"\r\n      style=\"height:0px;width:0px;display:none;\"\r\n      scrolling=\"no\"\r\n      src=\"${url}\">\r\n    </iframe>`;\r\n}\r\n\r\nexport function getValueString(param, val, defaultValue) {\r\n  if (val === undefined || val === null) {\r\n    return defaultValue;\r\n  }\r\n  if (isStr(val)) {\r\n    return val;\r\n  }\r\n  if (isNumber(val)) {\r\n    return val.toString();\r\n  }\r\n  internal.logWarn('Unsuported type for param: ' + param + ' required type: String');\r\n}\r\n\r\nexport function uniques(value, index, arry) {\r\n  return arry.indexOf(value) === index;\r\n}\r\n\r\nexport function flatten(a, b) {\r\n  return a.concat(b);\r\n}\r\n\r\nexport function getBidRequest(id, bidderRequests) {\r\n  if (!id) {\r\n    return;\r\n  }\r\n  let bidRequest;\r\n  bidderRequests.some(bidderRequest => {\r\n    let result = find(bidderRequest.bids, bid => ['bidId', 'adId', 'bid_id'].some(type => bid[type] === id));\r\n    if (result) {\r\n      bidRequest = result;\r\n    }\r\n    return result;\r\n  });\r\n  return bidRequest;\r\n}\r\n\r\nexport function getKeys(obj) {\r\n  return Object.keys(obj);\r\n}\r\n\r\nexport function getValue(obj, key) {\r\n  return obj[key];\r\n}\r\n\r\n/**\r\n * Get the key of an object for a given value\r\n */\r\nexport function getKeyByValue(obj, value) {\r\n  for (let prop in obj) {\r\n    if (obj.hasOwnProperty(prop)) {\r\n      if (obj[prop] === value) {\r\n        return prop;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function getBidderCodes(adUnits = $$PREBID_GLOBAL$$.adUnits) {\r\n  // this could memoize adUnits\r\n  return adUnits.map(unit => unit.bids.map(bid => bid.bidder)\r\n    .reduce(flatten, [])).reduce(flatten, []).filter(uniques);\r\n}\r\n\r\nexport function isGptPubadsDefined() {\r\n  if (window.googletag && isFn(window.googletag.pubads) && isFn(window.googletag.pubads().getSlots)) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function isApnGetTagDefined() {\r\n  if (window.apntag && isFn(window.apntag.getTag)) {\r\n    return true;\r\n  }\r\n}\r\n\r\n// This function will get highest cpm value bid, in case of tie it will return the bid with lowest timeToRespond\r\nexport const getHighestCpm = getHighestCpmCallback('timeToRespond', (previous, current) => previous > current);\r\n\r\n// This function will get the oldest hightest cpm value bid, in case of tie it will return the bid which came in first\r\n// Use case for tie: https://github.com/prebid/Prebid.js/issues/2448\r\nexport const getOldestHighestCpmBid = getHighestCpmCallback('responseTimestamp', (previous, current) => previous > current);\r\n\r\n// This function will get the latest hightest cpm value bid, in case of tie it will return the bid which came in last\r\n// Use case for tie: https://github.com/prebid/Prebid.js/issues/2539\r\nexport const getLatestHighestCpmBid = getHighestCpmCallback('responseTimestamp', (previous, current) => previous < current);\r\n\r\nfunction getHighestCpmCallback(useTieBreakerProperty, tieBreakerCallback) {\r\n  return (previous, current) => {\r\n    if (previous.cpm === current.cpm) {\r\n      return tieBreakerCallback(previous[useTieBreakerProperty], current[useTieBreakerProperty]) ? current : previous;\r\n    }\r\n    return previous.cpm < current.cpm ? current : previous;\r\n  }\r\n}\r\n\r\n/**\r\n * FisherYates shuffle\r\n * http://stackoverflow.com/a/6274398\r\n * https://bost.ocks.org/mike/shuffle/\r\n * istanbul ignore next\r\n */\r\nexport function shuffle(array) {\r\n  let counter = array.length;\r\n\r\n  // while there are elements in the array\r\n  while (counter > 0) {\r\n    // pick a random index\r\n    let index = Math.floor(Math.random() * counter);\r\n\r\n    // decrease counter by 1\r\n    counter--;\r\n\r\n    // and swap the last element with it\r\n    let temp = array[counter];\r\n    array[counter] = array[index];\r\n    array[index] = temp;\r\n  }\r\n\r\n  return array;\r\n}\r\n\r\nexport function adUnitsFilter(filter, bid) {\r\n  return includes(filter, bid && bid.adUnitCode);\r\n}\r\n\r\nexport function deepClone(obj) {\r\n  return clone(obj);\r\n}\r\n\r\nexport function inIframe() {\r\n  try {\r\n    return internal.getWindowSelf() !== internal.getWindowTop();\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function isSafariBrowser() {\r\n  return /^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent);\r\n}\r\n\r\nexport function replaceAuctionPrice(str, cpm) {\r\n  if (!str) return;\r\n  return str.replace(/\\$\\{AUCTION_PRICE\\}/g, cpm);\r\n}\r\n\r\nexport function replaceClickThrough(str, clicktag) {\r\n  if (!str || !clicktag || typeof clicktag !== 'string') return;\r\n  return str.replace(/\\${CLICKTHROUGH}/g, clicktag);\r\n}\r\n\r\nexport function timestamp() {\r\n  return new Date().getTime();\r\n}\r\n\r\n/**\r\n * The returned value represents the time elapsed since the time origin. @see https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\r\n * @returns {number}\r\n */\r\nexport function getPerformanceNow() {\r\n  return (window.performance && window.performance.now && window.performance.now()) || 0;\r\n}\r\n\r\n/**\r\n * When the deviceAccess flag config option is false, no cookies should be read or set\r\n * @returns {boolean}\r\n */\r\nexport function hasDeviceAccess() {\r\n  return config.getConfig('deviceAccess') !== false;\r\n}\r\n\r\n/**\r\n * @returns {(boolean|undefined)}\r\n */\r\nexport function checkCookieSupport() {\r\n  if (window.navigator.cookieEnabled || !!document.cookie.length) {\r\n    return true;\r\n  }\r\n}\r\n\r\n/**\r\n * Given a function, return a function which only executes the original after\r\n * it's been called numRequiredCalls times.\r\n *\r\n * Note that the arguments from the previous calls will *not* be forwarded to the original function.\r\n * Only the final call's arguments matter.\r\n *\r\n * @param {function} func The function which should be executed, once the returned function has been executed\r\n *   numRequiredCalls times.\r\n * @param {int} numRequiredCalls The number of times which the returned function needs to be called before\r\n *   func is.\r\n */\r\nexport function delayExecution(func, numRequiredCalls) {\r\n  if (numRequiredCalls < 1) {\r\n    throw new Error(`numRequiredCalls must be a positive number. Got ${numRequiredCalls}`);\r\n  }\r\n  let numCalls = 0;\r\n  return function () {\r\n    numCalls++;\r\n    if (numCalls === numRequiredCalls) {\r\n      func.apply(this, arguments);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * https://stackoverflow.com/a/34890276/428704\r\n * @export\r\n * @param {array} xs\r\n * @param {string} key\r\n * @returns {Object} {${key_value}: ${groupByArray}, key_value: {groupByArray}}\r\n */\r\nexport function groupBy(xs, key) {\r\n  return xs.reduce(function(rv, x) {\r\n    (rv[x[key]] = rv[x[key]] || []).push(x);\r\n    return rv;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Build an object consisting of only defined parameters to avoid creating an\r\n * object with defined keys and undefined values.\r\n * @param {Object} object The object to pick defined params out of\r\n * @param {string[]} params An array of strings representing properties to look for in the object\r\n * @returns {Object} An object containing all the specified values that are defined\r\n */\r\nexport function getDefinedParams(object, params) {\r\n  return params\r\n    .filter(param => object[param])\r\n    .reduce((bid, param) => Object.assign(bid, { [param]: object[param] }), {});\r\n}\r\n\r\n/**\r\n * @typedef {Object} MediaTypes\r\n * @property {Object} banner banner configuration\r\n * @property {Object} native native configuration\r\n * @property {Object} video video configuration\r\n */\r\n\r\n/**\r\n * Validates an adunit's `mediaTypes` parameter\r\n * @param {MediaTypes} mediaTypes mediaTypes parameter to validate\r\n * @return {boolean} If object is valid\r\n */\r\nexport function isValidMediaTypes(mediaTypes) {\r\n  const SUPPORTED_MEDIA_TYPES = ['banner', 'native', 'video'];\r\n  const SUPPORTED_STREAM_TYPES = ['instream', 'outstream', 'adpod'];\r\n\r\n  const types = Object.keys(mediaTypes);\r\n\r\n  if (!types.every(type => includes(SUPPORTED_MEDIA_TYPES, type))) {\r\n    return false;\r\n  }\r\n\r\n  if (mediaTypes.video && mediaTypes.video.context) {\r\n    return includes(SUPPORTED_STREAM_TYPES, mediaTypes.video.context);\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Returns user configured bidder params from adunit\r\n * @param {Object} adUnits\r\n * @param {string} adUnitCode code\r\n * @param {string} bidder code\r\n * @return {Array} user configured param for the given bidder adunit configuration\r\n */\r\nexport function getUserConfiguredParams(adUnits, adUnitCode, bidder) {\r\n  return adUnits\r\n    .filter(adUnit => adUnit.code === adUnitCode)\r\n    .map((adUnit) => adUnit.bids)\r\n    .reduce(flatten, [])\r\n    .filter((bidderData) => bidderData.bidder === bidder)\r\n    .map((bidderData) => bidderData.params || {});\r\n}\r\n\r\n/**\r\n * Returns Do Not Track state\r\n */\r\nexport function getDNT() {\r\n  return navigator.doNotTrack === '1' || window.doNotTrack === '1' || navigator.msDoNotTrack === '1' || navigator.doNotTrack === 'yes';\r\n}\r\n\r\nconst compareCodeAndSlot = (slot, adUnitCode) => slot.getAdUnitPath() === adUnitCode || slot.getSlotElementId() === adUnitCode;\r\n\r\n/**\r\n * Returns filter function to match adUnitCode in slot\r\n * @param {Object} slot GoogleTag slot\r\n * @return {function} filter function\r\n */\r\nexport function isAdUnitCodeMatchingSlot(slot) {\r\n  return (adUnitCode) => compareCodeAndSlot(slot, adUnitCode);\r\n}\r\n\r\n/**\r\n * Returns filter function to match adUnitCode in slot\r\n * @param {string} adUnitCode AdUnit code\r\n * @return {function} filter function\r\n */\r\nexport function isSlotMatchingAdUnitCode(adUnitCode) {\r\n  return (slot) => compareCodeAndSlot(slot, adUnitCode);\r\n}\r\n\r\n/**\r\n * @summary Uses the adUnit's code in order to find a matching gpt slot object on the page\r\n */\r\nexport function getGptSlotForAdUnitCode(adUnitCode) {\r\n  let matchingSlot;\r\n  if (isGptPubadsDefined()) {\r\n    // find the first matching gpt slot on the page\r\n    matchingSlot = find(window.googletag.pubads().getSlots(), isSlotMatchingAdUnitCode(adUnitCode));\r\n  }\r\n  return matchingSlot;\r\n};\r\n\r\n/**\r\n * @summary Uses the adUnit's code in order to find a matching gptSlot on the page\r\n */\r\nexport function getGptSlotInfoForAdUnitCode(adUnitCode) {\r\n  const matchingSlot = getGptSlotForAdUnitCode(adUnitCode);\r\n  if (matchingSlot) {\r\n    return {\r\n      gptSlot: matchingSlot.getAdUnitPath(),\r\n      divId: matchingSlot.getSlotElementId()\r\n    }\r\n  }\r\n  return {};\r\n};\r\n\r\n/**\r\n * Constructs warning message for when unsupported bidders are dropped from an adunit\r\n * @param {Object} adUnit ad unit from which the bidder is being dropped\r\n * @param {string} bidder bidder code that is not compatible with the adUnit\r\n * @return {string} warning message to display when condition is met\r\n */\r\nexport function unsupportedBidderMessage(adUnit, bidder) {\r\n  const mediaType = Object.keys(adUnit.mediaTypes || {'banner': 'banner'}).join(', ');\r\n\r\n  return `\r\n    ${adUnit.code} is a ${mediaType} ad unit\r\n    containing bidders that don't support ${mediaType}: ${bidder}.\r\n    This bidder won't fetch demand.\r\n  `;\r\n}\r\n\r\n/**\r\n * Checks input is integer or not\r\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/isInteger\r\n * @param {*} value\r\n */\r\nexport function isInteger(value) {\r\n  if (Number.isInteger) {\r\n    return Number.isInteger(value);\r\n  } else {\r\n    return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;\r\n  }\r\n}\r\n\r\n/**\r\n * Converts a string value in camel-case to underscore eg 'placementId' becomes 'placement_id'\r\n * @param {string} value string value to convert\r\n */\r\nexport function convertCamelToUnderscore(value) {\r\n  return value.replace(/(?:^|\\.?)([A-Z])/g, function (x, y) { return '_' + y.toLowerCase() }).replace(/^_/, '');\r\n}\r\n\r\n/**\r\n * Returns a new object with undefined properties removed from given object\r\n * @param obj the object to clean\r\n */\r\nexport function cleanObj(obj) {\r\n  return Object.keys(obj).reduce((newObj, key) => {\r\n    if (typeof obj[key] !== 'undefined') {\r\n      newObj[key] = obj[key];\r\n    }\r\n    return newObj;\r\n  }, {})\r\n}\r\n\r\n/**\r\n * Create a new object with selected properties.  Also allows property renaming and transform functions.\r\n * @param obj the original object\r\n * @param properties An array of desired properties\r\n */\r\nexport function pick(obj, properties) {\r\n  if (typeof obj !== 'object') {\r\n    return {};\r\n  }\r\n  return properties.reduce((newObj, prop, i) => {\r\n    if (typeof prop === 'function') {\r\n      return newObj;\r\n    }\r\n\r\n    let newProp = prop;\r\n    let match = prop.match(/^(.+?)\\sas\\s(.+?)$/i);\r\n\r\n    if (match) {\r\n      prop = match[1];\r\n      newProp = match[2];\r\n    }\r\n\r\n    let value = obj[prop];\r\n    if (typeof properties[i + 1] === 'function') {\r\n      value = properties[i + 1](value, newObj);\r\n    }\r\n    if (typeof value !== 'undefined') {\r\n      newObj[newProp] = value;\r\n    }\r\n\r\n    return newObj;\r\n  }, {});\r\n}\r\n\r\n/**\r\n * Converts an object of arrays (either strings or numbers) into an array of objects containing key and value properties\r\n * normally read from bidder params\r\n * eg { foo: ['bar', 'baz'], fizz: ['buzz'] }\r\n * becomes [{ key: 'foo', value: ['bar', 'baz']}, {key: 'fizz', value: ['buzz']}]\r\n * @param {Object} keywords object of arrays representing keyvalue pairs\r\n * @param {string} paramName name of parent object (eg 'keywords') containing keyword data, used in error handling\r\n */\r\nexport function transformBidderParamKeywords(keywords, paramName = 'keywords') {\r\n  let arrs = [];\r\n\r\n  _each(keywords, (v, k) => {\r\n    if (isArray(v)) {\r\n      let values = [];\r\n      _each(v, (val) => {\r\n        val = getValueString(paramName + '.' + k, val);\r\n        if (val || val === '') { values.push(val); }\r\n      });\r\n      v = values;\r\n    } else {\r\n      v = getValueString(paramName + '.' + k, v);\r\n      if (isStr(v)) {\r\n        v = [v];\r\n      } else {\r\n        return;\r\n      } // unsuported types - don't send a key\r\n    }\r\n    arrs.push({key: k, value: v});\r\n  });\r\n\r\n  return arrs;\r\n}\r\n\r\n/**\r\n * Try to convert a value to a type.\r\n * If it can't be done, the value will be returned.\r\n *\r\n * @param {string} typeToConvert The target type. e.g. \"string\", \"number\", etc.\r\n * @param {*} value The value to be converted into typeToConvert.\r\n */\r\nfunction tryConvertType(typeToConvert, value) {\r\n  if (typeToConvert === 'string') {\r\n    return value && value.toString();\r\n  } else if (typeToConvert === 'number') {\r\n    return Number(value);\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nexport function convertTypes(types, params) {\r\n  Object.keys(types).forEach(key => {\r\n    if (params[key]) {\r\n      if (isFn(types[key])) {\r\n        params[key] = types[key](params[key]);\r\n      } else {\r\n        params[key] = tryConvertType(types[key], params[key]);\r\n      }\r\n\r\n      // don't send invalid values\r\n      if (isNaN(params[key])) {\r\n        delete params.key;\r\n      }\r\n    }\r\n  });\r\n  return params;\r\n}\r\n\r\nexport function isArrayOfNums(val, size) {\r\n  return (isArray(val)) && ((size) ? val.length === size : true) && (val.every(v => isInteger(v)));\r\n}\r\n\r\n/**\r\n * Creates an array of n length and fills each item with the given value\r\n */\r\nexport function fill(value, length) {\r\n  let newArray = [];\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    let valueToPush = isPlainObject(value) ? deepClone(value) : value;\r\n    newArray.push(valueToPush);\r\n  }\r\n\r\n  return newArray;\r\n}\r\n\r\n/**\r\n * http://npm.im/chunk\r\n * Returns an array with *size* chunks from given array\r\n *\r\n * Example:\r\n * ['a', 'b', 'c', 'd', 'e'] chunked by 2 =>\r\n * [['a', 'b'], ['c', 'd'], ['e']]\r\n */\r\nexport function chunk(array, size) {\r\n  let newArray = [];\r\n\r\n  for (let i = 0; i < Math.ceil(array.length / size); i++) {\r\n    let start = i * size;\r\n    let end = start + size;\r\n    newArray.push(array.slice(start, end));\r\n  }\r\n\r\n  return newArray;\r\n}\r\n\r\nexport function getMinValueFromArray(array) {\r\n  return Math.min(...array);\r\n}\r\n\r\nexport function getMaxValueFromArray(array) {\r\n  return Math.max(...array);\r\n}\r\n\r\n/**\r\n * This function will create compare function to sort on object property\r\n * @param {string} property\r\n * @returns {function} compare function to be used in sorting\r\n */\r\nexport function compareOn(property) {\r\n  return function compare(a, b) {\r\n    if (a[property] < b[property]) {\r\n      return 1;\r\n    }\r\n    if (a[property] > b[property]) {\r\n      return -1;\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n\r\nexport function parseQS(query) {\r\n  return !query ? {} : query\r\n    .replace(/^\\?/, '')\r\n    .split('&')\r\n    .reduce((acc, criteria) => {\r\n      let [k, v] = criteria.split('=');\r\n      if (/\\[\\]$/.test(k)) {\r\n        k = k.replace('[]', '');\r\n        acc[k] = acc[k] || [];\r\n        acc[k].push(v);\r\n      } else {\r\n        acc[k] = v || '';\r\n      }\r\n      return acc;\r\n    }, {});\r\n}\r\n\r\nexport function formatQS(query) {\r\n  return Object\r\n    .keys(query)\r\n    .map(k => Array.isArray(query[k])\r\n      ? query[k].map(v => `${k}[]=${v}`).join('&')\r\n      : `${k}=${query[k]}`)\r\n    .join('&');\r\n}\r\n\r\nexport function parseUrl(url, options) {\r\n  let parsed = document.createElement('a');\r\n  if (options && 'noDecodeWholeURL' in options && options.noDecodeWholeURL) {\r\n    parsed.href = url;\r\n  } else {\r\n    parsed.href = decodeURIComponent(url);\r\n  }\r\n  // in window.location 'search' is string, not object\r\n  let qsAsString = (options && 'decodeSearchAsString' in options && options.decodeSearchAsString);\r\n  return {\r\n    href: parsed.href,\r\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\r\n    hostname: parsed.hostname,\r\n    port: +parsed.port,\r\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\r\n    search: (qsAsString) ? parsed.search : internal.parseQS(parsed.search || ''),\r\n    hash: (parsed.hash || '').replace(/^#/, ''),\r\n    host: parsed.host || window.location.host\r\n  };\r\n}\r\n\r\nexport function buildUrl(obj) {\r\n  return (obj.protocol || 'http') + '://' +\r\n    (obj.host ||\r\n      obj.hostname + (obj.port ? `:${obj.port}` : '')) +\r\n    (obj.pathname || '') +\r\n    (obj.search ? `?${internal.formatQS(obj.search || '')}` : '') +\r\n    (obj.hash ? `#${obj.hash}` : '');\r\n}\r\n\r\n/**\r\n * This function deeply compares two objects checking for their equivalence.\r\n * @param {Object} obj1\r\n * @param {Object} obj2\r\n * @param checkTypes {boolean} if set, two objects with identical properties but different constructors will *not*\r\n * be considered equivalent.\r\n * @returns {boolean}\r\n */\r\nexport function deepEqual(obj1, obj2, {checkTypes = false} = {}) {\r\n  if (obj1 === obj2) return true;\r\n  else if (\r\n    (typeof obj1 === 'object' && obj1 !== null) &&\r\n    (typeof obj2 === 'object' && obj2 !== null) &&\r\n    (!checkTypes || (obj1.constructor === obj2.constructor))\r\n  ) {\r\n    if (Object.keys(obj1).length !== Object.keys(obj2).length) return false;\r\n    for (let prop in obj1) {\r\n      if (obj2.hasOwnProperty(prop)) {\r\n        if (!deepEqual(obj1[prop], obj2[prop], {checkTypes})) {\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport function mergeDeep(target, ...sources) {\r\n  if (!sources.length) return target;\r\n  const source = sources.shift();\r\n\r\n  if (isPlainObject(target) && isPlainObject(source)) {\r\n    for (const key in source) {\r\n      if (isPlainObject(source[key])) {\r\n        if (!target[key]) Object.assign(target, { [key]: {} });\r\n        mergeDeep(target[key], source[key]);\r\n      } else if (isArray(source[key])) {\r\n        if (!target[key]) {\r\n          Object.assign(target, { [key]: [...source[key]] });\r\n        } else if (isArray(target[key])) {\r\n          source[key].forEach(obj => {\r\n            let addItFlag = 1;\r\n            for (let i = 0; i < target[key].length; i++) {\r\n              if (deepEqual(target[key][i], obj)) {\r\n                addItFlag = 0;\r\n                break;\r\n              }\r\n            }\r\n            if (addItFlag) {\r\n              target[key].push(obj);\r\n            }\r\n          });\r\n        }\r\n      } else {\r\n        Object.assign(target, { [key]: source[key] });\r\n      }\r\n    }\r\n  }\r\n\r\n  return mergeDeep(target, ...sources);\r\n}\r\n\r\n/**\r\n * returns a hash of a string using a fast algorithm\r\n * source: https://stackoverflow.com/a/52171480/845390\r\n * @param str\r\n * @param seed (optional)\r\n * @returns {string}\r\n */\r\nexport function cyrb53Hash(str, seed = 0) {\r\n  // IE doesn't support imul\r\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/imul#Polyfill\r\n  let imul = function(opA, opB) {\r\n    if (isFn(Math.imul)) {\r\n      return Math.imul(opA, opB);\r\n    } else {\r\n      opB |= 0; // ensure that opB is an integer. opA will automatically be coerced.\r\n      // floating points give us 53 bits of precision to work with plus 1 sign bit\r\n      // automatically handled for our convienence:\r\n      // 1. 0x003fffff /*opA & 0x000fffff*/ * 0x7fffffff /*opB*/ = 0x1fffff7fc00001\r\n      //    0x1fffff7fc00001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\r\n      var result = (opA & 0x003fffff) * opB;\r\n      // 2. We can remove an integer coersion from the statement above because:\r\n      //    0x1fffff7fc00001 + 0xffc00000 = 0x1fffffff800001\r\n      //    0x1fffffff800001 < Number.MAX_SAFE_INTEGER /*0x1fffffffffffff*/\r\n      if (opA & 0xffc00000) result += (opA & 0xffc00000) * opB | 0;\r\n      return result | 0;\r\n    }\r\n  };\r\n\r\n  let h1 = 0xdeadbeef ^ seed;\r\n  let h2 = 0x41c6ce57 ^ seed;\r\n  for (let i = 0, ch; i < str.length; i++) {\r\n    ch = str.charCodeAt(i);\r\n    h1 = imul(h1 ^ ch, 2654435761);\r\n    h2 = imul(h2 ^ ch, 1597334677);\r\n  }\r\n  h1 = imul(h1 ^ (h1 >>> 16), 2246822507) ^ imul(h2 ^ (h2 >>> 13), 3266489909);\r\n  h2 = imul(h2 ^ (h2 >>> 16), 2246822507) ^ imul(h1 ^ (h1 >>> 13), 3266489909);\r\n  return (4294967296 * (2097151 & h2) + (h1 >>> 0)).toString();\r\n}\r\n\r\n/**\r\n * returns a window object, which holds the provided document or null\r\n * @param {Document} doc\r\n * @returns {Window}\r\n */\r\nexport function getWindowFromDocument(doc) {\r\n  return (doc) ? doc.defaultView : null;\r\n}\r\n\r\n/**\r\n * returns the result of `JSON.parse(data)`, or undefined if that throws an error.\r\n * @param data\r\n * @returns {any}\r\n */\r\nexport function safeJSONParse(data) {\r\n  try {\r\n    return JSON.parse(data);\r\n  } catch (e) {}\r\n}\r\n\r\n/**\r\n * Sets dataset attributes on a script\r\n * @param {Script} script\r\n * @param {object} attributes\r\n */\r\nexport function setScriptAttributes(script, attributes) {\r\n  for (let key in attributes) {\r\n    if (attributes.hasOwnProperty(key)) {\r\n      script.setAttribute(key, attributes[key]);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Encode a string for inclusion in HTML.\r\n * See https://pragmaticwebsecurity.com/articles/spasecurity/json-stringify-xss.html and\r\n * https://codeql.github.com/codeql-query-help/javascript/js-bad-code-sanitization/\r\n * @return {string}\r\n */\r\nexport const escapeUnsafeChars = (() => {\r\n  const escapes = {\r\n    '<': '\\\\u003C',\r\n    '>': '\\\\u003E',\r\n    '/': '\\\\u002F',\r\n    '\\\\': '\\\\\\\\',\r\n    '\\b': '\\\\b',\r\n    '\\f': '\\\\f',\r\n    '\\n': '\\\\n',\r\n    '\\r': '\\\\r',\r\n    '\\t': '\\\\t',\r\n    '\\0': '\\\\0',\r\n    '\\u2028': '\\\\u2028',\r\n    '\\u2029': '\\\\u2029'\r\n  };\r\n\r\n  return function(str) {\r\n    return str.replace(/[<>\\b\\f\\n\\r\\t\\0\\u2028\\u2029\\\\]/g, x => escapes[x])\r\n  }\r\n})();\r\n","import {config} from '../config.js';\r\nexport const CONFIG_TOGGLE = 'performanceMetrics';\r\nconst getTime = window.performance && window.performance.now ? () => window.performance.now() : () => Date.now();\r\nconst NODES = new WeakMap();\r\n\r\nexport function metricsFactory({now = getTime, mkNode = makeNode, mkTimer = makeTimer, mkRenamer = (rename) => rename, nodes = NODES} = {}) {\r\n  return function newMetrics() {\r\n    function makeMetrics(self, rename = (n) => ({forEach(fn) { fn(n); }})) {\r\n      rename = mkRenamer(rename);\r\n\r\n      function accessor(slot) {\r\n        return function (name) {\r\n          return self.dfWalk({\r\n            visit(edge, node) {\r\n              const obj = node[slot];\r\n              if (obj.hasOwnProperty(name)) {\r\n                return obj[name];\r\n              }\r\n            }\r\n          });\r\n        };\r\n      }\r\n\r\n      const getTimestamp = accessor('timestamps');\r\n\r\n      /**\r\n       * Register a metric.\r\n       *\r\n       * @param name metric name\r\n       * @param value metric valiue\r\n       */\r\n      function setMetric(name, value) {\r\n        const names = rename(name);\r\n        self.dfWalk({\r\n          follow(inEdge, outEdge) {\r\n            return outEdge.propagate && (!inEdge || !inEdge.stopPropagation)\r\n          },\r\n          visit(edge, node) {\r\n            names.forEach(name => {\r\n              if (edge == null) {\r\n                node.metrics[name] = value;\r\n              } else {\r\n                if (!node.groups.hasOwnProperty(name)) {\r\n                  node.groups[name] = [];\r\n                }\r\n                node.groups[name].push(value);\r\n              }\r\n            })\r\n          }\r\n        });\r\n      }\r\n\r\n      /**\r\n       * Mark the current time as a checkpoint with the given name, to be referenced later\r\n       * by `timeSince` or `timeBetween`.\r\n       *\r\n       * @param name checkpoint name\r\n       */\r\n      function checkpoint(name) {\r\n        self.timestamps[name] = now();\r\n      }\r\n\r\n      /**\r\n       * Get the tame passed since `checkpoint`, and optionally save it as a metric.\r\n       *\r\n       * @param checkpoint checkpoint name\r\n       * @param metric? metric name\r\n       * @return {number} time between now and `checkpoint`\r\n       */\r\n      function timeSince(checkpoint, metric) {\r\n        const ts = getTimestamp(checkpoint);\r\n        const elapsed = ts != null ? now() - ts : null;\r\n        if (metric != null) {\r\n          setMetric(metric, elapsed);\r\n        }\r\n        return elapsed;\r\n      }\r\n\r\n      /**\r\n       * Get the time passed between `startCheckpoint` and `endCheckpoint`, optionally saving it as a metric.\r\n       *\r\n       * @param startCheckpoint begin checkpoint\r\n       * @param endCheckpoint end checkpoint\r\n       * @param metric? metric name\r\n       * @return {number} time passed between `startCheckpoint` and `endCheckpoint`\r\n       */\r\n      function timeBetween(startCheckpoint, endCheckpoint, metric) {\r\n        const start = getTimestamp(startCheckpoint);\r\n        const end = getTimestamp(endCheckpoint);\r\n        const elapsed = start != null && end != null ? end - start : null;\r\n        if (metric != null) {\r\n          setMetric(metric, elapsed);\r\n        }\r\n        return elapsed;\r\n      }\r\n\r\n      /**\r\n       * A function that, when called, stops a time measure and saves it as a metric.\r\n       *\r\n       * @typedef {function(): void} MetricsTimer\r\n       * @template {function} F\r\n       * @property {function(F): F} stopBefore returns a wrapper around the given function that begins by\r\n       *   stopping this time measure.\r\n       * @property {function(F): F} stopAfter returns a wrapper around the given function that ends by\r\n       *   stopping this time measure.\r\n       */\r\n\r\n      /**\r\n       * Start measuring a time metric with the given name.\r\n       *\r\n       * @param name metric name\r\n       * @return {MetricsTimer}\r\n       */\r\n      function startTiming(name) {\r\n        return mkTimer(now, (val) => setMetric(name, val))\r\n      }\r\n\r\n      /**\r\n       * Run fn and measure the time spent in it.\r\n       *\r\n       * @template T\r\n       * @param name the name to use for the measured time metric\r\n       * @param {function(): T} fn\r\n       * @return {T} the return value of `fn`\r\n       */\r\n      function measureTime(name, fn) {\r\n        return startTiming(name).stopAfter(fn)();\r\n      }\r\n\r\n      /**\r\n       * @typedef {function: T} HookFn\r\n       * @property {function(T): void} bail\r\n       *\r\n       * @template T\r\n       * @typedef {T: HookFn} TimedHookFn\r\n       * @property {function(): void} stopTiming\r\n       * @property {T} untimed\r\n       */\r\n\r\n      /**\r\n       * Convenience method for measuring time spent in a `.before` or `.after` hook.\r\n       *\r\n       * @template T\r\n       * @param name metric name\r\n       * @param {HookFn} next the hook's `next` (first) argument\r\n       * @param {function(TimedHookFn): T} fn a function that will be run immediately; it takes `next`,\r\n       *    where both `next` and `next.bail` automatically\r\n       *    call `stopTiming` before continuing with the original hook.\r\n       * @return {T} fn's return value\r\n       */\r\n      function measureHookTime(name, next, fn) {\r\n        const stopTiming = startTiming(name);\r\n        return fn((function (orig) {\r\n          const next = stopTiming.stopBefore(orig);\r\n          next.bail = orig.bail && stopTiming.stopBefore(orig.bail);\r\n          next.stopTiming = stopTiming;\r\n          next.untimed = orig;\r\n          return next;\r\n        })(next));\r\n      }\r\n\r\n      /**\r\n       * Get all registered metrics.\r\n       * @return {{}}\r\n       */\r\n      function getMetrics() {\r\n        let result = {}\r\n        self.dfWalk({\r\n          visit(edge, node) {\r\n            result = Object.assign({}, !edge || edge.includeGroups ? node.groups : null, node.metrics, result);\r\n          }\r\n        });\r\n        return result;\r\n      }\r\n\r\n      /**\r\n       * Create and return a new metrics object that starts as a view on all metrics registered here,\r\n       * and - by default - also propagates all new metrics here.\r\n       *\r\n       * Propagated metrics are grouped together, and intended for repeated operations. For example, with the following:\r\n       *\r\n       * ```\r\n       * const metrics = newMetrics();\r\n       * const requests = metrics.measureTime('buildRequests', buildRequests)\r\n       * requests.forEach((req) => {\r\n       *   const requestMetrics = metrics.fork();\r\n       *   requestMetrics.measureTime('processRequest', () => processRequest(req);\r\n       * })\r\n       * ```\r\n       *\r\n       * if `buildRequests` takes 10ms and returns 3 objects, which respectively take 100, 200, and 300ms in `processRequest`, then\r\n       * the final `metrics.getMetrics()` would be:\r\n       *\r\n       * ```\r\n       * {\r\n       *    buildRequests: 10,\r\n       *    processRequest: [100, 200, 300]\r\n       * }\r\n       * ```\r\n       *\r\n       * while the inner `requestMetrics.getMetrics()` would be:\r\n       *\r\n       * ```\r\n       * {\r\n       *   buildRequests: 10,\r\n       *   processRequest: 100 // or 200 for the 2nd loop, etc\r\n       * }\r\n       * ```\r\n       *\r\n       *\r\n       * @param propagate if false, the forked metrics will not be propagated here\r\n       * @param stopPropagation if true, propagation from the new metrics is stopped here - instead of\r\n       *   continuing up the chain (if for example these metrics were themselves created through `.fork()`)\r\n       * @param includeGroups if true, the forked metrics will also replicate metrics that were propagated\r\n       *   here from elsewhere. For example:\r\n       *   ```\r\n       *   const metrics = newMetrics();\r\n       *   const op1 = metrics.fork();\r\n       *   const withoutGroups = metrics.fork();\r\n       *   const withGroups = metrics.fork({includeGroups: true});\r\n       *   op1.setMetric('foo', 'bar');\r\n       *   withoutGroups.getMetrics() // {}\r\n       *   withGroups.getMetrics() // {foo: ['bar']}\r\n       *   ```\r\n       */\r\n      function fork({propagate = true, stopPropagation = false, includeGroups = false} = {}) {\r\n        return makeMetrics(mkNode([[self, {propagate, stopPropagation, includeGroups}]]), rename);\r\n      }\r\n\r\n      /**\r\n       * Join `otherMetrics` with these; all metrics from `otherMetrics` will (by default) be propagated here,\r\n       * and all metrics from here will be included in `otherMetrics`.\r\n       *\r\n       * `propagate`, `stopPropagation` and `includeGroups` have the same semantics as in `.fork()`.\r\n       */\r\n      function join(otherMetrics, {propagate = true, stopPropagation = false, includeGroups = false} = {}) {\r\n        const other = nodes.get(otherMetrics);\r\n        if (other != null) {\r\n          other.addParent(self, {propagate, stopPropagation, includeGroups});\r\n        }\r\n      }\r\n\r\n      /**\r\n       * return a version of these metrics where all new metrics are renamed according to `renameFn`.\r\n       *\r\n       * @param {function(String): Array[String]} renameFn\r\n       */\r\n      function renameWith(renameFn) {\r\n        return makeMetrics(self, renameFn);\r\n      }\r\n\r\n      /**\r\n       * Create a new metrics object that uses the same propagation and renaming rules as this one.\r\n       */\r\n      function newMetrics() {\r\n        return makeMetrics(self.newSibling(), rename);\r\n      }\r\n\r\n      const metrics = {\r\n        startTiming,\r\n        measureTime,\r\n        measureHookTime,\r\n        checkpoint,\r\n        timeSince,\r\n        timeBetween,\r\n        setMetric,\r\n        getMetrics,\r\n        fork,\r\n        join,\r\n        newMetrics,\r\n        renameWith,\r\n        toJSON() {\r\n          return getMetrics();\r\n        }\r\n      };\r\n      nodes.set(metrics, self);\r\n      return metrics;\r\n    }\r\n\r\n    return makeMetrics(mkNode([]));\r\n  }\r\n}\r\n\r\nfunction wrapFn(fn, before, after) {\r\n  return function () {\r\n    before && before();\r\n    try {\r\n      return fn.apply(this, arguments);\r\n    } finally {\r\n      after && after();\r\n    }\r\n  };\r\n}\r\n\r\nfunction makeTimer(now, cb) {\r\n  const start = now();\r\n  let done = false;\r\n  function stopTiming() {\r\n    if (!done) {\r\n      // eslint-disable-next-line standard/no-callback-literal\r\n      cb(now() - start);\r\n      done = true;\r\n    }\r\n  }\r\n  stopTiming.stopBefore = (fn) => wrapFn(fn, stopTiming);\r\n  stopTiming.stopAfter = (fn) => wrapFn(fn, null, stopTiming);\r\n  return stopTiming;\r\n}\r\n\r\nfunction makeNode(parents) {\r\n  return {\r\n    metrics: {},\r\n    timestamps: {},\r\n    groups: {},\r\n    addParent(node, edge) {\r\n      parents.push([node, edge]);\r\n    },\r\n    newSibling() {\r\n      return makeNode(parents.slice());\r\n    },\r\n    dfWalk({visit, follow = () => true, visited = new Set(), inEdge} = {}) {\r\n      let res;\r\n      if (!visited.has(this)) {\r\n        visited.add(this);\r\n        res = visit(inEdge, this);\r\n        if (res != null) return res;\r\n        for (const [parent, outEdge] of parents) {\r\n          if (follow(inEdge, outEdge)) {\r\n            res = parent.dfWalk({visit, follow, visited, inEdge: outEdge});\r\n            if (res != null) return res;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nconst nullMetrics = (() => {\r\n  const nop = function () {};\r\n  const empty = () => ({});\r\n  const none = {forEach: nop};\r\n  const nullTimer = () => null;\r\n  nullTimer.stopBefore = (fn) => fn;\r\n  nullTimer.stopAfter = (fn) => fn;\r\n  const nullNode = Object.defineProperties(\r\n    {dfWalk: nop, newSibling: () => nullNode, addParent: nop},\r\n    Object.fromEntries(['metrics', 'timestamps', 'groups'].map(prop => [prop, {get: empty}])));\r\n  return metricsFactory({\r\n    now: () => 0,\r\n    mkNode: () => nullNode,\r\n    mkRenamer: () => () => none,\r\n    mkTimer: () => nullTimer,\r\n    nodes: {get: nop, set: nop}\r\n  })();\r\n})();\r\n\r\nlet enabled = true;\r\nconfig.getConfig(CONFIG_TOGGLE, (cfg) => { enabled = !!cfg[CONFIG_TOGGLE] });\r\n\r\n/**\r\n * convenience fallback function for metrics that may be undefined, especially during tests.\r\n */\r\nexport function useMetrics(metrics) {\r\n  return (enabled && metrics) || nullMetrics;\r\n}\r\n\r\nexport const newMetrics = (() => {\r\n  const makeMetrics = metricsFactory();\r\n  return function () {\r\n    return enabled ? makeMetrics() : nullMetrics;\r\n  }\r\n})();\r\n\r\nexport function hookTimer(prefix, getMetrics) {\r\n  return function(name, hookFn) {\r\n    return function (next, ...args) {\r\n      const that = this;\r\n      return useMetrics(getMetrics.apply(that, args)).measureHookTime(prefix + name, next, function (next) {\r\n        return hookFn.call(that, next, ...args);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport const timedAuctionHook = hookTimer('requestBids.', (req) => req.metrics);\r\nexport const timedBidResponseHook = hookTimer('addBidResponse.', (_, bid) => bid.metrics)\r\n","import {getGlobal} from '../prebidGlobal.js';\r\n\r\nconst SUCCESS = 0;\r\nconst FAIL = 1;\r\n\r\n/**\r\n * A version of Promise that runs callbacks synchronously when it can (i.e. after it's been fulfilled or rejected).\r\n */\r\nexport class GreedyPromise extends (getGlobal().Promise || Promise) {\r\n  #result;\r\n  #callbacks;\r\n  #parent = null;\r\n\r\n  /**\r\n   * Convenience wrapper for setTimeout; takes care of returning an already fulfilled GreedyPromise when the delay is zero.\r\n   *\r\n   * @param {Number} delayMs delay in milliseconds\r\n   * @returns {GreedyPromise} a promise that resolves (to undefined) in `delayMs` milliseconds\r\n   */\r\n  static timeout(delayMs = 0) {\r\n    return new GreedyPromise((resolve) => {\r\n      delayMs === 0 ? resolve() : setTimeout(resolve, delayMs);\r\n    });\r\n  }\r\n\r\n  constructor(resolver) {\r\n    const result = [];\r\n    const callbacks = [];\r\n    function handler(type, resolveFn) {\r\n      return function (value) {\r\n        if (!result.length) {\r\n          result.push(type, value);\r\n          while (callbacks.length) callbacks.shift()();\r\n          resolveFn(value);\r\n        }\r\n      }\r\n    }\r\n    super(\r\n      typeof resolver !== 'function'\r\n        ? resolver // let super throw an error\r\n        : (resolve, reject) => {\r\n          const rejectHandler = handler(FAIL, reject);\r\n          const resolveHandler = (() => {\r\n            const done = handler(SUCCESS, resolve);\r\n            return value =>\r\n              typeof value?.then === 'function' ? value.then(done, rejectHandler) : done(value);\r\n          })();\r\n          try {\r\n            resolver(resolveHandler, rejectHandler);\r\n          } catch (e) {\r\n            rejectHandler(e);\r\n          }\r\n        }\r\n    );\r\n    this.#result = result;\r\n    this.#callbacks = callbacks;\r\n  }\r\n  then(onSuccess, onError) {\r\n    if (typeof onError === 'function') {\r\n      // if an error handler is provided, attach a dummy error handler to super,\r\n      // and do the same for all promises without an error handler that precede this one in a chain.\r\n      // This is to avoid unhandled rejection events / warnings for errors that were, in fact, handled;\r\n      // since we are not using super's callback mechanisms we need to make it aware of this separately.\r\n      let node = this;\r\n      while (node) {\r\n        super.then.call(node, null, () => null);\r\n        const next = node.#parent;\r\n        node.#parent = null; // since we attached a handler already, we are no longer interested in what will happen later in the chain\r\n        node = next;\r\n      }\r\n    }\r\n    const result = this.#result;\r\n    const res = new GreedyPromise((resolve, reject) => {\r\n      const continuation = () => {\r\n        let value = result[1];\r\n        let [handler, resolveFn] = result[0] === SUCCESS ? [onSuccess, resolve] : [onError, reject];\r\n        if (typeof handler === 'function') {\r\n          try {\r\n            value = handler(value);\r\n          } catch (e) {\r\n            reject(e);\r\n            return;\r\n          }\r\n          resolveFn = resolve;\r\n        }\r\n        resolveFn(value);\r\n      }\r\n      result.length ? continuation() : this.#callbacks.push(continuation);\r\n    });\r\n    res.#parent = this;\r\n    return res;\r\n  }\r\n}\r\n\r\n/**\r\n * @returns a {promise, resolve, reject} trio where `promise` is resolved by calling `resolve` or `reject`.\r\n */\r\nexport function defer({promiseFactory = (resolver) => new GreedyPromise(resolver)} = {}) {\r\n  function invoker(delegate) {\r\n    return (val) => delegate(val);\r\n  }\r\n\r\n  let resolveFn, rejectFn;\r\n\r\n  return {\r\n    promise: promiseFactory((resolve, reject) => {\r\n      resolveFn = resolve;\r\n      rejectFn = reject;\r\n    }),\r\n    resolve: invoker(resolveFn),\r\n    reject: invoker(rejectFn)\r\n  }\r\n}\r\n","import adapterManager from './adapterManager.js';\r\nimport { deepAccess, logError } from './utils.js';\r\nimport { config } from '../src/config.js';\r\nimport {includes} from './polyfill.js';\r\nimport { hook } from './hook.js';\r\nimport {auctionManager} from './auctionManager.js';\r\n\r\nconst VIDEO_MEDIA_TYPE = 'video';\r\nexport const OUTSTREAM = 'outstream';\r\nexport const INSTREAM = 'instream';\r\n\r\n/**\r\n * Helper functions for working with video-enabled adUnits\r\n */\r\nexport const videoAdUnit = adUnit => {\r\n  const mediaType = adUnit.mediaType === VIDEO_MEDIA_TYPE;\r\n  const mediaTypes = deepAccess(adUnit, 'mediaTypes.video');\r\n  return mediaType || mediaTypes;\r\n};\r\nexport const videoBidder = bid => includes(adapterManager.videoAdapters, bid.bidder);\r\nexport const hasNonVideoBidder = adUnit =>\r\n  adUnit.bids.filter(bid => !videoBidder(bid)).length;\r\n\r\n/**\r\n * @typedef {object} VideoBid\r\n * @property {string} adId id of the bid\r\n */\r\n\r\n/**\r\n * Validate that the assets required for video context are present on the bid\r\n * @param {VideoBid} bid Video bid to validate\r\n * @param index\r\n * @return {Boolean} If object is valid\r\n */\r\nexport function isValidVideoBid(bid, {index = auctionManager.index} = {}) {\r\n  const videoMediaType = deepAccess(index.getMediaTypes(bid), 'video');\r\n  const context = videoMediaType && deepAccess(videoMediaType, 'context');\r\n  const useCacheKey = videoMediaType && deepAccess(videoMediaType, 'useCacheKey');\r\n  const adUnit = index.getAdUnit(bid);\r\n\r\n  // if context not defined assume default 'instream' for video bids\r\n  // instream bids require a vast url or vast xml content\r\n  return checkVideoBidSetup(bid, adUnit, videoMediaType, context, useCacheKey);\r\n}\r\n\r\nexport const checkVideoBidSetup = hook('sync', function(bid, adUnit, videoMediaType, context, useCacheKey) {\r\n  if (videoMediaType && (useCacheKey || context !== OUTSTREAM)) {\r\n    // xml-only video bids require a prebid cache url\r\n    if (!config.getConfig('cache.url') && bid.vastXml && !bid.vastUrl) {\r\n      logError(`\r\n        This bid contains only vastXml and will not work when a prebid cache url is not specified.\r\n        Try enabling prebid cache with $$PREBID_GLOBAL$$.setConfig({ cache: {url: \"...\"} });\r\n      `);\r\n      return false;\r\n    }\r\n\r\n    return !!(bid.vastUrl || bid.vastXml);\r\n  }\r\n\r\n  // outstream bids require a renderer on the bid or pub-defined on adunit\r\n  if (context === OUTSTREAM && !useCacheKey) {\r\n    return !!(bid.renderer || (adUnit && adUnit.renderer) || videoMediaType.renderer);\r\n  }\r\n\r\n  return true;\r\n}, 'checkVideoBidSetup');\r\n","/**\r\n * This module interacts with the server used to cache video ad content to be restored later.\r\n * At a high level, the expected workflow goes like this:\r\n *\r\n *   - Request video ads from Bidders\r\n *   - Generate IDs for each valid bid, and cache the key/value pair on the server.\r\n *   - Return these IDs so that publishers can use them to fetch the bids later.\r\n *\r\n * This trickery helps integrate with ad servers, which set character limits on request params.\r\n */\r\n\r\nimport { ajax } from './ajax.js';\r\nimport { config } from './config.js';\r\nimport {auctionManager} from './auctionManager.js';\r\n\r\n/**\r\n * Might be useful to be configurable in the future\r\n * Depending on publisher needs\r\n */\r\nconst ttlBufferInSeconds = 15;\r\n\r\n/**\r\n * @typedef {object} CacheableUrlBid\r\n * @property {string} vastUrl A URL which loads some valid VAST XML.\r\n */\r\n\r\n/**\r\n * @typedef {object} CacheablePayloadBid\r\n * @property {string} vastXml Some VAST XML which loads an ad in a video player.\r\n */\r\n\r\n/**\r\n * A CacheableBid describes the types which the videoCache can store.\r\n *\r\n * @typedef {CacheableUrlBid|CacheablePayloadBid} CacheableBid\r\n */\r\n\r\n/**\r\n * Function which wraps a URI that serves VAST XML, so that it can be loaded.\r\n *\r\n * @param {string} uri The URI where the VAST content can be found.\r\n * @param {string} impUrl An impression tracker URL for the delivery of the video ad\r\n * @return A VAST URL which loads XML from the given URI.\r\n */\r\nfunction wrapURI(uri, impUrl) {\r\n  // Technically, this is vulnerable to cross-script injection by sketchy vastUrl bids.\r\n  // We could make sure it's a valid URI... but since we're loading VAST XML from the\r\n  // URL they provide anyway, that's probably not a big deal.\r\n  let vastImp = (impUrl) ? `<![CDATA[${impUrl}]]>` : ``;\r\n  return `<VAST version=\"3.0\">\r\n    <Ad>\r\n      <Wrapper>\r\n        <AdSystem>prebid.org wrapper</AdSystem>\r\n        <VASTAdTagURI><![CDATA[${uri}]]></VASTAdTagURI>\r\n        <Impression>${vastImp}</Impression>\r\n        <Creatives></Creatives>\r\n      </Wrapper>\r\n    </Ad>\r\n  </VAST>`;\r\n}\r\n\r\n/**\r\n * Wraps a bid in the format expected by the prebid-server endpoints, or returns null if\r\n * the bid can't be converted cleanly.\r\n *\r\n * @param {CacheableBid} bid\r\n * @param index\r\n */\r\nfunction toStorageRequest(bid, {index = auctionManager.index} = {}) {\r\n  const vastValue = bid.vastXml ? bid.vastXml : wrapURI(bid.vastUrl, bid.vastImpUrl);\r\n  const auction = index.getAuction(bid);\r\n  const ttlWithBuffer = Number(bid.ttl) + ttlBufferInSeconds;\r\n  let payload = {\r\n    type: 'xml',\r\n    value: vastValue,\r\n    ttlseconds: ttlWithBuffer\r\n  };\r\n\r\n  if (config.getConfig('cache.vasttrack')) {\r\n    payload.bidder = bid.bidder;\r\n    payload.bidid = bid.requestId;\r\n    payload.aid = bid.auctionId;\r\n  }\r\n\r\n  if (auction != null) {\r\n    payload.timestamp = auction.getAuctionStart();\r\n  }\r\n\r\n  if (typeof bid.customCacheKey === 'string' && bid.customCacheKey !== '') {\r\n    payload.key = bid.customCacheKey;\r\n  }\r\n\r\n  return payload;\r\n}\r\n\r\n/**\r\n * A function which should be called with the results of the storage operation.\r\n *\r\n * @callback videoCacheStoreCallback\r\n *\r\n * @param {Error} [error] The error, if one occurred.\r\n * @param {?string[]} uuids An array of unique IDs. The array will have one element for each bid we were asked\r\n *   to store. It may include null elements if some of the bids were malformed, or an error occurred.\r\n *   Each non-null element in this array is a valid input into the retrieve function, which will fetch\r\n *   some VAST XML which can be used to render this bid's ad.\r\n */\r\n\r\n/**\r\n * A function which bridges the APIs between the videoCacheStoreCallback and our ajax function's API.\r\n *\r\n * @param {videoCacheStoreCallback} done A callback to the \"store\" function.\r\n * @return {Function} A callback which interprets the cache server's responses, and makes up the right\r\n *   arguments for our callback.\r\n */\r\nfunction shimStorageCallback(done) {\r\n  return {\r\n    success: function (responseBody) {\r\n      let ids;\r\n      try {\r\n        ids = JSON.parse(responseBody).responses\r\n      } catch (e) {\r\n        done(e, []);\r\n        return;\r\n      }\r\n\r\n      if (ids) {\r\n        done(null, ids);\r\n      } else {\r\n        done(new Error(\"The cache server didn't respond with a responses property.\"), []);\r\n      }\r\n    },\r\n    error: function (statusText, responseBody) {\r\n      done(new Error(`Error storing video ad in the cache: ${statusText}: ${JSON.stringify(responseBody)}`), []);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * If the given bid is for a Video ad, generate a unique ID and cache it somewhere server-side.\r\n *\r\n * @param {CacheableBid[]} bids A list of bid objects which should be cached.\r\n * @param {videoCacheStoreCallback} [done] An optional callback which should be executed after\r\n * the data has been stored in the cache.\r\n */\r\nexport function store(bids, done) {\r\n  const requestData = {\r\n    puts: bids.map(toStorageRequest)\r\n  };\r\n\r\n  ajax(config.getConfig('cache.url'), shimStorageCallback(done), JSON.stringify(requestData), {\r\n    contentType: 'text/plain',\r\n    withCredentials: true\r\n  });\r\n}\r\n\r\nexport function getCacheUrl(id) {\r\n  return `${config.getConfig('cache.url')}?uuid=${id}`;\r\n}\r\n","export default function dlv(obj, key, def, p, undef) {\n\tkey = key.split ? key.split('.') : key;\n\tfor (p = 0; p < key.length; p++) {\n\t\tobj = obj ? obj[key[p]] : undef;\n\t}\n\treturn obj === undef ? def : obj;\n}\n","/*\n* @license MIT\n* Fun Hooks v0.9.10\n* (c) @snapwich\n*/\ncreate.SYNC = 1;\ncreate.ASYNC = 2;\ncreate.QUEUE = 4;\n\nvar packageName = \"fun-hooks\";\n\nfunction hasProxy() {\n  return !!(typeof Proxy === \"function\" && Proxy.revocable);\n}\n\nvar defaults = Object.freeze({\n  useProxy: true,\n  ready: 0\n});\n\nvar hookableMap = new WeakMap();\n\n// detect incorrectly implemented reduce and if found use polyfill\n// https://github.com/prebid/Prebid.js/issues/3576\n// polyfill from: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce\nvar reduce =\n  [1]\n    .reduce(function(a, b, c) {\n      return [a, b, c];\n    }, 2)\n    .toString() === \"2,1,0\"\n    ? Array.prototype.reduce\n    : function(callback, initial) {\n        var o = Object(this);\n        var len = o.length >>> 0;\n        var k = 0;\n        var value;\n        if (initial) {\n          value = initial;\n        } else {\n          while (k < len && !(k in o)) {\n            k++;\n          }\n          value = o[k++];\n        }\n        while (k < len) {\n          if (k in o) {\n            value = callback(value, o[k], k, o);\n          }\n          k++;\n        }\n        return value;\n      };\n\nfunction rest(args, skip) {\n  return Array.prototype.slice.call(args, skip);\n}\n\nvar assign =\n  Object.assign ||\n  function assign(target) {\n    return reduce.call(\n      rest(arguments, 1),\n      function(target, obj) {\n        if (obj) {\n          Object.keys(obj).forEach(function(prop) {\n            target[prop] = obj[prop];\n          });\n        }\n        return target;\n      },\n      target\n    );\n  };\n\nfunction runAll(queue) {\n  var queued;\n  // eslint-disable-next-line no-cond-assign\n  while ((queued = queue.shift())) {\n    queued();\n  }\n}\n\nfunction create(config) {\n  var hooks = {};\n  var postReady = [];\n\n  config = assign({}, defaults, config);\n\n  function dispatch(arg1, arg2) {\n    if (typeof arg1 === \"function\") {\n      return hookFn.call(null, \"sync\", arg1, arg2);\n    } else if (typeof arg1 === \"string\" && typeof arg2 === \"function\") {\n      return hookFn.apply(null, arguments);\n    } else if (typeof arg1 === \"object\") {\n      return hookObj.apply(null, arguments);\n    }\n  }\n\n  var ready;\n  if (config.ready) {\n    dispatch.ready = function() {\n      ready = true;\n      runAll(postReady);\n    };\n  } else {\n    ready = true;\n  }\n\n  function hookObj(obj, props, objName) {\n    var walk = true;\n    if (typeof props === \"undefined\") {\n      props = Object.getOwnPropertyNames(obj);\n      walk = false;\n    }\n    var objHooks = {};\n    var doNotHook = [\"constructor\"];\n    do {\n      props = props.filter(function(prop) {\n        return (\n          typeof obj[prop] === \"function\" &&\n          !(doNotHook.indexOf(prop) !== -1) &&\n          !prop.match(/^_/)\n        );\n      });\n      props.forEach(function(prop) {\n        var parts = prop.split(\":\");\n        var name = parts[0];\n        var type = parts[1] || \"sync\";\n        if (!objHooks[name]) {\n          var fn = obj[name];\n          objHooks[name] = obj[name] = hookFn(\n            type,\n            fn,\n            objName ? [objName, name] : undefined\n          );\n        }\n      });\n      obj = Object.getPrototypeOf(obj);\n    } while (walk && obj);\n    return objHooks;\n  }\n\n  /**\n   * Navigates a string path to return a hookable function.  If not found, creates a placeholder for hooks.\n   * @param {(Array<string> | string)} path\n   */\n  function get(path) {\n    var parts = Array.isArray(path) ? path : path.split(\".\");\n    return reduce.call(\n      parts,\n      function(memo, part, i) {\n        var item = memo[part];\n        var installed = false;\n        if (item) {\n          return item;\n        } else if (i === parts.length - 1) {\n          if (!ready) {\n            postReady.push(function() {\n              if (!installed) {\n                // eslint-disable-next-line no-console\n                console.warn(\n                  packageName +\n                    \": referenced '\" +\n                    path +\n                    \"' but it was never created\"\n                );\n              }\n            });\n          }\n          return (memo[part] = newHookable(function(fn) {\n            memo[part] = fn;\n            installed = true;\n          }));\n        }\n        return (memo[part] = {});\n      },\n      hooks\n    );\n  }\n\n  function newHookable(onInstall) {\n    var before = [];\n    var after = [];\n    var generateTrap = function() {};\n\n    var api = {\n      before: function(hook, priority) {\n        return add.call(this, before, \"before\", hook, priority);\n      },\n      after: function(hook, priority) {\n        return add.call(this, after, \"after\", hook, priority);\n      },\n      getHooks: function(match) {\n        var hooks = before.concat(after);\n        if (typeof match === \"object\") {\n          hooks = hooks.filter(function(entry) {\n            return Object.keys(match).every(function(prop) {\n              return entry[prop] === match[prop];\n            });\n          });\n        }\n        try {\n          assign(hooks, {\n            remove: function() {\n              hooks.forEach(function(entry) {\n                entry.remove();\n              });\n              return this;\n            }\n          });\n        } catch (e) {\n          console.error(\n            \"error adding `remove` to array, did you modify Array.prototype?\"\n          );\n        }\n        return hooks;\n      },\n      removeAll: function() {\n        return this.getHooks().remove();\n      }\n    };\n\n    var meta = {\n      install: function(type, fn, generate) {\n        this.type = type;\n        generateTrap = generate;\n        generate(before, after);\n        onInstall && onInstall(fn);\n      }\n    };\n\n    // store meta data related to hookable. use `api.after` since `api` reference is not available on our proxy.\n    hookableMap.set(api.after, meta);\n\n    return api;\n\n    function add(store, type, hook, priority) {\n      var entry = {\n        hook: hook,\n        type: type,\n        priority: priority || 10,\n        remove: function() {\n          var index = store.indexOf(entry);\n          if (index !== -1) {\n            store.splice(index, 1);\n            generateTrap(before, after);\n          }\n        }\n      };\n      store.push(entry);\n      store.sort(function(a, b) {\n        return b.priority - a.priority;\n      });\n      generateTrap(before, after);\n      return this;\n    }\n  }\n\n  function hookFn(type, fn, name) {\n    // check if function has already been wrapped\n    var meta = fn.after && hookableMap.get(fn.after);\n    if (meta) {\n      if (meta.type !== type) {\n        throw packageName + \": recreated hookable with different type\";\n      } else {\n        return fn;\n      }\n    }\n\n    var hookable = name ? get(name) : newHookable();\n\n    var trap;\n    var hookedFn;\n    var handlers = {\n      get: function(target, prop) {\n        return hookable[prop] || Reflect.get.apply(Reflect, arguments);\n      }\n    };\n\n    if (!ready) {\n      postReady.push(setTrap);\n    }\n\n    if (config.useProxy && hasProxy()) {\n      hookedFn = new Proxy(fn, handlers);\n    } else {\n      hookedFn = function() {\n        return handlers.apply\n          ? handlers.apply(fn, this, rest(arguments))\n          : fn.apply(this, arguments);\n      };\n      assign(hookedFn, hookable);\n    }\n\n    hookableMap.get(hookedFn.after).install(type, hookedFn, generateTrap);\n\n    return hookedFn;\n\n    // eslint-disable-next-line no-redeclare\n    function generateTrap(before, after) {\n      var order = [];\n      var targetIndex;\n      if (before.length || after.length) {\n        before.forEach(addToOrder);\n        // placeholder for target function wrapper\n        targetIndex = order.push(undefined) - 1;\n        after.forEach(addToOrder);\n        trap = function(target, thisArg, args) {\n          var curr = 0;\n          var result;\n          var callback =\n            type === \"async\" &&\n            typeof args[args.length - 1] === \"function\" &&\n            args.pop();\n          function bail(value) {\n            if (type === \"sync\") {\n              result = value;\n            } else if (callback) {\n              callback.apply(null, arguments);\n            }\n          }\n          function next(value) {\n            if (order[curr]) {\n              var args = rest(arguments);\n              next.bail = bail;\n              args.unshift(next);\n              return order[curr++].apply(thisArg, args);\n            }\n            if (type === \"sync\") {\n              result = value;\n            } else if (callback) {\n              callback.apply(null, arguments);\n            }\n          }\n          order[targetIndex] = function() {\n            var args = rest(arguments, 1);\n            if (type === \"async\" && callback) {\n              delete next.bail;\n              args.push(next);\n            }\n            var result = target.apply(thisArg, args);\n            if (type === \"sync\") {\n              next(result);\n            }\n          };\n          next.apply(null, args);\n          return result;\n        };\n      } else {\n        trap = undefined;\n      }\n      setTrap();\n\n      function addToOrder(entry) {\n        order.push(entry.hook);\n      }\n    }\n\n    function setTrap() {\n      if (\n        ready ||\n        (type === \"sync\" && !(config.ready & create.SYNC)) ||\n        (type === \"async\" && !(config.ready & create.ASYNC))\n      ) {\n        handlers.apply = trap;\n      } else if (type === \"sync\" || !(config.ready & create.QUEUE)) {\n        handlers.apply = function() {\n          throw packageName + \": hooked function not ready\";\n        };\n      } else {\n        handlers.apply = function() {\n          var args = arguments;\n          postReady.push(function() {\n            hookedFn.apply(args[1], args[2]);\n          });\n        };\n      }\n    }\n  }\n\n  dispatch.get = get;\n  return dispatch;\n}\n\n/* global module */\nmodule.exports = create;\n","module.exports = clone;\n\n/*\n  Identical to `just-extend(true, {}, obj1)`\n\n  var arr = [1, 2, 3];\n  var subObj = {aa: 1};\n  var obj = {a: 3, b: 5, c: arr, d: subObj};\n  var objClone = clone(obj);\n  arr.push(4);\n  subObj.bb = 2;\n  obj; // {a: 3, b: 5, c: [1, 2, 3, 4], d: {aa: 1}}  \n  objClone; // {a: 3, b: 5, c: [1, 2, 3], d: {aa: 1, bb: 2}}\n*/\n\nfunction clone(obj) {\n  var result = Array.isArray(obj) ? [] : {};\n  for (var key in obj) {\n    // include prototype properties\n    var value = obj[key];\n    if (value && typeof value == 'object') {\n      result[key] = clone(value);\n    } else {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _classApplyDescriptorGet(receiver, descriptor) {\n  if (descriptor.get) {\n    return descriptor.get.call(receiver);\n  }\n\n  return descriptor.value;\n}","export default function _classApplyDescriptorSet(receiver, descriptor, value) {\n  if (descriptor.set) {\n    descriptor.set.call(receiver, value);\n  } else {\n    if (!descriptor.writable) {\n      throw new TypeError(\"attempted to set read only private field\");\n    }\n\n    descriptor.value = value;\n  }\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default function _classExtractFieldDescriptor(receiver, privateMap, action) {\n  if (!privateMap.has(receiver)) {\n    throw new TypeError(\"attempted to \" + action + \" private field on non-instance\");\n  }\n\n  return privateMap.get(receiver);\n}","import classApplyDescriptorGet from \"./classApplyDescriptorGet.js\";\nimport classExtractFieldDescriptor from \"./classExtractFieldDescriptor.js\";\nexport default function _classPrivateFieldGet(receiver, privateMap) {\n  var descriptor = classExtractFieldDescriptor(receiver, privateMap, \"get\");\n  return classApplyDescriptorGet(receiver, descriptor);\n}","import classApplyDescriptorSet from \"./classApplyDescriptorSet.js\";\nimport classExtractFieldDescriptor from \"./classExtractFieldDescriptor.js\";\nexport default function _classPrivateFieldSet(receiver, privateMap, value) {\n  var descriptor = classExtractFieldDescriptor(receiver, privateMap, \"set\");\n  classApplyDescriptorSet(receiver, descriptor, value);\n  return value;\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import superPropBase from \"./superPropBase.js\";\nexport default function _get() {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get.bind();\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(arguments.length < 3 ? target : receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get.apply(this, arguments);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nexport default function _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export function dset(obj, keys, val) {\n\tkeys.split && (keys=keys.split('.'));\n\tvar i=0, l=keys.length, t=obj, x, k;\n\twhile (i < l) {\n\t\tk = keys[i++];\n\t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n\t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n\t}\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"prebid-core\": 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = function(chunkId) { return installedChunks[chunkId] === 0; };\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some(function(id) { return installedChunks[id] !== 0; })) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"pbjsChunk\"] = self[\"pbjsChunk\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./src/prebid.js\");\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n","import CONSTANTS from '../../src/constants.json';\r\nimport { ajax } from '../../src/ajax.js';\r\nimport { logMessage, _each } from '../../src/utils.js';\r\nimport * as events from '../../src/events.js'\r\n\r\nexport const _internal = {\r\n  ajax\r\n};\r\n\r\nconst {\r\n  EVENTS: {\r\n    AUCTION_INIT,\r\n    AUCTION_END,\r\n    REQUEST_BIDS,\r\n    BID_REQUESTED,\r\n    BID_TIMEOUT,\r\n    BID_RESPONSE,\r\n    NO_BID,\r\n    BID_WON,\r\n    BID_ADJUSTMENT,\r\n    BIDDER_DONE,\r\n    SET_TARGETING,\r\n    AD_RENDER_FAILED,\r\n    AD_RENDER_SUCCEEDED,\r\n    AUCTION_DEBUG,\r\n    ADD_AD_UNITS,\r\n    BILLABLE_EVENT\r\n  }\r\n} = CONSTANTS;\r\n\r\nconst ENDPOINT = 'endpoint';\r\nconst BUNDLE = 'bundle';\r\n\r\nexport default function AnalyticsAdapter({ url, analyticsType, global, handler }) {\r\n  const _queue = [];\r\n  let _eventCount = 0;\r\n  let _enableCheck = true;\r\n  let _handlers;\r\n  let _enabled = false;\r\n  let _sampled = true;\r\n\r\n  if (analyticsType === ENDPOINT || BUNDLE) {\r\n    _emptyQueue();\r\n  }\r\n\r\n  return Object.defineProperties({\r\n    track: _track,\r\n    enqueue: _enqueue,\r\n    enableAnalytics: _enable,\r\n    disableAnalytics: _disable,\r\n    getAdapterType: () => analyticsType,\r\n    getGlobal: () => global,\r\n    getHandler: () => handler,\r\n    getUrl: () => url\r\n  }, {\r\n    enabled: {\r\n      get: () => _enabled\r\n    }\r\n  });\r\n\r\n  function _track({ eventType, args }) {\r\n    if (this.getAdapterType() === BUNDLE) {\r\n      window[global](handler, eventType, args);\r\n    }\r\n\r\n    if (this.getAdapterType() === ENDPOINT) {\r\n      _callEndpoint(...arguments);\r\n    }\r\n  }\r\n\r\n  function _callEndpoint({ eventType, args, callback }) {\r\n    _internal.ajax(url, callback, JSON.stringify({ eventType, args }));\r\n  }\r\n\r\n  function _enqueue({ eventType, args }) {\r\n    const _this = this;\r\n\r\n    if (global && window[global] && eventType && args) {\r\n      this.track({ eventType, args });\r\n    } else {\r\n      _queue.push(function () {\r\n        _eventCount++;\r\n        _this.track({ eventType, args });\r\n      });\r\n    }\r\n  }\r\n\r\n  function _enable(config) {\r\n    var _this = this;\r\n\r\n    if (typeof config === 'object' && typeof config.options === 'object') {\r\n      _sampled = typeof config.options.sampling === 'undefined' || Math.random() < parseFloat(config.options.sampling);\r\n    } else {\r\n      _sampled = true;\r\n    }\r\n\r\n    if (_sampled) {\r\n      // first send all events fired before enableAnalytics called\r\n      events.getEvents().forEach(event => {\r\n        if (!event) {\r\n          return;\r\n        }\r\n\r\n        const { eventType, args } = event;\r\n\r\n        if (eventType !== BID_TIMEOUT) {\r\n          _enqueue.call(_this, { eventType, args });\r\n        }\r\n      });\r\n\r\n      // Next register event listeners to send data immediately\r\n\r\n      _handlers = {\r\n        [REQUEST_BIDS]: args => this.enqueue({ eventType: REQUEST_BIDS, args }),\r\n        [BID_REQUESTED]: args => this.enqueue({ eventType: BID_REQUESTED, args }),\r\n        [BID_RESPONSE]: args => this.enqueue({ eventType: BID_RESPONSE, args }),\r\n        [NO_BID]: args => this.enqueue({ eventType: NO_BID, args }),\r\n        [BID_TIMEOUT]: args => this.enqueue({ eventType: BID_TIMEOUT, args }),\r\n        [BID_WON]: args => this.enqueue({ eventType: BID_WON, args }),\r\n        [BID_ADJUSTMENT]: args => this.enqueue({ eventType: BID_ADJUSTMENT, args }),\r\n        [BIDDER_DONE]: args => this.enqueue({ eventType: BIDDER_DONE, args }),\r\n        [SET_TARGETING]: args => this.enqueue({ eventType: SET_TARGETING, args }),\r\n        [AUCTION_END]: args => this.enqueue({ eventType: AUCTION_END, args }),\r\n        [AD_RENDER_FAILED]: args => this.enqueue({ eventType: AD_RENDER_FAILED, args }),\r\n        [AD_RENDER_SUCCEEDED]: args => this.enqueue({ eventType: AD_RENDER_SUCCEEDED, args }),\r\n        [AUCTION_DEBUG]: args => this.enqueue({ eventType: AUCTION_DEBUG, args }),\r\n        [ADD_AD_UNITS]: args => this.enqueue({ eventType: ADD_AD_UNITS, args }),\r\n        [BILLABLE_EVENT]: args => this.enqueue({ eventType: BILLABLE_EVENT, args }),\r\n        [AUCTION_INIT]: args => {\r\n          args.config = typeof config === 'object' ? config.options || {} : {}; // enableAnaltyics configuration object\r\n          this.enqueue({ eventType: AUCTION_INIT, args });\r\n        }\r\n      };\r\n\r\n      _each(_handlers, (handler, event) => {\r\n        events.on(event, handler);\r\n      });\r\n    } else {\r\n      logMessage(`Analytics adapter for \"${global}\" disabled by sampling`);\r\n    }\r\n\r\n    // finally set this function to return log message, prevents multiple adapter listeners\r\n    this._oldEnable = this.enableAnalytics;\r\n    this.enableAnalytics = function _enable() {\r\n      return logMessage(`Analytics adapter for \"${global}\" already enabled, unnecessary call to \\`enableAnalytics\\`.`);\r\n    };\r\n    _enabled = true;\r\n  }\r\n\r\n  function _disable() {\r\n    _each(_handlers, (handler, event) => {\r\n      events.off(event, handler);\r\n    });\r\n    this.enableAnalytics = this._oldEnable ? this._oldEnable : _enable;\r\n    _enabled = false;\r\n  }\r\n\r\n  function _emptyQueue() {\r\n    if (_enableCheck) {\r\n      for (var i = 0; i < _queue.length; i++) {\r\n        _queue[i]();\r\n      }\r\n\r\n      // override push to execute the command immediately from now on\r\n      _queue.push = function (fn) {\r\n        fn();\r\n      };\r\n\r\n      _enableCheck = false;\r\n    }\r\n\r\n    logMessage(`event count sent to ${global}: ${_eventCount}`);\r\n  }\r\n}\r\n","/**\r\n * This module houses the functionality to evaluate and process adpod adunits/bids.  Specifically there are several hooked functions,\r\n * that either supplement the base function (ie to check something additional or unique to adpod objects) or to replace the base function\r\n * entirely when appropriate.\r\n *\r\n * Brief outline of each hook:\r\n * - `callPrebidCacheHook` - for any adpod bids, this function will temporarily hold them in a queue in order to send the bids to Prebid Cache in bulk\r\n * - `checkAdUnitSetupHook` - evaluates the adUnits to ensure that required fields for adpod adUnits are present.  Invalid adpod adUntis are removed from the array.\r\n * - `checkVideoBidSetupHook` - evaluates the adpod bid returned from an adaptor/bidder to ensure required fields are populated; also initializes duration bucket field.\r\n *\r\n * To initialize the module, there is an `initAdpodHooks()` function that should be imported and executed by a corresponding `...AdServerVideo`\r\n * module that designed to support adpod video type ads.  This import process allows this module to effectively act as a sub-module.\r\n */\r\n\r\nimport {\r\n  compareOn,\r\n  deepAccess,\r\n  generateUUID,\r\n  groupBy,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  logInfo,\r\n  logWarn\r\n} from '../src/utils.js';\r\nimport {\r\n  addBidToAuction,\r\n  AUCTION_IN_PROGRESS,\r\n  callPrebidCache,\r\n  doCallbacksIfTimedout,\r\n  getPriceByGranularity,\r\n  getPriceGranularity\r\n} from '../src/auction.js';\r\nimport {checkAdUnitSetup} from '../src/prebid.js';\r\nimport {checkVideoBidSetup} from '../src/video.js';\r\nimport {module, setupBeforeHookFnOnce} from '../src/hook.js';\r\nimport {store} from '../src/videoCache.js';\r\nimport {config} from '../src/config.js';\r\nimport {ADPOD} from '../src/mediaTypes.js';\r\nimport {find, arrayFrom as from} from '../src/polyfill.js';\r\nimport {auctionManager} from '../src/auctionManager.js';\r\nimport CONSTANTS from '../src/constants.json';\r\n\r\nconst TARGETING_KEY_PB_CAT_DUR = 'hb_pb_cat_dur';\r\nconst TARGETING_KEY_CACHE_ID = 'hb_cache_id';\r\n\r\nlet queueTimeDelay = 50;\r\nlet queueSizeLimit = 5;\r\nlet bidCacheRegistry = createBidCacheRegistry();\r\n\r\n/**\r\n * Create a registry object that stores/manages bids while be held in queue for Prebid Cache.\r\n * @returns registry object with defined accessor functions\r\n */\r\nfunction createBidCacheRegistry() {\r\n  let registry = {};\r\n\r\n  function setupRegistrySlot(auctionId) {\r\n    registry[auctionId] = {};\r\n    registry[auctionId].bidStorage = new Set();\r\n    registry[auctionId].queueDispatcher = createDispatcher(queueTimeDelay);\r\n    registry[auctionId].initialCacheKey = generateUUID();\r\n  }\r\n\r\n  return {\r\n    addBid: function (bid) {\r\n      // create parent level object based on auction ID (in case there are concurrent auctions running) to store objects for that auction\r\n      if (!registry[bid.auctionId]) {\r\n        setupRegistrySlot(bid.auctionId);\r\n      }\r\n      registry[bid.auctionId].bidStorage.add(bid);\r\n    },\r\n    removeBid: function (bid) {\r\n      registry[bid.auctionId].bidStorage.delete(bid);\r\n    },\r\n    getBids: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].bidStorage.values();\r\n    },\r\n    getQueueDispatcher: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].queueDispatcher;\r\n    },\r\n    setupInitialCacheKey: function (bid) {\r\n      if (!registry[bid.auctionId]) {\r\n        registry[bid.auctionId] = {};\r\n        registry[bid.auctionId].initialCacheKey = generateUUID();\r\n      }\r\n    },\r\n    getInitialCacheKey: function (bid) {\r\n      return registry[bid.auctionId] && registry[bid.auctionId].initialCacheKey;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Creates a function that when called updates the bid queue and extends the running timer (when called subsequently).\r\n * Once the time threshold for the queue (defined by queueSizeLimit) is reached, the queue will be flushed by calling the `firePrebidCacheCall` function.\r\n * If there is a long enough time between calls (based on timeoutDration), the queue will automatically flush itself.\r\n * @param {Number} timeoutDuration number of milliseconds to pass before timer expires and current bid queue is flushed\r\n * @returns {Function}\r\n */\r\nfunction createDispatcher(timeoutDuration) {\r\n  let timeout;\r\n  let counter = 1;\r\n\r\n  return function (auctionInstance, bidListArr, afterBidAdded, killQueue) {\r\n    const context = this;\r\n\r\n    var callbackFn = function () {\r\n      firePrebidCacheCall.call(context, auctionInstance, bidListArr, afterBidAdded);\r\n    };\r\n\r\n    clearTimeout(timeout);\r\n\r\n    if (!killQueue) {\r\n      // want to fire off the queue if either: size limit is reached or time has passed since last call to dispatcher\r\n      if (counter === queueSizeLimit) {\r\n        counter = 1;\r\n        callbackFn();\r\n      } else {\r\n        counter++;\r\n        timeout = setTimeout(callbackFn, timeoutDuration);\r\n      }\r\n    } else {\r\n      counter = 1;\r\n    }\r\n  };\r\n}\r\n\r\nfunction getPricePartForAdpodKey(bid) {\r\n  let pricePart\r\n  let prioritizeDeals = config.getConfig('adpod.prioritizeDeals');\r\n  if (prioritizeDeals && deepAccess(bid, 'video.dealTier')) {\r\n    const adpodDealPrefix = config.getConfig(`adpod.dealTier.${bid.bidderCode}.prefix`);\r\n    pricePart = (adpodDealPrefix) ? adpodDealPrefix + deepAccess(bid, 'video.dealTier') : deepAccess(bid, 'video.dealTier');\r\n  } else {\r\n    const granularity = getPriceGranularity(bid);\r\n    pricePart = getPriceByGranularity(granularity)(bid);\r\n  }\r\n  return pricePart\r\n}\r\n\r\n/**\r\n * This function reads certain fields from the bid to generate a specific key used for caching the bid in Prebid Cache\r\n * @param {Object} bid bid object to update\r\n * @param {Boolean} brandCategoryExclusion value read from setConfig; influences whether category is required or not\r\n */\r\nfunction attachPriceIndustryDurationKeyToBid(bid, brandCategoryExclusion) {\r\n  let initialCacheKey = bidCacheRegistry.getInitialCacheKey(bid);\r\n  let duration = deepAccess(bid, 'video.durationBucket');\r\n  const pricePart = getPricePartForAdpodKey(bid);\r\n  let pcd;\r\n\r\n  if (brandCategoryExclusion) {\r\n    let category = deepAccess(bid, 'meta.adServerCatId');\r\n    pcd = `${pricePart}_${category}_${duration}s`;\r\n  } else {\r\n    pcd = `${pricePart}_${duration}s`;\r\n  }\r\n\r\n  if (!bid.adserverTargeting) {\r\n    bid.adserverTargeting = {};\r\n  }\r\n  bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR] = pcd;\r\n  bid.adserverTargeting[TARGETING_KEY_CACHE_ID] = initialCacheKey;\r\n  bid.videoCacheKey = initialCacheKey;\r\n  bid.customCacheKey = `${pcd}_${initialCacheKey}`;\r\n}\r\n\r\n/**\r\n * Updates the running queue for the associated auction.\r\n * Does a check to ensure the auction is still running; if it's not - the previously running queue is killed.\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Object} bidResponse bid object being added to queue\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n */\r\nfunction updateBidQueue(auctionInstance, bidResponse, afterBidAdded) {\r\n  let bidListIter = bidCacheRegistry.getBids(bidResponse);\r\n\r\n  if (bidListIter) {\r\n    let bidListArr = from(bidListIter);\r\n    let callDispatcher = bidCacheRegistry.getQueueDispatcher(bidResponse);\r\n    let killQueue = !!(auctionInstance.getAuctionStatus() !== AUCTION_IN_PROGRESS);\r\n    callDispatcher(auctionInstance, bidListArr, afterBidAdded, killQueue);\r\n  } else {\r\n    logWarn('Attempted to cache a bid from an unknown auction. Bid:', bidResponse);\r\n  }\r\n}\r\n\r\n/**\r\n * Small helper function to remove bids from internal storage; normally b/c they're about to sent to Prebid Cache for processing.\r\n * @param {Array[Object]} bidResponses list of bids to remove\r\n */\r\nfunction removeBidsFromStorage(bidResponses) {\r\n  for (let i = 0; i < bidResponses.length; i++) {\r\n    bidCacheRegistry.removeBid(bidResponses[i]);\r\n  }\r\n}\r\n\r\n/**\r\n * This function will send a list of bids to Prebid Cache.  It also removes the same bids from the internal bidCacheRegistry\r\n * to maintain which bids are in queue.\r\n * If the bids are successfully cached, they will be added to the respective auction.\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Array[Object]} bidList list of bid objects that need to be sent to Prebid Cache\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n */\r\nfunction firePrebidCacheCall(auctionInstance, bidList, afterBidAdded) {\r\n  // remove entries now so other incoming bids won't accidentally have a stale version of the list while PBC is processing the current submitted list\r\n  removeBidsFromStorage(bidList);\r\n\r\n  store(bidList, function (error, cacheIds) {\r\n    if (error) {\r\n      logWarn(`Failed to save to the video cache: ${error}. Video bid(s) must be discarded.`);\r\n      for (let i = 0; i < bidList.length; i++) {\r\n        doCallbacksIfTimedout(auctionInstance, bidList[i]);\r\n      }\r\n    } else {\r\n      for (let i = 0; i < cacheIds.length; i++) {\r\n        // when uuid in response is empty string then the key already existed, so this bid wasn't cached\r\n        if (cacheIds[i].uuid !== '') {\r\n          addBidToAuction(auctionInstance, bidList[i]);\r\n        } else {\r\n          logInfo(`Detected a bid was not cached because the custom key was already registered.  Attempted to use key: ${bidList[i].customCacheKey}. Bid was: `, bidList[i]);\r\n        }\r\n        afterBidAdded();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * This is the main hook function to handle adpod bids; maintains the logic to temporarily hold bids in a queue in order to send bulk requests to Prebid Cache.\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {*} auctionInstance running context of the auction\r\n * @param {Object} bidResponse incoming bid; if adpod, will be processed through hook function.  If not adpod, returns to original function.\r\n * @param {Function} afterBidAdded callback function used when Prebid Cache responds\r\n * @param {Object} videoConfig mediaTypes.video from the bid's adUnit\r\n */\r\nexport function callPrebidCacheHook(fn, auctionInstance, bidResponse, afterBidAdded, videoConfig) {\r\n  if (videoConfig && videoConfig.context === ADPOD) {\r\n    let brandCategoryExclusion = config.getConfig('adpod.brandCategoryExclusion');\r\n    let adServerCatId = deepAccess(bidResponse, 'meta.adServerCatId');\r\n    if (!adServerCatId && brandCategoryExclusion) {\r\n      logWarn('Detected a bid without meta.adServerCatId while setConfig({adpod.brandCategoryExclusion}) was enabled.  This bid has been rejected:', bidResponse);\r\n      afterBidAdded();\r\n    } else {\r\n      if (config.getConfig('adpod.deferCaching') === false) {\r\n        bidCacheRegistry.addBid(bidResponse);\r\n        attachPriceIndustryDurationKeyToBid(bidResponse, brandCategoryExclusion);\r\n\r\n        updateBidQueue(auctionInstance, bidResponse, afterBidAdded);\r\n      } else {\r\n        // generate targeting keys for bid\r\n        bidCacheRegistry.setupInitialCacheKey(bidResponse);\r\n        attachPriceIndustryDurationKeyToBid(bidResponse, brandCategoryExclusion);\r\n\r\n        // add bid to auction\r\n        addBidToAuction(auctionInstance, bidResponse);\r\n        afterBidAdded();\r\n      }\r\n    }\r\n  } else {\r\n    fn.call(this, auctionInstance, bidResponse, afterBidAdded, videoConfig);\r\n  }\r\n}\r\n\r\n/**\r\n * This hook function will review the adUnit setup and verify certain required values are present in any adpod adUnits.\r\n * If the fields are missing or incorrectly setup, the adUnit is removed from the list.\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {Array[Object]} adUnits list of adUnits to be evaluated\r\n * @returns {Array[Object]} list of adUnits that passed the check\r\n */\r\nexport function checkAdUnitSetupHook(fn, adUnits) {\r\n  let goodAdUnits = adUnits.filter(adUnit => {\r\n    let mediaTypes = deepAccess(adUnit, 'mediaTypes');\r\n    let videoConfig = deepAccess(mediaTypes, 'video');\r\n    if (videoConfig && videoConfig.context === ADPOD) {\r\n      // run check to see if other mediaTypes are defined (ie multi-format); reject adUnit if so\r\n      if (Object.keys(mediaTypes).length > 1) {\r\n        logWarn(`Detected more than one mediaType in adUnitCode: ${adUnit.code} while attempting to define an 'adpod' video adUnit.  'adpod' adUnits cannot be mixed with other mediaTypes.  This adUnit will be removed from the auction.`);\r\n        return false;\r\n      }\r\n\r\n      let errMsg = `Detected missing or incorrectly setup fields for an adpod adUnit.  Please review the following fields of adUnitCode: ${adUnit.code}.  This adUnit will be removed from the auction.`;\r\n\r\n      let playerSize = !!(\r\n        (\r\n          videoConfig.playerSize && (\r\n            isArrayOfNums(videoConfig.playerSize, 2) || (\r\n              isArray(videoConfig.playerSize) && videoConfig.playerSize.every(sz => isArrayOfNums(sz, 2))\r\n            )\r\n          )\r\n        ) || (videoConfig.sizeConfig)\r\n      );\r\n      let adPodDurationSec = !!(videoConfig.adPodDurationSec && isNumber(videoConfig.adPodDurationSec) && videoConfig.adPodDurationSec > 0);\r\n      let durationRangeSec = !!(videoConfig.durationRangeSec && isArrayOfNums(videoConfig.durationRangeSec) && videoConfig.durationRangeSec.every(range => range > 0));\r\n\r\n      if (!playerSize || !adPodDurationSec || !durationRangeSec) {\r\n        errMsg += (!playerSize) ? '\\nmediaTypes.video.playerSize' : '';\r\n        errMsg += (!adPodDurationSec) ? '\\nmediaTypes.video.adPodDurationSec' : '';\r\n        errMsg += (!durationRangeSec) ? '\\nmediaTypes.video.durationRangeSec' : '';\r\n        logWarn(errMsg);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  });\r\n  adUnits = goodAdUnits;\r\n  fn.call(this, adUnits);\r\n}\r\n\r\n/**\r\n * This check evaluates the incoming bid's `video.durationSeconds` field and tests it against specific logic depending on adUnit config.  Summary of logic below:\r\n * when adUnit.mediaTypes.video.requireExactDuration is true\r\n *  - only bids that exactly match those listed values are accepted (don't round at all).\r\n *  - populate the `bid.video.durationBucket` field with the matching duration value\r\n * when adUnit.mediaTypes.video.requireExactDuration is false\r\n *  - round the duration to the next highest specified duration value based on adunit.  If the duration is above a range within a set buffer, that bid falls down into that bucket.\r\n *      (eg if range was [5, 15, 30] -> 2s is rounded to 5s; 17s is rounded back to 15s; 18s is rounded up to 30s)\r\n *  - if the bid is above the range of the listed durations (and outside the buffer), reject the bid\r\n *  - set the rounded duration value in the `bid.video.durationBucket` field for accepted bids\r\n * @param {Object} videoMediaType 'mediaTypes.video' associated to bidResponse\r\n * @param {Object} bidResponse incoming bidResponse being evaluated by bidderFactory\r\n * @returns {boolean} return false if bid duration is deemed invalid as per adUnit configuration; return true if fine\r\n*/\r\nfunction checkBidDuration(videoMediaType, bidResponse) {\r\n  const buffer = 2;\r\n  let bidDuration = deepAccess(bidResponse, 'video.durationSeconds');\r\n  let adUnitRanges = videoMediaType.durationRangeSec;\r\n  adUnitRanges.sort((a, b) => a - b); // ensure the ranges are sorted in numeric order\r\n\r\n  if (!videoMediaType.requireExactDuration) {\r\n    let max = Math.max(...adUnitRanges);\r\n    if (bidDuration <= (max + buffer)) {\r\n      let nextHighestRange = find(adUnitRanges, range => (range + buffer) >= bidDuration);\r\n      bidResponse.video.durationBucket = nextHighestRange;\r\n    } else {\r\n      logWarn(`Detected a bid with a duration value outside the accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Rejecting bid: `, bidResponse);\r\n      return false;\r\n    }\r\n  } else {\r\n    if (find(adUnitRanges, range => range === bidDuration)) {\r\n      bidResponse.video.durationBucket = bidDuration;\r\n    } else {\r\n      logWarn(`Detected a bid with a duration value not part of the list of accepted ranges specified in adUnit.mediaTypes.video.durationRangeSec.  Exact match durations must be used for this adUnit. Rejecting bid: `, bidResponse);\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/**\r\n * This hooked function evaluates an adpod bid and determines if the required fields are present.\r\n * If it's found to not be an adpod bid, it will return to original function via hook logic\r\n * @param {Function} fn reference to original function (used by hook logic)\r\n * @param {Object} bid incoming bid object\r\n * @param {Object} adUnit adUnit object of associated bid\r\n * @param {Object} videoMediaType copy of the `bidRequest.mediaTypes.video` object; used in original function\r\n * @param {String} context value of the `bidRequest.mediaTypes.video.context` field; used in original function\r\n * @returns {boolean} this return is only used for adpod bids\r\n */\r\nexport function checkVideoBidSetupHook(fn, bid, adUnit, videoMediaType, context) {\r\n  if (context === ADPOD) {\r\n    let result = true;\r\n    let brandCategoryExclusion = config.getConfig('adpod.brandCategoryExclusion');\r\n    if (brandCategoryExclusion && !deepAccess(bid, 'meta.primaryCatId')) {\r\n      result = false;\r\n    }\r\n\r\n    if (deepAccess(bid, 'video')) {\r\n      if (!deepAccess(bid, 'video.context') || bid.video.context !== ADPOD) {\r\n        result = false;\r\n      }\r\n\r\n      if (!deepAccess(bid, 'video.durationSeconds') || bid.video.durationSeconds <= 0) {\r\n        result = false;\r\n      } else {\r\n        let isBidGood = checkBidDuration(videoMediaType, bid);\r\n        if (!isBidGood) result = false;\r\n      }\r\n    }\r\n\r\n    if (!config.getConfig('cache.url') && bid.vastXml && !bid.vastUrl) {\r\n      logError(`\r\n        This bid contains only vastXml and will not work when a prebid cache url is not specified.\r\n        Try enabling prebid cache with pbjs.setConfig({ cache: {url: \"...\"} });\r\n      `);\r\n      result = false;\r\n    };\r\n\r\n    fn.bail(result);\r\n  } else {\r\n    fn.call(this, bid, adUnit, videoMediaType, context);\r\n  }\r\n}\r\n\r\n/**\r\n * This function reads the (optional) settings for the adpod as set from the setConfig()\r\n * @param {Object} config contains the config settings for adpod module\r\n */\r\nexport function adpodSetConfig(config) {\r\n  if (config.bidQueueTimeDelay !== undefined) {\r\n    if (typeof config.bidQueueTimeDelay === 'number' && config.bidQueueTimeDelay > 0) {\r\n      queueTimeDelay = config.bidQueueTimeDelay;\r\n    } else {\r\n      logWarn(`Detected invalid value for adpod.bidQueueTimeDelay in setConfig; must be a positive number.  Using default: ${queueTimeDelay}`)\r\n    }\r\n  }\r\n\r\n  if (config.bidQueueSizeLimit !== undefined) {\r\n    if (typeof config.bidQueueSizeLimit === 'number' && config.bidQueueSizeLimit > 0) {\r\n      queueSizeLimit = config.bidQueueSizeLimit;\r\n    } else {\r\n      logWarn(`Detected invalid value for adpod.bidQueueSizeLimit in setConfig; must be a positive number.  Using default: ${queueSizeLimit}`)\r\n    }\r\n  }\r\n}\r\nconfig.getConfig('adpod', config => adpodSetConfig(config.adpod));\r\n\r\n/**\r\n * This function initializes the adpod module's hooks.  This is called by the corresponding adserver video module.\r\n */\r\nfunction initAdpodHooks() {\r\n  setupBeforeHookFnOnce(callPrebidCache, callPrebidCacheHook);\r\n  setupBeforeHookFnOnce(checkAdUnitSetup, checkAdUnitSetupHook);\r\n  setupBeforeHookFnOnce(checkVideoBidSetup, checkVideoBidSetupHook);\r\n}\r\n\r\ninitAdpodHooks()\r\n\r\n/**\r\n *\r\n * @param {Array[Object]} bids list of 'winning' bids that need to be cached\r\n * @param {Function} callback send the cached bids (or error) back to adserverVideoModule for further processing\r\n }}\r\n */\r\nexport function callPrebidCacheAfterAuction(bids, callback) {\r\n  // will call PBC here and execute cb param to initialize player code\r\n  store(bids, function (error, cacheIds) {\r\n    if (error) {\r\n      callback(error, null);\r\n    } else {\r\n      let successfulCachedBids = [];\r\n      for (let i = 0; i < cacheIds.length; i++) {\r\n        if (cacheIds[i] !== '') {\r\n          successfulCachedBids.push(bids[i]);\r\n        }\r\n      }\r\n      callback(null, successfulCachedBids);\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Compare function to be used in sorting long-form bids. This will compare bids on price per second.\r\n * @param {Object} bid\r\n * @param {Object} bid\r\n */\r\nexport function sortByPricePerSecond(a, b) {\r\n  if (a.adserverTargeting[CONSTANTS.TARGETING_KEYS.PRICE_BUCKET] / a.video.durationBucket < b.adserverTargeting[CONSTANTS.TARGETING_KEYS.PRICE_BUCKET] / b.video.durationBucket) {\r\n    return 1;\r\n  }\r\n  if (a.adserverTargeting[CONSTANTS.TARGETING_KEYS.PRICE_BUCKET] / a.video.durationBucket > b.adserverTargeting[CONSTANTS.TARGETING_KEYS.PRICE_BUCKET] / b.video.durationBucket) {\r\n    return -1;\r\n  }\r\n  return 0;\r\n}\r\n\r\n/**\r\n * This function returns targeting keyvalue pairs for long-form adserver modules. Freewheel and GAM are currently supporting Prebid long-form\r\n * @param {Object} options\r\n * @param {Array[string]} codes\r\n * @param {function} callback\r\n * @returns targeting kvs for adUnitCodes\r\n */\r\nexport function getTargeting({ codes, callback } = {}) {\r\n  if (!callback) {\r\n    logError('No callback function was defined in the getTargeting call.  Aborting getTargeting().');\r\n    return;\r\n  }\r\n  codes = codes || [];\r\n  const adPodAdUnits = getAdPodAdUnits(codes);\r\n  const bidsReceived = auctionManager.getBidsReceived();\r\n  const competiveExclusionEnabled = config.getConfig('adpod.brandCategoryExclusion');\r\n  const deferCachingSetting = config.getConfig('adpod.deferCaching');\r\n  const deferCachingEnabled = (typeof deferCachingSetting === 'boolean') ? deferCachingSetting : true;\r\n\r\n  let bids = getBidsForAdpod(bidsReceived, adPodAdUnits);\r\n  bids = (competiveExclusionEnabled || deferCachingEnabled) ? getExclusiveBids(bids) : bids;\r\n\r\n  let prioritizeDeals = config.getConfig('adpod.prioritizeDeals');\r\n  if (prioritizeDeals) {\r\n    let [otherBids, highPriorityDealBids] = bids.reduce((partitions, bid) => {\r\n      let bidDealTier = deepAccess(bid, 'video.dealTier');\r\n      let minDealTier = config.getConfig(`adpod.dealTier.${bid.bidderCode}.minDealTier`);\r\n      if (minDealTier && bidDealTier) {\r\n        if (bidDealTier >= minDealTier) {\r\n          partitions[1].push(bid)\r\n        } else {\r\n          partitions[0].push(bid)\r\n        }\r\n      } else if (bidDealTier) {\r\n        partitions[1].push(bid)\r\n      } else {\r\n        partitions[0].push(bid);\r\n      }\r\n      return partitions;\r\n    }, [[], []]);\r\n    highPriorityDealBids.sort(sortByPricePerSecond);\r\n    otherBids.sort(sortByPricePerSecond);\r\n    bids = highPriorityDealBids.concat(otherBids);\r\n  } else {\r\n    bids.sort(sortByPricePerSecond);\r\n  }\r\n\r\n  let targeting = {};\r\n  if (deferCachingEnabled === false) {\r\n    adPodAdUnits.forEach((adUnit) => {\r\n      let adPodTargeting = [];\r\n      let adPodDurationSeconds = deepAccess(adUnit, 'mediaTypes.video.adPodDurationSec');\r\n\r\n      bids\r\n        .filter((bid) => bid.adUnitCode === adUnit.code)\r\n        .forEach((bid, index, arr) => {\r\n          if (bid.video.durationBucket <= adPodDurationSeconds) {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR]\r\n            });\r\n            adPodDurationSeconds -= bid.video.durationBucket;\r\n          }\r\n          if (index === arr.length - 1 && adPodTargeting.length > 0) {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_CACHE_ID]: bid.adserverTargeting[TARGETING_KEY_CACHE_ID]\r\n            });\r\n          }\r\n        });\r\n      targeting[adUnit.code] = adPodTargeting;\r\n    });\r\n\r\n    callback(null, targeting);\r\n  } else {\r\n    let bidsToCache = [];\r\n    adPodAdUnits.forEach((adUnit) => {\r\n      let adPodDurationSeconds = deepAccess(adUnit, 'mediaTypes.video.adPodDurationSec');\r\n\r\n      bids\r\n        .filter((bid) => bid.adUnitCode === adUnit.code)\r\n        .forEach((bid) => {\r\n          if (bid.video.durationBucket <= adPodDurationSeconds) {\r\n            bidsToCache.push(bid);\r\n            adPodDurationSeconds -= bid.video.durationBucket;\r\n          }\r\n        });\r\n    });\r\n\r\n    callPrebidCacheAfterAuction(bidsToCache, function (error, bidsSuccessfullyCached) {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let groupedBids = groupBy(bidsSuccessfullyCached, 'adUnitCode');\r\n        Object.keys(groupedBids).forEach((adUnitCode) => {\r\n          let adPodTargeting = [];\r\n\r\n          groupedBids[adUnitCode].forEach((bid, index, arr) => {\r\n            adPodTargeting.push({\r\n              [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR]\r\n            });\r\n\r\n            if (index === arr.length - 1 && adPodTargeting.length > 0) {\r\n              adPodTargeting.push({\r\n                [TARGETING_KEY_CACHE_ID]: bid.adserverTargeting[TARGETING_KEY_CACHE_ID]\r\n              });\r\n            }\r\n          });\r\n          targeting[adUnitCode] = adPodTargeting;\r\n        });\r\n\r\n        callback(null, targeting);\r\n      }\r\n    });\r\n  }\r\n  return targeting;\r\n}\r\n\r\n/**\r\n * This function returns the adunit of mediaType adpod\r\n * @param {Array} codes adUnitCodes\r\n * @returns {Array[Object]} adunits of mediaType adpod\r\n */\r\nfunction getAdPodAdUnits(codes) {\r\n  return auctionManager.getAdUnits()\r\n    .filter((adUnit) => deepAccess(adUnit, 'mediaTypes.video.context') === ADPOD)\r\n    .filter((adUnit) => (codes.length > 0) ? codes.indexOf(adUnit.code) != -1 : true);\r\n}\r\n\r\n/**\r\n * This function removes bids of same category. It will be used when competitive exclusion is enabled.\r\n * @param {Array[Object]} bidsReceived\r\n * @returns {Array[Object]} unique category bids\r\n */\r\nfunction getExclusiveBids(bidsReceived) {\r\n  let bids = bidsReceived\r\n    .map((bid) => Object.assign({}, bid, { [TARGETING_KEY_PB_CAT_DUR]: bid.adserverTargeting[TARGETING_KEY_PB_CAT_DUR] }));\r\n  bids = groupBy(bids, TARGETING_KEY_PB_CAT_DUR);\r\n  let filteredBids = [];\r\n  Object.keys(bids).forEach((targetingKey) => {\r\n    bids[targetingKey].sort(compareOn('responseTimestamp'));\r\n    filteredBids.push(bids[targetingKey][0]);\r\n  });\r\n  return filteredBids;\r\n}\r\n\r\n/**\r\n * This function returns bids for adpod adunits\r\n * @param {Array[Object]} bidsReceived\r\n * @param {Array[Object]} adPodAdUnits\r\n * @returns {Array[Object]} bids of mediaType adpod\r\n */\r\nfunction getBidsForAdpod(bidsReceived, adPodAdUnits) {\r\n  let adUnitCodes = adPodAdUnits.map((adUnit) => adUnit.code);\r\n  return bidsReceived\r\n    .filter((bid) => adUnitCodes.indexOf(bid.adUnitCode) != -1 && (bid.video && bid.video.context === ADPOD))\r\n}\r\n\r\nconst sharedMethods = {\r\n  TARGETING_KEY_PB_CAT_DUR: TARGETING_KEY_PB_CAT_DUR,\r\n  TARGETING_KEY_CACHE_ID: TARGETING_KEY_CACHE_ID,\r\n  'getTargeting': getTargeting\r\n}\r\nObject.freeze(sharedMethods);\r\n\r\nmodule('adpod', function shareAdpodUtilities(...args) {\r\n  if (!isPlainObject(args[0])) {\r\n    logError('Adpod module needs plain object to share methods with submodule');\r\n    return;\r\n  }\r\n  function addMethods(object, func) {\r\n    for (let name in func) {\r\n      object[name] = func[name];\r\n    }\r\n  }\r\n  addMethods(args[0], sharedMethods);\r\n});\r\n","import {\r\n  chunk,\r\n  convertCamelToUnderscore,\r\n  convertTypes,\r\n  createTrackPixelHtml,\r\n  deepAccess,\r\n  deepClone,\r\n  fill,\r\n  getBidRequest,\r\n  getMaxValueFromArray,\r\n  getMinValueFromArray,\r\n  getParameterByName,\r\n  getUniqueIdentifierStr,\r\n  isArray,\r\n  isArrayOfNums,\r\n  isEmpty,\r\n  isFn,\r\n  isNumber,\r\n  isPlainObject,\r\n  isStr,\r\n  logError,\r\n  logInfo,\r\n  logMessage,\r\n  logWarn,\r\n  mergeDeep,\r\n  transformBidderParamKeywords,\r\n  getWindowFromDocument\r\n} from '../src/utils.js';\r\nimport {Renderer} from '../src/Renderer.js';\r\nimport {config} from '../src/config.js';\r\nimport {getIabSubCategory, registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport {ADPOD, BANNER, NATIVE, VIDEO} from '../src/mediaTypes.js';\r\nimport {auctionManager} from '../src/auctionManager.js';\r\nimport {find, includes} from '../src/polyfill.js';\r\nimport {INSTREAM, OUTSTREAM} from '../src/video.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {bidderSettings} from '../src/bidderSettings.js';\r\nimport {hasPurpose1Consent} from '../src/utils/gpdr.js';\r\nimport { convertOrtbRequestToProprietaryNative } from '../src/native.js';\r\n\r\nconst BIDDER_CODE = 'appnexus';\r\nconst URL = 'https://ib.adnxs.com/ut/v3/prebid';\r\nconst URL_SIMPLE = 'https://ib.adnxs-simple.com/ut/v3/prebid';\r\nconst VIDEO_TARGETING = ['id', 'minduration', 'maxduration',\r\n  'skippable', 'playback_method', 'frameworks', 'context', 'skipoffset'];\r\nconst VIDEO_RTB_TARGETING = ['minduration', 'maxduration', 'skip', 'skipafter', 'playbackmethod', 'api'];\r\nconst USER_PARAMS = ['age', 'externalUid', 'segments', 'gender', 'dnt', 'language'];\r\nconst APP_DEVICE_PARAMS = ['geo', 'device_id']; // appid is collected separately\r\nconst DEBUG_PARAMS = ['enabled', 'dongle', 'member_id', 'debug_timeout'];\r\nconst VIDEO_MAPPING = {\r\n  playback_method: {\r\n    'unknown': 0,\r\n    'auto_play_sound_on': 1,\r\n    'auto_play_sound_off': 2,\r\n    'click_to_play': 3,\r\n    'mouse_over': 4,\r\n    'auto_play_sound_unknown': 5\r\n  },\r\n  context: {\r\n    'unknown': 0,\r\n    'pre_roll': 1,\r\n    'mid_roll': 2,\r\n    'post_roll': 3,\r\n    'outstream': 4,\r\n    'in-banner': 5\r\n  }\r\n};\r\nconst NATIVE_MAPPING = {\r\n  body: 'description',\r\n  body2: 'desc2',\r\n  cta: 'ctatext',\r\n  image: {\r\n    serverName: 'main_image',\r\n    requiredParams: { required: true }\r\n  },\r\n  icon: {\r\n    serverName: 'icon',\r\n    requiredParams: { required: true }\r\n  },\r\n  sponsoredBy: 'sponsored_by',\r\n  privacyLink: 'privacy_link',\r\n  salePrice: 'saleprice',\r\n  displayUrl: 'displayurl'\r\n};\r\nconst SOURCE = 'pbjs';\r\nconst MAX_IMPS_PER_REQUEST = 15;\r\nconst mappingFileUrl = 'https://acdn.adnxs-simple.com/prebid/appnexus-mapping/mappings.json';\r\nconst SCRIPT_TAG_START = '<script';\r\nconst VIEWABILITY_URL_START = /\\/\\/cdn\\.adnxs\\.com\\/v|\\/\\/cdn\\.adnxs\\-simple\\.com\\/v/;\r\nconst VIEWABILITY_FILE_NAME = 'trk.js';\r\nconst GVLID = 32;\r\nconst storage = getStorageManager({gvlid: GVLID, bidderCode: BIDDER_CODE});\r\n\r\nexport const spec = {\r\n  code: BIDDER_CODE,\r\n  gvlid: GVLID,\r\n  aliases: [\r\n    { code: 'appnexusAst', gvlid: 32 },\r\n    { code: 'emxdigital', gvlid: 183 },\r\n    { code: 'pagescience' },\r\n    { code: 'defymedia' },\r\n    { code: 'gourmetads' },\r\n    { code: 'matomy' },\r\n    { code: 'featureforward' },\r\n    { code: 'oftmedia' },\r\n    { code: 'adasta' },\r\n    { code: 'beintoo', gvlid: 618 },\r\n  ],\r\n  supportedMediaTypes: [BANNER, VIDEO, NATIVE],\r\n\r\n  /**\r\n   * Determines whether or not the given bid request is valid.\r\n   *\r\n   * @param {object} bid The bid to validate.\r\n   * @return boolean True if this is a valid bid, and false otherwise.\r\n   */\r\n  isBidRequestValid: function (bid) {\r\n    return !!(bid.params.placementId || (bid.params.member && bid.params.invCode));\r\n  },\r\n\r\n  /**\r\n   * Make a server request from the list of BidRequests.\r\n   *\r\n   * @param {BidRequest[]} bidRequests A non-empty list of bid requests which should be sent to the Server.\r\n   * @return ServerRequest Info describing the request to the server.\r\n   */\r\n  buildRequests: function (bidRequests, bidderRequest) {\r\n    // convert Native ORTB definition to old-style prebid native definition\r\n    bidRequests = convertOrtbRequestToProprietaryNative(bidRequests);\r\n\r\n    const tags = bidRequests.map(bidToTag);\r\n    const userObjBid = find(bidRequests, hasUserInfo);\r\n    let userObj = {};\r\n    if (config.getConfig('coppa') === true) {\r\n      userObj = { 'coppa': true };\r\n    }\r\n    if (userObjBid) {\r\n      Object.keys(userObjBid.params.user)\r\n        .filter(param => includes(USER_PARAMS, param))\r\n        .forEach((param) => {\r\n          let uparam = convertCamelToUnderscore(param);\r\n          if (param === 'segments' && isArray(userObjBid.params.user[param])) {\r\n            let segs = [];\r\n            userObjBid.params.user[param].forEach(val => {\r\n              if (isNumber(val)) {\r\n                segs.push({'id': val});\r\n              } else if (isPlainObject(val)) {\r\n                segs.push(val);\r\n              }\r\n            });\r\n            userObj[uparam] = segs;\r\n          } else if (param !== 'segments') {\r\n            userObj[uparam] = userObjBid.params.user[param];\r\n          }\r\n        });\r\n    }\r\n\r\n    const appDeviceObjBid = find(bidRequests, hasAppDeviceInfo);\r\n    let appDeviceObj;\r\n    if (appDeviceObjBid && appDeviceObjBid.params && appDeviceObjBid.params.app) {\r\n      appDeviceObj = {};\r\n      Object.keys(appDeviceObjBid.params.app)\r\n        .filter(param => includes(APP_DEVICE_PARAMS, param))\r\n        .forEach(param => appDeviceObj[param] = appDeviceObjBid.params.app[param]);\r\n    }\r\n\r\n    const appIdObjBid = find(bidRequests, hasAppId);\r\n    let appIdObj;\r\n    if (appIdObjBid && appIdObjBid.params && appDeviceObjBid.params.app && appDeviceObjBid.params.app.id) {\r\n      appIdObj = {\r\n        appid: appIdObjBid.params.app.id\r\n      };\r\n    }\r\n\r\n    let debugObj = {};\r\n    let debugObjParams = {};\r\n    const debugCookieName = 'apn_prebid_debug';\r\n    const debugCookie = storage.getCookie(debugCookieName) || null;\r\n\r\n    if (debugCookie) {\r\n      try {\r\n        debugObj = JSON.parse(debugCookie);\r\n      } catch (e) {\r\n        logError('AppNexus Debug Auction Cookie Error:\\n\\n' + e);\r\n      }\r\n    } else {\r\n      const debugBidRequest = find(bidRequests, hasDebug);\r\n      if (debugBidRequest && debugBidRequest.debug) {\r\n        debugObj = debugBidRequest.debug;\r\n      }\r\n    }\r\n\r\n    if (debugObj && debugObj.enabled) {\r\n      Object.keys(debugObj)\r\n        .filter(param => includes(DEBUG_PARAMS, param))\r\n        .forEach(param => {\r\n          debugObjParams[param] = debugObj[param];\r\n        });\r\n    }\r\n\r\n    const memberIdBid = find(bidRequests, hasMemberId);\r\n    const member = memberIdBid ? parseInt(memberIdBid.params.member, 10) : 0;\r\n    const schain = bidRequests[0].schain;\r\n    const omidSupport = find(bidRequests, hasOmidSupport);\r\n\r\n    const payload = {\r\n      tags: [...tags],\r\n      user: userObj,\r\n      sdk: {\r\n        source: SOURCE,\r\n        version: '$prebid.version$'\r\n      },\r\n      schain: schain\r\n    };\r\n\r\n    if (omidSupport) {\r\n      payload['iab_support'] = {\r\n        omidpn: 'Appnexus',\r\n        omidpv: '$prebid.version$'\r\n      };\r\n    }\r\n\r\n    if (member > 0) {\r\n      payload.member_id = member;\r\n    }\r\n\r\n    if (appDeviceObjBid) {\r\n      payload.device = appDeviceObj;\r\n    }\r\n    if (appIdObjBid) {\r\n      payload.app = appIdObj;\r\n    }\r\n\r\n    function grabOrtb2Keywords(ortb2Obj) {\r\n      const fields = ['site.keywords', 'site.content.keywords', 'user.keywords', 'app.keywords', 'app.content.keywords'];\r\n      let result = [];\r\n\r\n      fields.forEach(path => {\r\n        let keyStr = deepAccess(ortb2Obj, path);\r\n        if (isStr(keyStr)) result.push(keyStr);\r\n      });\r\n      return result;\r\n    }\r\n\r\n    // grab the ortb2 keyword data (if it exists) and convert from the comma list string format to object format\r\n    let ortb2 = deepClone(bidderRequest && bidderRequest.ortb2);\r\n    let ortb2KeywordsObjList = grabOrtb2Keywords(ortb2).map(keyStr => convertStringToKeywordsObj(keyStr));\r\n\r\n    let anAuctionKeywords = deepClone(config.getConfig('appnexusAuctionKeywords')) || {};\r\n    // need to convert the string values into array of strings, to properly merge values with other existing keys later\r\n    Object.keys(anAuctionKeywords).forEach(k => { if (isStr(anAuctionKeywords[k]) || isNumber(anAuctionKeywords[k])) anAuctionKeywords[k] = [anAuctionKeywords[k]] });\r\n    // combine all sources of keywords (converted from string comma list to object format) into one object (that combines the values for shared keys)\r\n    let mergedAuctionKeywords = mergeDeep({}, anAuctionKeywords, ...ortb2KeywordsObjList);\r\n\r\n    // convert to final format used by adserver\r\n    let auctionKeywords = transformBidderParamKeywords(mergedAuctionKeywords);\r\n    if (auctionKeywords.length > 0) {\r\n      auctionKeywords.forEach(deleteValues);\r\n      payload.keywords = auctionKeywords;\r\n    }\r\n\r\n    if (config.getConfig('adpod.brandCategoryExclusion')) {\r\n      payload.brand_category_uniqueness = true;\r\n    }\r\n\r\n    if (debugObjParams.enabled) {\r\n      payload.debug = debugObjParams;\r\n      logInfo('AppNexus Debug Auction Settings:\\n\\n' + JSON.stringify(debugObjParams, null, 4));\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.gdprConsent) {\r\n      // note - objects for impbus use underscore instead of camelCase\r\n      payload.gdpr_consent = {\r\n        consent_string: bidderRequest.gdprConsent.consentString,\r\n        consent_required: bidderRequest.gdprConsent.gdprApplies\r\n      };\r\n\r\n      if (bidderRequest.gdprConsent.addtlConsent && bidderRequest.gdprConsent.addtlConsent.indexOf('~') !== -1) {\r\n        let ac = bidderRequest.gdprConsent.addtlConsent;\r\n        // pull only the ids from the string (after the ~) and convert them to an array of ints\r\n        let acStr = ac.substring(ac.indexOf('~') + 1);\r\n        payload.gdpr_consent.addtl_consent = acStr.split('.').map(id => parseInt(id, 10));\r\n      }\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.uspConsent) {\r\n      payload.us_privacy = bidderRequest.uspConsent;\r\n    }\r\n\r\n    if (bidderRequest && bidderRequest.refererInfo) {\r\n      let refererinfo = {\r\n        // TODO: are these the correct referer values?\r\n        rd_ref: encodeURIComponent(bidderRequest.refererInfo.topmostLocation),\r\n        rd_top: bidderRequest.refererInfo.reachedTop,\r\n        rd_ifs: bidderRequest.refererInfo.numIframes,\r\n        rd_stk: bidderRequest.refererInfo.stack.map((url) => encodeURIComponent(url)).join(',')\r\n      };\r\n      let pubPageUrl = bidderRequest.refererInfo.canonicalUrl;\r\n      if (isStr(pubPageUrl) && pubPageUrl !== '') {\r\n        refererinfo.rd_can = pubPageUrl;\r\n      }\r\n      payload.referrer_detection = refererinfo;\r\n    }\r\n\r\n    const hasAdPodBid = find(bidRequests, hasAdPod);\r\n    if (hasAdPodBid) {\r\n      bidRequests.filter(hasAdPod).forEach(adPodBid => {\r\n        const adPodTags = createAdPodRequest(tags, adPodBid);\r\n        // don't need the original adpod placement because it's in adPodTags\r\n        const nonPodTags = payload.tags.filter(tag => tag.uuid !== adPodBid.bidId);\r\n        payload.tags = [...nonPodTags, ...adPodTags];\r\n      });\r\n    }\r\n\r\n    if (bidRequests[0].userId) {\r\n      let eids = [];\r\n\r\n      addUserId(eids, deepAccess(bidRequests[0], `userId.criteoId`), 'criteo.com', null);\r\n      addUserId(eids, deepAccess(bidRequests[0], `userId.netId`), 'netid.de', null);\r\n      addUserId(eids, deepAccess(bidRequests[0], `userId.idl_env`), 'liveramp.com', null);\r\n      addUserId(eids, deepAccess(bidRequests[0], `userId.tdid`), 'adserver.org', 'TDID');\r\n      addUserId(eids, deepAccess(bidRequests[0], `userId.uid2.id`), 'uidapi.com', 'UID2');\r\n      if (bidRequests[0].userId.pubProvidedId) {\r\n        bidRequests[0].userId.pubProvidedId.forEach(ppId => {\r\n          ppId.uids.forEach(uid => {\r\n            eids.push({ source: ppId.source, id: uid.id });\r\n          });\r\n        });\r\n      }\r\n\r\n      if (eids.length) {\r\n        payload.eids = eids;\r\n      }\r\n    }\r\n\r\n    if (tags[0].publisher_id) {\r\n      payload.publisher_id = tags[0].publisher_id;\r\n    }\r\n\r\n    const request = formatRequest(payload, bidderRequest);\r\n    return request;\r\n  },\r\n\r\n  /**\r\n   * Unpack the response from the server into a list of bids.\r\n   *\r\n   * @param {*} serverResponse A successful response from the server.\r\n   * @return {Bid[]} An array of bids which were nested inside the server.\r\n   */\r\n  interpretResponse: function (serverResponse, { bidderRequest }) {\r\n    serverResponse = serverResponse.body;\r\n    const bids = [];\r\n    if (!serverResponse || serverResponse.error) {\r\n      let errorMessage = `in response for ${bidderRequest.bidderCode} adapter`;\r\n      if (serverResponse && serverResponse.error) { errorMessage += `: ${serverResponse.error}`; }\r\n      logError(errorMessage);\r\n      return bids;\r\n    }\r\n\r\n    if (serverResponse.tags) {\r\n      serverResponse.tags.forEach(serverBid => {\r\n        const rtbBid = getRtbBid(serverBid);\r\n        if (rtbBid) {\r\n          const cpmCheck = (bidderSettings.get(bidderRequest.bidderCode, 'allowZeroCpmBids') === true) ? rtbBid.cpm >= 0 : rtbBid.cpm > 0;\r\n          if (cpmCheck && includes(this.supportedMediaTypes, rtbBid.ad_type)) {\r\n            const bid = newBid(serverBid, rtbBid, bidderRequest);\r\n            bid.mediaType = parseMediaType(rtbBid);\r\n            bids.push(bid);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if (serverResponse.debug && serverResponse.debug.debug_info) {\r\n      let debugHeader = 'AppNexus Debug Auction for Prebid\\n\\n'\r\n      let debugText = debugHeader + serverResponse.debug.debug_info\r\n      debugText = debugText\r\n        .replace(/(<td>|<th>)/gm, '\\t') // Tables\r\n        .replace(/(<\\/td>|<\\/th>)/gm, '\\n') // Tables\r\n        .replace(/^<br>/gm, '') // Remove leading <br>\r\n        .replace(/(<br>\\n|<br>)/gm, '\\n') // <br>\r\n        .replace(/<h1>(.*)<\\/h1>/gm, '\\n\\n===== $1 =====\\n\\n') // Header H1\r\n        .replace(/<h[2-6]>(.*)<\\/h[2-6]>/gm, '\\n\\n*** $1 ***\\n\\n') // Headers\r\n        .replace(/(<([^>]+)>)/igm, ''); // Remove any other tags\r\n      logMessage('https://console.appnexus.com/docs/understanding-the-debug-auction');\r\n      logMessage(debugText);\r\n    }\r\n\r\n    return bids;\r\n  },\r\n\r\n  /**\r\n   * @typedef {Object} mappingFileInfo\r\n   * @property {string} url  mapping file json url\r\n   * @property {number} refreshInDays prebid stores mapping data in localstorage so you can return in how many days you want to update value stored in localstorage.\r\n   * @property {string} localStorageKey unique key to store your mapping json in localstorage\r\n   */\r\n\r\n  /**\r\n   * Returns mapping file info. This info will be used by bidderFactory to preload mapping file and store data in local storage\r\n   * @returns {mappingFileInfo}\r\n   */\r\n  getMappingFileInfo: function () {\r\n    return {\r\n      url: mappingFileUrl,\r\n      refreshInDays: 2\r\n    }\r\n  },\r\n\r\n  getUserSyncs: function (syncOptions, responses, gdprConsent) {\r\n    if (syncOptions.iframeEnabled && hasPurpose1Consent(gdprConsent)) {\r\n      return [{\r\n        type: 'iframe',\r\n        url: 'https://acdn.adnxs.com/dmp/async_usersync.html'\r\n      }];\r\n    }\r\n  },\r\n\r\n  transformBidParams: function (params, isOpenRtb, adUnit, bidRequests) {\r\n    let conversionFn = transformBidderParamKeywords;\r\n    if (isOpenRtb === true) {\r\n      let s2sEndpointUrl = null;\r\n      let s2sConfig = config.getConfig('s2sConfig');\r\n\r\n      if (isPlainObject(s2sConfig)) {\r\n        s2sEndpointUrl = deepAccess(s2sConfig, 'endpoint.p1Consent');\r\n      } else if (isArray(s2sConfig)) {\r\n        s2sConfig.forEach(s2sCfg => {\r\n          if (includes(s2sCfg.bidders, adUnit.bids[0].bidder)) {\r\n            s2sEndpointUrl = deepAccess(s2sCfg, 'endpoint.p1Consent');\r\n          }\r\n        });\r\n      }\r\n\r\n      if (s2sEndpointUrl && s2sEndpointUrl.match('/openrtb2/prebid')) {\r\n        conversionFn = convertKeywordsToString;\r\n      }\r\n    }\r\n\r\n    params = convertTypes({\r\n      'member': 'string',\r\n      'invCode': 'string',\r\n      'placementId': 'number',\r\n      'keywords': conversionFn,\r\n      'publisherId': 'number'\r\n    }, params);\r\n\r\n    if (isOpenRtb) {\r\n      params.use_pmt_rule = (typeof params.usePaymentRule === 'boolean') ? params.usePaymentRule : false;\r\n      if (params.usePaymentRule) { delete params.usePaymentRule; }\r\n\r\n      if (isPopulatedArray(params.keywords)) {\r\n        params.keywords.forEach(deleteValues);\r\n      }\r\n\r\n      Object.keys(params).forEach(paramKey => {\r\n        let convertedKey = convertCamelToUnderscore(paramKey);\r\n        if (convertedKey !== paramKey) {\r\n          params[convertedKey] = params[paramKey];\r\n          delete params[paramKey];\r\n        }\r\n      });\r\n    }\r\n\r\n    return params;\r\n  }\r\n};\r\n\r\nfunction isPopulatedArray(arr) {\r\n  return !!(isArray(arr) && arr.length > 0);\r\n}\r\n\r\nfunction deleteValues(keyPairObj) {\r\n  if (isPopulatedArray(keyPairObj.value) && keyPairObj.value[0] === '') {\r\n    delete keyPairObj.value;\r\n  }\r\n}\r\n\r\nfunction strIsAppnexusViewabilityScript(str) {\r\n  if (!str || str === '') return false;\r\n\r\n  let regexMatchUrlStart = str.match(VIEWABILITY_URL_START);\r\n  let viewUrlStartInStr = regexMatchUrlStart != null && regexMatchUrlStart.length >= 1;\r\n\r\n  let regexMatchFileName = str.match(VIEWABILITY_FILE_NAME);\r\n  let fileNameInStr = regexMatchFileName != null && regexMatchFileName.length >= 1;\r\n\r\n  return str.startsWith(SCRIPT_TAG_START) && fileNameInStr && viewUrlStartInStr;\r\n}\r\n\r\nfunction formatRequest(payload, bidderRequest) {\r\n  let request = [];\r\n  let options = {\r\n    withCredentials: true\r\n  };\r\n\r\n  let endpointUrl = URL;\r\n\r\n  if (!hasPurpose1Consent(bidderRequest?.gdprConsent)) {\r\n    endpointUrl = URL_SIMPLE;\r\n  }\r\n\r\n  if (getParameterByName('apn_test').toUpperCase() === 'TRUE' || config.getConfig('apn_test') === true) {\r\n    options.customHeaders = {\r\n      'X-Is-Test': 1\r\n    };\r\n  }\r\n\r\n  if (payload.tags.length > MAX_IMPS_PER_REQUEST) {\r\n    const clonedPayload = deepClone(payload);\r\n\r\n    chunk(payload.tags, MAX_IMPS_PER_REQUEST).forEach(tags => {\r\n      clonedPayload.tags = tags;\r\n      const payloadString = JSON.stringify(clonedPayload);\r\n      request.push({\r\n        method: 'POST',\r\n        url: endpointUrl,\r\n        data: payloadString,\r\n        bidderRequest,\r\n        options\r\n      });\r\n    });\r\n  } else {\r\n    const payloadString = JSON.stringify(payload);\r\n    request = {\r\n      method: 'POST',\r\n      url: endpointUrl,\r\n      data: payloadString,\r\n      bidderRequest,\r\n      options\r\n    };\r\n  }\r\n\r\n  return request;\r\n}\r\n\r\nfunction newRenderer(adUnitCode, rtbBid, rendererOptions = {}) {\r\n  const renderer = Renderer.install({\r\n    id: rtbBid.renderer_id,\r\n    url: rtbBid.renderer_url,\r\n    config: rendererOptions,\r\n    loaded: false,\r\n    adUnitCode\r\n  });\r\n\r\n  try {\r\n    renderer.setRender(outstreamRender);\r\n  } catch (err) {\r\n    logWarn('Prebid Error calling setRender on renderer', err);\r\n  }\r\n\r\n  renderer.setEventHandlers({\r\n    impression: () => logMessage('AppNexus outstream video impression event'),\r\n    loaded: () => logMessage('AppNexus outstream video loaded event'),\r\n    ended: () => {\r\n      logMessage('AppNexus outstream renderer video event');\r\n      document.querySelector(`#${adUnitCode}`).style.display = 'none';\r\n    }\r\n  });\r\n  return renderer;\r\n}\r\n\r\n/**\r\n * Unpack the Server's Bid into a Prebid-compatible one.\r\n * @param serverBid\r\n * @param rtbBid\r\n * @param bidderRequest\r\n * @return Bid\r\n */\r\nfunction newBid(serverBid, rtbBid, bidderRequest) {\r\n  const bidRequest = getBidRequest(serverBid.uuid, [bidderRequest]);\r\n  const adId = getUniqueIdentifierStr();\r\n  const bid = {\r\n    adId: adId,\r\n    requestId: serverBid.uuid,\r\n    cpm: rtbBid.cpm,\r\n    creativeId: rtbBid.creative_id,\r\n    dealId: rtbBid.deal_id,\r\n    currency: 'USD',\r\n    netRevenue: true,\r\n    ttl: 300,\r\n    adUnitCode: bidRequest.adUnitCode,\r\n    appnexus: {\r\n      buyerMemberId: rtbBid.buyer_member_id,\r\n      dealPriority: rtbBid.deal_priority,\r\n      dealCode: rtbBid.deal_code\r\n    }\r\n  };\r\n\r\n  // WE DON'T FULLY SUPPORT THIS ATM - future spot for adomain code; creating a stub for 5.0 compliance\r\n  if (rtbBid.adomain) {\r\n    bid.meta = Object.assign({}, bid.meta, { advertiserDomains: [] });\r\n  }\r\n\r\n  if (rtbBid.advertiser_id) {\r\n    bid.meta = Object.assign({}, bid.meta, { advertiserId: rtbBid.advertiser_id });\r\n  }\r\n\r\n  // temporary function; may remove at later date if/when adserver fully supports dchain\r\n  function setupDChain(rtbBid) {\r\n    let dchain = {\r\n      ver: '1.0',\r\n      complete: 0,\r\n      nodes: [{\r\n        bsid: rtbBid.buyer_member_id.toString()\r\n      }],\r\n    };\r\n\r\n    return dchain;\r\n  }\r\n  if (rtbBid.buyer_member_id) {\r\n    bid.meta = Object.assign({}, bid.meta, {dchain: setupDChain(rtbBid)});\r\n  }\r\n\r\n  if (rtbBid.brand_id) {\r\n    bid.meta = Object.assign({}, bid.meta, { brandId: rtbBid.brand_id });\r\n  }\r\n\r\n  if (rtbBid.rtb.video) {\r\n    // shared video properties used for all 3 contexts\r\n    Object.assign(bid, {\r\n      width: rtbBid.rtb.video.player_width,\r\n      height: rtbBid.rtb.video.player_height,\r\n      vastImpUrl: rtbBid.notify_url,\r\n      ttl: 3600\r\n    });\r\n\r\n    const videoContext = deepAccess(bidRequest, 'mediaTypes.video.context');\r\n    switch (videoContext) {\r\n      case ADPOD:\r\n        const primaryCatId = getIabSubCategory(bidRequest.bidder, rtbBid.brand_category_id);\r\n        bid.meta = Object.assign({}, bid.meta, { primaryCatId });\r\n        const dealTier = rtbBid.deal_priority;\r\n        bid.video = {\r\n          context: ADPOD,\r\n          durationSeconds: Math.floor(rtbBid.rtb.video.duration_ms / 1000),\r\n          dealTier\r\n        };\r\n        bid.vastUrl = rtbBid.rtb.video.asset_url;\r\n        break;\r\n      case OUTSTREAM:\r\n        bid.adResponse = serverBid;\r\n        bid.adResponse.ad = bid.adResponse.ads[0];\r\n        bid.adResponse.ad.video = bid.adResponse.ad.rtb.video;\r\n        bid.vastXml = rtbBid.rtb.video.content;\r\n\r\n        if (rtbBid.renderer_url) {\r\n          const videoBid = find(bidderRequest.bids, bid => bid.bidId === serverBid.uuid);\r\n          let rendererOptions = deepAccess(videoBid, 'mediaTypes.video.renderer.options'); // mediaType definition has preference (shouldn't options be .config?)\r\n          if (!rendererOptions) {\r\n            rendererOptions = deepAccess(videoBid, 'renderer.options'); // second the adUnit definition has preference (shouldn't options be .config?)\r\n          }\r\n          bid.renderer = newRenderer(bid.adUnitCode, rtbBid, rendererOptions);\r\n        }\r\n        break;\r\n      case INSTREAM:\r\n        bid.vastUrl = rtbBid.notify_url + '&redir=' + encodeURIComponent(rtbBid.rtb.video.asset_url);\r\n        break;\r\n    }\r\n  } else if (FEATURES.NATIVE && rtbBid.rtb[NATIVE]) {\r\n    const nativeAd = rtbBid.rtb[NATIVE];\r\n    let viewScript;\r\n\r\n    if (strIsAppnexusViewabilityScript(rtbBid.viewability.config)) {\r\n      let prebidParams = 'pbjs_adid=' + adId + ';pbjs_auc=' + bidRequest.adUnitCode;\r\n      viewScript = rtbBid.viewability.config.replace('dom_id=%native_dom_id%', prebidParams);\r\n    }\r\n\r\n    let jsTrackers = nativeAd.javascript_trackers;\r\n    if (jsTrackers == undefined) {\r\n      jsTrackers = viewScript;\r\n    } else if (isStr(jsTrackers)) {\r\n      jsTrackers = [jsTrackers, viewScript];\r\n    } else {\r\n      jsTrackers.push(viewScript);\r\n    }\r\n\r\n    bid[NATIVE] = {\r\n      title: nativeAd.title,\r\n      body: nativeAd.desc,\r\n      body2: nativeAd.desc2,\r\n      cta: nativeAd.ctatext,\r\n      rating: nativeAd.rating,\r\n      sponsoredBy: nativeAd.sponsored,\r\n      privacyLink: nativeAd.privacy_link,\r\n      address: nativeAd.address,\r\n      downloads: nativeAd.downloads,\r\n      likes: nativeAd.likes,\r\n      phone: nativeAd.phone,\r\n      price: nativeAd.price,\r\n      salePrice: nativeAd.saleprice,\r\n      clickUrl: nativeAd.link.url,\r\n      displayUrl: nativeAd.displayurl,\r\n      clickTrackers: nativeAd.link.click_trackers,\r\n      impressionTrackers: nativeAd.impression_trackers,\r\n      javascriptTrackers: jsTrackers\r\n    };\r\n    if (nativeAd.main_img) {\r\n      bid['native'].image = {\r\n        url: nativeAd.main_img.url,\r\n        height: nativeAd.main_img.height,\r\n        width: nativeAd.main_img.width,\r\n      };\r\n    }\r\n    if (nativeAd.icon) {\r\n      bid['native'].icon = {\r\n        url: nativeAd.icon.url,\r\n        height: nativeAd.icon.height,\r\n        width: nativeAd.icon.width,\r\n      };\r\n    }\r\n  } else {\r\n    Object.assign(bid, {\r\n      width: rtbBid.rtb.banner.width,\r\n      height: rtbBid.rtb.banner.height,\r\n      ad: rtbBid.rtb.banner.content\r\n    });\r\n    try {\r\n      if (rtbBid.rtb.trackers) {\r\n        for (let i = 0; i < rtbBid.rtb.trackers[0].impression_urls.length; i++) {\r\n          const url = rtbBid.rtb.trackers[0].impression_urls[i];\r\n          const tracker = createTrackPixelHtml(url);\r\n          bid.ad += tracker;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      logError('Error appending tracking pixel', error);\r\n    }\r\n  }\r\n\r\n  return bid;\r\n}\r\n\r\nfunction bidToTag(bid) {\r\n  const tag = {};\r\n  tag.sizes = transformSizes(bid.sizes);\r\n  tag.primary_size = tag.sizes[0];\r\n  tag.ad_types = [];\r\n  tag.uuid = bid.bidId;\r\n  if (bid.params.placementId) {\r\n    tag.id = parseInt(bid.params.placementId, 10);\r\n  } else {\r\n    tag.code = bid.params.invCode;\r\n  }\r\n  tag.allow_smaller_sizes = bid.params.allowSmallerSizes || false;\r\n  tag.use_pmt_rule = bid.params.usePaymentRule || false;\r\n  tag.prebid = true;\r\n  tag.disable_psa = true;\r\n  let bidFloor = getBidFloor(bid);\r\n  if (bidFloor) {\r\n    tag.reserve = bidFloor;\r\n  }\r\n  if (bid.params.position) {\r\n    tag.position = { 'above': 1, 'below': 2 }[bid.params.position] || 0;\r\n  } else {\r\n    let mediaTypePos = deepAccess(bid, `mediaTypes.banner.pos`) || deepAccess(bid, `mediaTypes.video.pos`);\r\n    // only support unknown, atf, and btf values for position at this time\r\n    if (mediaTypePos === 0 || mediaTypePos === 1 || mediaTypePos === 3) {\r\n      // ortb spec treats btf === 3, but our system interprets btf === 2; so converting the ortb value here for consistency\r\n      tag.position = (mediaTypePos === 3) ? 2 : mediaTypePos;\r\n    }\r\n  }\r\n  if (bid.params.trafficSourceCode) {\r\n    tag.traffic_source_code = bid.params.trafficSourceCode;\r\n  }\r\n  if (bid.params.privateSizes) {\r\n    tag.private_sizes = transformSizes(bid.params.privateSizes);\r\n  }\r\n  if (bid.params.supplyType) {\r\n    tag.supply_type = bid.params.supplyType;\r\n  }\r\n  if (bid.params.pubClick) {\r\n    tag.pubclick = bid.params.pubClick;\r\n  }\r\n  if (bid.params.extInvCode) {\r\n    tag.ext_inv_code = bid.params.extInvCode;\r\n  }\r\n  if (bid.params.publisherId) {\r\n    tag.publisher_id = parseInt(bid.params.publisherId, 10);\r\n  }\r\n  if (bid.params.externalImpId) {\r\n    tag.external_imp_id = bid.params.externalImpId;\r\n  }\r\n\r\n  let ortb2ImpKwStr = deepAccess(bid, 'ortb2Imp.ext.data.keywords');\r\n  if ((isStr(ortb2ImpKwStr) && ortb2ImpKwStr !== '') || !isEmpty(bid.params.keywords)) {\r\n    // convert ortb2 from comma list string format to bid param object format\r\n    let ortb2ImpKwObj = convertStringToKeywordsObj(ortb2ImpKwStr);\r\n\r\n    let bidParamsKwObj = (isPlainObject(bid.params.keywords)) ? deepClone(bid.params.keywords) : {};\r\n    // need to convert the string values into an array of strings, to properly merge values with other existing keys later\r\n    Object.keys(bidParamsKwObj).forEach(k => { if (isStr(bidParamsKwObj[k]) || isNumber(bidParamsKwObj[k])) bidParamsKwObj[k] = [bidParamsKwObj[k]] });\r\n\r\n    // combine both sources of keywords into one merged object (that combines the values for shared keys)\r\n    let keywordsObj = mergeDeep({}, bidParamsKwObj, ortb2ImpKwObj);\r\n\r\n    // convert to final format used by adserver\r\n    let keywordsUt = transformBidderParamKeywords(keywordsObj);\r\n    if (keywordsUt.length > 0) {\r\n      keywordsUt.forEach(deleteValues);\r\n      tag.keywords = keywordsUt;\r\n    }\r\n  }\r\n\r\n  let gpid = deepAccess(bid, 'ortb2Imp.ext.data.pbadslot');\r\n  if (gpid) {\r\n    tag.gpid = gpid;\r\n  }\r\n\r\n  if (FEATURES.NATIVE && (bid.mediaType === NATIVE || deepAccess(bid, `mediaTypes.${NATIVE}`))) {\r\n    tag.ad_types.push(NATIVE);\r\n    if (tag.sizes.length === 0) {\r\n      tag.sizes = transformSizes([1, 1]);\r\n    }\r\n\r\n    if (bid.nativeParams) {\r\n      const nativeRequest = buildNativeRequest(bid.nativeParams);\r\n      tag[NATIVE] = { layouts: [nativeRequest] };\r\n    }\r\n  }\r\n\r\n  const videoMediaType = deepAccess(bid, `mediaTypes.${VIDEO}`);\r\n  const context = deepAccess(bid, 'mediaTypes.video.context');\r\n\r\n  if (videoMediaType && context === 'adpod') {\r\n    tag.hb_source = 7;\r\n  } else {\r\n    tag.hb_source = 1;\r\n  }\r\n  if (bid.mediaType === VIDEO || videoMediaType) {\r\n    tag.ad_types.push(VIDEO);\r\n  }\r\n\r\n  // instream gets vastUrl, outstream gets vastXml\r\n  if (bid.mediaType === VIDEO || (videoMediaType && context !== 'outstream')) {\r\n    tag.require_asset_url = true;\r\n  }\r\n\r\n  if (bid.params.video) {\r\n    tag.video = {};\r\n    // place any valid video params on the tag\r\n    Object.keys(bid.params.video)\r\n      .filter(param => includes(VIDEO_TARGETING, param))\r\n      .forEach(param => {\r\n        switch (param) {\r\n          case 'context':\r\n          case 'playback_method':\r\n            let type = bid.params.video[param];\r\n            type = (isArray(type)) ? type[0] : type;\r\n            tag.video[param] = VIDEO_MAPPING[param][type];\r\n            break;\r\n          // Deprecating tags[].video.frameworks in favor of tags[].video_frameworks\r\n          case 'frameworks':\r\n            break;\r\n          default:\r\n            tag.video[param] = bid.params.video[param];\r\n        }\r\n      });\r\n\r\n    if (bid.params.video.frameworks && isArray(bid.params.video.frameworks)) {\r\n      tag['video_frameworks'] = bid.params.video.frameworks;\r\n    }\r\n  }\r\n\r\n  // use IAB ORTB values if the corresponding values weren't already set by bid.params.video\r\n  if (videoMediaType) {\r\n    tag.video = tag.video || {};\r\n    Object.keys(videoMediaType)\r\n      .filter(param => includes(VIDEO_RTB_TARGETING, param))\r\n      .forEach(param => {\r\n        switch (param) {\r\n          case 'minduration':\r\n          case 'maxduration':\r\n            if (typeof tag.video[param] !== 'number') tag.video[param] = videoMediaType[param];\r\n            break;\r\n          case 'skip':\r\n            if (typeof tag.video['skippable'] !== 'boolean') tag.video['skippable'] = (videoMediaType[param] === 1);\r\n            break;\r\n          case 'skipafter':\r\n            if (typeof tag.video['skipoffset'] !== 'number') tag.video['skippoffset'] = videoMediaType[param];\r\n            break;\r\n          case 'playbackmethod':\r\n            if (typeof tag.video['playback_method'] !== 'number') {\r\n              let type = videoMediaType[param];\r\n              type = (isArray(type)) ? type[0] : type;\r\n\r\n              // we only support iab's options 1-4 at this time.\r\n              if (type >= 1 && type <= 4) {\r\n                tag.video['playback_method'] = type;\r\n              }\r\n            }\r\n            break;\r\n          case 'api':\r\n            if (!tag['video_frameworks'] && isArray(videoMediaType[param])) {\r\n              // need to read thru array; remove 6 (we don't support it), swap 4 <> 5 if found (to match our adserver mapping for these specific values)\r\n              let apiTmp = videoMediaType[param].map(val => {\r\n                let v = (val === 4) ? 5 : (val === 5) ? 4 : val;\r\n\r\n                if (v >= 1 && v <= 5) {\r\n                  return v;\r\n                }\r\n              }).filter(v => v);\r\n              tag['video_frameworks'] = apiTmp;\r\n            }\r\n            break;\r\n        }\r\n      });\r\n  }\r\n\r\n  if (bid.renderer) {\r\n    tag.video = Object.assign({}, tag.video, { custom_renderer_present: true });\r\n  }\r\n\r\n  if (bid.params.frameworks && isArray(bid.params.frameworks)) {\r\n    tag['banner_frameworks'] = bid.params.frameworks;\r\n  }\r\n\r\n  let adUnit = find(auctionManager.getAdUnits(), au => bid.transactionId === au.transactionId);\r\n  if (adUnit && adUnit.mediaTypes && adUnit.mediaTypes.banner) {\r\n    tag.ad_types.push(BANNER);\r\n  }\r\n\r\n  if (tag.ad_types.length === 0) {\r\n    delete tag.ad_types;\r\n  }\r\n\r\n  return tag;\r\n}\r\n\r\n/* Turn bid request sizes into ut-compatible format */\r\nfunction transformSizes(requestSizes) {\r\n  let sizes = [];\r\n  let sizeObj = {};\r\n\r\n  if (isArray(requestSizes) && requestSizes.length === 2 &&\r\n    !isArray(requestSizes[0])) {\r\n    sizeObj.width = parseInt(requestSizes[0], 10);\r\n    sizeObj.height = parseInt(requestSizes[1], 10);\r\n    sizes.push(sizeObj);\r\n  } else if (typeof requestSizes === 'object') {\r\n    for (let i = 0; i < requestSizes.length; i++) {\r\n      let size = requestSizes[i];\r\n      sizeObj = {};\r\n      sizeObj.width = parseInt(size[0], 10);\r\n      sizeObj.height = parseInt(size[1], 10);\r\n      sizes.push(sizeObj);\r\n    }\r\n  }\r\n\r\n  return sizes;\r\n}\r\n\r\nfunction hasUserInfo(bid) {\r\n  return !!bid.params.user;\r\n}\r\n\r\nfunction hasMemberId(bid) {\r\n  return !!parseInt(bid.params.member, 10);\r\n}\r\n\r\nfunction hasAppDeviceInfo(bid) {\r\n  if (bid.params) {\r\n    return !!bid.params.app\r\n  }\r\n}\r\n\r\nfunction hasAppId(bid) {\r\n  if (bid.params && bid.params.app) {\r\n    return !!bid.params.app.id\r\n  }\r\n  return !!bid.params.app\r\n}\r\n\r\nfunction hasDebug(bid) {\r\n  return !!bid.debug\r\n}\r\n\r\nfunction hasAdPod(bid) {\r\n  return (\r\n    bid.mediaTypes &&\r\n    bid.mediaTypes.video &&\r\n    bid.mediaTypes.video.context === ADPOD\r\n  );\r\n}\r\n\r\nfunction hasOmidSupport(bid) {\r\n  let hasOmid = false;\r\n  const bidderParams = bid.params;\r\n  const videoParams = bid.params.video;\r\n  if (bidderParams.frameworks && isArray(bidderParams.frameworks)) {\r\n    hasOmid = includes(bid.params.frameworks, 6);\r\n  }\r\n  if (!hasOmid && videoParams && videoParams.frameworks && isArray(videoParams.frameworks)) {\r\n    hasOmid = includes(bid.params.video.frameworks, 6);\r\n  }\r\n  return hasOmid;\r\n}\r\n\r\n/**\r\n * Expand an adpod placement into a set of request objects according to the\r\n * total adpod duration and the range of duration seconds. Sets minduration/\r\n * maxduration video property according to requireExactDuration configuration\r\n */\r\nfunction createAdPodRequest(tags, adPodBid) {\r\n  const { durationRangeSec, requireExactDuration } = adPodBid.mediaTypes.video;\r\n\r\n  const numberOfPlacements = getAdPodPlacementNumber(adPodBid.mediaTypes.video);\r\n  const maxDuration = getMaxValueFromArray(durationRangeSec);\r\n\r\n  const tagToDuplicate = tags.filter(tag => tag.uuid === adPodBid.bidId);\r\n  let request = fill(...tagToDuplicate, numberOfPlacements);\r\n\r\n  if (requireExactDuration) {\r\n    const divider = Math.ceil(numberOfPlacements / durationRangeSec.length);\r\n    const chunked = chunk(request, divider);\r\n\r\n    // each configured duration is set as min/maxduration for a subset of requests\r\n    durationRangeSec.forEach((duration, index) => {\r\n      chunked[index].map(tag => {\r\n        setVideoProperty(tag, 'minduration', duration);\r\n        setVideoProperty(tag, 'maxduration', duration);\r\n      });\r\n    });\r\n  } else {\r\n    // all maxdurations should be the same\r\n    request.map(tag => setVideoProperty(tag, 'maxduration', maxDuration));\r\n  }\r\n\r\n  return request;\r\n}\r\n\r\nfunction getAdPodPlacementNumber(videoParams) {\r\n  const { adPodDurationSec, durationRangeSec, requireExactDuration } = videoParams;\r\n  const minAllowedDuration = getMinValueFromArray(durationRangeSec);\r\n  const numberOfPlacements = Math.floor(adPodDurationSec / minAllowedDuration);\r\n\r\n  return requireExactDuration\r\n    ? Math.max(numberOfPlacements, durationRangeSec.length)\r\n    : numberOfPlacements;\r\n}\r\n\r\nfunction setVideoProperty(tag, key, value) {\r\n  if (isEmpty(tag.video)) { tag.video = {}; }\r\n  tag.video[key] = value;\r\n}\r\n\r\nfunction getRtbBid(tag) {\r\n  return tag && tag.ads && tag.ads.length && find(tag.ads, ad => ad.rtb);\r\n}\r\n\r\nfunction buildNativeRequest(params) {\r\n  const request = {};\r\n\r\n  // map standard prebid native asset identifier to /ut parameters\r\n  // e.g., tag specifies `body` but /ut only knows `description`.\r\n  // mapping may be in form {tag: '<server name>'} or\r\n  // {tag: {serverName: '<server name>', requiredParams: {...}}}\r\n  Object.keys(params).forEach(key => {\r\n    // check if one of the <server name> forms is used, otherwise\r\n    // a mapping wasn't specified so pass the key straight through\r\n    const requestKey =\r\n      (NATIVE_MAPPING[key] && NATIVE_MAPPING[key].serverName) ||\r\n      NATIVE_MAPPING[key] ||\r\n      key;\r\n\r\n    // required params are always passed on request\r\n    const requiredParams = NATIVE_MAPPING[key] && NATIVE_MAPPING[key].requiredParams;\r\n    request[requestKey] = Object.assign({}, requiredParams, params[key]);\r\n\r\n    // convert the sizes of image/icon assets to proper format (if needed)\r\n    const isImageAsset = !!(requestKey === NATIVE_MAPPING.image.serverName || requestKey === NATIVE_MAPPING.icon.serverName);\r\n    if (isImageAsset && request[requestKey].sizes) {\r\n      let sizes = request[requestKey].sizes;\r\n      if (isArrayOfNums(sizes) || (isArray(sizes) && sizes.length > 0 && sizes.every(sz => isArrayOfNums(sz)))) {\r\n        request[requestKey].sizes = transformSizes(request[requestKey].sizes);\r\n      }\r\n    }\r\n\r\n    if (requestKey === NATIVE_MAPPING.privacyLink) {\r\n      request.privacy_supported = true;\r\n    }\r\n  });\r\n\r\n  return request;\r\n}\r\n\r\n/**\r\n * This function hides google div container for outstream bids to remove unwanted space on page. Appnexus renderer creates a new iframe outside of google iframe to render the outstream creative.\r\n * @param {string} elementId element id\r\n */\r\nfunction hidedfpContainer(elementId) {\r\n  try {\r\n    const el = document.getElementById(elementId).querySelectorAll(\"div[id^='google_ads']\");\r\n    if (el[0]) {\r\n      el[0].style.setProperty('display', 'none');\r\n    }\r\n  } catch (e) {\r\n    // element not found!\r\n  }\r\n}\r\n\r\nfunction hideSASIframe(elementId) {\r\n  try {\r\n    // find script tag with id 'sas_script'. This ensures it only works if you're using Smart Ad Server.\r\n    const el = document.getElementById(elementId).querySelectorAll(\"script[id^='sas_script']\");\r\n    if (el[0].nextSibling && el[0].nextSibling.localName === 'iframe') {\r\n      el[0].nextSibling.style.setProperty('display', 'none');\r\n    }\r\n  } catch (e) {\r\n    // element not found!\r\n  }\r\n}\r\n\r\nfunction outstreamRender(bid, doc) {\r\n  hidedfpContainer(bid.adUnitCode);\r\n  hideSASIframe(bid.adUnitCode);\r\n  // push to render queue because ANOutstreamVideo may not be loaded yet\r\n  bid.renderer.push(() => {\r\n    const win = getWindowFromDocument(doc) || window;\r\n    win.ANOutstreamVideo.renderAd({\r\n      tagId: bid.adResponse.tag_id,\r\n      sizes: [bid.getSize().split('x')],\r\n      targetId: bid.adUnitCode, // target div id to render video\r\n      uuid: bid.adResponse.uuid,\r\n      adResponse: bid.adResponse,\r\n      rendererOptions: bid.renderer.getConfig()\r\n    }, handleOutstreamRendererEvents.bind(null, bid));\r\n  });\r\n}\r\n\r\nfunction handleOutstreamRendererEvents(bid, id, eventName) {\r\n  bid.renderer.handleVideoEvent({ id, eventName });\r\n}\r\n\r\nfunction parseMediaType(rtbBid) {\r\n  const adType = rtbBid.ad_type;\r\n  if (adType === VIDEO) {\r\n    return VIDEO;\r\n  } else if (adType === NATIVE) {\r\n    return NATIVE;\r\n  } else {\r\n    return BANNER;\r\n  }\r\n}\r\n\r\nfunction addUserId(eids, id, source, rti) {\r\n  if (id) {\r\n    if (rti) {\r\n      eids.push({ source, id, rti_partner: rti });\r\n    } else {\r\n      eids.push({ source, id });\r\n    }\r\n  }\r\n  return eids;\r\n}\r\n\r\nfunction getBidFloor(bid) {\r\n  if (!isFn(bid.getFloor)) {\r\n    return (bid.params.reserve) ? bid.params.reserve : null;\r\n  }\r\n\r\n  let floor = bid.getFloor({\r\n    currency: 'USD',\r\n    mediaType: '*',\r\n    size: '*'\r\n  });\r\n  if (isPlainObject(floor) && !isNaN(floor.floor) && floor.currency === 'USD') {\r\n    return floor.floor;\r\n  }\r\n  return null;\r\n}\r\n\r\n// keywords: { 'genre': ['rock', 'pop'], 'pets': ['dog'] } goes to 'genre=rock,genre=pop,pets=dog'\r\nfunction convertKeywordsToString(keywords) {\r\n  let result = '';\r\n  Object.keys(keywords).forEach(key => {\r\n    // if 'text' or ''\r\n    if (isStr(keywords[key])) {\r\n      if (keywords[key] !== '') {\r\n        result += `${key}=${keywords[key]},`\r\n      } else {\r\n        result += `${key},`;\r\n      }\r\n    } else if (isArray(keywords[key])) {\r\n      if (keywords[key][0] === '') {\r\n        result += `${key},`\r\n      } else {\r\n        keywords[key].forEach(val => {\r\n          result += `${key}=${val},`\r\n        });\r\n      }\r\n    }\r\n  });\r\n\r\n  // remove last trailing comma\r\n  result = result.substring(0, result.length - 1);\r\n  return result;\r\n}\r\n\r\n// converts a comma separated list of keywords into the standard keyword object format used in appnexus bid params\r\n// 'genre=rock,genre=pop,pets=dog,music' goes to { 'genre': ['rock', 'pop'], 'pets': ['dog'], 'music': [''] }\r\nfunction convertStringToKeywordsObj(keyStr) {\r\n  let result = {};\r\n\r\n  if (isStr(keyStr) && keyStr !== '') {\r\n    // will split based on commas and will eat white space before/after the comma\r\n    let keywordList = keyStr.split(/\\s*(?:,)\\s*/);\r\n    keywordList.forEach(kw => {\r\n      // if = exists, then split\r\n      if (kw.indexOf('=') !== -1) {\r\n        let kwPair = kw.split('=');\r\n        let key = kwPair[0];\r\n        let val = kwPair[1];\r\n\r\n        // then check for existing key in result > if so add value to the array > if not, add new key and create value array\r\n        if (result.hasOwnProperty(key)) {\r\n          result[key].push(val);\r\n        } else {\r\n          result[key] = [val];\r\n        }\r\n      } else {\r\n        // make a key with '' value; if key already exists > don't add\r\n        if (!result.hasOwnProperty(kw)) {\r\n          result[kw] = [''];\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nregisterBidder(spec);\r\n","import {deepAccess} from '../utils.js';\r\n\r\n/**\r\n * Check if GDPR purpose 1 consent was given.\r\n *\r\n * @param gdprConsent GDPR consent data\r\n * @returns {boolean} true if the gdprConsent is null-y; or GDPR does not apply; or if purpose 1 consent was given.\r\n */\r\nexport function hasPurpose1Consent(gdprConsent) {\r\n  if (gdprConsent?.gdprApplies) {\r\n    return deepAccess(gdprConsent, 'vendorData.purpose.consents.1') === true;\r\n  }\r\n  return true;\r\n}\r\n","import {ajax} from '../src/ajax.js';\r\nimport adapter from '../libraries/analyticsAdapter/AnalyticsAdapter.js';\r\nimport CONSTANTS from '../src/constants.json';\r\nimport {getGlobal} from '../src/prebidGlobal.js';\r\nimport adapterManager from '../src/adapterManager.js';\r\nimport {logInfo, logError, logMessage, deepAccess, isInteger} from '../src/utils.js';\r\n\r\nconst {\r\n  EVENTS: { AUCTION_END, AD_RENDER_FAILED, BID_TIMEOUT, BID_WON }\r\n} = CONSTANTS;\r\nconst GVLID = 24;\r\nconst ANALYTICS_TYPE = 'endpoint';\r\n\r\n// for local testing set domain to 127.0.0.1:8290\r\nconst URL = 'https://web.hb.ad.cpe.dotomi.com/cvx/event/prebidanalytics';\r\nconst ANALYTICS_CODE = 'conversant';\r\n\r\nexport const CNVR_CONSTANTS = {\r\n  LOG_PREFIX: 'Conversant analytics adapter: ',\r\n  // Maximum time to keep an item in the cache before it gets purged\r\n  MAX_MILLISECONDS_IN_CACHE: 30000,\r\n  // How often cache cleanup will run\r\n  CACHE_CLEANUP_TIME_IN_MILLIS: 30000,\r\n  // Should be float from 0-1, 0 is turned off, 1 is sample every instance\r\n  DEFAULT_SAMPLE_RATE: 1,\r\n\r\n  // BID STATUS CODES\r\n  WIN: 10,\r\n  BID: 20,\r\n  NO_BID: 30,\r\n  TIMEOUT: 40,\r\n  RENDER_FAILED: 50\r\n};\r\n\r\n// Saves passed in options from the bid adapter\r\nconst initOptions = {};\r\n\r\n// Simple flag to help handle any tear down needed on disable\r\nlet conversantAnalyticsEnabled = false;\r\n\r\nexport const cnvrHelper = {\r\n  // Turns on sampling for an instance of prebid analytics.\r\n  doSample: true,\r\n\r\n  /**\r\n   * Used to hold data for RENDER FAILED events so we can send a payload back that will match our original auction data.\r\n   * Contains the following key/value data:\r\n   * <adId> => {\r\n   *     'bidderCode': <bidderCode>,\r\n   *     'adUnitCode': <adUnitCode>,\r\n   *     'auctionId': <auctionId>,\r\n   *     'timeReceived': Date.now()  //For cache cleaning\r\n   * }\r\n   */\r\n  adIdLookup: {},\r\n\r\n  /**\r\n   * Time out events happen before AUCTION END so we can save them in a cache and report them at the same time as the\r\n   * AUCTION END event.  Has the following data and key is based off of auctionId, adUnitCode, bidderCode from\r\n   * keyStr = getLookupKey(auctionId, adUnitCode, bidderCode);\r\n   * <keyStr> => {\r\n   *     timeReceived: Date.now() //so cache can be purged in case it doesn't get cleaned out at auctionEnd\r\n   * }\r\n   */\r\n  timeoutCache: {},\r\n\r\n  /**\r\n   * Lookup of auction IDs to auction start timestamps\r\n   */\r\n  auctionIdTimestampCache: {}\r\n};\r\n\r\n/**\r\n * Cleanup timer for the adIdLookup and timeoutCache caches. If all works properly then the caches are self-cleaning\r\n * but in case something goes sideways we poll periodically to cleanup old values to prevent a memory leak\r\n */\r\nlet cacheCleanupInterval;\r\n\r\nlet conversantAnalytics = Object.assign(\r\n  adapter({URL, ANALYTICS_TYPE}),\r\n  {\r\n    track({eventType, args}) {\r\n      if (cnvrHelper.doSample) {\r\n        logMessage(CNVR_CONSTANTS.LOG_PREFIX + ' track(): ' + eventType, args);\r\n        switch (eventType) {\r\n          case AUCTION_END:\r\n            onAuctionEnd(args);\r\n            break;\r\n          case AD_RENDER_FAILED:\r\n            onAdRenderFailed(args);\r\n            break;\r\n          case BID_WON:\r\n            onBidWon(args);\r\n            break;\r\n          case BID_TIMEOUT:\r\n            onBidTimeout(args);\r\n            break;\r\n        } // END switch\r\n      } else {\r\n        logMessage(CNVR_CONSTANTS.LOG_PREFIX + ' - ' + eventType + ': skipped due to sampling');\r\n      }// END IF(cnvrHelper.doSample)\r\n    } // END track()\r\n  }\r\n);\r\n\r\n// ================================================== EVENT HANDLERS ===================================================\r\n/**\r\n * We get the list of timeouts before the endAution, cache them temporarily in a global cache and the endAuction event\r\n * will pick them up.  Uses getLookupKey() to create the key to the entry from auctionId, adUnitCode and bidderCode.\r\n * Saves a single value of timeReceived so we can do cache purging periodically.\r\n *\r\n * Current assumption is that the timeout will always be an array even if it is just one object in the array.\r\n * @param args  [{\r\n    \"bidId\": \"80882409358b8a8\",\r\n    \"bidder\": \"conversant\",\r\n    \"adUnitCode\": \"MedRect\",\r\n    \"auctionId\": \"afbd6e0b-e45b-46ab-87bf-c0bac0cb8881\"\r\n  }, {\r\n    \"bidId\": \"9da4c107a6f24c8\",\r\n    \"bidder\": \"conversant\",\r\n    \"adUnitCode\": \"Leaderboard\",\r\n    \"auctionId\": \"afbd6e0b-e45b-46ab-87bf-c0bac0cb8881\"\r\n  }\r\n ]\r\n */\r\nfunction onBidTimeout(args) {\r\n  args.forEach(timedOutBid => {\r\n    const timeoutCacheKey = cnvrHelper.getLookupKey(timedOutBid.auctionId, timedOutBid.adUnitCode, timedOutBid.bidder);\r\n    cnvrHelper.timeoutCache[timeoutCacheKey] = {\r\n      timeReceived: Date.now()\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Bid won occurs after auctionEnd so we need to send this separately. We also save an entry in the adIdLookup cache\r\n * so that if the render fails we can match up important data so we can send a valid RENDER FAILED event back.\r\n * @param args bidWon args\r\n */\r\nfunction onBidWon(args) {\r\n  const bidderCode = args.bidderCode;\r\n  const adUnitCode = args.adUnitCode;\r\n  const auctionId = args.auctionId;\r\n  let timestamp = args.requestTimestamp ? args.requestTimestamp : Date.now();\r\n\r\n  // Make sure we have all the data we need\r\n  if (!bidderCode || !adUnitCode || !auctionId) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onBidWon() did not get all the necessary data to process the event.');\r\n    return;\r\n  }\r\n\r\n  if (cnvrHelper.auctionIdTimestampCache[auctionId]) {\r\n    timestamp = cnvrHelper.auctionIdTimestampCache[auctionId].timeReceived; // Don't delete, could be multiple winners/auction, allow cleanup to handle\r\n  }\r\n\r\n  const bidWonPayload = cnvrHelper.createPayload('bid_won', auctionId, timestamp);\r\n\r\n  const adUnitPayload = cnvrHelper.createAdUnit();\r\n  bidWonPayload.adUnits[adUnitCode] = adUnitPayload;\r\n\r\n  const bidPayload = cnvrHelper.createBid(CNVR_CONSTANTS.WIN, args.timeToRespond);\r\n  bidPayload.adSize = cnvrHelper.createAdSize(args.width, args.height);\r\n  bidPayload.cpm = args.cpm;\r\n  bidPayload.originalCpm = args.originalCpm;\r\n  bidPayload.currency = args.currency;\r\n  bidPayload.mediaType = args.mediaType;\r\n  adUnitPayload.bids[bidderCode] = [bidPayload];\r\n\r\n  if (!cnvrHelper.adIdLookup[args.adId]) {\r\n    cnvrHelper.adIdLookup[args.adId] = {\r\n      'bidderCode': bidderCode,\r\n      'adUnitCode': adUnitCode,\r\n      'auctionId': auctionId,\r\n      'timeReceived': Date.now() // For cache cleaning\r\n    };\r\n  }\r\n\r\n  sendData(bidWonPayload);\r\n}\r\n\r\n/**\r\n * RENDER FAILED occurs after AUCTION END and BID WON, the payload does not have all the data we need so we use\r\n * adIdLookup to pull data from a BID WON event to populate our payload\r\n * @param args = {\r\n *  reason: <value>\r\n *  message: <value>\r\n *  adId: <value> --optional\r\n *  bid: {object?} --optional: unsure what this looks like but guessing it is {bidder: <value>, params: {object}}\r\n *    }\r\n */\r\nfunction onAdRenderFailed(args) {\r\n  const adId = args.adId;\r\n  // Make sure we have all the data we need, adId is optional so it's not guaranteed, without that we can't match it up\r\n  // to our adIdLookup data.\r\n  if (!adId || !cnvrHelper.adIdLookup[adId]) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + \"onAdRenderFailed(): Unable to process RENDER FAILED because adId is missing or doesn't match a record in our cache.\");\r\n    return; // Either no adId to match against a bidWon event, or no data saved from a bidWon event that matches the adId\r\n  }\r\n  const adIdObj = cnvrHelper.adIdLookup[adId];\r\n  const adUnitCode = adIdObj['adUnitCode'];\r\n  const bidderCode = adIdObj['bidderCode'];\r\n  const auctionId = adIdObj['auctionId'];\r\n  delete cnvrHelper.adIdLookup[adId]; // cleanup our cache\r\n\r\n  if (!bidderCode || !adUnitCode || !auctionId) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onAdRenderFailed(): Unable to process RENDER FAILED because lookup cache did not have all the data we required.');\r\n    return;\r\n  }\r\n\r\n  let timestamp = Date.now();\r\n  if (cnvrHelper.auctionIdTimestampCache[auctionId]) {\r\n    timestamp = cnvrHelper.auctionIdTimestampCache[auctionId].timeReceived; // Don't delete, could be multiple winners/auction, allow cleanup to handle\r\n  }\r\n\r\n  const renderFailedPayload = cnvrHelper.createPayload('render_failed', auctionId, timestamp);\r\n  const adUnitPayload = cnvrHelper.createAdUnit();\r\n  adUnitPayload.bids[bidderCode] = [cnvrHelper.createBid(CNVR_CONSTANTS.RENDER_FAILED, 0)];\r\n  adUnitPayload.bids[bidderCode][0].message = 'REASON: ' + args.reason + '. MESSAGE: ' + args.message;\r\n  renderFailedPayload.adUnits[adUnitCode] = adUnitPayload;\r\n  sendData(renderFailedPayload);\r\n}\r\n\r\n/**\r\n * AUCTION END contains bid and no bid info and all of the auction info we need. This sends the bulk of the information\r\n * about the auction back to the servers.  It will also check the timeoutCache for any matching bids, if any are found\r\n * then they will be removed from the cache and send back with this payload.\r\n * @param args AUCTION END payload, fairly large data structure, main objects are 'adUnits[]', 'bidderRequests[]',\r\n * 'noBids[]', 'bidsReceived[]'... 'winningBids[]' seems to be always blank.\r\n */\r\nfunction onAuctionEnd(args) {\r\n  const auctionId = args.auctionId;\r\n  if (!auctionId) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onAuctionEnd(): No auctionId in args supplied so unable to process event.');\r\n    return;\r\n  }\r\n\r\n  const auctionTimestamp = args.timestamp ? args.timestamp : Date.now();\r\n  cnvrHelper.auctionIdTimestampCache[auctionId] = { timeReceived: auctionTimestamp };\r\n\r\n  const auctionEndPayload = cnvrHelper.createPayload('auction_end', auctionId, auctionTimestamp);\r\n  // Get bid request information from adUnits\r\n  if (!Array.isArray(args.adUnits)) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onAuctionEnd(): adUnits not defined in arguments.');\r\n    return;\r\n  }\r\n\r\n  args.adUnits.forEach(adUnit => {\r\n    const cnvrAdUnit = cnvrHelper.createAdUnit();\r\n    // Initialize bids with bidderCode\r\n    adUnit.bids.forEach(bid => {\r\n      cnvrAdUnit.bids[bid.bidder] = []; // support multiple bids from a bidder for different sizes/media types //cnvrHelper.initializeBidDefaults();\r\n\r\n      // Check for cached timeout responses\r\n      const timeoutKey = cnvrHelper.getLookupKey(auctionId, adUnit.code, bid.bidder);\r\n      if (cnvrHelper.timeoutCache[timeoutKey]) {\r\n        cnvrAdUnit.bids[bid.bidder].push(cnvrHelper.createBid(CNVR_CONSTANTS.TIMEOUT, args.timeout));\r\n        delete cnvrHelper.timeoutCache[timeoutKey];\r\n      }\r\n    });\r\n\r\n    // Ad media types for the ad slot\r\n    if (cnvrHelper.keyExistsAndIsObject(adUnit, 'mediaTypes')) {\r\n      Object.entries(adUnit.mediaTypes).forEach(([mediaTypeName]) => {\r\n        cnvrAdUnit.mediaTypes.push(mediaTypeName);\r\n      });\r\n    }\r\n\r\n    // Ad sizes listed under the size key\r\n    if (Array.isArray(adUnit.sizes) && adUnit.sizes.length >= 1) {\r\n      adUnit.sizes.forEach(size => {\r\n        if (!Array.isArray(size) || size.length !== 2) {\r\n          logMessage(CNVR_CONSTANTS.LOG_PREFIX + 'Unknown object while retrieving adUnit sizes.', adUnit);\r\n          return; // skips to next item\r\n        }\r\n        cnvrAdUnit.sizes.push(cnvrHelper.createAdSize(size[0], size[1]));\r\n      });\r\n    }\r\n\r\n    // If the Ad Slot is not unique then ad sizes and media types merge them together\r\n    if (auctionEndPayload.adUnits[adUnit.code]) {\r\n      // Merge ad sizes\r\n      Array.prototype.push.apply(auctionEndPayload.adUnits[adUnit.code].sizes, cnvrAdUnit.sizes);\r\n      // Merge mediaTypes\r\n      Array.prototype.push.apply(auctionEndPayload.adUnits[adUnit.code].mediaTypes, cnvrAdUnit.mediaTypes);\r\n    } else {\r\n      auctionEndPayload.adUnits[adUnit.code] = cnvrAdUnit;\r\n    }\r\n  });\r\n\r\n  if (Array.isArray(args.noBids)) {\r\n    args.noBids.forEach(noBid => {\r\n      const bidPayloadArray = deepAccess(auctionEndPayload, 'adUnits.' + noBid.adUnitCode + '.bids.' + noBid.bidder);\r\n\r\n      if (bidPayloadArray) {\r\n        bidPayloadArray.push(cnvrHelper.createBid(CNVR_CONSTANTS.NO_BID, 0)); // no time to respond info for this, would have to capture event and save it there\r\n      } else {\r\n        logMessage(CNVR_CONSTANTS.LOG_PREFIX + 'Unable to locate bid object via adUnitCode/bidderCode in payload for noBid reply in END_AUCTION', Object.assign({}, noBid));\r\n      }\r\n    });\r\n  } else {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onAuctionEnd(): noBids not defined in arguments.');\r\n  }\r\n\r\n  // Get bid data from bids sent\r\n  if (Array.isArray(args.bidsReceived)) {\r\n    args.bidsReceived.forEach(bid => {\r\n      const bidPayloadArray = deepAccess(auctionEndPayload, 'adUnits.' + bid.adUnitCode + '.bids.' + bid.bidderCode);\r\n      if (bidPayloadArray) {\r\n        const bidPayload = cnvrHelper.createBid(CNVR_CONSTANTS.BID, bid.timeToRespond);\r\n        bidPayload.originalCpm = bid.originalCpm;\r\n        bidPayload.cpm = bid.cpm;\r\n        bidPayload.currency = bid.currency;\r\n        bidPayload.mediaType = bid.mediaType;\r\n        bidPayload.adSize = {\r\n          'w': bid.width,\r\n          'h': bid.height\r\n        };\r\n        bidPayloadArray.push(bidPayload);\r\n      } else {\r\n        logMessage(CNVR_CONSTANTS.LOG_PREFIX + 'Unable to locate bid object via adUnitCode/bidderCode in payload for bid reply in END_AUCTION', Object.assign({}, bid));\r\n      }\r\n    });\r\n  } else {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'onAuctionEnd(): bidsReceived not defined in arguments.');\r\n  }\r\n  // We need to remove any duplicate ad sizes from merging ad-slots or overlap in different media types and also\r\n  // media-types from merged ad-slots in twin bids.\r\n  Object.keys(auctionEndPayload.adUnits).forEach(function(adCode) {\r\n    auctionEndPayload.adUnits[adCode].sizes = cnvrHelper.deduplicateArray(auctionEndPayload.adUnits[adCode].sizes);\r\n    auctionEndPayload.adUnits[adCode].mediaTypes = cnvrHelper.deduplicateArray(auctionEndPayload.adUnits[adCode].mediaTypes);\r\n  });\r\n\r\n  sendData(auctionEndPayload);\r\n}\r\n\r\n// =============================================== START OF HELPERS ===================================================\r\n\r\n/**\r\n * Helper to verify a key exists and is a data type of Object (not a function, or array)\r\n * @param parent The parent that we want to check the key for\r\n * @param key The key which we want to check\r\n * @returns {boolean} True if it's an object and exists, false otherwise (null, array, primitive, function)\r\n */\r\ncnvrHelper.keyExistsAndIsObject = function (parent, key) {\r\n  if (!parent.hasOwnProperty(key)) {\r\n    return false;\r\n  }\r\n  return typeof parent[key] === 'object' &&\r\n    !Array.isArray(parent[key]) &&\r\n    parent[key] !== null;\r\n}\r\n\r\n/**\r\n * De-duplicate an array that could contain primitives or objects/associative arrays.\r\n * A temporary array is used to store a string representation of each object that we look at.  If an object matches\r\n * one found in the temp array then it is ignored.\r\n * @param array An array\r\n * @returns {*} A de-duplicated array.\r\n */\r\ncnvrHelper.deduplicateArray = function(array) {\r\n  if (!array || !Array.isArray(array)) {\r\n    return array;\r\n  }\r\n\r\n  const tmpArray = [];\r\n  return array.filter(function (tmpObj) {\r\n    if (tmpArray.indexOf(JSON.stringify(tmpObj)) < 0) {\r\n      tmpArray.push(JSON.stringify(tmpObj));\r\n      return tmpObj;\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Generic method to look at each key/value pair of a cache object and looks at the 'timeReceived' key, if more than\r\n * the max wait time has passed then just delete the key.\r\n * @param cacheObj one of our cache objects [adIdLookup or timeoutCache]\r\n * @param currTime the current timestamp at the start of the most recent timer execution.\r\n */\r\ncnvrHelper.cleanCache = function(cacheObj, currTime) {\r\n  Object.keys(cacheObj).forEach(key => {\r\n    const timeInCache = currTime - cacheObj[key].timeReceived;\r\n    if (timeInCache >= CNVR_CONSTANTS.MAX_MILLISECONDS_IN_CACHE) {\r\n      delete cacheObj[key];\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Helper to create an object lookup key for our timeoutCache\r\n * @param auctionId id of the auction\r\n * @param adUnitCode ad unit code\r\n * @param bidderCode bidder code\r\n * @returns string concatenation of all the params into a string key for timeoutCache\r\n */\r\ncnvrHelper.getLookupKey = function(auctionId, adUnitCode, bidderCode) {\r\n  return auctionId + '-' + adUnitCode + '-' + bidderCode;\r\n};\r\n\r\n/**\r\n * Creates our root payload object that gets sent back to the server\r\n * @param payloadType string type of payload (AUCTION_END, BID_WON, RENDER_FAILED)\r\n * @param auctionId id for the auction\r\n * @param timestamp timestamp in milliseconds of auction start time.\r\n * @returns\r\n *  {{\r\n *    requestType: *,\r\n *    adUnits: {},\r\n *    auction: {\r\n *      auctionId: *,\r\n *      preBidVersion: *,\r\n *      sid: *}\r\n * }}  Basic structure of our object that we return to the server.\r\n */\r\ncnvrHelper.createPayload = function(payloadType, auctionId, timestamp) {\r\n  return {\r\n    requestType: payloadType,\r\n    globalSampleRate: initOptions.global_sample_rate,\r\n    cnvrSampleRate: initOptions.cnvr_sample_rate,\r\n    auction: {\r\n      auctionId: auctionId,\r\n      preBidVersion: getGlobal().version,\r\n      sid: initOptions.site_id,\r\n      auctionTimestamp: timestamp\r\n    },\r\n    adUnits: {}\r\n  };\r\n};\r\n\r\n/**\r\n * Helper to create an adSize object, if the value passed in is not an int then set it to -1\r\n * @param width in pixels (must be an int)\r\n * @param height in peixl (must be an int)\r\n * @returns {{w: *, h: *}} a fully valid adSize object\r\n */\r\ncnvrHelper.createAdSize = function(width, height) {\r\n  if (!isInteger(width)) {\r\n    width = -1;\r\n  }\r\n  if (!isInteger(height)) {\r\n    height = -1;\r\n  }\r\n  return {\r\n    'w': width,\r\n    'h': height\r\n  };\r\n};\r\n\r\n/**\r\n * Helper to create the basic structure of our adUnit payload\r\n * @returns {{sizes: [], bids: {}}} Basic adUnit payload structure as follows\r\n */\r\ncnvrHelper.createAdUnit = function() {\r\n  return {\r\n    sizes: [],\r\n    mediaTypes: [],\r\n    bids: {}\r\n  };\r\n};\r\n\r\n/**\r\n * Helper to create a basic bid payload object.\r\n */\r\ncnvrHelper.createBid = function (eventCode, timeToRespond) {\r\n  return {\r\n    'eventCodes': [eventCode],\r\n    'timeToRespond': timeToRespond\r\n  };\r\n};\r\n\r\n/**\r\n * Helper to get the sampling rates from an object and validate the result.\r\n * @param parentObj Parent object that has the sampling property\r\n * @param propNm Name of the sampling property\r\n * @param defaultSampleRate A default value to apply if there is a problem\r\n * @returns {number} returns a float number from 0 (always off) to 1 (always on)\r\n */\r\ncnvrHelper.getSampleRate = function(parentObj, propNm, defaultSampleRate) {\r\n  let sampleRate = defaultSampleRate;\r\n  if (parentObj && typeof parentObj[propNm] !== 'undefined') {\r\n    sampleRate = parseFloat(parentObj[propNm]);\r\n    if (Number.isNaN(sampleRate) || sampleRate > 1) {\r\n      sampleRate = defaultSampleRate;\r\n    } else if (sampleRate < 0) {\r\n      sampleRate = 0;\r\n    }\r\n  }\r\n  return sampleRate;\r\n}\r\n\r\n/**\r\n * Helper function to send data back to server.  Need to make sure we don't trigger a CORS preflight by not adding\r\n * extra header params.\r\n * @param payload our JSON payload from either AUCTION END, BID WIN, RENDER FAILED\r\n */\r\nfunction sendData(payload) {\r\n  ajax(URL, function () {}, JSON.stringify(payload), {contentType: 'text/plain'});\r\n}\r\n\r\n// =============================== BOILERPLATE FOR PRE-BID ANALYTICS SETUP  ============================================\r\n// save the base class function\r\nconversantAnalytics.originEnableAnalytics = conversantAnalytics.enableAnalytics;\r\nconversantAnalytics.originDisableAnalytics = conversantAnalytics.disableAnalytics;\r\n\r\n// override enableAnalytics so we can get access to the config passed in from the page\r\nconversantAnalytics.enableAnalytics = function (config) {\r\n  if (!config || !config.options || !config.options.site_id) {\r\n    logError(CNVR_CONSTANTS.LOG_PREFIX + 'siteId is required.');\r\n    return;\r\n  }\r\n\r\n  cacheCleanupInterval = setInterval(\r\n    function() {\r\n      const currTime = Date.now();\r\n      cnvrHelper.cleanCache(cnvrHelper.adIdLookup, currTime);\r\n      cnvrHelper.cleanCache(cnvrHelper.timeoutCache, currTime);\r\n      cnvrHelper.cleanCache(cnvrHelper.auctionIdTimestampCache, currTime);\r\n    },\r\n    CNVR_CONSTANTS.CACHE_CLEANUP_TIME_IN_MILLIS\r\n  );\r\n\r\n  Object.assign(initOptions, config.options);\r\n\r\n  initOptions.global_sample_rate = cnvrHelper.getSampleRate(initOptions, 'sampling', 1);\r\n  initOptions.cnvr_sample_rate = cnvrHelper.getSampleRate(initOptions, 'cnvr_sampling', CNVR_CONSTANTS.DEFAULT_SAMPLE_RATE);\r\n\r\n  logInfo(CNVR_CONSTANTS.LOG_PREFIX + 'Conversant sample rate set to ' + initOptions.cnvr_sample_rate);\r\n  logInfo(CNVR_CONSTANTS.LOG_PREFIX + 'Global sample rate set to ' + initOptions.global_sample_rate);\r\n  // Math.random() pseudo-random number in the range 0 to less than 1 (inclusive of 0, but not 1)\r\n  cnvrHelper.doSample = Math.random() < initOptions.cnvr_sample_rate;\r\n\r\n  conversantAnalyticsEnabled = true;\r\n  conversantAnalytics.originEnableAnalytics(config); // call the base class function\r\n};\r\n\r\n/**\r\n * Cleanup code for any timers and caches.\r\n */\r\nconversantAnalytics.disableAnalytics = function () {\r\n  if (!conversantAnalyticsEnabled) {\r\n    return;\r\n  }\r\n\r\n  // Cleanup our caches and disable our timer\r\n  clearInterval(cacheCleanupInterval);\r\n  cnvrHelper.timeoutCache = {};\r\n  cnvrHelper.adIdLookup = {};\r\n  cnvrHelper.auctionIdTimestampCache = {};\r\n\r\n  conversantAnalyticsEnabled = false;\r\n  conversantAnalytics.originDisableAnalytics();\r\n};\r\n\r\nadapterManager.registerAnalyticsAdapter({\r\n  adapter: conversantAnalytics,\r\n  code: ANALYTICS_CODE,\r\n  gvlid: GVLID\r\n});\r\n\r\nexport default conversantAnalytics;\r\n","import { logWarn, isStr, deepAccess, isArray, getBidIdParameter, deepSetValue, isEmpty, _each, convertTypes, parseUrl, mergeDeep, buildUrl, _map, logError, isFn, isPlainObject } from '../src/utils.js';\r\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport {BANNER, VIDEO} from '../src/mediaTypes.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\n\r\nconst GVLID = 24;\r\n\r\nconst BIDDER_CODE = 'conversant';\r\nexport const storage = getStorageManager({gvlid: GVLID, bidderCode: BIDDER_CODE});\r\nconst URL = 'https://web.hb.ad.cpe.dotomi.com/cvx/client/hb/ortb/25';\r\n\r\nexport const spec = {\r\n  code: BIDDER_CODE,\r\n  gvlid: GVLID,\r\n  aliases: ['cnvr'], // short code\r\n  supportedMediaTypes: [BANNER, VIDEO],\r\n\r\n  /**\r\n   * Determines whether or not the given bid request is valid.\r\n   *\r\n   * @param {BidRequest} bid - The bid params to validate.\r\n   * @return {boolean} True if this is a valid bid, and false otherwise.\r\n   */\r\n  isBidRequestValid: function(bid) {\r\n    if (!bid || !bid.params) {\r\n      logWarn(BIDDER_CODE + ': Missing bid parameters');\r\n      return false;\r\n    }\r\n\r\n    if (!isStr(bid.params.site_id)) {\r\n      logWarn(BIDDER_CODE + ': site_id must be specified as a string');\r\n      return false;\r\n    }\r\n\r\n    if (isVideoRequest(bid)) {\r\n      const mimes = bid.params.mimes || deepAccess(bid, 'mediaTypes.video.mimes');\r\n      if (!mimes) {\r\n        // Give a warning but let it pass\r\n        logWarn(BIDDER_CODE + ': mimes should be specified for videos');\r\n      } else if (!isArray(mimes) || !mimes.every(s => isStr(s))) {\r\n        logWarn(BIDDER_CODE + ': mimes must be an array of strings');\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  /**\r\n   * Make a server request from the list of BidRequests.\r\n   *\r\n   * @param {BidRequest[]} validBidRequests - an array of bids\r\n   * @param bidderRequest\r\n   * @return {ServerRequest} Info describing the request to the server.\r\n   */\r\n  buildRequests: function(validBidRequests, bidderRequest) {\r\n    const page = (bidderRequest && bidderRequest.refererInfo) ? bidderRequest.refererInfo.page : '';\r\n    let siteId = '';\r\n    let requestId = '';\r\n    let pubcid = null;\r\n    let pubcidName = '_pubcid';\r\n    let bidurl = URL;\r\n\r\n    const conversantImps = validBidRequests.map(function(bid) {\r\n      const bidfloor = getBidFloor(bid);\r\n\r\n      siteId = getBidIdParameter('site_id', bid.params) || siteId;\r\n      pubcidName = getBidIdParameter('pubcid_name', bid.params) || pubcidName;\r\n\r\n      requestId = bid.auctionId;\r\n\r\n      const imp = {\r\n        id: bid.bidId,\r\n        secure: 1,\r\n        bidfloor: bidfloor || 0,\r\n        displaymanager: 'Prebid.js',\r\n        displaymanagerver: '$prebid.version$'\r\n      };\r\n      if (bid.ortb2Imp) {\r\n        mergeDeep(imp, bid.ortb2Imp);\r\n      }\r\n\r\n      copyOptProperty(bid.params.tag_id, imp, 'tagid');\r\n\r\n      if (isVideoRequest(bid)) {\r\n        const videoData = deepAccess(bid, 'mediaTypes.video') || {};\r\n        const format = convertSizes(videoData.playerSize || bid.sizes);\r\n        const video = {};\r\n\r\n        if (format && format[0]) {\r\n          copyOptProperty(format[0].w, video, 'w');\r\n          copyOptProperty(format[0].h, video, 'h');\r\n        }\r\n\r\n        copyOptProperty(bid.params.position || videoData.pos, video, 'pos');\r\n        copyOptProperty(bid.params.mimes || videoData.mimes, video, 'mimes');\r\n        copyOptProperty(bid.params.maxduration || videoData.maxduration, video, 'maxduration');\r\n        copyOptProperty(bid.params.protocols || videoData.protocols, video, 'protocols');\r\n        copyOptProperty(bid.params.api || videoData.api, video, 'api');\r\n\r\n        imp.video = video;\r\n      } else {\r\n        const bannerData = deepAccess(bid, 'mediaTypes.banner') || {};\r\n        const format = convertSizes(bannerData.sizes || bid.sizes);\r\n        const banner = {format: format};\r\n\r\n        copyOptProperty(bid.params.position || bannerData.pos, banner, 'pos');\r\n\r\n        imp.banner = banner;\r\n      }\r\n\r\n      if (bid.userId && bid.userId.pubcid) {\r\n        pubcid = bid.userId.pubcid;\r\n      } else if (bid.crumbs && bid.crumbs.pubcid) {\r\n        pubcid = bid.crumbs.pubcid;\r\n      }\r\n      if (bid.params.white_label_url) {\r\n        bidurl = bid.params.white_label_url;\r\n      }\r\n\r\n      return imp;\r\n    });\r\n\r\n    const payload = {\r\n      id: requestId,\r\n      imp: conversantImps,\r\n      site: {\r\n        id: siteId,\r\n        mobile: document.querySelector('meta[name=\"viewport\"][content*=\"width=device-width\"]') !== null ? 1 : 0,\r\n        page: page\r\n      },\r\n      device: getDevice(),\r\n      at: 1\r\n    };\r\n\r\n    let userExt = {};\r\n\r\n    // pass schain object if it is present\r\n    const schain = deepAccess(validBidRequests, '0.schain');\r\n    if (schain) {\r\n      deepSetValue(payload, 'source.ext.schain', schain);\r\n    }\r\n\r\n    if (bidderRequest) {\r\n      // Add GDPR flag and consent string\r\n      if (bidderRequest.gdprConsent) {\r\n        userExt.consent = bidderRequest.gdprConsent.consentString;\r\n\r\n        if (typeof bidderRequest.gdprConsent.gdprApplies === 'boolean') {\r\n          deepSetValue(payload, 'regs.ext.gdpr', bidderRequest.gdprConsent.gdprApplies ? 1 : 0);\r\n        }\r\n      }\r\n\r\n      if (bidderRequest.uspConsent) {\r\n        deepSetValue(payload, 'regs.ext.us_privacy', bidderRequest.uspConsent);\r\n      }\r\n    }\r\n\r\n    if (!pubcid) {\r\n      pubcid = readStoredValue(pubcidName);\r\n    }\r\n\r\n    // Add common id if available\r\n    if (pubcid) {\r\n      userExt.fpc = pubcid;\r\n    }\r\n\r\n    // Add Eids if available\r\n    const eids = collectEids(validBidRequests);\r\n    if (eids.length > 0) {\r\n      userExt.eids = eids;\r\n    }\r\n\r\n    // Only add the user object if it's not empty\r\n    if (!isEmpty(userExt)) {\r\n      payload.user = {ext: userExt};\r\n    }\r\n\r\n    const firstPartyData = bidderRequest.ortb2 || {};\r\n    mergeDeep(payload, firstPartyData);\r\n\r\n    return {\r\n      method: 'POST',\r\n      url: bidurl,\r\n      data: payload,\r\n    };\r\n  },\r\n  /**\r\n   * Unpack the response from the server into a list of bids.\r\n   *\r\n   * @param {*} serverResponse A successful response from the server.\r\n   * @param bidRequest\r\n   * @return {Bid[]} An array of bids which were nested inside the server.\r\n   */\r\n  interpretResponse: function(serverResponse, bidRequest) {\r\n    const bidResponses = [];\r\n    const requestMap = {};\r\n    serverResponse = serverResponse.body;\r\n\r\n    if (bidRequest && bidRequest.data && bidRequest.data.imp) {\r\n      _each(bidRequest.data.imp, imp => requestMap[imp.id] = imp);\r\n    }\r\n\r\n    if (serverResponse && isArray(serverResponse.seatbid)) {\r\n      _each(serverResponse.seatbid, function(bidList) {\r\n        _each(bidList.bid, function(conversantBid) {\r\n          const responseCPM = parseFloat(conversantBid.price);\r\n          if (responseCPM > 0.0 && conversantBid.impid) {\r\n            const responseAd = conversantBid.adm || '';\r\n            const responseNurl = conversantBid.nurl || '';\r\n            const request = requestMap[conversantBid.impid];\r\n\r\n            const bid = {\r\n              requestId: conversantBid.impid,\r\n              currency: serverResponse.cur || 'USD',\r\n              cpm: responseCPM,\r\n              creativeId: conversantBid.crid || '',\r\n              ttl: 300,\r\n              netRevenue: true\r\n            };\r\n            bid.meta = {};\r\n            if (conversantBid.adomain && conversantBid.adomain.length > 0) {\r\n              bid.meta.advertiserDomains = conversantBid.adomain;\r\n            }\r\n\r\n            if (request.video) {\r\n              if (responseAd.charAt(0) === '<') {\r\n                bid.vastXml = responseAd;\r\n              } else {\r\n                bid.vastUrl = responseAd;\r\n              }\r\n\r\n              bid.mediaType = 'video';\r\n              bid.width = request.video.w;\r\n              bid.height = request.video.h;\r\n            } else {\r\n              bid.ad = responseAd + '<img src=\"' + responseNurl + '\" />';\r\n              bid.width = conversantBid.w;\r\n              bid.height = conversantBid.h;\r\n            }\r\n\r\n            bidResponses.push(bid);\r\n          }\r\n        })\r\n      });\r\n    }\r\n\r\n    return bidResponses;\r\n  },\r\n\r\n  /**\r\n   * Covert bid param types for S2S\r\n   * @param {Object} params bid params\r\n   * @param {Boolean} isOpenRtb boolean to check openrtb2 protocol\r\n   * @return {Object} params bid params\r\n   */\r\n  transformBidParams: function(params, isOpenRtb) {\r\n    return convertTypes({\r\n      'site_id': 'string',\r\n      'secure': 'number',\r\n      'mobile': 'number'\r\n    }, params);\r\n  },\r\n\r\n  /**\r\n   * Register User Sync.\r\n   */\r\n  getUserSyncs: function(syncOptions, responses, gdprConsent, uspConsent) {\r\n    let params = {};\r\n    const syncs = [];\r\n\r\n    // Attaching GDPR Consent Params in UserSync url\r\n    if (gdprConsent) {\r\n      params.gdpr = (gdprConsent.gdprApplies) ? 1 : 0;\r\n      params.gdpr_consent = encodeURIComponent(gdprConsent.consentString || '');\r\n    }\r\n\r\n    // CCPA\r\n    if (uspConsent) {\r\n      params.us_privacy = encodeURIComponent(uspConsent);\r\n    }\r\n\r\n    if (responses && responses.ext) {\r\n      const pixels = [{urls: responses.ext.fsyncs, type: 'iframe'}, {urls: responses.ext.psyncs, type: 'image'}]\r\n        .filter((entry) => {\r\n          return entry.urls &&\r\n            ((entry.type === 'iframe' && syncOptions.iframeEnabled) ||\r\n            (entry.type === 'image' && syncOptions.pixelEnabled));\r\n        })\r\n        .map((entry) => {\r\n          return entry.urls.map((endpoint) => {\r\n            let urlInfo = parseUrl(endpoint);\r\n            mergeDeep(urlInfo.search, params);\r\n            if (Object.keys(urlInfo.search).length === 0) {\r\n              delete urlInfo.search; // empty search object causes buildUrl to add a trailing ? to the url\r\n            }\r\n            return {type: entry.type, url: buildUrl(urlInfo)};\r\n          })\r\n            .reduce((x, y) => x.concat(y), []);\r\n        })\r\n        .reduce((x, y) => x.concat(y), []);\r\n      syncs.push(...pixels);\r\n    }\r\n    return syncs;\r\n  }\r\n};\r\n\r\n/**\r\n * Determine do-not-track state\r\n *\r\n * @returns {boolean}\r\n */\r\nfunction getDNT() {\r\n  return navigator.doNotTrack === '1' || window.doNotTrack === '1' || navigator.msDoNoTrack === '1' || navigator.doNotTrack === 'yes';\r\n}\r\n\r\n/**\r\n * Return openrtb device object that includes ua, width, and height.\r\n *\r\n * @returns {Device} Openrtb device object\r\n */\r\nfunction getDevice() {\r\n  const language = navigator.language ? 'language' : 'userLanguage';\r\n  return {\r\n    h: screen.height,\r\n    w: screen.width,\r\n    dnt: getDNT() ? 1 : 0,\r\n    language: navigator[language].split('-')[0],\r\n    make: navigator.vendor ? navigator.vendor : '',\r\n    ua: navigator.userAgent\r\n  };\r\n}\r\n\r\n/**\r\n * Convert arrays of widths and heights to an array of objects with w and h properties.\r\n *\r\n * [[300, 250], [300, 600]] => [{w: 300, h: 250}, {w: 300, h: 600}]\r\n *\r\n * @param {Array.<Array.<number>>} bidSizes - arrays of widths and heights\r\n * @returns {object[]} Array of objects with w and h\r\n */\r\nfunction convertSizes(bidSizes) {\r\n  let format;\r\n  if (Array.isArray(bidSizes)) {\r\n    if (bidSizes.length === 2 && typeof bidSizes[0] === 'number' && typeof bidSizes[1] === 'number') {\r\n      format = [{w: bidSizes[0], h: bidSizes[1]}];\r\n    } else {\r\n      format = _map(bidSizes, d => { return {w: d[0], h: d[1]}; });\r\n    }\r\n  }\r\n\r\n  return format;\r\n}\r\n\r\n/**\r\n * Check if it's a video bid request\r\n *\r\n * @param {BidRequest} bid - Bid request generated from ad slots\r\n * @returns {boolean} True if it's a video bid\r\n */\r\nfunction isVideoRequest(bid) {\r\n  return bid.mediaType === 'video' || !!deepAccess(bid, 'mediaTypes.video');\r\n}\r\n\r\n/**\r\n * Copy property if exists from src to dst\r\n *\r\n * @param {object} src - source object\r\n * @param {object} dst - destination object\r\n * @param {string} dstName - destination property name\r\n */\r\nfunction copyOptProperty(src, dst, dstName) {\r\n  if (src) {\r\n    dst[dstName] = src;\r\n  }\r\n}\r\n\r\n/**\r\n * Collect IDs from validBidRequests and store them as an extended id array\r\n * @param bidRequests valid bid requests\r\n */\r\nfunction collectEids(bidRequests) {\r\n  const request = bidRequests[0]; // bidRequests have the same userId object\r\n  const eids = [];\r\n  if (isArray(request.userIdAsEids) && request.userIdAsEids.length > 0) {\r\n    // later following white-list can be converted to block-list if needed\r\n    const requiredSourceValues = {\r\n      'epsilon.com': 1,\r\n      'adserver.org': 1,\r\n      'liveramp.com': 1,\r\n      'criteo.com': 1,\r\n      'id5-sync.com': 1,\r\n      'parrable.com': 1,\r\n      'liveintent.com': 1\r\n    };\r\n    request.userIdAsEids.forEach(function(eid) {\r\n      if (requiredSourceValues.hasOwnProperty(eid.source)) {\r\n        eids.push(eid);\r\n      }\r\n    });\r\n  }\r\n  return eids;\r\n}\r\n\r\n/**\r\n * Look for a stored value from both cookie and local storage and return the first value found.\r\n * @param key Key for the search\r\n * @return {string} Stored value\r\n */\r\nfunction readStoredValue(key) {\r\n  let storedValue;\r\n  try {\r\n    // check cookies first\r\n    storedValue = storage.getCookie(key);\r\n\r\n    if (!storedValue) {\r\n      // check expiration time before reading local storage\r\n      const storedValueExp = storage.getDataFromLocalStorage(`${key}_exp`);\r\n      if (storedValueExp === '' || (storedValueExp && (new Date(storedValueExp)).getTime() - Date.now() > 0)) {\r\n        storedValue = storage.getDataFromLocalStorage(key);\r\n        storedValue = storedValue ? decodeURIComponent(storedValue) : storedValue;\r\n      }\r\n    }\r\n\r\n    // deserialize JSON if needed\r\n    if (isStr(storedValue) && storedValue.charAt(0) === '{') {\r\n      storedValue = JSON.parse(storedValue);\r\n    }\r\n  } catch (e) {\r\n    logError(e);\r\n  }\r\n\r\n  return storedValue;\r\n}\r\n\r\n/**\r\n * Get the floor price from bid.params for backward compatibility.\r\n * If not found, then check floor module.\r\n * @param bid A valid bid object\r\n * @returns {*|number} floor price\r\n */\r\nfunction getBidFloor(bid) {\r\n  let floor = getBidIdParameter('bidfloor', bid.params);\r\n\r\n  if (!floor && isFn(bid.getFloor)) {\r\n    const floorObj = bid.getFloor({\r\n      currency: 'USD',\r\n      mediaType: '*',\r\n      size: '*'\r\n    });\r\n\r\n    if (isPlainObject(floorObj) && !isNaN(floorObj.floor) && floorObj.currency === 'USD') {\r\n      floor = floorObj.floor;\r\n    }\r\n  }\r\n\r\n  return floor\r\n}\r\n\r\nregisterBidder(spec);\r\n","/**\r\n * This module adds [DFP support]{@link https://www.doubleclickbygoogle.com/} for Video to Prebid.\r\n */\r\n\r\nimport { registerVideoSupport } from '../src/adServerManager.js';\r\nimport { targeting } from '../src/targeting.js';\r\nimport { deepAccess, isEmpty, logError, parseSizesInput, formatQS, parseUrl, buildUrl } from '../src/utils.js';\r\nimport { config } from '../src/config.js';\r\nimport { getHook, submodule } from '../src/hook.js';\r\nimport { auctionManager } from '../src/auctionManager.js';\r\nimport { gdprDataHandler, uspDataHandler } from '../src/adapterManager.js';\r\nimport * as events from '../src/events.js';\r\nimport CONSTANTS from '../src/constants.json';\r\nimport {getPPID} from '../src/adserver.js';\r\n\r\n/**\r\n * @typedef {Object} DfpVideoParams\r\n *\r\n * This object contains the params needed to form a URL which hits the\r\n * [DFP API]{@link https://support.google.com/dfp_premium/answer/1068325?hl=en}.\r\n *\r\n * All params (except iu, mentioned below) should be considered optional. This module will choose reasonable\r\n * defaults for all of the other required params.\r\n *\r\n * The cust_params property, if present, must be an object. It will be merged with the rest of the\r\n * standard Prebid targeting params (hb_adid, hb_bidder, etc).\r\n *\r\n * @param {string} iu This param *must* be included, in order for us to create a valid request.\r\n * @param [string] description_url This field is required if you want Ad Exchange to bid on our ad unit...\r\n *   but otherwise optional\r\n */\r\n\r\n/**\r\n * @typedef {Object} DfpVideoOptions\r\n *\r\n * @param {Object} adUnit The adUnit which this bid is supposed to help fill.\r\n * @param [Object] bid The bid which should be considered alongside the rest of the adserver's demand.\r\n *   If this isn't defined, then we'll use the winning bid for the adUnit.\r\n *\r\n * @param {DfpVideoParams} [params] Query params which should be set on the DFP request.\r\n *   These will override this module's defaults whenever they conflict.\r\n * @param {string} [url] video adserver url\r\n */\r\n\r\n/** Safe defaults which work on pretty much all video calls. */\r\nconst defaultParamConstants = {\r\n  env: 'vp',\r\n  gdfp_req: 1,\r\n  output: 'vast',\r\n  unviewed_position_start: 1,\r\n};\r\n\r\nexport const adpodUtils = {};\r\n\r\n/**\r\n * Merge all the bid data and publisher-supplied options into a single URL, and then return it.\r\n *\r\n * @see [The DFP API]{@link https://support.google.com/dfp_premium/answer/1068325?hl=en#env} for details.\r\n *\r\n * @param {DfpVideoOptions} options Options which should be used to construct the URL.\r\n *\r\n * @return {string} A URL which calls DFP, letting options.bid\r\n *   (or the auction's winning bid for this adUnit, if undefined) compete alongside the rest of the\r\n *   demand in DFP.\r\n */\r\nexport function buildDfpVideoUrl(options) {\r\n  if (!options.params && !options.url) {\r\n    logError(`A params object or a url is required to use $$PREBID_GLOBAL$$.adServers.dfp.buildVideoUrl`);\r\n    return;\r\n  }\r\n\r\n  const adUnit = options.adUnit;\r\n  const bid = options.bid || targeting.getWinningBids(adUnit.code)[0];\r\n\r\n  let urlComponents = {};\r\n\r\n  if (options.url) {\r\n    // when both `url` and `params` are given, parsed url will be overwriten\r\n    // with any matching param components\r\n    urlComponents = parseUrl(options.url, {noDecodeWholeURL: true});\r\n\r\n    if (isEmpty(options.params)) {\r\n      return buildUrlFromAdserverUrlComponents(urlComponents, bid, options);\r\n    }\r\n  }\r\n\r\n  const derivedParams = {\r\n    correlator: Date.now(),\r\n    sz: parseSizesInput(deepAccess(adUnit, 'mediaTypes.video.playerSize')).join('|'),\r\n    url: encodeURIComponent(location.href),\r\n  };\r\n\r\n  const urlSearchComponent = urlComponents.search;\r\n  const urlSzParam = urlSearchComponent && urlSearchComponent.sz;\r\n  if (urlSzParam) {\r\n    derivedParams.sz = urlSzParam + '|' + derivedParams.sz;\r\n  }\r\n\r\n  let encodedCustomParams = getCustParams(bid, options, urlSearchComponent && urlSearchComponent.cust_params);\r\n\r\n  const queryParams = Object.assign({},\r\n    defaultParamConstants,\r\n    urlComponents.search,\r\n    derivedParams,\r\n    options.params,\r\n    { cust_params: encodedCustomParams }\r\n  );\r\n\r\n  const descriptionUrl = getDescriptionUrl(bid, options, 'params');\r\n  if (descriptionUrl) { queryParams.description_url = descriptionUrl; }\r\n\r\n  const gdprConsent = gdprDataHandler.getConsentData();\r\n  if (gdprConsent) {\r\n    if (typeof gdprConsent.gdprApplies === 'boolean') { queryParams.gdpr = Number(gdprConsent.gdprApplies); }\r\n    if (gdprConsent.consentString) { queryParams.gdpr_consent = gdprConsent.consentString; }\r\n    if (gdprConsent.addtlConsent) { queryParams.addtl_consent = gdprConsent.addtlConsent; }\r\n  }\r\n\r\n  const uspConsent = uspDataHandler.getConsentData();\r\n  if (uspConsent) { queryParams.us_privacy = uspConsent; }\r\n\r\n  if (!queryParams.ppid) {\r\n    const ppid = getPPID();\r\n    if (ppid != null) {\r\n      queryParams.ppid = ppid;\r\n    }\r\n  }\r\n\r\n  return buildUrl(Object.assign({\r\n    protocol: 'https',\r\n    host: 'securepubads.g.doubleclick.net',\r\n    pathname: '/gampad/ads'\r\n  }, urlComponents, { search: queryParams }));\r\n}\r\n\r\nexport function notifyTranslationModule(fn) {\r\n  fn.call(this, 'dfp');\r\n}\r\n\r\nif (config.getConfig('brandCategoryTranslation.translationFile')) { getHook('registerAdserver').before(notifyTranslationModule); }\r\n\r\n/**\r\n * @typedef {Object} DfpAdpodOptions\r\n *\r\n * @param {string} code Ad Unit code\r\n * @param {Object} params Query params which should be set on the DFP request.\r\n * These will override this module's defaults whenever they conflict.\r\n * @param {function} callback Callback function to execute when master tag is ready\r\n */\r\n\r\n/**\r\n * Creates master tag url for long-form\r\n * @param {DfpAdpodOptions} options\r\n * @returns {string} A URL which calls DFP with custom adpod targeting key values to compete with rest of the demand in DFP\r\n */\r\nexport function buildAdpodVideoUrl({code, params, callback} = {}) {\r\n  if (!params || !callback) {\r\n    logError(`A params object and a callback is required to use pbjs.adServers.dfp.buildAdpodVideoUrl`);\r\n    return;\r\n  }\r\n\r\n  const derivedParams = {\r\n    correlator: Date.now(),\r\n    sz: getSizeForAdUnit(code),\r\n    url: encodeURIComponent(location.href),\r\n  };\r\n\r\n  function getSizeForAdUnit(code) {\r\n    let adUnit = auctionManager.getAdUnits()\r\n      .filter((adUnit) => adUnit.code === code)\r\n    let sizes = deepAccess(adUnit[0], 'mediaTypes.video.playerSize');\r\n    return parseSizesInput(sizes).join('|');\r\n  }\r\n\r\n  adpodUtils.getTargeting({\r\n    'codes': [code],\r\n    'callback': createMasterTag\r\n  });\r\n\r\n  function createMasterTag(err, targeting) {\r\n    if (err) {\r\n      callback(err, null);\r\n      return;\r\n    }\r\n\r\n    let initialValue = {\r\n      [adpodUtils.TARGETING_KEY_PB_CAT_DUR]: undefined,\r\n      [adpodUtils.TARGETING_KEY_CACHE_ID]: undefined\r\n    };\r\n    let customParams = {};\r\n    if (targeting[code]) {\r\n      customParams = targeting[code].reduce((acc, curValue) => {\r\n        if (Object.keys(curValue)[0] === adpodUtils.TARGETING_KEY_PB_CAT_DUR) {\r\n          acc[adpodUtils.TARGETING_KEY_PB_CAT_DUR] = (typeof acc[adpodUtils.TARGETING_KEY_PB_CAT_DUR] !== 'undefined') ? acc[adpodUtils.TARGETING_KEY_PB_CAT_DUR] + ',' + curValue[adpodUtils.TARGETING_KEY_PB_CAT_DUR] : curValue[adpodUtils.TARGETING_KEY_PB_CAT_DUR];\r\n        } else if (Object.keys(curValue)[0] === adpodUtils.TARGETING_KEY_CACHE_ID) {\r\n          acc[adpodUtils.TARGETING_KEY_CACHE_ID] = curValue[adpodUtils.TARGETING_KEY_CACHE_ID]\r\n        }\r\n        return acc;\r\n      }, initialValue);\r\n    }\r\n\r\n    let encodedCustomParams = encodeURIComponent(formatQS(customParams));\r\n\r\n    const queryParams = Object.assign({},\r\n      defaultParamConstants,\r\n      derivedParams,\r\n      params,\r\n      { cust_params: encodedCustomParams }\r\n    );\r\n\r\n    const gdprConsent = gdprDataHandler.getConsentData();\r\n    if (gdprConsent) {\r\n      if (typeof gdprConsent.gdprApplies === 'boolean') { queryParams.gdpr = Number(gdprConsent.gdprApplies); }\r\n      if (gdprConsent.consentString) { queryParams.gdpr_consent = gdprConsent.consentString; }\r\n      if (gdprConsent.addtlConsent) { queryParams.addtl_consent = gdprConsent.addtlConsent; }\r\n    }\r\n\r\n    const uspConsent = uspDataHandler.getConsentData();\r\n    if (uspConsent) { queryParams.us_privacy = uspConsent; }\r\n\r\n    const masterTag = buildUrl({\r\n      protocol: 'https',\r\n      host: 'securepubads.g.doubleclick.net',\r\n      pathname: '/gampad/ads',\r\n      search: queryParams\r\n    });\r\n\r\n    callback(null, masterTag);\r\n  }\r\n}\r\n\r\n/**\r\n * Builds a video url from a base dfp video url and a winning bid, appending\r\n * Prebid-specific key-values.\r\n * @param {Object} components base video adserver url parsed into components object\r\n * @param {AdapterBidResponse} bid winning bid object to append parameters from\r\n * @param {Object} options Options which should be used to construct the URL (used for custom params).\r\n * @return {string} video url\r\n */\r\nfunction buildUrlFromAdserverUrlComponents(components, bid, options) {\r\n  const descriptionUrl = getDescriptionUrl(bid, components, 'search');\r\n  if (descriptionUrl) { components.search.description_url = descriptionUrl; }\r\n\r\n  components.search.cust_params = getCustParams(bid, options, components.search.cust_params);\r\n  return buildUrl(components);\r\n}\r\n\r\n/**\r\n * Returns the encoded vast url if it exists on a bid object, only if prebid-cache\r\n * is disabled, and description_url is not already set on a given input\r\n * @param {AdapterBidResponse} bid object to check for vast url\r\n * @param {Object} components the object to check that description_url is NOT set on\r\n * @param {string} prop the property of components that would contain description_url\r\n * @return {string | undefined} The encoded vast url if it exists, or undefined\r\n */\r\nfunction getDescriptionUrl(bid, components, prop) {\r\n  if (config.getConfig('cache.url')) { return; }\r\n\r\n  if (!deepAccess(components, `${prop}.description_url`)) {\r\n    const vastUrl = bid && bid.vastUrl;\r\n    if (vastUrl) { return encodeURIComponent(vastUrl); }\r\n  } else {\r\n    logError(`input cannnot contain description_url`);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the encoded `cust_params` from the bid.adserverTargeting and adds the `hb_uuid`, and `hb_cache_id`. Optionally the options.params.cust_params\r\n * @param {AdapterBidResponse} bid\r\n * @param {Object} options this is the options passed in from the `buildDfpVideoUrl` function\r\n * @return {Object} Encoded key value pairs for cust_params\r\n */\r\nfunction getCustParams(bid, options, urlCustParams) {\r\n  const adserverTargeting = (bid && bid.adserverTargeting) || {};\r\n\r\n  let allTargetingData = {};\r\n  const adUnit = options && options.adUnit;\r\n  if (adUnit) {\r\n    let allTargeting = targeting.getAllTargeting(adUnit.code);\r\n    allTargetingData = (allTargeting) ? allTargeting[adUnit.code] : {};\r\n  }\r\n\r\n  const prebidTargetingSet = Object.assign({},\r\n    // Why are we adding standard keys here ? Refer https://github.com/prebid/Prebid.js/issues/3664\r\n    { hb_uuid: bid && bid.videoCacheKey },\r\n    // hb_cache_id became optional in prebid 5.0 after 4.x enabled the concept of optional keys. Discussion led to reversing the prior expectation of deprecating hb_uuid\r\n    { hb_cache_id: bid && bid.videoCacheKey },\r\n    allTargetingData,\r\n    adserverTargeting,\r\n  );\r\n  events.emit(CONSTANTS.EVENTS.SET_TARGETING, {[adUnit.code]: prebidTargetingSet});\r\n\r\n  // merge the prebid + publisher targeting sets\r\n  const publisherTargetingSet = deepAccess(options, 'params.cust_params');\r\n  const targetingSet = Object.assign({}, prebidTargetingSet, publisherTargetingSet);\r\n  let encodedParams = encodeURIComponent(formatQS(targetingSet));\r\n  if (urlCustParams) {\r\n    encodedParams = urlCustParams + '%26' + encodedParams;\r\n  }\r\n\r\n  return encodedParams;\r\n}\r\n\r\nregisterVideoSupport('dfp', {\r\n  buildVideoUrl: buildDfpVideoUrl,\r\n  buildAdpodVideoUrl: buildAdpodVideoUrl,\r\n  getAdpodTargeting: (args) => adpodUtils.getTargeting(args)\r\n});\r\n\r\nsubmodule('adpod', adpodUtils);\r\n","import { getGlobal } from './prebidGlobal.js';\r\nimport { logWarn } from './utils.js';\r\n\r\nconst prebid = getGlobal();\r\n\r\n/**\r\n * This file defines the plugin points in prebid-core for AdServer-specific functionality.\r\n *\r\n * Its main job is to expose functions for AdServer modules to append functionality to the Prebid public API.\r\n * For a given Ad Server with name \"adServerName\", these functions will only change the API in the\r\n * $$PREBID_GLOBAL$$.adServers[adServerName] namespace.\r\n */\r\n\r\n/**\r\n * @typedef {Object} CachedVideoBid\r\n *\r\n * @property {string} videoCacheId The ID which can be used to retrieve this video from prebid-server.\r\n *   This is the same ID given to the callback in the videoCache's store function.\r\n */\r\n\r\n/**\r\n * @function VideoAdUrlBuilder\r\n *\r\n * @param {CachedVideoBid} bid The winning Bid which the ad server should show, assuming it beats out\r\n *   the competition.\r\n *\r\n * @param {Object} options Options required by the Ad Server to make a valid AdServer URL.\r\n *   This object will have different properties depending on the specific ad server supported.\r\n *   For more information, see the docs inside the ad server module you're supporting.\r\n *\r\n * @return {string} A URL which can be passed into the Video player to play an ad.\r\n */\r\n\r\n/**\r\n * @typedef {Object} VideoSupport\r\n *\r\n * @function {VideoAdUrlBuilder} buildVideoAdUrl\r\n */\r\n\r\n/**\r\n * Enable video support for the Ad Server.\r\n *\r\n * @property {string} name The identifying name for this adserver.\r\n * @property {VideoSupport} videoSupport An object with the functions needed to support video in Prebid.\r\n */\r\nexport function registerVideoSupport(name, videoSupport) {\r\n  prebid.adServers = prebid.adServers || { };\r\n  prebid.adServers[name] = prebid.adServers[name] || { };\r\n  Object.keys(videoSupport).forEach((key) => {\r\n    if (prebid.adServers[name][key]) {\r\n      logWarn(`Attempting to add an already registered function property ${key} for AdServer ${name}.`);\r\n      return;\r\n    }\r\n    prebid.adServers[name][key] = videoSupport[key];\r\n  });\r\n}\r\n","import {hook} from './hook.js';\r\n\r\n/**\r\n * return the GAM PPID, if available (eid for the userID configured with `userSync.ppidSource`)\r\n */\r\nexport const getPPID = hook('sync', () => undefined);\r\n","/**\r\n * This module adds IdentityLink to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/identityLinkSubmodule\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport * as utils from '../src/utils.js'\r\nimport { ajax } from '../src/ajax.js';\r\nimport { submodule } from '../src/hook.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\n\r\nexport const storage = getStorageManager();\r\n\r\n/** @type {Submodule} */\r\nexport const identityLinkSubmodule = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: 'identityLink',\r\n  /**\r\n   * used to specify vendor id\r\n   * @type {number}\r\n   */\r\n  gvlid: 97,\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   * @function\r\n   * @param {string} value\r\n   * @returns {{idl_env:string}}\r\n   */\r\n  decode(value) {\r\n    return { 'idl_env': value }\r\n  },\r\n  /**\r\n   * performs action to obtain id and return a value in the callback's response argument\r\n   * @function\r\n   * @param {ConsentData} [consentData]\r\n   * @param {SubmoduleConfig} [config]\r\n   * @returns {IdResponse|undefined}\r\n   */\r\n  getId(config, consentData) {\r\n    const configParams = (config && config.params) || {};\r\n    if (!configParams || typeof configParams.pid !== 'string') {\r\n      utils.logError('identityLink: requires partner id to be defined');\r\n      return;\r\n    }\r\n    const hasGdpr = (consentData && typeof consentData.gdprApplies === 'boolean' && consentData.gdprApplies) ? 1 : 0;\r\n    const gdprConsentString = hasGdpr ? consentData.consentString : '';\r\n    const tcfPolicyV2 = utils.deepAccess(consentData, 'vendorData.tcfPolicyVersion') === 2;\r\n    // use protocol relative urls for http or https\r\n    if (hasGdpr && (!gdprConsentString || gdprConsentString === '')) {\r\n      utils.logInfo('identityLink: Consent string is required to call envelope API.');\r\n      return;\r\n    }\r\n    const url = `https://api.rlcdn.com/api/identity/envelope?pid=${configParams.pid}${hasGdpr ? (tcfPolicyV2 ? '&ct=4&cv=' : '&ct=1&cv=') + gdprConsentString : ''}`;\r\n    let resp;\r\n    resp = function (callback) {\r\n      // Check ats during callback so it has a chance to initialise.\r\n      // If ats library is available, use it to retrieve envelope. If not use standard third party endpoint\r\n      if (window.ats) {\r\n        utils.logInfo('identityLink: ATS exists!');\r\n        window.ats.retrieveEnvelope(function (envelope) {\r\n          if (envelope) {\r\n            utils.logInfo('identityLink: An envelope can be retrieved from ATS!');\r\n            setEnvelopeSource(true);\r\n            callback(JSON.parse(envelope).envelope);\r\n          } else {\r\n            getEnvelope(url, callback, configParams);\r\n          }\r\n        });\r\n      } else {\r\n        getEnvelope(url, callback, configParams);\r\n      }\r\n    };\r\n\r\n    return { callback: resp };\r\n  }\r\n};\r\n// return envelope from third party endpoint\r\nfunction getEnvelope(url, callback, configParams) {\r\n  const callbacks = {\r\n    success: response => {\r\n      let responseObj;\r\n      if (response) {\r\n        try {\r\n          responseObj = JSON.parse(response);\r\n        } catch (error) {\r\n          utils.logInfo(error);\r\n        }\r\n      }\r\n      callback((responseObj && responseObj.envelope) ? responseObj.envelope : '');\r\n    },\r\n    error: error => {\r\n      utils.logInfo(`identityLink: identityLink: ID fetch encountered an error`, error);\r\n      callback();\r\n    }\r\n  };\r\n\r\n  if (!configParams.notUse3P && !storage.getCookie('_lr_retry_request')) {\r\n    setRetryCookie();\r\n    utils.logInfo('identityLink: A 3P retrieval is attempted!');\r\n    setEnvelopeSource(false);\r\n    ajax(url, callbacks, undefined, { method: 'GET', withCredentials: true });\r\n  }\r\n}\r\n\r\nfunction setRetryCookie() {\r\n  let now = new Date();\r\n  now.setTime(now.getTime() + 3600000);\r\n  storage.setCookie('_lr_retry_request', 'true', now.toUTCString());\r\n}\r\n\r\nfunction setEnvelopeSource(src) {\r\n  let now = new Date();\r\n  now.setTime(now.getTime() + 2592000000);\r\n  storage.setCookie('_lr_env_src_ats', src, now.toUTCString());\r\n}\r\n\r\nsubmodule('userId', identityLinkSubmodule);\r\n","import {\r\n  _each,\r\n  _map,\r\n  convertTypes,\r\n  deepAccess,\r\n  deepSetValue,\r\n  inIframe,\r\n  isArray,\r\n  parseSizesInput,\r\n  parseUrl\r\n} from '../src/utils.js';\r\nimport {config} from '../src/config.js';\r\nimport {registerBidder} from '../src/adapters/bidderFactory.js';\r\nimport {BANNER, VIDEO} from '../src/mediaTypes.js';\r\nimport {includes} from '../src/polyfill.js';\r\n\r\nconst SUPPORTED_AD_TYPES = [BANNER, VIDEO];\r\nconst VIDEO_TARGETING = ['startdelay', 'mimes', 'minduration', 'maxduration',\r\n  'startdelay', 'skippable', 'playbackmethod', 'api', 'protocols', 'boxingallowed',\r\n  'linearity', 'delivery', 'protocol', 'placement', 'minbitrate', 'maxbitrate'];\r\nconst BIDDER_CODE = 'openx';\r\nconst BIDDER_CONFIG = 'hb_pb';\r\nconst BIDDER_VERSION = '3.0.3';\r\n\r\nconst DEFAULT_CURRENCY = 'USD';\r\n\r\nexport const USER_ID_CODE_TO_QUERY_ARG = {\r\n  britepoolid: 'britepoolid', // BritePool ID\r\n  criteoId: 'criteoid', // CriteoID\r\n  fabrickId: 'nuestarid', // Fabrick ID by Nuestar\r\n  hadronId: 'audigentid', // Hadron ID from Audigent\r\n  id5id: 'id5id', // ID5 ID\r\n  idl_env: 'lre', // LiveRamp IdentityLink\r\n  IDP: 'zeotapid', // zeotapIdPlus ID+\r\n  idxId: 'idxid', // idIDx,\r\n  intentIqId: 'intentiqid', // IntentIQ ID\r\n  lipb: 'lipbid', // LiveIntent ID\r\n  lotamePanoramaId: 'lotameid', // Lotame Panorama ID\r\n  merkleId: 'merkleid', // Merkle ID\r\n  netId: 'netid', // netID\r\n  parrableId: 'parrableid', // Parrable ID\r\n  pubcid: 'pubcid', // PubCommon ID\r\n  quantcastId: 'quantcastid', // Quantcast ID\r\n  tapadId: 'tapadid', // Tapad Id\r\n  tdid: 'ttduuid', // The Trade Desk Unified ID\r\n  uid2: 'uid2', // Unified ID 2.0\r\n  admixerId: 'admixerid', // AdMixer ID\r\n  deepintentId: 'deepintentid', // DeepIntent ID\r\n  dmdId: 'dmdid', // DMD Marketing Corp ID\r\n  nextrollId: 'nextrollid', // NextRoll ID\r\n  novatiq: 'novatiqid', // Novatiq ID\r\n  mwOpenLinkId: 'mwopenlinkid', // MediaWallah OpenLink ID\r\n  dapId: 'dapid', // Akamai DAP ID\r\n  amxId: 'amxid', // AMX RTB ID\r\n  kpuid: 'kpuid', // Kinesso ID\r\n  publinkId: 'publinkid', // Publisher Link\r\n  naveggId: 'naveggid', // Navegg ID\r\n  imuid: 'imuid', // IM-UID by Intimate Merger\r\n  adtelligentId: 'adtelligentid' // Adtelligent ID\r\n};\r\n\r\nexport const spec = {\r\n  code: BIDDER_CODE,\r\n  gvlid: 69,\r\n  supportedMediaTypes: SUPPORTED_AD_TYPES,\r\n  isBidRequestValid: function (bidRequest) {\r\n    const hasDelDomainOrPlatform = bidRequest.params.delDomain || bidRequest.params.platform;\r\n    if (deepAccess(bidRequest, 'mediaTypes.banner') && hasDelDomainOrPlatform) {\r\n      return !!bidRequest.params.unit || deepAccess(bidRequest, 'mediaTypes.banner.sizes.length') > 0;\r\n    }\r\n\r\n    return !!(bidRequest.params.unit && hasDelDomainOrPlatform);\r\n  },\r\n  buildRequests: function (bidRequests, bidderRequest) {\r\n    if (bidRequests.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    let requests = [];\r\n    let [videoBids, bannerBids] = partitionByVideoBids(bidRequests);\r\n\r\n    // build banner requests\r\n    if (bannerBids.length > 0) {\r\n      requests.push(buildOXBannerRequest(bannerBids, bidderRequest));\r\n    }\r\n    // build video requests\r\n    if (videoBids.length > 0) {\r\n      videoBids.forEach(videoBid => {\r\n        requests.push(buildOXVideoRequest(videoBid, bidderRequest))\r\n      });\r\n    }\r\n\r\n    return requests;\r\n  },\r\n  interpretResponse: function ({body: oxResponseObj}, serverRequest) {\r\n    let mediaType = getMediaTypeFromRequest(serverRequest);\r\n\r\n    return mediaType === VIDEO ? createVideoBidResponses(oxResponseObj, serverRequest.payload)\r\n      : createBannerBidResponses(oxResponseObj, serverRequest.payload);\r\n  },\r\n  getUserSyncs: function (syncOptions, responses, gdprConsent, uspConsent) {\r\n    if (syncOptions.iframeEnabled || syncOptions.pixelEnabled) {\r\n      let pixelType = syncOptions.iframeEnabled ? 'iframe' : 'image';\r\n      let url = deepAccess(responses, '0.body.ads.pixels') ||\r\n        deepAccess(responses, '0.body.pixels') ||\r\n        generateDefaultSyncUrl(gdprConsent, uspConsent);\r\n\r\n      return [{\r\n        type: pixelType,\r\n        url: url\r\n      }];\r\n    }\r\n  },\r\n  transformBidParams: function(params, isOpenRtb) {\r\n    return convertTypes({\r\n      'unit': 'string',\r\n      'customFloor': 'number'\r\n    }, params);\r\n  }\r\n};\r\n\r\nfunction generateDefaultSyncUrl(gdprConsent, uspConsent) {\r\n  let url = 'https://u.openx.net/w/1.0/pd';\r\n  let queryParamStrings = [];\r\n\r\n  if (gdprConsent) {\r\n    queryParamStrings.push('gdpr=' + (gdprConsent.gdprApplies ? 1 : 0));\r\n    queryParamStrings.push('gdpr_consent=' + encodeURIComponent(gdprConsent.consentString || ''));\r\n  }\r\n\r\n  // CCPA\r\n  if (uspConsent) {\r\n    queryParamStrings.push('us_privacy=' + encodeURIComponent(uspConsent));\r\n  }\r\n\r\n  return `${url}${queryParamStrings.length > 0 ? '?' + queryParamStrings.join('&') : ''}`;\r\n}\r\n\r\nfunction isVideoRequest(bidRequest) {\r\n  return (deepAccess(bidRequest, 'mediaTypes.video') && !deepAccess(bidRequest, 'mediaTypes.banner')) || bidRequest.mediaType === VIDEO;\r\n}\r\n\r\nfunction createBannerBidResponses(oxResponseObj, {bids, startTime}) {\r\n  let adUnits = oxResponseObj.ads.ad;\r\n  let bidResponses = [];\r\n  for (let i = 0; i < adUnits.length; i++) {\r\n    let adUnit = adUnits[i];\r\n    let adUnitIdx = parseInt(adUnit.idx, 10);\r\n    let bidResponse = {};\r\n\r\n    bidResponse.requestId = bids[adUnitIdx].bidId;\r\n\r\n    if (adUnit.pub_rev) {\r\n      bidResponse.cpm = Number(adUnit.pub_rev) / 1000;\r\n    } else {\r\n      // No fill, do not add the bidresponse\r\n      continue;\r\n    }\r\n    let creative = adUnit.creative[0];\r\n    if (creative) {\r\n      bidResponse.width = creative.width;\r\n      bidResponse.height = creative.height;\r\n    }\r\n    bidResponse.creativeId = creative.id;\r\n    bidResponse.ad = adUnit.html;\r\n    if (adUnit.deal_id) {\r\n      bidResponse.dealId = adUnit.deal_id;\r\n    }\r\n    // default 5 mins\r\n    bidResponse.ttl = 300;\r\n    // true is net, false is gross\r\n    bidResponse.netRevenue = true;\r\n    bidResponse.currency = adUnit.currency;\r\n\r\n    // additional fields to add\r\n    if (adUnit.tbd) {\r\n      bidResponse.tbd = adUnit.tbd;\r\n    }\r\n    bidResponse.ts = adUnit.ts;\r\n\r\n    bidResponse.meta = {};\r\n    if (adUnit.brand_id) {\r\n      bidResponse.meta.brandId = adUnit.brand_id;\r\n    }\r\n\r\n    if (adUnit.adomain && length(adUnit.adomain) > 0) {\r\n      bidResponse.meta.advertiserDomains = adUnit.adomain;\r\n    } else {\r\n      bidResponse.meta.advertiserDomains = [];\r\n    }\r\n\r\n    if (adUnit.adv_id) {\r\n      bidResponse.meta.dspid = adUnit.adv_id;\r\n    }\r\n\r\n    bidResponses.push(bidResponse);\r\n  }\r\n  return bidResponses;\r\n}\r\n\r\nfunction getViewportDimensions(isIfr) {\r\n  let width;\r\n  let height;\r\n  let tWin = window;\r\n  let tDoc = document;\r\n  let docEl = tDoc.documentElement;\r\n  let body;\r\n\r\n  if (isIfr) {\r\n    try {\r\n      tWin = window.top;\r\n      tDoc = window.top.document;\r\n    } catch (e) {\r\n      return;\r\n    }\r\n    body = tDoc.body;\r\n\r\n    width = tWin.innerWidth || docEl.clientWidth || body.clientWidth;\r\n    height = tWin.innerHeight || docEl.clientHeight || body.clientHeight;\r\n  } else {\r\n    width = tWin.innerWidth || docEl.clientWidth;\r\n    height = tWin.innerHeight || docEl.clientHeight;\r\n  }\r\n\r\n  return `${width}x${height}`;\r\n}\r\n\r\nfunction formatCustomParms(customKey, customParams) {\r\n  let value = customParams[customKey];\r\n  if (isArray(value)) {\r\n    // if value is an array, join them with commas first\r\n    value = value.join(',');\r\n  }\r\n  // return customKey=customValue format, escaping + to . and / to _\r\n  return (customKey.toLowerCase() + '=' + value.toLowerCase()).replace('+', '.').replace('/', '_')\r\n}\r\n\r\nfunction partitionByVideoBids(bidRequests) {\r\n  return bidRequests.reduce(function (acc, bid) {\r\n    // Fallback to banner ads if nothing specified\r\n    if (isVideoRequest(bid)) {\r\n      acc[0].push(bid);\r\n    } else {\r\n      acc[1].push(bid);\r\n    }\r\n    return acc;\r\n  }, [[], []]);\r\n}\r\n\r\nfunction getMediaTypeFromRequest(serverRequest) {\r\n  return /avjp$/.test(serverRequest.url) ? VIDEO : BANNER;\r\n}\r\n\r\nfunction buildCommonQueryParamsFromBids(bids, bidderRequest) {\r\n  const isInIframe = inIframe();\r\n  let defaultParams;\r\n\r\n  defaultParams = {\r\n    ju: bidderRequest.refererInfo.page,\r\n    ch: document.charSet || document.characterSet,\r\n    res: `${screen.width}x${screen.height}x${screen.colorDepth}`,\r\n    ifr: isInIframe,\r\n    tz: new Date().getTimezoneOffset(),\r\n    tws: getViewportDimensions(isInIframe),\r\n    be: 1,\r\n    bc: bids[0].params.bc || `${BIDDER_CONFIG}_${BIDDER_VERSION}`,\r\n    dddid: _map(bids, bid => bid.transactionId).join(','),\r\n    nocache: new Date().getTime()\r\n  };\r\n\r\n  const userDataSegments = buildFpdQueryParams('user.data', bidderRequest.ortb2);\r\n  if (userDataSegments.length > 0) {\r\n    defaultParams.sm = userDataSegments;\r\n  }\r\n\r\n  const siteContentDataSegments = buildFpdQueryParams('site.content.data', bidderRequest.ortb2);\r\n  if (siteContentDataSegments.length > 0) {\r\n    defaultParams.scsm = siteContentDataSegments;\r\n  }\r\n\r\n  if (bids[0].params.platform) {\r\n    defaultParams.ph = bids[0].params.platform;\r\n  }\r\n\r\n  if (bidderRequest.gdprConsent) {\r\n    let gdprConsentConfig = bidderRequest.gdprConsent;\r\n\r\n    if (gdprConsentConfig.consentString !== undefined) {\r\n      defaultParams.gdpr_consent = gdprConsentConfig.consentString;\r\n    }\r\n\r\n    if (gdprConsentConfig.gdprApplies !== undefined) {\r\n      defaultParams.gdpr = gdprConsentConfig.gdprApplies ? 1 : 0;\r\n    }\r\n\r\n    if (config.getConfig('consentManagement.cmpApi') === 'iab') {\r\n      defaultParams.x_gdpr_f = 1;\r\n    }\r\n  }\r\n\r\n  if (bidderRequest && bidderRequest.uspConsent) {\r\n    defaultParams.us_privacy = bidderRequest.uspConsent;\r\n  }\r\n\r\n  // normalize publisher common id\r\n  if (deepAccess(bids[0], 'crumbs.pubcid')) {\r\n    deepSetValue(bids[0], 'userId.pubcid', deepAccess(bids[0], 'crumbs.pubcid'));\r\n  }\r\n  defaultParams = appendUserIdsToQueryParams(defaultParams, bids[0].userId);\r\n\r\n  // supply chain support\r\n  if (bids[0].schain) {\r\n    defaultParams.schain = serializeSupplyChain(bids[0].schain);\r\n  }\r\n\r\n  return defaultParams;\r\n}\r\n\r\nfunction buildFpdQueryParams(fpdPath, ortb2) {\r\n  const firstPartyData = deepAccess(ortb2, fpdPath);\r\n  if (!Array.isArray(firstPartyData) || !firstPartyData.length) {\r\n    return '';\r\n  }\r\n  const fpd = firstPartyData\r\n    .filter(\r\n      data => (Array.isArray(data.segment) &&\r\n            data.segment.length > 0 &&\r\n            data.name !== undefined &&\r\n            data.name.length > 0)\r\n    )\r\n    .reduce((acc, data) => {\r\n      const name = typeof data.ext === 'object' && data.ext.segtax ? `${data.name}/${data.ext.segtax}` : data.name;\r\n      acc[name] = (acc[name] || []).concat(data.segment.map(seg => seg.id));\r\n      return acc;\r\n    }, {})\r\n  return Object.keys(fpd)\r\n    .map((name, _) => name + ':' + fpd[name].join('|'))\r\n    .join(',')\r\n}\r\n\r\nfunction appendUserIdsToQueryParams(queryParams, userIds) {\r\n  _each(userIds, (userIdObjectOrValue, userIdProviderKey) => {\r\n    const key = USER_ID_CODE_TO_QUERY_ARG[userIdProviderKey];\r\n\r\n    if (USER_ID_CODE_TO_QUERY_ARG.hasOwnProperty(userIdProviderKey)) {\r\n      switch (userIdProviderKey) {\r\n        case 'merkleId':\r\n          queryParams[key] = userIdObjectOrValue.id;\r\n          break;\r\n        case 'uid2':\r\n          queryParams[key] = userIdObjectOrValue.id;\r\n          break;\r\n        case 'lipb':\r\n          queryParams[key] = userIdObjectOrValue.lipbid;\r\n          if (Array.isArray(userIdObjectOrValue.segments) && userIdObjectOrValue.segments.length > 0) {\r\n            const liveIntentSegments = 'liveintent:' + userIdObjectOrValue.segments.join('|');\r\n            queryParams.sm = `${queryParams.sm ? queryParams.sm + ',' : ''}${liveIntentSegments}`;\r\n          }\r\n          break;\r\n        case 'parrableId':\r\n          queryParams[key] = userIdObjectOrValue.eid;\r\n          break;\r\n        case 'id5id':\r\n          queryParams[key] = userIdObjectOrValue.uid;\r\n          break;\r\n        case 'novatiq':\r\n          queryParams[key] = userIdObjectOrValue.snowflake;\r\n          break;\r\n        default:\r\n          queryParams[key] = userIdObjectOrValue;\r\n      }\r\n    }\r\n  });\r\n\r\n  return queryParams;\r\n}\r\n\r\nfunction serializeSupplyChain(supplyChain) {\r\n  return `${supplyChain.ver},${supplyChain.complete}!${serializeSupplyChainNodes(supplyChain.nodes)}`;\r\n}\r\n\r\nfunction serializeSupplyChainNodes(supplyChainNodes) {\r\n  const supplyChainNodePropertyOrder = ['asi', 'sid', 'hp', 'rid', 'name', 'domain'];\r\n\r\n  return supplyChainNodes.map(supplyChainNode => {\r\n    return supplyChainNodePropertyOrder.map(property => supplyChainNode[property] || '')\r\n      .join(',');\r\n  }).join('!');\r\n}\r\n\r\nfunction buildOXBannerRequest(bids, bidderRequest) {\r\n  let customParamsForAllBids = [];\r\n  let hasCustomParam = false;\r\n  let queryParams = buildCommonQueryParamsFromBids(bids, bidderRequest);\r\n  let auids = _map(bids, bid => bid.params.unit);\r\n\r\n  queryParams.aus = _map(bids, bid => parseSizesInput(bid.mediaTypes.banner.sizes).join(',')).join('|');\r\n  queryParams.divids = _map(bids, bid => encodeURIComponent(bid.adUnitCode)).join(',');\r\n  // gpid\r\n  queryParams.aucs = _map(bids, function (bid) {\r\n    let gpid = deepAccess(bid, 'ortb2Imp.ext.data.pbadslot');\r\n    return encodeURIComponent(gpid || '')\r\n  }).join(',');\r\n\r\n  if (auids.some(auid => auid)) {\r\n    queryParams.auid = auids.join(',');\r\n  }\r\n\r\n  if (bids.some(bid => bid.params.doNotTrack)) {\r\n    queryParams.ns = 1;\r\n  }\r\n\r\n  if (config.getConfig('coppa') === true || bids.some(bid => bid.params.coppa)) {\r\n    queryParams.tfcd = 1;\r\n  }\r\n\r\n  bids.forEach(function (bid) {\r\n    if (bid.params.customParams) {\r\n      let customParamsForBid = _map(Object.keys(bid.params.customParams), customKey => formatCustomParms(customKey, bid.params.customParams));\r\n      let formattedCustomParams = window.btoa(customParamsForBid.join('&'));\r\n      hasCustomParam = true;\r\n      customParamsForAllBids.push(formattedCustomParams);\r\n    } else {\r\n      customParamsForAllBids.push('');\r\n    }\r\n  });\r\n  if (hasCustomParam) {\r\n    queryParams.tps = customParamsForAllBids.join(',');\r\n  }\r\n\r\n  enrichQueryWithFloors(queryParams, BANNER, bids);\r\n\r\n  let url = queryParams.ph\r\n    ? `https://u.openx.net/w/1.0/arj`\r\n    : `https://${bids[0].params.delDomain}/w/1.0/arj`;\r\n\r\n  return {\r\n    method: 'GET',\r\n    url: url,\r\n    data: queryParams,\r\n    payload: {'bids': bids, 'startTime': new Date()}\r\n  };\r\n}\r\n\r\nfunction buildOXVideoRequest(bid, bidderRequest) {\r\n  let oxVideoParams = generateVideoParameters(bid, bidderRequest);\r\n  let url = oxVideoParams.ph\r\n    ? `https://u.openx.net/v/1.0/avjp`\r\n    : `https://${bid.params.delDomain}/v/1.0/avjp`;\r\n  return {\r\n    method: 'GET',\r\n    url: url,\r\n    data: oxVideoParams,\r\n    payload: {'bid': bid, 'startTime': new Date()}\r\n  };\r\n}\r\n\r\nfunction generateVideoParameters(bid, bidderRequest) {\r\n  const videoMediaType = deepAccess(bid, `mediaTypes.video`);\r\n  let queryParams = buildCommonQueryParamsFromBids([bid], bidderRequest);\r\n  let oxVideoConfig = deepAccess(bid, 'params.video') || {};\r\n  let context = deepAccess(bid, 'mediaTypes.video.context');\r\n  let playerSize = deepAccess(bid, 'mediaTypes.video.playerSize');\r\n  let width;\r\n  let height;\r\n\r\n  // normalize config for video size\r\n  if (isArray(bid.sizes) && bid.sizes.length === 2 && !isArray(bid.sizes[0])) {\r\n    width = parseInt(bid.sizes[0], 10);\r\n    height = parseInt(bid.sizes[1], 10);\r\n  } else if (isArray(bid.sizes) && isArray(bid.sizes[0]) && bid.sizes[0].length === 2) {\r\n    width = parseInt(bid.sizes[0][0], 10);\r\n    height = parseInt(bid.sizes[0][1], 10);\r\n  } else if (isArray(playerSize) && playerSize.length === 2) {\r\n    width = parseInt(playerSize[0], 10);\r\n    height = parseInt(playerSize[1], 10);\r\n  }\r\n\r\n  let openRtbParams = {w: width, h: height};\r\n\r\n  // legacy openrtb params could be in video, openrtb, or video.openrtb\r\n  let legacyParams = bid.params.video || bid.params.openrtb || {};\r\n  if (legacyParams.openrtb) {\r\n    legacyParams = legacyParams.openrtb;\r\n  }\r\n  // support for video object or full openrtb object\r\n  if (isArray(legacyParams.imp)) {\r\n    legacyParams = legacyParams.imp[0].video;\r\n  }\r\n  Object.keys(legacyParams)\r\n    .filter(param => includes(VIDEO_TARGETING, param))\r\n    .forEach(param => openRtbParams[param] = legacyParams[param]);\r\n\r\n  // 5.0 openrtb video params\r\n  Object.keys(videoMediaType)\r\n    .filter(param => includes(VIDEO_TARGETING, param))\r\n    .forEach(param => openRtbParams[param] = videoMediaType[param]);\r\n\r\n  let openRtbReq = {\r\n    imp: [\r\n      {\r\n        video: openRtbParams\r\n      }\r\n    ]\r\n  };\r\n\r\n  queryParams['openrtb'] = JSON.stringify(openRtbReq);\r\n\r\n  queryParams.auid = bid.params.unit;\r\n  // override prebid config with openx config if available\r\n  queryParams.vwd = width || oxVideoConfig.vwd;\r\n  queryParams.vht = height || oxVideoConfig.vht;\r\n\r\n  if (context === 'outstream') {\r\n    queryParams.vos = '101';\r\n  }\r\n\r\n  if (oxVideoConfig.mimes) {\r\n    queryParams.vmimes = oxVideoConfig.mimes;\r\n  }\r\n\r\n  if (bid.params.test) {\r\n    queryParams.vtest = 1;\r\n  }\r\n\r\n  let gpid = deepAccess(bid, 'ortb2Imp.ext.data.pbadslot');\r\n  if (gpid) {\r\n    queryParams.aucs = encodeURIComponent(gpid);\r\n  }\r\n\r\n  // each video bid makes a separate request\r\n  enrichQueryWithFloors(queryParams, VIDEO, [bid]);\r\n\r\n  return queryParams;\r\n}\r\n\r\nfunction createVideoBidResponses(response, {bid, startTime}) {\r\n  let bidResponses = [];\r\n\r\n  if (response !== undefined && response.vastUrl !== '' && response.pub_rev > 0) {\r\n    let vastQueryParams = parseUrl(response.vastUrl).search || {};\r\n    let bidResponse = {};\r\n    bidResponse.requestId = bid.bidId;\r\n    if (response.deal_id) {\r\n      bidResponse.dealId = response.deal_id;\r\n    }\r\n    // default 5 mins\r\n    bidResponse.ttl = 300;\r\n    // true is net, false is gross\r\n    bidResponse.netRevenue = true;\r\n    bidResponse.currency = response.currency;\r\n    bidResponse.cpm = parseInt(response.pub_rev, 10) / 1000;\r\n    bidResponse.width = parseInt(response.width, 10);\r\n    bidResponse.height = parseInt(response.height, 10);\r\n    bidResponse.creativeId = response.adid;\r\n    bidResponse.vastUrl = response.vastUrl;\r\n    bidResponse.mediaType = VIDEO;\r\n\r\n    // enrich adunit with vast parameters\r\n    response.ph = vastQueryParams.ph;\r\n    response.colo = vastQueryParams.colo;\r\n    response.ts = vastQueryParams.ts;\r\n\r\n    bidResponses.push(bidResponse);\r\n  }\r\n\r\n  return bidResponses;\r\n}\r\n\r\nfunction enrichQueryWithFloors(queryParams, mediaType, bids) {\r\n  let customFloorsForAllBids = [];\r\n  let hasCustomFloor = false;\r\n  bids.forEach(function (bid) {\r\n    let floor = getBidFloor(bid, mediaType);\r\n\r\n    if (floor) {\r\n      customFloorsForAllBids.push(floor);\r\n      hasCustomFloor = true;\r\n    } else {\r\n      customFloorsForAllBids.push(0);\r\n    }\r\n  });\r\n  if (hasCustomFloor) {\r\n    queryParams.aumfs = customFloorsForAllBids.join(',');\r\n  }\r\n}\r\n\r\nfunction getBidFloor(bidRequest, mediaType) {\r\n  let floorInfo = {};\r\n  const currency = config.getConfig('currency.adServerCurrency') || DEFAULT_CURRENCY;\r\n\r\n  if (typeof bidRequest.getFloor === 'function') {\r\n    floorInfo = bidRequest.getFloor({\r\n      currency: currency,\r\n      mediaType: mediaType,\r\n      size: '*'\r\n    });\r\n  }\r\n  let floor = floorInfo.floor || bidRequest.params.customFloor || 0;\r\n\r\n  return Math.round(floor * 1000); // normalize to micro currency\r\n}\r\n\r\nregisterBidder(spec);\r\n","/**\r\n * This module adds the PublinkId to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/publinkIdSystem\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport {submodule} from '../src/hook.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\nimport {ajax} from '../src/ajax.js';\r\nimport { parseUrl, buildUrl, logError } from '../src/utils.js';\r\nimport {uspDataHandler} from '../src/adapterManager.js';\r\n\r\nconst MODULE_NAME = 'publinkId';\r\nconst GVLID = 24;\r\nconst PUBLINK_COOKIE = '_publink';\r\nconst PUBLINK_S2S_COOKIE = '_publink_srv';\r\n\r\nexport const storage = getStorageManager({gvlid: GVLID});\r\n\r\nfunction isHex(s) {\r\n  return /^[A-F0-9]+$/i.test(s);\r\n}\r\n\r\nfunction publinkIdUrl(params, consentData) {\r\n  let url = parseUrl('https://proc.ad.cpe.dotomi.com/cvx/client/sync/publink');\r\n  url.search = {\r\n    deh: params.e,\r\n    mpn: 'Prebid.js',\r\n    mpv: '$prebid.version$',\r\n  };\r\n\r\n  if (consentData) {\r\n    url.search.gdpr = (consentData.gdprApplies) ? 1 : 0;\r\n    url.search.gdpr_consent = consentData.consentString;\r\n  }\r\n\r\n  if (params.site_id) { url.search.sid = params.site_id; }\r\n\r\n  if (params.api_key) { url.search.apikey = params.api_key; }\r\n\r\n  const usPrivacyString = uspDataHandler.getConsentData();\r\n  if (usPrivacyString && typeof usPrivacyString === 'string') {\r\n    url.search.us_privacy = usPrivacyString;\r\n  }\r\n\r\n  return buildUrl(url);\r\n}\r\n\r\nfunction makeCallback(config = {}, consentData) {\r\n  return function(prebidCallback) {\r\n    const options = {method: 'GET', withCredentials: true};\r\n    let handleResponse = function(responseText, xhr) {\r\n      if (xhr.status === 200) {\r\n        let response = JSON.parse(responseText);\r\n        if (response) {\r\n          prebidCallback(response.publink);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (config.params && config.params.e) {\r\n      if (isHex(config.params.e)) {\r\n        ajax(publinkIdUrl(config.params, consentData), handleResponse, undefined, options);\r\n      } else {\r\n        logError('params.e must be a hex string');\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction getlocalValue() {\r\n  let result;\r\n  function getData(key) {\r\n    let value;\r\n    if (storage.hasLocalStorage()) {\r\n      value = storage.getDataFromLocalStorage(key);\r\n    }\r\n    if (!value) {\r\n      value = storage.getCookie(key);\r\n    }\r\n\r\n    if (typeof value === 'string') {\r\n      // if it's a json object parse it and return the publink value, otherwise assume the value is the id\r\n      if (value.charAt(0) === '{') {\r\n        try {\r\n          const obj = JSON.parse(value);\r\n          if (obj) {\r\n            return obj.publink;\r\n          }\r\n        } catch (e) {\r\n          logError(e);\r\n        }\r\n      } else {\r\n        return value;\r\n      }\r\n    }\r\n  }\r\n  result = getData(PUBLINK_S2S_COOKIE);\r\n  if (!result) {\r\n    result = getData(PUBLINK_COOKIE);\r\n  }\r\n  return result;\r\n}\r\n\r\n/** @type {Submodule} */\r\nexport const publinkIdSubmodule = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: MODULE_NAME,\r\n  gvlid: GVLID,\r\n\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   * @function\r\n   * @param {string} publinkId encrypted userid\r\n   * @returns {{publinkId: string} | undefined}\r\n   */\r\n  decode(publinkId) {\r\n    return {publinkId: publinkId};\r\n  },\r\n\r\n  /**\r\n   * performs action to obtain id\r\n   * Use a publink cookie first if it is present, otherwise use prebids copy, if neither are available callout to get a new id\r\n   * @function\r\n   * @param {SubmoduleConfig} [config] Config object with params and storage properties\r\n   * @param {ConsentData|undefined} consentData GDPR consent\r\n   * @param {(Object|undefined)} storedId Previously cached id\r\n   * @returns {IdResponse}\r\n   */\r\n  getId: function(config, consentData, storedId) {\r\n    const localValue = getlocalValue();\r\n    if (localValue) {\r\n      return {id: localValue};\r\n    }\r\n    if (!storedId) {\r\n      return {callback: makeCallback(config, consentData)};\r\n    }\r\n  }\r\n};\r\nsubmodule('userId', publinkIdSubmodule);\r\n","/**\r\n * This module adds SharedId to the User ID module\r\n * The {@link module:modules/userId} module is required\r\n * @module modules/sharedIdSystem\r\n * @requires module:modules/userId\r\n */\r\n\r\nimport { parseUrl, buildUrl, triggerPixel, logInfo, hasDeviceAccess, generateUUID } from '../src/utils.js';\r\nimport {submodule} from '../src/hook.js';\r\nimport { coppaDataHandler } from '../src/adapterManager.js';\r\nimport {getStorageManager} from '../src/storageManager.js';\r\n\r\nexport const storage = getStorageManager({moduleName: 'pubCommonId'});\r\nconst COOKIE = 'cookie';\r\nconst LOCAL_STORAGE = 'html5';\r\nconst OPTOUT_NAME = '_pubcid_optout';\r\nconst PUB_COMMON_ID = 'PublisherCommonId';\r\n\r\n/**\r\n * Read a value either from cookie or local storage\r\n * @param {string} name Name of the item\r\n * @param {string} type storage type override\r\n * @returns {string|null} a string if item exists\r\n */\r\nfunction readValue(name, type) {\r\n  if (type === COOKIE) {\r\n    return storage.getCookie(name);\r\n  } else if (type === LOCAL_STORAGE) {\r\n    if (storage.hasLocalStorage()) {\r\n      const expValue = storage.getDataFromLocalStorage(`${name}_exp`);\r\n      if (!expValue) {\r\n        return storage.getDataFromLocalStorage(name);\r\n      } else if ((new Date(expValue)).getTime() - Date.now() > 0) {\r\n        return storage.getDataFromLocalStorage(name)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction getIdCallback(pubcid, pixelCallback) {\r\n  return function (callback) {\r\n    if (typeof pixelCallback === 'function') {\r\n      pixelCallback();\r\n    }\r\n    callback(pubcid);\r\n  }\r\n}\r\n\r\nfunction queuePixelCallback(pixelUrl, id = '', callback) {\r\n  if (!pixelUrl) {\r\n    return;\r\n  }\r\n\r\n  // Use pubcid as a cache buster\r\n  const urlInfo = parseUrl(pixelUrl);\r\n  urlInfo.search.id = encodeURIComponent('pubcid:' + id);\r\n  const targetUrl = buildUrl(urlInfo);\r\n\r\n  return function () {\r\n    triggerPixel(targetUrl);\r\n  };\r\n}\r\n\r\nfunction hasOptedOut() {\r\n  return !!((storage.cookiesAreEnabled() && readValue(OPTOUT_NAME, COOKIE)) ||\r\n    (storage.hasLocalStorage() && readValue(OPTOUT_NAME, LOCAL_STORAGE)));\r\n}\r\n\r\nexport const sharedIdSystemSubmodule = {\r\n  /**\r\n   * used to link submodule with config\r\n   * @type {string}\r\n   */\r\n  name: 'sharedId',\r\n  aliasName: 'pubCommonId',\r\n\r\n  /**\r\n   * decode the stored id value for passing to bid requests\r\n   * @function\r\n   * @param {string} value\r\n   * @param {SubmoduleConfig} config\r\n   * @returns {{pubcid:string}}\r\n   */\r\n  decode(value, config) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId decode: Has opted-out');\r\n      return undefined;\r\n    }\r\n    logInfo(' Decoded value PubCommonId ' + value);\r\n    const idObj = {'pubcid': value};\r\n    return idObj;\r\n  },\r\n  /**\r\n   * performs action to obtain id\r\n   * @function\r\n   * @param {SubmoduleConfig} [config] Config object with params and storage properties\r\n   * @param {Object} consentData\r\n   * @param {string} storedId Existing pubcommon id\r\n   * @returns {IdResponse}\r\n   */\r\n  getId: function (config = {}, consentData, storedId) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId: Has opted-out');\r\n      return;\r\n    }\r\n    const coppa = coppaDataHandler.getCoppa();\r\n\r\n    if (coppa) {\r\n      logInfo('PubCommonId: IDs not provided for coppa requests, exiting PubCommonId');\r\n      return;\r\n    }\r\n    const {params: {create = true, pixelUrl} = {}} = config;\r\n    let newId = storedId;\r\n    if (!newId) {\r\n      try {\r\n        if (typeof window[PUB_COMMON_ID] === 'object') {\r\n          // If the page includes its own pubcid module, then save a copy of id.\r\n          newId = window[PUB_COMMON_ID].getId();\r\n        }\r\n      } catch (e) {\r\n      }\r\n\r\n      if (!newId) newId = (create && hasDeviceAccess()) ? generateUUID() : undefined;\r\n    }\r\n\r\n    const pixelCallback = queuePixelCallback(pixelUrl, newId);\r\n    return {id: newId, callback: getIdCallback(newId, pixelCallback)};\r\n  },\r\n  /**\r\n   * performs action to extend an id.  There are generally two ways to extend the expiration time\r\n   * of stored id: using pixelUrl or return the id and let main user id module write it again with\r\n   * the new expiration time.\r\n   *\r\n   * PixelUrl, if defined, should point back to a first party domain endpoint.  On the server\r\n   * side, there is either a plugin, or customized logic to read and write back the pubcid cookie.\r\n   * The extendId function itself should return only the callback, and not the id itself to avoid\r\n   * having the script-side overwriting server-side.  This applies to both pubcid and sharedid.\r\n   *\r\n   * On the other hand, if there is no pixelUrl, then the extendId should return storedId so that\r\n   * its expiration time is updated.\r\n   *\r\n   * @function\r\n   * @param {SubmoduleParams} [config]\r\n   * @param {ConsentData|undefined} consentData\r\n   * @param {Object} storedId existing id\r\n   * @returns {IdResponse|undefined}\r\n   */\r\n  extendId: function(config = {}, consentData, storedId) {\r\n    if (hasOptedOut()) {\r\n      logInfo('PubCommonId: Has opted-out');\r\n      return {id: undefined};\r\n    }\r\n    const coppa = coppaDataHandler.getCoppa();\r\n    if (coppa) {\r\n      logInfo('PubCommonId: IDs not provided for coppa requests, exiting PubCommonId');\r\n      return;\r\n    }\r\n    const {params: {extend = false, pixelUrl} = {}} = config;\r\n\r\n    if (extend) {\r\n      if (pixelUrl) {\r\n        const callback = queuePixelCallback(pixelUrl, storedId);\r\n        return {callback: callback};\r\n      } else {\r\n        return {id: storedId};\r\n      }\r\n    }\r\n  },\r\n\r\n  domainOverride: function () {\r\n    const domainElements = document.domain.split('.');\r\n    const cookieName = `_gd${Date.now()}`;\r\n    for (let i = 0, topDomain, testCookie; i < domainElements.length; i++) {\r\n      const nextDomain = domainElements.slice(i).join('.');\r\n\r\n      // write test cookie\r\n      storage.setCookie(cookieName, '1', undefined, undefined, nextDomain);\r\n\r\n      // read test cookie to verify domain was valid\r\n      testCookie = storage.getCookie(cookieName);\r\n\r\n      // delete test cookie\r\n      storage.setCookie(cookieName, '', 'Thu, 01 Jan 1970 00:00:01 GMT', undefined, nextDomain);\r\n\r\n      if (testCookie === '1') {\r\n        // cookie was written successfully using test domain so the topDomain is updated\r\n        topDomain = nextDomain;\r\n      } else {\r\n        // cookie failed to write using test domain so exit by returning the topDomain\r\n        return topDomain;\r\n      }\r\n    }\r\n  }\r\n\r\n};\r\n\r\nsubmodule('userId', sharedIdSystemSubmodule);\r\n","import { pick, isFn, isStr, isPlainObject, deepAccess } from '../../src/utils.js';\r\n\r\n// Each user-id sub-module is expected to mention respective config here\r\nexport const USER_IDS_CONFIG = {\r\n\r\n  // key-name : {config}\r\n\r\n  // GrowthCode\r\n  'growthCodeId': {\r\n    getValue: function(data) {\r\n      return data.gc_id\r\n    },\r\n    source: 'growthcode.io',\r\n    atype: 1,\r\n    getUidExt: function(data) {\r\n      const extendedData = pick(data, [\r\n        'h1',\r\n        'h2',\r\n        'h3',\r\n      ]);\r\n      if (Object.keys(extendedData).length) {\r\n        return extendedData;\r\n      }\r\n    }\r\n  },\r\n\r\n  // trustpid\r\n  'trustpid': {\r\n    source: 'trustpid.com',\r\n    atype: 1,\r\n    getValue: function (data) {\r\n      return data;\r\n    },\r\n  },\r\n\r\n  // intentIqId\r\n  'intentIqId': {\r\n    source: 'intentiq.com',\r\n    atype: 1\r\n  },\r\n\r\n  // naveggId\r\n  'naveggId': {\r\n    source: 'navegg.com',\r\n    atype: 1\r\n  },\r\n\r\n  // justId\r\n  'justId': {\r\n    source: 'justtag.com',\r\n    atype: 1\r\n  },\r\n\r\n  // pubCommonId\r\n  'pubcid': {\r\n    source: 'pubcid.org',\r\n    atype: 1\r\n  },\r\n\r\n  // unifiedId\r\n  'tdid': {\r\n    source: 'adserver.org',\r\n    atype: 1,\r\n    getUidExt: function() {\r\n      return {\r\n        rtiPartner: 'TDID'\r\n      };\r\n    }\r\n  },\r\n\r\n  // id5Id\r\n  'id5id': {\r\n    getValue: function(data) {\r\n      return data.uid\r\n    },\r\n    source: 'id5-sync.com',\r\n    atype: 1,\r\n    getUidExt: function(data) {\r\n      if (data.ext) {\r\n        return data.ext;\r\n      }\r\n    }\r\n  },\r\n\r\n  // ftrack\r\n  'ftrackId': {\r\n    source: 'flashtalking.com',\r\n    atype: 1,\r\n    getValue: function(data) {\r\n      let value = '';\r\n      if (data.DeviceID) {\r\n        value = data.DeviceID.join(',');\r\n      }\r\n      return value;\r\n    },\r\n    getUidExt: function(data) {\r\n      return 'DeviceID';\r\n    }\r\n  },\r\n\r\n  // parrableId\r\n  'parrableId': {\r\n    source: 'parrable.com',\r\n    atype: 1,\r\n    getValue: function(parrableId) {\r\n      if (parrableId.eid) {\r\n        return parrableId.eid;\r\n      }\r\n      if (parrableId.ccpaOptout) {\r\n        // If the EID was suppressed due to a non consenting ccpa optout then\r\n        // we still wish to provide this as a reason to the adapters\r\n        return '';\r\n      }\r\n      return null;\r\n    },\r\n    getUidExt: function(parrableId) {\r\n      const extendedData = pick(parrableId, [\r\n        'ibaOptout',\r\n        'ccpaOptout'\r\n      ]);\r\n      if (Object.keys(extendedData).length) {\r\n        return extendedData;\r\n      }\r\n    }\r\n  },\r\n\r\n  // identityLink\r\n  'idl_env': {\r\n    source: 'liveramp.com',\r\n    atype: 3\r\n  },\r\n\r\n  // liveIntentId\r\n  'lipb': {\r\n    getValue: function(data) {\r\n      return data.lipbid;\r\n    },\r\n    source: 'liveintent.com',\r\n    atype: 3,\r\n    getEidExt: function(data) {\r\n      if (Array.isArray(data.segments) && data.segments.length) {\r\n        return {\r\n          segments: data.segments\r\n        };\r\n      }\r\n    }\r\n  },\r\n\r\n  // britepoolId\r\n  'britepoolid': {\r\n    source: 'britepool.com',\r\n    atype: 3\r\n  },\r\n\r\n  // dmdId\r\n  'dmdId': {\r\n    source: 'hcn.health',\r\n    atype: 3\r\n  },\r\n\r\n  // lotamePanoramaId\r\n  lotamePanoramaId: {\r\n    source: 'crwdcntrl.net',\r\n    atype: 1,\r\n  },\r\n\r\n  // criteo\r\n  'criteoId': {\r\n    source: 'criteo.com',\r\n    atype: 1\r\n  },\r\n\r\n  // merkleId\r\n  'merkleId': {\r\n    atype: 3,\r\n    getSource: function(data) {\r\n      if (data?.ext?.ssp) {\r\n        return `${data.ext.ssp}.merkleinc.com`\r\n      }\r\n      return 'merkleinc.com'\r\n    },\r\n    getValue: function(data) {\r\n      return data.id;\r\n    },\r\n    getUidExt: function(data) {\r\n      if (data.keyID) {\r\n        return {\r\n          keyID: data.keyID\r\n        }\r\n      }\r\n      if (data.ext) {\r\n        return data.ext;\r\n      }\r\n    }\r\n  },\r\n\r\n  // NetId\r\n  'netId': {\r\n    source: 'netid.de',\r\n    atype: 1\r\n  },\r\n\r\n  // zeotapIdPlus\r\n  'IDP': {\r\n    source: 'zeotap.com',\r\n    atype: 1\r\n  },\r\n\r\n  // hadronId\r\n  'hadronId': {\r\n    source: 'audigent.com',\r\n    atype: 1\r\n  },\r\n\r\n  // quantcastId\r\n  'quantcastId': {\r\n    source: 'quantcast.com',\r\n    atype: 1\r\n  },\r\n\r\n  // IDx\r\n  'idx': {\r\n    source: 'idx.lat',\r\n    atype: 1\r\n  },\r\n\r\n  // Verizon Media ConnectID\r\n  'connectid': {\r\n    source: 'verizonmedia.com',\r\n    atype: 3\r\n  },\r\n\r\n  // Neustar Fabrick\r\n  'fabrickId': {\r\n    source: 'neustar.biz',\r\n    atype: 1\r\n  },\r\n\r\n  // MediaWallah OpenLink\r\n  'mwOpenLinkId': {\r\n    source: 'mediawallahscript.com',\r\n    atype: 1\r\n  },\r\n\r\n  'tapadId': {\r\n    source: 'tapad.com',\r\n    atype: 1\r\n  },\r\n\r\n  // Novatiq Snowflake\r\n  'novatiq': {\r\n    getValue: function(data) {\r\n      return data.snowflake\r\n    },\r\n    source: 'novatiq.com',\r\n    atype: 1\r\n  },\r\n\r\n  'uid2': {\r\n    source: 'uidapi.com',\r\n    atype: 3,\r\n    getValue: function(data) {\r\n      return data.id;\r\n    }\r\n  },\r\n\r\n  'deepintentId': {\r\n    source: 'deepintent.com',\r\n    atype: 3\r\n  },\r\n\r\n  // Admixer Id\r\n  'admixerId': {\r\n    source: 'admixer.net',\r\n    atype: 3\r\n  },\r\n\r\n  // Adtelligent Id\r\n  'adtelligentId': {\r\n    source: 'adtelligent.com',\r\n    atype: 3\r\n  },\r\n\r\n  amxId: {\r\n    source: 'amxrtb.com',\r\n    atype: 1,\r\n  },\r\n\r\n  'publinkId': {\r\n    source: 'epsilon.com',\r\n    atype: 3\r\n  },\r\n\r\n  'kpuid': {\r\n    source: 'kpuid.com',\r\n    atype: 3\r\n  },\r\n\r\n  'imppid': {\r\n    source: 'ppid.intimatemerger.com',\r\n    atype: 1\r\n  },\r\n\r\n  'imuid': {\r\n    source: 'intimatemerger.com',\r\n    atype: 1\r\n  },\r\n\r\n  // Yahoo ConnectID\r\n  'connectId': {\r\n    source: 'yahoo.com',\r\n    atype: 3\r\n  },\r\n\r\n  // Adquery ID\r\n  'qid': {\r\n    source: 'adquery.io',\r\n    atype: 1\r\n  },\r\n\r\n  // DAC ID\r\n  'dacId': {\r\n    source: 'impact-ad.jp',\r\n    atype: 1\r\n  },\r\n\r\n  // 33across ID\r\n  '33acrossId': {\r\n    source: '33across.com',\r\n    atype: 1,\r\n    getValue: function(data) {\r\n      return data.envelope;\r\n    }\r\n  },\r\n\r\n  // tncId\r\n  'tncid': {\r\n    source: 'thenewco.it',\r\n    atype: 3\r\n  },\r\n\r\n  // Gravito MP ID\r\n  'gravitompId': {\r\n    source: 'gravito.net',\r\n    atype: 1\r\n  },\r\n\r\n  // cpexId\r\n  'cpexId': {\r\n    source: 'czechadid.cz',\r\n    atype: 1\r\n  },\r\n\r\n  // OneKey Data\r\n  'oneKeyData': {\r\n    getValue: function(data) {\r\n      if (data && Array.isArray(data.identifiers) && data.identifiers[0]) {\r\n        return data.identifiers[0].value;\r\n      }\r\n    },\r\n    source: 'paf',\r\n    atype: 1,\r\n    getEidExt: function(data) {\r\n      if (data && data.preferences) {\r\n        return {preferences: data.preferences};\r\n      }\r\n    },\r\n    getUidExt: function(data) {\r\n      if (data && Array.isArray(data.identifiers) && data.identifiers[0]) {\r\n        const id = data.identifiers[0];\r\n        return {\r\n          version: id.version,\r\n          type: id.type,\r\n          source: id.source\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// this function will create an eid object for the given UserId sub-module\r\nfunction createEidObject(userIdData, subModuleKey) {\r\n  const conf = USER_IDS_CONFIG[subModuleKey];\r\n  if (conf && userIdData) {\r\n    let eid = {};\r\n    eid.source = isFn(conf['getSource']) ? conf['getSource'](userIdData) : conf['source'];\r\n    const value = isFn(conf['getValue']) ? conf['getValue'](userIdData) : userIdData;\r\n    if (isStr(value)) {\r\n      const uid = { id: value, atype: conf['atype'] };\r\n      // getUidExt\r\n      if (isFn(conf['getUidExt'])) {\r\n        const uidExt = conf['getUidExt'](userIdData);\r\n        if (uidExt) {\r\n          uid.ext = uidExt;\r\n        }\r\n      }\r\n      eid.uids = [uid];\r\n      // getEidExt\r\n      if (isFn(conf['getEidExt'])) {\r\n        const eidExt = conf['getEidExt'](userIdData);\r\n        if (eidExt) {\r\n          eid.ext = eidExt;\r\n        }\r\n      }\r\n      return eid;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n// this function will generate eids array for all available IDs in bidRequest.userId\r\n// this function will be called by userId module\r\n// if any adapter does not want any particular userId to be passed then adapter can use Array.filter(e => e.source != 'tdid')\r\nexport function createEidsArray(bidRequestUserId) {\r\n  let eids = [];\r\n\r\n  for (const subModuleKey in bidRequestUserId) {\r\n    if (bidRequestUserId.hasOwnProperty(subModuleKey)) {\r\n      if (subModuleKey === 'pubProvidedId') {\r\n        eids = eids.concat(bidRequestUserId['pubProvidedId']);\r\n      } else if (subModuleKey === 'ftrackId') {\r\n        // ftrack has multiple IDs so we add each one that exists\r\n        let eid = {\r\n          'atype': 1,\r\n          'id': (bidRequestUserId.ftrackId.DeviceID || []).join('|'),\r\n          'ext': {}\r\n        }\r\n        for (let id in bidRequestUserId.ftrackId) {\r\n          eid.ext[id] = (bidRequestUserId.ftrackId[id] || []).join('|');\r\n        }\r\n\r\n        eids.push(eid);\r\n      } else if (Array.isArray(bidRequestUserId[subModuleKey])) {\r\n        bidRequestUserId[subModuleKey].forEach((config, index, arr) => {\r\n          const eid = createEidObject(config, subModuleKey);\r\n\r\n          if (eid) {\r\n            eids.push(eid);\r\n          }\r\n        })\r\n      } else {\r\n        const eid = createEidObject(bidRequestUserId[subModuleKey], subModuleKey);\r\n        if (eid) {\r\n          eids.push(eid);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return eids;\r\n}\r\n\r\n/**\r\n * @param {SubmoduleContainer[]} submodules\r\n */\r\nexport function buildEidPermissions(submodules) {\r\n  let eidPermissions = [];\r\n  submodules.filter(i => isPlainObject(i.idObj) && Object.keys(i.idObj).length)\r\n    .forEach(i => {\r\n      Object.keys(i.idObj).forEach(key => {\r\n        if (deepAccess(i, 'config.bidders') && Array.isArray(i.config.bidders) &&\r\n          deepAccess(USER_IDS_CONFIG, key + '.source')) {\r\n          eidPermissions.push(\r\n            {\r\n              source: USER_IDS_CONFIG[key].source,\r\n              bidders: i.config.bidders\r\n            }\r\n          );\r\n        }\r\n      });\r\n    });\r\n  return eidPermissions;\r\n}\r\n","/**\r\n * This module adds User ID support to prebid.js\r\n * @module modules/userId\r\n */\r\n\r\n/**\r\n * @interface Submodule\r\n */\r\n\r\n/**\r\n * @function\r\n * @summary performs action to obtain id and return a value in the callback's response argument.\r\n *  If IdResponse#id is defined, then it will be written to the current active storage.\r\n *  If IdResponse#callback is defined, then it'll called at the end of auction.\r\n *  It's permissible to return neither, one, or both fields.\r\n * @name Submodule#getId\r\n * @param {SubmoduleConfig} config\r\n * @param {ConsentData|undefined} consentData\r\n * @param {(Object|undefined)} cacheIdObj\r\n * @return {(IdResponse|undefined)} A response object that contains id and/or callback.\r\n */\r\n\r\n/**\r\n * @function\r\n * @summary Similar to Submodule#getId, this optional method returns response to for id that exists already.\r\n *  If IdResponse#id is defined, then it will be written to the current active storage even if it exists already.\r\n *  If IdResponse#callback is defined, then it'll called at the end of auction.\r\n *  It's permissible to return neither, one, or both fields.\r\n * @name Submodule#extendId\r\n * @param {SubmoduleConfig} config\r\n * @param {ConsentData|undefined} consentData\r\n * @param {Object} storedId - existing id, if any\r\n * @return {(IdResponse|function(callback:function))} A response object that contains id and/or callback.\r\n */\r\n\r\n/**\r\n * @function\r\n * @summary decode a stored value for passing to bid requests\r\n * @name Submodule#decode\r\n * @param {Object|string} value\r\n * @param {SubmoduleConfig|undefined} config\r\n * @return {(Object|undefined)}\r\n */\r\n\r\n/**\r\n * @property\r\n * @summary used to link submodule with config\r\n * @name Submodule#name\r\n * @type {string}\r\n */\r\n\r\n/**\r\n * @property\r\n * @summary use a predefined domain override for cookies or provide your own\r\n * @name Submodule#domainOverride\r\n * @type {(undefined|function)}\r\n */\r\n\r\n/**\r\n * @function\r\n * @summary Returns the root domain\r\n * @name Submodule#findRootDomain\r\n * @returns {string}\r\n */\r\n\r\n/**\r\n * @typedef {Object} SubmoduleConfig\r\n * @property {string} name - the User ID submodule name (used to link submodule with config)\r\n * @property {(SubmoduleStorage|undefined)} storage - browser storage config\r\n * @property {(SubmoduleParams|undefined)} params - params config for use by the submodule.getId function\r\n * @property {(Object|undefined)} value - if not empty, this value is added to bid requests for access in adapters\r\n */\r\n\r\n/**\r\n * @typedef {Object} SubmoduleStorage\r\n * @property {string} type - browser storage type (html5 or cookie)\r\n * @property {string} name - key name to use when saving/reading to local storage or cookies\r\n * @property {number} expires - time to live for browser storage in days\r\n * @property {(number|undefined)} refreshInSeconds - if not empty, this value defines the maximum time span in seconds before refreshing user ID stored in browser\r\n */\r\n\r\n/**\r\n * @typedef {Object} LiveIntentCollectConfig\r\n * @property {(string|undefined)} fpiStorageStrategy - defines whether the first party identifiers that LiveConnect creates and updates are stored in a cookie jar, local storage, or not created at all\r\n * @property {(number|undefined)} fpiExpirationDays - the expiration time of an identifier created and updated by LiveConnect\r\n * @property {(string|undefined)} collectorUrl - defines where the LiveIntentId signal pixels are pointing to\r\n * @property {(string|undefined)} appId - the  unique identifier of the application in question\r\n */\r\n\r\n/**\r\n * @typedef {Object} SubmoduleParams\r\n * @property {(string|undefined)} partner - partner url param value\r\n * @property {(string|undefined)} url - webservice request url used to load Id data\r\n * @property {(string|undefined)} pixelUrl - publisher pixel to extend/modify cookies\r\n * @property {(boolean|undefined)} create - create id if missing.  default is true.\r\n * @property {(boolean|undefined)} extend - extend expiration time on each access.  default is false.\r\n * @property {(string|undefined)} pid - placement id url param value\r\n * @property {(string|undefined)} publisherId - the unique identifier of the publisher in question\r\n * @property {(string|undefined)} ajaxTimeout - the number of milliseconds a resolution request can take before automatically being terminated\r\n * @property {(array|undefined)} identifiersToResolve - the identifiers from either ls|cookie to be attached to the getId query\r\n * @property {(LiveIntentCollectConfig|undefined)} liCollectConfig - the config for LiveIntent's collect requests\r\n * @property {(string|undefined)} pd - publisher provided data for reconciling ID5 IDs\r\n * @property {(string|undefined)} emailHash - if provided, the hashed email address of a user\r\n * @property {(string|undefined)} notUse3P - use to retrieve envelope from 3p endpoint\r\n */\r\n\r\n/**\r\n * @typedef {Object} SubmoduleContainer\r\n * @property {Submodule} submodule\r\n * @property {SubmoduleConfig} config\r\n * @property {(Object|undefined)} idObj - cache decoded id value (this is copied to every adUnit bid)\r\n * @property {(function|undefined)} callback - holds reference to submodule.getId() result if it returned a function. Will be set to undefined after callback executes\r\n */\r\n\r\n/**\r\n * @typedef {Object} ConsentData\r\n * @property {(string|undefined)} consentString\r\n * @property {(Object|undefined)} vendorData\r\n * @property {(boolean|undefined)} gdprApplies\r\n */\r\n\r\n/**\r\n * @typedef {Object} IdResponse\r\n * @property {(Object|undefined)} id - id data\r\n * @property {(function|undefined)} callback - function that will return an id\r\n */\r\n\r\nimport {find, includes} from '../../src/polyfill.js';\r\nimport {config} from '../../src/config.js';\r\nimport * as events from '../../src/events.js';\r\nimport {getGlobal} from '../../src/prebidGlobal.js';\r\nimport {gdprDataHandler} from '../../src/adapterManager.js';\r\nimport CONSTANTS from '../../src/constants.json';\r\nimport {hook, module, ready as hooksReady} from '../../src/hook.js';\r\nimport {buildEidPermissions, createEidsArray, USER_IDS_CONFIG} from './eids.js';\r\nimport {getCoreStorageManager} from '../../src/storageManager.js';\r\nimport {\r\n  cyrb53Hash,\r\n  deepAccess,\r\n  delayExecution,\r\n  getPrebidInternal,\r\n  isArray,\r\n  isEmptyStr,\r\n  isFn,\r\n  isGptPubadsDefined,\r\n  isNumber,\r\n  isPlainObject,\r\n  logError,\r\n  logInfo,\r\n  logWarn,\r\n  timestamp,\r\n  isEmpty\r\n} from '../../src/utils.js';\r\nimport {getPPID as coreGetPPID} from '../../src/adserver.js';\r\nimport {defer, GreedyPromise} from '../../src/utils/promise.js';\r\nimport {hasPurpose1Consent} from '../../src/utils/gpdr.js';\r\nimport {newMetrics, timedAuctionHook, useMetrics} from '../../src/utils/perfMetrics.js';\r\n\r\nconst MODULE_NAME = 'User ID';\r\nconst COOKIE = 'cookie';\r\nconst LOCAL_STORAGE = 'html5';\r\nconst DEFAULT_SYNC_DELAY = 500;\r\nconst NO_AUCTION_DELAY = 0;\r\nconst CONSENT_DATA_COOKIE_STORAGE_CONFIG = {\r\n  name: '_pbjs_userid_consent_data',\r\n  expires: 30 // 30 days expiration, which should match how often consent is refreshed by CMPs\r\n};\r\nexport const PBJS_USER_ID_OPTOUT_NAME = '_pbjs_id_optout';\r\nexport const coreStorage = getCoreStorageManager('userid');\r\n\r\n/** @type {boolean} */\r\nlet addedUserIdHook = false;\r\n\r\n/** @type {SubmoduleContainer[]} */\r\nlet submodules = [];\r\n\r\n/** @type {SubmoduleContainer[]} */\r\nlet initializedSubmodules;\r\n\r\n/** @type {SubmoduleConfig[]} */\r\nlet configRegistry = [];\r\n\r\n/** @type {Submodule[]} */\r\nlet submoduleRegistry = [];\r\n\r\n/** @type {(number|undefined)} */\r\nlet timeoutID;\r\n\r\n/** @type {(number|undefined)} */\r\nexport let syncDelay;\r\n\r\n/** @type {(number|undefined)} */\r\nexport let auctionDelay;\r\n\r\n/** @type {(string|undefined)} */\r\nlet ppidSource;\r\n\r\nlet configListener;\r\n\r\nconst uidMetrics = (() => {\r\n  let metrics;\r\n  return () => {\r\n    if (metrics == null) {\r\n      metrics = newMetrics();\r\n    }\r\n    return metrics;\r\n  }\r\n})();\r\n\r\nfunction submoduleMetrics(moduleName) {\r\n  return uidMetrics().fork().renameWith(n => [`userId.mod.${n}`, `userId.mods.${moduleName}.${n}`])\r\n}\r\n\r\n/** @param {Submodule[]} submodules */\r\nexport function setSubmoduleRegistry(submodules) {\r\n  submoduleRegistry = submodules;\r\n}\r\n\r\n/**\r\n * @param {SubmoduleContainer} submodule\r\n * @param {(Object|string)} value\r\n */\r\nexport function setStoredValue(submodule, value) {\r\n  /**\r\n   * @type {SubmoduleStorage}\r\n   */\r\n  const storage = submodule.config.storage;\r\n  const domainOverride = (typeof submodule.submodule.domainOverride === 'function') ? submodule.submodule.domainOverride() : null;\r\n\r\n  try {\r\n    const valueStr = isPlainObject(value) ? JSON.stringify(value) : value;\r\n    const expiresStr = (new Date(Date.now() + (storage.expires * (60 * 60 * 24 * 1000)))).toUTCString();\r\n    if (storage.type === COOKIE) {\r\n      coreStorage.setCookie(storage.name, valueStr, expiresStr, 'Lax', domainOverride);\r\n      if (typeof storage.refreshInSeconds === 'number') {\r\n        coreStorage.setCookie(`${storage.name}_last`, new Date().toUTCString(), expiresStr, 'Lax', domainOverride);\r\n      }\r\n    } else if (storage.type === LOCAL_STORAGE) {\r\n      coreStorage.setDataInLocalStorage(`${storage.name}_exp`, expiresStr);\r\n      coreStorage.setDataInLocalStorage(storage.name, encodeURIComponent(valueStr));\r\n      if (typeof storage.refreshInSeconds === 'number') {\r\n        coreStorage.setDataInLocalStorage(`${storage.name}_last`, new Date().toUTCString());\r\n      }\r\n    }\r\n  } catch (error) {\r\n    logError(error);\r\n  }\r\n}\r\n\r\nfunction setPrebidServerEidPermissions(initializedSubmodules) {\r\n  let setEidPermissions = getPrebidInternal().setEidPermissions;\r\n  if (typeof setEidPermissions === 'function' && isArray(initializedSubmodules)) {\r\n    setEidPermissions(buildEidPermissions(initializedSubmodules));\r\n  }\r\n}\r\n\r\n/**\r\n/**\r\n * @param {SubmoduleStorage} storage\r\n * @param {String|undefined} key optional key of the value\r\n * @returns {string}\r\n */\r\nfunction getStoredValue(storage, key = undefined) {\r\n  const storedKey = key ? `${storage.name}_${key}` : storage.name;\r\n  let storedValue;\r\n  try {\r\n    if (storage.type === COOKIE) {\r\n      storedValue = coreStorage.getCookie(storedKey);\r\n    } else if (storage.type === LOCAL_STORAGE) {\r\n      const storedValueExp = coreStorage.getDataFromLocalStorage(`${storage.name}_exp`);\r\n      // empty string means no expiration set\r\n      if (storedValueExp === '') {\r\n        storedValue = coreStorage.getDataFromLocalStorage(storedKey);\r\n      } else if (storedValueExp) {\r\n        if ((new Date(storedValueExp)).getTime() - Date.now() > 0) {\r\n          storedValue = decodeURIComponent(coreStorage.getDataFromLocalStorage(storedKey));\r\n        }\r\n      }\r\n    }\r\n    // support storing a string or a stringified object\r\n    if (typeof storedValue === 'string' && storedValue.trim().charAt(0) === '{') {\r\n      storedValue = JSON.parse(storedValue);\r\n    }\r\n  } catch (e) {\r\n    logError(e);\r\n  }\r\n  return storedValue;\r\n}\r\n\r\n/**\r\n * makes an object that can be stored with only the keys we need to check.\r\n * excluding the vendorConsents object since the consentString is enough to know\r\n * if consent has changed without needing to have all the details in an object\r\n * @param consentData\r\n * @returns {{apiVersion: number, gdprApplies: boolean, consentString: string}}\r\n */\r\nfunction makeStoredConsentDataHash(consentData) {\r\n  const storedConsentData = {\r\n    consentString: '',\r\n    gdprApplies: false,\r\n    apiVersion: 0\r\n  };\r\n\r\n  if (consentData) {\r\n    storedConsentData.consentString = consentData.consentString;\r\n    storedConsentData.gdprApplies = consentData.gdprApplies;\r\n    storedConsentData.apiVersion = consentData.apiVersion;\r\n  }\r\n\r\n  return cyrb53Hash(JSON.stringify(storedConsentData));\r\n}\r\n\r\n/**\r\n * puts the current consent data into cookie storage\r\n * @param consentData\r\n */\r\nexport function setStoredConsentData(consentData) {\r\n  try {\r\n    const expiresStr = (new Date(Date.now() + (CONSENT_DATA_COOKIE_STORAGE_CONFIG.expires * (60 * 60 * 24 * 1000)))).toUTCString();\r\n    coreStorage.setCookie(CONSENT_DATA_COOKIE_STORAGE_CONFIG.name, makeStoredConsentDataHash(consentData), expiresStr, 'Lax');\r\n  } catch (error) {\r\n    logError(error);\r\n  }\r\n}\r\n\r\n/**\r\n * get the stored consent data from local storage, if any\r\n * @returns {string}\r\n */\r\nfunction getStoredConsentData() {\r\n  try {\r\n    return coreStorage.getCookie(CONSENT_DATA_COOKIE_STORAGE_CONFIG.name);\r\n  } catch (e) {\r\n    logError(e);\r\n  }\r\n}\r\n\r\n/**\r\n * test if the consent object stored locally matches the current consent data. if they\r\n * don't match or there is nothing stored locally, it means a refresh of the user id\r\n * submodule is needed\r\n * @param storedConsentData\r\n * @param consentData\r\n * @returns {boolean}\r\n */\r\nfunction storedConsentDataMatchesConsentData(storedConsentData, consentData) {\r\n  return (\r\n    typeof storedConsentData !== 'undefined' &&\r\n    storedConsentData !== null &&\r\n    storedConsentData === makeStoredConsentDataHash(consentData)\r\n  );\r\n}\r\n\r\n/**\r\n   * Find the root domain\r\n   * @param {string|undefined} fullDomain\r\n   * @return {string}\r\n   */\r\nexport function findRootDomain(fullDomain = window.location.hostname) {\r\n  if (!coreStorage.cookiesAreEnabled()) {\r\n    return fullDomain;\r\n  }\r\n\r\n  const domainParts = fullDomain.split('.');\r\n  if (domainParts.length == 2) {\r\n    return fullDomain;\r\n  }\r\n  let rootDomain;\r\n  let continueSearching;\r\n  let startIndex = -2;\r\n  const TEST_COOKIE_NAME = `_rdc${Date.now()}`;\r\n  const TEST_COOKIE_VALUE = 'writeable';\r\n  do {\r\n    rootDomain = domainParts.slice(startIndex).join('.');\r\n    let expirationDate = new Date(timestamp() + 10 * 1000).toUTCString();\r\n\r\n    // Write a test cookie\r\n    coreStorage.setCookie(\r\n      TEST_COOKIE_NAME,\r\n      TEST_COOKIE_VALUE,\r\n      expirationDate,\r\n      'Lax',\r\n      rootDomain,\r\n      undefined\r\n    );\r\n\r\n    // See if the write was successful\r\n    const value = coreStorage.getCookie(TEST_COOKIE_NAME, undefined);\r\n    if (value === TEST_COOKIE_VALUE) {\r\n      continueSearching = false;\r\n      // Delete our test cookie\r\n      coreStorage.setCookie(\r\n        TEST_COOKIE_NAME,\r\n        '',\r\n        'Thu, 01 Jan 1970 00:00:01 GMT',\r\n        undefined,\r\n        rootDomain,\r\n        undefined\r\n      );\r\n    } else {\r\n      startIndex += -1;\r\n      continueSearching = Math.abs(startIndex) <= domainParts.length;\r\n    }\r\n  } while (continueSearching);\r\n  return rootDomain;\r\n}\r\n\r\n/**\r\n * @param {SubmoduleContainer[]} submodules\r\n * @param {function} cb - callback for after processing is done.\r\n */\r\nfunction processSubmoduleCallbacks(submodules, cb) {\r\n  cb = uidMetrics().fork().startTiming('userId.callbacks.total').stopBefore(cb);\r\n  const done = delayExecution(() => {\r\n    clearTimeout(timeoutID);\r\n    cb();\r\n  }, submodules.length);\r\n  submodules.forEach(function (submodule) {\r\n    const moduleDone = submoduleMetrics(submodule.submodule.name).startTiming('callback').stopBefore(done);\r\n    function callbackCompleted(idObj) {\r\n      // if valid, id data should be saved to cookie/html storage\r\n      if (idObj) {\r\n        if (submodule.config.storage) {\r\n          setStoredValue(submodule, idObj);\r\n        }\r\n        // cache decoded value (this is copied to every adUnit bid)\r\n        submodule.idObj = submodule.submodule.decode(idObj, submodule.config);\r\n      } else {\r\n        logInfo(`${MODULE_NAME}: ${submodule.submodule.name} - request id responded with an empty value`);\r\n      }\r\n      moduleDone();\r\n    }\r\n    try {\r\n      submodule.callback(callbackCompleted);\r\n    } catch (e) {\r\n      logError(`Error in userID module '${submodule.submodule.name}':`, e);\r\n      moduleDone();\r\n    }\r\n    // clear callback, this prop is used to test if all submodule callbacks are complete below\r\n    submodule.callback = undefined;\r\n  });\r\n}\r\n\r\n/**\r\n * This function will create a combined object for all subModule Ids\r\n * @param {SubmoduleContainer[]} submodules\r\n */\r\nfunction getCombinedSubmoduleIds(submodules) {\r\n  if (!Array.isArray(submodules) || !submodules.length) {\r\n    return {};\r\n  }\r\n  const combinedSubmoduleIds = submodules.filter(i => isPlainObject(i.idObj) && Object.keys(i.idObj).length).reduce((carry, i) => {\r\n    Object.keys(i.idObj).forEach(key => {\r\n      carry[key] = i.idObj[key];\r\n    });\r\n    return carry;\r\n  }, {});\r\n\r\n  return combinedSubmoduleIds;\r\n}\r\n\r\n/**\r\n * This function will return a submodule ID object for particular source name\r\n * @param {SubmoduleContainer[]} submodules\r\n * @param {string} sourceName\r\n */\r\nfunction getSubmoduleId(submodules, sourceName) {\r\n  if (!Array.isArray(submodules) || !submodules.length) {\r\n    return {};\r\n  }\r\n  const submodule = submodules.filter(sub => isPlainObject(sub.idObj) &&\r\n    Object.keys(sub.idObj).length && USER_IDS_CONFIG[Object.keys(sub.idObj)[0]]?.source === sourceName);\r\n  return !isEmpty(submodule) ? submodule[0].idObj : [];\r\n}\r\n\r\n/**\r\n * This function will create a combined object for bidder with allowed subModule Ids\r\n * @param {SubmoduleContainer[]} submodules\r\n * @param {string} bidder\r\n */\r\nfunction getCombinedSubmoduleIdsForBidder(submodules, bidder) {\r\n  if (!Array.isArray(submodules) || !submodules.length || !bidder) {\r\n    return {};\r\n  }\r\n  return submodules\r\n    .filter(i => !i.config.bidders || !isArray(i.config.bidders) || includes(i.config.bidders, bidder))\r\n    .filter(i => isPlainObject(i.idObj) && Object.keys(i.idObj).length)\r\n    .reduce((carry, i) => {\r\n      Object.keys(i.idObj).forEach(key => {\r\n        carry[key] = i.idObj[key];\r\n      });\r\n      return carry;\r\n    }, {});\r\n}\r\n\r\n/**\r\n * @param {AdUnit[]} adUnits\r\n * @param {SubmoduleContainer[]} submodules\r\n */\r\nfunction addIdDataToAdUnitBids(adUnits, submodules) {\r\n  if ([adUnits].some(i => !Array.isArray(i) || !i.length)) {\r\n    return;\r\n  }\r\n  adUnits.forEach(adUnit => {\r\n    if (adUnit.bids && isArray(adUnit.bids)) {\r\n      adUnit.bids.forEach(bid => {\r\n        const combinedSubmoduleIds = getCombinedSubmoduleIdsForBidder(submodules, bid.bidder);\r\n        if (Object.keys(combinedSubmoduleIds).length) {\r\n          // create a User ID object on the bid,\r\n          bid.userId = combinedSubmoduleIds;\r\n          bid.userIdAsEids = createEidsArray(combinedSubmoduleIds);\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nconst INIT_CANCELED = {};\r\n\r\nfunction idSystemInitializer({delay = GreedyPromise.timeout} = {}) {\r\n  const startInit = defer();\r\n  const startCallbacks = defer();\r\n  let cancel;\r\n  let initialized = false;\r\n  let initMetrics;\r\n\r\n  function cancelAndTry(promise) {\r\n    initMetrics = uidMetrics().fork();\r\n    if (cancel != null) {\r\n      cancel.reject(INIT_CANCELED);\r\n    }\r\n    cancel = defer();\r\n    return GreedyPromise.race([promise, cancel.promise])\r\n      .finally(initMetrics.startTiming('userId.total'))\r\n  }\r\n\r\n  // grab a reference to global vars so that the promise chains remain isolated;\r\n  // multiple calls to `init` (from tests) might otherwise cause them to interfere with each other\r\n  let initModules = initializedSubmodules;\r\n  let allModules = submodules;\r\n\r\n  function checkRefs(fn) {\r\n    // unfortunately tests have their own global state that needs to be guarded, so even if we keep ours tidy,\r\n    // we cannot let things like submodule callbacks run (they pollute things like the global `server` XHR mock)\r\n    return function(...args) {\r\n      if (initModules === initializedSubmodules && allModules === submodules) {\r\n        return fn(...args);\r\n      }\r\n    }\r\n  }\r\n\r\n  function timeGdpr() {\r\n    return gdprDataHandler.promise.finally(initMetrics.startTiming('userId.init.gdpr'));\r\n  }\r\n\r\n  let done = cancelAndTry(\r\n    GreedyPromise.all([hooksReady, startInit.promise])\r\n      .then(timeGdpr)\r\n      .then(checkRefs((consentData) => {\r\n        initSubmodules(initModules, allModules, consentData);\r\n      }))\r\n      .then(() => startCallbacks.promise.finally(initMetrics.startTiming('userId.callbacks.pending')))\r\n      .then(checkRefs(() => {\r\n        const modWithCb = initModules.filter(item => isFn(item.callback));\r\n        if (modWithCb.length) {\r\n          return new GreedyPromise((resolve) => processSubmoduleCallbacks(modWithCb, resolve));\r\n        }\r\n      }))\r\n  );\r\n\r\n  /**\r\n   * with `ready` = true, starts initialization; with `refresh` = true, reinitialize submodules (optionally\r\n   * filtered by `submoduleNames`).\r\n   */\r\n  return function ({refresh = false, submoduleNames = null, ready = false} = {}) {\r\n    if (ready && !initialized) {\r\n      initialized = true;\r\n      startInit.resolve();\r\n      // submodule callbacks should run immediately if `auctionDelay` > 0, or `syncDelay` ms after the\r\n      // auction ends otherwise\r\n      if (auctionDelay > 0) {\r\n        startCallbacks.resolve();\r\n      } else {\r\n        events.on(CONSTANTS.EVENTS.AUCTION_END, function auctionEndHandler() {\r\n          events.off(CONSTANTS.EVENTS.AUCTION_END, auctionEndHandler);\r\n          delay(syncDelay).then(startCallbacks.resolve);\r\n        });\r\n      }\r\n    }\r\n    if (refresh && initialized) {\r\n      done = cancelAndTry(\r\n        done\r\n          .catch(() => null)\r\n          .then(timeGdpr) // fetch again in case a refresh was forced before this was resolved\r\n          .then(checkRefs((consentData) => {\r\n            const cbModules = initSubmodules(\r\n              initModules,\r\n              allModules.filter((sm) => submoduleNames == null || submoduleNames.includes(sm.submodule.name)),\r\n              consentData,\r\n              true\r\n            ).filter((sm) => {\r\n              return sm.callback != null;\r\n            });\r\n            if (cbModules.length) {\r\n              return new GreedyPromise((resolve) => processSubmoduleCallbacks(cbModules, resolve));\r\n            }\r\n          }))\r\n      );\r\n    }\r\n    return done;\r\n  };\r\n}\r\n\r\nlet initIdSystem;\r\n\r\nfunction getPPID() {\r\n  // userSync.ppid should be one of the 'source' values in getUserIdsAsEids() eg pubcid.org or id5-sync.com\r\n  const matchingUserId = ppidSource && (getUserIdsAsEids() || []).find(userID => userID.source === ppidSource);\r\n  if (matchingUserId && typeof deepAccess(matchingUserId, 'uids.0.id') === 'string') {\r\n    const ppidValue = matchingUserId.uids[0].id.replace(/[\\W_]/g, '');\r\n    if (ppidValue.length >= 32 && ppidValue.length <= 150) {\r\n      return ppidValue;\r\n    } else {\r\n      logWarn(`User ID - Googletag Publisher Provided ID for ${ppidSource} is not between 32 and 150 characters - ${ppidValue}`);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Hook is executed before adapters, but after consentManagement. Consent data is requied because\r\n * this module requires GDPR consent with Purpose #1 to save data locally.\r\n * The two main actions handled by the hook are:\r\n * 1. check gdpr consentData and handle submodule initialization.\r\n * 2. append user id data (loaded from cookied/html or from the getId method) to bids to be accessed in adapters.\r\n * @param {Object} reqBidsConfigObj required; This is the same param that's used in pbjs.requestBids.\r\n * @param {function} fn required; The next function in the chain, used by hook.js\r\n */\r\nexport const requestBidsHook = timedAuctionHook('userId', function requestBidsHook(fn, reqBidsConfigObj, {delay = GreedyPromise.timeout, getIds = getUserIdsAsync} = {}) {\r\n  GreedyPromise.race([\r\n    getIds().catch(() => null),\r\n    delay(auctionDelay)\r\n  ]).then(() => {\r\n    // pass available user id data to bid adapters\r\n    addIdDataToAdUnitBids(reqBidsConfigObj.adUnits || getGlobal().adUnits, initializedSubmodules);\r\n    const ppid = getPPID();\r\n    if (ppid) {\r\n      if (isGptPubadsDefined()) {\r\n        window.googletag.pubads().setPublisherProvidedId(ppid);\r\n      } else {\r\n        window.googletag = window.googletag || {};\r\n        window.googletag.cmd = window.googletag.cmd || [];\r\n        window.googletag.cmd.push(function() {\r\n          window.googletag.pubads().setPublisherProvidedId(ppid);\r\n        });\r\n      }\r\n    }\r\n    uidMetrics().join(useMetrics(reqBidsConfigObj.metrics), {propagate: false, includeGroups: true});\r\n    // calling fn allows prebid to continue processing\r\n    fn.call(this, reqBidsConfigObj);\r\n  });\r\n});\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\nfunction getUserIds() {\r\n  return getCombinedSubmoduleIds(initializedSubmodules)\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\nfunction getUserIdsAsEids() {\r\n  return createEidsArray(getUserIds())\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\r\n * Simple use case will be passing these UserIds to A9 wrapper solution\r\n */\r\n\r\nfunction getUserIdsAsEidBySource(sourceName) {\r\n  return createEidsArray(getSubmoduleId(initializedSubmodules, sourceName))[0];\r\n}\r\n\r\n/**\r\n * This function will be exposed in global-name-space so that userIds for a source can be exposed\r\n * Sample use case is exposing this function to ESP\r\n */\r\nfunction getEncryptedEidsForSource(source, encrypt, customFunction) {\r\n  return initIdSystem().then(() => {\r\n    let eidsSignals = {};\r\n\r\n    if (isFn(customFunction)) {\r\n      logInfo(`${MODULE_NAME} - Getting encrypted signal from custom function : ${customFunction.name} & source : ${source} `);\r\n      // Publishers are expected to define a common function which will be proxy for signal function.\r\n      const customSignals = customFunction(source);\r\n      eidsSignals[source] = customSignals ? encryptSignals(customSignals) : null; // by default encrypt using base64 to avoid JSON errors\r\n    } else {\r\n      // initialize signal with eids by default\r\n      const eid = getUserIdsAsEidBySource(source);\r\n      logInfo(`${MODULE_NAME} - Getting encrypted signal for eids :${JSON.stringify(eid)}`);\r\n      if (!isEmpty(eid)) {\r\n        eidsSignals[eid.source] = encrypt === true ? encryptSignals(eid) : eid.uids[0].id; // If encryption is enabled append version (1||) and encrypt entire object\r\n      }\r\n    }\r\n    logInfo(`${MODULE_NAME} - Fetching encrypted eids: ${eidsSignals[source]}`);\r\n    return eidsSignals[source];\r\n  })\r\n}\r\n\r\nfunction encryptSignals(signals, version = 1) {\r\n  let encryptedSig = '';\r\n  switch (version) {\r\n    case 1: // Base64 Encryption\r\n      encryptedSig = typeof signals === 'object' ? window.btoa(JSON.stringify(signals)) : window.btoa(signals); // Test encryption. To be replaced with better algo\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n  return `${version}||${encryptedSig}`;\r\n}\r\n\r\n/**\r\n* This function will be exposed in the global-name-space so that publisher can register the signals-ESP.\r\n*/\r\nfunction registerSignalSources() {\r\n  if (!isGptPubadsDefined()) {\r\n    return;\r\n  }\r\n  window.googletag.encryptedSignalProviders = window.googletag.encryptedSignalProviders || [];\r\n  const encryptedSignalSources = config.getConfig('userSync.encryptedSignalSources');\r\n  if (encryptedSignalSources) {\r\n    const registerDelay = encryptedSignalSources.registerDelay || 0;\r\n    setTimeout(() => {\r\n      encryptedSignalSources['sources'] && encryptedSignalSources['sources'].forEach(({ source, encrypt, customFunc }) => {\r\n        source.forEach((src) => {\r\n          window.googletag.encryptedSignalProviders.push({\r\n            id: src,\r\n            collectorFunction: () => getEncryptedEidsForSource(src, encrypt, customFunc)\r\n          });\r\n        });\r\n      })\r\n    }, registerDelay)\r\n  } else {\r\n    logWarn(`${MODULE_NAME} - ESP : encryptedSignalSources config not defined under userSync Object`);\r\n  }\r\n}\r\n\r\n/**\r\n * Force (re)initialization of ID submodules.\r\n *\r\n * This will force a refresh of the specified ID submodules regardless of `auctionDelay` / `syncDelay` settings, and\r\n * return a promise that resolves to the same value as `getUserIds()` when the refresh is complete.\r\n * If a refresh is already in progress, it will be canceled (rejecting promises returned by previous calls to `refreshUserIds`).\r\n *\r\n * @param submoduleNames? submodules to refresh. If omitted, refresh all submodules.\r\n * @param callback? called when the refresh is complete\r\n */\r\nfunction refreshUserIds({submoduleNames} = {}, callback) {\r\n  return initIdSystem({refresh: true, submoduleNames})\r\n    .then(() => {\r\n      if (callback && isFn(callback)) {\r\n        callback();\r\n      }\r\n      return getUserIds();\r\n    });\r\n}\r\n\r\n/**\r\n * @returns a promise that resolves to the same value as `getUserIds()`, but only once all ID submodules have completed\r\n * initialization. This can also be used to synchronize calls to other ID accessors, e.g.\r\n *\r\n * ```\r\n * pbjs.getUserIdsAsync().then(() => {\r\n *   const eids = pbjs.getUserIdsAsEids(); // guaranteed to be completely initialized at this point\r\n * });\r\n * ```\r\n */\r\n\r\nfunction getUserIdsAsync() {\r\n  return initIdSystem().then(\r\n    () => getUserIds(),\r\n    (e) => {\r\n      if (e === INIT_CANCELED) {\r\n        // there's a pending refresh - because GreedyPromise runs this synchronously, we are now in the middle\r\n        // of canceling the previous init, before the refresh logic has had a chance to run.\r\n        // Use a \"normal\" Promise to clear the stack and let it complete (or this will just recurse infinitely)\r\n        return Promise.resolve().then(getUserIdsAsync)\r\n      } else {\r\n        logError('Error initializing userId', e)\r\n        return GreedyPromise.reject(e)\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\n/**\r\n * This hook returns updated list of submodules which are allowed to do get user id based on TCF 2 enforcement rules configured\r\n */\r\nexport const validateGdprEnforcement = hook('sync', function (submodules, consentData) {\r\n  return { userIdModules: submodules, hasValidated: consentData && consentData.hasValidated };\r\n}, 'validateGdprEnforcement');\r\n\r\nfunction populateSubmoduleId(submodule, consentData, storedConsentData, forceRefresh) {\r\n  // There are two submodule configuration types to handle: storage or value\r\n  // 1. storage: retrieve user id data from cookie/html storage or with the submodule's getId method\r\n  // 2. value: pass directly to bids\r\n  if (submodule.config.storage) {\r\n    let storedId = getStoredValue(submodule.config.storage);\r\n    let response;\r\n\r\n    let refreshNeeded = false;\r\n    if (typeof submodule.config.storage.refreshInSeconds === 'number') {\r\n      const storedDate = new Date(getStoredValue(submodule.config.storage, 'last'));\r\n      refreshNeeded = storedDate && (Date.now() - storedDate.getTime() > submodule.config.storage.refreshInSeconds * 1000);\r\n    }\r\n\r\n    if (!storedId || refreshNeeded || forceRefresh || !storedConsentDataMatchesConsentData(storedConsentData, consentData)) {\r\n      // No id previously saved, or a refresh is needed, or consent has changed. Request a new id from the submodule.\r\n      response = submodule.submodule.getId(submodule.config, consentData, storedId);\r\n    } else if (typeof submodule.submodule.extendId === 'function') {\r\n      // If the id exists already, give submodule a chance to decide additional actions that need to be taken\r\n      response = submodule.submodule.extendId(submodule.config, consentData, storedId);\r\n    }\r\n\r\n    if (isPlainObject(response)) {\r\n      if (response.id) {\r\n        // A getId/extendId result assumed to be valid user id data, which should be saved to users local storage or cookies\r\n        setStoredValue(submodule, response.id);\r\n        storedId = response.id;\r\n      }\r\n\r\n      if (typeof response.callback === 'function') {\r\n        // Save async callback to be invoked after auction\r\n        submodule.callback = response.callback;\r\n      }\r\n    }\r\n\r\n    if (storedId) {\r\n      // cache decoded value (this is copied to every adUnit bid)\r\n      submodule.idObj = submodule.submodule.decode(storedId, submodule.config);\r\n    }\r\n  } else if (submodule.config.value) {\r\n    // cache decoded value (this is copied to every adUnit bid)\r\n    submodule.idObj = submodule.config.value;\r\n  } else {\r\n    const response = submodule.submodule.getId(submodule.config, consentData, undefined);\r\n    if (isPlainObject(response)) {\r\n      if (typeof response.callback === 'function') { submodule.callback = response.callback; }\r\n      if (response.id) { submodule.idObj = submodule.submodule.decode(response.id, submodule.config); }\r\n    }\r\n  }\r\n}\r\n\r\nfunction initSubmodules(dest, submodules, consentData, forceRefresh = false) {\r\n  return uidMetrics().fork().measureTime('userId.init.modules', function () {\r\n    if (!submodules.length) return []; // to simplify log messages from here on\r\n\r\n    // filter out submodules whose storage type is not enabled\r\n    // this needs to be done here (after consent data has loaded) so that enforcement may disable storage globally\r\n    const storageTypes = getActiveStorageTypes();\r\n    submodules = submodules.filter((submod) => !submod.config.storage || storageTypes.has(submod.config.storage.type));\r\n\r\n    if (!submodules.length) {\r\n      logWarn(`${MODULE_NAME} - no ID module is configured for one of the available storage types:`, Array.from(storageTypes));\r\n      return [];\r\n    }\r\n\r\n    // another consent check, this time each module is checked for consent with its own gvlid\r\n    let { userIdModules, hasValidated } = validateGdprEnforcement(submodules, consentData);\r\n    if (!hasValidated && !hasPurpose1Consent(consentData)) {\r\n      logWarn(`${MODULE_NAME} - gdpr permission not valid for local storage or cookies, exit module`);\r\n      return [];\r\n    }\r\n\r\n    // we always want the latest consentData stored, even if we don't execute any submodules\r\n    const storedConsentData = getStoredConsentData();\r\n    setStoredConsentData(consentData);\r\n\r\n    const initialized = userIdModules.reduce((carry, submodule) => {\r\n      return submoduleMetrics(submodule.submodule.name).measureTime('init', () => {\r\n        try {\r\n          populateSubmoduleId(submodule, consentData, storedConsentData, forceRefresh);\r\n          carry.push(submodule);\r\n        } catch (e) {\r\n          logError(`Error in userID module '${submodule.submodule.name}':`, e);\r\n        }\r\n        return carry;\r\n      })\r\n    }, []);\r\n    if (initialized.length) {\r\n      setPrebidServerEidPermissions(initialized);\r\n    }\r\n    initialized.forEach(updateInitializedSubmodules.bind(null, dest));\r\n    return initialized;\r\n  })\r\n}\r\n\r\nfunction updateInitializedSubmodules(dest, submodule) {\r\n  let updated = false;\r\n  for (let i = 0; i < dest.length; i++) {\r\n    if (submodule.config.name.toLowerCase() === dest[i].config.name.toLowerCase()) {\r\n      updated = true;\r\n      dest[i] = submodule;\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (!updated) {\r\n    dest.push(submodule);\r\n  }\r\n}\r\n\r\n/**\r\n * list of submodule configurations with valid 'storage' or 'value' obj definitions\r\n * * storage config: contains values for storing/retrieving User ID data in browser storage\r\n * * value config: object properties that are copied to bids (without saving to storage)\r\n * @param {SubmoduleConfig[]} configRegistry\r\n * @param {Submodule[]} submoduleRegistry\r\n * @param {string[]} activeStorageTypes\r\n * @returns {SubmoduleConfig[]}\r\n */\r\nfunction getValidSubmoduleConfigs(configRegistry, submoduleRegistry) {\r\n  if (!Array.isArray(configRegistry)) {\r\n    return [];\r\n  }\r\n  return configRegistry.reduce((carry, config) => {\r\n    // every submodule config obj must contain a valid 'name'\r\n    if (!config || isEmptyStr(config.name)) {\r\n      return carry;\r\n    }\r\n    // Validate storage config contains 'type' and 'name' properties with non-empty string values\r\n    // 'type' must be one of html5, cookies\r\n    if (config.storage &&\r\n      !isEmptyStr(config.storage.type) &&\r\n      !isEmptyStr(config.storage.name) &&\r\n      ALL_STORAGE_TYPES.has(config.storage.type)) {\r\n      carry.push(config);\r\n    } else if (isPlainObject(config.value)) {\r\n      carry.push(config);\r\n    } else if (!config.storage && !config.value) {\r\n      carry.push(config);\r\n    }\r\n    return carry;\r\n  }, []);\r\n}\r\n\r\nconst ALL_STORAGE_TYPES = new Set([LOCAL_STORAGE, COOKIE]);\r\n\r\nfunction getActiveStorageTypes() {\r\n  const storageTypes = [];\r\n  let disabled = false;\r\n  if (coreStorage.localStorageIsEnabled()) {\r\n    storageTypes.push(LOCAL_STORAGE);\r\n    if (coreStorage.getDataFromLocalStorage(PBJS_USER_ID_OPTOUT_NAME)) {\r\n      logInfo(`${MODULE_NAME} - opt-out localStorage found, storage disabled`);\r\n      disabled = true;\r\n    }\r\n  }\r\n  if (coreStorage.cookiesAreEnabled()) {\r\n    storageTypes.push(COOKIE);\r\n    if (coreStorage.getCookie(PBJS_USER_ID_OPTOUT_NAME)) {\r\n      logInfo(`${MODULE_NAME} - opt-out cookie found, storage disabled`);\r\n      disabled = true;\r\n    }\r\n  }\r\n  return new Set(disabled ? [] : storageTypes)\r\n}\r\n\r\n/**\r\n * update submodules by validating against existing configs and storage types\r\n */\r\nfunction updateSubmodules() {\r\n  const configs = getValidSubmoduleConfigs(configRegistry, submoduleRegistry);\r\n  if (!configs.length) {\r\n    return;\r\n  }\r\n  // do this to avoid reprocessing submodules\r\n  // TODO: the logic does not match the comment - addedSubmodules is always a copy of submoduleRegistry\r\n  // (if it did it would not be correct - it's not enough to find new modules, as others may have been removed or changed)\r\n  const addedSubmodules = submoduleRegistry.filter(i => !find(submodules, j => j.name === i.name));\r\n\r\n  submodules.splice(0, submodules.length);\r\n  // find submodule and the matching configuration, if found create and append a SubmoduleContainer\r\n  addedSubmodules.map(i => {\r\n    const submoduleConfig = find(configs, j => j.name && (j.name.toLowerCase() === i.name.toLowerCase() ||\r\n      (i.aliasName && j.name.toLowerCase() === i.aliasName.toLowerCase())));\r\n    if (submoduleConfig && i.name !== submoduleConfig.name) submoduleConfig.name = i.name;\r\n    i.findRootDomain = findRootDomain;\r\n    return submoduleConfig ? {\r\n      submodule: i,\r\n      config: submoduleConfig,\r\n      callback: undefined,\r\n      idObj: undefined\r\n    } : null;\r\n  }).filter(submodule => submodule !== null)\r\n    .forEach((sm) => submodules.push(sm));\r\n\r\n  if (!addedUserIdHook && submodules.length) {\r\n    // priority value 40 will load after consentManagement with a priority of 50\r\n    getGlobal().requestBids.before(requestBidsHook, 40);\r\n    coreGetPPID.after((next) => next(getPPID()));\r\n    logInfo(`${MODULE_NAME} - usersync config updated for ${submodules.length} submodules: `, submodules.map(a => a.submodule.name));\r\n    addedUserIdHook = true;\r\n  }\r\n}\r\n\r\n/**\r\n * enable submodule in User ID\r\n * @param {Submodule} submodule\r\n */\r\nexport function attachIdSystem(submodule) {\r\n  if (!find(submoduleRegistry, i => i.name === submodule.name)) {\r\n    submoduleRegistry.push(submodule);\r\n    updateSubmodules();\r\n    // TODO: a test case wants this to work even if called after init (the setConfig({userId}))\r\n    // so we trigger a refresh. But is that even possible outside of tests?\r\n    initIdSystem({refresh: true, submoduleNames: [submodule.name]});\r\n  }\r\n}\r\n\r\nfunction normalizePromise(fn) {\r\n  // for public methods that return promises, make sure we return a \"normal\" one - to avoid\r\n  // exposing confusing stack traces\r\n  return function() {\r\n    return Promise.resolve(fn.apply(this, arguments));\r\n  }\r\n}\r\n\r\n/**\r\n * test browser support for storage config types (local storage or cookie), initializes submodules but consentManagement is required,\r\n * so a callback is added to fire after the consentManagement module.\r\n * @param {{getConfig:function}} config\r\n */\r\nexport function init(config, {delay = GreedyPromise.timeout} = {}) {\r\n  ppidSource = undefined;\r\n  submodules = [];\r\n  configRegistry = [];\r\n  addedUserIdHook = false;\r\n  initializedSubmodules = [];\r\n  initIdSystem = idSystemInitializer({delay});\r\n  if (configListener != null) {\r\n    configListener();\r\n  }\r\n  submoduleRegistry = [];\r\n\r\n  // listen for config userSyncs to be set\r\n  configListener = config.getConfig('userSync', conf => {\r\n    // Note: support for 'usersync' was dropped as part of Prebid.js 4.0\r\n    const userSync = conf.userSync;\r\n    ppidSource = userSync.ppid;\r\n    if (userSync && userSync.userIds) {\r\n      configRegistry = userSync.userIds;\r\n      syncDelay = isNumber(userSync.syncDelay) ? userSync.syncDelay : DEFAULT_SYNC_DELAY;\r\n      auctionDelay = isNumber(userSync.auctionDelay) ? userSync.auctionDelay : NO_AUCTION_DELAY;\r\n      updateSubmodules();\r\n      initIdSystem({ready: true});\r\n    }\r\n  });\r\n\r\n  // exposing getUserIds function in global-name-space so that userIds stored in Prebid can be used by external codes.\r\n  (getGlobal()).getUserIds = getUserIds;\r\n  (getGlobal()).getUserIdsAsEids = getUserIdsAsEids;\r\n  (getGlobal()).getEncryptedEidsForSource = normalizePromise(getEncryptedEidsForSource);\r\n  (getGlobal()).registerSignalSources = registerSignalSources;\r\n  (getGlobal()).refreshUserIds = normalizePromise(refreshUserIds);\r\n  (getGlobal()).getUserIdsAsync = normalizePromise(getUserIdsAsync);\r\n  (getGlobal()).getUserIdsAsEidBySource = getUserIdsAsEidBySource;\r\n}\r\n\r\n// init config update listener to start the application\r\ninit(config);\r\n\r\nmodule('userId', attachIdSystem);\r\n","})()\r\n \r\n   pbjs.processQueue();\r\n \r\n} else {\r\n try {\r\n  if(window.pbjs.getConfig('debug')) {\r\n    console.warn('Attempted to load a copy of Prebid.js that clashes with the existing \\'pbjs\\' instance. Load aborted.');\r\n  }\r\n } catch (e) {}\r\n}\r\n"]}